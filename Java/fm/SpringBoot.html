<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zhiyu1998.github.io/Java/fm/SpringBoot.html"><meta property="og:title" content="SpringBoot"><meta property="og:description" content="Spring-Boot-Note (#spring-boot-note); 环境搭建 & 简化部署 (#环境搭建--简化部署); 环境搭建 (#环境搭建); 简化部署 (#简化部署); @SpringBootApplication启动原理 (#springbootapplication启动原理); IDEA 快速构建 (#idea-快速构建); YAM..."><meta property="og:type" content="article"><meta property="og:image" content="https://zhiyu1998.github.io/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-04-04T15:12:04.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="SpringBoot"><meta property="article:author" content="zhiyu1998"><meta property="article:modified_time" content="2023-04-04T15:12:04.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SpringBoot","image":["https://zhiyu1998.github.io/"],"dateModified":"2023-04-04T15:12:04.000Z","author":[{"@type":"Person","name":"zhiyu1998","url":"https://github.com/zhiyu1998"}]}</script><title>SpringBoot</title><meta name="description" content="Spring-Boot-Note (#spring-boot-note); 环境搭建 & 简化部署 (#环境搭建--简化部署); 环境搭建 (#环境搭建); 简化部署 (#简化部署); @SpringBootApplication启动原理 (#springbootapplication启动原理); IDEA 快速构建 (#idea-快速构建); YAM...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-36e15ede.css" as="style"><link rel="stylesheet" href="/assets/style-36e15ede.css">
    <link rel="modulepreload" href="/assets/app-8ba9a2ae.js"><link rel="modulepreload" href="/assets/framework-afce0fe7.js"><link rel="modulepreload" href="/assets/SpringBoot.html-9e971f03.js"><link rel="modulepreload" href="/assets/SpringBoot.html-d4bd5cff.js"><link rel="prefetch" href="/assets/index.html-d9198133.js" as="script"><link rel="prefetch" href="/assets/slides.html-edfb2738.js" as="script"><link rel="prefetch" href="/assets/datastruct.html-a9bd8f96.js" as="script"><link rel="prefetch" href="/assets/learnInProblem.html-04764ac0.js" as="script"><link rel="prefetch" href="/assets/index.html-a6c08c42.js" as="script"><link rel="prefetch" href="/assets/disable.html-07a80b36.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-54a2a05d.js" as="script"><link rel="prefetch" href="/assets/markdown.html-93d0c718.js" as="script"><link rel="prefetch" href="/assets/page.html-69476a55.js" as="script"><link rel="prefetch" href="/assets/personal_tech.html-f26ff8f0.js" as="script"><link rel="prefetch" href="/assets/rent_house.html-290723a7.js" as="script"><link rel="prefetch" href="/assets/basic.html-a3c5ecd3.js" as="script"><link rel="prefetch" href="/assets/concurrent.html-3da9a4c0.js" as="script"><link rel="prefetch" href="/assets/giant.html-ab6853ae.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-bc14cd60.js" as="script"><link rel="prefetch" href="/assets/Spring.html-f4f129e6.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-b526bd26.js" as="script"><link rel="prefetch" href="/assets/SpringDataJpa.html-cdf66782.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-4c33563f.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-d540db39.js" as="script"><link rel="prefetch" href="/assets/kotlin.html-63ccc402.js" as="script"><link rel="prefetch" href="/assets/leetcode.html-b7cbfbc8.js" as="script"><link rel="prefetch" href="/assets/react.html-fedfbbcc.js" as="script"><link rel="prefetch" href="/assets/typescript.html-cb58f47d.js" as="script"><link rel="prefetch" href="/assets/vue.html-fa7d778e.js" as="script"><link rel="prefetch" href="/assets/1.简介.html-04af62ad.js" as="script"><link rel="prefetch" href="/assets/10.对象的实例化内存布局与访问定位.html-d64f2cd4.js" as="script"><link rel="prefetch" href="/assets/11.直接内存.html-62cb9ff8.js" as="script"><link rel="prefetch" href="/assets/12.执行引擎.html-61e5b407.js" as="script"><link rel="prefetch" href="/assets/13.StringTable.html-b734f6c7.js" as="script"><link rel="prefetch" href="/assets/14.垃圾回收概述.html-d9d106b0.js" as="script"><link rel="prefetch" href="/assets/15.垃圾回收相关算法.html-82ffc5a7.js" as="script"><link rel="prefetch" href="/assets/16.垃圾回收相关概念.html-e6b4a5ed.js" as="script"><link rel="prefetch" href="/assets/17-垃圾回收器.html-40d59697.js" as="script"><link rel="prefetch" href="/assets/2.类加载子系统.html-fd290b48.js" as="script"><link rel="prefetch" href="/assets/3.运行时数据区.html-94ed88a2.js" as="script"><link rel="prefetch" href="/assets/4.程序计数器（PC寄存器）.html-89192bf6.js" as="script"><link rel="prefetch" href="/assets/5.虚拟机栈.html-c5adb2fa.js" as="script"><link rel="prefetch" href="/assets/6.本地方法接口.html-42d32342.js" as="script"><link rel="prefetch" href="/assets/7.本地方法栈.html-1cd7cbda.js" as="script"><link rel="prefetch" href="/assets/8.堆.html-ee479adb.js" as="script"><link rel="prefetch" href="/assets/9.方法区.html-833038cb.js" as="script"><link rel="prefetch" href="/assets/03-数组中重复的数字.html-96c87dca.js" as="script"><link rel="prefetch" href="/assets/04-二维数组中的查找.html-325a1dff.js" as="script"><link rel="prefetch" href="/assets/05-替换空格.html-60d5584e.js" as="script"><link rel="prefetch" href="/assets/09-用两个栈实现队列.html-e03e09a0.js" as="script"><link rel="prefetch" href="/assets/10-I.斐波那契数列.html-fe1079df.js" as="script"><link rel="prefetch" href="/assets/10-II青蛙跳台阶问题.html-71978553.js" as="script"><link rel="prefetch" href="/assets/11-旋转数组的最小数字.html-11a1238d.js" as="script"><link rel="prefetch" href="/assets/12-矩阵中的路径.html-d64979a0.js" as="script"><link rel="prefetch" href="/assets/13-机器人的运动范围.html-d437b841.js" as="script"><link rel="prefetch" href="/assets/14-剪绳子.html-6542d6ed.js" as="script"><link rel="prefetch" href="/assets/15-二进制中1的个数.html-c46fa89d.js" as="script"><link rel="prefetch" href="/assets/16-数值的整数次方.html-a8465472.js" as="script"><link rel="prefetch" href="/assets/17-打印从1到最大的n位数.html-a3a5327b.js" as="script"><link rel="prefetch" href="/assets/18-删除链表的节点.html-e88ab049.js" as="script"><link rel="prefetch" href="/assets/22-链表中倒数第k个节点.html-238f7205.js" as="script"><link rel="prefetch" href="/assets/24-反转链表.html-9b5ee9ba.js" as="script"><link rel="prefetch" href="/assets/25-合并两个排序的链表.html-ff4b0b9b.js" as="script"><link rel="prefetch" href="/assets/26-树的子结构.html-439b0d2b.js" as="script"><link rel="prefetch" href="/assets/27-二叉树的镜像.html-0e823167.js" as="script"><link rel="prefetch" href="/assets/28-对称的二叉树.html-4f2707dc.js" as="script"><link rel="prefetch" href="/assets/58-II 左旋转字符串.html-813be194.js" as="script"><link rel="prefetch" href="/assets/常用方法封装合集.html-9d52740e.js" as="script"><link rel="prefetch" href="/assets/404.html-444aa4c2.js" as="script"><link rel="prefetch" href="/assets/index.html-af5a835d.js" as="script"><link rel="prefetch" href="/assets/index.html-6a5f6a81.js" as="script"><link rel="prefetch" href="/assets/index.html-ae873f0f.js" as="script"><link rel="prefetch" href="/assets/index.html-98f137be.js" as="script"><link rel="prefetch" href="/assets/index.html-b047ce6f.js" as="script"><link rel="prefetch" href="/assets/index.html-197abdbf.js" as="script"><link rel="prefetch" href="/assets/index.html-247ccb40.js" as="script"><link rel="prefetch" href="/assets/index.html-dc52867b.js" as="script"><link rel="prefetch" href="/assets/index.html-85439b7e.js" as="script"><link rel="prefetch" href="/assets/index.html-156ca8d1.js" as="script"><link rel="prefetch" href="/assets/index.html-571434fd.js" as="script"><link rel="prefetch" href="/assets/index.html-7891cba0.js" as="script"><link rel="prefetch" href="/assets/index.html-c5bdcde2.js" as="script"><link rel="prefetch" href="/assets/index.html-56abb5c0.js" as="script"><link rel="prefetch" href="/assets/index.html-d0df6dbe.js" as="script"><link rel="prefetch" href="/assets/index.html-9a3b6350.js" as="script"><link rel="prefetch" href="/assets/index.html-33da033f.js" as="script"><link rel="prefetch" href="/assets/index.html-ba00b820.js" as="script"><link rel="prefetch" href="/assets/slides.html-a991af2c.js" as="script"><link rel="prefetch" href="/assets/datastruct.html-472a60af.js" as="script"><link rel="prefetch" href="/assets/learnInProblem.html-c7e34a2a.js" as="script"><link rel="prefetch" href="/assets/index.html-c34e5275.js" as="script"><link rel="prefetch" href="/assets/disable.html-d972dbc6.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-4170437a.js" as="script"><link rel="prefetch" href="/assets/markdown.html-61862a67.js" as="script"><link rel="prefetch" href="/assets/page.html-67d96e22.js" as="script"><link rel="prefetch" href="/assets/personal_tech.html-5568dee3.js" as="script"><link rel="prefetch" href="/assets/rent_house.html-1e0dd4dc.js" as="script"><link rel="prefetch" href="/assets/basic.html-c2646d44.js" as="script"><link rel="prefetch" href="/assets/concurrent.html-39cf5963.js" as="script"><link rel="prefetch" href="/assets/giant.html-d487f17f.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-4cc25a5e.js" as="script"><link rel="prefetch" href="/assets/Spring.html-f3f7fa46.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-98a8846e.js" as="script"><link rel="prefetch" href="/assets/SpringDataJpa.html-3f409240.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-8aafdcdc.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-7207c9e2.js" as="script"><link rel="prefetch" href="/assets/kotlin.html-5d5ab39f.js" as="script"><link rel="prefetch" href="/assets/leetcode.html-f644d859.js" as="script"><link rel="prefetch" href="/assets/react.html-b42d5409.js" as="script"><link rel="prefetch" href="/assets/typescript.html-975b0d19.js" as="script"><link rel="prefetch" href="/assets/vue.html-4774ef96.js" as="script"><link rel="prefetch" href="/assets/1.简介.html-cce408a1.js" as="script"><link rel="prefetch" href="/assets/10.对象的实例化内存布局与访问定位.html-515f2516.js" as="script"><link rel="prefetch" href="/assets/11.直接内存.html-2ec20fbe.js" as="script"><link rel="prefetch" href="/assets/12.执行引擎.html-3ea322f7.js" as="script"><link rel="prefetch" href="/assets/13.StringTable.html-52eab086.js" as="script"><link rel="prefetch" href="/assets/14.垃圾回收概述.html-02cc39e1.js" as="script"><link rel="prefetch" href="/assets/15.垃圾回收相关算法.html-bb94208f.js" as="script"><link rel="prefetch" href="/assets/16.垃圾回收相关概念.html-9fa9bd26.js" as="script"><link rel="prefetch" href="/assets/17-垃圾回收器.html-e0eba67c.js" as="script"><link rel="prefetch" href="/assets/2.类加载子系统.html-b5ef1fef.js" as="script"><link rel="prefetch" href="/assets/3.运行时数据区.html-698c4b97.js" as="script"><link rel="prefetch" href="/assets/4.程序计数器（PC寄存器）.html-2216ef62.js" as="script"><link rel="prefetch" href="/assets/5.虚拟机栈.html-817a090b.js" as="script"><link rel="prefetch" href="/assets/6.本地方法接口.html-0df9672c.js" as="script"><link rel="prefetch" href="/assets/7.本地方法栈.html-034dc764.js" as="script"><link rel="prefetch" href="/assets/8.堆.html-8bc226c6.js" as="script"><link rel="prefetch" href="/assets/9.方法区.html-fbc5da79.js" as="script"><link rel="prefetch" href="/assets/03-数组中重复的数字.html-567f5361.js" as="script"><link rel="prefetch" href="/assets/04-二维数组中的查找.html-6e6af06d.js" as="script"><link rel="prefetch" href="/assets/05-替换空格.html-202212eb.js" as="script"><link rel="prefetch" href="/assets/09-用两个栈实现队列.html-19d03253.js" as="script"><link rel="prefetch" href="/assets/10-I.斐波那契数列.html-b6e27af0.js" as="script"><link rel="prefetch" href="/assets/10-II青蛙跳台阶问题.html-10ebe3d1.js" as="script"><link rel="prefetch" href="/assets/11-旋转数组的最小数字.html-f82a7837.js" as="script"><link rel="prefetch" href="/assets/12-矩阵中的路径.html-324f8453.js" as="script"><link rel="prefetch" href="/assets/13-机器人的运动范围.html-dad3810f.js" as="script"><link rel="prefetch" href="/assets/14-剪绳子.html-c23774d2.js" as="script"><link rel="prefetch" href="/assets/15-二进制中1的个数.html-14fb859b.js" as="script"><link rel="prefetch" href="/assets/16-数值的整数次方.html-64f6fe8a.js" as="script"><link rel="prefetch" href="/assets/17-打印从1到最大的n位数.html-8531c65c.js" as="script"><link rel="prefetch" href="/assets/18-删除链表的节点.html-3aeace11.js" as="script"><link rel="prefetch" href="/assets/22-链表中倒数第k个节点.html-2517eeed.js" as="script"><link rel="prefetch" href="/assets/24-反转链表.html-6a3f1b99.js" as="script"><link rel="prefetch" href="/assets/25-合并两个排序的链表.html-702f2779.js" as="script"><link rel="prefetch" href="/assets/26-树的子结构.html-4d99c9a3.js" as="script"><link rel="prefetch" href="/assets/27-二叉树的镜像.html-85287fc8.js" as="script"><link rel="prefetch" href="/assets/28-对称的二叉树.html-3aeebb13.js" as="script"><link rel="prefetch" href="/assets/58-II 左旋转字符串.html-a6dd23e1.js" as="script"><link rel="prefetch" href="/assets/常用方法封装合集.html-f4b05f8b.js" as="script"><link rel="prefetch" href="/assets/404.html-982c42ec.js" as="script"><link rel="prefetch" href="/assets/index.html-95691e99.js" as="script"><link rel="prefetch" href="/assets/index.html-a6d8def1.js" as="script"><link rel="prefetch" href="/assets/index.html-040d812d.js" as="script"><link rel="prefetch" href="/assets/index.html-44563782.js" as="script"><link rel="prefetch" href="/assets/index.html-e775c7d3.js" as="script"><link rel="prefetch" href="/assets/index.html-fca388e5.js" as="script"><link rel="prefetch" href="/assets/index.html-8663824d.js" as="script"><link rel="prefetch" href="/assets/index.html-c6c6d33d.js" as="script"><link rel="prefetch" href="/assets/index.html-a1738b34.js" as="script"><link rel="prefetch" href="/assets/index.html-eaa10b62.js" as="script"><link rel="prefetch" href="/assets/index.html-1271cf68.js" as="script"><link rel="prefetch" href="/assets/index.html-81d7f46f.js" as="script"><link rel="prefetch" href="/assets/index.html-b144c1dd.js" as="script"><link rel="prefetch" href="/assets/index.html-1fbfb2e6.js" as="script"><link rel="prefetch" href="/assets/index.html-96bcade0.js" as="script"><link rel="prefetch" href="/assets/index.html-7186d5f7.js" as="script"><link rel="prefetch" href="/assets/index.html-90e31230.js" as="script"><link rel="prefetch" href="/assets/waline-meta-a31b78ed.js" as="script"><link rel="prefetch" href="/assets/component-46822c2b.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-882ea22b.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-5e047ead.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-36cd6c3c.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt><!----><!----></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/intro/" class="nav-link" aria-label="导读"><span class="font-icon icon iconfont icon-discover" style=""></span>导读<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes/issues" rel="noopener noreferrer" target="_blank" aria-label="问题反馈" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>问题反馈<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-vscode" style=""></span><span class="title">前端</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-timer" style=""></span><span class="title">Golang</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-build" style=""></span><span class="title">计算机基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">Java基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-branch" style=""></span><span class="title">Java并发</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-profile" style=""></span><span class="title">Java面试</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-leaf" style=""></span><span class="title">Java框架</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/Java/fm/Mybatis.html" class="nav-link sidebar-link sidebar-page" aria-label="Mybatis"><!---->Mybatis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/fm/Spring.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring"><!---->Spring<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/Java/fm/SpringBoot.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="SpringBoot"><!---->SpringBoot<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#环境搭建-简化部署" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="环境搭建 &amp; 简化部署"><!---->环境搭建 &amp; 简化部署<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#环境搭建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="环境搭建"><!---->环境搭建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#简化部署" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="简化部署"><!---->简化部署<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springbootapplication启动原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@SpringBootApplication启动原理"><!---->@SpringBootApplication启动原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#idea-快速构建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="IDEA 快速构建"><!---->IDEA 快速构建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#yaml" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="YAML"><!---->YAML<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#yaml基本语法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="YAML基本语法"><!---->YAML基本语法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#单元测试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="单元测试"><!---->单元测试<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#ssm" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SSM"><!---->SSM<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot"><!---->SpringBoot<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#configurationproperties-value" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@ConfigurationProperties&amp;@Value"><!---->@ConfigurationProperties&amp;@Value<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#propertysource-importresource" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@PropertySource&amp;@ImportResource"><!---->@PropertySource&amp;@ImportResource<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#【推荐】自己创建个配置类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="【推荐】自己创建个配置类"><!---->【推荐】自己创建个配置类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#配置文件的占位符" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置文件的占位符"><!---->配置文件的占位符<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#多profile支持" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="多Profile支持"><!---->多Profile支持<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#加载配置文件的位置和优先级" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="加载配置文件的位置和优先级"><!---->加载配置文件的位置和优先级<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自动配置原理"><!---->自动配置原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自动配置原理"><!---->自动配置原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#以httpencodingautoconfiguration为例解释自动配置原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="以HttpEncodingAutoConfiguration为例解释自动配置原理"><!---->以HttpEncodingAutoConfiguration为例解释自动配置原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="小结"><!---->小结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#conditional相关注解和debug" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@Conditional相关注解和Debug"><!---->@Conditional相关注解和Debug<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#日志框架sl4j" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="日志框架SL4J"><!---->日志框架SL4J<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#其他日志框架转换为sl4j" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="其他日志框架转换为SL4J"><!---->其他日志框架转换为SL4J<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot和日志关系" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot和日志关系"><!---->SpringBoot和日志关系<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#日志的配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="日志的配置"><!---->日志的配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#指定日志框架" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="指定日志框架"><!---->指定日志框架<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#切换日志框架" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="切换日志框架"><!---->切换日志框架<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#静态资源映射规则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态资源映射规则"><!---->静态资源映射规则<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#模板引擎thymeleaf" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模板引擎Thymeleaf"><!---->模板引擎Thymeleaf<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springmvc自动配置原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringMVC自动配置原理"><!---->SpringMVC自动配置原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#默认配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="默认配置"><!---->默认配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#contentnegotiatingviewresolver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ContentNegotiatingViewResolver"><!---->ContentNegotiatingViewResolver<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#httpmessageconverters" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="HttpMessageConverters"><!---->HttpMessageConverters<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#messagecodesresolver" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MessageCodesResolver"><!---->MessageCodesResolver<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot在springmvc的配置模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot在SpringMVC的配置模式"><!---->SpringBoot在SpringMVC的配置模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#接管springboot的springmvc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接管SpringBoot的SpringMVC"><!---->接管SpringBoot的SpringMVC<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="小结："><!---->小结：<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#国际化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="国际化"><!---->国际化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用thymeleaf国际化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用thymeleaf国际化"><!---->使用thymeleaf国际化<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot区域信息解析器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot区域信息解析器"><!---->SpringBoot区域信息解析器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义国际化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自定义国际化"><!---->自定义国际化<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#拦截器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="拦截器"><!---->拦截器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#错误处理原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="错误处理原理"><!---->错误处理原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制错误页面和json错误数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="定制错误页面和JSON错误数据"><!---->定制错误页面和JSON错误数据<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制一个json数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="定制一个JSON数据"><!---->定制一个JSON数据<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="嵌入式Servlet"><!---->嵌入式Servlet<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#spring两种配置方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Spring两种配置方式："><!---->Spring两种配置方式：<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet两种修改相关配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="嵌入式Servlet两种修改相关配置"><!---->嵌入式Servlet两种修改相关配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#注册三大组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="注册三大组件"><!---->注册三大组件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#源码刨析-嵌入式servlet原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="源码刨析 嵌入式Servlet原理"><!---->源码刨析 嵌入式Servlet原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#配置是如何修改原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置是如何修改原理"><!---->配置是如何修改原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="小结："><!---->小结：<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet自动配置原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="嵌入式Servlet自动配置原理"><!---->嵌入式Servlet自动配置原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合jdbc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="整合JDBC"><!---->整合JDBC<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自动配置原理"><!---->自动配置原理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合druid" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="整合Druid"><!---->整合Druid<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合mybatis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="整合Mybatis"><!---->整合Mybatis<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#maven" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Maven"><!---->Maven<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用注解" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用注解"><!---->使用注解<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="使用配置文件"><!---->使用配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot启动原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot启动原理"><!---->SpringBoot启动原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#第一步-创建springapplication对象" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="第一步：创建SpringApplication对象"><!---->第一步：创建SpringApplication对象<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#第二步-启动应用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="第二步：启动应用"><!---->第二步：启动应用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#基于原理的测试笔记-测试启动的四个类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="（基于原理的测试笔记）测试启动的四个类"><!---->（基于原理的测试笔记）测试启动的四个类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义starters【暂时无法理解】" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自定义starters【暂时无法理解】"><!---->自定义starters【暂时无法理解】<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot缓存基本使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot缓存基本使用"><!---->SpringBoot缓存基本使用<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#基本使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="基本使用"><!---->基本使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#几个属性介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="几个属性介绍"><!---->几个属性介绍<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#缓存自动配置原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="缓存自动配置原理"><!---->缓存自动配置原理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#以-cacheable为例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="以@Cacheable为例"><!---->以@Cacheable为例<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-3" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="小结："><!---->小结：<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheput的使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@CachePut的使用"><!---->@CachePut的使用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheevict-清除缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@CacheEvict 清除缓存"><!---->@CacheEvict 清除缓存<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#caching和-cacheconfig" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@Caching和@CacheConfig"><!---->@Caching和@CacheConfig<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#caching" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@Caching"><!---->@Caching<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheconfig" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="@CacheConfig"><!---->@CacheConfig<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合缓存中间件redis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="整合缓存中间件Redis"><!---->整合缓存中间件Redis<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义rediscachemanager" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="自定义RedisCacheManager"><!---->自定义RedisCacheManager<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#springsecurity的简单使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringSecurity的简单使用"><!---->SpringSecurity的简单使用<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#thymeleaf整合springsecurity" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Thymeleaf整合SpringSecurity"><!---->Thymeleaf整合SpringSecurity<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#记住我" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="记住我"><!---->记住我<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制自己的登录页面" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="定制自己的登录页面"><!---->定制自己的登录页面<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#shiro的简单使用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Shiro的简单使用"><!---->Shiro的简单使用<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#开始配置一个shiro" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="开始配置一个shiro"><!---->开始配置一个shiro<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合shiro启动器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="整合Shiro启动器"><!---->整合Shiro启动器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Java/fm/SpringBoot.html#扩展" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="扩展："><!---->扩展：<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/Java/fm/SpringCloud.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringCloud"><!---->SpringCloud<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/fm/SpringDataJpa.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringDataJpa"><!---->SpringDataJpa<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/fm/SpringMVC.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringMVC"><!---->SpringMVC<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Java/fm/SpringSecurity.html" class="nav-link sidebar-link sidebar-page" aria-label="SpringSecurity"><!---->SpringSecurity<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-async" style=""></span><span class="title">Java虚拟机</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-launch" style=""></span><span class="title">Kotlin结合Spring</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-object" style=""></span><span class="title">LeetCode刷题顺序</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-repair" style=""></span><span class="title">经验总结</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->SpringBoot</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/zhiyu1998" target="_blank" rel="noopener noreferrer">zhiyu1998</a></span><span property="author" content="zhiyu1998"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-04T15:12:04.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span class="waline-pageview-count" id="ArtalkPV" data-path="/Java/fm/SpringBoot.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 59 分钟</span><meta property="timeRequired" content="PT59M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#环境搭建-简化部署" class="router-link-active router-link-exact-active toc-link level2">环境搭建 &amp; 简化部署</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#环境搭建" class="router-link-active router-link-exact-active toc-link level3">环境搭建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#简化部署" class="router-link-active router-link-exact-active toc-link level3">简化部署</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springbootapplication启动原理" class="router-link-active router-link-exact-active toc-link level2">@SpringBootApplication启动原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#idea-快速构建" class="router-link-active router-link-exact-active toc-link level2">IDEA 快速构建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#yaml" class="router-link-active router-link-exact-active toc-link level2">YAML</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#yaml基本语法" class="router-link-active router-link-exact-active toc-link level3">YAML基本语法</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#单元测试" class="router-link-active router-link-exact-active toc-link level2">单元测试</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#ssm" class="router-link-active router-link-exact-active toc-link level3">SSM</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot" class="router-link-active router-link-exact-active toc-link level3">SpringBoot</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#configurationproperties-value" class="router-link-active router-link-exact-active toc-link level2">@ConfigurationProperties&amp;@Value</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#propertysource-importresource" class="router-link-active router-link-exact-active toc-link level2">@PropertySource&amp;@ImportResource</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#【推荐】自己创建个配置类" class="router-link-active router-link-exact-active toc-link level3">【推荐】自己创建个配置类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#配置文件的占位符" class="router-link-active router-link-exact-active toc-link level3">配置文件的占位符</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#多profile支持" class="router-link-active router-link-exact-active toc-link level3">多Profile支持</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#加载配置文件的位置和优先级" class="router-link-active router-link-exact-active toc-link level2">加载配置文件的位置和优先级</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理" class="router-link-active router-link-exact-active toc-link level2">自动配置原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理-1" class="router-link-active router-link-exact-active toc-link level3">自动配置原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#以httpencodingautoconfiguration为例解释自动配置原理" class="router-link-active router-link-exact-active toc-link level3">以HttpEncodingAutoConfiguration为例解释自动配置原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结" class="router-link-active router-link-exact-active toc-link level3">小结</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#conditional相关注解和debug" class="router-link-active router-link-exact-active toc-link level2">@Conditional相关注解和Debug</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#日志框架sl4j" class="router-link-active router-link-exact-active toc-link level2">日志框架SL4J</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#其他日志框架转换为sl4j" class="router-link-active router-link-exact-active toc-link level3">其他日志框架转换为SL4J</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot和日志关系" class="router-link-active router-link-exact-active toc-link level3">SpringBoot和日志关系</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#日志的配置" class="router-link-active router-link-exact-active toc-link level3">日志的配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#指定日志框架" class="router-link-active router-link-exact-active toc-link level3">指定日志框架</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#切换日志框架" class="router-link-active router-link-exact-active toc-link level3">切换日志框架</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#静态资源映射规则" class="router-link-active router-link-exact-active toc-link level2">静态资源映射规则</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#模板引擎thymeleaf" class="router-link-active router-link-exact-active toc-link level2">模板引擎Thymeleaf</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springmvc自动配置原理" class="router-link-active router-link-exact-active toc-link level2">SpringMVC自动配置原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#默认配置" class="router-link-active router-link-exact-active toc-link level3">默认配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#contentnegotiatingviewresolver" class="router-link-active router-link-exact-active toc-link level3">ContentNegotiatingViewResolver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#httpmessageconverters" class="router-link-active router-link-exact-active toc-link level3">HttpMessageConverters</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#messagecodesresolver" class="router-link-active router-link-exact-active toc-link level3">MessageCodesResolver</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot在springmvc的配置模式" class="router-link-active router-link-exact-active toc-link level3">SpringBoot在SpringMVC的配置模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#接管springboot的springmvc" class="router-link-active router-link-exact-active toc-link level3">接管SpringBoot的SpringMVC</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-1" class="router-link-active router-link-exact-active toc-link level3">小结：</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#国际化" class="router-link-active router-link-exact-active toc-link level2">国际化</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用thymeleaf国际化" class="router-link-active router-link-exact-active toc-link level3">使用thymeleaf国际化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot区域信息解析器" class="router-link-active router-link-exact-active toc-link level3">SpringBoot区域信息解析器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义国际化" class="router-link-active router-link-exact-active toc-link level3">自定义国际化</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#拦截器" class="router-link-active router-link-exact-active toc-link level2">拦截器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#错误处理原理" class="router-link-active router-link-exact-active toc-link level2">错误处理原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制错误页面和json错误数据" class="router-link-active router-link-exact-active toc-link level2">定制错误页面和JSON错误数据</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制一个json数据" class="router-link-active router-link-exact-active toc-link level3">定制一个JSON数据</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet" class="router-link-active router-link-exact-active toc-link level2">嵌入式Servlet</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#spring两种配置方式" class="router-link-active router-link-exact-active toc-link level3">Spring两种配置方式：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet两种修改相关配置" class="router-link-active router-link-exact-active toc-link level3">嵌入式Servlet两种修改相关配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#注册三大组件" class="router-link-active router-link-exact-active toc-link level3">注册三大组件</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#源码刨析-嵌入式servlet原理" class="router-link-active router-link-exact-active toc-link level2">源码刨析 嵌入式Servlet原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#配置是如何修改原理" class="router-link-active router-link-exact-active toc-link level3">配置是如何修改原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-2" class="router-link-active router-link-exact-active toc-link level3">小结：</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#嵌入式servlet自动配置原理" class="router-link-active router-link-exact-active toc-link level2">嵌入式Servlet自动配置原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合jdbc" class="router-link-active router-link-exact-active toc-link level2">整合JDBC</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自动配置原理-2" class="router-link-active router-link-exact-active toc-link level3">自动配置原理</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合druid" class="router-link-active router-link-exact-active toc-link level2">整合Druid</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合mybatis" class="router-link-active router-link-exact-active toc-link level2">整合Mybatis</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#maven" class="router-link-active router-link-exact-active toc-link level3">Maven</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用注解" class="router-link-active router-link-exact-active toc-link level3">使用注解</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#使用配置文件" class="router-link-active router-link-exact-active toc-link level3">使用配置文件</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot启动原理" class="router-link-active router-link-exact-active toc-link level2">SpringBoot启动原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#第一步-创建springapplication对象" class="router-link-active router-link-exact-active toc-link level3">第一步：创建SpringApplication对象</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#第二步-启动应用" class="router-link-active router-link-exact-active toc-link level3">第二步：启动应用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#基于原理的测试笔记-测试启动的四个类" class="router-link-active router-link-exact-active toc-link level2">（基于原理的测试笔记）测试启动的四个类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义starters【暂时无法理解】" class="router-link-active router-link-exact-active toc-link level2">自定义starters【暂时无法理解】</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springboot缓存基本使用" class="router-link-active router-link-exact-active toc-link level2">SpringBoot缓存基本使用</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#基本使用" class="router-link-active router-link-exact-active toc-link level3">基本使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#几个属性介绍" class="router-link-active router-link-exact-active toc-link level3">几个属性介绍</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#缓存自动配置原理" class="router-link-active router-link-exact-active toc-link level2">缓存自动配置原理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#以-cacheable为例" class="router-link-active router-link-exact-active toc-link level3">以@Cacheable为例</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#小结-3" class="router-link-active router-link-exact-active toc-link level3">小结：</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheput的使用" class="router-link-active router-link-exact-active toc-link level2">@CachePut的使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheevict-清除缓存" class="router-link-active router-link-exact-active toc-link level2">@CacheEvict 清除缓存</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#caching和-cacheconfig" class="router-link-active router-link-exact-active toc-link level2">@Caching和@CacheConfig</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#caching" class="router-link-active router-link-exact-active toc-link level3">@Caching</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#cacheconfig" class="router-link-active router-link-exact-active toc-link level3">@CacheConfig</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合缓存中间件redis" class="router-link-active router-link-exact-active toc-link level2">整合缓存中间件Redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#自定义rediscachemanager" class="router-link-active router-link-exact-active toc-link level2">自定义RedisCacheManager</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#springsecurity的简单使用" class="router-link-active router-link-exact-active toc-link level2">SpringSecurity的简单使用</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#thymeleaf整合springsecurity" class="router-link-active router-link-exact-active toc-link level3">Thymeleaf整合SpringSecurity</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#记住我" class="router-link-active router-link-exact-active toc-link level3">记住我</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#定制自己的登录页面" class="router-link-active router-link-exact-active toc-link level3">定制自己的登录页面</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#shiro的简单使用" class="router-link-active router-link-exact-active toc-link level2">Shiro的简单使用</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#开始配置一个shiro" class="router-link-active router-link-exact-active toc-link level3">开始配置一个shiro</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#整合shiro启动器" class="router-link-active router-link-exact-active toc-link level3">整合Shiro启动器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Java/fm/SpringBoot.html#扩展" class="router-link-active router-link-exact-active toc-link level3">扩展：</a></li><!----><!--]--></ul></li><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="spring-boot-note" tabindex="-1"><a class="header-anchor" href="#spring-boot-note" aria-hidden="true">#</a> Spring-Boot-Note</h1><ul><li><a href="#spring-boot-note">Spring-Boot-Note</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA--%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">环境搭建 &amp; 简化部署</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">环境搭建</a></li><li><a href="#%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">简化部署</a></li></ul></li><li><a href="#springbootapplication%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86">@SpringBootApplication启动原理</a></li><li><a href="#idea-%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA">IDEA 快速构建</a></li><li><a href="#yaml">YAML</a><ul><li><a href="#yaml%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">YAML基本语法</a></li></ul></li><li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">单元测试</a><ul><li><a href="#ssm">SSM</a></li><li><a href="#springboot">SpringBoot</a></li></ul></li><li><a href="#configurationpropertiesvalue">@ConfigurationProperties&amp;@Value</a></li><li><a href="#propertysourceimportresource">@PropertySource&amp;@ImportResource</a><ul><li><a href="#%E6%8E%A8%E8%8D%90%E8%87%AA%E5%B7%B1%E5%88%9B%E5%BB%BA%E4%B8%AA%E9%85%8D%E7%BD%AE%E7%B1%BB">【推荐】自己创建个配置类</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8D%A0%E4%BD%8D%E7%AC%A6">配置文件的占位符</a></li><li><a href="#%E5%A4%9Aprofile%E6%94%AF%E6%8C%81">多Profile支持</a></li></ul></li><li><a href="#%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%92%8C%E4%BC%98%E5%85%88%E7%BA%A7">加载配置文件的位置和优先级</a></li><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">自动配置原理</a><ul><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86-1">自动配置原理</a></li><li><a href="#%E4%BB%A5httpencodingautoconfiguration%E4%B8%BA%E4%BE%8B%E8%A7%A3%E9%87%8A%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">以HttpEncodingAutoConfiguration为例解释自动配置原理</a></li><li><a href="#%E5%B0%8F%E7%BB%93">小结</a></li></ul></li><li><a href="#conditional%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3%E5%92%8Cdebug">@Conditional相关注解和Debug</a></li><li><a href="#%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6sl4j">日志框架SL4J</a><ul><li><a href="#%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAsl4j">其他日志框架转换为SL4J</a></li><li><a href="#springboot%E5%92%8C%E6%97%A5%E5%BF%97%E5%85%B3%E7%B3%BB">SpringBoot和日志关系</a></li><li><a href="#%E6%97%A5%E5%BF%97%E7%9A%84%E9%85%8D%E7%BD%AE">日志的配置</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">指定日志框架</a></li><li><a href="#%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">切换日志框架</a></li></ul></li><li><a href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99">静态资源映射规则</a></li><li><a href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8Ethymeleaf">模板引擎Thymeleaf</a></li><li><a href="#springmvc%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">SpringMVC自动配置原理</a><ul><li><a href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">默认配置</a></li><li><a href="#contentnegotiatingviewresolver">ContentNegotiatingViewResolver</a></li><li><a href="#httpmessageconverters">HttpMessageConverters</a></li><li><a href="#messagecodesresolver">MessageCodesResolver</a></li><li><a href="#springboot%E5%9C%A8springmvc%E7%9A%84%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F">SpringBoot在SpringMVC的配置模式</a></li><li><a href="#%E6%8E%A5%E7%AE%A1springboot%E7%9A%84springmvc">接管SpringBoot的SpringMVC</a></li><li><a href="#%E5%B0%8F%E7%BB%93-1">小结：</a></li></ul></li><li><a href="#%E5%9B%BD%E9%99%85%E5%8C%96">国际化</a><ul><li><a href="#%E4%BD%BF%E7%94%A8thymeleaf%E5%9B%BD%E9%99%85%E5%8C%96">使用thymeleaf国际化</a></li><li><a href="#springboot%E5%8C%BA%E5%9F%9F%E4%BF%A1%E6%81%AF%E8%A7%A3%E6%9E%90%E5%99%A8">SpringBoot区域信息解析器</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BD%E9%99%85%E5%8C%96">自定义国际化</a></li></ul></li><li><a href="#%E6%8B%A6%E6%88%AA%E5%99%A8">拦截器</a></li><li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86">错误处理原理</a></li><li><a href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E5%92%8Cjson%E9%94%99%E8%AF%AF%E6%95%B0%E6%8D%AE">定制错误页面和JSON错误数据</a><ul><li><a href="#%E5%AE%9A%E5%88%B6%E4%B8%80%E4%B8%AAjson%E6%95%B0%E6%8D%AE">定制一个JSON数据</a></li></ul></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet">嵌入式Servlet</a><ul><li><a href="#spring%E4%B8%A4%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">Spring两种配置方式：</a></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E4%B8%A4%E7%A7%8D%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">嵌入式Servlet两种修改相关配置</a></li><li><a href="#%E6%B3%A8%E5%86%8C%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6">注册三大组件</a><ul><li><a href="#%E5%AE%9A%E5%88%B6servlet">定制Servlet</a></li><li><a href="#%E5%AE%9A%E5%88%B6filter">定制Filter</a></li><li><a href="#%E5%AE%9A%E5%88%B6listener">定制Listener</a></li></ul></li></ul></li><li><a href="#%E6%BA%90%E7%A0%81%E5%88%A8%E6%9E%90-%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%8E%9F%E7%90%86">源码刨析 嵌入式Servlet原理</a><ul><li><a href="#%E4%BB%A5tomcat%E4%B8%BA%E4%BE%8B">以Tomcat为例</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%8E%9F%E7%90%86">配置是如何修改原理</a></li><li><a href="#%E5%B0%8F%E7%BB%93-2">小结：</a></li></ul></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">嵌入式Servlet自动配置原理</a></li><li><a href="#%E6%95%B4%E5%90%88jdbc">整合JDBC</a><ul><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86-2">自动配置原理</a></li></ul></li><li><a href="#%E6%95%B4%E5%90%88druid">整合Druid</a></li><li><a href="#%E6%95%B4%E5%90%88mybatis">整合Mybatis</a><ul><li><a href="#maven">Maven</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3">使用注解</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">使用配置文件</a></li></ul></li><li><a href="#springboot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86">SpringBoot启动原理</a><ul><li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%88%9B%E5%BB%BAspringapplication%E5%AF%B9%E8%B1%A1">第一步：创建SpringApplication对象</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8">第二步：启动应用</a></li></ul></li><li><a href="#%E5%9F%BA%E4%BA%8E%E5%8E%9F%E7%90%86%E7%9A%84%E6%B5%8B%E8%AF%95%E7%AC%94%E8%AE%B0%E6%B5%8B%E8%AF%95%E5%90%AF%E5%8A%A8%E7%9A%84%E5%9B%9B%E4%B8%AA%E7%B1%BB">（基于原理的测试笔记）测试启动的四个类</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89starters%E6%9A%82%E6%97%B6%E6%97%A0%E6%B3%95%E7%90%86%E8%A7%A3">自定义starters【暂时无法理解】</a></li><li><a href="#springboot%E7%BC%93%E5%AD%98%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">SpringBoot缓存基本使用</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">基本使用</a></li><li><a href="#%E5%87%A0%E4%B8%AA%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D">几个属性介绍</a></li></ul></li><li><a href="#%E7%BC%93%E5%AD%98%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">缓存自动配置原理</a><ul><li><a href="#%E4%BB%A5cacheable%E4%B8%BA%E4%BE%8B">以@Cacheable为例</a></li><li><a href="#%E5%B0%8F%E7%BB%93-3">小结：</a><ul><li><a href="#%E6%A0%B8%E5%BF%83">核心：</a></li><li><a href="#%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86">思路整理</a></li></ul></li></ul></li><li><a href="#cacheput%E7%9A%84%E4%BD%BF%E7%94%A8">@CachePut的使用</a></li><li><a href="#cacheevict-%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98">@CacheEvict 清除缓存</a></li><li><a href="#caching%E5%92%8Ccacheconfig">@Caching和@CacheConfig</a><ul><li><a href="#caching">@Caching</a></li><li><a href="#cacheconfig">@CacheConfig</a></li></ul></li><li><a href="#%E6%95%B4%E5%90%88%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6redis">整合缓存中间件Redis</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89rediscachemanager">自定义RedisCacheManager</a><ul><li><a href="#%E6%89%A9%E5%B1%95cachemanager%E7%9A%84%E7%94%A8%E6%B3%95">扩展CacheManager的用法</a></li></ul></li><li><a href="#springsecurity%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">SpringSecurity的简单使用</a><ul><li><a href="#thymeleaf%E6%95%B4%E5%90%88springsecurity">Thymeleaf整合SpringSecurity</a></li><li><a href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><strong>记住我</strong></a></li><li><a href="#%E5%AE%9A%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2">定制自己的登录页面</a></li></ul></li><li><a href="#shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">Shiro的简单使用</a><ul><li><a href="#%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAshiro">开始配置一个shiro</a></li><li><a href="#%E6%95%B4%E5%90%88shiro%E5%90%AF%E5%8A%A8%E5%99%A8">整合Shiro启动器</a></li><li><a href="#%E6%89%A9%E5%B1%95">扩展：</a><ul><li><a href="#shiro%E9%BB%98%E8%AE%A4%E8%BF%87%E6%BB%A4%E5%99%A8">shiro默认过滤器</a></li><li><a href="#shiro%E5%B8%B8%E7%94%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%B3%A8%E8%A7%A3%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB%E4%B8%8A%E4%BD%BF%E7%94%A8">shiro常用的权限控制注解，可以在控制器类上使用</a></li></ul></li></ul></li></ul></li></ul><h2 id="环境搭建-简化部署" tabindex="-1"><a class="header-anchor" href="#环境搭建-简化部署" aria-hidden="true">#</a> 环境搭建 &amp; 简化部署</h2><h3 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--Spring Boot的版本仲裁中心--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），
只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在默认包下创建一个启动器 标注为SpringBoot程序**@SpringBootApplication**</p><p><strong>注：这个类必须和controller在同一个包下，不然就无法访问controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldApplicationContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="简化部署" tabindex="-1"><a class="header-anchor" href="#简化部署" aria-hidden="true">#</a> 简化部署</h3><p>Maven下导入这个插件点击package即可打包成功</p><p>java -jar 包名既可以运行</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/1-c61d0d80.png" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><p>一些场景启动器：</p><table><thead><tr><th>名称</th><th>描述</th><th>Pom</th></tr></thead><tbody><tr><td><code>spring-boot-starter</code></td><td>核心 starter，包括 auto-configuration 支持，logging 和 YAML</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-activemq</code></td><td>Starter 使用 Apache ActiveMQ 进行 JMS 消息传递</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-amqp</code></td><td>Starter 用于使用 Spring AMQP 和 Rabbit MQ</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-aop</code></td><td>使用 Spring AOP 和 AspectJ 进行 aspect-oriented 编程的 Starter</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-artemis</code></td><td>Starter 使用 Apache Artemis 进行 JMS 消息传递</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-batch</code></td><td>Starter 使用 Spring Batch</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-cache</code></td><td>Starter 用于使用 Spring Framework 的缓存支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-cloud-connectors</code></td><td>Starter 使用 Spring Cloud 连接器简化连接到云平台中的服务，如 Cloud Foundry 和 Heroku</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-cassandra</code></td><td>Starter 用于使用 Cassandra 分布式数据库和 Spring Data Cassandra</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-cassandra-reactive</code></td><td>Starter 用于使用 Cassandra 分布式数据库和 Spring Data Cassandra Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-couchbase</code></td><td>Starter 用于使用 Couchbase document-oriented 数据库和 Spring Data Couchbase</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-couchbase-reactive</code></td><td>Starter 用于使用 Couchbase document-oriented 数据库和 Spring Data Couchbase Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-elasticsearch</code></td><td>Starter 用于使用 Elasticsearch 搜索和分析引擎和 Spring Data Elasticsearch</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-jdbc</code></td><td>Starter 使用 Spring Data JDBC</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-jpa</code></td><td>Starter 使用 Spring Data JPA 和 Hibernate</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-ldap</code></td><td>Starter 使用 Spring Data LDAP</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-mongodb</code></td><td>Starter 用于使用 MongoDB document-oriented 数据库和 Spring Data MongoDB</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-mongodb-reactive</code></td><td>Starter 用于使用 MongoDB document-oriented 数据库和 Spring Data MongoDB Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-neo4j</code></td><td>Starter 用于使用 Neo4j 图形数据库和 Spring Data Neo4j</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-redis</code></td><td>Starter 使用 Redis key-value data store 与 Spring Data Redis 和 Lettuce client</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-redis-reactive</code></td><td>Starter 用于将 Redis key-value data store 与 Spring Data Redis reactive 和 Lettuce client 一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-rest</code></td><td>Starter 使用 Spring Data REST 在 REST 上公开 Spring Data repositories</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-solr</code></td><td>Starter 将 Apache Solr 搜索平台与 Spring Data Solr 一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-freemarker</code></td><td>Starter for building MVC web applications 使用 FreeMarker 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-groovy-templates</code></td><td>Starter for building MVC web applications 使用 Groovy 模板视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-hateoas</code></td><td>Starter for building hypermedia-based RESTful web application with Spring MVC and Spring HATEOAS</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-integration</code></td><td>Starter 使用 Spring Integration</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jdbc</code></td><td>Starter 用于将 JDBC 与 HikariCP 连接池一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jersey</code></td><td>Starter for building RESTful web applications 使用 JAX-RS 和 Jersey。 spring-boot-starter-web的替代方案</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jooq</code></td><td>Starter 用于使用 jOOQ 访问 SQL 数据库。 spring-boot-starter-data-jpa或spring-boot-starter-jdbc的替代方案</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-json</code></td><td>Starter 用于读写 json</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jta-atomikos</code></td><td>Starter for JTA transactions 使用 Atomikos</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jta-bitronix</code></td><td>Starter for JTA transactions 使用 Bitronix</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-mail</code></td><td>Starter 用于使用 Java Mail 和 Spring Framework 的电子邮件发送支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-mustache</code></td><td>Starter for building web applications 使用 Mustache 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-oauth2-client</code></td><td>Starter 使用 Spring Security 的 OAuth2/OpenID Connect client features</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-oauth2-resource-server</code></td><td>Starter 用于使用 Spring Security 的 OAuth2 资源服务器 features</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-quartz</code></td><td>Starter 用于使用 Quartz 调度程序</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-security</code></td><td>Starter 使用 Spring Security</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-test</code></td><td>Starter 用于测试 Spring Boot applications with libraries，包括 JUnit，Hamcrest 和 Mockito</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-thymeleaf</code></td><td>Starter for building MVC web applications 使用 Thymeleaf 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-validation</code></td><td>Starter 用于使用 Hibernate Validator 进行 Java Bean 验证</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-web</code></td><td>Starter for building web，包括使用 Spring MVC 的 RESTful，applications。使用 Tomcat 作为默认嵌入式容器</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-web-services</code></td><td>Starter 使用 Spring Web Services</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-webflux</code></td><td>Starter for building WebFlux applications 使用 Spring Framework 的 Reactive Web 支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-websocket</code></td><td>Starter for building WebSocket applications 使用 Spring Framework 的 WebSocket 支持</td><td>Pom</td></tr></tbody></table><h2 id="springbootapplication启动原理" tabindex="-1"><a class="header-anchor" href="#springbootapplication启动原理" aria-hidden="true">#</a> @SpringBootApplication启动原理</h2><p><strong>@SpringBootApplication</strong></p><p>Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用</p><p>下面是这个注解的内部：组合注解</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@SpringBootConfiguration：**Spring Boot的配置类；</p><p>​ 标注在某个类上，表示这是一个Spring Boot的配置类；</p><p>这个注解进去后是一个标注了**@Configuration**的类：</p><p>配置类上来标注这个注解；配置类 ----- 配置文件；配置类也是容器中的一个组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@EnableAutoConfiguration：**开启自动配置功能</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@AutoConfigurationPackage：**自动配置包</p><p>**@Import(AutoConfigurationPackages.Registrar.class)：**Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigurationPackage</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>内部注册SpringBoot启动器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Registrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">DeterminableImports</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PackageImports</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">determineImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackageImports</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过调试可以看出</p><figure><img src="/assets/2-6fc9b616.png" alt="2" tabindex="0" loading="lazy"><figcaption>2</figcaption></figure><p>再次调试这段：<em>register(registry, new PackageImports(metadata).getPackageNames().toArray(new String[0]));</em></p><figure><img src="/assets/3-c35afec2.png" alt="3" tabindex="0" loading="lazy"><figcaption>3</figcaption></figure><p>可得出结论：将<strong>主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器</strong></p><p>再看**EnableAutoConfiguration的****@Import(AutoConfigurationImportSelector.class)**给容器导入组件，将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">NO_IMPORTS</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察，这个2.0的SpringBoot是跳转到了<strong>getAutoConfigurationEntry</strong>进行了遍历依赖包</p><p>通过单步调试可以看到，这个会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；自动配置类</p><figure><img src="/assets/4-49d73156.png" alt="4" tabindex="0" loading="lazy"><figcaption>4</figcaption></figure><p>可以观察到这个查到包的调用方式：getCandidateConfigurations</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">EMPTY_ENTRY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkExcludedClasses</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations <span class="token operator">=</span> <span class="token function">getConfigurationClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过调用getSpringFactoriesLoaderFactoryClass</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                         <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> <span class="token string">&quot;No auto configuration classes found in META-INF/spring.factories. If you &quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法中：loadFactoryNames就是对这个SpringBoot依赖包进行加载（把得到的properties添加到容器中进行加载）</p><figure><img src="/assets/5-7858b046.png" alt="5" tabindex="0" loading="lazy"><figcaption>5</figcaption></figure><p>这个<strong>FACTORIES_RESOURCE_LOCATION</strong>静态变量也标识了这些<strong>包的路径位置</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORIES_RESOURCE_LOCATION</span> <span class="token operator">=</span> <span class="token string">&quot;META-INF/spring.factories&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>仔细看，还真是。SpringBoot将这些值作为自动配置类导入到容器中，自动配置类就生效</p><figure><img src="/assets/6-728cd3de.png" alt="6" tabindex="0" loading="lazy"><figcaption>6</figcaption></figure><p><strong>小结</strong></p><p>将META-INF/spring.factories里面配置的所有通过EnableAutoConfiguration加入到容器中</p><h2 id="idea-快速构建" tabindex="-1"><a class="header-anchor" href="#idea-快速构建" aria-hidden="true">#</a> IDEA 快速构建</h2><figure><img src="/assets/7-b3e58ae4.png" alt="7" tabindex="0" loading="lazy"><figcaption>7</figcaption></figure><p>默认生成的Spring Boot项目结果</p><p>resources文件夹中目录结构</p><ul><li><strong>static</strong>：保存所有的静态资源； js css images；</li><li></li><li><strong>templates</strong>：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li><li><strong>application.properties</strong>：Spring Boot应用的配置文件；可以修改一些默认设置；</li></ul><h2 id="yaml" tabindex="-1"><a class="header-anchor" href="#yaml" aria-hidden="true">#</a> YAML</h2><p>XML和YAML区别：</p><p>XML：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;server&gt;
    &lt;port&gt;8080&lt;/port&gt;
&lt;/server&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>YAML:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>server:
  port: 8080
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="yaml基本语法" tabindex="-1"><a class="header-anchor" href="#yaml基本语法" aria-hidden="true">#</a> YAML基本语法</h3><p>写法：Key:(空格)Value</p><p>其他数组、对象语法可以阅读：<a href="https://juejin.im/post/5c1a4a0fe51d45344a1c3d2a" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5c1a4a0fe51d45344a1c3d2a<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>将YAML的配置的属性映射到实体类中**@ConfigurationProperties**对实体类的配置进行绑定</p><p>**prefix：**配置用哪个进行绑定</p><p>在YAML可以配置这样一个案例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">lastName</span><span class="token punctuation">:</span> 张三
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token key atrule">isBoss</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">birthday</span><span class="token punctuation">:</span> 2020/2/2
  <span class="token key atrule">map</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">k1</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token key atrule">k2</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">}</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> lisi
    <span class="token punctuation">-</span> zhaoliu
  <span class="token key atrule">dog</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 小狗
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以创建一个实体类进行绑定测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isBoss<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用ConfigurationProperties出现以下错误：</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfEAAAAkCAYAAACZtgNVAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAnFSURBVHhe7ZtLbxxFEMfzfXIiCIl4bScBEiC8FwIScCJAFixMnA0KAS0YISSIeSQmyBJC4mBZ3CzOzgfgYzVd1dPTj6menpl9eCf7P/y0mame6uqq6qnu9uTM+oVLijh37hz/AgAAWB1eHb4FegyKOAAArDBXf/wP9BgUcQAAWGGkwgD6wxkq3gAAAFYTqTCA/hDsxG+vrQEAAACgJ6CIAwAAAD0FRRwAAADoKSjiAAAAQE9BEQcAAAB6Chfxtc2rKOIAAABAzzBF/IX3UcQBAACAnoHjdNCY8XCods+fF2UAgMcTzPvl5sydj99Ua5tvzr2Ib19fF+/77I4m6vDoSB1rDvcnam/YPXHG54dqb39/Kh0pSPeB1n0YMJ290xL4bjJSuzO0hcd7dKIePXqkjk/21b2n35ibb7syz3j7jIcjE/vRUJQvO4ueFwfaTygA/aQP857Y2z9Rx5N+zsdZcOby5sW5F/Gb726oG/cvqZ2X04WcAnFyYgrQXlGQ6PqgY8KMhxOdePMJ7vj8SB2S7iP/hXXEyX44ml2Cj0f76lgvDupegnainRTFe29ERWY638WQHSd6Eu8VdszTt02JfbMom3YnJs4nR/VxmQdN8iFmkX6S5sUx5+biffU40CXes2QZ573Eyhdx82HbnIr45pr67NNNNXpwSY3uX1TbH26I7ezkjwvgMq76iLS9+oW1PwruTQNPoswLkIqKP9Ess0zsJnYsmtOwyS6YDvVC6XCGi6SmdBnzIv0kzYuysK/wS7Yrpz3vlnHeS6CIz7CIj58ZqFuX19TOcKCL94Ya/XSRi7dl6/YF+blEUQzkenW/N6Rfc7xDO8+Dor2T0w7eFFJzT+9OdRvxed71u8Cbo8Bil0WyER07hm1cW62nQREnnaSDdBLxqrpOvjvRq3DdB9/X4zgWFgcpO2Lq+sn5RrLD963Vn/Idrd5Jv1/wbPswNi52ok6tixYs5reZTV3HnMLsRPRzWk/84sjpbNJnnc2pfFgmP3F7IR/tvHD6qrFO2ZCTV2Wj8FldiKwP/HdGVtbIL+E4fJr4rq6PJvOfaOcbaQyyfac570Obo3jGfeq+UMSnKeKDgbr53rramujd9m9hwQ74Ve/E9W78k2/lIk7wROegVP+eywHXCUVymxS7tEosrks5T0TzNzh7r0wY3ZaSkeTx83TN/etVJ+38/USSksPp1n3RRx/EyBw1+S+wqk5zbZOyTk7XbCPLzZisXospKm4MKer7qfeNZIfvW1m/851kI7UxO1qny49dVmcnm5qP2doZw6ce9mXD7fVLqLA378d8n/U2V8csP3N6fop1m3sm1sYeI8/H2tkgyQ/0tS1qob3Fs2VBMPbb7xd4jkZjk2RSn2E/8jh8rP5Zxzsm1iH5Jj2Gunyt9m/HvYh5b33A18V4cn3aNqtG9yK+vqa27lyoFmxdrG+9NBCfGV+R7xMcEG/1R8lkV4U24HGgbIDj5PKf8RNGermwXEw4uU9fRnb6+KvGOp25Pq2dueOsuJBIZO2I+jRy5xu+juxoOo42kznoP6OTrzvalOwzGnNMxSeRjpzOrDxjM1/HY14yP7n2+qVML34NvWRdYRD05WwQ5GU76VnvXttn62Q5v8SIY50y3jGzHkMlx5dh3nv3cn3ae6tG5yK+/cFGtYBrtu5sqm+uvaP+/OffCnRf0hVDwd4rPiByAQ+DR/DOSCfZt0/fqMiDhBOeDxKKkjUqhlYuJYeYgGSzv4rM6GzS5zST2JK1I+ObUkdqMuf0N5rMkbyDb1rZ1GDMMXYc9uNB8/Gl2yXkdGblXca8ZH6yuoOFLR+Z+n23i7UkL9uxTO8my49LzQem/olYuVPTO774lC8l6+KXmJzvcn3wNbWpm/9Z37Qbg29fqWPh8z4dz9R46b1rfbaKdC7in3wv7MI1O68M1P2ff+ei/UD/Ulv6pWu6H+upI9xpVyfNMhVxvu8lbjbJG/TJbeomccIOn6wdGd+UOhY+mdv5ppVNDcYcQ7lmX/gluj/bT05nVt5lzEvmJ193LHPydrGW5GU7Kyt2/T5BO63P/hdMqa9Y1sUvMTnf5frga2pTN/+b+KbFGHz7Sh2nMe8T8UyNF0VcF3GibRHnv3NHBXzrrtuF3/tyou5eeZ7b0i9dp3bj9H9v6f9Zx8kaH5fHgaor8kHCiXIvoaSE43tycvi6g/ucZEaPnMSeTRl5qa9mEhPsA6ENfZhCx5pZOzK+4evIjuw4PN/VyZP919hs49HaJl8u9RmN2cd/NnU/pzMrz9jM1/GYe+KnUB7py9kgyMt2CZm/2/b/HduXknXxS4zUZtp4x7T1TW4McWyXYd4T5QmJpLOwSXpPrwqdi/in31V34juvuV34l89dVg//+Ivb0i9dp3bjZSB0IbersOpxOu16XADDjzCEhCieaZqwphjaVeBIy4qdl5AcTre3WrTHq17S2wIrfVjSRM6TSK88fbtjSt+wnsKW4tuCcGxyP018UzeZnX7Zd1YXLba4P5IXx5ip2Didvs1hPGLfyDZ1H7OP7Uva8bDe5ELS6WzSZ53N3F7Ih+ozp+inSLcsbxLrcNyxPPXxFl3z6VwRqzJuVqavbRGok0l9+jalxuHTxHd1fXD7KHYSsY62H7bV2cf9+/ZE8TX65jfv6dqPZyw3YwrzfRXpXMRvvr1uvkjXO/Ktry+o7Y821HhjzRXxy1fUw4O/+d/0S9epIk7wbrxIAoKSw341WQac/n+uToxSXgSa5d61u0dfnxYJU5FTwhu5vaaEMEel1NYkoZQcVndwtEoUCevauSTjRItOG9rIaTLY+zH+BOG2nu9YXtNPI9/QC67yTHPf0QraxY3iaNqnYuPr5Gd07OkjR5rQ7mPH0Dcpm7qO2Yf6tS/GGPaN1nWP/qRTo7ORn2tsjuU2H4J7p+ynWLcsr491bENObmW0aCWZKSruWf+/SpncayZr65eYJr5rM+7U/K+3s90YKvad4rxPxdMfk5Tvq0jnIk7cenbAX6nf1sWbivr29Q13nH73G3X3xavqh63P+Zeu6X7Tj9t8OODCqm2W2L+7WEyf6V0FcMB3AKwemPfLwVRFnBhv6mL+8kDtvL7OfDFwu/EHvzxUP33xFf/W7cJzzLuI27/V8E5aJ6Y5GnJHT9IzwADfAbB6YN4vD1MXcQm7G4/psgsnzDGP+zvJPLBH0vZonP/LCZKxEfAdAKsH5v1yMJciDgAAAID5gyIOAAAA9BQUcQAAAKCnoIgDAAAAPQVFHAAAAOgpKOIAAABATwmK+LVr1wAAAADQE4Ii/sSTTz3W0IDPnj0LAAAAPBagiAMAAAA9BUUcAAAA6CVn1f9CBsguPwCdHgAAAABJRU5ErkJggg==" alt="8" tabindex="0" loading="lazy"><figcaption>8</figcaption></figure><p>解决方案：导入配置文件处理器</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：这里必须使用**@Component<strong>把它加入到容器中，就像</strong>@Repository**一样才能使用</p><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;张三&#39;<span class="token punctuation">,</span> age=<span class="token number">18</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k1=<span class="token number">12</span><span class="token punctuation">,</span> k2=<span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>lisi<span class="token punctuation">,</span> zhaoliu<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;小狗&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="单元测试" tabindex="-1"><a class="header-anchor" href="#单元测试" aria-hidden="true">#</a> 单元测试</h2><p>注：测试类和主类要包名要统一才能启动</p><figure><img src="/assets/9-73c8ea91.png" alt="9" tabindex="0" loading="lazy"><figcaption>9</figcaption></figure><p><strong>使用SSM和使用SpringBoot的Test功能的对比</strong></p><h3 id="ssm" tabindex="-1"><a class="header-anchor" href="#ssm" aria-hidden="true">#</a> SSM</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//@RunWith 指定用哪种驱动进行单元测试，默认是junit</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:applicationContext.xml&quot;</span><span class="token punctuation">)</span> <span class="token comment">//指定配置文件</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringTest</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookServlet</span> bookServlet<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bookServlet<span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot" aria-hidden="true">#</a> SpringBoot</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot02ApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果要使用RunWith需要进入Maven删除exclusions</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就可以使用Runnwith测试啦：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot02ApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configurationproperties-value" tabindex="-1"><a class="header-anchor" href="#configurationproperties-value" aria-hidden="true">#</a> @ConfigurationProperties&amp;@Value</h2><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定（松散语法“-”）</td><td>支持</td><td>不支持</td></tr><tr><td>SpEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table><p><strong>@Value</strong>测试的实体类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token comment">//@ConfigurationProperties(prefix = &quot;person&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;zhiyu&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{2*10}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isBoss<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;zhiyu&#39;<span class="token punctuation">,</span> age=<span class="token number">20</span><span class="token punctuation">,</span> isBoss=<span class="token boolean">true</span><span class="token punctuation">,</span> birthday=<span class="token null keyword">null</span><span class="token punctuation">,</span> map=<span class="token null keyword">null</span><span class="token punctuation">,</span> list=<span class="token null keyword">null</span><span class="token punctuation">,</span> dog=<span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="propertysource-importresource" tabindex="-1"><a class="header-anchor" href="#propertysource-importresource" aria-hidden="true">#</a> @PropertySource&amp;@ImportResource</h2><p><strong>@PropertySource</strong>：加载指定的配置文件</p><p>**注：<strong>加载配置文件时需要配置</strong>@ConfigurationProperties(prefix = &quot;&quot;)**使用</p><p>使用案例：</p><p>YAML文件中只有端口：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在类路径下创建一个配置文件：person.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">person.lastName</span><span class="token punctuation">=</span><span class="token value attr-value">李四</span>
<span class="token key attr-name">person.age</span><span class="token punctuation">=</span><span class="token value attr-value">18</span>
<span class="token key attr-name">person.isBoss</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">person.birthday</span><span class="token punctuation">=</span><span class="token value attr-value">2020/2/2</span>
<span class="token key attr-name">person.map.k1</span><span class="token punctuation">=</span><span class="token value attr-value">12</span>
<span class="token key attr-name">person.map.k2</span><span class="token punctuation">=</span><span class="token value attr-value">13</span>
<span class="token key attr-name">person.list</span><span class="token punctuation">=</span><span class="token value attr-value">a,b</span>
<span class="token key attr-name">person.dog.name</span><span class="token punctuation">=</span><span class="token value attr-value">小狗</span>
<span class="token key attr-name">person.dog.age</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实体类中使用即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:person.properties&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;李四&#39;<span class="token punctuation">,</span> age=<span class="token number">18</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k2=<span class="token number">13</span><span class="token punctuation">,</span> k1=<span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;小狗&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>@ImportResource</strong> 导入自定义的Spring文件</p><p>创建一个配置文件导入一个自定义的bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个spring配置文件：beans.xml，加入这个类</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.zhiyucs.servcie.HelloService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>helloService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在入口加入这个注解导入这个spring文件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:beans.xml&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot02Application</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">ApplicationContext</span> ioc<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">containServiceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> b <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span><span class="token string">&quot;helloService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 结果：true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然这是不推荐的，SpringBoot推荐的方式如下：</p><h3 id="【推荐】自己创建个配置类" tabindex="-1"><a class="header-anchor" href="#【推荐】自己创建个配置类" aria-hidden="true">#</a> 【推荐】自己创建个配置类</h3><p>使用**@Configuration**指定这是一个配置类</p><p>使用**@Bean**把这个返回值加入到容器中，ID就是这个方法的方法名。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HelloService</span> <span class="token function">helloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HelloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置文件的占位符" tabindex="-1"><a class="header-anchor" href="#配置文件的占位符" aria-hidden="true">#</a> 配置文件的占位符</h3><p>在配置文件可以使用${} 取值random</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">person.lastName</span><span class="token punctuation">=</span><span class="token value attr-value">${random.uuid}</span>
<span class="token key attr-name">person.age</span><span class="token punctuation">=</span><span class="token value attr-value">${random.int}</span>
<span class="token key attr-name">person.isBoss</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">person.birthday</span><span class="token punctuation">=</span><span class="token value attr-value">2020/2/2</span>
<span class="token key attr-name">person.map.k1</span><span class="token punctuation">=</span><span class="token value attr-value">12</span>
<span class="token key attr-name">person.map.k2</span><span class="token punctuation">=</span><span class="token value attr-value">13</span>
<span class="token key attr-name">person.list</span><span class="token punctuation">=</span><span class="token value attr-value">a,b</span>
<span class="token key attr-name">person.dog.name</span><span class="token punctuation">=</span><span class="token value attr-value">${person.last-name}_dog</span>
<span class="token key attr-name">person.dog.age</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;20b50b74<span class="token number">-4721</span>-4d80-a786-f0e726b195f3&#39;<span class="token punctuation">,</span> age=<span class="token number">-790018533</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k2=<span class="token number">13</span><span class="token punctuation">,</span> k1=<span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;6a1ab7a2-c65c-4df5-be46-3614ef009efd_dog&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="多profile支持" tabindex="-1"><a class="header-anchor" href="#多profile支持" aria-hidden="true">#</a> 多Profile支持</h3><p>在编写配置文件的时候，文件名可以是，application-{profile}.yml/properties</p><p>两种激活方式：创建两个环境 -- 开发/生产</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARUAAAB6CAYAAACRO8fZAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA4ySURBVHhe7Z1tjxxHEcf5NnwHizt794wdnyG2c7EtIkUJgiQ+3QUEQQiScHdOQBFR7CjsEiFLyEjozkiWJV6fPwmfZujqnpqpqal5vL7dmdn/i592+6m6e7z1v+6Z6fIPfnR1lgAAQCzWJipfLZ4VOP7rt8k77//SrAsAGA+dReXJ06fJq1evKqFyq51Giwrz/qNDsz4AYBx0FpU79/aSly9fmoJC+VRutdNYgtIGyxYAYDj02v4cnTw2RYXyrfoWlmC0Qdu5sn2YLM6Wyf79E/d5npwvw0rnyvbDZH95lrx+/dpz6vL3tq/l7Q6Wyen5uS87PztLjg5EWantSdb2iu9nmRzdL9Y/cvUXzkb78QibFxgrAEOjl6jcuLWbvHjxn4KgUJryrfoWlmC0QdvxTuwcLjjbw8wZ95eUFxw3OK10cGpDIvDQp/cOTpLTtK5su++EI2vLtpxYnLq2JVFxApKJSs142OaRS5N4yLI+YwVgaPS+UfubT35XEBVKW/WqsASjDdoOOzE5dJZnOb7Is8qtelme6KOtqDSNp65M5tW1BWCI9BaVq/PryfPnz72g0CelrXpVWIIhsdpY8F/yglO67cK5yztdLpNFhksLZ+ftxqlbUSyO3XYjbR/auu2LWAmwaJweP2wpKtZ4ijaLZf3GCsAQ6S0qxC8++NCLCn1a5XVYQiKhOv/7946JtFPrxPfd9kNRbOvy3HZi4ZyVnX49otJvrLIcgKFwIVHZujZPPvv8T/7TKq/DEhKJ1cbCdOKKLYP8Cy+/BxupKJii0VDu82pEpWI8dWVtxsp5AAyJC4nKRbCEREJ1rFUKIe1YTkzIG6OU3js2ViNc5tLSsfVNVX0jlVYldCM13Lg99E9+aHtSJSqWTetGbZ+xAjA0Bi0qbfBOrB7xhvzwmDZ/FJs7JrF33O+Rsi93qwt6XJy3DfUzUakZj2XzImMFYGisTVTaYK1SCKsuAGAYDFpUAADjAysVAEBUsFIBAEQFogIAiApEBQAQFYgKACAqEBUAQFQgKgCAqIxeVPSbuEOOdRvenC2+LQvA1JicqDCxY93SGRz9un4Tug0fPKTTzrouAFNhsqLShGWrDn+wLz1UaJVb9GkDwNiBqAj8ysI4uCcP9FGgJD5dTNsZPqFMgZYWbgVCJ4zDZ7lNOGwYDh5y+7qDiwCMEYhKCocsWBixYMn5KeRACE/gvqeOXw6REATCB3My2oQ+8lgodeEQABgrEJWUukBKvlxtZaz6LBp8z6TURohKU38AjBWIiiBbadAWRcWCLQkEpVVYR7/aSMNOmm2kqBjtAZgCEBVF2LaUY8FCVABoB0RFUFiZqPsfJYHA9gcAE4hKSrZySJ1cx4LlcikCdTdqrTZaqHCjFkwRiIqgbdxa678y1Y+UrTZeVPBIGUyc0YsKAGBYQFQAAFGBqAAAogJRAQBEBaICAIgKRAUAEBWICgAgKhAVAEBUICoAgKiMXlT0m7JDjlHbhH6NH4AxMjlRYfrEqKWzOut8Vb6rqKx7vABYTFZUmrBs+QOA4lTxqukjKuscLwAWEJWUuji0xUN/h5kThwOCdLKZ4q/wQcRw0rlgL7PF9emzfHBRiwr13SUGbtN4fTmtbtJ2+tAkADGAqKSQM9bFoaV0cFiXliLhHLQQvsCJBQnAKUWOozY+bkoQiqy+CKng+0zTWlTqQiv0Hy+dkg6nqGUcXkoDEAOIikBvJ8xATCJPi0BmQ0R0Y6EJQhDqc7wVhh1f2usVBKppvEY5ALGBqAhKTuoFgrYWy2SR4dLs+Olf/oITaxslUSk7NW1pqM1bWwe5qChx0rZ8uuN4qU622qG4LioOLwAxgKgIbCeleyBue6Hw5YMUlerxSjtWHF4AYgBREZSctGK7wH/d+4lKLgrMZW5/CLkakd9lf5wHwEWBqAj4L710SnmzlNJ+VZH+de8rKjFu1GZ9dRlvWj8rc2ncYwGxgagIpOPmT0xCXv4YNndKLwIurUWl8J+yk6i49vQYOBOhA2qX2+P2wR49ncnbZuNx7Zpi4Mo8a7xEXRxeAGIwelEZE5moYGUAJgxEZYVAVMAmAFFZIWErlN/vAGCKQFQAAFGBqAAAogJRAQBEBaICAIgKRAUAEBWICgAgKhsnKrc+svMvm/COSnqux7/1WnzTNRaXaTs28ppY5WCcbJSo3Hh3njz4bieZ3Z2b5ZdJQVT8wb/ywcI+lI4FRLR92UBUpslGiMr2ziy5/fE8efi3Hcc82X20XlGxyvuiDzCOCYjKNJmkqGzfmCVXd2fJ9QezZNeJydtfk6DkvPl7W1TCG6/2AT7vAE3xZZvKUwcKde2Dg4R1INEakxWntpttY8xpH1SuoX51+Enuj44e5PY6xOyFqEyOSYjK1rVZcvO9WXLvxInGd0UBkTz4llYqO8m9x7ao1IUaYAfgMAVU3wpb0FSeiYpwJt3vkUuz49WPiYIthZUKx6ltss3pvC4JhRtjFrc2HzOlJWaMF7FSyq6B6I/CPpC9upi9EJVpMXpR2ZrNkjt/tERkJ5nfsdtcu10WFdNh0h+9FBV9r8I7Ka8QWpRrZ7L6ZZrG5NPCqWV5le2qceTlQQhkni6Tc6T5ZWOx7HmRcquVbHy5Das+GD+jF5U3PrAEZZ7c+dRte372bvLsxX9LUL62o3/8Pq/kAGXn90GQnFOHUJBN5WVntvplmsaU1akSlR5z4vIqR5f96famvdL4ICpTZ/Si8tZfbFGZ35slXzxZehH585O/+7r0SWnK13b6OCCxcaIi2th9Q1Q2ndGLSrhPUhSUu5/nq5TffnqS3Lz9pq9Ln5S2Viubu/3R5fWiQoQtz6H/lPVMexCVjWP8K5Uvi4JC7Ozlq5Qfv3E7+fr7f/q69EnpqtWKFwDnAGO5UUvlvBrhPptsc5qcPNRVIpA6fRgnjYWeJBWF0osVPW0qrYIMexCVjWP0onL9nZl/4kMrlrtHO8mtR7Nka34tE5Ubuz9JvvnHv/x3+qR0lahIpyUxKD1SJoepiy/bVJ4+6pXfdb9eMNQj5aoxlcp5RdTaNtVVMXZd/SAkYZwsAFye1XH51F8x37DnRMV6RJ5dUzFWMA1GLyrE1ZvhKdDWPIjMrY/E9uezx8mtn95NPvzVJ/6T0pRv3aytwzuA+ivcpXxKhLlihQFsJiEqxNbOzN+cnb8999C7K7xa+fLp98mv/3DkP6tWKU1AVHL0lgYAyWRExYJXK5quqxQiLNvDvYk+5VOB5rl/7LY46j4LAMykRQUAsHogKgCAqEBUAABRGbyoJMc/BGAQWL9PUAaiAkBLrN8nKDMaUbHKAFgF+A12Y+NEBTFqLwd6/V+/eTtE+ry4B1HpxkaJCmLUXh4QFcBshKggRu3lA1EBzCRFBTFq29o2xpz2QeVVWGOSolLuM4SSpDIauxxDqB/GbB1x8PWVaMr6+RwuLy4uRKUbkxAVxKilcvfdOV6TbU7ndclp3RhbxKhl6sYky0MfaZ/s1FaMl5rVVlP97LqL8fgT1DSvSHFxISrdGL2oIEZt0SGbbFeNIy8PThnaO0E4OExJRavpOlnlIo/ty+tE10hfN6apvjkHL4xutZJdk9yGVb8JiEo3Ri8qiFFbIyo95sTlvr0Tg8VymZKuDCrGy44eymmLw+0IlxaOzNfE26u4rhI5R13fnEPpmkBUVsnoRQUxarUD1dvuIiqcJ6kab1FUXDltxxSZDdGvHr9FXX1zDqU6EJVVMnpRQYxay8mqbZfHocsbRKXpOlXMZ0+lWYT4U5ZZhHrriYsLUenG+FcqiFHrVwbcZ5NtTpPDhbrKIVMHrHO6pjHJckr71ZpeMXnHp22RsZJy9oYUFxei0o3Riwpi1IpyXhG1tk11VUxZVz84dZ6naTsmfpzLj3iLNij+Ld17Kce5ZQEo5gdhoDkW8405OFGxHstn/47i+rQBotKN0YsKgRi10ydc324rjFhAVLoxCVEhEKN22ugtzSqBqHRjMqJiwasVTddVChGW0Pl9gq7loD9+O7XGuLgQlW5MWlQAiAF+g92AqADQAH6D3YCoANAAfoPdgKgA0AB+g92AqADQAH6D3YCoANAAfoPd2DhRQYzazeOiL85BVLqxUaKCGLWbCURltWyEqCBG7WYDUVktkxQVxKhta9sYc9oHlVu0mqcvDzFj+QBg3Tg0NL91x6WVQFS6MQlRQYxaKnffnRM22eZ0Xpcc2I2xZYzatvMMQhPGRHXqxiHtE2bMlnSeco7Snj/BTHOJFJdWAlHpxuhFBTFqc2eT5VW2q8aRlwcHDe2d8+sYtap/xppnZrNhHJyXl4UxyD7IfjZnqw8vbG61kl2H3EZdX22AqHRj9KKCGLU1otJjTlzu2zsxKMWo7XEd2sxDI+el+zTHXboOep4QlYvA16AKWXf0ooIYtdqZ6m03zYnLqxywz3VoMw+N7Meeo9FHoY6eJ0TlIvA1qELWHb2oIEZtjag0bDvCd13eRlSa5qlsNoyD8zRhy7OeuLSSpt/gJsDXoApZd/wrFcSo9asA7rPJNqfJ+UJd5ZypM1Y5YLt5Fm0S9eOgOdMTq6JQeTE6O3OCpFc5xrghKoNh9KKCGLWinFcKrW1TXRXf1dWvi1Hbbp5FmyG/fhwsALoN5dO8ivnGuJ2o6Ot2kbi0EohKN0YvKgRi1K6OVc4z9NV/hRELiEo3JiEqBGLUroaViora0qwLiEo3JiMqFrxa0XRdpRBhOR3uCfQpnwqrmif1s864tBKISjcmLSoAxAC/wW6MRlQAWDfW7xOUgagA0BLr9wnKDF5UAADjAqICAIjKJEXl5/sf+8+vFs9K6LoAgLhMTlRIUFg8tKBwPhgW/vEx4upOhFnyf7LT/Hl6d4tDAAAAAElFTkSuQmCC" alt="10" tabindex="0" loading="lazy"><figcaption>10</figcaption></figure><p>application中写激活哪个：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他就写生产/开发环境的配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以直接都写在一个配置中</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
    
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> pro
  
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还可以使用命令行的方式更换环境</p><p>java -jar 包名 --spring.profiles.active=dev/pro</p><p>还可以使用IDEA的虚拟环境激活</p><figure><img src="/assets/11-5337b8aa.png" alt="11" tabindex="0" loading="lazy"><figcaption>11</figcaption></figure><h2 id="加载配置文件的位置和优先级" tabindex="-1"><a class="header-anchor" href="#加载配置文件的位置和优先级" aria-hidden="true">#</a> 加载配置文件的位置和优先级</h2><p>测试<strong>类路径下</strong>（port:8080）和<strong>类路径的config</strong>文件夹下（port:8081）：</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASEAAAB8CAYAAAAmegaGAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA5JSURBVHhe7Z3fbtzGFYfzNnmGCJX/FkXaIihqxRZgBLbipo0WUooUtZAAdSUnN0UCJLnQAgaMBL4opDQxjF4GkG+Sx+jTsHNmOOTh4eHfJWdI7u/iA5ec4eGswfk8Q+4cvfH7v/43AQCAWLzxq+s3EwAAiAUkBACICiQEAIgKJAQAiMrkJPSv8+cFzr74Jrl/8IFaFwAwfwaT0Fdff528evWqEirXzpNICXkODo/V+gCAeTOYhP7wx73k5cuXqoDoOJVr50k0AbVBiwUAmD6DTsdOn36mSoiOa/U1NMG0QcbZuXacnF+uk9Xdp2Z7lVyt3Uhq59p+slpfJq9fv7ZcmON7127k5x2tk4urK1t2dXmZnB6xstK5T7Nzd+x11snp3WL9U1P/3MRo3x4Wc4O2AjAXBpXQb377u+T77/9TEBDt03GtvoYmmDbIOLbTmw7qOud+1nlXazrmOrrr5FwIdA5JY9/u7x09TS7SuvzclRFNdq6PZeRyYc4tScgIJ5NQTXt8zFOzT7LhZX3aCsBcGPzB9N/+/rggIdrX6lWhCaYNMo7v9CSA7JgmCnZMK9fqZcfYNdpKqKk9dWX8WN25AMyJwSV0/davkxcvXlgB0Zb2tXpVaILhaOdo+JFCoROb6cuVOXaxXifnGWafycFPfy7MiOX8zEx/0vPduWY6xUYaXjIXZ/stJaS1pxizWNavrQDMicElRPzpz3+xEqKtVl6HJh4O1fnfv2+r8Di1nf6umQ4JiueaY2Z6c246t5dEHAn1aysvB2DqjCKh3Ru3kn88+afdauV1aOLhaOdoqJ2+YgrDRxD8s4uRSkSVTEO5PVYjoYr21JW1aas/BsAcGEVCm6CJh0N1tFEQweNonZ7gD4Jpf+9MGe34MrPPRSAfIssHxzTqoQfH7kH1sX0zRtOlKglpMbUH033aCsBcmKWE2mA7vXhl7o671975q+28IxN7Z/1e0dtyM3qh1+/5ua5+JqGa9mgxN2krAHNhchJqgzYKIrS6AIBpM0sJAQCWA0ZCAICoYCQEAIgKJAQAiMroEkrO3gRg1mj3NRgOSAiABrT7GgxHMAlpZQBMGdy7YYCEJsIOrQtjP3wE8cG9G4bFSkj+0nqquartUo30V9YXV+vkcPdesloXfxkN4gAJhWFyEtq2XNVyJb1f9Eor82VdEBZIKAyTk9C25aq2EkoXwWrlIB6QUBgmOR2bUq5qos0iU73MLVpd3aVtutD0ihKQpSlZ2QJUSkxGq+fdOW7Rq4/vV+Pbc/2iWIyURgcSCsMkJTSlXNVE23QbTkhun0Tk03eQYGhFPdWnlBskE1pNT/Xtvj3fPZh25+R5gcrxnZAwXRsfSCgMk30wPZlc1R0Tj3GJSKG4cvcgOhvpiOlY4fya+JDQ+EBCYZishMbOVV2FjCMfHDeVecnYlK9WGFIiHSTUEN8fA+MACYVhshIixsxVXYWMAwltL5BQGCYtoTFzVVch42w+HdtAQlp8ewwSCgEkFIZJS2gTNMG0QYu16YPpvhLK45vRkP1LG8fmXDyYDgUkFAZISKDFcnLp/4q+JCF6xc4kVD6n+Iqe4ttX+DYWpmOhgITCsFgJLYXy3xkrjpTAeODeDQMkNGGy5z/0Z4Sy6Vg+3dPOAcOBezcMkNDE8X+/zE3H6JfS7u+aaXXBsODeDQMkBEAFuHfDAAkBUAHu3TBAQgBUgHs3DJAQABXg3g0DJARABbh3wwAJ9eD91Ud22/bHjmCeQEJhgIQ6QgLyspEC8sdjwH/E6H5lTUs9hn+VP2bsodn0h52QUBggoQ54AXnZcPnw4zEoSGjARa6lZSUzWkALCc0DSKglXEBeNnyfH4/BWMs55ALbOQEJzQNIaAO6SsgvXqWFrj7X9N6Z29oOI/NRX14mp2kHalWedjhXt7wIVl9kW92mtjmwmxbwVuXYltB1L4Tw/PVoEXAe72kez+7fKLY1zXBg60NCkwcSaokmHA3tXE9dvmjfYXz+aapfzEfdrjyTEOt83VKR8DYZEaUjofY5sN1+XtctN9FybNM+R82fxEZi2b8Bu55dS0fXSJez+Omi9u/QFUgoDJBQSzThaGjnEmoHSzsJl5B81mI7tR+BtCiXnU+7rqepTXafSYCXV8Wuakde7sTBj8ky/h3p+2Vt0eJZqZnRUNa+PIZWvwuQUBggoUDIzmKPlTpMWRY0RSEJ3Nk9alFe7vzadT1NbcrqVEmox3fy5VVi4NeT56vxSu2DhOYGJNTALyef94bH6dNhia2TEDtHvzYktDQgoQY+eefd5NmDQyuVZw8+TD41+3s7u8l3j47dsYeHyZ23du1nv/XwONs7HZPl9RIi3BTs2G55PTUeJDR7IKEGfvr4SfLo1tvJj6vHdkv7JJv3rt+2Irq/e7OVhAgrDNNh5vJgmsr9aMdfsym23ycpuLpCGqkkXDupLfSmrShWKzd6G1caZSnxIKHZAwk1QDJ5fnCU3Nu5lnxrtl429JlGRLRtKyHeyUkepVf01MGOzNZ0IlvnUnb+hvL01Tn/LK9rBSNe0Ve1qVTuR1ytY1Pd6hzbVO6F4cuzOuY4Xa94XIlnJKT95CD7N2Vt7QokFAZIqAGSyc8nnxUE4z//sDop7DdJqA7bYcT/8l3Kl4T7rv1HMEMBCYUBEmqAZFIlIblPW8+X+w/VeFVAQjlyihULSCgMkFADXDZd0eJV4aYR7tlKn/KlQN9zdWamXOI5UQwgoTBAQgBUgHs3DJAQABXg3g0DJARABbh3wwAJAVAB7t0wBJMQAHNFu6/BcEBCADSg3ddgOEaXUCxkio2zL75J7h98oNaNjX0tPZO8zQAMzdZIyHNwWFwKsCly2UAbSksN7ELQ8vIFALaBrZNQE1qsOvr8uncqvwgGYApAQgItlh25mJGKXcR5SYtInTy0HMy2frqI0tYXi0I3zdsMwNKAhAQyjl+z5dNN7B1RmgknBZKFzMFMdepTdpTPkQs261JvALA0ICGBjFOXFMyWi6nVGInCAFgykJBAi5WNZGjKRH/VgQtGCoX2B06ZCsCSgYQEWizCTaPo711dFiQBCQGwGZCQQItVGPmI5zcloWA6BkAnICGBjJONTFIp0ENlLglfzqUxdN5mPJgGSwYSEmix+Gt1/oqe4JLxOZELx4ywhszbDMDSWKyEAADzABICAEQFEgIARAUSAgBEBRICAEQFEgIARAUSAgBEBRICAEQFEgIARGWxEpK/hJ5yjukm5LIOAJbE1kjI0yfHNK31irl0oquEYrcXgC5snYSa0GLZBads1Xto+kgoZnsB6AIkJJBx6vJIFxeZHmed3i1IpZX3lH/IL3x1K/EL8bJYvj5tywtlpYTo2l1yWDe115bT6Ck9Ty7SBWBMICGBjEOdty6PNO27Dm72uVRMhy6k4zByIWFcUGZGOsfmDXJiyeqzFCH2mum+lFBdqpD+7aVV/G6VP8+jTfsAjAkkJNBiyemNmriMHZPSyGKwjIleTE4crr7PN+TxouDxeiVNa2qvUg5AKCAhgRar1KmtUGiqs07OM8y+F0U6sih0ehmjJKGyBGiKRefc2T3KJSRkJmPZ/Y7tpTrZaIryGok82gCMCSQk0GLpnZqe4ZjpjsCWT1JC1e3lcbQ82gCMCSQk0GKVOnXF9MWPHvpJKJeIZ8zpGMFHO/wzv54/BsBYQEICLZYfSfBOzB8O074dtaSjh74SGuLBdHatLu1N62dlZh/PiEAoICGBFot39PyNkjuWv9bOO7GVhtmXEuI/ILQSMufTa/VMWkd0Xh7Pn+/i0dur/NysPea8phzW/JjWXqIujzYAY7JYCc2JTEIYeYAtBBKaAJAQ2GYgoQngpmb58xoAtglICAAQFUgIABAVSAgAEBVICAAQFUgIABCVaBJKzt4EYFZo9zHYHEgIgJZo9zHYnOgS0sqG5v3VR4VlGXyZBj8eA/dDRb44tbyQtQ+lZSIDxh4b/m+ilYcGEhqXxUuIC8jLhu/z4zEYq8PJBbNzAhLaLrZiJCTpKiG/2FRbMGo7TFN+6KbytMO5uvpCVUJbAKu1Scsz3S220ub0GlQuoevKdLD+erQUJY/XIec2JLQ1LF5CmnA0tHM9dakzfIfxaTeovpaGo6k8kxDrfPK6p2bfd9T6NlFyMjcS8nmmm2L7/bwuicW0Mcs7nbeZ9jlqjiM2Esv+Ddj1KI0JxavLuQ0JbQeQUIp2LqF2sLSTcAnJZy22U/sRSIty2fm063qa2mT3mQR4eVXsqnbk5U4c/Jgs49+Rvl/WFi2elZoZDWXty2No9WMCCY3LVk7HuiA7iz1W6jBlWdikYUYCLjVrU3m582vX9TS1KatTJaEe38mXV4mBX0+er8YrtQ8S2lYWK6FfTj7vDY/Tp8MSWychdo5+bUgI6CxWQp+8827y7MGhlcqzBx8mn5r9vZ3d5LtHx+7Yw8Pkzlu79rPfenic7Z2OyfJ6CRFuCnZst7yeGg8SAimLldBPHz9JHt16O/lx9dhuaZ9k897121ZE93dvtpIQYYVhOsxcHkxTuR/t+Gs2xfb7JAVXV0gjlYRrJ7WF3rQVxWrlRm/jSqMsJR4kBFIWPR17fnCU3Nu5lnxrtl429JlGRLRtKyHeyUkepVf01MHq8kM3laevzvlneV0rGPGKvqpNpXI/4modm+qKHNmmvhOPa6cXhi/P6pjjdL3icSWekZD2k4Ps35S1NTaQ0LgsWkI/n3xWEIz//MPqpLDfJKE6bIcR/8t3KV8S7rtOZwQzFJDQuGylhOQ+bT1f7j9U41UBCeXIKdZSgITGZdES6osWrwo3jXDPVvqULwX6nqszM+USz4mWACQ0LtElBMBc0O5jsDmQEAAt0e5jsDnRJAQAAAQkBACICiQEAIjIzeT/9Qg6EgTL18kAAAAASUVORK5CYII=" alt="12" tabindex="0" loading="lazy"><figcaption>12</figcaption></figure><figure><img src="/assets/12.1-37b3d218.png" alt="12.1" tabindex="0" loading="lazy"><figcaption>12.1</figcaption></figure><p>前两个同时存在，再把一个端口为8083的文件放在<strong>根目录下</strong>：</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAABiCAYAAAA7mr2EAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAuXSURBVHhe7Z3vbxTHGcf5A+jfEfqmKq9KUTAmQJsY1Q6cHRcIJqkTEdtHioNBakh8RhW1+sKhyV0LQWpxavk4BSGl7bvlj5vOM7PP7tzcs3d7d3vLrO/74qO9nR/PrtF8PLNza55jb589p0Jgt/lsJPw4p2fqarsdqcPGcnLebLfU9tJs2majpQ5bO6o2Y8tOzyyr7VZbNeM+3G+73dbt6kkZl/fE4/4baRkAEsEIB8A0AOEAKBEIB0CJQDgASgTCAVAiEA6AEoFwAJQIhAOgRCAcACUSjHD+GySNvz5W1z76RGwLQFUZW7hvHj9W85eviHXD4AvHfPRZ96tVAFSZsYV79eqVevnypWrsPFQX350T2+RBki0PUiwAQqUQ4ZgXLzpq84u76uw7F8S2/ZBkyoMUy7ycHEXq9evXKmq31Xb8UjG/eLy2tKOPkYriF5Pp5eO1Vtu0J9wXmwEokkKFY54/f65WP70lts9CkikPfhwjVURv7ts3/2sbO+qwbQWydVo0I+FyItVai8p2tIjUht78j3r+SgCAIpiIcMyDr74W+0hIMuXBj3Naz16HWjj3z2eSulg4989o+rUHoGiO3AxH8PLwUM9kzUZd1WKZePbz/zYuivQyE0tIUAJH8hmOoKUhLSebWjoWCsKBN00hwoW2S8kzGuEuI0XhsKQEJTK2cJP+Hm4QfpxkxooFqpkdSyuUJByBTRNQFmMLVxSSTHmQYtUa/b8W8IXD1wKgLIIRDoBpAMIBUCIQDoASgXAAlAiEA6BEji1cOqcAAOUA4QAoEQgHQIlAOABKJBjh/nP9F10cXj2p7l3+tdgWgKoytnDN7x6rletXxLph8IVjtq+cEtv3Y36zpTpPdtTq3KxYXxah3AcIh7GF478W2H30UH1QmxPb5EGSLQ9SLBroUScM4UK4DxAOhQjHdDod9eBPd9WV+Qti235IMuXBj7P6SM8q8YvLnU5bzzB1Uz4/t6x2n9gXlKOorZ4+WtZt7XF+rq6edlpq6+aOPkYqyuqzuay29Dn14Xo655ee6VosV9Z9gOmmUOGYH/afqzu3b4nts5BkyoMfhyRYjWeWrZv6cyzA1hMtkimb7RKlw8JpOSItxq6WKk8ft57a2/puWaX7ANPNRIRj/vzwa7GPhCRTHqRY/lJuXs9cHT1D7WpxkjaxZK5wTzed+kF9pHqvDEtK4HPkZjiiRzg6j/SS0Rn4NAPt6uVjKpwnz6A+pp6Wii31NEGfO+JCOOBz5J7hiPKEo+c+vVz06IoB4YBDIcKFvkuZb0nZf3mYlsV9hHpi1ZcWwgGHsYWb9Pdwg5Bi8ezjyjB406RXHtuHZ7G6nt3kTROKSee06+nOitJ9gOlmbOGKQpIpD1IsVyh31zAp03JJXwv4YnAfs61v6tMlZVe9nvVMXCNnGkO6DzDdBCNciLjPYwQvQ93dTACGAcJlkDyv0ZfZyZIy/d5N6gPAICBcH+ZJsmRJScvP9E0SAEYBwgFQIhAOgBLBfyIEQIlAOABKBMIBUCJBC/fx2m1zzJvEA4DQCVY4ko3F8mXj8iKwmXPS9FbD1gMwDEEKx7KxWK5obnkR2ISMkTps2CT8lF/OTVfl1wMwDsEJ58rGYrnnbvkkMAkd28gPByZDJTZNxhXOZjVNX1xubtgEjE09a9kkjVQ225XIkRLyUxZUtz5fLFp+0jF+oZnaOLNjv+SPaX/KTR6pKM7C2tunjl8IFSU44SS5JKS+WfgphXnw0jLRDHItmc0BTon47Qy3tqQ/60Ht1ueLpUU1WVetZCaeLuOsq7397bl7LZu11V7f7WPbxH2QErmSHHnhpKT5PLB94Uydt6R064eNZev1jKhnq0H9Tb3UX+ojlIFqUAnh/vLt9+rT25vq0kJNnX3nonrvd++LfSWSJPuxQKYslmBo4XLF8oVyhBulv+lDy9uWaiboc09MUA2CF45km19cVss3/mA+/+PfL82RzqX+PkdDON2Hlrge3AZUh+CF+2TjjpHr8bMDtXhtxcxwt+89UM9e/JRLuuwl2QjC5YrVRzipvxtf6i/0IWreOagGwQt36f2amdGWrt809b+/8bH6+w8/qvq9L025398McL3kot1DLrObDjxL1LUA8qaJ6R/PKDzA/frBsbKFS/v32zTplcvtQ+e1hv2/U9yZElSD4IU7e/6iEWz2/G8S2ehI5/TZ70+DlpdoaZndTTRb/VqWbS1L1zJOlyfCxW1JItoJzKrPjpXKyu3tL4De+EZU4WsBX7jkmlp8c19G+O42oBoEL9y7lxbMTEYzGstG7WjGk2Y4Cf95xwxsZ9YahiJjgekjeOFW1/9ontXomY2e3egZjp7l6Jku/zOcnoHoy+JkGZgu46Q+WRQZC0wnwQmXBclFM9qwu5TEaRIjWQbSmx+jv6lRZCwwfVRGOACOAhAOgBI59rOfzygAQDlAOABKBMIBUCJBC3fxww1z3P7m+x78tgBUgdzCqcZbALwxpDFZRSAcqATSmKwiQwsn1RUJLSP9paN77pa/CY6fWFe7UaR2V86I9aNyfKWpooOGOnmi2LhlMKl/EwLCCXWTZljhjp9YVPW9+AXkqK127y+qk/ft0QyOg6ZauEDH+GXgg7aqx4MlV308uGxbHTepW1QL8XWJ/b1UoH73dPJ+U+3rmKaPjre/tz5kbOGe42tQvQ9dd9+Tm69Xv8A/F8VrpPHM+Znue9X3mfSFcLkITjhJLgmpL7OwF5nZggaIO1D3WTg9OGhA0uCi9idpdonP89YnwjkDzb9uXZ/zoOx/T1q6eIZbuKA/axEGxebztC1JRL8YrGTuPdO5y3Et0r5X586wyb+Bc726Fo/i7d9ft21MDPnfoUggnFBXJJJcElJfQhxM8YBwhaPPbj8zgHlmyVHvDzTpusygezLnzoB367NiZ91HWm8lccv8OvdnpJ8vuRcpnhFYz3LJ/aUxpPZFAeGEupDwB4Yp6xkcvWLQMosG/C/fWstR3zvQpesyg+4paZMl3Ag/E9dnSeBez+8vxuu5Pwg3CsEI97/PH46MG2eUwUlMnXBOH/naEG4SBCPcnfcW1d7Vz4xAe1dvqTtz+jnl1Bn13YcbtuzaLTX/qzPmMx8ZN870Lin9+v7CEXYZuW6ObjsxHoQrhGCE+3H9K3Vj9rfqX6t3zZHOSazlt88b6ZZOn8slHGHk0IOjKpsmVM+zGF9zUGw+JwFsW0+QWAh7n3QvtOPZ/UvEiEy7oj2zpxAPwhVCUEvKv11fV5dPzahv9ZHFos8009Exr3DugCZRer4WoMG0oo96wJg2B/5AH1Afb9e7n/3rGpm8rwWy7qmnnmfS3LGpbXqP3N5KZu+T5eD6pI0up+t1lwvxtHDS1xzJv6lzr0UC4YS6IiBx/vv5TpdM/Pmfq1td54OE64cZHN5v72HqjxL2Z53MzFQUEE6oKwISJ0s4/5yOzE7tphgvCwiX4i8TQ2TqhQPgTSCNySoC4UAlkMZkFcktHABgfPCfCAFQIhAOgBKBcACUSNDCUYJ9Ovr//TnhtwWgCgQrHMnGYvmycbmEzVbTm4HG1C3tqGacrYbbpVlFme56MY7Q183JPSkobZWbFQhUjyCFY9lYLFc0t1yiXzYbNwMpt6OUU644qXB94gh9D0tI6gHhqk9wwrmysVjuuVsuMaxwWWmm8gjn1iUSTlAICFd9KrFpUgXhCJOptFXvKiNMe5NEUS9p9UxoXlCOkyrWGnp21LGojNJgpX1sIkfTNqIsPZSUEcJVneCEk+SSkPoSqQyUv81DFM5rEy8JhxXOCBJnQnXb2jrbntMGc1sS6TBOd8W55zimkddpz1lTIVy1ObLC0eCU8IXrqY9nmXzCpaKSECSQvMnSG8udbW2bVFgpkT7HgHDVphJLymHoK0rBS0pXVNpAycq7bdt7AtG9OJssXcJ5MjJYUlafYIQ72/xpZNw4ZQqX1dcHwgHLOfV/Ea1qakiWuHUAAAAASUVORK5CYII=" alt="13" tabindex="0" loading="lazy"><figcaption>13</figcaption></figure><figure><img src="/assets/13.1-45c6ff87.png" alt="13.1" tabindex="0" loading="lazy"><figcaption>13.1</figcaption></figure><p>前三个同时存在，把这个文件放到<strong>根目录下的config</strong>（端口为8084）：</p><figure><img src="/assets/14-5cbd554c.png" alt="14" tabindex="0" loading="lazy"><figcaption>14</figcaption></figure><figure><img src="/assets/14.1-ea6aefe8.png" alt="14.1" tabindex="0" loading="lazy"><figcaption>14.1</figcaption></figure><p><strong>小结</strong>:优先级由高到低 -file:./config &gt; -file:./ &gt; -classpath:/config/ &gt; -classpath:/ SpringBoot这四个位置的配置文件都会加载 并且会互补配置</p><p><strong>测试：使用最低级的配置文件配置路径</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/15-02e5534c.png" alt="15" tabindex="0" loading="lazy"><figcaption>15</figcaption></figure><figure><img src="/assets/16-4475f37a.png" alt="16" tabindex="0" loading="lazy"><figcaption>16</figcaption></figure><p><strong>运维配置</strong> 还可以使用命令行： java -jar 包名 --spring.config.location=指定配置文件绝对路径</p><h2 id="自动配置原理" tabindex="-1"><a class="header-anchor" href="#自动配置原理" aria-hidden="true">#</a> 自动配置原理</h2><p><a href="https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/common-application-properties.html#a-common-application-properties" target="_blank" rel="noopener noreferrer">在YML/Properties能配置的属性<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="自动配置原理-1" tabindex="-1"><a class="header-anchor" href="#自动配置原理-1" aria-hidden="true">#</a> 自动配置原理</h3><p>SpringBoot启动的时候加载主配置类**@SpringBootApplication**，开启了自动配置功能**@EnableAutoConfiguration**</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootAutoconfigApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="wiz://open_document?guid=62a96d1e-af78-4e7c-92d5-9a06b8beedf8&amp;kbguid=&amp;private_kbguid=51ed7a20-5f58-11ea-ac04-65f1a2b61811">@EnableAutoConfiguration的作用</a></p><h3 id="以httpencodingautoconfiguration为例解释自动配置原理" tabindex="-1"><a class="header-anchor" href="#以httpencodingautoconfiguration为例解释自动配置原理" aria-hidden="true">#</a> 以HttpEncodingAutoConfiguration为例解释自动配置原理</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">ConditionalOnWebApplication<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;server.servlet.encoding&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpEncodingAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>@Configuration</strong>：配置类（相当于配置文件）</p><p><strong>@EnableConfigurationProperties</strong>：启用<a href="wiz://open_document?guid=5294ee2c-1921-4f6e-a62d-cd516a7f3bb2&amp;kbguid=&amp;private_kbguid=51ed7a20-5f58-11ea-ac04-65f1a2b61811">ConfigurationProperties</a>（从配置文件中获取值和bean的属性进行绑定）功能（ServerProperties）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;server&quot;</span><span class="token punctuation">,</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerProperties</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Server HTTP port.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相当于把server的属性绑定到这个ServerProperties类中的属性（比如我们熟悉的port）</p><p><strong>@ConditionalOnWebApplication</strong>：根据不同的条件，如果满足指定的条件，整个配置类的配置才会生效</p><p><strong>@ConditionalOnClass</strong>：判断当前项目有无这个类（CharacterEncodingFilter）</p><p><strong>@ConditionalOnProperty</strong>：“判断文件是否存在这个配置</p><p><strong>@Bean</strong>给容器添加组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//和SpringBoot的值映射</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Encoding</span> properties<span class="token punctuation">;</span>
<span class="token comment">//只有一个有参构造器情况，参数从容器中拿</span>
<span class="token keyword">public</span> <span class="token class-name">HttpEncodingAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 给容器添加组件，这个组件从properties获取</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
<span class="token keyword">public</span> <span class="token class-name">CharacterEncodingFilter</span> <span class="token function">characterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CharacterEncodingFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderedCharacterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setForceRequestEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Encoding<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setForceResponseEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Encoding<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">RESPONSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这一系列下来相当于可以实现</p><p>这个方法在<strong>ServerProperties</strong>中，而自动配置实现了**@EnableConfigurationProperties(ServerProperties.class)**</p><figure><img src="/assets/17-575a6391.png" alt="17" tabindex="0" loading="lazy"><figcaption>17</figcaption></figure><p>主配置文件就可以写</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQkAAABCCAYAAABEgCN/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAfuSURBVHhe7dz9UxNHHAZw/h9/cQ0EyGBAK0NAUAwERCgKyIuCAV9qGFpAqjOto2U6giDWYnUUZ2ztWNuOM+i01aJj4Y/69tlwgSPe3gWTYBKfHz4Dyd7tvWT32d1DU1TfGJbtqqjcF7dnz56N3x1V18rek2clODotwct35PLiz3L70VO5Mn9Phsem5PL0XPz119/NOu/vIRAckpnlJZmIVDmWpysQuSQPl5fl4eyQNEVaYUgmlpZleemSNAWzc0x6XyY+B6+2ku229LHF79vgLO7j9q8xuyGRpLnt83goJNPvO23vJRBslYnZS3Iqix9sQDfI2SV5uLRuZhINlQGx49L9HLzayk60pY9FX9sp697NDLY6buNmR0OCiPLPtkOituHwxs4MCaLCt62QCNUfkmDV5s4MCaLCV+T0ZqoYEkSFjyFBRK6KdEcnIjJJeyahfCV5LxKJyK5du4jIAUMCGBJEZgwJYEgQmTEkgCFBZMaQAIYEkdm2Q6I63CG9fX1xDAmiwvdeSATCfRLt65Bqw3+eSTUkdvvKpbLhmLR390qktsJxm1zBkCAycwyJ2LA5JOxMIbFblUpV+IS0huskFO5mSBDlsSL7rKG6HbOIWExGR0clOjyMGUXTe8FgZw4Jv5RVVIhPFUuwkSFBlM+KGvtiGzOHQLAOy4n1mURjCL97zCZSeSbBkCDKb0WBYJP0YvbQG14PhEwsN+wYEkT5DSFRJ8eGYxJtr4t3fIYEEdkxJIAhQWTG5QYwJIjMtjy41B0/HhKxPjkW+vCQ2K32SUPnSensgu5eOa5/QlNNueP2HxtDgshsy59ANb38aOwbjv8ZNPaBfwLNNwwJIjP+3w1gSBCZeYZEQP97iQ1blyAMCaLC5xoSiYeaeukRX34kPdBkSBAVPi43gCFBZMaQAIYEkVnaIVEIdEg4vU9EGfi27ELAkCAyY0gAQ4LIjCEBDAkiM4YEMCSIzBgSwJBIXbhFyWqXcizTvMop/2QtJAKHBmTy+pzcufujLHw/JacPBxy3ywUMidQxJD49WQkJ5Y/IVz/MyXj7ASkr8cuB45OysDAqR4pzs/G4hURxQMl0n5JXF5T8d17JkxNKwrbrUKVKxvDe8jklKyNKHrQpqfVtlrfi9ct2JcPHlfz9hZK/hpRcrFwvV/j5/KKSEf/m9sU1Sl5ju4ESa5s06k+Fvr5rvev7rpxVcv+okmpb/b4yJVf718/pzx6cK8rtIeBV7nV+Xtfndf+9yil92QmJQIMc7wlLlVr/sJTvqEzeuy79Vbn54ZlCQuH8h7qV/INO1Ilzb/wMDfKUkmcYLRPl3Z0oRyc5uQ+Ns1rJ7WElv4Q3r1N3khW8d+MwylHHOOpaHVRyEPvq/b+NKvmpfrO+DnSotzhmuVWeTv2JbUx0/Rew/a8dSrqs+hdR1wPUlSjvR6d7c1rJ6f1KWmqV3DmzGQJe5ZrX9btdny73uv/u5SHpGZuQiYkk0eb4/U2cI7nbkWcSqnpIbiyOS4s1OuYat5AYHUAnanI+b11+HY16Go0z8V4NGvgaGm2Z1Qh1J9GvK6zXKogRN4aR1boXEYy8bzECJ0LhGupbPGhtm4H6t6tFnw9Gff174vg3MbtJvO5CoNhDwq1cczs/r+vT5V733728RMorgxIMJqkoFZ91PuQt6yGhfFXSdWVBZkbqc/aDcVtu1Bxan0r/jtFuHqP8OYx2fus6dCOdQ9kalgyrNmtouPutbXQnSXS6+D6YCnc3KGlILCcwgr7AVFkvLxRGQ738iFrLj0zU72XfASV3sQRYwXHi9aMD20NAH/8qzjGxvf2Zg1e55nZ+qVyf2/1PpZzSl9WQUL5KaRubkYWrAxJKsdF+DG4hoRtyJdbQIxjhpjG1fokG+QANM1GmG/lsHRr9Xhusk4uthprcSZLpOvTsYR5T9foI1tUYRfda+2aifje6w86fU/IIx23CCK/r7k+aKWQ6JOxSuT69jen+e5VzuZEZWQsJ5a+Rnqk5WfhmQOpsD+ZykdtyoxznXmZ7kNaM6fgalgclKNPlerp8Cx3cvp9dKp34KLZ5jW3GsZ5O7gCZqF/zl2J0Tnqgp9Ahn2HmcMa6Pn28Ew7LibnQ5mun5YapXPMKCbfr0+Ve99+9nMuNTMjOg8vSeoleuyUzX3a81zBzkVtITGEq/hyNXj/Ya4Dp0xit0PAT5T2dSt5hmyjW1RFMdW/i96fNm9ecSif27Ued6Cx/YNlxAZ058X6m6lcYmR9jhF3FMSK2zqEwu7uNYy6hvjBG455GJXdwffYQSDyYHLQeTC5GUy/XvELC7fp0udf9dyunzMhOSBwYlBv378t97d49y7yct42SucRtueHHaHsDa2S97n13Xslv3Ura7B0ZI9k4GukLlL3B1H3pmJKDtpEtpU6Mxj49gs5lW4tvlGWifpzvLdT/CvXX2+rXxw2hYz9GeLxFWDxBhz16ZGsn95VjtMd6/1+UP8dSaChpOeFV7nV+Xtfndf+9yil9WX9wmQ/cQoLoU8eQAIYEkRlDAhgSRGYMCWBIEJkxJIAhQWTGkACGBJFZ2iHh9O3T+UaHhNO3BBMRv1I/jiFBZMaQAIYEkRlDAhgSRGYMCWBIEJkxJIAhQWTGkACGBJEZQwIYEkRmDAlgSBCZMSSAIUFkxpAAhgSRGUMCGBJEZgwJYEgQmTEkgCFBZMaQAIYEkRlDAhgSRCa75H9K5/0KBQApxQAAAABJRU5ErkJggg==" alt="18" tabindex="0" loading="lazy"><figcaption>18</figcaption></figure><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><p>SpringBoot 启动的时候加载主配置类，开启了自动配置功能 @EnableAutoConfiguration 。</p><p>@EnableAutoConfiguration 给容器导入META-INF/spring.factories 里定义的自动配置类。</p><p>筛选有效的自动配置类。</p><p>每一个自动配置类结合对应的 xxxProperties.java 读取配置文件进行自动配置功能 。</p><ul><li><code>xxxAutoConfiguration</code>：自动配置类给容器中添加组件。</li><li><code>xxxProperties</code>：封装配置文件中相关属性。</li></ul><h2 id="conditional相关注解和debug" tabindex="-1"><a class="header-anchor" href="#conditional相关注解和debug" aria-hidden="true">#</a> @Conditional相关注解和Debug</h2><p>@ConditionalOnBean:仅仅在当前上下文中存在某个对象时，才会实例化一个Bean @ConditionalOnClass:某个class位于类路径上才会实例化一个Bean @ConditionalOnExpression:当表达式为true的时候，才会实例化一个Bean @ConditionalOnMissingBean:仅仅在当前上下文中不存在某个对象时，才会实例化一个Bean @ConditionalOnMissingClass:某个class不位于类路径上才会实例化一个Bean @ConditionalOnNotWebApplication:不是web应用</p><p>开启SpringBoot debug查看使用了哪些配置类</p><figure><img src="/assets/19-d0194da3.png" alt="19" tabindex="0" loading="lazy"><figcaption>19</figcaption></figure><p>以及没有启动的</p><figure><img src="/assets/20-74d271ce.png" alt="20" tabindex="0" loading="lazy"><figcaption>20</figcaption></figure><h2 id="日志框架sl4j" tabindex="-1"><a class="header-anchor" href="#日志框架sl4j" aria-hidden="true">#</a> 日志框架SL4J</h2><p>SL4J的几种实现方式：</p><figure><img src="/assets/21-7a824891.png" alt="21" tabindex="0" loading="lazy"><figcaption>21</figcaption></figure><h3 id="其他日志框架转换为sl4j" tabindex="-1"><a class="header-anchor" href="#其他日志框架转换为sl4j" aria-hidden="true">#</a> 其他日志框架转换为SL4J</h3><p><strong>SpringBoot（sl4j+lockbcak）</strong></p><p>Spring（commons-logging）</p><p>Hibernate（jboss-logging）</p><p>转换方式如下：</p><figure><img src="/assets/22-88816a2a.png" alt="22" tabindex="0" loading="lazy"><figcaption>22</figcaption></figure><h3 id="springboot和日志关系" tabindex="-1"><a class="header-anchor" href="#springboot和日志关系" aria-hidden="true">#</a> SpringBoot和日志关系</h3><figure><img src="/assets/23-8678b99d.png" alt="23" tabindex="0" loading="lazy"><figcaption>23</figcaption></figure><p>SpringBoot使用spring-boot-starter-logging来记录日志</p><figure><img src="/assets/24-f61cd612.png" alt="24" tabindex="0" loading="lazy"><figcaption>24</figcaption></figure><h3 id="日志的配置" tabindex="-1"><a class="header-anchor" href="#日志的配置" aria-hidden="true">#</a> 日志的配置</h3><p>路径的配置：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 不指定路径当前项目下生成springboot.log日志</span>
<span class="token comment">#logging.file.name=springboot.log</span>
<span class="token comment"># 在当前磁盘根路径下创建spring文件夹和里面的log文件，使用spring.log作为默认文件</span>
<span class="token key attr-name">logging.file.path</span><span class="token punctuation">=</span><span class="token value attr-value">/springLog/log</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/25-8e40dafe.png" alt="25" tabindex="0" loading="lazy"><figcaption>25</figcaption></figure><p>日志输出格式控制：</p><ul><li>日志输出格式：</li><li>%d表示日期时间，</li><li>%thread表示线程名，</li><li>%-5level：级别从左显示5个字符宽度</li><li>%logger{50} 表示logger名字最长50个字符，否则按照句点分割。</li><li>%msg：日志消息，</li><li>%n是换行符</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 在控制台输出的日志格式
logging.pattern.console=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n
# 指定文件中日志的输出格式
logging.pattern.file=%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n
输出结果：
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== Starting Springboot04ApplicationTests on DESKTOP-J83JFON with PID 3092 (started by 54271 in C:\Users\54271\Documents\SpringBoot_Twice\springboot_04)
2020-07-18 === [main] === DEBUG === cn.zhiyucs.Springboot04ApplicationTests ==== Running with Spring Boot v2.3.1.RELEASE, Spring v5.2.7.RELEASE
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== No active profile set, falling back to default profiles: default
2020-07-18 === [main] === INFO  === o.s.scheduling.concurrent.ThreadPoolTaskExecutor ==== Initializing ExecutorService &#39;applicationTaskExecutor&#39;
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== Started Springboot04ApplicationTests in 1.893 seconds (JVM running for 2.966)
2020-07-18 === [main] === TRACE === cn.zhiyucs.Springboot04ApplicationTests ==== 这是跟踪日志
2020-07-18 === [main] === DEBUG === cn.zhiyucs.Springboot04ApplicationTests ==== 这是调试日志
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== 这是信息日志
2020-07-18 === [main] === WARN  === cn.zhiyucs.Springboot04ApplicationTests ==== 这是警告日志
2020-07-18 === [main] === ERROR === cn.zhiyucs.Springboot04ApplicationTests ==== 这是错误日志
2020-07-18 === [SpringContextShutdownHook] === INFO  === o.s.scheduling.concurrent.ThreadPoolTaskExecutor ==== Shutting down ExecutorService &#39;applicationTaskExecutor&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="指定日志框架" tabindex="-1"><a class="header-anchor" href="#指定日志框架" aria-hidden="true">#</a> 指定日志框架</h3><p>在类路径下直接指定：logback.xml logback-spring.xml log4j2-spring.xml log4j2.xml</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPQAAABqCAYAAACLQ3zNAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA4eSURBVHhe7Z1tjx03Fcf7XRCogne8QhGb5O6WpNkNeejmQQRVCVKhWTZpCU9qA9psG1aEqKUKu0lKAakK2mUF5IlEqXTDF+HTGB97bJ/xPZ6Hu3tz53r+L36aax/72OPr/7Vn5trz2ncPDVTOHDh4RW0Oh2pz9bBoByAnshb08tnzanl1S20Pd9TaWQga5E+2gj5w8Lxa2dpR2zs7enQ+L6YBIDeyn3ID0CcgaAAy4rWl9x4rAEAeQNAAZAQEDUBGQNAAZERnBX37r09K3Lz3WL2zLqcFAFj2XdB3/vJQPXyYhuxSvphY0I6VjSdiegDABAT9ww8eqX/9WxYzxZNdyhcjibkJki8A+sJEptwbm7KgKV5KLyGJtQmxn8Wrz9T9hy/UtevP9XGohg+eFfFP1bUHX6mXL18adnX8xavhx2bx1gu1Oxwa2/DhV2rjFrON5H3u8y6acl6ojevl9Bs6/X3to3l9mM891BX0i4kI+swvH6vdfz4qiZnCFC+ll5DE2oTYjxGQ7uy2oz/1Qrj2gOKsaKxguLgoDwnwqQlfvPVc7RZped5rWrQ+r/Olhbqr827Egtbi9YKuqI/zuaHDJFxuG6euoF9M7KbYh5+UBU1hKV0KSaxNiP04AZGYfJwkOhYn2aV0Po6V0VTQdfWpsvG4qrygf0xM0Cd+9lh9uW3FTEcKS+lSSGLlSHkk3AhWEoSeog513O6DF+q+R4eZ0NwUd1ePpPfv6ilukd/m1VNmNgI6we7efdpQ0FJ9yj7LtvHqCvrHxARNXLlpR2k6SvYqJBFzKM3//r4gwv1UCui6nvJGlPPqOD2Fva+F4gQ3HUGPV1duB/1gooI+/v5j9fGdR+Yo2auQRMyR8kiIAkpMU/nIxj9bH4UgRcHW2E1chaAT9amyNamriwP9YaKC3guSiDmURhqdCe5HEhDBb0JR+OJdYRR2Nh3moopvYMU3rWg0pptW9ibZM3OHm6bEKUFLPqWbYuPUFfSLmRZ0E4yAosdINt4+CgqPe4IoiIt3x3tsZex6VKVHUiGvTe8FXVEfyede6gr6RWcF3QRpdCaktAD0gZkWNACgDEZoADICIzQAGQFBA5AR2CQQgIyAoAHICAgagIyAoAHIiOwF/fvNL0rc+MNn6sKld8S008a+vmdLreA9XGBMeidox6XLV8T043KAXoq3ta6WDzYXY5znwNl1tT0cqu0beBcXGI/eCroOyVcVJM7hTntBt80DQBUQdALJlxlR3SKInR21VrxzevlGiKe3XW5v2dGfptBrWzs2/XBHbeqRd/mGO47mMe+yNm/LLEbs4g2alMakazkDAP0Dgk4Q+7Evjg+vpl1e1dPjYnQl4dF7qGm0XaF3UheiW9kaFnE2jRMnTamlPPHL6eP8azrsfiwAkICgE8R+7PVt+sXx8fRZSu8E666RR/IwQdeVB4AEBJ1A8uVHWJoW37iilrlYY3FSeLilVoqwiaNRdqehoIX8ANQBQSeQfBF2qrxurnW54CBo0AUg6ASSr9KIHF3vjogTU24wBSDoBLEfP2IWAqMbWlxwzs4FWHVTTMoT/0jgphhoCwSdQPLFHzXxx1YEF+yQPbbycVr8/LGVlMcIGo+twB7IXtAA9AkIGoCMgKAByAgIGoCMgKAByAgIGoCMgKAByAgIGoCMgKAByIjsBR3/A6zLe4rVEf81FICY3gnaMc6eYvTf62n+/bKtoKddX/Dq6a2g65B8mcUUbHXUq2YcQU+zvuDVA0EniP1U7RtWXkBxxQvILragFVq0ftot6rArtkr+vC+Xno6ji0BiQVPZbfYsq6uvsdOoXuSLF6CA7gNBJ4j9kBCq9g2jsBWLDnOBanGUlkBqoZL4tmnHE8pj1j1bkfr0bFmmKbMIx4KuWp45fn1ptZddDcb3TaMw6D4QdALJVzyFFTcxYHGxAL0PthOJE7kVoU3v1ks7nOi4v7E2UKirr2AHswUEnUDyNSIQI06azm6pTY8OO9EVI15JQLGPEUGPCoqm0ZTnrbnVIOjohyH2ZcIt60tp/ChP67KjfdNA94GgE0i+ZIHQNa+e0kYYeycFna4v9yPtmwa6DwSdQPI1IpDEFNWNauMJOgjSMckpN8FHYf6Zl+fiQLeBoBNIvtwIxwXBb0xR2Iymxag2rqD346aYL6tNfYv03qbDuKaeLSDoBJIvLppwZ9jGhUc9QRBGgDocC7r0gjoStM5Pj5r8D8Aq5Qv+XH7rj+5Ch7y+Pjpf3Z5lPE6qL1G1bxroPtkLepbwgsaICMYEgu4QEDTYKxB0h7DT73B9C0BbIGgAMgKCBiAjIGgAMgKCBiAjIGgAMgKCBiAjIOiIY+/K8ZPGPoMu/qdt/s1V/gfXfjFJ37NMLu0CQTOOvD2vzt1ZUINT86J9kpQEbRZRjC7SGIeRv5ruo+9ZJtd2gaA1BxcGaunqvDr/pwXNvFq8PF1BS/ZxMQsu2GIQYMm1XXop6INHBurQ4kC9cW6gFrWQz9wmMQdO/FoWtP0nl7wYwgiybj+wOrsboU1aeREGIS3ukOok7SvWzrdQ56IMssc0Okdjt3usxQtGGteB+ZTzp/d1ozLHa5fZ2HutF4KeOzxQRy8O1Ol1Ldg7ZfFyzn1GI/SCOv2RLOiq5YqmQ+gv2C11pPTS0sc6uxd08Vkqd02HqYPV14k2KrAjkdtXrM63C4e0usObDmtFzOtMYU7Tc7QCsPWhNPV1SPvk+W36In/RPlKZbdol7ZPE79pET9eLtBSeJtkLem4wUCc/lAS8oOZPynkOL40Kum5DAf6Z53Mdoak9FnRqUwKirk4mXHRc19nqfKfqEez6B0WPdDwu2MplO6Rz9Hka1iHpU8rP4qQyTZq27cJ9CvaukL2g3/yxJOZ5dfK6nmr/4G31xT+ejEDxsR/TAYqNAHxc0bmps9kOMfolmw0EdMex2wfV2cud2HwWynXU1cmnSXXcMc6pXtDt2mDP7fpTyk/TZnmftFT++nZJ+6T0fiZE0/QO7b2WvaDf2pAFPX96oD7+dMsI+Hef3jVp6Uhhio/97LnjQdATFLTOz/ZH4/ukpfI3apeET+9D17Nre69lL2h7XVwW86nfhtH559fX1dGlEyYtHSksjdLiNKzoBKHjBSE5Zn/KHdvrBF13jpG/RnWo8Jlon+UiLJVp4lu2C+F8xp95Xhc3LfIfoW+WxUwsLIfR+XtvLqnb9/5m0tKRwqlR2nQi3Qlm5aYY2d1o48qs8+3C1NFt2nLH5oK2dQk3h5qdY9kfUV+HtM84v7HT6F2MmKky27QLhUs+i7zepsPSD8A0yF7Qb1wYmDvbNFKfWltQxy4P1Nz8YS/oI4vH1Seff2k+05HCKUFzwVCHGnlsRV9q1X5gdXa6HnOCLj7H5RqxRo+tUnUasbtRsrFvShvq6NJbEdt6uqmxT197jmV/zmdlHSp88vzhMVIQW5Myq9pF8kl0de+17AVNHDpq73bPzVuBH3uXTbl/85E69v1T6ifv/cIcKUzx0o2xKnzHizpOU3sOTOIc+9Bu+0kvBE3MLQzMjbD5M/MGejbtRumbf7yn3v9gzRxTo3MdEDQE3QV6I2gJN0rHtB2dCTsVDddcbe05MIlz7EO77Se9FjQAuQFBA5AREDQAGQFBA5AREDQAGdFLQf9o5ao5Nn1JHQCzQu8ETWJ2wo3F7OIl7PPQ8NfAvTDJZ6vTfm5r/2FV/ldVV9nP77Qr9ErQTsxOuFzIPF4Cgm6GXdgwupiii0DQMwwXsxMuD/N4CQg6PyDozNiLoO3UUl5Q4Oylvb5Wbfr0Qg4KV+SvWHTBy48FfcDsxRXySdDqIWmhgfFlFiXI9Qz2sF+XjaPzdYtMovzFufiyK9rJpfFpzVY/4dwIs0iCVkW5c2f1sfW10//SPmLFSjWTHoKeTSTxSkh5ifjLr1ryJ9ttp22y1LIuv2R3Syqtb+vHlVM1/XXp3RJIvj9WXT293Yhc/+CwPF7QOm3VnmR15xnD25mXRbZQH9Yu9ENDdaBdRShPcUkQ6gdBzySSeCWkvESpowoL4JvauaDjTms6K4myLr9gL6cjW9GZi9HI2HTcip4VWAoB1vqqqGdh54LgcbLd1qtJO7k4jstPdlePYBPKMz8gepTW5xrnl9LPOr2ecreh1FGjTmLtrKPU2Y2vURGZRfR6dPHb6rTwH9JZ39s6rRvJvE0LKOyRxWcTxahIU2W2P1ZtPaUthXg7CfndeTRpRxcXY38IhPOTyqMyWLrR7wGCnin+e+FbY8P9lDrqDAh6TV8z8qltHeQ/3h+rtp7TErTORz9Ao3mF8qgMCDofuED/c/6b6leHvuHD9JnieBoO91PqqBVTxaS9GFV4R4o77f5OuelGUBBnnI6znDqPunqystL5YzsTdE07uThO8J+ackf+IOi8cOL88/HX1aXvfF19vvS6j6PPFEc2F8fhfuIv33Qm3VHCzZzyFNCGtZjMbpG0Vc+rvynG0/GpKcePkqweTmR19YzLMv5YO8n2IGgKV7cTnVe4YefTFyLmZYVwVB4EnRdOnGe+/TW1e3p0NKY4ssXxBPdjvny6xvSdJ4jMdEDhsRXZ6bp0W3dYd5PKdyTTiekYHq/EHd/5JwG1emzFfNkOrOugRZASdWp/LC+QFnuE8XaS7U6kzkd1O7nPJq25A1+ecUiPrUrl0Q8U+258+f57CHXJAYzQDUfotizrjsnDpvPM2Ghg61we8fabHNqpS+AauuE1dBv8dSCNin4qWT317SKTFnQu7dQleiXotkj+mkL/0KKpnZ1K0hQvPeXtKnZ6aq/TJft+kEM7dYnsBQ1An4CgAcgICBqAbBio/wPeWsx9CM/EdgAAAABJRU5ErkJggg==" alt="26" tabindex="0" loading="lazy"><figcaption>26</figcaption></figure><p>logback.xml：直接被日志框架识别</p><p>logback-spring.xml：可以使用SpringBoot日志的Profile的高级功能</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;
    &lt;springProfile name=&quot;dev&quot;&gt;
        &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} ----&gt; [%thread] ---&gt; %-5level %logger{50} - %msg%n&lt;/pattern&gt;
    &lt;/springProfile&gt;
    &lt;springProfile name=&quot;!dev&quot;&gt;
        &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n&lt;/pattern&gt;
    &lt;/springProfile&gt;
&lt;/layout&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="切换日志框架" tabindex="-1"><a class="header-anchor" href="#切换日志框架" aria-hidden="true">#</a> 切换日志框架</h3><p>直接在Maven的exclude即可</p><h2 id="静态资源映射规则" tabindex="-1"><a class="header-anchor" href="#静态资源映射规则" aria-hidden="true">#</a> 静态资源映射规则</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Default resource handling disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Duration</span> cachePeriod <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CacheControl</span> cacheControl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCachecontrol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHttpCacheControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span><span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/resources/webjars/&quot;</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> staticPathPattern <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token function">getResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>WebJar+Maven方式加载静态资源</li></ol><p><strong>registry.hasMappingForPattern(&quot;/webjars/**)</strong></p><p>去<a href="https://www.webjars.org/" target="_blank" rel="noopener noreferrer">WebJars<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>以jars的方式获取静态资源 如：jquery</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.webjars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jquery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/27-afd02372.png" alt="27" tabindex="0" loading="lazy"><figcaption>27</figcaption></figure><p>路径是在：org\webjars\jquery\3.5.1\jquery-3.5.1.jar!\META-INF\resources\webjars\jquery\3.5.1\jquery.js 网页访问路径：<a href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js" target="_blank" rel="noopener noreferrer">http://localhost:8080/webjars/jquery/3.5.1/jquery.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img src="/assets/28-22516e6b.png" alt="28" tabindex="0" loading="lazy"><figcaption>28</figcaption></figure><ol start="2"><li>可以设置静态资源的有关参数：（ResourceProperties.class）</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.resources&quot;</span><span class="token punctuation">,</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">CLASSPATH_RESOURCE_LOCATIONS</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;classpath:/META-INF/resources/&quot;</span><span class="token punctuation">,</span>
                                                                  <span class="token string">&quot;classpath:/resources/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/static/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/public/&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>访问当前项目的任何资源</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;/&quot;,
&quot;classpath:/META-INF/resources/&quot;,
&quot;classpath:/resources/&quot;, 
&quot;classpath:/static/&quot;, 
&quot;classpath:/public/&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如添加一个资源包：</p><figure><img src="/assets/29-3e5013b2.png" alt="29" tabindex="0" loading="lazy"><figcaption>29</figcaption></figure><p><strong>网页访问路径：<a href="http://localhost:8080/asserts/js/Chart.min.js" target="_blank" rel="noopener noreferrer">http://localhost:8080/asserts/js/Chart.min.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><ol start="4"><li>欢迎页的加载方式：也在WebMvcAutoConfiguration这个类中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WelcomePageHandlerMapping</span> <span class="token function">welcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span>
                                                           <span class="token class-name">FormattingConversionService</span> mvcConversionService<span class="token punctuation">,</span> <span class="token class-name">ResourceUrlProvider</span> mvcResourceUrlProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">WelcomePageHandlerMapping</span> welcomePageHandlerMapping <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">TemplateAvailabilityProviders</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">,</span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setInterceptors</span><span class="token punctuation">(</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>mvcConversionService<span class="token punctuation">,</span> mvcResourceUrlProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setCorsConfigurations</span><span class="token punctuation">(</span><span class="token function">getCorsConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> welcomePageHandlerMapping<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过查看getWelcomePage方法就可以看出是<strong>加载静态资源的index.html</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> locations <span class="token operator">=</span> <span class="token function">getResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>locations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">getIndexHtml</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">isReadable</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">Resource</span> <span class="token function">getIndexHtml</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location <span class="token operator">+</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模板引擎thymeleaf" tabindex="-1"><a class="header-anchor" href="#模板引擎thymeleaf" aria-hidden="true">#</a> 模板引擎Thymeleaf</h2><p>整合SpringBoot</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thymeleaf的默认配置</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.thymeleaf&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThymeleafProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Charset</span> <span class="token constant">DEFAULT_ENCODING</span> <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;classpath:/templates/&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_SUFFIX</span> <span class="token operator">=</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注：**Controller中的@RequestMapping(&quot;/su&quot;)不能和return&quot;xx&quot;重复</p><figure><img src="/assets/30-2ac2933b.png" alt="30" tabindex="0" loading="lazy"><figcaption>30</figcaption></figure><h2 id="springmvc自动配置原理" tabindex="-1"><a class="header-anchor" href="#springmvc自动配置原理" aria-hidden="true">#</a> SpringMVC自动配置原理</h2><p><a href="https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/boot-features-developing-web-applications.html#developing-web-applications" target="_blank" rel="noopener noreferrer">文档参考：SpringMVC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="默认配置" tabindex="-1"><a class="header-anchor" href="#默认配置" aria-hidden="true">#</a> 默认配置</h3><p>auto-configuration 在 Spring 的默认值之上添加以下 features：</p><ul><li><p>包含<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code> beans（视图解析器，根据返回值视图对象（View），然后可以进行渲染（转发/重定向））。</p></li><li><p>支持提供静态资源，包括对 WebJars 的支持</p></li><li><p>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code> beans</p></li><li><ul><li>转换器 HttpMessageConverters</li><li>格式化器</li></ul></li><li><p>支持<code>HttpMessageConverters 转换 HTTP 请求和响应</code></p></li><li><p>自动注册<code>MessageCodesResolver 定义错误代码的生成规则</code></p></li><li><p>静态<code>index.html</code>支持。</p></li><li><p>自定义<code>Favicon</code>支持</p></li></ul><h3 id="contentnegotiatingviewresolver" tabindex="-1"><a class="header-anchor" href="#contentnegotiatingviewresolver" aria-hidden="true">#</a> ContentNegotiatingViewResolver</h3><p>首先是<strong>ContentNegotiatingViewResolver</strong>：组合所有的视图解析器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token class-name">ViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;viewResolver&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">ContentNegotiatingViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ContentNegotiatingViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ContentNegotiatingViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentNegotiatingViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resolver<span class="token punctuation">.</span><span class="token function">setContentNegotiationManager</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">ContentNegotiationManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ContentNegotiatingViewResolver uses all the other view resolvers to locate</span>
    <span class="token comment">// a view so it should have a high precedence</span>
    resolver<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ContentNegotiatingViewResolver中通过resolveViewName解析视图</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">RequestAttributes</span> attrs <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>attrs <span class="token keyword">instanceof</span> <span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">,</span> <span class="token string">&quot;No current ServletRequestAttributes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> requestedMediaTypes <span class="token operator">=</span> <span class="token function">getMediaTypes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> attrs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestedMediaTypes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> candidateViews <span class="token operator">=</span> <span class="token function">getCandidateViews</span><span class="token punctuation">(</span>viewName<span class="token punctuation">,</span> locale<span class="token punctuation">,</span> requestedMediaTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">View</span> bestView <span class="token operator">=</span> <span class="token function">getBestView</span><span class="token punctuation">(</span>candidateViews<span class="token punctuation">,</span> requestedMediaTypes<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bestView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> bestView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过getCandidateViews进行遍历每个解析</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateViews</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> requestedMediaTypes<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> candidateViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>viewResolvers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>contentNegotiationManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;No ContentNegotiationManager set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ViewResolver</span> viewResolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewResolvers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">View</span> view <span class="token operator">=</span> viewResolver<span class="token punctuation">.</span><span class="token function">resolveViewName</span><span class="token punctuation">(</span>viewName<span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                candidateViews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MediaType</span> requestedMediaType <span class="token operator">:</span> requestedMediaTypes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> extensions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contentNegotiationManager<span class="token punctuation">.</span><span class="token function">resolveFileExtensions</span><span class="token punctuation">(</span>requestedMediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> extension <span class="token operator">:</span> extensions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> viewNameWithExtension <span class="token operator">=</span> viewName <span class="token operator">+</span> <span class="token char">&#39;.&#39;</span> <span class="token operator">+</span> extension<span class="token punctuation">;</span>
                    view <span class="token operator">=</span> viewResolver<span class="token punctuation">.</span><span class="token function">resolveViewName</span><span class="token punctuation">(</span>viewNameWithExtension<span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        candidateViews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后组合起来<strong>ContentNegotiatingViewResolver</strong>通过initServletContext的beansOfTypeIncludingAncestors</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initServletContext</span><span class="token punctuation">(</span><span class="token class-name">ServletContext</span> servletContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ViewResolver</span><span class="token punctuation">&gt;</span></span> matchingBeans <span class="token operator">=</span>
        <span class="token class-name">BeanFactoryUtils</span><span class="token punctuation">.</span><span class="token function">beansOfTypeIncludingAncestors</span><span class="token punctuation">(</span><span class="token function">obtainApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试并调试：在主类创建一个视图解析器进行测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootCrudApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootCrudApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">myViewResovler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ViewResolver</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在doDispatch进行调试：即可看见</p><figure><img src="/assets/31-70808356.png" alt="31" tabindex="0" loading="lazy"><figcaption>31</figcaption></figure><h3 id="httpmessageconverters" tabindex="-1"><a class="header-anchor" href="#httpmessageconverters" aria-hidden="true">#</a> HttpMessageConverters</h3><p>Spring MVC 使用<code>HttpMessageConverter</code>接口转换 HTTP 请求和响应。</p><p>这个组件是从容器中确定的（WebMvcAutoConfiguration.class）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public WebMvcAutoConfigurationAdapter(ResourceProperties resourceProperties, WebMvcProperties mvcProperties,
                                      ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,
                                      ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,
                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath) {
    this.resourceProperties = resourceProperties;
    this.mvcProperties = mvcProperties;
    this.beanFactory = beanFactory;
    this.messageConvertersProvider = messageConvertersProvider;
    this.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();
    this.dispatcherServletPath = dispatcherServletPath;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从构造函数就可以看出这个类是获取了所有的HttpMessageConverter</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public HttpMessageConverters(HttpMessageConverter&lt;?&gt;... additionalConverters) {
    this(Arrays.asList(additionalConverters));
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可知只要自定义Converter就可以像上面视图解析器一样放容器即可</p><h3 id="messagecodesresolver" tabindex="-1"><a class="header-anchor" href="#messagecodesresolver" aria-hidden="true">#</a> MessageCodesResolver</h3><p>这个是用于定义错误代码的生成规则的，如（WebMvcAutoConfiguration.class）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">MessageCodesResolver</span> <span class="token function">getMessageCodesResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getMessageCodesResolverFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMessageCodesResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMessageCodesResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setMessageCodeFormatter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getMessageCodesResolverFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过查看getMessageCodesResolverFormat（）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * Formatting strategy for message codes. For instance, `PREFIX_ERROR_CODE`.
     */</span>
<span class="token keyword">private</span> <span class="token class-name">DefaultMessageCodesResolver<span class="token punctuation">.</span>Format</span> messageCodesResolverFormat<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察注释可以看到错误代码的定义：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Format</span> <span class="token keyword">implements</span> <span class="token class-name">MessageCodeFormatter</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
         * Prefix the error code at the beginning of the generated message code. e.g.:
         * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">errorCode <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> object name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> field</span></span><span class="token punctuation">}</span>
         */</span>
    <span class="token constant">PREFIX_ERROR_CODE</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">String</span> errorCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">toDelimitedString</span><span class="token punctuation">(</span>errorCode<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
         * Postfix the error code at the end of the generated message code. e.g.:
         * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">object name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> field <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> errorCode</span></span><span class="token punctuation">}</span>
         */</span>
    <span class="token constant">POSTFIX_ERROR_CODE</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">String</span> errorCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">toDelimitedString</span><span class="token punctuation">(</span>objectName<span class="token punctuation">,</span> field<span class="token punctuation">,</span> errorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="springboot在springmvc的配置模式" tabindex="-1"><a class="header-anchor" href="#springboot在springmvc的配置模式" aria-hidden="true">#</a> SpringBoot在SpringMVC的配置模式</h3><p>以HiddenHttpMethodFilter为例：Spring在自动配置很多组件的时候，先看容器是否么有自己配置的（@Bean @Component）如果有就用用户配置的（如hiddenHttpMethodFilter），如果没有才自动配置，如果可以有多个（ViewResolver）将用户配置和自己默认组合一起</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">HiddenHttpMethodFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.mvc.hiddenmethod.filter&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span> <span class="token function">hiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="接管springboot的springmvc" tabindex="-1"><a class="header-anchor" href="#接管springboot的springmvc" aria-hidden="true">#</a> 接管SpringBoot的SpringMVC</h3><p>使用WebMvcConfigurer的接口可以扩展SpringMVC</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/32-d522be17.png" alt="32" tabindex="0" loading="lazy"><figcaption>32</figcaption></figure><p>比如使用SpringMVC的Controller：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析这个WebMvcAutoConfigurationAdapter（WebMvcAutoConfiguration.class）,查看这个Import(EnableWebMvcConfiguration.class)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EnableWebMvcConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">DelegatingWebMvcConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">ResourceLoaderAware</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在它的父类DelegatingWebMvcConfiguration中，setConfigurers通过addWebMvcConfigurers从容器中获取所有的WebMvcConfigure</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigurers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">&gt;</span></span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">addWebMvcConfigurers</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，下面也有很多方法：</p><figure><img src="/assets/33-4210f2c9.png" alt="33" tabindex="0" loading="lazy"><figcaption>33</figcaption></figure><p>以addViewControllers为例:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurer</span> delegate <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        delegate<span class="token punctuation">.</span><span class="token function">addViewControllers</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小结-1" tabindex="-1"><a class="header-anchor" href="#小结-1" aria-hidden="true">#</a> 小结：</h3><ol><li><p>实现了WebMvcConfigurer接口，SpringBoot就会将这个一起实现，如刚刚MyMvcConfig</p></li><li><p>DelegatingWebMvcConfiguration（也就是是实现了WebMvcConfigurer），SpringBoot会扫描整个能使用的Configurer到SpringMVC，然后就能使用SpringMVC的功能啦（setConfigurers -- addWebMvcConfigurers）</p></li></ol><p>【不推荐】<em>全面接管SpringMVC</em>：自己配SpringMVC@EnableWebMvc</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个的核心就是 -- DelegatingWebMvcConfiguration</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">DelegatingWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableWebMvc</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也是组合自己写的Configurer</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigurers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">&gt;</span></span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">addWebMvcConfigurers</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【重点小结】在<strong>DelegatingWebMvcConfiguration</strong>中与<strong>WebMvcAutoConfiguration</strong>（<strong>@ConditionalOnMissingBean</strong>）比较可知：容器中没有这个组件的时候，这个自动配置类才生效，如果我们使用**@EnableWebMvc**，这个自动配置类就不会生效。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelegatingWebMvcConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">DispatcherServletAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TaskExecutionAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                     <span class="token class-name">ValidationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="国际化" tabindex="-1"><a class="header-anchor" href="#国际化" aria-hidden="true">#</a> 国际化</h2><p>创建国际化文件 中文：xxx_zh_CN.properties English：xxx_en_US.properties</p><figure><img src="/assets/34-2a1b1596.png" alt="34" tabindex="0" loading="lazy"><figcaption>34</figcaption></figure><p>IDEA快速创建国际化文件：</p><figure><img src="/assets/35-3a576ffd.png" alt="35" tabindex="0" loading="lazy"><figcaption>35</figcaption></figure><p>可以切换视图快速开发国际化</p><figure><img src="/assets/36-297b2ed9.png" alt="36" tabindex="0" loading="lazy"><figcaption>36</figcaption></figure><p>然后就可以多个文件开发：</p><figure><img src="/assets/37-4d153fb8.png" alt="37" tabindex="0" loading="lazy"><figcaption>37</figcaption></figure><p>SpringBoot使用MessageSourceAutoConfiguration自动配置了管理国际化的组件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_SOURCE_BEAN_NAME</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">ResourceBundleCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageSourceAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">MessageSource</span> <span class="token function">messageSource</span><span class="token punctuation">(</span><span class="token class-name">MessageSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceBundleMessageSource</span> messageSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBundleMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置国际化资源及出门（去掉语言国家代码）</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setBasenames</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span>
                                   <span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">trimAllWhitespace</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setFallbackToSystemLocale</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isFallbackToSystemLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Duration</span> cacheDuration <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getCacheDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheDuration <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setCacheMillis</span><span class="token punctuation">(</span>cacheDuration<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setAlwaysUseMessageFormat</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isAlwaysUseMessageFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setUseCodeAsDefaultMessage</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isUseCodeAsDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> messageSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由此可以配置主配置文件</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.messages.basename</span><span class="token punctuation">=</span><span class="token value attr-value">i18n/login</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="使用thymeleaf国际化" tabindex="-1"><a class="header-anchor" href="#使用thymeleaf国际化" aria-hidden="true">#</a> 使用thymeleaf国际化</h3><figure><img src="/assets/38-af1a2bd4.png" alt="38" tabindex="0" loading="lazy"><figcaption>38</figcaption></figure><h3 id="springboot区域信息解析器" tabindex="-1"><a class="header-anchor" href="#springboot区域信息解析器" aria-hidden="true">#</a> SpringBoot区域信息解析器</h3><p>在WebMvcAutoConfiguration中解析区域信息localeResolver</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.mvc&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;locale&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">LocaleResolver</span> <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WebMvcProperties<span class="token punctuation">.</span>LocaleResolver</span><span class="token punctuation">.</span><span class="token constant">FIXED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FixedLocaleResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AcceptHeaderLocaleResolver</span> localeResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcceptHeaderLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localeResolver<span class="token punctuation">.</span><span class="token function">setDefaultLocale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> localeResolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取区域信息的方式：通过AcceptHeaderLocaleResolver，根据请求头的Accept-Language：zh_CN/ en_US获取</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Locale</span> <span class="token function">resolveLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Locale</span> defaultLocale <span class="token operator">=</span> <span class="token function">getDefaultLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultLocale <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> defaultLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Locale</span> requestLocale <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Locale</span><span class="token punctuation">&gt;</span></span> supportedLocales <span class="token operator">=</span> <span class="token function">getSupportedLocales</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>supportedLocales<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> supportedLocales<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>requestLocale<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> requestLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Locale</span> supportedLocale <span class="token operator">=</span> <span class="token function">findSupportedLocale</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> supportedLocales<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>supportedLocale <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> supportedLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>defaultLocale <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> defaultLocale <span class="token operator">:</span> requestLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义国际化" tabindex="-1"><a class="header-anchor" href="#自定义国际化" aria-hidden="true">#</a> 自定义国际化</h3><p>前端设置：thymeleaf的(xxx)表示?xxx</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/index(l=&#39;zh_CN&#39;)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>中文<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/index(l=&#39;en_US&#39;)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>English<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义创建一个判别前端传入的参数：要实现LocaleResolver接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLocale</span> <span class="token keyword">implements</span> <span class="token class-name">LocaleResolver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Locale</span> <span class="token function">resolveLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> l <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Locale</span> locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            locale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> locale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在自定义的MVC中实现这个国际化：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocaleResolver</span> <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="拦截器" tabindex="-1"><a class="header-anchor" href="#拦截器" aria-hidden="true">#</a> 拦截器</h2><p>以拦截登录为例</p><p>首先把登录名放入到session中：session.setAttribute</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span>
                    <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">contentEquals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/main&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册一个拦截器：<strong>HandlerInterceptor</strong></p><p>并且判断，如果用户名为空就不放行，转发到登录页面，并放入没有权限的信息，如果成功就放行</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginHandlerInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> username <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;没有权限请先登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在SpringMVC中注册这个拦截器，并<strong>拦截响应的访问地址</strong>：</p><p>这里拦截了所有的地址：除了/index / /user/login这三个地址</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginHandlerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了防止SpringBoot拦截静态资源可以加入<strong>addResourceHandlers</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/static/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="错误处理原理" tabindex="-1"><a class="header-anchor" href="#错误处理原理" aria-hidden="true">#</a> 错误处理原理</h2><p>如果访问了没有的路径网页会：</p><figure><img src="/assets/39-25808dd1.png" alt="39" tabindex="0" loading="lazy"><figcaption>39</figcaption></figure><p>其他客户端会发送json数据：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-07-18T17:08:27.106+00:00&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
    <span class="token string">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Not Found&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;No message available&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/aaa&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误处理的自动配置：ErrorMvcAutoConfiguration</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Load before the main WebMvcAutoConfiguration so that the error View is available</span>
<span class="token annotation punctuation">@AutoConfigureBefore</span><span class="token punctuation">(</span><span class="token class-name">WebMvcAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorMvcAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个类给容器添加了以下组件：</p><ul><li>DefaultErrorAttributes</li><li>BasicErrorController</li><li>ErrorPageCustomizer</li><li>DefaultErrorViewResolver</li></ul><p>首先看<strong>ErrorPageCustomizer</strong>：看registerErrorPages -- getRelativePath</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorPageCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorPageRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerErrorPages</span><span class="token punctuation">(</span><span class="token class-name">ErrorPageRegistry</span> errorPageRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ErrorPage</span> errorPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcherServletPath<span class="token punctuation">.</span><span class="token function">getRelativePath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorPageRegistry<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span>errorPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个getPath的跳转位置：可知 -- 系统出现错误，来到error请求进行处理</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${error.path:/error}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/error&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>BasicErrorController</strong>：处理默认/error请求</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;${server.error.path:${error.path:/error}}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicErrorController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorController</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面有两种处理方式：（这里就可以解释开头的现象），通过RequestHeader - <strong>accept判断</strong></p><p>产生HTML类型的数据</p><figure><img src="/assets/40-3cbbf1d9.png" alt="40" tabindex="0" loading="lazy"><figcaption>40</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_HTML_VALUE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">errorHtml</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model <span class="token operator">=</span> <span class="token class-name">Collections</span>
        <span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span><span class="token function">getErrorAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token function">getErrorAttributeOptions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_HTML</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 去哪个页面作为错误页面，包含页面地址和页面内容</span>
    <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> status<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> modelAndView <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>产生JSON数据</p><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgEAAAAeCAYAAAC1+c0GAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAS6SURBVHhe7d05SyRBGMbx/TiKIiIGYm5uZGZiIugHMDAyMDIWE8FMUDDwNhE0MBBF0Mg7EQQv8ABvrOVprdmaskene6bcxv4P/LDnrep2d2vo9+l2xv3z/Pxs/rfz8/PYOgAgv+gN4RECAACZRG8IjxAAAMgkekN4hAAAQCbRG8IjBAAAMoneEF6qEHB2dmZOT0+jBUpC+2hf/3ga82sAgHyjN4SXOASoiU9OTpqWlhZTU1OTiPbRvn4QYKEBAD56Q3iJQ4Cu5tMEAEv76hjuMVloAICP3hBe4hCgRYlr7kn4C/ubF/rx8dHs7u6aqakps7y8HNG2ahqL2wcAQAj4CcFDQF1dnenv7zetra2FWtoQcHd3ZwYGBsz09HTseNbc3t6a2dlZs729be7v7wt1baumMc1x9wEAvCu3N2xsbJjh4eHYMfULt2d8NTePgoaA+vp6s7KyYvQ4Pj4u1NOGgIODAzM0NBQtoAJB3JwsWVhYMFdXV7FjorH5+fnYMQDIuyQhIO7iUH1CPUO9w9ZKzc2rYCGgoaHBrK2tRQFAj9XV1cJY2hCghdMCjo2NFS3qT5mYmDAXFxexYz79+fb29opqm5ubEbemOf/j7wIAWfddb9AFYXt7exHdLbYXifbCUc+/m5tXQUJAY2OjWV9f/2j/7wFAocCOpwkBar5aMH2NS3LuAtuFFW3bur0FpBdGZ2dnVNNX24T1VXPcfez3cY/f29tb+L6lLC0tmYeHh6KaPhXhfzJCczTXrQEAyusNttGLeoM7pvO2W/tqbl5VFAJGRkbM0dGRaWtrK9SamprM1tbWR/s3ZnFxMXpfgB2XNCFAC2abuBsI9FyN2o65VPPDgr+v+1wvkJ6enkIoUE0NX9/bJkm733f82/yHh4fRmwJPTk6K6sKPBADgs+96g73Q0zk67vztnuu/mptnFYWA6+vrqNFfXl5GQaC5udns7OxENT1mZmZMbW1tUQCQNCFADdheiVu2OSvV+YvpvwAs7eMfx94NEB1Lx7TzFSIkaQjQ+wH8moKA+PW4uQCQd+X0hlJ0ro+7OESxikJAd3e3eX19jRq+bmurQdrH+Ph4bACQpCFAx9Vius3ZLnCaEFDqhVHNEKBb/P5HAONCgObw4wAA+KySEKDztc73cWP4p+L3BCgIvLy8fLT+98fo6GjRHF/SEGAbsVtzm7zG4hq7anH72Vv8bl0UAnRXwI65c0uFjVI0b39/v/BczV+3/cUNAppT7jEBIE/ShgC3P8SN45+qvDGwq6srCgJvb29mcHDw07gvaQgo1XzdJq9te3tfi6+mLdq2dRsUbLP356uu7b6+vsKYGyK0rVo5bwx8enqKGn45HxHU3LhxAMiztCHgqzu+KFaVECAdHR1RGIgb8yUNAT9FIcD/cUAlbm5uzNzcXMlfFqQxzXH3AQC8y0pv+M2qFgKSyEsIEH5tMACkQwgIL3EI+M3/gVCIEAAASIcQEF7iEMB/JQwA+An0hvAShwBRE9fVvBYoCe3jBwDRmF8DAOQbvSG8VCGg2lhoAICP3hAeIQAAkEn0hvAIAQCATKI3hEcIAABkEr0hPEIAACCT6A3hEQIAAJlEbwjvj/6RAQBA3pybv+kdgd7LlnaBAAAAAElFTkSuQmCC" alt="41" tabindex="0" loading="lazy"><figcaption>41</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NO_CONTENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token function">getErrorAttributeOptions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>响应错误页面的解析代码：errorHtml -- resolveErrorView(request, response, status, model);</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span>
                                        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorViewResolver</span> resolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>errorViewResolvers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolveErrorView</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> status<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后看DefaultErrorViewResolver，它首先声明了<em>SERIES_VIEWS</em>，用于判断状态码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Series</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">SERIES_VIEWS</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Series</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> views <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    views<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token constant">CLIENT_ERROR</span><span class="token punctuation">,</span> <span class="token string">&quot;4xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    views<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token constant">SERVER_ERROR</span><span class="token punctuation">,</span> <span class="token string">&quot;5xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">SERIES_VIEWS</span> <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span>views<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注释解释两个方法：SpringBoot是如何找错误页面的</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">SERIES_VIEWS</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modelAndView <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">SERIES_VIEWS</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认Springboot可以找到一个页面 error/404</span>
    <span class="token class-name">String</span> errorViewName <span class="token operator">=</span> <span class="token string">&quot;error/&quot;</span> <span class="token operator">+</span> viewName<span class="token punctuation">;</span>
    <span class="token comment">// 模板引擎可以解析这个页面地址就用模板引擎解析</span>
    <span class="token class-name">TemplateAvailabilityProvider</span> provider <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>templateAvailabilityProviders<span class="token punctuation">.</span><span class="token function">getProvider</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span>
                                                                                           <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>provider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模板引擎可用的情况下返回errorviewname指定的地址</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 模板引擎不可用时，就在静态资源文件下找errorViewName页面 /error/404.html</span>
    <span class="token keyword">return</span> <span class="token function">resolveResource</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定制错误页面和json错误数据" tabindex="-1"><a class="header-anchor" href="#定制错误页面和json错误数据" aria-hidden="true">#</a> 定制错误页面和JSON错误数据</h2><p>定制错误页面 直接把文件放到error文件夹下，名字为4xx，5xx即可</p><figure><img src="/assets/42-21a18bf7.png" alt="42" tabindex="0" loading="lazy"><figcaption>42</figcaption></figure><p>当发生错误页面的时候可以获取错误页面的信息（有模板引擎情况下）： timestamp 时间戳 status 状态码 error 错误信息 exception 异常对象 message 异常消息 errors JSR303 数据校验的错误</p><figure><img src="/assets/43-f5b8b4bd.png" alt="43" tabindex="0" loading="lazy"><figcaption>43</figcaption></figure><h3 id="定制一个json数据" tabindex="-1"><a class="header-anchor" href="#定制一个json数据" aria-hidden="true">#</a> 定制一个JSON数据</h3><p>这个错误处理属于Controller：</p><ul><li><p><strong>@ControllerAdvice</strong> 是一个特殊的@Component，用于标识一个类，这个类中被以下三种注解标识的方法：@ExceptionHandler，@InitBinder，@ModelAttribute，将作用于所有的@Controller类的接口上</p></li><li><p>@ResponseBody</p></li><li><p><strong>@ExceptionHandler</strong> (错误类.class) 统一异常处理，也可以指定要处理的异常类型</p></li></ul><p>第一种写法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种：注意使用request定制状态码setAttribute(&quot;javax.servlet.error.status_code&quot;, 500);</p><p>设置以后SpringBoot自适应就会进入错误页面：（resource/error/500）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 传入错误状态码</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;forward:/error&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**【推荐】**第三种：响应是自适应的，通过ErrorAttributes改变需要返回的内容</p><p>首先定制一个错误控制：定义状态码、错误信息等</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 传入错误状态码</span>
        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//        map.put(&quot;message&quot;, e.getMessage());</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户不存在啦!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ext&quot;</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;forward:/error&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后创建一个错误数据传输中间，这个类的功能就是把自定义的错误页面的数据传给SpringBoot，然后响应到自适应页面：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorAttributes</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultErrorAttributes</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span><span class="token class-name">WebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">ErrorAttributeOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>webRequest<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ext&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至于第二个参数scope是怎么定义的：</p><p>0 - request</p><p>1 - session</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestAttributes</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Constant that indicates request scope.
     */</span>
    <span class="token keyword">int</span> <span class="token constant">SCOPE_REQUEST</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * Constant that indicates session scope.
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This preferably refers to a locally isolated session, if such
     * a distinction is available.
     * Else, it simply refers to the common session.
     */</span>
    <span class="token keyword">int</span> <span class="token constant">SCOPE_SESSION</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/44-1d377587.png" alt="44" tabindex="0" loading="lazy"><figcaption>44</figcaption></figure><h2 id="嵌入式servlet" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet" aria-hidden="true">#</a> 嵌入式Servlet</h2><h3 id="spring两种配置方式" tabindex="-1"><a class="header-anchor" href="#spring两种配置方式" aria-hidden="true">#</a> Spring两种配置方式：</h3><ul><li>xxxConfigurer扩展配置</li><li>xxxCustomizer定制配置</li></ul><h3 id="嵌入式servlet两种修改相关配置" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet两种修改相关配置" aria-hidden="true">#</a> 嵌入式Servlet两种修改相关配置</h3><ol><li>配置文件</li></ol><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8083</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>在嵌入式Servlet中修改：在自定义的SpringMVC配置</li></ol><p>注：SpringBoot2 使用的是<strong>WebServerFactoryCustomizer</strong><code>&lt;ConfigurableWebServerFactory&gt;</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token function">webServerFactoryCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableWebServerFactory</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            嵌入式servlet容器相关的配置</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableWebServerFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册三大组件" tabindex="-1"><a class="header-anchor" href="#注册三大组件" aria-hidden="true">#</a> 注册三大组件</h3><ul><li>Filter</li><li>Servlet</li><li>Linstener</li></ul><h4 id="定制servlet" tabindex="-1"><a class="header-anchor" href="#定制servlet" aria-hidden="true">#</a> 定制Servlet</h4><hr><p>创建一个Servlet，继承<strong>HttpServlet</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello MyServlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个自己的配置类，把这个Servlet加入到容器中（<strong>ServletRegistrationBean</strong>、@Bean）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">myServelet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRegistrationBean</span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/myservlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="定制filter" tabindex="-1"><a class="header-anchor" href="#定制filter" aria-hidden="true">#</a> 定制Filter</h4><hr><p>先创建一个自己的Filter，继承<strong>HttpFilter</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">extends</span> <span class="token class-name">HttpFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyFilter process....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样是在配置类内注册，<strong>FilterRegistrationBean</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FilterRegistrationBean</span> filterRegistrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterRegistrationBean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterRegistrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filterRegistrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="定制listener" tabindex="-1"><a class="header-anchor" href="#定制listener" aria-hidden="true">#</a> 定制Listener</h4><hr><p>注册一个监听器，实现接口<strong>ServletContextListener</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;web应用启动!!!!!!!!!!!!!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;web销毁!!!!!!!!!!!!!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把监听器注册到配置类中，并放入容器<strong>ServletListenerRegistrationBean</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletListenerRegistrationBean</span> <span class="token function">myListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyListener</span><span class="token punctuation">&gt;</span></span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> listener<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用其他的嵌入式容器</p><ul><li>Jetty（长连接）</li><li>Undertow（不支持JSP）</li><li>Tomcat（默认）</li></ul><figure><img src="/assets/45-2dd40e3a.png" alt="45" tabindex="0" loading="lazy"><figcaption>45</figcaption></figure><p>切换容器的方式：</p><figure><img src="/assets/46-75c16a3c.png" alt="46" tabindex="0" loading="lazy"><figcaption>46</figcaption></figure><h2 id="源码刨析-嵌入式servlet原理" tabindex="-1"><a class="header-anchor" href="#源码刨析-嵌入式servlet原理" aria-hidden="true">#</a> 源码刨析 嵌入式Servlet原理</h2><p>WebServerFactoryCustomizer嵌入式Servlet的自动配置类：<strong>ServletWebServerFactoryAutoConfiguration</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token comment">// 仅在类 ServletRequest 存在于 classpath 上时才生效</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// 仅在当前应用是 Servlet Web 应用时才生效</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token comment">// 确保前缀为 server 的配置参数加载到 bean ServerProperties</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 导入 ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar 以注册</span>
<span class="token comment">// BeanPostProcessor : WebServerFactoryCustomizerBeanPostProcessor 和 </span>
<span class="token comment">// ErrorPageRegistrarBeanPostProcessor</span>
<span class="token comment">// 2. 导入 EmbeddedTomcat/EmbeddedJetty/EmbeddedUndertow 这三个属于</span>
<span class="token comment">// ServletWebServerFactoryConfiguration 的嵌套配置类，这三个配置类会分别检测</span>
<span class="token comment">// classpath上存在的类，从而判断当前应用使用的是 Tomcat/Jetty/Undertow,</span>
<span class="token comment">// 从而决定定义哪一个 Servlet Web服务器的工厂 bean :</span>
<span class="token comment">// TomcatServletWebServerFactory/JettyServletWebServerFactory/UndertowServletWebServerFactory</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedTomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedJetty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedUndertow</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>针对当前Servlet容器是Tomcat时定义该 bean，用于定制化 TomcatServletWebServerFactory</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token comment">// 仅在类 org.apache.catalina.startup.Tomcat 存在于 classpath 上时才生效</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;org.apache.catalina.startup.Tomcat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">TomcatServletWebServerFactoryCustomizer</span> <span class="token function">tomcatServletWebServerFactoryCustomizer</span><span class="token punctuation">(</span>
    <span class="token class-name">ServerProperties</span> serverProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactoryCustomizer</span><span class="token punctuation">(</span>serverProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ServletWebServerFactoryConfiguration是一个针对ServletWebServerFactory进行配置的配置类。它通过检测应用classpath存在的类，从而判断当前应用要使用哪个Servlet容器:Tomcat,Jetty还是Undertow。检测出来之后，定义相应的Servlet Web服务器工厂组件bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ServletWebServerFactoryConfiguration</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Tomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UpgradeProtocol</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedTomcat</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>   
        
        <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Server</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Loader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebAppContext</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedJetty</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
        
        <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Undertow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SslClientAuthMode</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedUndertow</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三个实现类都继承自抽象基类AbstractServletWebServerFactory：</p><figure><img src="/assets/47-811f4c27.png" alt="47" tabindex="0" loading="lazy"><figcaption>47</figcaption></figure><h4 id="以tomcat为例" tabindex="-1"><a class="header-anchor" href="#以tomcat为例" aria-hidden="true">#</a> 以Tomcat为例</h4><p>进入TomcatServletWebServerFactory，可以看到这个方法，配置Tomcat基本环境，返回一个嵌入式Servlet容器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">WebServer</span> <span class="token function">getWebServer</span><span class="token punctuation">(</span><span class="token class-name">ServletContextInitializer</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> initializers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disableMBeanRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Registry</span><span class="token punctuation">.</span><span class="token function">disableRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Tomcat</span> tomcat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tomcat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> baseDir <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseDirectory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseDirectory <span class="token operator">:</span> <span class="token function">createTempDir</span><span class="token punctuation">(</span><span class="token string">&quot;tomcat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setBaseDir</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Connector</span> connector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connector<span class="token punctuation">.</span><span class="token function">setThrowOnFailure</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">customizeConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoDeploy</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">configureEngine</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Connector</span> additionalConnector <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>additionalTomcatConnectors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tomcat<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConnector</span><span class="token punctuation">(</span>additionalConnector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">prepareContext</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initializers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getTomcatWebServer</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看最后返回的getTomcatWebServer，只要端口号大于等于0就自动启动</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">TomcatWebServer</span> <span class="token function">getTomcatWebServer</span><span class="token punctuation">(</span><span class="token class-name">Tomcat</span> tomcat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TomcatWebServer</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">,</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过进入TomcatWebServer的initialize方法就可以看到启动容器</p><figure><img src="/assets/48-5c11279b.png" alt="48" tabindex="0" loading="lazy"><figcaption>48</figcaption></figure><h3 id="配置是如何修改原理" tabindex="-1"><a class="header-anchor" href="#配置是如何修改原理" aria-hidden="true">#</a> 配置是如何修改原理</h3><p>看ServletWebServerFactoryAutoConfiguration中，在自动配置之前先导入了BeanPostProcessorsRegistrar（后置处理器，Bean初始化前后，创建完对象没有赋值的除四害工作）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察下面的：registerBeanDefinitions方法中WebServerFactoryCustomizerBeanPostProcessor，</p><p>初始之前，如果当前初始化的一个WebServerFactory就调用postProcessBeforeInitialization</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">WebServerFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactory</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取所有的定制其，调用每一个定制其的customize方法来给servlet容器赋值（端口...）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactory</span> webServerFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">LambdaSafe</span><span class="token punctuation">.</span><span class="token function">callbacks</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> webServerFactory<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withLogger</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactoryCustomizerBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>customizer<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> customizer<span class="token punctuation">.</span><span class="token function">customize</span><span class="token punctuation">(</span>webServerFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再看WebServerFactoryCustomizerBeanPostProcessor中的Collection，这个从容器中获取这个类型的组件。定制servlet容器组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Look up does not include the parent context</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getWebServerFactoryCustomizerBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小结-2" tabindex="-1"><a class="header-anchor" href="#小结-2" aria-hidden="true">#</a> 小结：</h3><ol><li>根据导入情况，添加相应的容器工厂：</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedTomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedJetty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedUndertow</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>容器中某个组件创建就会触发<strong>后置处理器（BeanPostProcessorsRegistrar）</strong></li></ol><p>只要是ConfigurableListableBeanFactory就工作：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>这个后置处理器从容器中<strong>获取所有的定制器，然后定制属性（端口..）</strong></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Look up does not include the parent context</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getWebServerFactoryCustomizerBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="嵌入式servlet自动配置原理" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet自动配置原理" aria-hidden="true">#</a> 嵌入式Servlet自动配置原理</h2><p>断点声明：</p><figure><img src="/assets/49-2601b60d.png" alt="49" tabindex="0" loading="lazy"><figcaption>49</figcaption></figure><p>首先启动SpringBoot</p><figure><img src="/assets/50-f34020f0.png" alt="50" tabindex="0" loading="lazy"><figcaption>50</figcaption></figure><p>然后调用run方法：</p><figure><img src="/assets/51-7f30db67.png" alt="51" tabindex="0" loading="lazy"><figcaption>51</figcaption></figure><p>创建和刷新容器</p><figure><img src="/assets/52-0c645e62.png" alt="52" tabindex="0" loading="lazy"><figcaption>52</figcaption></figure><p>查看是如何创建容器的：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContextClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contextClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">SERVLET</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_SERVLET_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">REACTIVE</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_REACTIVE_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是一个WEB容器：<strong>DEFAULT_SERVLET_WEB_CONTEXT_CLASS</strong>，如果是一个普通容器就创建：<strong>DEFAULT_CONTEXT_CLASS</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>    /**
     * The class name of application context that will be used by default for non-web
     * environments.
     */
    public static final String DEFAULT_CONTEXT_CLASS = &quot;org.springframework.context.&quot;
            + &quot;annotation.AnnotationConfigApplicationContext&quot;;
    /**
     * The class name of application context that will be used by default for web
     * environments.
     */
    public static final String DEFAULT_SERVLET_WEB_CONTEXT_CLASS = &quot;org.springframework.boot.&quot;
            + &quot;web.servlet.context.AnnotationConfigServletWebServerApplicationContext&quot;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要是刷新IOC容器</p><figure><img src="/assets/53-e20a1387.png" alt="53" tabindex="0" loading="lazy"><figcaption>53</figcaption></figure><p>刷新IOC容器</p><figure><img src="/assets/54-50256c4e.png" alt="54" tabindex="0" loading="lazy"><figcaption>54</figcaption></figure><p>以此类推</p><figure><img src="/assets/55-7b1af54d.png" alt="55" tabindex="0" loading="lazy"><figcaption>55</figcaption></figure><figure><img src="/assets/56-f4be0b49.png" alt="56" tabindex="0" loading="lazy"><figcaption>56</figcaption></figure><figure><img src="/assets/57-550049f7.png" alt="57" tabindex="0" loading="lazy"><figcaption>57</figcaption></figure><p>然后就创建嵌入式的servlet容器：</p><figure><img src="/assets/58-8bbbfb64.png" alt="58" tabindex="0" loading="lazy"><figcaption>58</figcaption></figure><p>然后就获取到了嵌入式servlet容器</p><figure><img src="/assets/59-290b23fa.png" alt="59" tabindex="0" loading="lazy"><figcaption>59</figcaption></figure><p><strong>小结</strong>：IOC容器启动创建嵌入式的servlet容器</p><ol><li><p>SpringBoot启动运行run方法</p></li><li><p>刷新IOC容器（创建IOC容器对象，初始化容器，创建每一个组件）</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后开始创建web容器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果是web环境创建：AnnotationConfigServletWebServerApplicationContext</p><p>否则创建：AnnotationConfigApplicationContext</p><ol start="3"><li>刷新刚才创建号的IOC容器：</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li><p>调用onRefresh()，web的IOC容器重写了onRefresh方法</p></li><li><p>webIOC容器会创建嵌入式的Servlet容器</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">createWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>获取嵌入式的Servlet容器工厂</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token function">getWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后从IOC容器中获取TomcatServletWebServerFactory组件；</p><p>后置处理器：BeanPostProcessorsRegistrar 获取所有的定制器来定制Servlet的相关配置</p><ol start="7"><li>嵌入式Servlet容器创建并启动Tomcat</li></ol><h2 id="整合jdbc" tabindex="-1"><a class="header-anchor" href="#整合jdbc" aria-hidden="true">#</a> 整合JDBC</h2><p>YAML配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自动配置原理-2" tabindex="-1"><a class="header-anchor" href="#自动配置原理-2" aria-hidden="true">#</a> 自动配置原理</h3><p>DataSourceProperties</p><ol><li>DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池，可以使用spring.datasource.type自定义数据源类型</li></ol><ul><li>Tomcat</li><li>Hikari</li><li>Dbcp2</li><li>Generic 自定义数据源</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.type&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Generic</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用DataSourceBuilder创建数据源，利用创建响应type的数据源，并且绑定相关属性</span>
        <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>DataSourceAutoConfiguration</p></li><li><p>JdbcTemplateAutoConfiguration</p></li></ol><h2 id="整合druid" tabindex="-1"><a class="header-anchor" href="#整合druid" aria-hidden="true">#</a> 整合Druid</h2><p>导入POM：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先配置YAML：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token comment">#   数据源其他配置</span>
    <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
    <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
    <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙</span>
    <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>log4j
    <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">useGlobalDataSourceStat</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">connectionProperties</span><span class="token punctuation">:</span> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Druid</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    配置监控</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">statViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRegistrationBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StatViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;loginUsername&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;loginPassword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;allow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认所有</span>
<span class="token comment">//        initParams.put(&quot;deny&quot;, &quot;&quot;); // 拒绝访问</span>
        bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    配置一个web监控的filter</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">webStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FilterRegistrationBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;exclusions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.js,*.css,/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就可以看见查询的信息：</p><figure><img src="/assets/60-07fade98.png" alt="60" tabindex="0" loading="lazy"><figcaption>60</figcaption></figure><p>SpringBoot2 使用YAML直接配置监控器和访问地址：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token comment">#   数据源其他配置</span>
    <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
    <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
    <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙</span>
    <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>log4j
    <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">useGlobalDataSourceStat</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">connectionProperties</span><span class="token punctuation">:</span> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall
      <span class="token key atrule">aop-patterns</span><span class="token punctuation">:</span> com.javayh.druid.*
      <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*
        <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> /druid/*<span class="token punctuation">,</span><span class="token important">*.js</span><span class="token punctuation">,</span><span class="token important">*.gif</span><span class="token punctuation">,</span><span class="token important">*.jpg</span><span class="token punctuation">,</span><span class="token important">*.bmp</span><span class="token punctuation">,</span><span class="token important">*.png</span><span class="token punctuation">,</span><span class="token important">*.css</span><span class="token punctuation">,</span><span class="token important">*.ico</span>
        <span class="token key atrule">session-stat-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">session-stat-max-count</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>
        <span class="token comment"># 是否启用statViewServlet配置</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 访问监控页面</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/druid/*&quot;</span>
        <span class="token comment"># 禁止手动重置监控数据</span>
        <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token comment"># 设置监控页面的登陆名</span>
        <span class="token key atrule">login-username</span><span class="token punctuation">:</span> admin
        <span class="token comment"># 设置监控页面的登陆密码</span>
        <span class="token key atrule">login-password</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="整合mybatis" tabindex="-1"><a class="header-anchor" href="#整合mybatis" aria-hidden="true">#</a> 整合Mybatis</h2><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven" aria-hidden="true">#</a> Maven</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用注解" tabindex="-1"><a class="header-anchor" href="#使用注解" aria-hidden="true">#</a> 使用注解</h3><p>创建实体类进行测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> gender<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> dId<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> departmentName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用注解**@Mapper**标注使用Mybatis</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DepartmentMapper</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from department where id = #{id} ;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDepById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;delete from department where id = #{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteDepById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into department (department_name) values (#{departmentName});&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update department set department_name=#{departmentName} where id = #{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateDept</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以自定义Mybatis：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@org.springframework.context.annotation.Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConfigurationCustomizer</span> <span class="token function">configurationCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConfigurationCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                configuration<span class="token punctuation">.</span><span class="token function">setMapUnderscoreToCamelCase</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果@Mapper过多可以在主类中使用**@MapperScan**批量扫描接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;cn.zhiyucs.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootMybatis01Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootMybatis01Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用配置文件" tabindex="-1"><a class="header-anchor" href="#使用配置文件" aria-hidden="true">#</a> 使用配置文件</h3><p>创建Mybatis目录结构：</p><figure><img src="/assets/61-bdd6a332.png" alt="61" tabindex="0" loading="lazy"><figcaption>61</figcaption></figure><p>Mybatis主配置environment可以什么都不写：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapUnderscoreToCamelCase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在主配置文件中配置MyBatis：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">config-location</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mybatis<span class="token punctuation">-</span>config.xml
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springboot启动原理" tabindex="-1"><a class="header-anchor" href="#springboot启动原理" aria-hidden="true">#</a> SpringBoot启动原理</h2><p>程序入口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootStartertheoryApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第一步-创建springapplication对象" tabindex="-1"><a class="header-anchor" href="#第一步-创建springapplication对象" aria-hidden="true">#</a> 第一步：创建SpringApplication对象</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> primarySource<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> primarySource <span class="token punctuation">}</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> primarySources<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以观察它的构造方法：创建方法见下面</p><p>主要是配置两个类</p><ul><li>ApplicationContextInitializer</li><li>SpringApplicationRunListener</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> primarySources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> resourceLoader<span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">,</span> <span class="token string">&quot;PrimarySources must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 配置source</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>primarySources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断是否是web应用</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType <span class="token operator">=</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span><span class="token function">deduceFromClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建初始化构造器</span>
    <span class="token function">setInitializers</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建应用监听器</span>
    <span class="token function">setListeners</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 推断出main方法类</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass <span class="token operator">=</span> <span class="token function">deduceMainpplicationClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再进入：getSpringFactoriesInstances</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取类加载器</span>
    <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Use names and ensure unique to protect against duplicates</span>
    <span class="token comment">// 通过类加载器，获取指定的META-INF/spring.factories文件，获取文件中工厂类的全类名</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过类路径反射得到工厂对象，构造方法</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> <span class="token function">createSpringFactoriesInstances</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">,</span> classLoader<span class="token punctuation">,</span> args<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> instances<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过loadFactoryNames就可以知道</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORIES_RESOURCE_LOCATION</span> <span class="token operator">=</span> <span class="token string">&quot;META-INF/spring.factories&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="第二步-启动应用" tabindex="-1"><a class="header-anchor" href="#第二步-启动应用" aria-hidden="true">#</a> 第二步：启动应用</h3><p>主类：ConfigurableApplicationContext</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 应用启动计时器开始计时</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">&gt;</span></span> exceptionReporters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Headless模式配置（做AWT，暂时不用管）</span>
    <span class="token function">configureHeadlessProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取启动监听器</span>
    <span class="token class-name">SpringApplicationRunListeners</span> listeners <span class="token operator">=</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 应用启动监听器开始计时（回调所有的SpringApplicationRunListeners.starting()）</span>
    listeners<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 封装命令行参数</span>
        <span class="token class-name">ApplicationArguments</span> applicationArguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultApplicationArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 配置环境模块（祥见下面prepareEnvironment方法）</span>
        <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 配置需要忽略的bean</span>
        <span class="token function">configureIgnoreBeanInfo</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Banner配置(打印Spring的图标)</span>
        <span class="token class-name">Banner</span> printedBanner <span class="token operator">=</span> <span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建应用上下文对象</span>
        context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 异常分析报告</span>
        exceptionReporters <span class="token operator">=</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                                                         <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 上下文基本属性配置（祥见下面prepareContext方法）</span>
        <span class="token function">prepareContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 更新应用上下文/刷新IOC容器（祥见下面refresh方法）</span>
        <span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从IOC容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span>
        <span class="token comment">// 先ApplicationRunner</span>
        <span class="token function">afterRefresh</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">StartupInfoLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logStarted</span><span class="token punctuation">(</span><span class="token function">getApplicationLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stopWatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        listeners<span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callRunners</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        listeners<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 整个SpringBoot启动完成返回IOC容器</span>
    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取监听器的方法：<strong>getSpringFactoriesInstances</strong>，可以看出也是从<strong>META-INF</strong>获取</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SpringApplicationRunListeners</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplicationRunListeners</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span>
                                             <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> types<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Listener环境：<strong>prepareEnvironment</strong>(listeners, applicationArguments);</p><p>环境完成后回调SpringApplicationRunListeners.environmentPrepared方法，表示环境准备完成</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span>
                                                   <span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create and configure the environment</span>
    <span class="token comment">// 创建配置环境</span>
    <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">getOrCreateEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 加载属性文件</span>
    <span class="token function">configureEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">.</span><span class="token function">getSourceArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听器监听配置</span>
    listeners<span class="token punctuation">.</span><span class="token function">environmentPrepared</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bindToSpringApplication</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCustomEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnvironmentConverter</span><span class="token punctuation">(</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertEnvironmentIfNecessary</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span>
                                                                                               <span class="token function">deduceEnvironmentClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> environment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到放行Banner后出现：</p><figure><img src="/assets/63-f99f616f.png" alt="63" tabindex="0" loading="lazy"><figcaption>63</figcaption></figure><p>然后看<strong>createApplicationContext</strong>：决定创建</p><p>WEB（DEFAULT_SERVLET_WEB_CONTEXT_CLASS）</p><p>还是</p><p>普通IOC（DEFAULT_CONTEXT_CLASS）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContextClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contextClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">SERVLET</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_SERVLET_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">REACTIVE</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_REACTIVE_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Unable create a default ApplicationContext, please specify an ApplicationContextClass&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">)</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>contextClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看<strong>prepareContext</strong>准备上下文：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">prepareContext</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span>
                            <span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">,</span> <span class="token class-name">Banner</span> printedBanner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 保存刚刚的environment</span>
    context<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 后置处理器，注册小组件</span>
    <span class="token function">postProcessApplicationContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 主要：</span>
    <span class="token function">applyInitializers</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listeners<span class="token punctuation">.</span><span class="token function">contextPrepared</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logStartupInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">logStartupProfileInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Add boot specific singleton beans</span>
    <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springApplicationArguments&quot;</span><span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>printedBanner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springBootBanner&quot;</span><span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setAllowBeanDefinitionOverriding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowBeanDefinitionOverriding<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazyInitialization<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">addBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyInitializationBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Load the sources</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sources <span class="token operator">=</span> <span class="token function">getAllSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> <span class="token string">&quot;Sources must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">load</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> sources<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 完成后回调contextLoaded</span>
    listeners<span class="token punctuation">.</span><span class="token function">contextLoaded</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看关键的applyInitializers，回调之前保存的ApplicationContextInitializer的initialize：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">applyInitializers</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContextInitializer</span> initializer <span class="token operator">:</span> <span class="token function">getInitializers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> requiredType <span class="token operator">=</span> <span class="token class-name">GenericTypeResolver</span><span class="token punctuation">.</span><span class="token function">resolveTypeArgument</span><span class="token punctuation">(</span>initializer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                        <span class="token class-name">ApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span>requiredType<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token string">&quot;Unable to call initializer.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initializer<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后看 listeners.contextPrepared(context); 回调之前的SpringApplicationRunListener的contextPrepared方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">contextPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span> listener <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        listener<span class="token punctuation">.</span><span class="token function">contextPrepared</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后开始刷新容器<strong>refreshContext(context)</strong>：（配置、组件、自动配置）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> var1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//准备更新上下文时的预备工作：1.初始化PropertySource; 2.验证Enrivonment中必要的属性</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取上下文中的BeanFactory</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//对BeanFactory做些预备工作</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//对BeanFactory进行预处理</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//执行容器中的BeanFactoryPostProcessor</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注册BeanPostProcessor</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化MessageSource(国际化相关)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化容器事件广播器(用来发布事件)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化一些特殊的Bean,主要做了: 1.初始化ThemeSource(跟国际化相关的接口) 2.创建WebServer</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将所有监听器注册到前两步创建的事件广播器中</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//结束BeanFactory的初始化工作(这一步主要用来将所有的单例BeanDefinition实例化)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//上下文刷新完毕</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> var9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> <span class="token operator">+</span> var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cancelRefresh</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> var9<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基于原理的测试笔记-测试启动的四个类" tabindex="-1"><a class="header-anchor" href="#基于原理的测试笔记-测试启动的四个类" aria-hidden="true">#</a> （基于原理的测试笔记）测试启动的四个类</h2><p>测试类：</p><ul><li>ApplicationContextInitializer</li><li>SpringApplicationRunListener</li><li>ApplicationRunner</li><li>CommandLineRunner</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloApplicationContextInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationContextInitializer............initialize........&quot;</span> <span class="token operator">+</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSpringApplicationRunListener</span> <span class="token keyword">implements</span> <span class="token class-name">SpringApplicationRunListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">HelloSpringApplicationRunListener</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span> application<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener......starting.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">environmentPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getSystemEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........environmentPrepared.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........contextPrepared.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoaded</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........contextLoaded.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">started</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........started.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">running</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloApplicationRunner</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationRunner</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationRunner.........run.........&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCommandLineRunner</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CommandLineRunner............run........&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在主配置类中（application.properties）配置前两个类：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">org.springframework.context.ApplicationContextInitializer</span><span class="token punctuation">=</span><span class="token value attr-value">\
cn.zhiyucs.listener.HelloApplicationContextInitializer</span>
<span class="token key attr-name">org.springframework.boot.SpringApplicationRunListener</span><span class="token punctuation">=</span><span class="token value attr-value">\
cn.zhiyucs.listener.HelloSpringApplicationRunListener</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义starters【暂时无法理解】" tabindex="-1"><a class="header-anchor" href="#自定义starters【暂时无法理解】" aria-hidden="true">#</a> 自定义starters【暂时无法理解】</h2><p>编写自动配置类需要的注解：</p><ul><li><strong>@Configuration</strong> 指定是一个配置类</li><li><strong>@Conditionalxxx</strong> 指定条件成立的时候自动配置生效</li><li><strong>@AutoConfigureOrder</strong> 指定自动配置类的顺序</li><li><strong>@AutoConfigureAfter</strong></li><li><strong>@Bean</strong> 给容器添加组件</li><li><strong>@ConfigurationProperties(prefix = &quot;&quot;)</strong> 绑定相关的配置</li><li><strong>@EnableConfigurationProperties</strong> 让xxxProperties生效加入到容器中</li></ul><p>加入到META-INF-factories里面：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># Initializers</span>
<span class="token key attr-name">org.springframework.context.ApplicationContextInitializer</span><span class="token punctuation">=</span><span class="token value attr-value">\
org.springframework.boot.autoconfigure.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>引入模式：</p><p>启动器依赖自动模式，只需引入starter即可</p><p>推荐命名：xxx-spring-boot-starter</p><figure><img src="/assets/64-9064e705.jpg" alt="64" tabindex="0" loading="lazy"><figcaption>64</figcaption></figure><p>创建一个空工程</p><p>创建一个model</p><figure><img src="/assets/65-300da39c.png" alt="65" tabindex="0" loading="lazy"><figcaption>65</figcaption></figure><p>创建一个springbootInitialize</p><figure><img src="/assets/66-50ea65ee.png" alt="66" tabindex="0" loading="lazy"><figcaption>66</figcaption></figure><h2 id="springboot缓存基本使用" tabindex="-1"><a class="header-anchor" href="#springboot缓存基本使用" aria-hidden="true">#</a> SpringBoot缓存基本使用</h2><p>应用--缓存--数据库的关系</p><figure><img src="/assets/67-61b87b61.png" alt="67" tabindex="0" loading="lazy"><figcaption>67</figcaption></figure><p>几个重要的缓存注解：</p><table><thead><tr><th>Cache</th><th>缓存接口，定义缓存操作。实现有：RedisCache、EhCacheCache、ConcurrentMapCache等</th></tr></thead><tbody><tr><td>CacheManager</td><td>缓存管理器，管理各种缓存（Cache）组件</td></tr><tr><td>@Cacheable</td><td>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存</td></tr><tr><td>@CacheEvict</td><td>清空缓存</td></tr><tr><td>@CachePut</td><td>保证方法被调用，又希望结果被缓存。</td></tr><tr><td>@EnableCaching</td><td>开启基于注解的缓存</td></tr><tr><td>keyGenerator</td><td>缓存数据时key生成策略</td></tr><tr><td>serialize</td><td>缓存数据时value序列化策略</td></tr></tbody></table><p>缓存的spel</p><table><thead><tr><th>名字</th><th>位置</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>methodName</td><td>root object</td><td>当前被调用的方法名</td><td>#root.methodName</td></tr><tr><td>method</td><td>root object</td><td>当前被调用的方法</td><td>#<a href="http://root.method.name" target="_blank" rel="noopener noreferrer">root.method.name<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td></tr><tr><td>target</td><td>root object</td><td>当前被调用的目标对象</td><td>#root.target</td></tr><tr><td>targetClass</td><td>root object</td><td>当前被调用的目标对象类</td><td>#root.targetClass</td></tr><tr><td>args</td><td>root object</td><td>当前被调用的方法的参数列表</td><td>#root.args[0]</td></tr><tr><td>caches</td><td>root object</td><td>当前方法调用使用的缓存列表（如@Cacheable(value={&quot;cache1&quot;, &quot;cache2&quot;})），则有两个cache</td><td>#root.caches[0].name</td></tr><tr><td><em>argument name</em></td><td>evaluation context</td><td>方法参数的名字. 可以直接 #参数名 ，也可以使用 #p0或#a0 的形式，0代表参数的索引；</td><td>#iban 、 #a0 、 #p0</td></tr><tr><td>result</td><td>evaluation context</td><td>方法执行后的返回值（仅当方法执行之后的判断有效，如‘unless’，’cache put’的表达式 ’cache evict’的表达式beforeInvocation=false）</td><td>#result</td></tr></tbody></table><h3 id="基本使用" tabindex="-1"><a class="header-anchor" href="#基本使用" aria-hidden="true">#</a> 基本使用</h3><p>在主类开启**@EnableCaching**缓存</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;cn.zhiyucs.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootCache01Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootCache01Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要缓存的方法开启**@Cacheable**：（介绍见注释）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @Cacheable :将方法结果放入缓存，以后要有相同的数据直接从缓存中获取，不用调方法
     * CacheManager 管理多个cache组件，对缓存的真正CRUD操作再cache组件中，每一个缓存都有自己唯一的名字
     * @Cacheable几个属性：
     *      cacheNames/value: 指定缓存组件的名字
     *      key: 缓存数据使用的key，默认是使用参数方法参数的值， 1-方法的返回值
     *      keyGenerator: key的生成器，可以自己指定key的生成器的组件id
     *          key / keyGenerator 二选一
     *      cacheManager: 指定缓存管理器/缓存解析器（cacheResolver）
     *      condition: 指定符合条件下才缓存
     *      unless: 否定缓存,当unless指定的条件为true，方法的返回值就不会被缓存
     *          eg. unless = &quot;#result == null&quot; 数据为空不缓存
     *      sync: 是否使用异步模式
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>condition <span class="token operator">=</span> <span class="token string">&quot;#id&gt;0&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#result == null&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;缓存测试专业SOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Employee</span> emp <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> emp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据库方面：开启驼峰命名自动映射，开启打印SQL：</p><p>打印SQL：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">logging.level.cn.zhiyucs.mapper</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>驼峰命名自动映射：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="几个属性介绍" tabindex="-1"><a class="header-anchor" href="#几个属性介绍" aria-hidden="true">#</a> 几个属性介绍</h3><p>cacheNames/value: 指定缓存组件的名字，将方法的返回结果放在哪个缓存中，是数组的方式，可以指定多个</p><p>condition #a0&gt;1的意思是当第一个参数的值大于1才生效</p><p>unless 同理，第一个参数为2的话就不会缓存</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;keyGenerator&quot;</span><span class="token punctuation">,</span> condition <span class="token operator">=</span> <span class="token string">&quot;#a0&gt;1&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#a0==2&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>key的两种方法：</strong></p><ul><li>直接指定：<strong>key = &quot;#root.methodName+&#39;[&#39;+#id+&#39;]&quot;</strong></li><li>使用配置类指定：</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCacheConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KeyGenerator</span> <span class="token function">keyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;[&quot;</span><span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后直接调用即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;keyGenerator&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="缓存自动配置原理" tabindex="-1"><a class="header-anchor" href="#缓存自动配置原理" aria-hidden="true">#</a> 缓存自动配置原理</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token class-name">CacheAspectSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;cacheResolver&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">CouchbaseAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">HazelcastAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">HibernateJpaAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RedisAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">CacheConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">CacheManagerEntityManagerFactoryDependsOnPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个类主要是导入了：CacheConfigurationImportSelector，导入了缓存要用的组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfigurationImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CacheType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>types<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> types<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            imports<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">CacheConfigurations</span><span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span>types<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> imports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要是导入了这几个组件：默认使用的是 -- SimpleCacheConfiguration</p><figure><img src="/assets/68-411b714f.png" alt="68" tabindex="0" loading="lazy"><figcaption>68</figcaption></figure><p><strong>SimpleCacheConfiguration</strong>：给容器中注册了一个cacheManager</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">ConcurrentMapCacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span> cacheProperties<span class="token punctuation">,</span>
                                       <span class="token class-name">CacheManagerCustomizers</span> cacheManagerCustomizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ConcurrentMapCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cacheNames <span class="token operator">=</span> cacheProperties<span class="token punctuation">.</span><span class="token function">getCacheNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cacheNames<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">setCacheNames</span><span class="token punctuation">(</span>cacheNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cacheManagerCustomizers<span class="token punctuation">.</span><span class="token function">customize</span><span class="token punctuation">(</span>cacheManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入<strong>ConcurrentMapCacheManager</strong></p><p>cacheManager的作用是：通过进入<strong>createConcurrentMapCache</strong>方法，可知这个主要是创建了<strong>ConcurrentMapCache</strong>类型的缓存组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Cache</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Cache</span> cache <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cache <span class="token operator">=</span> <span class="token function">createConcurrentMapCache</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ConcurrentMapCache</strong>的作用是把数据保存在ConcurrentMap&lt;Object, Object&gt;中：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> store<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="以-cacheable为例" tabindex="-1"><a class="header-anchor" href="#以-cacheable为例" aria-hidden="true">#</a> 以@Cacheable为例</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>condition <span class="token operator">=</span> <span class="token string">&quot;#id&gt;0&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#result == null&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>方法运行之前，先去查询Cache（缓存组件），按照cacheNames指定的名字获取：CacheManager先获取相应的缓存，第一次获取缓存会自动创建出来（createConcurrentMapCache(name)）</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Cache</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/69-d41f7fe5.png" alt="69" tabindex="0" loading="lazy"><figcaption>69</figcaption></figure><ol start="2"><li>Cache查找缓存的内容，使用一个key -- 默认是方法的参数，</li></ol><p>key是按照某种策略生成的，默认是使用keyGennerator生成 -- 默认使用的是SimpleKeyGennerator</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 生成策略</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SimpleKey</span><span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> param <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>param<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> param<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleKey</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>operation<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EvaluationContext</span> evaluationContext <span class="token operator">=</span> <span class="token function">createEvaluationContext</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> evaluator<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>operation<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>methodKey<span class="token punctuation">,</span> evaluationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>keyGenerator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>method<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/70-8a5122dc.png" alt="70" tabindex="0" loading="lazy"><figcaption>70</figcaption></figure><p>查询缓存的方法：（AbstractValueAdaptingCache.class）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">ValueWrapper</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token function">lookup</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">toValueWrapper</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>没有查到缓存就调用目标方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/71-733aba71.png" alt="71" tabindex="0" loading="lazy"><figcaption>71</figcaption></figure><ol start="4"><li>将目标方法返回的结果，放进缓存中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">toStoreValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/72-2c156747.png" alt="72" tabindex="0" loading="lazy"><figcaption>72</figcaption></figure><p>第二次再访问时：lookup和getCache都会被访问到</p><p>lookup找到缓存后会转到 ValueWrapper get(Object key) 得到值；</p><h3 id="小结-3" tabindex="-1"><a class="header-anchor" href="#小结-3" aria-hidden="true">#</a> 小结：</h3><h4 id="核心" tabindex="-1"><a class="header-anchor" href="#核心" aria-hidden="true">#</a> 核心：</h4><ol><li><p>使用CacheManager（ConcurrentMapCacheManager）按照名字得到Cache组件（ConcurrentMapCache）</p></li><li><p>key使用的是keyGennerator生成，默认是SimpleKeyGennerator</p></li><li><p>@Cacheable标注的方法执行前先检查缓存中有没有这个数据，默认按照参数的值作为key去查询缓存，如果没有就运行方法并将结果放入缓存。 以后再来调用就直接使用缓存中的数据</p></li><li><p>SimpleKeyGennerator生成策略：</p></li></ol><ul><li>如果没有参数，key就使用key = new SimpleKey()</li><li>如果有一个参数key=参数的值</li><li>如果有多个参数key = new SimpleKey(params)</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleKeyGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">KeyGenerator</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">generateKey</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/73-b6aa1cb1.png" alt="73" tabindex="0" loading="lazy"><figcaption>73</figcaption></figure><h4 id="思路整理" tabindex="-1"><a class="header-anchor" href="#思路整理" aria-hidden="true">#</a> 思路整理</h4><p>ConcurrentMapCacheManager通过getCache获取到name（key）</p><ol><li>第一次访问，没有缓存的情况</li></ol><p>createConcurrentMapCache -&gt; lookup根据key(key有生成策略)查找缓存的数据 -&gt; 调用目标方法 -&gt; 把数据放在缓存（store）里(this.store.put(key, toStoreValue(value)))</p><ol start="2"><li>第二次访问</li></ol><figure><img src="/assets/74-3992b12b.png" alt="74" tabindex="0" loading="lazy"><figcaption>74</figcaption></figure><p>Cache cache = this.cacheMap.get(name);调回缓存的数据-&gt; 返回方法</p><h2 id="cacheput的使用" tabindex="-1"><a class="header-anchor" href="#cacheput的使用" aria-hidden="true">#</a> @CachePut的使用</h2><p><strong>@CachePut</strong>的key属性有两种写法：</p><ul><li>key = &quot;#<a href="http://employee.id" target="_blank" rel="noopener noreferrer">employee.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>&quot;</li><li>key = &quot;#<a href="http://result.id" target="_blank" rel="noopener noreferrer">result.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>&quot;</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @CachePut 既调用方法，又更新缓存
     * 修改了数据库的某个数据，同时更新缓存
     * 运行时机：
     *  1. 先调用目标方法
     *  2. 将目标方法的结果缓存起来
     */</span>
    <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">updateEmp</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        employeeMapper<span class="token punctuation">.</span><span class="token function">updateEmp</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> employee<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了实现同步缓存，这里的cacheNames可以和查询方法的一样，这样就可以实现更新的同时更换缓存的内容，从而达到查询也同步缓存。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/75-541ef9e1.png" alt="75" tabindex="0" loading="lazy"><figcaption>75</figcaption></figure><figure><img src="/assets/76-1d215401.png" alt="76" tabindex="0" loading="lazy"><figcaption>76</figcaption></figure><h2 id="cacheevict-清除缓存" tabindex="-1"><a class="header-anchor" href="#cacheevict-清除缓存" aria-hidden="true">#</a> @CacheEvict 清除缓存</h2><p>@CacheEvict要清除name为emp缓存中key为id的所有数据</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @CacheEvict 缓存清除
     * key 指定要清除的数据
     * allEntries 要清除这个缓存中的所有数据
     * beforeInvocation = false 缓存的清除是否在方法之前执行，默认时在方法执行之后执行
     *      如果出现异常就不会清除
     */</span>
<span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;#id&quot;</span><span class="token punctuation">,</span> allEntries <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> beforeInvocation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;deleteEmp:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//        employeeMapper.deleteEmpById(id);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="caching和-cacheconfig" tabindex="-1"><a class="header-anchor" href="#caching和-cacheconfig" aria-hidden="true">#</a> @Caching和@CacheConfig</h2><h3 id="caching" tabindex="-1"><a class="header-anchor" href="#caching" aria-hidden="true">#</a> @Caching</h3><p>​ <strong>@Caching</strong> 这个caching因为使用了**@CachePut**所以第二次还是会执行，但是如果执行了通过id和email查询就在执行了这个方法后就直接执行，因为这个方法已经缓存了这个内容</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @Caching 定义复杂的缓存规则
     * <span class="token keyword">@param</span> <span class="token parameter">lastName</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Caching</span><span class="token punctuation">(</span>
    cacheable <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#lastName&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    put <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.email&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmpByLastName</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpByLastName</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cacheconfig" tabindex="-1"><a class="header-anchor" href="#cacheconfig" aria-hidden="true">#</a> @CacheConfig</h3><p>使用了这个直接之后，之后的所有注解（@Cacheable、@CachePut）就不用写已经在@CacheConfig中写了的属性</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@CacheConfig</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">)</span> <span class="token comment">//抽取缓存的公共配置</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeService</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="整合缓存中间件redis" tabindex="-1"><a class="header-anchor" href="#整合缓存中间件redis" aria-hidden="true">#</a> 整合缓存中间件Redis</h2><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Redis：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在要是有Redis的地方注入redis：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span> <span class="token comment">// 操作字符串</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span> <span class="token comment">// k-v操作对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接使用Redis类型：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> msg <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义Redis类型（JSON类型）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">empRedisTemplate</span><span class="token punctuation">(</span>
            <span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就可以注入这个自定义的类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employeeRedisTemplate<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Employee</span> emp <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> employeeRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/77-4dfb1413.png" alt="77" tabindex="0" loading="lazy"><figcaption>77</figcaption></figure><h2 id="自定义rediscachemanager" tabindex="-1"><a class="header-anchor" href="#自定义rediscachemanager" aria-hidden="true">#</a> 自定义RedisCacheManager</h2><p>在配置类中直接添加即可：实现序列化转为JSON格式</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 缓存管理器
     */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//初始化一个RedisCacheWriter</span>
    <span class="token class-name">RedisCacheWriter</span> redisCacheWriter <span class="token operator">=</span> <span class="token class-name">RedisCacheWriter</span><span class="token punctuation">.</span><span class="token function">nonLockingRedisCacheWriter</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置CacheManager的值序列化方式为json序列化</span>
    <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> jsonSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> pair <span class="token operator">=</span> <span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span>
        <span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jsonSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisCacheConfiguration</span> defaultCacheConfig<span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置默认超过期时间是30秒</span>
    defaultCacheConfig<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化RedisCacheManager</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span>redisCacheWriter<span class="token punctuation">,</span> defaultCacheConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/78-94fd2ecb.png" alt="78" tabindex="0" loading="lazy"><figcaption>78</figcaption></figure><p>有两种调用方式：</p><p>第一种就是常用的注解：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询部门&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> department <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种是注入CacheManager后得到缓存，进行API调用：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">CacheManager</span> cacheManager<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询部门&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> department <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Cache</span> dept <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dept<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/79-bdf4e687.png" alt="79" tabindex="0" loading="lazy"><figcaption>79</figcaption></figure><h4 id="扩展cachemanager的用法" tabindex="-1"><a class="header-anchor" href="#扩展cachemanager的用法" aria-hidden="true">#</a> 扩展CacheManager的用法</h4><p>判断在Redis中是否存在这个nosql，如果有就直接使用缓存，不查数据库，如果没有就查数据库缓存数据：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Department</span> dp<span class="token punctuation">;</span>
    <span class="token class-name">Cache</span> dept <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dp <span class="token operator">=</span> dept<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dp <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dept<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springsecurity的简单使用" tabindex="-1"><a class="header-anchor" href="#springsecurity的简单使用" aria-hidden="true">#</a> SpringSecurity的简单使用</h2><p>导包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>建立一个配置类：</p><p>@EnableWebSecurity 开启安全配置，它里面有@Configuration</p><p>继承： WebSecurityConfigurerAdapter</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@EnableWebSecurity
public class MySecurityConfig extends WebSecurityConfigurerAdapter {
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义授权规则和定义认证规则</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 定义授权规则
@Override
protected void configure(HttpSecurity http) throws Exception {
    //        super.configure(http);
    // 定制授权规则
    http.authorizeRequests().antMatchers(&quot;/&quot;).permitAll()
        .antMatchers(&quot;/level1/**&quot;).hasRole(&quot;VIP1&quot;)
        .antMatchers(&quot;/level2/**&quot;).hasRole(&quot;VIP2&quot;)
        .antMatchers(&quot;/level3/**&quot;).hasRole(&quot;VIP3&quot;);
    // 开启自动配置的登录功能
    // /login来到登录页
    // 重定向到/login/error登录失败
    // 如果没有登录权限就会来到登录页面
    http.formLogin();
    // 开启自动配置的注销功能
    // 访问/login注销用户，清空session
    // 注销成功会返回/login?logout
    http.logout().logoutSuccessUrl(&quot;/&quot;);
}
// 定义认证规则
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    //super.configure(auth);
    auth.inMemoryAuthentication().passwordEncoder(NoOpPasswordEncoder.getInstance())
        .withUser(&quot;admin&quot;).password(&quot;123&quot;).roles(&quot;VIP1&quot;,&quot;VIP2&quot;)
        .and()
        .withUser(&quot;lisi&quot;).password(&quot;123&quot;).roles(&quot;VIP2&quot;, &quot;VIP3&quot;)
        .and()
        .withUser(&quot;zhiyu&quot;).password(&quot;123&quot;).roles(&quot;VIP1&quot;, &quot;VIP3&quot;);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="thymeleaf整合springsecurity" tabindex="-1"><a class="header-anchor" href="#thymeleaf整合springsecurity" aria-hidden="true">#</a> Thymeleaf整合SpringSecurity</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf.extras<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-springsecurity5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前端加入额外的xmlns：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org/extras/spring-security<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>判定是否授权了：<strong>sec:authorize=&quot;!isAuthenticated()&quot;</strong></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!isAuthenticated()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>游客您好，如果想查看武林秘籍 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>请登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>获取授权名：<strong>sec:authentication=&quot;name&quot;</strong></li><li>获取授权的权限名：<strong>sec:authentication=&quot;principal.authorities&quot;</strong></li><li>注销登录：<strong>th:action=&quot;@{/logout}&quot;</strong></li><li>判断是否存在这个权限：<strong>sec:authorize=&quot;hasRole(&#39;权限名字&#39;)&quot;</strong></li></ul><h3 id="记住我" tabindex="-1"><a class="header-anchor" href="#记住我" aria-hidden="true">#</a> <strong>记住我</strong></h3><p>直接在授权规则的configure配置即可</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 开启记住我功能</span>
<span class="token comment">// 登录成功将cookie发给浏览器保存，以后登录就会带上这个cookie(14天)</span>
http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="定制自己的登录页面" tabindex="-1"><a class="header-anchor" href="#定制自己的登录页面" aria-hidden="true">#</a> 定制自己的登录页面</h3><p>直接在授权规则的configure配置，</p><p>前端使用post方式：处理凭据，如果有效，则对用户进行身份验证</p><p>使用get：处理登录表格</p><p>如果action定位到userlogin/error，方法get：重定向到此处以进行失败的身份验证尝试</p><p>如果action定位到userlogin/logout，方法get：成功注销后重定向到此处</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/userlogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认post请求的/login是处理登录</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/userlogin}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
            密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 记住我 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登陆<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shiro的简单使用" tabindex="-1"><a class="header-anchor" href="#shiro的简单使用" aria-hidden="true">#</a> Shiro的简单使用</h2><p>Shiro的功能框架图：</p><figure><img src="/assets/80-de8cc043.png" alt="80" tabindex="0" loading="lazy"><figcaption>80</figcaption></figure><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试环境设置（省略跳转网页的controller）：</p><figure><img src="/assets/81-abde2017.png" alt="81" tabindex="0" loading="lazy"><figcaption>81</figcaption></figure><p>注：使用Thymeleaf模板的时候需要用到跳转页面@{}注意，如：th:href=&quot;@{/alogin}&quot;，里面内容需要是controller的内容</p><h3 id="开始配置一个shiro" tabindex="-1"><a class="header-anchor" href="#开始配置一个shiro" aria-hidden="true">#</a> 开始配置一个shiro</h3><p>Shiro 架构包含三个主要的理念：Subject 认证主体，SecurityManager 安全管理器和 Realm 域对象</p><ul><li>ShiroFilterFactoryBean ShiroFilter是整个Shiro的入口点，用于拦截需要安全控制的请求进行处理</li><li>DefaultWebSecurityManager 安全管理器</li><li>Realm 域对象</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">shiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;securityManager&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DefaultWebSecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShiroFilterFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置无权限时跳转的 url;</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setUnauthorizedUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/notRole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * anon
         * 无参，开放权限，可以理解为匿名用户或游客
         * authc
         * 无参，需要认证
         * logout
         * 无参，注销，执行后会直接跳转到shiroFilterFactoryBean.setLoginUrl(); 设置的 url
         * authcBasic
         * 无参，表示 httpBasic 认证
         * user
         * 无参，表示必须存在用户，当登入操作时不做检查
         * ssl
         * 无参，表示安全的URL请求，协议为 https
         * perms[user]
         * 参数可写多个，表示需要某个或某些权限才能通过，多个参数时写 perms[&quot;user, admin&quot;]，当有多个参数时必须每个参数都通过才算通过
         * roles[admin]
         * 参数可写多个，表示是某个或某些角色才能通过，多个参数时写 roles[&quot;admin，user&quot;]，当有多个参数时必须每个参数都通过才算通过
         * rest[user]
         * 根据请求的方法，相当于 perms[user:method]，其中 method 为 post，get，delete 等
         * port[8081]
         * 当请求的URL端口不是8081时，跳转到schemal://serverName:8081?queryString 其中 schmal 是协议 http 或 https 等等，serverName 是你访问的 Host，8081 是 Port 端口，queryString 是你访问的 URL 里的 ? 后面的参数
         */</span>
        <span class="token comment">// 设置拦截器</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> filterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/alogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[user:add]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/ulogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>filterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;userRealm&quot;</span><span class="token punctuation">)</span> <span class="token class-name">UserRealm</span> userRealm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultWebSecurityManager</span> securityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        securityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>userRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> securityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">UserRealm</span> <span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>域对象</strong>的创建</p><ul><li>继承AuthorizingRealm</li><li>主要分为：授权和认证</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token comment">// 授权</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行了授权...........&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 只要登录就有权限</span>
<span class="token comment">//        info.addStringPermission(&quot;user:add&quot;);</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> role <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//需要将 role 封装到 Set 作为 info.setRoles() 的参数</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置该用户拥有的角色</span>
        <span class="token comment">//将用户对应的角色和权限信息 放到权限器中</span>
        info<span class="token punctuation">.</span><span class="token function">addStringPermissions</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 认证</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行了认证............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        一般在数据库中取账号和密码</span>
        <span class="token class-name">UsernamePasswordToken</span> userToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> userToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// SimpleAuthenticationInfo参数：</span>
        <span class="token comment">// principle 认证实体，可以是username，也可以是实体类</span>
        <span class="token comment">// credentials 密码</span>
        <span class="token comment">// realmName 当前realm对象的name，直接调用父类的getName方法即可</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用控制层的请求把数据传输给Shiro和注销</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginAuth&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginAuth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                        <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前用户</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 封装用户的数据</span>
    <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行登录的方法</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultMap</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//注销</span>
    subject<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultMap<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">&quot;成功注销！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="整合shiro启动器" tabindex="-1"><a class="header-anchor" href="#整合shiro启动器" aria-hidden="true">#</a> 整合Shiro启动器</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-web-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>项目结构：和security测试的时候一致</p><figure><img src="/assets/82-1a8f2cc3.png" alt="82" tabindex="0" loading="lazy"><figcaption>82</figcaption></figure><p>同样的配置类：（加入了MD5盐值加密算法）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置用于匹配密码的CredentialsMatcher</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HashedCredentialsMatcher</span> <span class="token function">credentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里是使用sha256加密</span>
        <span class="token comment">/*credentialsMatcher.setHashAlgorithmName(Sha256Hash.ALGORITHM_NAME);  // 散列算法，这里使用更安全的sha256算法
        credentialsMatcher.setStoredCredentialsHexEncoded(false);  // 数据库存储的密码字段使用HEX还是BASE64方式加密
        credentialsMatcher.setHashIterations(1024);  // 散列迭代次数*/</span>
        <span class="token comment">//如果MD5密码加密,可以打开下面配置</span>
        <span class="token comment">//加密算法的名称</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//配置加密的次数</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//是否存储为16进制</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setStoredCredentialsHexEncoded</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> credentialsMatcher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 配置url过滤器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultShiroFilterChainDefinition</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level1/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip1]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level2/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip2]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level3/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip3]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultWebSecurityManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span><span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 配置自定义Realm</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">UserRealm</span> <span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserRealm</span> userRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span><span class="token function">credentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userRealm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>认证和授权：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>
<span class="token comment">//    授权</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;授权........................&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleAuthorizationInfo</span> authorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 角色</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 权限</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 测试用权限</span>
        <span class="token class-name">String</span> role <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        roles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">setStringPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    认证</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;认证........................&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAccountException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment">//        MD5盐值加密ByteSource.Util.bytes(username)</span>
        <span class="token class-name">SimpleAuthenticationInfo</span> authenticationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authenticationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>控制层判断：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/loginAuth&quot;</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginAuth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                        <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前用户</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 封装用户的数据</span>
    <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行登录的方法</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;welcome&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">PREFIX</span><span class="token operator">+</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">PREFIX</span><span class="token operator">+</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="扩展" tabindex="-1"><a class="header-anchor" href="#扩展" aria-hidden="true">#</a> 扩展：</h3><h4 id="shiro默认过滤器" tabindex="-1"><a class="header-anchor" href="#shiro默认过滤器" aria-hidden="true">#</a> shiro默认过滤器</h4><ul><li>anon AnonymousFilter 指定url可以匿名访问</li><li>authc FormAuthenticationFilter 指定url需要form表单登录，默认会从请求中获取username、password,rememberMe等参数并尝试登录，如果登录不了就会跳转到loginUrl配置的路径。我们也可以用这个过滤器做默认的登录逻辑，但是一般都是我们自己在控制器写登录逻辑的，自己写的话出错返回的信息都可以定制嘛。</li><li>authcBasic BasicHttpAuthenticationFilter 指定url需要basic登录</li><li>logout LogoutFilter 登出过滤器，配置指定url就可以实现退出功能，非常方便</li><li>noSessionCreation NoSessionCreationFilter 禁止创建会话</li><li>perms PermissionsAuthorizationFilter 需要指定权限才能访问</li><li>port PortFilter 需要指定端口才能访问</li><li>rest HttpMethodPermissionFilter 将http请求方法转化成相应的动词来构造一个权限字符串，这个感觉意义不大，有兴趣自己看源码的注释</li><li>roles RolesAuthorizationFilter 需要指定角色才能访问</li><li>ssl SslFilter 需要https请求才能访问</li><li>user UserFilter 需要已登录或“记住我”的用户才能访问</li></ul><h4 id="shiro常用的权限控制注解-可以在控制器类上使用" tabindex="-1"><a class="header-anchor" href="#shiro常用的权限控制注解-可以在控制器类上使用" aria-hidden="true">#</a> shiro常用的权限控制注解，可以在控制器类上使用</h4><ul><li>@RequiresGuest 只有游客可以访问</li><li>@RequiresAuthentication 需要登录才能访问</li><li>@RequiresUser 已登录的用户或“记住我”的用户能访问</li><li>@RequiresRoles 已登录的用户需具有指定的角色才能访问</li><li>@RequiresPermissions 已登录的用户需具有指定的权限才能访问</li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes/edit/main/demo/theme-docs/src/Java/fm/SpringBoot.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 542716863@qq.com">RrOrange</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/Java/fm/Spring.html" class="nav-link prev" aria-label="Spring"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Spring</div></a><a href="/Java/fm/SpringCloud.html" class="nav-link next" aria-label="SpringCloud"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">SpringCloud<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2023 zhiyu1998</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-8ba9a2ae.js" defer></script>
  </body>
</html>
