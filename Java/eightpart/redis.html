<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/Computer-Science-Learn-Notes/Java/eightpart/redis.html"><meta property="og:title" content="redis"><meta property="og:description" content="â™¨ï¸ redis è¯´ä¸€ä¸‹redis ç®€å•æ¥è¯´ Redis å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“ï¼Œä¸è¿‡ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚ å¦å¤–ï¼ŒRedis é™¤äº†åšç¼“å­˜ä¹‹å¤–ï¼Œä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ï¼Œç”šè‡³æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚ Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒ..."><meta property="og:type" content="article"><meta property="og:image" content="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/Computer-Science-Learn-Notes/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-04-04T17:31:51.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="redis"><meta property="article:author" content="zhiyu1998"><meta property="article:modified_time" content="2023-04-04T17:31:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"redis","image":["https://zhiyu1998.github.io/Computer-Science-Learn-Notes/Computer-Science-Learn-Notes/"],"dateModified":"2023-04-04T17:31:51.000Z","author":[{"@type":"Person","name":"zhiyu1998"}]}</script><link rel="manifest" href="/Computer-Science-Learn-Notes/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>redis</title><meta name="description" content="â™¨ï¸ redis è¯´ä¸€ä¸‹redis ç®€å•æ¥è¯´ Redis å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“ï¼Œä¸è¿‡ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚ å¦å¤–ï¼ŒRedis é™¤äº†åšç¼“å­˜ä¹‹å¤–ï¼Œä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ï¼Œç”šè‡³æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚ Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒ...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/Computer-Science-Learn-Notes/assets/style-1866b779.css" as="style"><link rel="stylesheet" href="/Computer-Science-Learn-Notes/assets/style-1866b779.css">
    <link rel="modulepreload" href="/Computer-Science-Learn-Notes/assets/app-66c72b60.js"><link rel="modulepreload" href="/Computer-Science-Learn-Notes/assets/framework-afce0fe7.js"><link rel="modulepreload" href="/Computer-Science-Learn-Notes/assets/redis.html-34355bf8.js"><link rel="modulepreload" href="/Computer-Science-Learn-Notes/assets/redis.html-3db37bdc.js"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-27ae749c.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/slides.html-0f261d40.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/datastruct.html-814f91bc.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/learnInProblem.html-e2624bd5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-0c8d2f60.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/disable.html-ff8b473a.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/encrypt.html-9fbca9c6.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/markdown.html-55bc9907.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/page.html-0e7ead7d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/personal_tech.html-3bc8c638.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/rent_house.html-23504880.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/basic.html-2311c034.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/concurrent.html-ada5aaea.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/concurrency.html-e7bc6f0b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/datastruct.html-881ce9de.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/distribution.html-d27d659c.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/foundation.html-bf4e15fb.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/giant.html-42c6a59e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/intelligenceQuestion.html-bd2292b3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/intro.html-fffd0865.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/messageQueue.html-278edcbd.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/mysql.html-f5b0f716.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/netty.html-c94bbb94.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/network.html-05853173.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/spring.html-5502b472.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/system.html-7b8bb171.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/think.html-7aaeaa58.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/virtualMachine.html-3e875324.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/Mybatis.html-49e400d9.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/Spring.html-e43fb86b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringBoot.html-6059d383.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringCloud.html-76a4f205.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringDataJpa.html-7952c7e4.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringMVC.html-9cedf7ca.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringSecurity.html-477b5769.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/kotlin.html-434e1c2b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/leetcode.html-6e6af564.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/react.html-e22168ca.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/typescript.html-73dbe6d5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/vue.html-b29ea4f2.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/1.ç®€ä»‹.html-1e536036.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10.å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½.html-733d51ee.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/11.ç›´æ¥å†…å­˜.html-cd6f6114.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/12.æ‰§è¡Œå¼•æ“.html-24baab50.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/13.StringTable.html-1bd92712.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/14.åƒåœ¾å›æ”¶æ¦‚è¿°.html-effe5d94.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/15.åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•.html-b029208d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/16.åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ.html-9a13bda3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/17-åƒåœ¾å›æ”¶å™¨.html-a8ddf178.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/2.ç±»åŠ è½½å­ç³»ç»Ÿ.html-345d10bb.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/3.è¿è¡Œæ—¶æ•°æ®åŒº.html-157299af.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/4.ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰.html-5efab972.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/5.è™šæ‹Ÿæœºæ ˆ.html-83dc9801.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/6.æœ¬åœ°æ–¹æ³•æ¥å£.html-effcee7e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/7.æœ¬åœ°æ–¹æ³•æ ˆ.html-aa08dac1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/8.å †.html-2be9fba4.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/9.æ–¹æ³•åŒº.html-9a92dbe7.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—.html-4aecb229.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾.html-33c8a326.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/05-æ›¿æ¢ç©ºæ ¼.html-731ec847.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—.html-64aa068b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10-I.æ–æ³¢é‚£å¥‘æ•°åˆ—.html-21f0bbc7.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10-IIé’è›™è·³å°é˜¶é—®é¢˜.html-5936af63.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—.html-8ecdda63.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/12-çŸ©é˜µä¸­çš„è·¯å¾„.html-9b2fd662.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´.html-32d9b38a.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/14-å‰ªç»³å­.html-e21a6ec0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°.html-97ba661d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹.html-e2b3eebc.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°.html-0f115655.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹.html-a1ceedab.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/22-é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹.html-459571cf.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/24-åè½¬é“¾è¡¨.html-92de2c0d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨.html-56752d60.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/26-æ ‘çš„å­ç»“æ„.html-1319ff49.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/27-äºŒå‰æ ‘çš„é•œåƒ.html-d20c02c1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/28-å¯¹ç§°çš„äºŒå‰æ ‘.html-187d456e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/58-II å·¦æ—‹è½¬å­—ç¬¦ä¸².html-713e6be0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/å¸¸ç”¨æ–¹æ³•å°è£…åˆé›†.html-af0be8af.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/404.html-75fcb8ce.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-039ed2dc.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-c13a7958.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-986cbfb0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-58c0e762.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-dc2c74b8.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-a146e343.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-297716ff.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-f08ea5cf.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-cf1c7cba.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-4187abed.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-6de5662b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-90d0a7cf.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-c6c0348e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-50cf6287.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-9bd6aad5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-d4518628.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-2016f3b0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-ba00b820.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/slides.html-a991af2c.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/datastruct.html-7308e003.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/learnInProblem.html-7f04200b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-c34e5275.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/disable.html-d972dbc6.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/encrypt.html-4170437a.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/markdown.html-61862a67.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/page.html-67d96e22.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/personal_tech.html-5568dee3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/rent_house.html-1e0dd4dc.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/basic.html-18911cb1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/concurrent.html-2c57d1b2.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/concurrency.html-afad628e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/datastruct.html-6bc5abf5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/distribution.html-37fe1b25.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/foundation.html-85a0e08b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/giant.html-3eed9986.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/intelligenceQuestion.html-482d99cd.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/intro.html-34111fe3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/messageQueue.html-f1cfd3be.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/mysql.html-4788adf8.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/netty.html-58c97bb7.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/network.html-264ac01e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/spring.html-a9a42659.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/system.html-fdd3c39f.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/think.html-cb5d858e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/virtualMachine.html-c1769886.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/Mybatis.html-3af6d6d4.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/Spring.html-e163eccb.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringBoot.html-56483b76.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringCloud.html-03730661.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringDataJpa.html-41f35d61.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringMVC.html-83890e3a.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SpringSecurity.html-62b13e45.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/kotlin.html-b2e2dd46.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/leetcode.html-f644d859.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/react.html-594c07f5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/typescript.html-7057d002.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/vue.html-bc78c79b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/1.ç®€ä»‹.html-50b9c060.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10.å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½.html-8c7802a5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/11.ç›´æ¥å†…å­˜.html-d0d37dbd.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/12.æ‰§è¡Œå¼•æ“.html-e00ef777.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/13.StringTable.html-8bba02d8.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/14.åƒåœ¾å›æ”¶æ¦‚è¿°.html-93107bc9.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/15.åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•.html-8b7d348d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/16.åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ.html-3633af62.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/17-åƒåœ¾å›æ”¶å™¨.html-d2c56119.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/2.ç±»åŠ è½½å­ç³»ç»Ÿ.html-7d72d57f.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/3.è¿è¡Œæ—¶æ•°æ®åŒº.html-3d6a37b7.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/4.ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰.html-95dde1b1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/5.è™šæ‹Ÿæœºæ ˆ.html-dc56806b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/6.æœ¬åœ°æ–¹æ³•æ¥å£.html-7fc16965.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/7.æœ¬åœ°æ–¹æ³•æ ˆ.html-6cad103e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/8.å †.html-f69bf86e.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/9.æ–¹æ³•åŒº.html-ef3b6e04.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/03-æ•°ç»„ä¸­é‡å¤çš„æ•°å­—.html-567f5361.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/04-äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾.html-6e6af06d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/05-æ›¿æ¢ç©ºæ ¼.html-202212eb.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—.html-19d03253.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10-I.æ–æ³¢é‚£å¥‘æ•°åˆ—.html-b6e27af0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/10-IIé’è›™è·³å°é˜¶é—®é¢˜.html-10ebe3d1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—.html-f82a7837.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/12-çŸ©é˜µä¸­çš„è·¯å¾„.html-324f8453.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/13-æœºå™¨äººçš„è¿åŠ¨èŒƒå›´.html-dad3810f.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/14-å‰ªç»³å­.html-c23774d2.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°.html-14fb859b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/16-æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹.html-64f6fe8a.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/17-æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°.html-8531c65c.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹.html-3aeace11.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/22-é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹.html-2517eeed.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/24-åè½¬é“¾è¡¨.html-6a3f1b99.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨.html-702f2779.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/26-æ ‘çš„å­ç»“æ„.html-4d99c9a3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/27-äºŒå‰æ ‘çš„é•œåƒ.html-85287fc8.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/28-å¯¹ç§°çš„äºŒå‰æ ‘.html-3aeebb13.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/58-II å·¦æ—‹è½¬å­—ç¬¦ä¸².html-a6dd23e1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/å¸¸ç”¨æ–¹æ³•å°è£…åˆé›†.html-f4b05f8b.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/404.html-982c42ec.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-7186d5f7.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-eaa10b62.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-1fbfb2e6.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-1271cf68.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-96bcade0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-90e31230.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-a1738b34.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-81d7f46f.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-95691e99.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-a6d8def1.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-040d812d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-44563782.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-e775c7d3.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-fca388e5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-8663824d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-c6c6d33d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index.html-b144c1dd.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/waline-meta-a31b78ed.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/component-0be4b3d2.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/mermaid.core-73a383b6.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/VuePlayground-f22e6317.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/photoswipe.esm-36cd6c3c.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/index-70769223.js" as="script"><link rel="prefetch" href="/Computer-Science-Learn-Notes/assets/SearchResult-7cf681a0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/Computer-Science-Learn-Notes/" class="brand"><img class="logo" src="/Computer-Science-Learn-Notes/logo.svg" alt><!----><!----></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/Computer-Science-Learn-Notes/" class="nav-link" aria-label="ä¸»é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/Computer-Science-Learn-Notes/intro/" class="nav-link" aria-label="å¯¼è¯»"><span class="font-icon icon iconfont icon-discover" style=""></span>å¯¼è¯»<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes/issues" rel="noopener noreferrer" target="_blank" aria-label="é—®é¢˜åé¦ˆ" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>é—®é¢˜åé¦ˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">æœç´¢</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-vscode" style=""></span><span class="title">å‰ç«¯</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-timer" style=""></span><span class="title">Golang</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-build" style=""></span><span class="title">è®¡ç®—æœºåŸºç¡€</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">JavaåŸºç¡€</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-branch" style=""></span><span class="title">Javaå¹¶å‘</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-profile" style=""></span><span class="title">Javaé¢è¯•</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/foundation.html" class="nav-link sidebar-link sidebar-page" aria-label="JavaåŸºç¡€"><!---->JavaåŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="å‰è¨€"><!---->å‰è¨€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/concurrency.html" class="nav-link sidebar-link sidebar-page" aria-label="Javaå¹¶å‘"><!---->Javaå¹¶å‘<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/virtualMachine.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM"><!---->JVM<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/spring.html" class="nav-link sidebar-link sidebar-page" aria-label="Springç³»åˆ—"><!---->Springç³»åˆ—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/mysql.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL"><!---->MySQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="redis"><!---->redis<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â™¨ï¸-redis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="â™¨ï¸ redis"><!---->â™¨ï¸ redis<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è¯´ä¸€ä¸‹redis" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¯´ä¸€ä¸‹redis"><!---->è¯´ä¸€ä¸‹redis<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"><!---->Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-ä¸ºä»€ä¹ˆç”¨-redis-ä½œä¸º-mysql-çš„ç¼“å­˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸ºä»€ä¹ˆè¦ç”¨ Redis / ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ/ ä¸ºä»€ä¹ˆç”¨ Redis ä½œä¸º MySQL çš„ç¼“å­˜ï¼Ÿ"><!---->ä¸ºä»€ä¹ˆè¦ç”¨ Redis / ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ/ ä¸ºä»€ä¹ˆç”¨ Redis ä½œä¸º MySQL çš„ç¼“å­˜ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨ï¼Ÿ"><!---->Redis å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><!---->Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ"><!---->Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯"><!---->â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ"><!---->Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ"><!---->Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ"><!---->Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ"><!---->è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><!---->Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è·³è·ƒè¡¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è·³è·ƒè¡¨"><!---->è·³è·ƒè¡¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­æ€ä¹ˆä¿è¯-redis-æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤-æŒä¹…åŒ–ç­–ç•¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="â­æ€ä¹ˆä¿è¯ Redis æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤ï¼Ÿï¼ˆæŒä¹…åŒ–ç­–ç•¥ï¼‰"><!---->â­æ€ä¹ˆä¿è¯ Redis æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤ï¼Ÿï¼ˆæŒä¹…åŒ–ç­–ç•¥ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ç¼“å­˜ç©¿é€-ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¼“å­˜ç©¿é€ &amp; ç¼“å­˜é›ªå´© &amp; ç¼“å­˜å‡»ç©¿"><!---->ç¼“å­˜ç©¿é€ &amp; ç¼“å­˜é›ªå´© &amp; ç¼“å­˜å‡»ç©¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"><!---->ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#sentinel-å“¨å…µ-æœ‰ä»€ä¹ˆä½œç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Sentinelï¼ˆå“¨å…µï¼‰  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><!---->Sentinelï¼ˆå“¨å…µï¼‰  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸ºä»€ä¹ˆè¦å“¨å…µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸ºä»€ä¹ˆè¦å“¨å…µï¼Ÿ"><!---->ä¸ºä»€ä¹ˆè¦å“¨å…µï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#cluster-é›†ç¾¤-çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Clusterï¼ˆé›†ç¾¤ï¼‰çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—ï¼Ÿ"><!---->Clusterï¼ˆé›†ç¾¤ï¼‰çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­mysql-å’Œ-redis-æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="â­MySQL å’Œ Redis æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´?"><!---->â­MySQL å’Œ Redis æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­ï¸rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="â­ï¸Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ"><!---->â­ï¸Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ"><!---->é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/distribution.html" class="nav-link sidebar-link sidebar-page" aria-label="åˆ†å¸ƒå¼"><!---->åˆ†å¸ƒå¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/messageQueue.html" class="nav-link sidebar-link sidebar-page" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!---->æ¶ˆæ¯é˜Ÿåˆ—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/netty.html" class="nav-link sidebar-link sidebar-page" aria-label="Netty"><!---->Netty<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/network.html" class="nav-link sidebar-link sidebar-page" aria-label="è®¡ç®—æœºç½‘ç»œ"><!---->è®¡ç®—æœºç½‘ç»œ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/system.html" class="nav-link sidebar-link sidebar-page" aria-label="æ“ä½œç³»ç»Ÿ"><!---->æ“ä½œç³»ç»Ÿ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/datastruct.html" class="nav-link sidebar-link sidebar-page" aria-label="æ•°æ®ç»“æ„"><!---->æ•°æ®ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/intelligenceQuestion.html" class="nav-link sidebar-link sidebar-page" aria-label="æ™ºåŠ›é¢˜"><!---->æ™ºåŠ›é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/giant.html" class="nav-link sidebar-link sidebar-page" aria-label="2022å¤§å‚å…«è‚¡æ–‡"><!---->2022å¤§å‚å…«è‚¡æ–‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/Computer-Science-Learn-Notes/Java/eightpart/think.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºäºé¢è¯•é¢˜çš„ä¸€äº›æ€è€ƒ"><!---->åŸºäºé¢è¯•é¢˜çš„ä¸€äº›æ€è€ƒ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-leaf" style=""></span><span class="title">Javaæ¡†æ¶</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-async" style=""></span><span class="title">Javaè™šæ‹Ÿæœº</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-launch" style=""></span><span class="title">Kotlinç»“åˆSpring</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-object" style=""></span><span class="title">LeetCodeåˆ·é¢˜é¡ºåº</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-repair" style=""></span><span class="title">ç»éªŒæ€»ç»“</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->redis</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">zhiyu1998</span></span><span property="author" content="zhiyu1998"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-04T15:12:04.000Z"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span class="waline-pageview-count" id="ArtalkPV" data-path="/Computer-Science-Learn-Notes/Java/eightpart/redis.html">...</span></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 117 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT117M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â™¨ï¸-redis" class="router-link-active router-link-exact-active toc-link level2">â™¨ï¸ redis</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è¯´ä¸€ä¸‹redis" class="router-link-active router-link-exact-active toc-link level3">è¯´ä¸€ä¸‹redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="router-link-active router-link-exact-active toc-link level3">Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-ä¸ºä»€ä¹ˆç”¨-redis-ä½œä¸º-mysql-çš„ç¼“å­˜" class="router-link-active router-link-exact-active toc-link level3">ä¸ºä»€ä¹ˆè¦ç”¨ Redis / ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ/ ä¸ºä»€ä¹ˆç”¨ Redis ä½œä¸º MySQL çš„ç¼“å­˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨" class="router-link-active router-link-exact-active toc-link level3">Redis å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯" class="router-link-active router-link-exact-active toc-link level3">â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—" class="router-link-active router-link-exact-active toc-link level3">Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" class="router-link-active router-link-exact-active toc-link level3">Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢" class="router-link-active router-link-exact-active toc-link level3">Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#è·³è·ƒè¡¨" class="router-link-active router-link-exact-active toc-link level3">è·³è·ƒè¡¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­æ€ä¹ˆä¿è¯-redis-æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤-æŒä¹…åŒ–ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">â­æ€ä¹ˆä¿è¯ Redis æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤ï¼Ÿï¼ˆæŒä¹…åŒ–ç­–ç•¥ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ç¼“å­˜ç©¿é€-ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿" class="router-link-active router-link-exact-active toc-link level3">ç¼“å­˜ç©¿é€ &amp; ç¼“å­˜é›ªå´© &amp; ç¼“å­˜å‡»ç©¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„" class="router-link-active router-link-exact-active toc-link level3">ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#sentinel-å“¨å…µ-æœ‰ä»€ä¹ˆä½œç”¨" class="router-link-active router-link-exact-active toc-link level3">Sentinelï¼ˆå“¨å…µï¼‰  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#ä¸ºä»€ä¹ˆè¦å“¨å…µ" class="router-link-active router-link-exact-active toc-link level3">ä¸ºä»€ä¹ˆè¦å“¨å…µï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#cluster-é›†ç¾¤-çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—" class="router-link-active router-link-exact-active toc-link level3">Clusterï¼ˆé›†ç¾¤ï¼‰çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­mysql-å’Œ-redis-æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´" class="router-link-active router-link-exact-active toc-link level3">â­MySQL å’Œ Redis æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#â­ï¸rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active toc-link level3">â­ï¸Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/Computer-Science-Learn-Notes/Java/eightpart/redis.html#é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠ" class="router-link-active router-link-exact-active toc-link level3">é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="â™¨ï¸-redis" tabindex="-1"><a class="header-anchor" href="#â™¨ï¸-redis" aria-hidden="true">#</a> â™¨ï¸ redis</h2><h3 id="è¯´ä¸€ä¸‹redis" tabindex="-1"><a class="header-anchor" href="#è¯´ä¸€ä¸‹redis" aria-hidden="true">#</a> è¯´ä¸€ä¸‹redis</h3><p>ç®€å•æ¥è¯´ <strong>Redis å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“</strong>ï¼Œä¸è¿‡ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ <strong>Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„</strong> ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚</p><p>å¦å¤–ï¼Œ<strong>Redis é™¤äº†åšç¼“å­˜ä¹‹å¤–ï¼Œä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ï¼Œç”šè‡³æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚</strong></p><p><strong>Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚Redis è¿˜æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</strong></p><h3 id="redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" tabindex="-1"><a class="header-anchor" href="#redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" aria-hidden="true">#</a> Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</h3><ul><li>rediså®Œå…¨<strong>åŸºäºå†…å­˜</strong>,ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œ,éå¸¸å¿«é€Ÿ.</li><li><strong>æ•°æ®ç»“æ„ç®€å•</strong>,å¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•,redisä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„</li><li>é‡‡ç”¨<strong>å•çº¿ç¨‹æ¨¡å‹</strong>, é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶, ä¹Ÿä¸å­˜åœ¨å¤šçº¿ç¨‹æˆ–è€…å¤šçº¿ç¨‹åˆ‡æ¢è€Œæ¶ˆè€—CPU, ä¸ç”¨è€ƒè™‘å„ç§é”çš„é—®é¢˜, ä¸å­˜åœ¨åŠ é”, é‡Šæ”¾é”çš„æ“ä½œ, æ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´æ€§èƒ½æ¶ˆè€—</li><li>ä½¿ç”¨äº†<strong>å¤šè·¯IOå¤ç”¨æ¨¡å‹</strong>,éé˜»å¡IO</li><li>ä½¿ç”¨<strong>åº•å±‚æ¨¡å‹ä¸åŒ</strong>ï¼ŒRedisç›´æ¥è‡ªå·±æ„å»ºäº† VM (è™šæ‹Ÿå†…å­˜)æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-ä¸ºä»€ä¹ˆç”¨-redis-ä½œä¸º-mysql-çš„ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-ä¸ºä»€ä¹ˆç”¨-redis-ä½œä¸º-mysql-çš„ç¼“å­˜" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ç”¨ Redis / ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ/ ä¸ºä»€ä¹ˆç”¨ Redis ä½œä¸º MySQL çš„ç¼“å­˜ï¼Ÿ</h3><p>ä¸»è¦æ˜¯å› ä¸º <strong>Redis å…·å¤‡ã€Œé«˜æ€§èƒ½ã€å’Œã€Œé«˜å¹¶å‘ã€ä¸¤ç§ç‰¹æ€§</strong>ã€‚</p><p>ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢è®²ï¼š</p><p><em><strong>1ã€Redis å…·å¤‡é«˜æ€§èƒ½</strong></em></p><p>å‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—® MySQL ä¸­çš„æŸäº›æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ˜¯ä»ç¡¬ç›˜ä¸Šè¯»å–çš„ã€‚å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®ç¼“å­˜åœ¨ Redis ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ï¼Œæ“ä½œ Redis ç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714213332696-fb2b0120.png" alt="image-20220714213332696" tabindex="0" loading="lazy"><figcaption>image-20220714213332696</figcaption></figure><p>å¦‚æœ MySQL ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ Redis ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼Œä¸è¿‡è¿™é‡Œä¼šæœ‰ Redis å’Œ MySQL åŒå†™ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œåé¢æˆ‘ä»¬ä¼šæåˆ°ã€‚</p><p><em><strong>2ã€ Redis å…·å¤‡é«˜å¹¶å‘</strong></em></p><p>å•å°è®¾å¤‡çš„ Redis çš„ QPSï¼ˆQuery Per Secondï¼Œæ¯ç§’é’Ÿå¤„ç†å®Œè¯·æ±‚çš„æ¬¡æ•°ï¼‰ æ˜¯ MySQL çš„ 10 å€ï¼ŒRedis å•æœºçš„ QPS èƒ½è½»æ¾ç ´ 10wï¼Œè€Œ MySQL å•æœºçš„ QPS å¾ˆéš¾ç ´ 1wã€‚</p><p>æ‰€ä»¥ï¼Œç›´æ¥è®¿é—® Redis èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—® MySQL çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚</p><h3 id="redis-å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#redis-å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨" aria-hidden="true">#</a> Redis å¦‚ä½•å®ç°æœåŠ¡é«˜å¯ç”¨ï¼Ÿ</h3><p>è¦æƒ³è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨çš„ Redis æœåŠ¡ï¼Œä¸€å®šè¦ä» Redis çš„å¤šæœåŠ¡èŠ‚ç‚¹æ¥è€ƒè™‘ï¼Œæ¯”å¦‚ Redis çš„ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€åˆ‡ç‰‡é›†ç¾¤ã€‚</p><blockquote><p>ä¸»ä»å¤åˆ¶</p></blockquote><p>ä¸»ä»å¤åˆ¶æ˜¯ Redis é«˜å¯ç”¨æœåŠ¡çš„æœ€åŸºç¡€çš„ä¿è¯ï¼Œå®ç°æ–¹æ¡ˆå°±æ˜¯å°†ä»å‰çš„ä¸€å° Redis æœåŠ¡å™¨ï¼ŒåŒæ­¥æ•°æ®åˆ°å¤šå°ä» Redis æœåŠ¡å™¨ä¸Šï¼Œå³ä¸€ä¸»å¤šä»çš„æ¨¡å¼ï¼Œä¸”ä¸»ä»æœåŠ¡å™¨ä¹‹é—´é‡‡ç”¨çš„æ˜¯ã€Œè¯»å†™åˆ†ç¦»ã€çš„æ–¹å¼ã€‚</p><p>ä¸»æœåŠ¡å™¨å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å‘ç”Ÿå†™æ“ä½œæ—¶è‡ªåŠ¨å°†å†™æ“ä½œåŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨ä¸€èˆ¬æ˜¯åªè¯»ï¼Œå¹¶æ¥å—ä¸»æœåŠ¡å™¨åŒæ­¥è¿‡æ¥å†™æ“ä½œå‘½ä»¤ï¼Œç„¶åæ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220158025-b07ccab0.png" alt="image-20220715161214356" tabindex="0" loading="lazy"><figcaption>image-20220715161214356</figcaption></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„æ•°æ®ä¿®æ”¹åªåœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œï¼Œç„¶åå°†æœ€æ–°çš„æ•°æ®åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œè¿™æ ·å°±ä½¿å¾—ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><p>æ³¨æ„ï¼Œä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„å‘½ä»¤å¤åˆ¶æ˜¯<strong>å¼‚æ­¥</strong>è¿›è¡Œçš„ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨ä¸»ä»æœåŠ¡å™¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»æœåŠ¡å™¨æ”¶åˆ°æ–°çš„å†™å‘½ä»¤åï¼Œä¼šå‘é€ç»™ä»æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œä¸»æœåŠ¡å™¨å¹¶ä¸ä¼šç­‰åˆ°ä»æœåŠ¡å™¨å®é™…æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸»æœåŠ¡å™¨è‡ªå·±åœ¨æœ¬åœ°æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ç»“æœäº†ã€‚å¦‚æœä»æœåŠ¡å™¨è¿˜æ²¡æœ‰æ‰§è¡Œä¸»æœåŠ¡å™¨åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ï¼Œä¸»ä»æœåŠ¡å™¨é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ— æ³•å®ç°å¼ºä¸€è‡´æ€§ä¿è¯ï¼ˆä¸»ä»æ•°æ®æ—¶æ—¶åˆ»åˆ»ä¿æŒä¸€è‡´ï¼‰ï¼Œæ•°æ®ä¸ä¸€è‡´æ˜¯éš¾ä»¥é¿å…çš„ã€‚</p><blockquote><p>å“¨å…µæ¨¡å¼</p></blockquote><p>åœ¨ä½¿ç”¨ Redis ä¸»ä»æœåŠ¡çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“ Redis çš„ä¸»ä»æœåŠ¡å™¨å‡ºç°æ•…éšœå®•æœºæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œæ¢å¤ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¢åŠ äº†å“¨å…µæ¨¡å¼ï¼ˆ<strong>Redis Sentinel</strong>ï¼‰ï¼Œå› ä¸ºå“¨å…µæ¨¡å¼åšåˆ°äº†å¯ä»¥ç›‘æ§ä¸»ä»æœåŠ¡å™¨ï¼Œå¹¶ä¸”æä¾›<strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚</strong></p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220557761-6db7e737.png" alt="image-20220715161234139" tabindex="0" loading="lazy"><figcaption>image-20220715161234139</figcaption></figure><blockquote><p>åˆ‡ç‰‡é›†ç¾¤æ¨¡å¼</p></blockquote><p>å½“ Redis ç¼“å­˜æ•°æ®é‡å¤§åˆ°ä¸€å°æœåŠ¡å™¨æ— æ³•ç¼“å­˜æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ <strong>Redis åˆ‡ç‰‡é›†ç¾¤</strong>ï¼ˆRedis Cluster ï¼‰æ–¹æ¡ˆï¼Œå®ƒå°†æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æ­¤æ¥é™ä½ç³»ç»Ÿå¯¹å•ä¸»èŠ‚ç‚¹çš„ä¾èµ–ï¼Œä»è€Œæé«˜ Redis æœåŠ¡çš„è¯»å†™æ€§èƒ½ã€‚</p><p>Redis Cluster æ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰ï¼Œæ¥å¤„ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åœ¨ Redis Cluster æ–¹æ¡ˆä¸­ï¼Œ<strong>ä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½</strong>ï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ï¼Œå…·ä½“æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸¤å¤§æ­¥ï¼š</p><ul><li>æ ¹æ®é”®å€¼å¯¹çš„ keyï¼ŒæŒ‰ç…§ CRC16 ç®—æ³•è®¡ç®—ä¸€ä¸ª 16 bit çš„å€¼ã€‚</li><li>å†ç”¨ 16bit å€¼å¯¹ 16384 å–æ¨¡ï¼Œå¾—åˆ° 0~16383 èŒƒå›´å†…çš„æ¨¡æ•°ï¼Œæ¯ä¸ªæ¨¡æ•°ä»£è¡¨ä¸€ä¸ªç›¸åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚</li></ul><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œè¿™äº›å“ˆå¸Œæ§½æ€ä¹ˆè¢«æ˜ å°„åˆ°å…·ä½“çš„ Redis èŠ‚ç‚¹ä¸Šçš„å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li><strong>å¹³å‡åˆ†é…ï¼š</strong> åœ¨ä½¿ç”¨ cluster create å‘½ä»¤åˆ›å»º Redis é›†ç¾¤æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰å“ˆå¸Œæ§½å¹³å‡åˆ†å¸ƒåˆ°é›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚æ¯”å¦‚é›†ç¾¤ä¸­æœ‰ 9 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ§½çš„ä¸ªæ•°ä¸º 16384/9 ä¸ªã€‚</li><li><strong>æ‰‹åŠ¨åˆ†é…ï¼š</strong> å¯ä»¥ä½¿ç”¨ cluster meet å‘½ä»¤æ‰‹åŠ¨å»ºç«‹èŠ‚ç‚¹é—´çš„è¿æ¥ï¼Œç»„æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨ cluster addslots å‘½ä»¤ï¼ŒæŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°ã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ çš„ç†è§£ï¼Œæˆ‘é€šè¿‡ä¸€å¼ å›¾æ¥è§£é‡Šæ•°æ®ã€å“ˆå¸Œæ§½ï¼Œä»¥åŠèŠ‚ç‚¹ä¸‰è€…çš„æ˜ å°„åˆ†å¸ƒå…³ç³»ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715161306957-dc20f0eb.png" alt="image-20220715161306957" tabindex="0" loading="lazy"><figcaption>image-20220715161306957</figcaption></figure><p>ä¸Šå›¾ä¸­çš„åˆ‡ç‰‡é›†ç¾¤ä¸€å…±æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œå‡è®¾æœ‰ 4 ä¸ªå“ˆå¸Œæ§½ï¼ˆSlot 0ï½Slot 3ï¼‰æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½ï¼Œæ¯”å¦‚èŠ‚ç‚¹ 1 ä¿å­˜å“ˆå¸Œæ§½ 0 å’Œ 1ï¼ŒèŠ‚ç‚¹ 2 ä¿å­˜å“ˆå¸Œæ§½ 2 å’Œ 3ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.10</span> â€“p <span class="token number">6379</span> cluster addslots <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.11</span> â€“p <span class="token number">6379</span> cluster addslots <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨é›†ç¾¤è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œkey1 å’Œ key2 è®¡ç®—å®Œ CRC16 å€¼åï¼Œå¯¹å“ˆå¸Œæ§½æ€»ä¸ªæ•° 5 è¿›è¡Œå–æ¨¡ï¼Œå†æ ¹æ®å„è‡ªçš„æ¨¡æ•°ç»“æœï¼Œå°±å¯ä»¥è¢«æ˜ å°„åˆ°å¯¹åº”çš„èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 3 ä¸Šäº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½æ—¶ï¼Œéœ€è¦æŠŠ 16384 ä¸ªæ§½éƒ½åˆ†é…å®Œï¼Œå¦åˆ™ Redis é›†ç¾¤æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p><h3 id="redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>å¾ˆå¤šäººéƒ½è¯´ç”¨ Redis ä½œä¸ºç¼“å­˜ï¼Œä½†æ˜¯ Memcached ä¹Ÿæ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸ºä»€ä¹ˆä¸é€‰æ‹©å®ƒä½œä¸ºç¼“å­˜å‘¢ï¼Ÿè¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦å¼„æ¸…æ¥š Redis å’Œ Memcached çš„åŒºåˆ«ã€‚ Redis ä¸ Memcached <strong>å…±åŒç‚¹</strong>ï¼š</p><ol><li>éƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚</li><li>éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚</li><li>ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚</li></ol><p>Redis ä¸ Memcached <strong>åŒºåˆ«</strong>ï¼š</p><ul><li>Redis æ”¯æŒçš„æ•°æ®ç±»å‹æ›´ä¸°å¯Œï¼ˆStringã€Hashã€Listã€Setã€ZSetï¼‰ï¼Œè€Œ Memcached åªæ”¯æŒæœ€ç®€å•çš„ key-value æ•°æ®ç±»å‹ï¼›</li><li>Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ï¼Œè€Œ Memcached æ²¡æœ‰æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼ŒMemcached é‡å¯æˆ–è€…æŒ‚æ‰åï¼Œæ•°æ®å°±æ²¡äº†ï¼›</li><li>Redis åŸç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼ŒMemcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›</li><li>Redis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒï¼›</li></ul><h3 id="redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#redis-é™¤äº†åšç¼“å­˜-è¿˜èƒ½åšä»€ä¹ˆ" aria-hidden="true">#</a> Redis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ</h3><p><strong>åˆ†å¸ƒå¼é”</strong> ï¼š é€šè¿‡ Redis æ¥åšåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäº Redisson æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚ç›¸å…³é˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/CbnPRfvq4m1sqo2uKI6qQw" target="_blank" rel="noopener noreferrer">ã€Šåˆ†å¸ƒå¼é”ä¸­çš„ç‹è€…æ–¹æ¡ˆ - Redissonã€‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>é™æµ</strong> ï¼šä¸€èˆ¬æ˜¯é€šè¿‡ Redis + Lua è„šæœ¬çš„æ–¹å¼æ¥å®ç°é™æµã€‚ç›¸å…³é˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/kyFAWH3mVNJvurQDt4vchA" target="_blank" rel="noopener noreferrer">ã€Šæˆ‘å¸ç”¨äº† 6 å¹´çš„ Redis åˆ†å¸ƒå¼é™æµå™¨ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å‰å®³äº†ï¼ã€‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong> ï¼šRedis è‡ªå¸¦çš„ list æ•°æ®ç»“æ„å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ä½¿ç”¨ã€‚Redis 5.0 ä¸­å¢åŠ çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´åŠ é€‚åˆç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒæ¯”è¾ƒç±»ä¼¼äº Kafkaï¼Œæœ‰ä¸»é¢˜å’Œæ¶ˆè´¹ç»„çš„æ¦‚å¿µï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠ ACK æœºåˆ¶ã€‚</p><p><strong>å¤æ‚ä¸šåŠ¡åœºæ™¯</strong> ï¼šé€šè¿‡ Redis ä»¥åŠ Redis æ‰©å±•ï¼ˆæ¯”å¦‚ Redissonï¼‰æä¾›çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯æ¯”å¦‚é€šè¿‡ bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ã€é€šè¿‡ sorted set ç»´æŠ¤æ’è¡Œæ¦œã€‚</p><p>......</p><h3 id="â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> â­åŸºæœ¬æ•°æ®ç±»å‹ã€åº”ç”¨åœºæ™¯</h3><blockquote><p>5ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼šstringã€listã€hashã€setã€zset</p><p>æ¨èé˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/qptE172slg_6Tl1yuzdbfw" target="_blank" rel="noopener noreferrer">å›¾è§£ Redis æ•°æ®ç»“æ„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h4 id="_1ï¸âƒ£string" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£string" aria-hidden="true">#</a> 1ï¸âƒ£string</h4><ol><li><strong>ä»‹ç»</strong> ï¼šstring æ•°æ®ç»“æ„æ˜¯ç®€å•çš„ key-value ç±»å‹ã€‚è™½ç„¶ Redis æ˜¯ç”¨ C è¯­è¨€å†™çš„ï¼Œä½†æ˜¯ Redis å¹¶æ²¡æœ‰ä½¿ç”¨ C çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§ <strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼ˆsimple dynamic stringï¼Œ<strong>SDS</strong>ï¼‰ã€‚ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼ŒRedis çš„ SDS ä¸å…‰å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®è¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦ä¸º O(1)ï¼ˆC å­—ç¬¦ä¸²ä¸º O(N)ï¼‰,é™¤æ­¤ä¹‹å¤–ï¼ŒRedis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>set,get,strlen,exists,decr,incr,setex</code> ç­‰ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> ä¸€èˆ¬å¸¸ç”¨åœ¨éœ€è¦<strong>è®¡æ•°</strong>çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ï¼›<strong>ç¼“å­˜</strong>ï¼Œç»å…¸ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠå¸¸ç”¨ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²ï¼Œå›¾ç‰‡æˆ–è€…è§†é¢‘ç­‰ä¿¡æ¯æ”¾åˆ°redisä¸­ï¼Œredisä½œä¸ºç¼“å­˜å±‚ï¼ŒmysqlåšæŒä¹…åŒ–å±‚ï¼Œé™ä½mysqlçš„è¯»å†™å‹åŠ›ï¼›<strong>session</strong>ï¼Œå¸¸è§æ–¹æ¡ˆspring session + rediså®ç°sessionå…±äº«ç­‰ç­‰ã€‚</li></ol><h4 id="_2ï¸âƒ£list" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£list" aria-hidden="true">#</a> 2ï¸âƒ£list</h4><ol><li><strong>ä»‹ç»</strong> ï¼š<strong>list</strong> å³æ˜¯ <strong>é“¾è¡¨</strong>ã€‚é“¾è¡¨æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯æ˜“äºæ•°æ®å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸”å¯ä»¥çµæ´»è°ƒæ•´é“¾è¡¨é•¿åº¦ï¼Œä½†æ˜¯é“¾è¡¨çš„éšæœºè®¿é—®å›°éš¾ã€‚è®¸å¤šé«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½å†…ç½®äº†é“¾è¡¨çš„å®ç°æ¯”å¦‚ Java ä¸­çš„ <strong>LinkedList</strong>ï¼Œä½†æ˜¯ C è¯­è¨€å¹¶æ²¡æœ‰å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥ Redis å®ç°äº†è‡ªå·±çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚Redis çš„ list çš„å®ç°ä¸ºä¸€ä¸ª <strong>åŒå‘é“¾è¡¨</strong>ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤:</strong> <code>rpush,lpop,lpush,rpop,lrange,llen</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚ <ol><li><strong>å¾®åšTimeLine</strong>: æœ‰äººå‘å¸ƒå¾®åšï¼Œç”¨lpushåŠ å…¥æ—¶é—´è½´ï¼Œå±•ç¤ºæ–°çš„åˆ—è¡¨ä¿¡æ¯ã€‚</li></ol></li></ol><h4 id="_3ï¸âƒ£hash" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£hash" aria-hidden="true">#</a> 3ï¸âƒ£hash</h4><ol><li><strong>ä»‹ç»</strong> ï¼šhash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚ä¸è¿‡ï¼ŒRedis çš„ hash åšäº†æ›´å¤šä¼˜åŒ–ã€‚å¦å¤–ï¼Œhash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ<strong>ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡</strong>ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»…ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ hash æ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>hset,hmset,hexists,hget,hgetall,hkeys,hvals</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ï¼Œ<strong>ç¼“å­˜</strong>ï¼š èƒ½ç›´è§‚ï¼Œç›¸æ¯”stringæ›´èŠ‚çœç©ºé—´ï¼Œçš„ç»´æŠ¤ç¼“å­˜ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·ä¿¡æ¯ï¼Œè§†é¢‘ä¿¡æ¯ç­‰ã€‚</li></ol><h4 id="_4ï¸âƒ£set" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£set" aria-hidden="true">#</a> 4ï¸âƒ£set</h4><ol><li><strong>ä»‹ç» ï¼š</strong> set ç±»ä¼¼äº Java ä¸­çš„ <code>HashSet</code> ã€‚Redis ä¸­çš„ set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚å¯ä»¥åŸºäº set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>sadd,spop,smembers,sismember,scard,sinterstore,sunion</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤ä»¥åŠéœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†å’Œå¹¶é›†ç­‰åœºæ™¯ï¼›<strong>æ ‡ç­¾</strong>ï¼ˆtagï¼‰,ç»™ç”¨æˆ·æ·»åŠ æ ‡ç­¾ï¼Œæˆ–è€…ç”¨æˆ·ç»™æ¶ˆæ¯æ·»åŠ æ ‡ç­¾ï¼Œè¿™æ ·æœ‰åŒä¸€æ ‡ç­¾æˆ–è€…ç±»ä¼¼æ ‡ç­¾çš„å¯ä»¥ç»™æ¨èå…³æ³¨çš„äº‹æˆ–è€…å…³æ³¨çš„äººï¼›<strong>ç‚¹èµï¼Œæˆ–ç‚¹è¸©ï¼Œæ”¶è—ç­‰</strong>ï¼Œå¯ä»¥æ”¾åˆ°setä¸­å®ç°ã€‚</li></ol><h4 id="_5ï¸âƒ£zset" tabindex="-1"><a class="header-anchor" href="#_5ï¸âƒ£zset" aria-hidden="true">#</a> 5ï¸âƒ£Zset</h4><ol><li><p><strong>ä»‹ç» ï¼š</strong> å’Œ set ç›¸æ¯”ï¼Œsorted set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚æœ‰ç‚¹åƒæ˜¯ Java ä¸­ HashMap å’Œ TreeSet çš„ç»“åˆä½“ã€‚</p></li><li><p><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>ZADD å°†ä¸€ä¸ªå¸¦æœ‰ç»™å®šåˆ†å€¼çš„æˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆé‡Œé¢,ZRANGE æ ¹æ®å…ƒç´ åœ¨æœ‰åºé›†åˆä¸­æ‰€å¤„çš„ä½ç½®ï¼Œä»æœ‰åºé›†åˆä¸­è·å–å¤šä¸ªå…ƒç´ ,ZREM å¦‚æœç»™å®šå…ƒç´ æˆå‘˜å­˜åœ¨äºæœ‰åºé›†åˆä¸­ï¼Œé‚£ä¹ˆå°±ç§»é™¤è¿™ä¸ªå…ƒç´ </code> ç­‰ã€‚</p></li><li><p><strong>åº”ç”¨åœºæ™¯:</strong> <strong>æ’è¡Œæ¦œ</strong> éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚ä¾‹å¦‚å°è¯´è§†é¢‘ç­‰ç½‘ç«™éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„å°è¯´è§†é¢‘åšæ’è¡Œæ¦œï¼Œæ¦œå•å¯ä»¥æŒ‰ç…§ç”¨æˆ·å…³æ³¨æ•°ï¼Œæ›´æ–°æ—¶é—´ï¼Œå­—æ•°ç­‰æ‰“åˆ†ï¼Œåšæ’è¡Œï¼›åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼›å„ç§ç¤¼ç‰©<strong>æ’è¡Œæ¦œ</strong>ï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ã€‚</p></li><li><p>æœ‰åºé›†åˆæ˜¯é€šè¿‡ä¸¤ç§æ•°æ®ç»“æ„å®ç°ï¼š</p><ol><li><strong>å‹ç¼©åˆ—è¡¨(ziplist)</strong>: ziplistæ˜¯ä¸ºäº†æé«˜å­˜å‚¨æ•ˆç‡è€Œè®¾è®¡çš„ä¸€ç§ç‰¹æ®Šç¼–ç çš„åŒå‘é“¾è¡¨ã€‚å®ƒå¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²æˆ–è€…æ•´æ•°ï¼Œå­˜å‚¨æ•´æ•°æ—¶æ˜¯é‡‡ç”¨æ•´æ•°çš„äºŒè¿›åˆ¶è€Œä¸æ˜¯å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ã€‚å®ƒèƒ½åœ¨O(1)çš„æ—¶é—´å¤æ‚åº¦ä¸‹å®Œæˆlistä¸¤ç«¯çš„pushå’Œpopæ“ä½œã€‚ä½†æ˜¯å› ä¸ºæ¯æ¬¡æ“ä½œéƒ½éœ€è¦é‡æ–°åˆ†é…ziplistçš„å†…å­˜ï¼Œæ‰€ä»¥å®é™…å¤æ‚åº¦å’Œziplistçš„å†…å­˜ä½¿ç”¨é‡ç›¸å…³</li><li><strong>è·³è·ƒè¡¨ï¼ˆzSkiplist)</strong>: è·³è·ƒè¡¨çš„æ€§èƒ½å¯ä»¥ä¿è¯åœ¨æŸ¥æ‰¾ï¼Œåˆ é™¤ï¼Œæ·»åŠ ç­‰æ“ä½œçš„æ—¶å€™åœ¨å¯¹æ•°æœŸæœ›æ—¶é—´å†…å®Œæˆï¼Œè¿™ä¸ªæ€§èƒ½æ˜¯å¯ä»¥å’Œå¹³è¡¡æ ‘æ¥ç›¸æ¯”è¾ƒçš„ï¼Œè€Œä¸”åœ¨å®ç°æ–¹é¢æ¯”å¹³è¡¡æ ‘è¦ä¼˜é›…ï¼Œè¿™æ˜¯é‡‡ç”¨è·³è·ƒè¡¨çš„ä¸»è¦åŸå› ã€‚è·³è·ƒè¡¨çš„å¤æ‚åº¦æ˜¯O(log(n))ã€‚</li></ol></li></ol><p>éšç€ Redis ç‰ˆæœ¬çš„æ›´æ–°ï¼Œåé¢åˆæ”¯æŒäº†å››ç§æ•°æ®ç±»å‹ï¼šBitMapï¼ˆ2.2 ç‰ˆæ–°å¢ï¼‰ã€HyperLogLogï¼ˆ2.8 ç‰ˆæ–°å¢ï¼‰ã€GEOï¼ˆ3.2 ç‰ˆæ–°å¢ï¼‰ã€Streamï¼ˆ5.0 ç‰ˆæ–°å¢ï¼‰</p><h4 id="ç‰¹æ®Šç±»å‹-bitmap" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ®Šç±»å‹-bitmap" aria-hidden="true">#</a> ç‰¹æ®Šç±»å‹ï¼š bitmap</h4><ol><li><strong>ä»‹ç»ï¼š</strong> bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>setbit</code> ã€<code>getbit</code> ã€<code>bitcount</code>ã€<code>bitop</code></li><li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> é€‚åˆéœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦ç™»å½•...ï¼‰å¹¶éœ€è¦è¿›ä¸€æ­¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æçš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚</li></ol><h3 id="redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#redis-å•çº¿ç¨‹æ¨¡å‹äº†è§£å—" aria-hidden="true">#</a> Redis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ</h3><p><strong>Redis åŸºäº Reactor æ¨¡å¼æ¥è®¾è®¡å¼€å‘äº†è‡ªå·±çš„ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹</strong> ï¼ˆNetty çš„çº¿ç¨‹æ¨¡å‹ä¹ŸåŸºäº Reactor æ¨¡å¼ï¼ŒReactor æ¨¡å¼ä¸æ„§æ˜¯é«˜æ€§èƒ½ IO çš„åŸºçŸ³ï¼‰ï¼Œè¿™å¥—äº‹ä»¶å¤„ç†æ¨¡å‹å¯¹åº”çš„æ˜¯ Redis ä¸­çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚ç”±äºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰æ˜¯å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚</p><p><strong>æ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œé‚£æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ</strong></p><p>Redis é€šè¿‡<strong>IO å¤šè·¯å¤ç”¨ç¨‹åº</strong> æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼ˆæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socketï¼‰ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹ï¼ˆè¯»ã€å†™ï¼‰æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚</p><p>è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š <strong>I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—</strong>ï¼ˆå’Œ NIO ä¸­çš„ <code>Selector</code> ç»„ä»¶å¾ˆåƒï¼‰ã€‚</p><p>å¦å¤–ï¼Œ Redis æœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†ä¸¤ç±»äº‹ä»¶ï¼š1. æ–‡ä»¶äº‹ä»¶; 2. æ—¶é—´äº‹ä»¶ã€‚</p><p>æ—¶é—´äº‹ä»¶ä¸éœ€è¦å¤šèŠ±æ—¶é—´äº†è§£ï¼Œæˆ‘ä»¬æ¥è§¦æœ€å¤šçš„è¿˜æ˜¯ <strong>æ–‡ä»¶äº‹ä»¶</strong>ï¼ˆå®¢æˆ·ç«¯è¿›è¡Œè¯»å–å†™å…¥ç­‰æ“ä½œï¼Œæ¶‰åŠä¸€ç³»åˆ—ç½‘ç»œé€šä¿¡ï¼‰ã€‚</p><p>ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹æœ‰ä¸€æ®µè¯æ˜¯å¦‚æ˜¯ä»‹ç»æ–‡ä»¶äº‹ä»¶çš„ï¼Œæˆ‘è§‰å¾—å†™å¾—æŒºä¸é”™ã€‚</p><blockquote><p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚</p><p>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</p><p><strong>è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—</strong>ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p></blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰</li><li>IO å¤šè·¯å¤ç”¨ç¨‹åºï¼ˆæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰</li><li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰</li><li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li></ul><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220716153002622-683187b7.png" alt="image-20220716153002622" tabindex="0" loading="lazy"><figcaption>image-20220716153002622</figcaption></figure><p>å›¾ä¸­çš„è“è‰²éƒ¨åˆ†æ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œæ˜¯ç”±ä¸»çº¿ç¨‹è´Ÿè´£çš„ï¼Œå¯ä»¥çœ‹åˆ°ç½‘ç»œ I/O å’Œå‘½ä»¤å¤„ç†éƒ½æ˜¯å•çº¿ç¨‹ã€‚ Redis åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåšä¸‹é¢è¿™å‡ å¹´äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œè°ƒç”¨ epoll_create() åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡å’Œè°ƒç”¨ socket() ä¸€ä¸ªæœåŠ¡ç«¯ socket</li><li>ç„¶åï¼Œè°ƒç”¨ bind() ç»‘å®šç«¯å£å’Œè°ƒç”¨ listen() ç›‘å¬è¯¥ socketï¼›</li><li>ç„¶åï¼Œå°†è°ƒç”¨ epoll_crt() å°† listen socket åŠ å…¥åˆ° epollï¼ŒåŒæ—¶æ³¨å†Œã€Œè¿æ¥äº‹ä»¶ã€å¤„ç†å‡½æ•°ã€‚</li></ul><p>åˆå§‹åŒ–å®Œåï¼Œä¸»çº¿ç¨‹å°±è¿›å…¥åˆ°ä¸€ä¸ª<strong>äº‹ä»¶å¾ªç¯å‡½æ•°</strong>ï¼Œä¸»è¦ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œå…ˆè°ƒç”¨<strong>å¤„ç†å‘é€é˜Ÿåˆ—å‡½æ•°</strong>ï¼Œçœ‹æ˜¯å‘é€é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å‘é€ä»»åŠ¡ï¼Œåˆ™é€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘ç”Ÿå®Œï¼Œå°±ä¼šæ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li><li>æ¥ç€ï¼Œè°ƒç”¨ epoll_wait å‡½æ•°ç­‰å¾…äº‹ä»¶çš„åˆ°æ¥ï¼š <ul><li>å¦‚æœæ˜¯<strong>è¿æ¥äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt; è°ƒç”¨ epoll_ctr å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</li><li>å¦‚æœæ˜¯<strong>è¯»äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>è¯»äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</li><li>å¦‚æœæ˜¯<strong>å†™äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨<strong>å†™äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘ç”Ÿå®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li></ul></li></ul><blockquote><p>âš ï¸ æé†’ï¼šç¯‡å¹…è¿‡é•¿ï¼Œå¦‚æœæ²¡æœ‰è€å¿ƒå»ºè®®ç›´æ¥èƒŒè¯µå³å¯</p><p><a href="https://xiaolincoding.com/os/8_network_system/reactor.html#%E5%8D%95-reactor-%E5%8D%95%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B" target="_blank" rel="noopener noreferrer">æ·±å…¥äº†è§£Reactorç›´é€šè½¦<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://mp.weixin.qq.com/s/Qpa0qXxuIM8jrBqDaXmVNA" target="_blank" rel="noopener noreferrer">I/Oå¤šè·¯å¤ç”¨ç›´é€šè½¦<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" aria-hidden="true">#</a> Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</h3><p><strong>Redis6.0 å¼•å…¥å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½</strong>ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯ Redis ä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆï¼ˆRedis çš„ç“¶é¢ˆä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œï¼‰ã€‚</p><p>è™½ç„¶ï¼ŒRedis6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯ Redis çš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨äº†ï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>Redis6.0 çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ <code>redis.conf</code> ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>io-threads-do-reads <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¼€å¯å¤šçº¿ç¨‹åï¼Œè¿˜éœ€è¦è®¾ç½®çº¿ç¨‹æ•°ï¼Œå¦åˆ™æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚åŒæ ·éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ <code>redis.conf</code> :</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>io-threads <span class="token number">4</span> <span class="token comment">#å®˜ç½‘å»ºè®®4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢" tabindex="-1"><a class="header-anchor" href="#redis-æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢" aria-hidden="true">#</a> Redis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ</h3><p>æ¯å½“æˆ‘ä»¬å¯¹ä¸€ä¸ª key è®¾ç½®äº†è¿‡æœŸæ—¶é—´æ—¶ï¼ŒRedis ä¼šæŠŠè¯¥ key å¸¦ä¸Šè¿‡æœŸæ—¶é—´å­˜å‚¨åˆ°ä¸€ä¸ª<strong>è¿‡æœŸå­—å…¸</strong>ï¼ˆexpires dictï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ã€Œè¿‡æœŸå­—å…¸ã€ä¿å­˜äº†æ•°æ®åº“ä¸­æ‰€æœ‰ key çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>è¿‡æœŸå­—å…¸å­˜å‚¨åœ¨ redisDb ç»“æ„ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisDb</span> <span class="token punctuation">{</span>
    dict <span class="token operator">*</span>dict<span class="token punctuation">;</span>    <span class="token comment">/* æ•°æ®åº“é”®ç©ºé—´ï¼Œå­˜æ”¾ç€æ‰€æœ‰çš„é”®å€¼å¯¹ */</span>
    dict <span class="token operator">*</span>expires<span class="token punctuation">;</span> <span class="token comment">/* é”®çš„è¿‡æœŸæ—¶é—´ */</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> redisDb<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿‡æœŸå­—å…¸æ•°æ®ç»“æ„ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>è¿‡æœŸå­—å…¸çš„ key æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æŸä¸ªé”®å¯¹è±¡ï¼›</li><li>è¿‡æœŸå­—å…¸çš„ value æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key çš„è¿‡æœŸæ—¶é—´ï¼›</li></ul><p>è¿‡æœŸå­—å…¸çš„æ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714211943265-08318cae.png" alt="image-20220714211943265" tabindex="0" loading="lazy"><figcaption>image-20220714211943265</figcaption></figure><p>å­—å…¸å®é™…ä¸Šæ˜¯å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾ã€‚å½“æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ª key æ—¶ï¼ŒRedis é¦–å…ˆæ£€æŸ¥è¯¥ key æ˜¯å¦å­˜åœ¨äºè¿‡æœŸå­—å…¸ä¸­ï¼š</p><ul><li>å¦‚æœä¸åœ¨ï¼Œåˆ™æ­£å¸¸è¯»å–é”®å€¼ï¼›</li><li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šè·å–è¯¥ key çš„è¿‡æœŸæ—¶é—´ï¼Œç„¶åä¸å½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ¯”ç³»ç»Ÿæ—¶é—´å¤§ï¼Œé‚£å°±æ²¡æœ‰è¿‡æœŸï¼Œå¦åˆ™åˆ¤å®šè¯¥ key å·²è¿‡æœŸã€‚</li></ul><p>è¿‡æœŸé”®åˆ¤æ–­æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714211925160-9d700bb2.png" alt="image-20220714211925160" tabindex="0" loading="lazy"><figcaption>image-20220714211925160</figcaption></figure><blockquote><p>æ‹“å±•ï¼šå¤§é‡ key é›†ä¸­è¿‡æœŸé—®é¢˜</p></blockquote><p>å› ä¸ºå¯¼è‡´å®¢æˆ·ç«¯è¯·æ±‚æ²¡åŠæ³•è¢«åŠæ—¶å¤„ç†ï¼Œå“åº”é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>å¦‚ä½•è§£å†³å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸¤ç§å¸¸è§çš„æ–¹æ³•ï¼š</p><ol><li>ç»™ key è®¾ç½®<strong>éšæœºè¿‡æœŸæ—¶é—´</strong>ã€‚</li><li>å¼€å¯ lazy-freeï¼ˆ<strong>æƒ°æ€§åˆ é™¤</strong>/å»¶è¿Ÿé‡Šæ”¾ï¼‰ ã€‚lazy-free ç‰¹æ€§æ˜¯ Redis 4.0 å¼€å§‹å¼•å…¥çš„ï¼ŒæŒ‡çš„æ˜¯è®© Redis é‡‡ç”¨å¼‚æ­¥æ–¹å¼å»¶è¿Ÿé‡Šæ”¾ key ä½¿ç”¨çš„å†…å­˜ï¼Œå°†è¯¥æ“ä½œäº¤ç»™å•ç‹¬çš„å­çº¿ç¨‹å¤„ç†ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</li></ol><p>ä¸ªäººå»ºè®®ä¸ç®¡æ˜¯å¦å¼€å¯ lazy-freeï¼Œæˆ‘ä»¬éƒ½å°½é‡ç»™ key è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ã€‚</p><h3 id="è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆ" aria-hidden="true">#</a> è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ</h3><p>å¸¸ç”¨çš„è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥å°±å‰ä¸¤ä¸ªï¼ˆé‡è¦ï¼è‡ªå·±é€ ç¼“å­˜è½®å­çš„æ—¶å€™éœ€è¦æ ¼å¤–è€ƒè™‘çš„ä¸œè¥¿ï¼‰ï¼š</p><blockquote><p>æƒ°æ€§åˆ é™¤</p></blockquote><p>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è®¿é—® key æ—¶ï¼Œéƒ½æ£€æµ‹ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤è¯¥ keyã€‚</strong></p><p>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å› ä¸ºæ¯æ¬¡è®¿é—®æ—¶ï¼Œæ‰ä¼šæ£€æŸ¥ key æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥æ­¤ç­–ç•¥åªä¼šä½¿ç”¨å¾ˆå°‘çš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹ CPU æ—¶é—´æœ€å‹å¥½ã€‚</li></ul><p>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å¦‚æœä¸€ä¸ª key å·²ç»è¿‡æœŸï¼Œè€Œè¿™ä¸ª key åˆä»ç„¶ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªè¿‡æœŸ key ä¸€ç›´æ²¡æœ‰è¢«è®¿é—®ï¼Œå®ƒæ‰€å ç”¨çš„å†…å­˜å°±ä¸ä¼šé‡Šæ”¾ï¼Œé€ æˆäº†ä¸€å®šçš„å†…å­˜ç©ºé—´æµªè´¹ã€‚æ‰€ä»¥ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹å†…å­˜ä¸å‹å¥½ã€‚</li></ul><blockquote><p>å®šæœŸåˆ é™¤</p></blockquote><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyã€‚</strong></p><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ï¼Œæ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿèƒ½åˆ é™¤ä¸€éƒ¨åˆ†è¿‡æœŸçš„æ•°æ®å‡å°‘äº†è¿‡æœŸé”®å¯¹ç©ºé—´çš„æ— æ•ˆå ç”¨ã€‚</li></ul><p>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>å†…å­˜æ¸…ç†æ–¹é¢æ²¡æœ‰å®šæ—¶åˆ é™¤æ•ˆæœå¥½ï¼ŒåŒæ—¶æ²¡æœ‰æƒ°æ€§åˆ é™¤ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå°‘ã€‚</li><li>éš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ã€‚å¦‚æœæ‰§è¡Œçš„å¤ªé¢‘ç¹ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥å˜å¾—å’Œå®šæ—¶åˆ é™¤ç­–ç•¥ä¸€æ ·ï¼Œå¯¹CPUä¸å‹å¥½ï¼›å¦‚æœæ‰§è¡Œçš„å¤ªå°‘ï¼Œé‚£åˆå’Œæƒ°æ€§åˆ é™¤ä¸€æ ·äº†ï¼Œè¿‡æœŸ key å ç”¨çš„å†…å­˜ä¸ä¼šåŠæ—¶å¾—åˆ°é‡Šæ”¾ã€‚</li></ul><blockquote><p>å®šæ—¶åˆ é™¤</p></blockquote><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>åœ¨è®¾ç½® key çš„è¿‡æœŸæ—¶é—´æ—¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªå®šæ—¶äº‹ä»¶ï¼Œå½“æ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±äº‹ä»¶å¤„ç†å™¨è‡ªåŠ¨æ‰§è¡Œ key çš„åˆ é™¤æ“ä½œã€‚</strong></p><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å¯ä»¥ä¿è¯è¿‡æœŸ key ä¼šè¢«å°½å¿«åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯å†…å­˜å¯ä»¥è¢«å°½å¿«åœ°é‡Šæ”¾ã€‚å› æ­¤ï¼Œå®šæ—¶åˆ é™¤å¯¹å†…å­˜æ˜¯æœ€å‹å¥½çš„ã€‚</li></ul><p>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>åœ¨è¿‡æœŸ key æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸ key å¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ† CPU æ—¶é—´ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½† CPU æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°† CPU æ—¶é—´ç”¨äºåˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚æ‰€ä»¥ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯¹ CPU ä¸å‹å¥½ã€‚</li></ul><h4 id="redis-å†…å­˜æ»¡äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#redis-å†…å­˜æ»¡äº†-ä¼šå‘ç”Ÿä»€ä¹ˆ" aria-hidden="true">#</a> Redis å†…å­˜æ»¡äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h4><p>åœ¨ Redis çš„è¿è¡Œå†…å­˜è¾¾åˆ°äº†æŸä¸ªé˜€å€¼ï¼Œå°±ä¼šè§¦å‘<strong>å†…å­˜æ·˜æ±°æœºåˆ¶</strong>ï¼Œè¿™ä¸ªé˜€å€¼å°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„æœ€å¤§è¿è¡Œå†…å­˜ï¼Œæ­¤å€¼åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œé…ç½®é¡¹ä¸º maxmemoryã€‚</p><h3 id="redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" aria-hidden="true">#</a> Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h3><p>Redis å†…å­˜æ·˜æ±°ç­–ç•¥å…±æœ‰å…«ç§ï¼Œè¿™å…«ç§ç­–ç•¥å¤§ä½“åˆ†ä¸ºã€Œä¸è¿›è¡Œæ•°æ®æ·˜æ±°ã€å’Œã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€ä¸¤ç±»ç­–ç•¥ã€‚</p><p><em>1ã€ä¸è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥</em></p><p><strong>noeviction</strong>ï¼ˆRedis3.0ä¹‹åï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ ï¼šå®ƒè¡¨ç¤ºå½“è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œè€Œæ˜¯ä¸å†æä¾›æœåŠ¡ï¼Œç›´æ¥è¿”å›é”™è¯¯ã€‚</p><p><em>2ã€è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥</em></p><p>é’ˆå¯¹ã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€è¿™ä¸€ç±»ç­–ç•¥ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºã€Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ã€å’Œã€Œåœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ã€è¿™ä¸¤ç±»ç­–ç•¥ã€‚</p><p>åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ï¼š</p><ul><li><strong>volatile-random</strong>ï¼šéšæœºæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ä»»æ„é”®å€¼ï¼›</li><li><strong>volatile-lru</strong>ï¼ˆRedis3.0 ä¹‹å‰ï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>volatile-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€å°‘ä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>volatile-ttl</strong>ï¼šä¼˜å…ˆæ·˜æ±°æ›´æ—©è¿‡æœŸçš„é”®å€¼ã€‚</li></ul><p>åœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ï¼š</p><ul><li><strong>allkeys-random</strong>ï¼šéšæœºæ·˜æ±°ä»»æ„é”®å€¼;</li><li><strong>allkeys-lru</strong>ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>allkeys-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€å°‘ä½¿ç”¨çš„é”®å€¼ã€‚</li></ul><blockquote><p>LRU ç®—æ³•</p></blockquote><p><strong>LRU</strong> å…¨ç§°æ˜¯ Least Recently Used ç¿»è¯‘ä¸º<strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨</strong>ï¼Œä¼šé€‰æ‹©æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚</p><p>ä¼ ç»Ÿ LRU ç®—æ³•çš„å®ç°æ˜¯åŸºäºã€Œé“¾è¡¨ã€ç»“æ„ï¼Œé“¾è¡¨ä¸­çš„å…ƒç´ æŒ‰ç…§æ“ä½œé¡ºåºä»å‰å¾€åæ’åˆ—ï¼Œæœ€æ–°æ“ä½œçš„é”®ä¼šè¢«ç§»åŠ¨åˆ°è¡¨å¤´ï¼Œå½“éœ€è¦å†…å­˜æ·˜æ±°æ—¶ï¼Œåªéœ€è¦åˆ é™¤é“¾è¡¨å°¾éƒ¨çš„å…ƒç´ å³å¯ï¼Œå› ä¸ºé“¾è¡¨å°¾éƒ¨çš„å…ƒç´ å°±ä»£è¡¨æœ€ä¹…æœªè¢«ä½¿ç”¨çš„å…ƒç´ ã€‚</p><p>Redis å¹¶æ²¡æœ‰ä½¿ç”¨è¿™æ ·çš„æ–¹å¼å®ç° LRU ç®—æ³•ï¼Œå› ä¸ºä¼ ç»Ÿçš„ LRU ç®—æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>éœ€è¦ç”¨é“¾è¡¨ç®¡ç†æ‰€æœ‰çš„ç¼“å­˜æ•°æ®ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„ç©ºé—´å¼€é”€ï¼›</li><li>å½“æœ‰æ•°æ®è¢«è®¿é—®æ—¶ï¼Œéœ€è¦åœ¨é“¾è¡¨ä¸ŠæŠŠè¯¥æ•°æ®ç§»åŠ¨åˆ°å¤´ç«¯ï¼Œå¦‚æœæœ‰å¤§é‡æ•°æ®è¢«è®¿é—®ï¼Œå°±ä¼šå¸¦æ¥å¾ˆå¤šé“¾è¡¨ç§»åŠ¨æ“ä½œï¼Œä¼šå¾ˆè€—æ—¶ï¼Œè¿›è€Œä¼šé™ä½ Redis ç¼“å­˜æ€§èƒ½ã€‚</li></ul><blockquote><p>Redis æ˜¯å¦‚ä½•å®ç° LRU ç®—æ³•çš„ï¼Ÿ</p></blockquote><p>Redis å®ç°çš„æ˜¯ä¸€ç§<strong>è¿‘ä¼¼ LRU ç®—æ³•</strong>ï¼Œç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„èŠ‚çº¦å†…å­˜ï¼Œå®ƒçš„<strong>å®ç°æ–¹å¼æ˜¯åœ¨ Redis çš„å¯¹è±¡ç»“æ„ä½“ä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å­—æ®µï¼Œç”¨äºè®°å½•æ­¤æ•°æ®çš„æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</strong>ã€‚</p><p>å½“ Redis è¿›è¡Œå†…å­˜æ·˜æ±°æ—¶ï¼Œä¼šä½¿ç”¨<strong>éšæœºé‡‡æ ·çš„æ–¹å¼æ¥æ·˜æ±°æ•°æ®</strong>ï¼Œå®ƒæ˜¯éšæœºå– 5 ä¸ªå€¼ï¼ˆæ­¤å€¼å¯é…ç½®ï¼‰ï¼Œç„¶å<strong>æ·˜æ±°æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é‚£ä¸ª</strong>ã€‚</p><p>Redis å®ç°çš„ LRU ç®—æ³•çš„ä¼˜ç‚¹ï¼š</p><ul><li>ä¸ç”¨ä¸ºæ‰€æœ‰çš„æ•°æ®ç»´æŠ¤ä¸€ä¸ªå¤§é“¾è¡¨ï¼ŒèŠ‚çœäº†ç©ºé—´å ç”¨ï¼›</li><li>ä¸ç”¨åœ¨æ¯æ¬¡æ•°æ®è®¿é—®æ—¶éƒ½ç§»åŠ¨é“¾è¡¨é¡¹ï¼Œæå‡äº†ç¼“å­˜çš„æ€§èƒ½ï¼›</li></ul><p>ä½†æ˜¯ LRU ç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>æ— æ³•è§£å†³ç¼“å­˜æ±¡æŸ“é—®é¢˜</strong>ï¼Œæ¯”å¦‚åº”ç”¨ä¸€æ¬¡è¯»å–äº†å¤§é‡çš„æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®åªä¼šè¢«è¯»å–è¿™ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šç•™å­˜åœ¨ Redis ç¼“å­˜ä¸­å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé€ æˆç¼“å­˜æ±¡æŸ“ã€‚</p><p>å› æ­¤ï¼Œåœ¨ Redis 4.0 ä¹‹åå¼•å…¥äº† LFU ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯ LFU ç®—æ³•ï¼Ÿ</p></blockquote><p>LFU å…¨ç§°æ˜¯ Least Frequently Used ç¿»è¯‘ä¸º**æœ€è¿‘æœ€ä¸å¸¸ç”¨çš„ï¼Œ**LFU ç®—æ³•æ˜¯æ ¹æ®æ•°æ®è®¿é—®æ¬¡æ•°æ¥æ·˜æ±°æ•°æ®çš„ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®è¿‡å»è¢«è®¿é—®å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„é¢‘ç‡ä¹Ÿæ›´é«˜â€ã€‚</p><p>æ‰€ä»¥ï¼Œ LFU ç®—æ³•ä¼šè®°å½•æ¯ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚å½“ä¸€ä¸ªæ•°æ®è¢«å†æ¬¡è®¿é—®æ—¶ï¼Œå°±ä¼šå¢åŠ è¯¥æ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚è¿™æ ·å°±è§£å†³äº†å¶å°”è¢«è®¿é—®ä¸€æ¬¡ä¹‹åï¼Œæ•°æ®ç•™å­˜åœ¨ç¼“å­˜ä¸­å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„é—®é¢˜ï¼Œç›¸æ¯”äº LRU ç®—æ³•ä¹Ÿæ›´åˆç†ä¸€äº›ã€‚</p><blockquote><p>Redis æ˜¯å¦‚ä½•å®ç° LFU ç®—æ³•çš„ï¼Ÿ</p></blockquote><p>LFU ç®—æ³•ç›¸æ¯”äº LRU ç®—æ³•çš„å®ç°ï¼Œå¤šè®°å½•äº†ã€Œæ•°æ®çš„è®¿é—®é¢‘æ¬¡ã€çš„ä¿¡æ¯ã€‚Redis å¯¹è±¡çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    <span class="token comment">// 24 bitsï¼Œç”¨äºè®°å½•å¯¹è±¡çš„è®¿é—®ä¿¡æ¯</span>
    <span class="token keyword">unsigned</span> lru<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">;</span>  
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µï¼Œåœ¨ LRU ç®—æ³•ä¸‹å’Œ LFU ç®—æ³•ä¸‹ä½¿ç”¨æ–¹å¼å¹¶ä¸ç›¸åŒã€‚</p><p><strong>åœ¨ LRU ç®—æ³•ä¸­</strong>ï¼ŒRedis å¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µæ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼Œå› æ­¤åœ¨ LRU æ¨¡å¼ä¸‹ï¼ŒRediså¯ä»¥æ ¹æ®å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µè®°å½•çš„å€¼ï¼Œæ¥æ¯”è¾ƒæœ€åä¸€æ¬¡ key çš„è®¿é—®æ—¶é—´é•¿ï¼Œä»è€Œæ·˜æ±°æœ€ä¹…æœªè¢«ä½¿ç”¨çš„ keyã€‚</p><p><strong>åœ¨ LFU ç®—æ³•ä¸­</strong>ï¼ŒRediså¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µè¢«åˆ†æˆä¸¤æ®µæ¥å­˜å‚¨ï¼Œé«˜ 16bit å­˜å‚¨ ldt(Last Decrement Time)ï¼Œä½ 8bit å­˜å‚¨ logc(Logistic Counter)ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714211622755-edd94b2f.png" alt="image-20220714211622755" tabindex="0" loading="lazy"><figcaption>image-20220714211622755</figcaption></figure><ul><li>ldt æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼›</li><li>logc æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®é¢‘æ¬¡ï¼Œå®ƒçš„å€¼è¶Šå°è¡¨ç¤ºä½¿ç”¨é¢‘ç‡è¶Šä½ï¼Œè¶Šå®¹æ˜“æ·˜æ±°ï¼Œæ¯ä¸ªæ–°åŠ å…¥çš„ key çš„logc åˆå§‹å€¼ä¸º 5ã€‚</li></ul><p>æ³¨æ„ï¼Œlogc å¹¶ä¸æ˜¯å•çº¯çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ˜¯è®¿é—®é¢‘æ¬¡ï¼ˆè®¿é—®é¢‘ç‡ï¼‰ï¼Œå› ä¸º <strong>logc ä¼šéšæ—¶é—´æ¨ç§»è€Œè¡°å‡çš„</strong>ã€‚</p><p>åœ¨æ¯æ¬¡ key è¢«è®¿é—®æ—¶ï¼Œä¼šå…ˆå¯¹ logc åšä¸€ä¸ªè¡°å‡æ“ä½œï¼Œè¡°å‡çš„å€¼è·Ÿå‰åè®¿é—®æ—¶é—´çš„å·®è·æœ‰å…³ç³»ï¼Œå¦‚æœä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´ä¸è¿™ä¸€æ¬¡è®¿é—®çš„æ—¶é—´å·®è·å¾ˆå¤§ï¼Œé‚£ä¹ˆè¡°å‡çš„å€¼å°±è¶Šå¤§ï¼Œè¿™æ ·å®ç°çš„ LFU ç®—æ³•æ˜¯æ ¹æ®<strong>è®¿é—®é¢‘ç‡</strong>æ¥æ·˜æ±°æ•°æ®çš„ï¼Œè€Œä¸åªæ˜¯è®¿é—®æ¬¡æ•°ã€‚è®¿é—®é¢‘ç‡éœ€è¦è€ƒè™‘ key çš„è®¿é—®æ˜¯å¤šé•¿æ—¶é—´æ®µå†…å‘ç”Ÿçš„ã€‚key çš„å…ˆå‰è®¿é—®è·ç¦»å½“å‰æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ª key çš„è®¿é—®é¢‘ç‡ç›¸åº”åœ°ä¹Ÿå°±ä¼šé™ä½ï¼Œè¿™æ ·è¢«æ·˜æ±°çš„æ¦‚ç‡ä¹Ÿä¼šæ›´å¤§ã€‚</p><p>å¯¹ logc åšå®Œè¡°å‡æ“ä½œåï¼Œå°±å¼€å§‹å¯¹ logc è¿›è¡Œå¢åŠ æ“ä½œï¼Œå¢åŠ æ“ä½œå¹¶ä¸æ˜¯å•çº¯çš„ + 1ï¼Œè€Œæ˜¯æ ¹æ®æ¦‚ç‡å¢åŠ ï¼Œå¦‚æœ logc è¶Šå¤§çš„ keyï¼Œå®ƒçš„ logc å°±è¶Šéš¾å†å¢åŠ ã€‚</p><p>æ‰€ä»¥ï¼ŒRedis åœ¨è®¿é—® key æ—¶ï¼Œå¯¹äº logc æ˜¯è¿™æ ·å˜åŒ–çš„ï¼š</p><ol><li>å…ˆæŒ‰ç…§ä¸Šæ¬¡è®¿é—®è·ç¦»å½“å‰çš„æ—¶é•¿ï¼Œæ¥å¯¹ logc è¿›è¡Œè¡°å‡ï¼›</li><li>ç„¶åï¼Œå†æŒ‰ç…§ä¸€å®šæ¦‚ç‡å¢åŠ  logc çš„å€¼</li></ol><p>redis.conf æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼Œç”¨äºè°ƒæ•´ LFU ç®—æ³•ä»è€Œæ§åˆ¶ logc çš„å¢é•¿å’Œè¡°å‡ï¼š</p><ul><li><code>lfu-decay-time</code> ç”¨äºè°ƒæ•´ logc çš„è¡°å‡é€Ÿåº¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ•°å€¼ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œlfu-decay-time å€¼è¶Šå¤§ï¼Œè¡°å‡è¶Šæ…¢ï¼›</li><li><code>lfu-log-factor</code> ç”¨äºè°ƒæ•´ logc çš„å¢é•¿é€Ÿåº¦ï¼Œlfu-log-factor å€¼è¶Šå¤§ï¼Œlogc å¢é•¿è¶Šæ…¢ã€‚</li></ul><h3 id="è·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#è·³è·ƒè¡¨" aria-hidden="true">#</a> è·³è·ƒè¡¨</h3><h4 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a> ç®€ä»‹</h4><p>è·³è·ƒè¡¨ï¼ˆskiplistï¼‰æ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œç”± <strong>William Pugh</strong> åœ¨è®ºæ–‡ã€ŠSkip lists: a probabilistic alternative to balanced treesã€‹ä¸­æå‡ºï¼Œæ˜¯ä¸€ç§å¯ä»¥ä¸å¹³è¡¡æ ‘åª²ç¾çš„å±‚æ¬¡åŒ–é“¾è¡¨ç»“æ„â€”â€”æŸ¥æ‰¾ã€åˆ é™¤ã€æ·»åŠ ç­‰æ“ä½œéƒ½å¯ä»¥åœ¨å¯¹æ•°æœŸæœ›æ—¶é—´ä¸‹å®Œæˆï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„è·³è·ƒè¡¨ä¾‹å­ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150511611-b5e8dcf2.png" alt="image-20220715150511611" tabindex="0" loading="lazy"><figcaption>image-20220715150511611</figcaption></figure><p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡ä¸­æåˆ°äº† Redis çš„äº”ç§åŸºæœ¬ç»“æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åš <strong>æœ‰åºåˆ—è¡¨ zset</strong> çš„æ•°æ®ç»“æ„ï¼Œå®ƒç±»ä¼¼äº Java ä¸­çš„ <strong>SortedSet</strong> å’Œ <strong>HashMap</strong> çš„ç»“åˆä½“ï¼Œä¸€æ–¹é¢å®ƒæ˜¯ä¸€ä¸ª set ä¿è¯äº†å†…éƒ¨ value çš„å”¯ä¸€æ€§ï¼Œå¦ä¸€æ–¹é¢åˆå¯ä»¥ç»™æ¯ä¸ª value èµ‹äºˆä¸€ä¸ªæ’åºçš„æƒé‡å€¼ scoreï¼Œæ¥è¾¾åˆ° <strong>æ’åº</strong> çš„ç›®çš„ã€‚</p><p>å®ƒçš„å†…éƒ¨å®ç°å°±ä¾èµ–äº†ä¸€ç§å«åš <strong>ã€Œè·³è·ƒåˆ—è¡¨ã€</strong> çš„æ•°æ®ç»“æ„ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨è·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨è·³è·ƒè¡¨" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆä½¿ç”¨è·³è·ƒè¡¨</h4><p>é¦–å…ˆï¼Œå› ä¸º zset è¦æ”¯æŒéšæœºçš„æ’å…¥å’Œåˆ é™¤ï¼Œæ‰€ä»¥å®ƒ <strong>ä¸å®œä½¿ç”¨æ•°ç»„æ¥å®ç°</strong>ï¼Œå…³äºæ’åºé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“å°±æƒ³åˆ° <strong>çº¢é»‘æ ‘/ å¹³è¡¡æ ‘</strong> è¿™æ ·çš„æ ‘å½¢ç»“æ„ï¼Œä¸ºä»€ä¹ˆ Redis ä¸ä½¿ç”¨è¿™æ ·ä¸€äº›ç»“æ„å‘¢ï¼Ÿ</p><ol><li><strong>æ€§èƒ½è€ƒè™‘ï¼š</strong> åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ ‘å½¢ç»“æ„éœ€è¦æ‰§è¡Œä¸€äº›ç±»ä¼¼äº rebalance è¿™æ ·çš„å¯èƒ½æ¶‰åŠæ•´æ£µæ ‘çš„æ“ä½œï¼Œç›¸å¯¹æ¥è¯´è·³è·ƒè¡¨çš„å˜åŒ–åªæ¶‰åŠå±€éƒ¨ <em>(ä¸‹é¢è¯¦ç»†è¯´)</em>ï¼›</li><li><strong>å®ç°è€ƒè™‘ï¼š</strong> åœ¨å¤æ‚åº¦ä¸çº¢é»‘æ ‘ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè·³è·ƒè¡¨å®ç°èµ·æ¥æ›´ç®€å•ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ ç›´è§‚ï¼›</li></ol><p>åŸºäºä»¥ä¸Šçš„ä¸€äº›è€ƒè™‘ï¼ŒRedis åŸºäº <strong>William Pugh</strong> çš„è®ºæ–‡åšå‡ºä¸€äº›æ”¹è¿›åé‡‡ç”¨äº† <strong>è·³è·ƒè¡¨</strong> è¿™æ ·çš„ç»“æ„ã€‚</p><h4 id="æœ¬è´¨æ˜¯è§£å†³æŸ¥æ‰¾é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#æœ¬è´¨æ˜¯è§£å†³æŸ¥æ‰¾é—®é¢˜" aria-hidden="true">#</a> æœ¬è´¨æ˜¯è§£å†³æŸ¥æ‰¾é—®é¢˜</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæ™®é€šçš„é“¾è¡¨ç»“æ„ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150536830-51503fc5.png" alt="image-20220715150536830" tabindex="0" loading="lazy"><figcaption>image-20220715150536830</figcaption></figure><p>æˆ‘ä»¬éœ€è¦è¿™ä¸ªé“¾è¡¨æŒ‰ç…§ score å€¼è¿›è¡Œæ’åºï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä½åˆ°æ’å…¥ç‚¹ï¼Œè¿™æ ·æ‰å¯ä»¥ç»§ç»­ä¿è¯é“¾è¡¨æ˜¯æœ‰åºçš„ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ <strong>äºŒåˆ†æŸ¥æ‰¾æ³•</strong>ï¼Œä½†äºŒåˆ†æŸ¥æ‰¾æ˜¯æœ‰åºæ•°ç»„çš„ï¼Œé“¾è¡¨æ²¡åŠæ³•è¿›è¡Œä½ç½®å®šä½ï¼Œæˆ‘ä»¬é™¤äº†éå†æ•´ä¸ªæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ç»™å®šæ•°æ®å¤§çš„èŠ‚ç‚¹ä¸ºæ­¢ <em>ï¼ˆæ—¶é—´å¤æ‚åº¦ O(n))</em> ä¼¼ä¹æ²¡æœ‰æ›´å¥½çš„åŠæ³•ã€‚</p><p>ä½†å‡å¦‚æˆ‘ä»¬æ¯ç›¸é‚»ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å°±å¢åŠ ä¸€ä¸ªæŒ‡é’ˆï¼Œè®©æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150547405-317170cb.png" alt="image-20220715150547405" tabindex="0" loading="lazy"><figcaption>image-20220715150547405</figcaption></figure><p>è¿™æ ·æ‰€æœ‰æ–°å¢çš„æŒ‡é’ˆè¿æˆäº†ä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œä½†å®ƒåŒ…å«çš„æ•°æ®å´åªæœ‰åŸæ¥çš„ä¸€åŠ <em>ï¼ˆå›¾ä¸­çš„ä¸º 3ï¼Œ11ï¼‰</em>ã€‚</p><p>ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾æ•°æ®æ—¶ï¼Œå¯ä»¥æ ¹æ®è¿™æ¡æ–°çš„é“¾è¡¨æŸ¥æ‰¾ï¼Œå¦‚æœç¢°åˆ°æ¯”å¾…æŸ¥æ‰¾æ•°æ®å¤§çš„èŠ‚ç‚¹æ—¶ï¼Œå†å›åˆ°åŸæ¥çš„é“¾è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾ 7ï¼ŒæŸ¥æ‰¾çš„è·¯å¾„åˆ™æ˜¯æ²¿ç€ä¸‹å›¾ä¸­æ ‡æ³¨å‡ºçš„çº¢è‰²æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ–¹å‘è¿›è¡Œçš„ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150600549-d465ff76.png" alt="image-20220715150600549" tabindex="0" loading="lazy"><figcaption>image-20220715150600549</figcaption></figure><p>è¿™æ˜¯ä¸€ä¸ªç•¥å¾®æç«¯çš„ä¾‹å­ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æ–°å¢åŠ çš„æŒ‡é’ˆæŸ¥æ‰¾ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä¸é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹é€ä¸€è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·æ”¹è¿›ä¹‹åéœ€è¦æ¯”è¾ƒçš„èŠ‚ç‚¹æ•°å¤§æ¦‚åªæœ‰åŸæ¥çš„ä¸€åŠã€‚</p><p>åˆ©ç”¨åŒæ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–°äº§ç”Ÿçš„é“¾è¡¨ä¸Šï¼Œç»§ç»­ä¸ºæ¯ä¸¤ä¸ªç›¸é‚»çš„èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡é’ˆï¼Œä»è€Œäº§ç”Ÿç¬¬ä¸‰å±‚é“¾è¡¨ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150622214-5c1b9bb5.png" alt="image-20220715150622214" tabindex="0" loading="lazy"><figcaption>image-20220715150622214</figcaption></figure><p>åœ¨è¿™ä¸ªæ–°çš„ä¸‰å±‚é“¾è¡¨ç»“æ„ä¸­ï¼Œæˆ‘ä»¬è¯•ç€ <strong>æŸ¥æ‰¾ 13</strong>ï¼Œé‚£ä¹ˆæ²¿ç€æœ€ä¸Šå±‚é“¾è¡¨é¦–å…ˆæ¯”è¾ƒçš„æ˜¯ 11ï¼Œå‘ç° 11 æ¯” 13 å°ï¼Œäºæ˜¯æˆ‘ä»¬å°±çŸ¥é“åªéœ€è¦åˆ° 11 åé¢ç»§ç»­æŸ¥æ‰¾ï¼Œ<strong>ä»è€Œä¸€ä¸‹å­è·³è¿‡äº† 11 å‰é¢çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</strong></p><p>å¯ä»¥æƒ³è±¡ï¼Œå½“é“¾è¡¨è¶³å¤Ÿé•¿ï¼Œè¿™æ ·çš„å¤šå±‚é“¾è¡¨ç»“æ„å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·³è¿‡å¾ˆå¤šä¸‹å±‚èŠ‚ç‚¹ï¼Œä»è€ŒåŠ å¿«æŸ¥æ‰¾çš„æ•ˆç‡ã€‚</p><h4 id="æ›´è¿›ä¸€æ­¥çš„è·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#æ›´è¿›ä¸€æ­¥çš„è·³è·ƒè¡¨" aria-hidden="true">#</a> æ›´è¿›ä¸€æ­¥çš„è·³è·ƒè¡¨</h4><p><strong>è·³è·ƒè¡¨ skiplist</strong> å°±æ˜¯å—åˆ°è¿™ç§å¤šå±‚é“¾è¡¨ç»“æ„çš„å¯å‘è€Œè®¾è®¡å‡ºæ¥çš„ã€‚æŒ‰ç…§ä¸Šé¢ç”Ÿæˆé“¾è¡¨çš„æ–¹å¼ï¼Œä¸Šé¢æ¯ä¸€å±‚é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œæ˜¯ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°çš„ä¸€åŠï¼Œè¿™æ ·æŸ¥æ‰¾è¿‡ç¨‹å°±éå¸¸ç±»ä¼¼äºä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ï¼Œä½¿å¾—æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ° <em>O(logn)</em>ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚æ–°æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ä¹‹åï¼Œå°±ä¼šæ‰“ä¹±ä¸Šä¸‹ç›¸é‚»ä¸¤å±‚é“¾è¡¨ä¸ŠèŠ‚ç‚¹ä¸ªæ•°ä¸¥æ ¼çš„ 2:1 çš„å¯¹åº”å…³ç³»ã€‚å¦‚æœè¦ç»´æŒè¿™ç§å¯¹åº”å…³ç³»ï¼Œå°±å¿…é¡»æŠŠæ–°æ’å…¥çš„èŠ‚ç‚¹åé¢çš„æ‰€æœ‰èŠ‚ç‚¹ <em>ï¼ˆä¹ŸåŒ…æ‹¬æ–°æ’å…¥çš„èŠ‚ç‚¹ï¼‰</em> é‡æ–°è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¼šè®©æ—¶é—´å¤æ‚åº¦é‡æ–°èœ•åŒ–æˆ <em>O(n)</em>ã€‚åˆ é™¤æ•°æ®ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p><p><strong>skiplist</strong> ä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œå®ƒä¸è¦æ±‚ä¸Šä¸‹ç›¸é‚»ä¸¤å±‚é“¾è¡¨ä¹‹é—´çš„èŠ‚ç‚¹ä¸ªæ•°æœ‰ä¸¥æ ¼çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ <strong>ä¸ºæ¯ä¸ªèŠ‚ç‚¹éšæœºå‡ºä¸€ä¸ªå±‚æ•°(level)</strong>ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹éšæœºå‡ºçš„å±‚æ•°æ˜¯ 3ï¼Œé‚£ä¹ˆå°±æŠŠå®ƒé“¾å…¥åˆ°ç¬¬ 1 å±‚åˆ°ç¬¬ 3 å±‚è¿™ä¸‰å±‚é“¾è¡¨ä¸­ã€‚ä¸ºäº†è¡¨è¾¾æ¸…æ¥šï¼Œä¸‹å›¾å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ä¸€æ­¥æ­¥çš„æ’å…¥æ“ä½œä»è€Œå½¢æˆä¸€ä¸ª skiplist çš„è¿‡ç¨‹ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150657023-afbf03d0.png" alt="image-20220715150657023" tabindex="0" loading="lazy"><figcaption>image-20220715150657023</figcaption></figure><p>ä»ä¸Šé¢çš„åˆ›å»ºå’Œæ’å…¥çš„è¿‡ç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å±‚æ•°ï¼ˆlevelï¼‰æ˜¯éšæœºå‡ºæ¥çš„ï¼Œè€Œä¸”æ–°æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–èŠ‚ç‚¹çš„å±‚æ•°ï¼Œå› æ­¤ï¼Œ<strong>æ’å…¥æ“ä½œåªéœ€è¦ä¿®æ”¹èŠ‚ç‚¹å‰åçš„æŒ‡é’ˆï¼Œè€Œä¸éœ€è¦å¯¹å¤šä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œè°ƒæ•´</strong>ï¼Œè¿™å°±é™ä½äº†æ’å…¥æ“ä½œçš„å¤æ‚åº¦ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å‡è®¾ä»æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„è¿™ä¸ªç»“æ„ä¸­æŸ¥æ‰¾ 23 è¿™ä¸ªä¸å­˜åœ¨çš„æ•°ï¼Œé‚£ä¹ˆæŸ¥æ‰¾è·¯å¾„ä¼šå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150710832-7da32d5b.png" alt="image-20220715150710832" tabindex="0" loading="lazy"><figcaption>image-20220715150710832</figcaption></figure><h4 id="è·³è·ƒè¡¨çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#è·³è·ƒè¡¨çš„å®ç°" aria-hidden="true">#</a> è·³è·ƒè¡¨çš„å®ç°</h4><p>Redis ä¸­çš„è·³è·ƒè¡¨ç”± <code>server.h/zskiplistNode</code> å’Œ <code>server.h/zskiplist</code> ä¸¤ä¸ªç»“æ„å®šä¹‰ï¼Œå‰è€…ä¸ºè·³è·ƒè¡¨èŠ‚ç‚¹ï¼Œåè€…åˆ™ä¿å­˜äº†è·³è·ƒèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒä¹‹å‰çš„ <code>é›†åˆ list</code> ç»“æ„ç±»ä¼¼ï¼Œå…¶å®åªæœ‰ <code>zskiplistNode</code> å°±å¯ä»¥å®ç°äº†ï¼Œä½†æ˜¯å¼•å…¥åè€…æ˜¯ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„æ“ä½œï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* ZSETs use a specialized version of Skiplists */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token punctuation">{</span>
    <span class="token comment">// value</span>
    sds ele<span class="token punctuation">;</span>
    <span class="token comment">// åˆ†å€¼</span>
    <span class="token keyword">double</span> score<span class="token punctuation">;</span>
    <span class="token comment">// åé€€æŒ‡é’ˆ</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>backward<span class="token punctuation">;</span>
    <span class="token comment">// å±‚</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistLevel</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‰è¿›æŒ‡é’ˆ</span>
        <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>forward<span class="token punctuation">;</span>
        <span class="token comment">// è·¨åº¦</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">long</span> span<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> level<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> zskiplistNode<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplist</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·³è·ƒè¡¨å¤´æŒ‡é’ˆ</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>header<span class="token punctuation">,</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token comment">// è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> length<span class="token punctuation">;</span>
    <span class="token comment">// è¡¨ä¸­å±‚æ•°æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°</span>
    <span class="token keyword">int</span> level<span class="token punctuation">;</span>
<span class="token punctuation">}</span> zskiplist<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¦‚æ–‡ç« å¼€å¤´ç”»å‡ºæ¥çš„é‚£å¼ æ ‡å‡†çš„è·³è·ƒè¡¨é‚£æ ·ã€‚</p><h5 id="éšæœºå±‚æ•°" tabindex="-1"><a class="header-anchor" href="#éšæœºå±‚æ•°" aria-hidden="true">#</a> éšæœºå±‚æ•°</h5><p>å¯¹äºæ¯ä¸€ä¸ªæ–°æ’å…¥çš„èŠ‚ç‚¹ï¼Œéƒ½éœ€è¦è°ƒç”¨ä¸€ä¸ªéšæœºç®—æ³•ç»™å®ƒåˆ†é…ä¸€ä¸ªåˆç†çš„å±‚æ•°ï¼Œæºç åœ¨ <code>t_zset.c/zslRandomLevel(void)</code> ä¸­è¢«å®šä¹‰ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">zslRandomLevel</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFFFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>ZSKIPLIST_P <span class="token operator">*</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        level <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>level<span class="token operator">&lt;</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">)</span> <span class="token operator">?</span> level <span class="token operator">:</span> ZSKIPLIST_MAXLEVEL<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›´è§‚ä¸ŠæœŸæœ›çš„ç›®æ ‡æ˜¯ 50% çš„æ¦‚ç‡è¢«åˆ†é…åˆ° <code>Level 1</code>ï¼Œ25% çš„æ¦‚ç‡è¢«åˆ†é…åˆ° <code>Level 2</code>ï¼Œ12.5% çš„æ¦‚ç‡è¢«åˆ†é…åˆ° <code>Level 3</code>ï¼Œä»¥æ­¤ç±»æ¨...æœ‰ 2-63 çš„æ¦‚ç‡è¢«åˆ†é…åˆ°æœ€é¡¶å±‚ï¼Œå› ä¸ºè¿™é‡Œæ¯ä¸€å±‚çš„æ™‹å‡ç‡éƒ½æ˜¯ 50%ã€‚</p><p><strong>Redis è·³è·ƒè¡¨é»˜è®¤å…è®¸æœ€å¤§çš„å±‚æ•°æ˜¯ 32</strong>ï¼Œè¢«æºç ä¸­ <code>ZSKIPLIST_MAXLEVEL</code> å®šä¹‰ï¼Œå½“ <code>Level[0]</code> æœ‰ 264 ä¸ªå…ƒç´ æ—¶ï¼Œæ‰èƒ½è¾¾åˆ° 32 å±‚ï¼Œæ‰€ä»¥å®šä¹‰ 32 å®Œå…¨å¤Ÿç”¨äº†ã€‚</p><h5 id="åˆ›å»ºè·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºè·³è·ƒè¡¨" aria-hidden="true">#</a> åˆ›å»ºè·³è·ƒè¡¨</h5><p>è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œåœ¨æºç ä¸­çš„ <code>t_zset.c/zslCreate</code> ä¸­è¢«å®šä¹‰ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>zskiplist <span class="token operator">*</span><span class="token function">zslCreate</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">;</span>

    <span class="token comment">// ç”³è¯·å†…å­˜ç©ºé—´</span>
    zsl <span class="token operator">=</span> <span class="token function">zmalloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>zsl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆå§‹åŒ–å±‚æ•°ä¸º 1</span>
    zsl<span class="token operator">-&gt;</span>level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆå§‹åŒ–é•¿åº¦ä¸º 0</span>
    zsl<span class="token operator">-&gt;</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªå±‚æ•°ä¸º 32ï¼Œåˆ†æ•°ä¸º 0ï¼Œæ²¡æœ‰ value å€¼çš„è·³è·ƒè¡¨å¤´èŠ‚ç‚¹</span>
    zsl<span class="token operator">-&gt;</span>header <span class="token operator">=</span> <span class="token function">zslCreateNode</span><span class="token punctuation">(</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// è·³è·ƒè¡¨å¤´èŠ‚ç‚¹åˆå§‹åŒ–</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> ZSKIPLIST_MAXLEVEL<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°†è·³è·ƒè¡¨å¤´èŠ‚ç‚¹çš„æ‰€æœ‰å‰è¿›æŒ‡é’ˆ forward è®¾ç½®ä¸º NULL</span>
        zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token comment">// å°†è·³è·ƒè¡¨å¤´èŠ‚ç‚¹çš„æ‰€æœ‰è·¨åº¦ span è®¾ç½®ä¸º 0</span>
        zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·³è·ƒè¡¨å¤´èŠ‚ç‚¹çš„åé€€æŒ‡é’ˆ backward ç½®ä¸º NULL</span>
    zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>backward <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token comment">// è¡¨å¤´æŒ‡å‘è·³è·ƒè¡¨å°¾èŠ‚ç‚¹çš„æŒ‡é’ˆç½®ä¸º NULL</span>
    zsl<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> zsl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å³æ‰§è¡Œå®Œä¹‹ååˆ›å»ºäº†å¦‚ä¸‹ç»“æ„çš„åˆå§‹åŒ–è·³è·ƒè¡¨ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715150812789-040f6adc.png" alt="image-20220715150812789" tabindex="0" loading="lazy"><figcaption>image-20220715150812789</figcaption></figure><h5 id="æ’å…¥èŠ‚ç‚¹å®ç°" tabindex="-1"><a class="header-anchor" href="#æ’å…¥èŠ‚ç‚¹å®ç°" aria-hidden="true">#</a> æ’å…¥èŠ‚ç‚¹å®ç°</h5><p>è¿™å‡ ä¹æ˜¯æœ€é‡è¦çš„ä¸€æ®µä»£ç äº†ï¼Œä½†æ€»ä½“æ€è·¯ä¹Ÿæ¯”è¾ƒæ¸…æ™°ç®€å•ï¼Œå¦‚æœç†è§£äº†ä¸Šé¢æ‰€è¯´çš„è·³è·ƒè¡¨çš„åŸç†ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ç†æ¸…æ¥šæ’å…¥èŠ‚ç‚¹æ—¶å‘ç”Ÿçš„å‡ ä¸ªåŠ¨ä½œ <em>ï¼ˆå‡ ä¹è·Ÿé“¾è¡¨ç±»ä¼¼ï¼‰</em>ï¼š</p><ol><li>æ‰¾åˆ°å½“å‰æˆ‘éœ€è¦æ’å…¥çš„ä½ç½® <em>ï¼ˆå…¶ä¸­åŒ…æ‹¬ç›¸åŒ score æ—¶çš„å¤„ç†ï¼‰</em>ï¼›</li><li>åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œè°ƒæ•´å‰åçš„æŒ‡é’ˆæŒ‡å‘ï¼Œå®Œæˆæ’å…¥ï¼›</li></ol><p>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œæˆ‘æŠŠæºç  <code>t_zset.c/zslInsert</code> å®šä¹‰çš„æ’å…¥å‡½æ•°æ‹†æˆäº†å‡ ä¸ªéƒ¨åˆ†</p><h6 id="ç¬¬ä¸€éƒ¨åˆ†-å£°æ˜éœ€è¦å­˜å‚¨çš„å˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€éƒ¨åˆ†-å£°æ˜éœ€è¦å­˜å‚¨çš„å˜é‡" aria-hidden="true">#</a> ç¬¬ä¸€éƒ¨åˆ†ï¼šå£°æ˜éœ€è¦å­˜å‚¨çš„å˜é‡</h6><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">// å­˜å‚¨æœç´¢è·¯å¾„</span>
zskiplistNode <span class="token operator">*</span>update<span class="token punctuation">[</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>x<span class="token punctuation">;</span>
<span class="token comment">// å­˜å‚¨ç»è¿‡çš„èŠ‚ç‚¹è·¨åº¦</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> rank<span class="token punctuation">[</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i<span class="token punctuation">,</span> level<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="ç¬¬äºŒéƒ¨åˆ†-æœç´¢å½“å‰èŠ‚ç‚¹æ’å…¥ä½ç½®" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒéƒ¨åˆ†-æœç´¢å½“å‰èŠ‚ç‚¹æ’å…¥ä½ç½®" aria-hidden="true">#</a> ç¬¬äºŒéƒ¨åˆ†ï¼šæœç´¢å½“å‰èŠ‚ç‚¹æ’å…¥ä½ç½®</h6><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">serverAssert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isnan</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>header<span class="token punctuation">;</span>
<span class="token comment">// é€æ­¥é™çº§å¯»æ‰¾ç›®æ ‡èŠ‚ç‚¹ï¼Œå¾—åˆ° &quot;æœç´¢è·¯å¾„&quot;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* store rank that is crossed to reach the insert position */</span>
    rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">==</span> <span class="token punctuation">(</span>zsl<span class="token operator">-&gt;</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> rank<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœ score ç›¸ç­‰ï¼Œè¿˜éœ€è¦æ¯”è¾ƒ value å€¼</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">&lt;</span> score <span class="token operator">||</span>
                <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">==</span> score <span class="token operator">&amp;&amp;</span>
                <span class="token function">sdscmp</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>ele<span class="token punctuation">,</span>ele<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span<span class="token punctuation">;</span>
        x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®°å½• &quot;æœç´¢è·¯å¾„&quot;</span>
    update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è®¨è®ºï¼š</strong> æœ‰ä¸€ç§æç«¯çš„æƒ…å†µï¼Œå°±æ˜¯è·³è·ƒè¡¨ä¸­çš„æ‰€æœ‰ score å€¼éƒ½æ˜¯ä¸€æ ·ï¼Œzset çš„æŸ¥æ‰¾æ€§èƒ½ä¼šä¸ä¼šé€€åŒ–ä¸º O(n) å‘¢ï¼Ÿ</p><p>ä»ä¸Šé¢çš„æºç ä¸­æˆ‘ä»¬å¯ä»¥å‘ç° zset çš„æ’åºå…ƒç´ ä¸åªæ˜¯çœ‹ score å€¼ï¼Œä¹Ÿä¼šæ¯”è¾ƒ value å€¼ <em>ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒï¼‰</em></p><h6 id="ç¬¬ä¸‰éƒ¨åˆ†-ç”Ÿæˆæ’å…¥èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰éƒ¨åˆ†-ç”Ÿæˆæ’å…¥èŠ‚ç‚¹" aria-hidden="true">#</a> ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿæˆæ’å…¥èŠ‚ç‚¹</h6><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* we assume the element is not already inside, since we allow duplicated
 * scores, reinserting the same element should never happen since the
 * caller of zslInsert() should test in the hash table if the element is
 * already inside or not. */</span>
level <span class="token operator">=</span> <span class="token function">zslRandomLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¦‚æœéšæœºç”Ÿæˆçš„ level è¶…è¿‡äº†å½“å‰æœ€å¤§ level éœ€è¦æ›´æ–°è·³è·ƒè¡¨çš„ä¿¡æ¯</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&gt;</span> zsl<span class="token operator">-&gt;</span>level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>level<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>header<span class="token punctuation">;</span>
        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    zsl<span class="token operator">-&gt;</span>level <span class="token operator">=</span> level<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span>
x <span class="token operator">=</span> <span class="token function">zslCreateNode</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span>score<span class="token punctuation">,</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="ç¬¬å››éƒ¨åˆ†-é‡æ’å‰å‘æŒ‡é’ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››éƒ¨åˆ†-é‡æ’å‰å‘æŒ‡é’ˆ" aria-hidden="true">#</a> ç¬¬å››éƒ¨åˆ†ï¼šé‡æ’å‰å‘æŒ‡é’ˆ</h6><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">=</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
    update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">=</span> x<span class="token punctuation">;</span>

    <span class="token comment">/* update span covered by update[i] as x is inserted here */</span>
    x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">=</span> update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">-</span> <span class="token punctuation">(</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">=</span> <span class="token punctuation">(</span>rank<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* increment span for untouched levels */</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> level<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> zsl<span class="token operator">-&gt;</span>level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="ç¬¬äº”éƒ¨åˆ†-é‡æ’åå‘æŒ‡é’ˆå¹¶è¿”å›" tabindex="-1"><a class="header-anchor" href="#ç¬¬äº”éƒ¨åˆ†-é‡æ’åå‘æŒ‡é’ˆå¹¶è¿”å›" aria-hidden="true">#</a> ç¬¬äº”éƒ¨åˆ†ï¼šé‡æ’åå‘æŒ‡é’ˆå¹¶è¿”å›</h6><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>x<span class="token operator">-&gt;</span>backward <span class="token operator">=</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> zsl<span class="token operator">-&gt;</span>header<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">NULL</span> <span class="token operator">:</span> update<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">)</span>
    x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>backward <span class="token operator">=</span> x<span class="token punctuation">;</span>
<span class="token keyword">else</span>
    zsl<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> x<span class="token punctuation">;</span>
zsl<span class="token operator">-&gt;</span>length<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> x<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="èŠ‚ç‚¹åˆ é™¤å®ç°" tabindex="-1"><a class="header-anchor" href="#èŠ‚ç‚¹åˆ é™¤å®ç°" aria-hidden="true">#</a> èŠ‚ç‚¹åˆ é™¤å®ç°</h5><p>åˆ é™¤è¿‡ç¨‹ç”±æºç ä¸­çš„ <code>t_zset.c/zslDeleteNode</code> å®šä¹‰ï¼Œå’Œæ’å…¥è¿‡ç¨‹ç±»ä¼¼ï¼Œéƒ½éœ€è¦å…ˆæŠŠè¿™ä¸ª <strong>&quot;æœç´¢è·¯å¾„&quot;</strong> æ‰¾å‡ºæ¥ï¼Œç„¶åå¯¹äºæ¯ä¸ªå±‚çš„ç›¸å…³èŠ‚ç‚¹é‡æ’ä¸€ä¸‹å‰å‘åå‘æŒ‡é’ˆï¼ŒåŒæ—¶è¿˜è¦æ³¨æ„æ›´æ–°ä¸€ä¸‹æœ€é«˜å±‚æ•° <code>maxLevel</code>ï¼Œç›´æ¥æ”¾æºç  <em>(å¦‚æœç†è§£äº†æ’å…¥è¿™é‡Œè¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„)</em>ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Internal function used by zslDelete, zslDeleteByScore and zslDeleteByRank */</span>
<span class="token keyword">void</span> <span class="token function">zslDeleteNode</span><span class="token punctuation">(</span>zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">,</span> zskiplistNode <span class="token operator">*</span>x<span class="token punctuation">,</span> zskiplistNode <span class="token operator">*</span><span class="token operator">*</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> zsl<span class="token operator">-&gt;</span>level<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">==</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">+=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>backward <span class="token operator">=</span> x<span class="token operator">-&gt;</span>backward<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        zsl<span class="token operator">-&gt;</span>tail <span class="token operator">=</span> x<span class="token operator">-&gt;</span>backward<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>zsl<span class="token operator">-&gt;</span>level <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> zsl<span class="token operator">-&gt;</span>header<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>zsl<span class="token operator">-&gt;</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        zsl<span class="token operator">-&gt;</span>level<span class="token operator">--</span><span class="token punctuation">;</span>
    zsl<span class="token operator">-&gt;</span>length<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Delete an element with matching score/element from the skiplist.
 * The function returns 1 if the node was found and deleted, otherwise
 * 0 is returned.
 *
 * If &#39;node&#39; is NULL the deleted node is freed by zslFreeNode(), otherwise
 * it is not freed (but just unlinked) and *node is set to the node pointer,
 * so that it is possible for the caller to reuse the node (including the
 * referenced SDS string at node-&gt;ele). */</span>
<span class="token keyword">int</span> <span class="token function">zslDelete</span><span class="token punctuation">(</span>zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">,</span> <span class="token keyword">double</span> score<span class="token punctuation">,</span> sds ele<span class="token punctuation">,</span> zskiplistNode <span class="token operator">*</span><span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    zskiplistNode <span class="token operator">*</span>update<span class="token punctuation">[</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>x<span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    x <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>header<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">&lt;</span> score <span class="token operator">||</span>
                    <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">==</span> score <span class="token operator">&amp;&amp;</span>
                     <span class="token function">sdscmp</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>ele<span class="token punctuation">,</span>ele<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        update<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* We may have multiple elements with the same score, what we need
     * is to find the element with both the right score and object. */</span>
    x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&amp;&amp;</span> score <span class="token operator">==</span> x<span class="token operator">-&gt;</span>score <span class="token operator">&amp;&amp;</span> <span class="token function">sdscmp</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>ele<span class="token punctuation">,</span>ele<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">zslDeleteNode</span><span class="token punctuation">(</span>zsl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span>
            <span class="token function">zslFreeNode</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token operator">*</span>node <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* not found */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="èŠ‚ç‚¹æ›´æ–°å®ç°" tabindex="-1"><a class="header-anchor" href="#èŠ‚ç‚¹æ›´æ–°å®ç°" aria-hidden="true">#</a> èŠ‚ç‚¹æ›´æ–°å®ç°</h5><p>å½“æˆ‘ä»¬è°ƒç”¨ <code>ZADD</code> æ–¹æ³•æ—¶ï¼Œå¦‚æœå¯¹åº”çš„ value ä¸å­˜åœ¨ï¼Œé‚£å°±æ˜¯æ’å…¥è¿‡ç¨‹ï¼Œå¦‚æœè¿™ä¸ª value å·²ç»å­˜åœ¨ï¼Œåªæ˜¯è°ƒæ•´ä¸€ä¸‹ score çš„å€¼ï¼Œé‚£å°±éœ€è¦èµ°ä¸€ä¸ªæ›´æ–°æµç¨‹ã€‚</p><p>å‡è®¾è¿™ä¸ªæ–°çš„ score å€¼å¹¶ä¸ä¼šå¸¦æ¥æ’åºä¸Šçš„å˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è°ƒæ•´ä½ç½®ï¼Œç›´æ¥ä¿®æ”¹å…ƒç´ çš„ score å€¼å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæ’åºä½ç½®æ”¹å˜äº†ï¼Œé‚£å°±éœ€è¦è°ƒæ•´ä½ç½®ï¼Œè¯¥å¦‚ä½•è°ƒæ•´å‘¢ï¼Ÿ</p><p>ä»æºç  <code>t_zset.c/zsetAdd</code> å‡½æ•° <code>1350</code> è¡Œå·¦å³å¯ä»¥çœ‹åˆ°ï¼ŒRedis é‡‡ç”¨äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç­–ç•¥ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Remove and re-insert when score changed. */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">!=</span> curscore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    zobj<span class="token operator">-&gt;</span>ptr <span class="token operator">=</span> <span class="token function">zzlDelete</span><span class="token punctuation">(</span>zobj<span class="token operator">-&gt;</span>ptr<span class="token punctuation">,</span>eptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    zobj<span class="token operator">-&gt;</span>ptr <span class="token operator">=</span> <span class="token function">zzlInsert</span><span class="token punctuation">(</span>zobj<span class="token operator">-&gt;</span>ptr<span class="token punctuation">,</span>ele<span class="token punctuation">,</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>flags <span class="token operator">|=</span> ZADD_UPDATED<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŠŠè¿™ä¸ªå…ƒç´ åˆ é™¤å†æ’å…¥è¿™ä¸ª</strong>ï¼Œéœ€è¦ç»è¿‡ä¸¤æ¬¡è·¯å¾„æœç´¢ï¼Œä»è¿™ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼ŒRedis çš„ <code>ZADD</code> ä»£ç ä¼¼ä¹è¿˜æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ã€‚</p><h5 id="å…ƒç´ æ’åçš„å®ç°" tabindex="-1"><a class="header-anchor" href="#å…ƒç´ æ’åçš„å®ç°" aria-hidden="true">#</a> å…ƒç´ æ’åçš„å®ç°</h5><p>è·³è·ƒè¡¨æœ¬èº«æ˜¯æœ‰åºçš„ï¼ŒRedis åœ¨ skiplist çš„ forward æŒ‡é’ˆä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œç»™æ¯ä¸€ä¸ª forward æŒ‡é’ˆéƒ½å¢åŠ äº† <code>span</code> å±æ€§ï¼Œç”¨æ¥ <strong>è¡¨ç¤ºä»å‰ä¸€ä¸ªèŠ‚ç‚¹æ²¿ç€å½“å‰å±‚çš„ forward æŒ‡é’ˆè·³åˆ°å½“å‰è¿™ä¸ªèŠ‚ç‚¹ä¸­é—´ä¼šè·³è¿‡å¤šå°‘ä¸ªèŠ‚ç‚¹</strong>ã€‚åœ¨ä¸Šé¢çš„æºç ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ° Redis åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶éƒ½ä¼šå°å¿ƒç¿¼ç¿¼åœ°æ›´æ–° <code>span</code> å€¼çš„å¤§å°ã€‚</p><p>æ‰€ä»¥ï¼Œæ²¿ç€ <strong>&quot;æœç´¢è·¯å¾„&quot;</strong>ï¼ŒæŠŠæ‰€æœ‰ç»è¿‡èŠ‚ç‚¹çš„è·¨åº¦ <code>span</code> å€¼è¿›è¡Œç´¯åŠ å°±å¯ä»¥ç®—å‡ºå½“å‰å…ƒç´ çš„æœ€ç»ˆ rank å€¼äº†ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Find the rank for an element by both score and key.
 * Returns 0 when the element cannot be found, rank otherwise.
 * Note that the rank is 1-based due to the span of zsl-&gt;header to the
 * first element. */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token function">zslGetRank</span><span class="token punctuation">(</span>zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">,</span> <span class="token keyword">double</span> score<span class="token punctuation">,</span> sds ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    zskiplistNode <span class="token operator">*</span>x<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> rank <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    x <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>header<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> zsl<span class="token operator">-&gt;</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">&lt;</span> score <span class="token operator">||</span>
                <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>score <span class="token operator">==</span> score <span class="token operator">&amp;&amp;</span>
                <span class="token function">sdscmp</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token operator">-&gt;</span>ele<span class="token punctuation">,</span>ele<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// span ç´¯åŠ </span>
            rank <span class="token operator">+=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>span<span class="token punctuation">;</span>
            x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>forward<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/* x might be equal to zsl-&gt;header, so test if obj is non-NULL */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>ele <span class="token operator">&amp;&amp;</span> <span class="token function">sdscmp</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>ele<span class="token punctuation">,</span>ele<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> rank<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="â­æ€ä¹ˆä¿è¯-redis-æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤-æŒä¹…åŒ–ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#â­æ€ä¹ˆä¿è¯-redis-æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤-æŒä¹…åŒ–ç­–ç•¥" aria-hidden="true">#</a> â­æ€ä¹ˆä¿è¯ Redis æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤ï¼Ÿï¼ˆæŒä¹…åŒ–ç­–ç•¥ï¼‰</h3><blockquote><p>æ¦‚è¿°ï¼š</p><p>RDBæŒä¹…åŒ–æ˜¯æŠŠå½“å‰è¿›ç¨‹æ•°æ®ç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„è¿‡ç¨‹; é’ˆå¯¹RDBä¸é€‚åˆå®æ—¶æŒä¹…åŒ–çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFæŒä¹…åŒ–æ–¹å¼æ¥è§£å†³.</p><p>AOFæ˜¯â€œå†™åâ€æ—¥å¿—ï¼ŒRediså…ˆæ‰§è¡Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—ã€‚æ—¥å¿—é‡Œè®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜ã€‚</p><p>Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ª<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œ</p></blockquote><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æ•°æ®ä¹Ÿå°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜é‡Œé¢ï¼Œå¤§éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†ä¹‹åé‡ç”¨æ•°æ®ï¼ˆæ¯”å¦‚é‡å¯æœºå™¨ã€æœºå™¨æ•…éšœä¹‹åæ¢å¤æ•°æ®ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸ºäº†é˜²æ­¢ç³»ç»Ÿæ•…éšœè€Œå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚</p><p>Redis ä¸åŒäº Memcached çš„å¾ˆé‡è¦ä¸€ç‚¹å°±æ˜¯ï¼ŒRedis æ”¯æŒæŒä¹…åŒ–ï¼Œè€Œä¸”æ”¯æŒä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ“ä½œã€‚<strong>Redis çš„ä¸€ç§æŒä¹…åŒ–æ–¹å¼å«å¿«ç…§ï¼ˆsnapshottingï¼ŒRDBï¼‰ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯åªè¿½åŠ æ–‡ä»¶ï¼ˆappend-only file, AOFï¼‰</strong>ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯-rdb-æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-rdb-æŒä¹…åŒ–" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ RDB æŒä¹…åŒ–ï¼Ÿ</h4><p>Redis å¯ä»¥é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚Redis åˆ›å»ºå¿«ç…§ä¹‹åï¼Œå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼ˆRedis ä¸»ä»ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜ Redis æ€§èƒ½ï¼‰ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚</p><p>å¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨ <code>redis.conf</code> é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>save <span class="token number">900</span> <span class="token number">1</span>           <span class="token comment">#åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span>

save <span class="token number">300</span> <span class="token number">10</span>          <span class="token comment">#åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span>

save <span class="token number">60</span> <span class="token number">10000</span>        <span class="token comment">#åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»€ä¹ˆæ˜¯-aof-æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-aof-æŒä¹…åŒ–" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ AOF æŒä¹…åŒ–ï¼Ÿ</h4><p>ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOFï¼ˆappend only fileï¼‰æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>appendonly yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥åˆ°å†…å­˜ç¼“å­˜ <code>server.aof_buf</code> ä¸­ï¼Œç„¶åå†æ ¹æ® <code>appendfsync</code> é…ç½®æ¥å†³å®šä½•æ—¶å°†å…¶åŒæ­¥åˆ°ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚</p><p>AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ <code>appendonly.aof</code>ã€‚</p><p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>appendfsync always    #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦
appendfsync everysec  #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾å¼åœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜
appendfsync no        #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†å…¼é¡¾æ•°æ®å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ <code>appendfsync everysec</code> é€‰é¡¹ ï¼Œè®© Redis æ¯ç§’åŒæ­¥ä¸€æ¬¡ AOF æ–‡ä»¶ï¼ŒRedis æ€§èƒ½å‡ ä¹æ²¡å—åˆ°ä»»ä½•å½±å“ã€‚è€Œä¸”è¿™æ ·å³ä½¿å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç¡¬ç›˜å¿™äºæ‰§è¡Œå†™å…¥æ“ä½œçš„æ—¶å€™ï¼ŒRedis è¿˜ä¼šä¼˜é›…çš„æ”¾æ…¢è‡ªå·±çš„é€Ÿåº¦ä»¥ä¾¿é€‚åº”ç¡¬ç›˜çš„æœ€å¤§å†™å…¥é€Ÿåº¦ã€‚</p><h4 id="aof-é‡å†™äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#aof-é‡å†™äº†è§£å—" aria-hidden="true">#</a> AOF é‡å†™äº†è§£å—ï¼Ÿ</h4><p>AOF é‡å†™å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ï¼Œè¿™ä¸ªæ–°çš„ AOF æ–‡ä»¶å’ŒåŸæœ‰çš„ AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€æ ·ï¼Œä½†ä½“ç§¯æ›´å°ã€‚</p><p>AOF é‡å†™æ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œè¯¥åŠŸèƒ½æ˜¯é€šè¿‡è¯»å–æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹æ¥å®ç°çš„ï¼Œç¨‹åºæ— é¡»å¯¹ç°æœ‰ AOF æ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å…¥ã€åˆ†ææˆ–è€…å†™å…¥æ“ä½œã€‚</p><p>åœ¨æ‰§è¡Œ <code>BGREWRITEAOF</code> å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹åˆ›å»ºæ–° AOF æ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–° AOF æ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°çš„ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸ç°æœ‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„ AOF æ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®Œæˆ AOF æ–‡ä»¶é‡å†™æ“ä½œã€‚</p><blockquote><p>æ‹“å±•</p></blockquote><p>Redis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–ï¼ˆé»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>aof-use-rdb-preamble</code> å¼€å¯ï¼‰ã€‚</p><p>å¦‚æœæŠŠæ··åˆæŒä¹…åŒ–æ‰“å¼€ï¼ŒAOF é‡å†™çš„æ—¶å€™å°±ç›´æ¥æŠŠ RDB çš„å†…å®¹å†™åˆ° AOF æ–‡ä»¶å¼€å¤´ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, å¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ã€‚å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼Œ AOF é‡Œé¢çš„ RDB éƒ¨åˆ†æ˜¯å‹ç¼©æ ¼å¼ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¼šæœ‰æ··åˆæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¼šæœ‰æ··åˆæŒä¹…åŒ–" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆä¼šæœ‰æ··åˆæŒä¹…åŒ–ï¼Ÿ</h4><p>RDB ä¼˜ç‚¹æ˜¯æ•°æ®æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ã€‚é¢‘ç‡å¤ªä½ï¼Œä¸¢å¤±çš„æ•°æ®å°±ä¼šæ¯”è¾ƒå¤šï¼Œé¢‘ç‡å¤ªé«˜ï¼Œå°±ä¼šå½±å“æ€§èƒ½ã€‚</p><p>AOF ä¼˜ç‚¹æ˜¯ä¸¢å¤±æ•°æ®å°‘ï¼Œä½†æ˜¯æ•°æ®æ¢å¤ä¸å¿«ã€‚</p><p>ä¸ºäº†é›†æˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œ Redis 4.0 æå‡ºäº†<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>ï¼Œä¹Ÿå«æ··åˆæŒä¹…åŒ–ï¼Œæ—¢ä¿è¯äº† Redis é‡å¯é€Ÿåº¦ï¼Œåˆé™ä½æ•°æ®ä¸¢å¤±é£é™©ã€‚</p><p>æ··åˆæŒä¹…åŒ–å·¥ä½œåœ¨ <strong>AOF æ—¥å¿—é‡å†™è¿‡ç¨‹</strong>ï¼Œå½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œfork å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œç„¶åä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„<strong>å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®</strong>ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715160726101-a6ecc0fe.png" alt="image-20220715160726101" tabindex="0" loading="lazy"><figcaption>image-20220715160726101</figcaption></figure><p>è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œé‡å¯ Redis åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯ RDB å†…å®¹ï¼Œè¿™æ ·<strong>åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«</strong>ã€‚</p><p>åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—<strong>æ•°æ®æ›´å°‘çš„ä¸¢å¤±</strong>ã€‚</p><p><strong>æ··åˆæŒä¹…åŒ–ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ··åˆæŒä¹…åŒ–ç»“åˆäº† RDB å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹ï¼Œå¼€å¤´ä¸º RDB çš„æ ¼å¼ï¼Œä½¿å¾— Redis å¯ä»¥æ›´å¿«çš„å¯åŠ¨ï¼ŒåŒæ—¶ç»“åˆ AOF çš„ä¼˜ç‚¹ï¼Œæœ‰å‡ä½äº†å¤§é‡æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</li></ul><p><strong>æ··åˆæŒä¹…åŒ–ç¼ºç‚¹ï¼š</strong></p><ul><li>AOF æ–‡ä»¶ä¸­æ·»åŠ äº† RDB æ ¼å¼çš„å†…å®¹ï¼Œä½¿å¾— AOF æ–‡ä»¶çš„å¯è¯»æ€§å˜å¾—å¾ˆå·®ï¼›</li><li>å…¼å®¹æ€§å·®ï¼Œå¦‚æœå¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ­¤æ··åˆæŒä¹…åŒ– AOF æ–‡ä»¶ï¼Œå°±ä¸èƒ½ç”¨åœ¨ Redis 4.0 ä¹‹å‰ç‰ˆæœ¬äº†ã€‚</li></ul><h3 id="ç¼“å­˜ç©¿é€-ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€-ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿" aria-hidden="true">#</a> ç¼“å­˜ç©¿é€ &amp; ç¼“å­˜é›ªå´© &amp; ç¼“å­˜å‡»ç©¿</h3><h4 id="ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç©¿é€" aria-hidden="true">#</a> ç©¿é€</h4><p>å½“å‘ç”Ÿç¼“å­˜é›ªå´©æˆ–å‡»ç©¿æ—¶ï¼Œæ•°æ®åº“ä¸­è¿˜æ˜¯ä¿å­˜äº†åº”ç”¨è¦è®¿é—®çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜æ¢å¤ç›¸å¯¹åº”çš„æ•°æ®ï¼Œå°±å¯ä»¥å‡è½»æ•°æ®åº“çš„å‹åŠ›ï¼Œè€Œç¼“å­˜ç©¿é€å°±ä¸ä¸€æ ·äº†ã€‚</p><p>å½“ç”¨æˆ·è®¿é—®çš„æ•°æ®ï¼Œ<strong>æ—¢ä¸åœ¨ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­</strong>ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œå†å»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘ç°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ï¼Œæ²¡åŠæ³•æ„å»ºç¼“å­˜æ•°æ®ï¼Œæ¥æœåŠ¡åç»­çš„è¯·æ±‚ã€‚é‚£ä¹ˆå½“æœ‰å¤§é‡è¿™æ ·çš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜ç©¿é€</strong>çš„é—®é¢˜ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714212317883-d21ad202.png" alt="image-20220714212317883" tabindex="0" loading="lazy"><figcaption>image-20220714212317883</figcaption></figure><p>ç¼“å­˜ç©¿é€çš„å‘ç”Ÿä¸€èˆ¬æœ‰è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li>ä¸šåŠ¡è¯¯æ“ä½œï¼Œç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½è¢«è¯¯åˆ é™¤äº†ï¼Œæ‰€ä»¥å¯¼è‡´ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰æ•°æ®ï¼›</li><li>é»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ•…æ„å¤§é‡è®¿é—®æŸäº›è¯»å–ä¸å­˜åœ¨æ•°æ®çš„ä¸šåŠ¡ï¼›</li></ul><p>åº”å¯¹ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚</p><ul><li><strong>éæ³•è¯·æ±‚çš„é™åˆ¶</strong>ï¼šå½“æœ‰å¤§é‡æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œå› æ­¤åœ¨ API å…¥å£å¤„æˆ‘ä»¬è¦åˆ¤æ–­æ±‚è¯·æ±‚å‚æ•°æ˜¯å¦åˆç†ï¼Œè¯·æ±‚å‚æ•°æ˜¯å¦å«æœ‰éæ³•å€¼ã€è¯·æ±‚å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœåˆ¤æ–­å‡ºæ˜¯æ¶æ„è¯·æ±‚å°±ç›´æ¥è¿”å›é”™è¯¯ï¼Œé¿å…è¿›ä¸€æ­¥è®¿é—®ç¼“å­˜å’Œæ•°æ®åº“ã€‚</li><li><strong>è®¾ç½®ç©ºå€¼æˆ–è€…é»˜è®¤å€¼</strong>ï¼šå½“æˆ‘ä»¬çº¿ä¸Šä¸šåŠ¡å‘ç°ç¼“å­˜ç©¿é€çš„ç°è±¡æ—¶ï¼Œå¯ä»¥é’ˆå¯¹æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿™æ ·åç»­è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–åˆ°ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œè¿”å›ç»™åº”ç”¨ï¼Œè€Œä¸ä¼šç»§ç»­æŸ¥è¯¢æ•°æ®åº“ã€‚</li><li><strong>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨</strong>ï¼šæˆ‘ä»¬å¯ä»¥åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸ªæ ‡è®°ï¼Œç„¶ååœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¸šåŠ¡çº¿ç¨‹ç¡®è®¤ç¼“å­˜å¤±æ•ˆåï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸ç”¨é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå³ä½¿å‘ç”Ÿäº†ç¼“å­˜ç©¿é€ï¼Œå¤§é‡è¯·æ±‚åªä¼šæŸ¥è¯¢ Redis å’Œå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œä¿è¯äº†æ•°æ®åº“èƒ½æ­£å¸¸è¿è¡Œï¼ŒRedis è‡ªèº«ä¹Ÿæ˜¯æ”¯æŒå¸ƒéš†è¿‡æ»¤å™¨çš„ã€‚</li></ul><blockquote><p>è¯¦ç»†è¯´æ˜</p></blockquote><p><strong>1ï¼‰ç¼“å­˜æ— æ•ˆ key</strong></p><p>å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š <code>SET key value EX 10086</code> ã€‚è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿã€‚</p><p><strong>2ï¼‰å¸ƒéš†è¿‡æ»¤å™¨</strong></p><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªéå¸¸ç¥å¥‡çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ¤æ–­ä¸€ä¸ªç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨äºæµ·é‡æ•°æ®ä¸­ã€‚æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯åˆ¤æ–­ key æ˜¯å¦åˆæ³•ï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„é‚£ä¸ªâ€œäººâ€ã€‚</p><p>å…·ä½“æ˜¯è¿™æ ·åšçš„ï¼šæŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½å­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šèµ°ä¸‹é¢çš„æµç¨‹ã€‚</p><p>åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¹‹åçš„ç¼“å­˜å¤„ç†æµç¨‹å›¾å¦‚ä¸‹ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220616204045863-cad14f7b.png" alt="image-20220616204045863" tabindex="0" loading="lazy"><figcaption>image-20220616204045863</figcaption></figure><p>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š <strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚</strong></p><p><em>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¯¯åˆ¤çš„æƒ…å†µå‘¢? æˆ‘ä»¬è¿˜è¦ä»å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ¥è¯´ï¼</em></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š</strong></p><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š</strong></p><ol><li>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼›</li><li>å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</li></ol><p>ç„¶åï¼Œä¸€å®šä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼š<strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒã€‚</strong> ï¼ˆå¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°æ¥é™ä½æ¦‚ç‡ï¼‰</p><p>æ›´å¤šå…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å®¹å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åŸåˆ›ï¼š<a href="https://javaguide.cn/cs-basics/data-structure/bloom-filter/" target="_blank" rel="noopener noreferrer">ã€Šä¸äº†è§£å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿä¸€æ–‡ç»™ä½ æ•´çš„æ˜æ˜ç™½ç™½ï¼ã€‹open in new window<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ï¼Œå¼ºçƒˆæ¨èï¼Œä¸ªäººæ„Ÿè§‰ç½‘ä¸Šåº”è¯¥æ‰¾ä¸åˆ°æ€»ç»“çš„è¿™ä¹ˆæ˜æ˜ç™½ç™½çš„æ–‡ç« äº†</p><h4 id="ã€æ‹“å±•1ã€‘å¸ƒéš†è¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#ã€æ‹“å±•1ã€‘å¸ƒéš†è¿‡æ»¤å™¨" aria-hidden="true">#</a> ã€æ‹“å±•1ã€‘å¸ƒéš†è¿‡æ»¤å™¨</h4><p>ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å¸ƒéš†è¿‡æ»¤å™¨çš„æ¦‚å¿µã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ä¸€ä¸ªå«åš Bloom çš„è€å“¥äº 1970 å¹´æå‡ºçš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œç”±äºŒè¿›åˆ¶å‘é‡ï¼ˆæˆ–è€…è¯´ä½æ•°ç»„ï¼‰å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ä¸¤éƒ¨åˆ†ç»„æˆçš„æ•°æ®ç»“æ„ã€‚ç›¸æ¯”äºæˆ‘ä»¬å¹³æ—¶å¸¸ç”¨çš„çš„ Listã€Map ã€Set ç­‰æ•°æ®ç»“æ„ï¼Œå®ƒå ç”¨ç©ºé—´æ›´å°‘å¹¶ä¸”æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å…¶è¿”å›çš„ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œè€Œä¸æ˜¯éå¸¸å‡†ç¡®çš„ã€‚ç†è®ºæƒ…å†µä¸‹æ·»åŠ åˆ°é›†åˆä¸­çš„å…ƒç´ è¶Šå¤šï¼Œè¯¯æŠ¥çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚å¹¶ä¸”ï¼Œå­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®ä¸å®¹æ˜“åˆ é™¤ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/å¸ƒéš†è¿‡æ»¤å™¨-bitæ•°ç»„-df76f334.png" alt="å¸ƒéš†è¿‡æ»¤å™¨ç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>å¸ƒéš†è¿‡æ»¤å™¨ç¤ºæ„å›¾</figcaption></figure><p>ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åªå ç”¨ 1 bit ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1ã€‚è¿™æ ·ç”³è¯·ä¸€ä¸ª 100w ä¸ªå…ƒç´ çš„ä½æ•°ç»„åªå ç”¨ 1000000Bit / 8 = 125000 Byte = 125000/1024 kb â‰ˆ 122kb çš„ç©ºé—´ã€‚</p><p>æ€»ç»“ï¼š<strong>ä¸€ä¸ªåå« Bloom çš„äººæå‡ºäº†ä¸€ç§æ¥æ£€ç´¢å…ƒç´ æ˜¯å¦åœ¨ç»™å®šå¤§é›†åˆä¸­çš„æ•°æ®ç»“æ„ï¼Œè¿™ç§æ•°æ®ç»“æ„æ˜¯é«˜æ•ˆä¸”æ€§èƒ½å¾ˆå¥½çš„ï¼Œä½†ç¼ºç‚¹æ˜¯å…·æœ‰ä¸€å®šçš„é”™è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤éš¾åº¦ã€‚å¹¶ä¸”ï¼Œç†è®ºæƒ…å†µä¸‹ï¼Œæ·»åŠ åˆ°é›†åˆä¸­çš„å…ƒç´ è¶Šå¤šï¼Œè¯¯æŠ¥çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚</strong></p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†</p><p><strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</strong></p><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><p><strong>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</strong></p><ol><li>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼›</li><li>å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</li></ol><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/å¸ƒéš†è¿‡æ»¤å™¨-hashè¿ç®—-d05696fd.png" alt="å¸ƒéš†è¿‡æ»¤å™¨hashè®¡ç®—" tabindex="0" loading="lazy"><figcaption>å¸ƒéš†è¿‡æ»¤å™¨hashè®¡ç®—</figcaption></figure><p>å¦‚å›¾æ‰€ç¤ºï¼Œå½“å­—ç¬¦ä¸²å­˜å‚¨è¦åŠ å…¥åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²é¦–å…ˆç”±å¤šä¸ªå“ˆå¸Œå‡½æ•°ç”Ÿæˆä¸åŒçš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å¯¹åº”çš„ä½æ•°ç»„çš„ä¸‹æ ‡è®¾ç½®ä¸º 1ï¼ˆå½“ä½æ•°ç»„åˆå§‹åŒ–æ—¶ï¼Œæ‰€æœ‰ä½ç½®å‡ä¸º 0ï¼‰ã€‚å½“ç¬¬äºŒæ¬¡å­˜å‚¨ç›¸åŒå­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå…ˆå‰çš„å¯¹åº”ä½ç½®å·²è®¾ç½®ä¸º 1ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“çŸ¥é“æ­¤å€¼å·²ç»å­˜åœ¨ï¼ˆå»é‡éå¸¸æ–¹ä¾¿ï¼‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦åˆ¤æ–­æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œåªéœ€è¦å¯¹ç»™å®šå­—ç¬¦ä¸²å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</p><p><strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ã€‚</strong></p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨</strong></p><h4 id="ã€æ‹“å±•2ã€‘å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨-cuckoo-filter" tabindex="-1"><a class="header-anchor" href="#ã€æ‹“å±•2ã€‘å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨-cuckoo-filter" aria-hidden="true">#</a> ã€æ‹“å±•2ã€‘å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼ˆCuckoo Filterï¼‰</h4><h5 id="å¸ƒè°·é¸Ÿå“ˆå¸Œ" tabindex="-1"><a class="header-anchor" href="#å¸ƒè°·é¸Ÿå“ˆå¸Œ" aria-hidden="true">#</a> å¸ƒè°·é¸Ÿå“ˆå¸Œ</h5><p>å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ç”¨æ›´ä½çš„ç©ºé—´å¼€é”€è§£å†³äº†å¸ƒéš†è¿‡æ»¤å™¨ä¸èƒ½åˆ é™¤å…ƒç´ çš„é—®é¢˜ï¼Œåšåˆ°äº†æ›´å¥½çš„æ•ˆæœï¼Œå…·ä½“çš„</p><ul><li>æ”¯æŒåŠ¨æ€çš„æ·»åŠ å’Œåˆ é™¤å…ƒç´ </li><li>æä¾›äº†æ¯”ä¼ ç»Ÿå¸ƒéš†è¿‡æ»¤å™¨æ›´é«˜çš„æŸ¥æ‰¾æ€§èƒ½ï¼Œå³ä½¿åœ¨æ¥è¿‘æ»¡çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ç©ºé—´åˆ©ç”¨ç‡è¾¾åˆ° 95% çš„æ—¶å€™ï¼‰</li><li>æ¯”èµ·å•†è¿‡æ»¤å™¨å®ƒæ›´å®¹æ˜“å®ç°</li><li>å¦‚æœè¦æ±‚è¯¯åˆ¤ç‡ä½äº3%ï¼Œå®ƒæ¯”å¸ƒéš†è¿‡æ»¤å™¨æœ‰æ›´ä½çš„ç©ºé—´å¼€é”€</li></ul><p>æœ¬è´¨ä¸Šæ¥è¯´å®ƒä¸ºè§£å†³å“ˆå¸Œå†²çªæä¾›äº†å¦ä¸€ç§ç­–ç•¥ï¼Œåˆ©ç”¨è¾ƒå°‘è®¡ç®—æ¢å–äº†è¾ƒå¤§ç©ºé—´ã€‚å®ƒå…·æœ‰å ç”¨ç©ºé—´å°ã€æŸ¥è¯¢è¿…é€Ÿç­‰ç‰¹æ€§ã€‚åç§°æºäºé‡‡å–äº†ä¸€ç§å’Œå¸ƒè°·é¸Ÿä¸€æ ·çš„å…»å¨ƒæ–¹æ³•</p><blockquote><p>å¸ƒè°·é¸Ÿäº¤é…åï¼Œé›Œæ€§<strong>å¸ƒè°·é¸Ÿ</strong>å°±å‡†å¤‡äº§è›‹äº†ï¼Œä½†å®ƒå´ä¸ä¼šè‡ªå·±ç­‘å·¢ã€‚å®ƒä¼šæ¥åˆ°åƒçŸ¥æ›´<strong>é¸Ÿ</strong>ã€åˆºå˜´èºç­‰é‚£äº›æ¯”å®ƒå°çš„<strong>é¸Ÿ</strong>ç±»çš„å·¢ä¸­ï¼Œç§»èµ°åŸæ¥çš„é‚£çªè›‹ä¸­çš„ä¸€ä¸ªï¼Œç”¨è‡ªå·±çš„è›‹æ¥å–è€Œä»£ä¹‹ã€‚ç›¸å¯¹äºå®ƒçš„ä½“å½¢æ¥è¯´ï¼Œå®ƒçš„è›‹æ˜¯åå°çš„ï¼Œè€Œä¸”è›‹ä¸Šçš„æ–‘çº¹åŒå®ƒæ··å…¥çš„å…¶ä»–<strong>é¸Ÿ</strong>çš„è›‹ä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥ä¸æ˜“è¢«åˆ†è¾¨å‡ºæ¥ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œå®ƒçš„è›‹è‚¯å®šä¼šè¢«æ‰”å‡ºå»ã€‚</p></blockquote><p>æœ€åŸå§‹çš„å¸ƒè°·é¸Ÿå“ˆå¸Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œå‡½æ•°å¯¹ä¸€ä¸ª <code>key</code>è¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°æ¡¶ä¸­çš„ä¸¤ä¸ªä½ç½®ï¼Œæ­¤æ—¶</p><ul><li>å¦‚æœä¸¤ä¸ªä½ç½®éƒ½ä¸ºä¸ºç©ºåˆ™å°† <code>key</code>éšæœºå­˜å…¥å…¶ä¸­ä¸€ä¸ªä½ç½®</li><li>å¦‚æœåªæœ‰ä¸€ä¸ªä½ç½®ä¸ºç©ºåˆ™å­˜å…¥ä¸ºç©ºçš„ä½ç½®</li><li>å¦‚æœéƒ½ä¸ä¸ºç©ºï¼Œåˆ™éšæœºè¸¢å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¸¢å‡ºçš„å…ƒç´ å†é‡æ–°è®¡ç®—å“ˆå¸Œæ‰¾åˆ°ç›¸åº”çš„ä½ç½®</li></ul><p>å½“ç„¶å‡å¦‚å­˜åœ¨ç»å¯¹çš„ç©ºé—´ä¸è¶³ï¼Œé‚£è€æ˜¯è¸¢å‡ºä¹Ÿä¸æ˜¯åŠæ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šè®¾ç½®ä¸€ä¸ª<strong>è¸¢å‡ºé˜ˆå€¼</strong>ï¼Œå¦‚æœåœ¨æŸæ¬¡æ’å…¥è¡Œä¸ºè¿‡ç¨‹ä¸­è¿ç»­è¸¢å‡ºè¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/1617168-20210727195627534-1821849951-2913061a.png" alt="image-20210727104910960" tabindex="0" loading="lazy"><figcaption>image-20210727104910960</figcaption></figure><h5 id="å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨" tabindex="-1"><a class="header-anchor" href="#å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨" aria-hidden="true">#</a> å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨</h5><figure><img src="/Computer-Science-Learn-Notes/assets/1617168-20210727195625561-1153589445-fa307635.jpg" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><p>ä¸Šå›¾ï¼ˆaï¼‰(b)å±•ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„å¸ƒè°·é¸Ÿå“ˆå¸Œè¡¨çš„æ’å…¥æ“ä½œï¼Œæ˜¯ç”±ä¸€ä¸ªæ¡¶æ•°ç»„ç»„æˆï¼Œæ¯ä¸ªæ’å…¥é¡¹éƒ½æœ‰ç”±æ•£åˆ—å‡½æ•°h1(x)å’Œh2(x)ç¡®å®šçš„ä¸¤ä¸ªå€™é€‰æ¡¶ï¼Œå…·ä½“æ“ä½œä¸Šæ–‡ä¸­å·²ç»æè¿°ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p><p>è€ŒåŸºæœ¬çš„å¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ä¹Ÿæ˜¯ç”±ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå“ˆå¸Œå‡½æ•°æ„æˆï¼Œå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨çš„å¸ƒè°·é¸Ÿå“ˆå¸Œè¡¨çš„åŸºæœ¬å•ä½ç§°ä¸º<strong>æ¡ç›®ï¼ˆentryï¼‰</strong>ã€‚ æ¯ä¸ªæ¡ç›®å­˜å‚¨ä¸€ä¸ª<strong>æŒ‡çº¹ï¼ˆfingerprintï¼‰</strong>ï¼ŒæŒ‡çº¹æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ç”Ÿæˆçš„nä½æ¯”ç‰¹ä½ï¼Œnçš„å…·ä½“å¤§å°ç”±æ‰€èƒ½æ¥å—çš„è¯¯åˆ¤ç‡æ¥è®¾ç½®ï¼Œè®ºæ–‡ä¸­çš„ä¾‹å­ä½¿ç”¨çš„æ˜¯8bitsçš„æŒ‡çº¹å¤§å°ã€‚</p><p>å“ˆå¸Œè¡¨ç”±ä¸€ä¸ªæ¡¶æ•°ç»„ç»„æˆï¼Œå…¶ä¸­ä¸€ä¸ªæ¡¶å¯ä»¥æœ‰å¤šä¸ªæ¡ç›®ï¼ˆæ¯”å¦‚ä¸Šè¿°å›¾cä¸­æœ‰å››ä¸ªæ¡ç›®ï¼‰ã€‚è€Œæ¯ä¸ªæ¡¶ä¸­æœ‰å››ä¸ªæŒ‡çº¹ä½ç½®ï¼Œæ„å‘³ç€ä¸€æ¬¡å“ˆå¸Œè®¡ç®—åå¸ƒè°·é¸Ÿæœ‰å››ä¸ªâ€œå·¢â€œå¯ç”¨ï¼Œè€Œä¸”å››ä¸ªå·¢æ˜¯è¿ç»­ä½ç½®ï¼Œå¯ä»¥æ›´å¥½çš„åˆ©ç”¨cpué«˜é€Ÿç¼“å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæ¡¶çš„å¤§å°æ˜¯4*8bits</p><h4 id="é›ªå´©" tabindex="-1"><a class="header-anchor" href="#é›ªå´©" aria-hidden="true">#</a> é›ªå´©</h4><p>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œç¼“å­˜é›ªå´©æè¿°çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼š<strong>ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚ã€‚</strong> è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†</p><blockquote><p>å¦ä¸€ç§è¯´æ³•æ˜¯ï¼š</p><p>å½“<strong>å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼ˆå¤±æ•ˆï¼‰**æ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œéƒ½æ— æ³•åœ¨ Redis ä¸­å¤„ç†ï¼Œäºæ˜¯å…¨éƒ¨è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›éª¤å¢ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—è¿é”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œè¿™å°±æ˜¯ç¼“å­˜é›ªå´©</strong>çš„é—®é¢˜ã€‚</p></blockquote><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220616203658271-980eda18.png" alt="image-20220616203658271" tabindex="0" loading="lazy"><figcaption>image-20220616203658271</figcaption></figure><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç¼“å­˜ç”¨äºç¼“å†²å¯¹ DB çš„å†²å‡»ï¼Œå¦‚æœç¼“å­˜å®•æœºï¼Œæ‰€æœ‰è¯·æ±‚å°†ç›´æ¥æ‰“åœ¨ DBï¼Œé€ æˆ DB å®•æœºâ€”â€”ä»è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå®•æœºã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220616203727609-7f38bc8b.png" alt="image-20220616203727609" tabindex="0" loading="lazy"><figcaption>image-20220616203727609</figcaption></figure><p><strong>2 ç§ç­–ç•¥ï¼š</strong></p><ul><li><strong>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´éšæœºæ‰“æ•£ï¼š</strong> æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼ˆæ¯”å¦‚ 1 åˆ° 10 åˆ†é’Ÿï¼‰è¿™æ ·æ¯ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´éƒ½ä¸é‡å¤äº†ï¼Œä¹Ÿå°±é™ä½äº†ç¼“å­˜é›†ä½“å¤±æ•ˆçš„æ¦‚ç‡ã€‚</li><li><strong>è®¾ç½®ç¼“å­˜ä¸è¿‡æœŸï¼š</strong> æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°æœåŠ¡æ¥æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œä»è€Œé¿å…å› ä¸ºç¼“å­˜å¤±æ•ˆé€ æˆçš„ç¼“å­˜é›ªå´©ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…ç¼“å­˜å¹¶å‘é—®é¢˜ã€‚</li></ul><h4 id="å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#å‡»ç©¿" aria-hidden="true">#</a> å‡»ç©¿</h4><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡æŸä¸€ä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼Œæ¯”å¦‚ç§’æ€æ´»åŠ¨ï¼Œè¿™ç±»è¢«é¢‘åœ°è®¿é—®çš„æ•°æ®è¢«ç§°ä¸ºçƒ­ç‚¹æ•°æ®ï¼‰ã€‚è¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ˆ<strong>æŸä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸ</strong>äº†ï¼Œæ­¤æ—¶å¤§é‡çš„è¯·æ±‚è®¿é—®äº†è¯¥çƒ­ç‚¹æ•°æ®ï¼Œå°±æ— æ³•ä»ç¼“å­˜ä¸­è¯»å–ï¼‰ï¼Œå°±å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œè¢«é«˜å¹¶å‘çš„è¯·æ±‚å†²å®ï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜å‡»ç©¿</strong>çš„é—®é¢˜ã€‚</p><p>è§£å†³ï¼š</p><ol><li><strong>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸ</strong>ã€‚</li><li><strong>æ¥å£é™æµä¸ç†”æ–­</strong>ï¼Œé™çº§ã€‚é‡è¦çš„æ¥å£ä¸€å®šè¦åšå¥½é™æµç­–ç•¥ï¼Œé˜²æ­¢ç”¨æˆ·æ¶æ„åˆ·æ¥å£ï¼ŒåŒæ—¶è¦é™çº§å‡†å¤‡ï¼Œå½“æ¥å£ä¸­çš„æŸäº›æœåŠ¡ä¸å¯ç”¨æ—¶å€™ï¼Œè¿›è¡Œç†”æ–­ï¼Œå¤±è´¥å¿«é€Ÿè¿”å›æœºåˆ¶ã€‚</li><li><strong>è®¾ç½®äº’æ–¥é”</strong>ã€‚åœ¨å¹¶å‘çš„å¤šä¸ªè¯·æ±‚ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹èƒ½æ‹¿åˆ°é”å¹¶æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼Œå…¶ä»–çš„çº¿ç¨‹æ‹¿ä¸åˆ°é”å°±é˜»å¡ç­‰ç€ï¼Œç­‰åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®å†™å…¥ç¼“å­˜åï¼Œç›´æ¥èµ°ç¼“å­˜ã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”ï¼‰</li></ol><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714212532910-5df0aad2.png" alt="image-20220714212532910" tabindex="0" loading="lazy"><figcaption>image-20220714212532910</figcaption></figure><h3 id="ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„" aria-hidden="true">#</a> ä¸»ä»å¤åˆ¶æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</h3><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220149168-eeac0c71.png" alt="image-20220714220149168" tabindex="0" loading="lazy"><figcaption>image-20220714220149168</figcaption></figure><p>å¤šå°æœåŠ¡å™¨è¦ä¿å­˜åŒä¸€ä»½æ•°æ®ï¼Œè¿™é‡Œé—®é¢˜å°±æ¥äº†ã€‚</p><p>è¿™äº›æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®å¦‚ä½•ä¿æŒä¸€è‡´æ€§å‘¢ï¼Ÿæ•°æ®çš„è¯»å†™æ“ä½œæ˜¯å¦æ¯å°æœåŠ¡å™¨éƒ½å¯ä»¥å¤„ç†ï¼Ÿ</p><p>Redis æä¾›äº†<strong>ä¸»ä»å¤åˆ¶æ¨¡å¼</strong>ï¼Œæ¥é¿å…ä¸Šè¿°çš„é—®é¢˜ã€‚</p><p>è¿™ä¸ªæ¨¡å¼å¯ä»¥ä¿è¯å¤šå°æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸”ä¸»ä»æœåŠ¡å™¨ä¹‹é—´é‡‡ç”¨çš„æ˜¯ã€Œè¯»å†™åˆ†ç¦»ã€çš„æ–¹å¼ã€‚</p><p>ä¸»æœåŠ¡å™¨å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å‘ç”Ÿå†™æ“ä½œæ—¶è‡ªåŠ¨å°†å†™æ“ä½œåŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨ä¸€èˆ¬æ˜¯åªè¯»ï¼Œå¹¶æ¥å—ä¸»æœåŠ¡å™¨åŒæ­¥è¿‡æ¥å†™æ“ä½œå‘½ä»¤ï¼Œç„¶åæ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220158025-b07ccab0.png" alt="image-20220714220158025" tabindex="0" loading="lazy"><figcaption>image-20220714220158025</figcaption></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„æ•°æ®ä¿®æ”¹åªåœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œï¼Œç„¶åå°†æœ€æ–°çš„æ•°æ®åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œè¿™æ ·å°±ä½¿å¾—ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><p>åŒæ­¥è¿™ä¸¤ä¸ªå­—è¯´çš„ç®€å•ï¼Œä½†æ˜¯è¿™ä¸ªåŒæ­¥è¿‡ç¨‹å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ï¼Œè¦è€ƒè™‘çš„äº‹æƒ…ä¸æ˜¯ä¸€ä¸¤ä¸ªã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œä¸»ä»æœåŠ¡å™¨é—´çš„ç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p><h4 id="ç¬¬ä¸€æ¬¡åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ¬¡åŒæ­¥" aria-hidden="true">#</a> ç¬¬ä¸€æ¬¡åŒæ­¥</h4><p>å¤šå°æœåŠ¡å™¨ä¹‹é—´è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥ç¡®å®šè°æ˜¯ä¸»æœåŠ¡å™¨ï¼Œæˆ–è€…è°æ˜¯ä»æœåŠ¡å™¨å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>replicaof</code>ï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨çš„å…³ç³»ã€‚</p><p>æ¯”å¦‚ï¼Œç°åœ¨æœ‰æœåŠ¡å™¨ A å’Œ æœåŠ¡å™¨ Bï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ B ä¸Šæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># æœåŠ¡å™¨ B æ‰§è¡Œè¿™æ¡å‘½ä»¤
replicaof &lt;æœåŠ¡å™¨ A çš„ IP åœ°å€&gt; &lt;æœåŠ¡å™¨ A çš„ Redis ç«¯å£å·&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€ï¼ŒæœåŠ¡å™¨ B å°±ä¼šå˜æˆæœåŠ¡å™¨ A çš„ã€Œä»æœåŠ¡å™¨ã€ï¼Œç„¶åä¸ä¸»æœåŠ¡å™¨è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ã€‚</p><p>ä¸»ä»æœåŠ¡å™¨é—´çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µæ˜¯å»ºç«‹é“¾æ¥ã€åå•†åŒæ­¥ï¼›</li><li>ç¬¬äºŒé˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨ï¼›</li><li>ç¬¬ä¸‰é˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨ã€‚</li></ul><p>ä¸ºäº†è®©ä½ æ›´æ¸…æ¥šäº†è§£è¿™ä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220220342-fe9dd856.png" alt="image-20220714220220342" tabindex="0" loading="lazy"><figcaption>image-20220714220220342</figcaption></figure><blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘åœ¨å…·ä½“ä»‹ç»æ¯ä¸€ä¸ªé˜¶æ®µéƒ½åšäº†ä»€ä¹ˆã€‚</p></blockquote><p><em>ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹é“¾æ¥ã€åå•†åŒæ­¥</em></p><p>æ‰§è¡Œäº† replicaof å‘½ä»¤åï¼Œä»æœåŠ¡å™¨å°±ä¼šç»™ä¸»æœåŠ¡å™¨å‘é€ <code>psync</code> å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p><p>psync å‘½ä»¤åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<strong>ä¸»æœåŠ¡å™¨çš„ runID</strong> å’Œ<strong>å¤åˆ¶è¿›åº¦ offset</strong>ã€‚</p><ul><li>runIDï¼Œæ¯ä¸ª Redis æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿäº§ä¸€ä¸ªéšæœºçš„ ID æ¥å”¯ä¸€æ ‡è¯†è‡ªå·±ã€‚å½“ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»æœåŠ¡å™¨çš„ run IDï¼Œæ‰€ä»¥å°†å…¶è®¾ç½®ä¸º &quot;?&quot;ã€‚</li><li>offsetï¼Œè¡¨ç¤ºå¤åˆ¶çš„è¿›åº¦ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œå…¶å€¼ä¸º -1ã€‚</li></ul><p>ä¸»æœåŠ¡å™¨æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ <code>FULLRESYNC</code> ä½œä¸ºå“åº”å‘½ä»¤è¿”å›ç»™å¯¹æ–¹ã€‚</p><p>å¹¶ä¸”è¿™ä¸ªå“åº”å‘½ä»¤ä¼šå¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»æœåŠ¡å™¨çš„ runID å’Œä¸»æœåŠ¡å™¨ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetã€‚ä»æœåŠ¡å™¨æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•è¿™ä¸¤ä¸ªå€¼ã€‚</p><p>FULLRESYNC å“åº”å‘½ä»¤çš„æ„å›¾æ˜¯é‡‡ç”¨<strong>å…¨é‡å¤åˆ¶</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸»æœåŠ¡å™¨ä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½åŒæ­¥ç»™ä»æœåŠ¡å™¨ã€‚</p><p>æ‰€ä»¥ï¼Œç¬¬ä¸€é˜¶æ®µçš„å·¥ä½œæ—¶ä¸ºäº†å…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚</p><p>é‚£å…·ä½“æ€ä¹ˆå…¨é‡åŒæ­¥å‘€å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å¾€ä¸‹çœ‹ç¬¬äºŒé˜¶æ®µã€‚</p><p><em>ç¬¬äºŒé˜¶æ®µï¼šä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨</em></p><p>æ¥ç€ï¼Œä¸»æœåŠ¡å™¨ä¼šæ‰§è¡Œ <code>bgsave</code> å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ã€‚</p><p>ä»æœåŠ¡å™¨æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰çš„æ•°æ®ï¼Œç„¶åè½½å…¥ RDB æ–‡ä»¶ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œå› ä¸º bgsave å‘½ä»¤æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªå­è¿›ç¨‹æ¥åšç”Ÿæˆ RDB æ–‡ä»¶çš„å·¥ä½œï¼Œæ˜¯å¼‚æ­¥å·¥ä½œçš„ï¼Œè¿™æ · Redis ä¾ç„¶å¯ä»¥æ­£å¸¸å¤„ç†å‘½ä»¤ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æœŸé—´çš„å†™æ“ä½œå‘½ä»¤å¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ï¼Œè¿™æ—¶ä¸»ä»æœåŠ¡å™¨é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚é‚£ä¹ˆä¸ºäº†ä¿è¯ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ï¼Œ<strong>ä¸»æœåŠ¡å™¨åœ¨ä¸‹é¢è¿™ä¸‰ä¸ªæ—¶é—´é—´éš™ä¸­å°†æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œå†™å…¥åˆ° replication buffer ç¼“å†²åŒºé‡Œã€‚</strong></p><ul><li>ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB æ–‡ä»¶æœŸé—´ï¼›</li><li>ä¸»æœåŠ¡å™¨å‘é€ RDB æ–‡ä»¶ç»™ä»æœåŠ¡å™¨æœŸé—´ï¼›</li><li>ã€Œä»æœåŠ¡å™¨ã€åŠ è½½ RDB æ–‡ä»¶æœŸé—´ï¼›</li></ul><p><em>ç¬¬ä¸‰é˜¶æ®µï¼šä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨</em></p><p>åœ¨ä¸»æœåŠ¡å™¨ç”Ÿæˆçš„ RDB æ–‡ä»¶å‘é€å®Œï¼Œä»æœåŠ¡å™¨åŠ è½½å®Œ RDB æ–‡ä»¶åï¼Œç„¶åå°† replication buffer ç¼“å†²åŒºé‡Œæ‰€è®°å½•çš„å†™æ“ä½œå‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åã€Œä»æœåŠ¡å™¨ã€é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè‡³æ­¤ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®å°±ä¸€è‡´äº†ã€‚</p><p>è‡³æ­¤ï¼Œä¸»ä»æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„å·¥ä½œå°±å®Œæˆäº†ã€‚</p><h4 id="å‘½ä»¤ä¼ æ’­" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤ä¼ æ’­" aria-hidden="true">#</a> å‘½ä»¤ä¼ æ’­</h4><p>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥åï¼ŒåŒæ–¹ä¹‹é—´å°±ä¼šç»´æŠ¤ä¸€ä¸ª TCP è¿æ¥ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220259046-8c310ce8.png" alt="image-20220714220259046" tabindex="0" loading="lazy"><figcaption>image-20220714220259046</figcaption></figure><p>åç»­ä¸»æœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥ç»§ç»­å°†å†™æ“ä½œå‘½ä»¤ä¼ æ’­ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä½¿å¾—ä¸ä¸»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ç›¸åŒã€‚</p><p>è€Œä¸”è¿™ä¸ªè¿æ¥æ˜¯é•¿è¿æ¥çš„ï¼Œç›®çš„æ˜¯é¿å…é¢‘ç¹çš„ TCP è¿æ¥å’Œæ–­å¼€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º<strong>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</strong>ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥ä¿è¯ç¬¬ä¸€æ¬¡åŒæ­¥åçš„ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><h4 id="åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›" tabindex="-1"><a class="header-anchor" href="#åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›" aria-hidden="true">#</a> åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›</h4><p>åœ¨å‰é¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸»ä»æœåŠ¡å™¨åœ¨ç¬¬ä¸€æ¬¡æ•°æ®åŒæ­¥çš„è¿‡ç¨‹ä¸­ï¼Œä¸»æœåŠ¡å™¨ä¼šåšä¸¤ä»¶è€—æ—¶çš„æ“ä½œï¼šç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶ã€‚</p><p>ä¸»æœåŠ¡å™¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªä»æœåŠ¡å™¨çš„ï¼Œå¦‚æœä»æœåŠ¡å™¨æ•°é‡éå¸¸å¤šï¼Œè€Œä¸”éƒ½ä¸ä¸»æœåŠ¡å™¨è¿›è¡Œå…¨é‡åŒæ­¥çš„è¯ï¼Œå°±ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>ç”±äºæ˜¯é€šè¿‡ bgsave å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°±ä¼šå¿™äºä½¿ç”¨ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœä¸»æœåŠ¡å™¨çš„å†…å­˜æ•°æ®éå¤§ï¼Œåœ¨æ‰§è¡Œ fork() å‡½æ•°æ—¶æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œä»è€Œä½¿å¾— Redis æ— æ³•æ­£å¸¸å¤„ç†è¯·æ±‚ï¼›</li><li>ä¼ è¾“ RDB æ–‡ä»¶ä¼šå ç”¨ä¸»æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ï¼Œä¼šå¯¹ä¸»æœåŠ¡å™¨å“åº”å‘½ä»¤è¯·æ±‚äº§ç”Ÿå½±å“ã€‚</li></ul><p>è¿™ç§æƒ…å†µå°±å¥½åƒï¼Œåˆšåˆ›ä¸šçš„å…¬å¸ï¼Œç”±äºäººä¸å¤šï¼Œæ‰€ä»¥å‘˜å·¥éƒ½å½’è€æ¿ä¸€ä¸ªäººç®¡ï¼Œä½†æ˜¯éšç€å…¬å¸çš„å‘å±•ï¼Œäººå‘˜çš„æ‰©å……ï¼Œè€æ¿æ…¢æ…¢å°±æ— æ³•æ‰¿æ‹…å…¨éƒ¨å‘˜å·¥çš„ç®¡ç†å·¥ä½œäº†ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€æ¿å°±éœ€è¦è®¾ç«‹ç»ç†èŒä½ï¼Œç”±ç»ç†ç®¡ç†å¤šåæ™®é€šå‘˜å·¥ï¼Œç„¶åè€æ¿åªéœ€è¦ç®¡ç†ç»ç†å°±å¥½ã€‚</p><p>Redis ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä»æœåŠ¡å™¨å¯ä»¥æœ‰è‡ªå·±çš„ä»æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‹¥æœ‰ä»æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨å½“ä½œç»ç†è§’è‰²ï¼Œå®ƒä¸ä»…å¯ä»¥æ¥æ”¶ä¸»æœåŠ¡å™¨çš„åŒæ­¥æ•°æ®ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥åŒæ—¶ä½œä¸ºä¸»æœåŠ¡å™¨çš„å½¢å¼å°†æ•°æ®åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œç»„ç»‡å½¢å¼å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220315731-a183108d.png" alt="image-20220714220315731" tabindex="0" loading="lazy"><figcaption>image-20220714220315731</figcaption></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<strong>ä¸»æœåŠ¡å™¨ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›å¯ä»¥åˆ†æ‘Šåˆ°å……å½“ç»ç†è§’è‰²çš„ä»æœåŠ¡å™¨</strong>ã€‚</p><p>é‚£å…·ä½“æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨ã€Œä»æœåŠ¡å™¨ã€ä¸Šæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œä½¿å…¶ä½œä¸ºç›®æ ‡æœåŠ¡å™¨çš„ä»æœåŠ¡å™¨ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>replicaof &lt;ç›®æ ‡æœåŠ¡å™¨çš„IP&gt; 6379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤æ—¶å¦‚æœç›®æ ‡æœåŠ¡å™¨æœ¬èº«ä¹Ÿæ˜¯ã€Œä»æœåŠ¡å™¨ã€ï¼Œé‚£ä¹ˆè¯¥ç›®æ ‡æœåŠ¡å™¨å°±ä¼šæˆä¸ºã€Œç»ç†ã€çš„è§’è‰²ï¼Œä¸ä»…å¯ä»¥æ¥å—ä¸»æœåŠ¡å™¨åŒæ­¥çš„æ•°æ®ï¼Œä¹Ÿä¼šæŠŠæ•°æ®åŒæ­¥ç»™è‡ªå·±æ——ä¸‹çš„ä»æœåŠ¡å™¨ï¼Œä»è€Œå‡è½»ä¸»æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</p><h4 id="å¢é‡å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#å¢é‡å¤åˆ¶" aria-hidden="true">#</a> å¢é‡å¤åˆ¶</h4><p>ä¸»ä»æœåŠ¡å™¨åœ¨å®Œæˆç¬¬ä¸€æ¬¡åŒæ­¥åï¼Œå°±ä¼šåŸºäºé•¿è¿æ¥è¿›è¡Œå‘½ä»¤ä¼ æ’­ã€‚</p><p>å¯æ˜¯ï¼Œç½‘ç»œæ€»æ˜¯ä¸æŒ‰å¥—è·¯å‡ºç‰Œçš„å˜›ï¼Œè¯´å»¶è¿Ÿå°±å»¶è¿Ÿï¼Œè¯´æ–­å¼€å°±æ–­å¼€ã€‚</p><p>å¦‚æœä¸»ä»æœåŠ¡å™¨é—´çš„ç½‘ç»œè¿æ¥æ–­å¼€äº†ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œå‘½ä»¤ä¼ æ’­äº†ï¼Œè¿™æ—¶ä»æœåŠ¡å™¨çš„æ•°æ®å°±æ²¡åŠæ³•å’Œä¸»æœåŠ¡å™¨ä¿æŒä¸€è‡´äº†ï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½ä»ã€Œä»æœåŠ¡å™¨ã€è¯»åˆ°æ—§çš„æ•°æ®ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220333043-7e1891c1.png" alt="image-20220714220333043" tabindex="0" loading="lazy"><figcaption>image-20220714220333043</figcaption></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæ­¤æ—¶æ–­å¼€çš„ç½‘ç»œï¼Œåˆæ¢å¤æ­£å¸¸äº†ï¼Œè¦æ€ä¹ˆç»§ç»­ä¿è¯ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ</p><p>åœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»æœåŠ¡å™¨åœ¨å‘½ä»¤åŒæ­¥æ—¶å‡ºç°äº†ç½‘ç»œæ–­å¼€åˆæ¢å¤çš„æƒ…å†µï¼Œä»æœåŠ¡å™¨å°±ä¼šå’Œä¸»æœåŠ¡å™¨é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¾ˆæ˜æ˜¾è¿™æ ·çš„å¼€é”€å¤ªå¤§äº†ï¼Œå¿…é¡»è¦æ”¹è¿›ä¸€æ³¢ã€‚</p><p>æ‰€ä»¥ï¼Œä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­å¼€åˆæ¢å¤åï¼Œä»ä¸»ä»æœåŠ¡å™¨ä¼šé‡‡ç”¨<strong>å¢é‡å¤åˆ¶</strong>çš„æ–¹å¼ç»§ç»­åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åªä¼šæŠŠç½‘ç»œæ–­å¼€æœŸé—´ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»æœåŠ¡å™¨ã€‚</p><p>ç½‘ç»œæ¢å¤åçš„å¢é‡å¤åˆ¶è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220340040-ddbee757.png" alt="image-20220714220340040" tabindex="0" loading="lazy"><figcaption>image-20220714220340040</figcaption></figure><p>ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä»æœåŠ¡å™¨åœ¨æ¢å¤ç½‘ç»œåï¼Œä¼šå‘é€ psync å‘½ä»¤ç»™ä¸»æœåŠ¡å™¨ï¼Œæ­¤æ—¶çš„ psync å‘½ä»¤é‡Œçš„ offset å‚æ•°ä¸æ˜¯ -1ï¼›</li><li>ä¸»æœåŠ¡å™¨æ”¶åˆ°è¯¥å‘½ä»¤åï¼Œç„¶åç”¨ CONTINUE å“åº”å‘½ä»¤å‘Šè¯‰ä»æœåŠ¡å™¨æ¥ä¸‹æ¥é‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼åŒæ­¥æ•°æ®ï¼›</li><li>ç„¶åä¸»æœåŠ¡å°†ä¸»ä»æœåŠ¡å™¨æ–­çº¿æœŸé—´ï¼Œæ‰€æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚</li></ul><p>é‚£ä¹ˆå…³é”®çš„é—®é¢˜æ¥äº†ï¼Œ<strong>ä¸»æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“è¦å°†å“ªäº›å¢é‡æ•°æ®å‘é€ç»™ä»æœåŠ¡å™¨å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆè—åœ¨è¿™ä¸¤ä¸ªä¸œè¥¿é‡Œï¼š</p><ul><li><strong>repl_backlog_buffer</strong>ï¼Œæ˜¯ä¸€ä¸ªã€Œ<strong>ç¯å½¢</strong>ã€ç¼“å†²åŒºï¼Œç”¨äºä¸»ä»æœåŠ¡å™¨æ–­è¿åï¼Œä»ä¸­æ‰¾åˆ°å·®å¼‚çš„æ•°æ®ï¼›</li><li><strong>replication offset</strong>ï¼Œæ ‡è®°ä¸Šé¢é‚£ä¸ªç¼“å†²åŒºçš„åŒæ­¥è¿›åº¦ï¼Œä¸»ä»æœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„åç§»é‡ï¼Œä¸»æœåŠ¡å™¨ä½¿ç”¨ master_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>å†™</em>ã€åˆ°çš„ä½ç½®ï¼Œä»æœåŠ¡å™¨ä½¿ç”¨ slave_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>è¯»</em>ã€åˆ°çš„ä½ç½®ã€‚</li></ul><p>é‚£repl_backlog_buffer ç¼“å†²åŒºæ˜¯ä»€ä¹ˆæ—¶å€™å†™å…¥çš„å‘¢ï¼Ÿ</p><p>åœ¨ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥åˆ° repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œå› æ­¤ è¿™ä¸ªç¼“å†²åŒºé‡Œä¼šä¿å­˜ç€æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ã€‚</p><p>ç½‘ç»œæ–­å¼€åï¼Œå½“ä»æœåŠ¡å™¨é‡æ–°è¿ä¸Šä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡ psync å‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡ slave_repl_offset å‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨æ ¹æ®è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®è·ï¼Œç„¶åæ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå“ªç§åŒæ­¥æ“ä½œï¼š</p><ul><li>å¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¿˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å¢é‡åŒæ­¥</strong>çš„æ–¹å¼ï¼›</li><li>ç›¸åï¼Œå¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®å·²ç»ä¸å­˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å…¨é‡åŒæ­¥</strong>çš„æ–¹å¼ã€‚</li></ul><p>å½“ä¸»æœåŠ¡å™¨åœ¨ repl_backlog_buffer ä¸­æ‰¾åˆ°ä¸»ä»æœåŠ¡å™¨å·®å¼‚ï¼ˆå¢é‡ï¼‰çš„æ•°æ®åï¼Œå°±ä¼šå°†å¢é‡çš„æ•°æ®å†™å…¥åˆ° replication buffer ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œå®ƒæ˜¯ç¼“å­˜å°†è¦ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å‘½ä»¤ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220348740-2333706f.png" alt="image-20220714220348740" tabindex="0" loading="lazy"><figcaption>image-20220714220348740</figcaption></figure><p>repl_backlog_buffer ç¼“è¡Œç¼“å†²åŒºçš„é»˜è®¤å¤§å°æ˜¯ 1Mï¼Œå¹¶ä¸”ç”±äºå®ƒæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ‰€ä»¥å½“ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»æœåŠ¡å™¨ç»§ç»­å†™å…¥çš„è¯ï¼Œå°±ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå½“ä¸»æœåŠ¡å™¨çš„å†™å…¥é€Ÿåº¦è¿œè¶…äºä»æœåŠ¡å™¨çš„è¯»å–é€Ÿåº¦ï¼Œç¼“å†²åŒºçš„æ•°æ®ä¸€ä¸‹å°±ä¼šè¢«è¦†ç›–ã€‚</p><p>é‚£ä¹ˆåœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œå¦‚æœä»æœåŠ¡å™¨æƒ³è¯»çš„æ•°æ®å·²ç»è¢«è¦†ç›–äº†ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šé‡‡ç”¨å…¨é‡åŒæ­¥ï¼Œè¿™ä¸ªæ–¹å¼æ¯”å¢é‡åŒæ­¥çš„æ€§èƒ½æŸè€—è¦å¤§å¾ˆå¤šã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†é¿å…åœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œä¸»æœåŠ¡å™¨é¢‘ç¹åœ°ä½¿ç”¨å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæˆ‘ä»¬åº”è¯¥è°ƒæ•´ä¸‹ repl_backlog_buffer ç¼“å†²åŒºå¤§å°ï¼Œå°½å¯èƒ½çš„å¤§ä¸€äº›ï¼Œå‡å°‘å‡ºç°ä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¢«è¦†ç›–çš„æ¦‚ç‡ï¼Œä»è€Œä½¿å¾—ä¸»æœåŠ¡å™¨é‡‡ç”¨å¢é‡åŒæ­¥çš„æ–¹å¼ã€‚</p><p>é‚£ repl_backlog_buffer ç¼“å†²åŒºå…·ä½“è¦è°ƒæ•´åˆ°å¤šå¤§å‘¢ï¼Ÿ</p><p>repl_backlog_buffer æœ€å°çš„å¤§å°å¯ä»¥æ ¹æ®è¿™é¢è¿™ä¸ªå…¬å¼ä¼°ç®—ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220356331-2eb17ecf.png" alt="image-20220714220356331" tabindex="0" loading="lazy"><figcaption>image-20220714220356331</figcaption></figure><p>æˆ‘æ¥è§£é‡Šä¸‹è¿™ä¸ªå…¬å¼çš„æ„æ€ï¼š</p><ul><li>second ä¸ºä»æœåŠ¡å™¨æ–­çº¿åé‡æ–°è¿æ¥ä¸Šä¸»æœåŠ¡å™¨æ‰€éœ€çš„å¹³å‡ æ—¶é—´(ä»¥ç§’è®¡ç®—)ã€‚</li><li>write_size_per_second åˆ™æ˜¯ä¸»æœåŠ¡å™¨å¹³å‡æ¯ç§’äº§ç”Ÿçš„å†™å‘½ä»¤æ•°æ®é‡å¤§å°ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸»æœåŠ¡å™¨å¹³å‡æ¯ç§’äº§ç”Ÿ 1 MB çš„å†™å‘½ä»¤ï¼Œè€Œä»æœåŠ¡å™¨æ–­çº¿ä¹‹åå¹³å‡è¦ 5 ç§’æ‰èƒ½é‡æ–°è¿æ¥ä¸»æœåŠ¡å™¨ã€‚</p><p>é‚£ä¹ˆ repl_backlog_buffer å¤§å°å°±ä¸èƒ½ä½äº 5 MBï¼Œå¦åˆ™æ–°å†™åœ°å‘½ä»¤å°±ä¼šè¦†ç›–æ—§æ•°æ®äº†ã€‚</p><p>å½“ç„¶ï¼Œä¸ºäº†åº”å¯¹ä¸€äº›çªå‘çš„æƒ…å†µï¼Œå¯ä»¥å°† repl_backlog_buffer çš„å¤§å°è®¾ç½®ä¸ºæ­¤åŸºç¡€ä¸Šçš„ 2 å€ï¼Œä¹Ÿå°±æ˜¯ 10 MBã€‚</p><p>å…³äº repl_backlog_buffer å¤§å°ä¿®æ”¹çš„æ–¹æ³•ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œä¸‹é¢è¿™ä¸ªå‚æ•°é¡¹çš„å€¼å°±å¯ä»¥ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>repl-backlog-size 1mb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><p>ä¸»ä»å¤åˆ¶å…±æœ‰ä¸‰ç§æ¨¡å¼ï¼š<strong>å…¨é‡å¤åˆ¶ã€åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­ã€å¢é‡å¤åˆ¶</strong>ã€‚</p><p>ä¸»ä»æœåŠ¡å™¨ç¬¬ä¸€æ¬¡åŒæ­¥çš„æ—¶å€™ï¼Œå°±æ˜¯é‡‡ç”¨å…¨é‡å¤åˆ¶ï¼Œæ­¤æ—¶ä¸»æœåŠ¡å™¨ä¼šä¸¤ä¸ªè€—æ—¶çš„åœ°æ–¹ï¼Œåˆ†åˆ«æ˜¯ç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿‡å¤šçš„ä»æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¯ä»¥æŠŠä¸€éƒ¨åˆ†ä»æœåŠ¡å™¨å‡çº§ä¸ºã€Œç»ç†è§’è‰²ã€ï¼Œè®©å®ƒä¹Ÿæœ‰è‡ªå·±çš„ä»æœåŠ¡å™¨ï¼Œé€šè¿‡è¿™æ ·å¯ä»¥åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p>ç¬¬ä¸€æ¬¡åŒæ­¥å®Œæˆåï¼Œä¸»ä»æœåŠ¡å™¨éƒ½ä¼šç»´æŠ¤ç€ä¸€ä¸ªé•¿è¿æ¥ï¼Œä¸»æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å†™æ“ä½œå‘½ä»¤åï¼Œå°±ä¼šé€šè¿‡è¿™ä¸ªè¿æ¥å°†å†™å‘½ä»¤ä¼ æ’­ç»™ä»æœåŠ¡å™¨ï¼Œæ¥ä¿è¯ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>å¦‚æœé‡åˆ°ç½‘ç»œæ–­å¼€ï¼Œå¢é‡å¤åˆ¶å°±å¯ä»¥ä¸Šåœºäº†ï¼Œä¸è¿‡è¿™ä¸ªè¿˜è·Ÿ repl_backlog_size è¿™ä¸ªå¤§å°æœ‰å…³ç³»ã€‚</p><p>å¦‚æœå®ƒé…ç½®çš„è¿‡å°ï¼Œä¸»ä»æœåŠ¡å™¨ç½‘ç»œæ¢å¤æ—¶ï¼Œå¯èƒ½å‘ç”Ÿã€Œä»æœåŠ¡å™¨ã€æƒ³è¯»çš„æ•°æ®å·²ç»è¢«è¦†ç›–äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å°±ä¼šå¯¼è‡´ä¸»æœåŠ¡å™¨é‡‡ç”¨å…¨é‡å¤åˆ¶çš„æ–¹å¼ã€‚æ‰€ä»¥ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„é¢‘ç¹å‘ç”Ÿï¼Œè¦è°ƒå¤§è¿™ä¸ªå‚æ•°çš„å€¼ï¼Œä»¥é™ä½ä¸»ä»æœåŠ¡å™¨æ–­å¼€åå…¨é‡åŒæ­¥çš„æ¦‚ç‡ã€‚</p><h3 id="sentinel-å“¨å…µ-æœ‰ä»€ä¹ˆä½œç”¨" tabindex="-1"><a class="header-anchor" href="#sentinel-å“¨å…µ-æœ‰ä»€ä¹ˆä½œç”¨" aria-hidden="true">#</a> Sentinelï¼ˆå“¨å…µï¼‰ æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3><blockquote><p>Redis Sentinelï¼Œå³Rediså“¨å…µï¼Œåœ¨Redis 2.8ç‰ˆæœ¬å¼€å§‹å¼•å…¥ã€‚å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚</p></blockquote><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„å“¨å…µé›†ç¾¤ç›‘æ§çš„é€»è¾‘å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220617154744863-d3f92b71.png" alt="image-20220617154744863" tabindex="0" loading="lazy"><figcaption>image-20220617154744863</figcaption></figure><p>å“¨å…µå®ç°äº†ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿä¸‹é¢æ˜¯Rediså®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š</p><ul><li><strong>ç›‘æ§ï¼ˆMonitoringï¼‰</strong>ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li><li><strong>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰</strong>ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li><strong>é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰</strong>ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚</li><li><strong>é€šçŸ¥ï¼ˆNotificationï¼‰</strong>ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>å…¶ä¸­ï¼Œç›‘æ§å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œä½¿å¾—å“¨å…µå¯ä»¥åŠæ—¶å‘ç°ä¸»èŠ‚ç‚¹æ•…éšœå¹¶å®Œæˆè½¬ç§»ï¼›è€Œé…ç½®æä¾›è€…å’Œé€šçŸ¥åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’ä¸­æ‰èƒ½ä½“ç°ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦å“¨å…µ" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦å“¨å…µ" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦å“¨å…µï¼Ÿ</h3><p>åœ¨ Redis çš„ä¸»ä»æ¶æ„ä¸­ï¼Œç”±äºä¸»ä»æ¨¡å¼æ˜¯è¯»å†™åˆ†ç¦»çš„ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰æŒ‚äº†ï¼Œé‚£ä¹ˆå°†æ²¡æœ‰ä¸»èŠ‚ç‚¹æ¥æœåŠ¡å®¢æˆ·ç«¯çš„å†™æ“ä½œè¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰ä¸»èŠ‚ç‚¹ç»™ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰è¿›è¡Œæ•°æ®åŒæ­¥äº†ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220520655-9e90292b.png" alt="image-20220714220520655" tabindex="0" loading="lazy"><figcaption>image-20220714220520655</figcaption></figure><p>è¿™æ—¶å¦‚æœè¦æ¢å¤æœåŠ¡çš„è¯ï¼Œéœ€è¦äººå·¥ä»‹å…¥ï¼Œé€‰æ‹©ä¸€ä¸ªã€Œä»èŠ‚ç‚¹ã€åˆ‡æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€ï¼Œç„¶åè®©å…¶ä»–ä»èŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶è¿˜éœ€è¦é€šçŸ¥ä¸Šæ¸¸é‚£äº›è¿æ¥ Redis ä¸»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œå°†å…¶é…ç½®ä¸­çš„ä¸»èŠ‚ç‚¹ IP åœ°å€æ›´æ–°ä¸ºã€Œæ–°ä¸»èŠ‚ç‚¹ã€çš„ IP åœ°å€ã€‚</p><p>è¿™æ ·ä¹Ÿä¸å¤ªâ€œæ™ºèƒ½â€äº†ï¼Œè¦æ˜¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½ç›‘æ§ã€Œä¸»èŠ‚ç‚¹ã€çš„çŠ¶æ€ï¼Œå½“å‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº† ï¼Œå®ƒè‡ªåŠ¨å°†ä¸€ä¸ªã€Œä»èŠ‚ç‚¹ã€åˆ‡æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥èŠ‚çœæˆ‘ä»¬å¾ˆå¤šäº‹æƒ…å•Šï¼</p><p>Redis åœ¨ 2.8 ç‰ˆæœ¬ä»¥åæä¾›çš„<strong>å“¨å…µï¼ˆ*Sentinel*ï¼‰æœºåˆ¶</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®ç°<strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»</strong>ã€‚å®ƒä¼šç›‘æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒå°±ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</p><h4 id="å“¨å…µæœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„" tabindex="-1"><a class="header-anchor" href="#å“¨å…µæœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„" aria-hidden="true">#</a> å“¨å…µæœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><p>å“¨å…µå…¶å®æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä»â€œå“¨å…µâ€è¿™ä¸ªåå­—ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œå®ƒç›¸å½“äºæ˜¯â€œè§‚å¯Ÿè€…èŠ‚ç‚¹â€ï¼Œè§‚å¯Ÿçš„å¯¹è±¡æ˜¯ä¸»ä»èŠ‚ç‚¹ã€‚</p><p>å½“ç„¶ï¼Œå®ƒä¸ä»…ä»…æ˜¯è§‚å¯Ÿé‚£ä¹ˆç®€å•ï¼Œåœ¨å®ƒè§‚å¯Ÿåˆ°æœ‰å¼‚å¸¸çš„çŠ¶å†µä¸‹ï¼Œä¼šåšå‡ºä¸€äº›â€œåŠ¨ä½œâ€ï¼Œæ¥ä¿®å¤å¼‚å¸¸çŠ¶æ€ã€‚</p><p>å“¨å…µèŠ‚ç‚¹ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220539777-705199fc.png" alt="image-20220714220539777" tabindex="0" loading="lazy"><figcaption>image-20220714220539777</figcaption></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡ç‚¹è¦å­¦ä¹ è¿™ä¸‰ä»¶äº‹æƒ…ï¼š</p><ul><li>å“¨å…µèŠ‚ç‚¹æ˜¯å¦‚ä½•ç›‘æ§èŠ‚ç‚¹çš„ï¼Ÿåˆæ˜¯å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹æ˜¯å¦çœŸçš„æ•…éšœäº†ï¼Ÿ</li><li>æ ¹æ®ä»€ä¹ˆè§„åˆ™é€‰æ‹©ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Ÿ</li><li>æ€ä¹ˆæŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯å‘¢ï¼Ÿ</li></ul><h4 id="å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†" aria-hidden="true">#</a> å¦‚ä½•åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æ•…éšœäº†ï¼Ÿ</h4><p>å“¨å…µä¼šæ¯éš” 1 ç§’ç»™æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹å‘é€ PING å‘½ä»¤ï¼Œå½“ä¸»ä»èŠ‚ç‚¹æ”¶åˆ° PING å‘½ä»¤åï¼Œä¼šå‘é€ä¸€ä¸ªå“åº”å‘½ä»¤ç»™å“¨å…µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å®ƒä»¬æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220557761-6db7e737.png" alt="image-20220714220557761" tabindex="0" loading="lazy"><figcaption>image-20220714220557761</figcaption></figure><p>å¦‚æœä¸»èŠ‚ç‚¹æˆ–è€…ä»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å®ƒä»¬æ ‡è®°ä¸ºã€Œ<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€ã€‚è¿™ä¸ªã€Œè§„å®šçš„æ—¶é—´ã€æ˜¯é…ç½®é¡¹ <code>down-after-milliseconds</code> å‚æ•°è®¾å®šçš„ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p><blockquote><p>ä¸»è§‚ä¸‹çº¿ï¼Ÿéš¾é“è¿˜æœ‰å®¢è§‚ä¸‹çº¿ï¼Ÿ</p></blockquote><p>æ˜¯çš„æ²¡é”™ï¼Œå®¢è§‚ä¸‹çº¿åªé€‚ç”¨äºä¸»èŠ‚ç‚¹ã€‚</p><p>ä¹‹æ‰€ä»¥é’ˆå¯¹ã€Œä¸»èŠ‚ç‚¹ã€è®¾è®¡ã€Œä¸»è§‚ä¸‹çº¿ã€å’Œã€Œå®¢è§‚ä¸‹çº¿ã€ä¸¤ä¸ªçŠ¶æ€ï¼Œæ˜¯å› ä¸ºæœ‰å¯èƒ½ã€Œä¸»èŠ‚ç‚¹ã€å…¶å®å¹¶æ²¡æœ‰æ•…éšœï¼Œå¯èƒ½åªæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹çš„ç³»ç»Ÿå‹åŠ›æ¯”è¾ƒå¤§æˆ–è€…ç½‘ç»œå‘é€äº†æ‹¥å¡ï¼Œå¯¼è‡´ä¸»èŠ‚ç‚¹æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†å‡å°‘è¯¯åˆ¤çš„æƒ…å†µï¼Œå“¨å…µåœ¨éƒ¨ç½²çš„æ—¶å€™ä¸ä¼šåªéƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯ç”¨å¤šä¸ªèŠ‚ç‚¹éƒ¨ç½²æˆ<strong>å“¨å…µé›†ç¾¤</strong>ï¼ˆ<em>æœ€å°‘éœ€è¦ä¸‰å°æœºå™¨æ¥éƒ¨ç½²å“¨å…µé›†ç¾¤</em>ï¼‰ï¼Œ<strong>é€šè¿‡å¤šä¸ªå“¨å…µèŠ‚ç‚¹ä¸€èµ·åˆ¤æ–­ï¼Œå°±å¯ä»¥å°±å¯ä»¥é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„æƒ…å†µ</strong>ã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚</p><p>å…·ä½“æ˜¯æ€ä¹ˆåˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€çš„å‘¢ï¼Ÿ</p><p>å½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œä¸»è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220606567-1387e82c.png" alt="image-20220714220606567" tabindex="0" loading="lazy"><figcaption>image-20220714220606567</figcaption></figure><p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p><p>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ 3 ä¸ªå“¨å…µï¼Œquorum é…ç½®çš„æ˜¯ 2ï¼Œé‚£ä¹ˆä¸€ä¸ªå“¨å…µéœ€è¦ 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥æ ‡è®°ä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€äº†ã€‚è¿™ 2 å¼ èµæˆç¥¨åŒ…æ‹¬å“¨å…µè‡ªå·±çš„ä¸€å¼ èµæˆç¥¨å’Œå¦å¤–ä¸¤ä¸ªå“¨å…µçš„èµæˆç¥¨ã€‚</p><p>PSï¼šquorum çš„å€¼ä¸€èˆ¬è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ 1ï¼Œä¾‹å¦‚ 3 ä¸ªå“¨å…µå°±è®¾ç½® 2ã€‚</p><p>å“¨å…µåˆ¤æ–­å®Œä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œå“¨å…µå°±è¦å¼€å§‹åœ¨å¤šä¸ªã€Œä»èŠ‚ç‚¹ã€ä¸­ï¼Œé€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹æ¥åšæ–°ä¸»èŠ‚ç‚¹ã€‚</p><h4 id="ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»" tabindex="-1"><a class="header-anchor" href="#ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»" aria-hidden="true">#</a> ç”±å“ªä¸ªå“¨å…µè¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼Ÿ</h4><p>å‰é¢è¯´è¿‡ï¼Œä¸ºäº†æ›´åŠ â€œå®¢è§‚â€çš„åˆ¤æ–­ä¸»èŠ‚ç‚¹æ•…éšœäº†ï¼Œä¸€èˆ¬ä¸ä¼šåªç”±å•ä¸ªå“¨å…µçš„æ£€æµ‹ç»“æœæ¥åˆ¤æ–­ï¼Œè€Œæ˜¯å¤šä¸ªå“¨å…µä¸€èµ·åˆ¤æ–­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¯¯åˆ¤æ¦‚ç‡ï¼Œæ‰€ä»¥<strong>å“¨å…µæ˜¯ä»¥å“¨å…µé›†ç¾¤çš„æ–¹å¼å­˜åœ¨çš„</strong>ã€‚</p><p>é—®é¢˜æ¥äº†ï¼Œç”±å“¨å…µé›†ç¾¤ä¸­çš„å“ªä¸ªèŠ‚ç‚¹è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»å‘¢ï¼Ÿ</p><p>æ‰€ä»¥è¿™æ—¶å€™ï¼Œè¿˜éœ€è¦åœ¨å“¨å…µé›†ç¾¤ä¸­é€‰å‡ºä¸€ä¸ª leederï¼Œè®© leeder æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚</p><p>é€‰ä¸¾ leeder çš„è¿‡ç¨‹å…¶å®æ˜¯ä¸€ä¸ªæŠ•ç¥¨çš„è¿‡ç¨‹ï¼Œåœ¨æŠ•ç¥¨å¼€å§‹å‰ï¼Œè‚¯å®šå¾—æœ‰ä¸ªã€Œå€™é€‰è€…ã€ã€‚</p><blockquote><p>é‚£è°æ¥ä½œä¸ºå€™é€‰è€…å‘¢ï¼Ÿ</p></blockquote><p>å“ªä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œè¿™ä¸ªå“¨å…µèŠ‚ç‚¹å°±æ˜¯å€™é€‰è€…ï¼Œæ‰€è°“çš„å€™é€‰è€…å°±æ˜¯æƒ³å½“ Leader çš„å“¨å…µã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªå“¨å…µã€‚å½“å“¨å…µ B å…ˆåˆ¤æ–­åˆ°ä¸»èŠ‚ç‚¹ã€Œä¸»è§‚ä¸‹çº¿åã€ï¼Œå°±ä¼šç»™å…¶ä»–å®ä¾‹å‘é€ is-master-down-by-addr å‘½ä»¤ã€‚æ¥ç€ï¼Œå…¶ä»–å“¨å…µä¼šæ ¹æ®è‡ªå·±å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714220628098-29c4ca51.png" alt="image-20220714220628098" tabindex="0" loading="lazy"><figcaption>image-20220714220628098</figcaption></figure><p>å½“å“¨å…µ B æ”¶åˆ°èµæˆç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œå°±ä¼šå°†ä¸»èŠ‚ç‚¹æ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ï¼Œæ­¤æ—¶çš„å“¨å…µ B å°±æ˜¯ä¸€ä¸ªLeader å€™é€‰è€…ã€‚</p><blockquote><p>å€™é€‰è€…å¦‚ä½•é€‰ä¸¾æˆä¸º Leaderï¼Ÿ</p></blockquote><p>å€™é€‰è€…ä¼šå‘å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›æˆä¸º Leader æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µå¯¹å®ƒè¿›è¡ŒæŠ•ç¥¨ã€‚</p><p>æ¯ä¸ªå“¨å…µåªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼šï¼Œå¦‚æœç”¨å®Œåå°±ä¸èƒ½å‚ä¸æŠ•ç¥¨äº†ï¼Œå¯ä»¥æŠ•ç»™è‡ªå·±æˆ–æŠ•ç»™åˆ«äººï¼Œä½†æ˜¯åªæœ‰å€™é€‰è€…æ‰èƒ½æŠŠç¥¨æŠ•ç»™è‡ªå·±ã€‚</p><p>é‚£ä¹ˆåœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªã€Œå€™é€‰è€…ã€ï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li><li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å“¨å…µèŠ‚ç‚¹æœ‰ 3 ä¸ªï¼Œquorum è®¾ç½®ä¸º 2ï¼Œé‚£ä¹ˆä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µåªè¦æ‹¿åˆ° 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥é€‰ä¸¾æˆåŠŸäº†ã€‚å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶ï¼Œå°±éœ€è¦é‡æ–°è¿›è¡Œé€‰ä¸¾ã€‚</p><p>è¿™æ—¶å€™æœ‰çš„åŒå­¦å°±ä¼šé—®äº†ï¼Œå¦‚æœæŸä¸ªæ—¶é—´ç‚¹ï¼Œåˆšå¥½æœ‰ä¸¤ä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­åˆ°ä¸»èŠ‚ç‚¹ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œé‚£è¿™æ—¶ä¸å°±æœ‰ä¸¤ä¸ªå€™é€‰è€…äº†ï¼Ÿè¿™æ—¶è¯¥å¦‚ä½•å†³å®šè°æ˜¯ Leader å‘¢ï¼Ÿ</p><p>æ¯ä½å€™é€‰è€…éƒ½ä¼šå…ˆç»™è‡ªå·±æŠ•ä¸€ç¥¨ï¼Œç„¶åå‘å…¶ä»–å“¨å…µå‘èµ·æŠ•ç¥¨è¯·æ±‚ã€‚å¦‚æœæŠ•ç¥¨è€…å…ˆæ”¶åˆ°ã€Œå€™é€‰è€… Aã€çš„æŠ•ç¥¨è¯·æ±‚ï¼Œå°±ä¼šå…ˆæŠ•ç¥¨ç»™å®ƒï¼Œå¦‚æœæŠ•ç¥¨è€…ç”¨å®ŒæŠ•ç¥¨æœºä¼šåï¼Œæ”¶åˆ°ã€Œå€™é€‰è€… Bã€çš„æŠ•ç¥¨è¯·æ±‚åï¼Œå°±ä¼šæ‹’ç»æŠ•ç¥¨ã€‚è¿™æ—¶ï¼Œå€™é€‰è€… A å…ˆæ»¡è¶³äº†ä¸Šé¢çš„é‚£ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥ã€Œå€™é€‰è€… Aã€å°±ä¼šè¢«é€‰ä¸¾ä¸º Leaderã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆå“¨å…µèŠ‚ç‚¹è‡³å°‘è¦æœ‰ 3 ä¸ªï¼Ÿ</p></blockquote><p>å¦‚æœå“¨å…µé›†ç¾¤ä¸­åªæœ‰ 2 ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œæ­¤æ—¶å¦‚æœä¸€ä¸ªå“¨å…µæƒ³è¦æˆåŠŸæˆä¸º Leaderï¼Œå¿…é¡»è·å¾— 2 ç¥¨ï¼Œè€Œä¸æ˜¯ 1 ç¥¨ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœå“¨å…µé›†ç¾¤ä¸­æœ‰ä¸ªå“¨å…µæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå°±åªå‰©ä¸€ä¸ªå“¨å…µäº†ï¼Œå¦‚æœè¿™ä¸ªå“¨å…µæƒ³è¦æˆä¸º Leaderï¼Œè¿™æ—¶ç¥¨æ•°å°±æ²¡åŠæ³•è¾¾åˆ° 2 ç¥¨ï¼Œå°±æ— æ³•æˆåŠŸæˆä¸º Leaderï¼Œè¿™æ—¶æ˜¯æ— æ³•è¿›è¡Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢çš„ã€‚</p><p>å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬è‡³å°‘ä¼šé…ç½® 3 ä¸ªå“¨å…µèŠ‚ç‚¹ã€‚è¿™æ—¶ï¼Œå¦‚æœå“¨å…µé›†ç¾¤ä¸­æœ‰ä¸ªå“¨å…µæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆè¿˜å‰©ä¸‹ä¸¤ä¸ªä¸ªå“¨å…µï¼Œå¦‚æœè¿™ä¸ªå“¨å…µæƒ³è¦æˆä¸º Leaderï¼Œè¿™æ—¶è¿˜æ˜¯æœ‰æœºä¼šè¾¾åˆ° 2 ç¥¨çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥é€‰ä¸¾æˆåŠŸçš„ï¼Œä¸ä¼šå¯¼è‡´æ— æ³•è¿›è¡Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢ã€‚</p><p>å½“ç„¶ï¼Œä½ è¦é—®ï¼Œå¦‚æœ 3 ä¸ªå“¨å…µèŠ‚ç‚¹ï¼ŒæŒ‚äº† 2 ä¸ªæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™å¾—äººä¸ºä»‹å…¥äº†ï¼Œæˆ–è€…å¢åŠ å¤šä¸€ç‚¹å“¨å…µèŠ‚ç‚¹ã€‚</p><p>å†è¯´ä¸€ä¸ªé—®é¢˜ï¼ŒRedis 1 ä¸» 4 ä»ï¼Œ5 ä¸ªå“¨å…µ ï¼Œquorum è®¾ç½®ä¸º 3ï¼Œå¦‚æœ 2 ä¸ªå“¨å…µæ•…éšœï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå“¨å…µèƒ½å¦åˆ¤æ–­ä¸»èŠ‚ç‚¹â€œå®¢è§‚ä¸‹çº¿â€ï¼Ÿä¸»ä»èƒ½å¦è‡ªåŠ¨åˆ‡æ¢ï¼Ÿ</p><ul><li><strong>å“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹â€œå®¢è§‚ä¸‹çº¿â€</strong>ã€‚å“¨å…µé›†ç¾¤è¿˜å‰©ä¸‹ 3 ä¸ªå“¨å…µï¼Œå½“ä¸€ä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹â€œä¸»è§‚ä¸‹çº¿â€åï¼Œè¯¢é—®å¦å¤– 2 ä¸ªå“¨å…µåï¼Œæœ‰å¯èƒ½èƒ½æ‹¿åˆ° 3 å¼ èµåŒç¥¨ï¼Œè¿™æ—¶å°±è¾¾åˆ°äº† quorum çš„å€¼ï¼Œå› æ­¤ï¼Œå“¨å…µé›†ç¾¤å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚</li><li><strong>å“¨å…µé›†ç¾¤å¯ä»¥å®Œæˆä¸»ä»åˆ‡æ¢</strong>ã€‚å½“æœ‰ä¸ªå“¨å…µæ ‡è®°ä¸»èŠ‚ç‚¹ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€åï¼Œå°±ä¼šè¿›è¡Œé€‰ä¸¾ Leader çš„è¿‡ç¨‹ï¼Œå› ä¸ºæ­¤æ—¶å“¨å…µé›†ç¾¤è¿˜å‰©ä¸‹ 3 ä¸ªå“¨å…µï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥æ‹¿åˆ°åŠæ•°ä»¥ä¸Šï¼ˆ5/2+1=3ï¼‰çš„ç¥¨ï¼Œè€Œä¸”ä¹Ÿè¾¾åˆ°äº† quorum å€¼ï¼Œæ»¡è¶³äº†é€‰ä¸¾ Leader çš„ä¸¤ä¸ªæ¡ä»¶ï¼Œ æ‰€ä»¥å°±èƒ½é€‰ä¸¾æˆåŠŸï¼Œå› æ­¤å“¨å…µé›†ç¾¤å¯ä»¥å®Œæˆä¸»ä»åˆ‡æ¢ã€‚</li></ul><p>å¦‚æœ quorum è®¾ç½®ä¸º 2 ï¼Œå¹¶ä¸”å¦‚æœæœ‰ 3 ä¸ªå“¨å…µæ•…éšœçš„è¯ã€‚æ­¤æ—¶å“¨å…µé›†ç¾¤è¿˜æ˜¯å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œä½†æ˜¯å“¨å…µä¸èƒ½å®Œæˆä¸»ä»åˆ‡æ¢äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æ¨æ¼”ä¸‹ã€‚</p><p>å¦‚æœ quorum è®¾ç½®ä¸º 3ï¼Œå¹¶ä¸”å¦‚æœæœ‰ 3 ä¸ªå“¨å…µæ•…éšœçš„è¯ï¼Œå“¨å…µé›†ç¾¤å³ä¸èƒ½åˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œä¹Ÿä¸èƒ½å®Œæˆä¸»ä»åˆ‡æ¢äº†ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œquorum ä¸º 2 çš„æ—¶å€™ï¼Œå¹¶ä¸”å¦‚æœæœ‰ 3 ä¸ªå“¨å…µæ•…éšœçš„è¯ï¼Œè™½ç„¶å¯ä»¥åˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œä½†æ˜¯ä¸èƒ½å®Œæˆä¸»ä»åˆ‡æ¢ï¼Œè¿™æ ·æ„Ÿè§‰ã€Œåˆ¤å®šä¸»èŠ‚ç‚¹ä¸ºå®¢è§‚ä¸‹çº¿ã€è¿™ä»¶äº‹æƒ…ç™½åšäº†ä¸€æ ·ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œè¿˜ä¸å¦‚ä¸è¦åšï¼Œquorum ä¸º 3 çš„æ—¶å€™ï¼Œå°±å¯ä»¥é¿å…è¿™ç§æ— ç”¨åŠŸã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>quorum çš„å€¼å»ºè®®è®¾ç½®ä¸ºå“¨å…µä¸ªæ•°çš„äºŒåˆ†ä¹‹ä¸€åŠ 1</strong>ï¼Œä¾‹å¦‚ 3 ä¸ªå“¨å…µå°±è®¾ç½® 2ï¼Œ5 ä¸ªå“¨å…µè®¾ç½®ä¸º 3ï¼Œè€Œä¸”<strong>å“¨å…µèŠ‚ç‚¹çš„æ•°é‡åº”è¯¥æ˜¯å¥‡æ•°</strong>ã€‚</p><h4 id="ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„" aria-hidden="true">#</a> ä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h4><p>åœ¨å“¨å…µé›†ç¾¤ä¸­é€šè¿‡æŠ•ç¥¨çš„æ–¹å¼ï¼Œé€‰ä¸¾å‡ºäº†å“¨å…µ leader åï¼Œå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹äº†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714222351206-2d27bc07.png" alt="image-20220714222351206" tabindex="0" loading="lazy"><figcaption>image-20220714222351206</figcaption></figure><p>ä¸»ä»æ•…éšœè½¬ç§»æ“ä½œåŒ…å«ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼›</li><li>ç¬¬ä¸‰æ­¥ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼›</li><li>ç¬¬å››æ­¥ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li></ul><blockquote><p>è¿™å—å…·ä½“è¿˜æ˜¯çœ‹<a href="https://xiaolincoding.com/redis/cluster/sentinel.html#%E6%AD%A5%E9%AA%A4%E4%B8%80-%E9%80%89%E5%87%BA%E6%96%B0%E4%B8%BB%E8%8A%82%E7%82%B9" target="_blank" rel="noopener noreferrer">https://xiaolincoding.com/redis/cluster/sentinel.html#æ­¥éª¤ä¸€-é€‰å‡ºæ–°ä¸»èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h4 id="å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„" tabindex="-1"><a class="header-anchor" href="#å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„" aria-hidden="true">#</a> å“¨å…µé›†ç¾¤æ˜¯å¦‚ä½•ç»„æˆçš„ï¼Ÿ</h4><p>å‰é¢æåˆ°äº† Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œé‚£å°±ä¸å¾—ä¸æä¸€ä¸‹å“¨å…µé›†ç¾¤çš„ç»„æˆæ–¹å¼ï¼Œå› ä¸ºå®ƒä¹Ÿç”¨åˆ°äº†è¿™ä¸ªæŠ€æœ¯ã€‚</p><p>åœ¨æˆ‘ç¬¬ä¸€æ¬¡æ­å»ºå“¨å…µé›†ç¾¤çš„æ—¶å€™ï¼Œå½“æ—¶è§‰å¾—å¾ˆè¯§å¼‚ã€‚å› ä¸ºåœ¨é…ç½®å“¨å…µçš„ä¿¡æ¯æ—¶ï¼Œç«Ÿç„¶åªéœ€è¦å¡«ä¸‹é¢è¿™å‡ ä¸ªå‚æ•°ï¼Œè®¾ç½®ä¸»èŠ‚ç‚¹åå­—ã€ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œç«¯å£å·ä»¥åŠ quorum å€¼ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>sentinel monitor <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>redis<span class="token operator">-</span>port<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>quorum<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸éœ€è¦å¡«å…¶ä»–å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæˆ‘å°±å¥½å¥‡å®ƒä»¬æ˜¯å¦‚ä½•æ„ŸçŸ¥å¯¹æ–¹çš„ï¼Œåˆæ˜¯å¦‚ä½•ç»„æˆå“¨å…µé›†ç¾¤çš„ï¼Ÿ</p><p>åé¢æ‰äº†è§£åˆ°ï¼Œ<strong>å“¨å…µèŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶æ¥ç›¸äº’å‘ç°çš„</strong>ã€‚</p><p>åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªåä¸º <code>__sentinel__:hello</code>çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚</p><p>åœ¨ä¸‹å›¾ä¸­ï¼Œå“¨å…µ A æŠŠè‡ªå·±çš„ IP åœ°å€å’Œç«¯å£çš„ä¿¡æ¯å‘å¸ƒåˆ° <code>__sentinel__:hello</code> é¢‘é“ä¸Šï¼Œå“¨å…µ B å’Œ C è®¢é˜…äº†è¯¥é¢‘é“ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œå“¨å…µ B å’Œ C å°±å¯ä»¥ä»è¿™ä¸ªé¢‘é“ç›´æ¥è·å–å“¨å…µ A çš„ IP åœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œå“¨å…µ Bã€C å¯ä»¥å’Œå“¨å…µ A å»ºç«‹ç½‘ç»œè¿æ¥ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714222643304-8ba18c1a.png" alt="image-20220714222643304" tabindex="0" loading="lazy"><figcaption>image-20220714222643304</figcaption></figure><p>é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œå“¨å…µ B å’Œ C ä¹Ÿå¯ä»¥å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå“¨å…µé›†ç¾¤å°±å½¢æˆäº†ã€‚</p><blockquote><p>å“¨å…µé›†ç¾¤ä¼šå¯¹ã€Œä»èŠ‚ç‚¹ã€çš„è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œé‚£å“¨å…µé›†ç¾¤å¦‚ä½•çŸ¥é“ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ï¼Ÿ</p></blockquote><p>ä¸»èŠ‚ç‚¹çŸ¥é“æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å“¨å…µä¼šæ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘ä¸»èŠ‚ç‚¹å‘é€ INFO å‘½ä»¤æ¥è·å–æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€çš„ä¿¡æ¯ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå“¨å…µ B ç»™ä¸»èŠ‚ç‚¹å‘é€ INFO å‘½ä»¤ï¼Œä¸»èŠ‚ç‚¹æ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæŠŠä»èŠ‚ç‚¹åˆ—è¡¨è¿”å›ç»™å“¨å…µã€‚æ¥ç€ï¼Œå“¨å…µå°±å¯ä»¥æ ¹æ®ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ï¼Œå’Œæ¯ä¸ªä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨è¿™ä¸ªè¿æ¥ä¸ŠæŒç»­åœ°å¯¹ä»èŠ‚ç‚¹è¿›è¡Œç›‘æ§ã€‚å“¨å…µ A å’Œ C å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ã€‚<img src="/Computer-Science-Learn-Notes/assets/image-20220714222836699-3dd94afb.png" alt="image-20220714222836699" loading="lazy"></p><p>æ­£å¼é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç›¸äº’æ„ŸçŸ¥ï¼Œç„¶åç»„æˆé›†ç¾¤ï¼ŒåŒæ—¶ï¼Œå“¨å…µåˆé€šè¿‡ INFO å‘½ä»¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹é‡Œè·å¾—äº†æ‰€æœ‰ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯ï¼Œäºæ˜¯å°±èƒ½å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p><h4 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1" aria-hidden="true">#</a> æ€»ç»“</h4><p>Redis åœ¨ 2.8 ç‰ˆæœ¬ä»¥åæä¾›çš„<strong>å“¨å…µï¼ˆ*Sentinel*ï¼‰æœºåˆ¶</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®ç°<strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»</strong>ã€‚å®ƒä¼šç›‘æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒå°±ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</p><p>å“¨å…µä¸€èˆ¬æ˜¯ä»¥é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²ï¼Œè‡³å°‘éœ€è¦ 3 ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œå“¨å…µé›†ç¾¤ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p><p>å“¨å…µèŠ‚ç‚¹é€šè¿‡ Redis çš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç›¸äº’æ„ŸçŸ¥ï¼Œç›¸äº’è¿æ¥ï¼Œç„¶åç»„æˆå“¨å…µé›†ç¾¤ï¼ŒåŒæ—¶å“¨å…µåˆé€šè¿‡ INFO å‘½ä»¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹é‡Œè·å¾—äº†æ‰€æœ‰ä»èŠ‚ç‚¹è¿æ¥ä¿¡æ¯ï¼Œäºæ˜¯å°±èƒ½å’Œä»èŠ‚ç‚¹å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p><p><em>1ã€ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿</em></p><p>å½“å“¨å…µé›†ç¾¤ä¸­çš„æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p><p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p><p><em>2ã€ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µleader</em></p><p>æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œè¯¥å“¨å…µå°±ä¼šå‘èµ·æŠ•ç¥¨ï¼Œå‘Šè¯‰å…¶ä»–å“¨å…µï¼Œå®ƒæƒ³æˆä¸º leaderï¼Œæƒ³æˆä¸º leader çš„å“¨å…µèŠ‚ç‚¹ï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li><li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li></ul><p><em>3ã€ç”±å“¨å…µ leader è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»</em></p><p>é€‰ä¸¾å‡ºäº†å“¨å…µ leader åï¼Œå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹äº†ã€‚è¯¥æ“ä½œåŒ…å«ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œé€‰æ‹©çš„è§„åˆ™ï¼š <ul><li>è¿‡æ»¤æ‰å·²ç»ç¦»çº¿çš„ä»èŠ‚ç‚¹ï¼›</li><li>è¿‡æ»¤æ‰å†å²ç½‘ç»œè¿æ¥çŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹ï¼›</li><li>å°†å‰©ä¸‹çš„ä»èŠ‚ç‚¹ï¼Œè¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚åœ¨æ¯ä¸€è½®è€ƒå¯Ÿè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªèƒœå‡ºçš„ä»èŠ‚ç‚¹ï¼Œå°±å°†å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</li></ul></li><li>ç¬¬äºŒæ­¥ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼›</li><li>ç¬¬ä¸‰æ­¥ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼›</li><li>ç¬¬å››æ­¥ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li></ul><h3 id="cluster-é›†ç¾¤-çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—" tabindex="-1"><a class="header-anchor" href="#cluster-é›†ç¾¤-çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—" aria-hidden="true">#</a> Clusterï¼ˆé›†ç¾¤ï¼‰çš„åŸç†ä½ èƒ½è®²ä¸€ä¸‹å—ï¼Ÿ</h3><p>å“¨å…µæ¨¡å¼è§£å†³äº†ä¸»ä»å¤åˆ¶ä¸èƒ½è‡ªåŠ¨æ•…éšœè½¬ç§»ã€è¾¾ä¸åˆ°é«˜å¯ç”¨çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯å­˜åœ¨ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›ã€å®¹é‡å—é™äºå•æœºé…ç½®çš„é—®é¢˜ã€‚è€Œclusteræ¨¡å¼å®ç°äº†Redisçš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸åŒçš„å†…å®¹ï¼Œè§£å†³ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›ã€å®¹é‡å—é™äºå•æœºé…ç½®çš„é—®é¢˜ã€‚</p><p>Redis clusteré›†ç¾¤èŠ‚ç‚¹æœ€å°é…ç½®6ä¸ªèŠ‚ç‚¹ä»¥ä¸Šï¼ˆ3ä¸»3ä»ï¼‰ï¼Œå…¶ä¸­ä¸»èŠ‚ç‚¹æä¾›è¯»å†™æ“ä½œï¼Œä»èŠ‚ç‚¹ä½œä¸ºå¤‡ç”¨èŠ‚ç‚¹ï¼Œä¸æä¾›è¯·æ±‚ï¼Œåªä½œä¸ºæ•…éšœè½¬ç§»ä½¿ç”¨ã€‚</p><p>Redis clusteré‡‡ç”¨<strong>è™šæ‹Ÿæ§½åˆ†åŒº</strong>ï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0ï½16383ä¸ªæ•´æ•°æ§½å†…ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/cluster_slots-139782bc.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><strong>å·¥ä½œåŸç†ï¼š</strong></p><ol><li>é€šè¿‡å“ˆå¸Œçš„æ–¹å¼ï¼Œå°†æ•°æ®åˆ†ç‰‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡åˆ†å­˜å‚¨ä¸€å®šå“ˆå¸Œæ§½(å“ˆå¸Œå€¼)åŒºé—´çš„æ•°æ®ï¼Œé»˜è®¤åˆ†é…äº†16384 ä¸ªæ§½ä½</li><li>æ¯ä»½æ•°æ®åˆ†ç‰‡ä¼šå­˜å‚¨åœ¨å¤šä¸ªäº’ä¸ºä¸»ä»çš„å¤šèŠ‚ç‚¹ä¸Š</li><li>æ•°æ®å†™å…¥å…ˆå†™ä¸»èŠ‚ç‚¹ï¼Œå†åŒæ­¥åˆ°ä»èŠ‚ç‚¹(æ”¯æŒé…ç½®ä¸ºé˜»å¡åŒæ­¥)</li><li>åŒä¸€åˆ†ç‰‡å¤šä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸ä¿æŒä¸€è‡´æ€§</li><li>è¯»å–æ•°æ®æ—¶ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œçš„keyæ²¡æœ‰åˆ†é…åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ—¶ï¼Œredisä¼šè¿”å›è½¬å‘æŒ‡ä»¤ï¼ŒæŒ‡å‘æ­£ç¡®çš„èŠ‚ç‚¹</li><li>æ‰©å®¹æ—¶æ—¶éœ€è¦éœ€è¦æŠŠæ—§èŠ‚ç‚¹çš„æ•°æ®è¿ç§»ä¸€éƒ¨åˆ†åˆ°æ–°èŠ‚ç‚¹</li></ol><p>åœ¨ redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ 1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚</p><p>16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œ<code>gossip</code> åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ— ä¸­å¿ƒæ¶æ„ï¼Œ<strong>æ”¯æŒåŠ¨æ€æ‰©</strong>å®¹ï¼›</li><li>æ•°æ®æŒ‰ç…§ <code>slot</code>å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é—´æ•°æ®å…±äº«ï¼Œ<strong>å¯åŠ¨æ€è°ƒæ•´æ•°æ®åˆ†å¸ƒ</strong>ï¼›</li><li><strong>é«˜å¯ç”¨æ€§</strong>ã€‚éƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œé›†ç¾¤ä»å¯ç”¨ã€‚é›†ç¾¤æ¨¡å¼èƒ½å¤Ÿå®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰ï¼ŒèŠ‚ç‚¹ä¹‹é—´é€šè¿‡ <code>gossip</code>åè®®äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æŠ•ç¥¨æœºåˆ¶å®Œæˆ <code>Slave</code>åˆ° <code>Master</code>çš„è§’è‰²è½¬æ¢ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li><strong>ä¸æ”¯æŒæ‰¹é‡æ“ä½œ</strong>ï¼ˆpipelineï¼‰ã€‚</li><li>æ•°æ®é€šè¿‡å¼‚æ­¥å¤åˆ¶ï¼Œ<strong>ä¸ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§</strong>ã€‚</li><li><strong>äº‹åŠ¡æ“ä½œæ”¯æŒæœ‰é™</strong>ï¼Œåªæ”¯æŒå¤š <code>key</code>åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šçš„äº‹åŠ¡æ“ä½œï¼Œå½“å¤šä¸ª <code>key</code>åˆ†å¸ƒäºä¸åŒçš„èŠ‚ç‚¹ä¸Šæ—¶æ— æ³•ä½¿ç”¨äº‹åŠ¡åŠŸèƒ½ã€‚</li><li><code>key</code>ä½œä¸ºæ•°æ®åˆ†åŒºçš„æœ€å°ç²’åº¦ï¼Œä¸èƒ½å°†ä¸€ä¸ªå¾ˆå¤§çš„é”®å€¼å¯¹è±¡å¦‚ <code>hash</code>ã€<code>list</code>ç­‰æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚</li><li><strong>ä¸æ”¯æŒå¤šæ•°æ®åº“ç©ºé—´</strong>ï¼Œå•æœºä¸‹çš„Rediså¯ä»¥æ”¯æŒåˆ°16ä¸ªæ•°æ®åº“ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹åªèƒ½ä½¿ç”¨1ä¸ªæ•°æ®åº“ç©ºé—´ã€‚</li><li>åªèƒ½ä½¿ç”¨0å·æ•°æ®åº“ã€‚</li></ul><p><strong>å“ˆå¸Œåˆ†åŒºç®—æ³•æœ‰å“ªäº›ï¼Ÿ</strong></p><p>èŠ‚ç‚¹å–ä½™åˆ†åŒºã€‚ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ï¼Œå¦‚Redisçš„é”®æˆ–ç”¨æˆ·IDï¼Œå¯¹èŠ‚ç‚¹æ•°é‡Nå–ä½™ï¼šhashï¼ˆkeyï¼‰%Nè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ ä¼˜ç‚¹æ˜¯ç®€å•æ€§ã€‚æ‰©å®¹æ—¶é€šå¸¸é‡‡ç”¨ç¿»å€æ‰©å®¹ï¼Œé¿å…æ•°æ®æ˜ å°„å…¨éƒ¨è¢«æ‰“ä¹±å¯¼è‡´å…¨é‡è¿ç§»çš„æƒ…å†µã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒºã€‚ä¸ºç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªtokenï¼ŒèŒƒå›´ä¸€èˆ¬åœ¨0~232ï¼Œè¿™äº›tokenæ„æˆä¸€ä¸ªå“ˆå¸Œç¯ã€‚æ•°æ®è¯»å†™æ‰§è¡ŒèŠ‚ç‚¹æŸ¥æ‰¾æ“ä½œæ—¶ï¼Œå…ˆæ ¹æ®keyè®¡ç®—hashå€¼ï¼Œç„¶åé¡ºæ—¶é’ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¯¥å“ˆå¸Œå€¼çš„tokenèŠ‚ç‚¹ã€‚ è¿™ç§æ–¹å¼ç›¸æ¯”èŠ‚ç‚¹å–ä½™æœ€å¤§çš„å¥½å¤„åœ¨äºåŠ å…¥å’Œåˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå¸Œç¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚</p><p>è™šæ‹Ÿæ§½åˆ†åŒºï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0~16383æ•´æ•°æ§½å†…ï¼Œè®¡ç®—å…¬å¼ï¼šslot=CRC16ï¼ˆkeyï¼‰&amp;16383ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚<strong>Redis Cluseré‡‡ç”¨è™šæ‹Ÿæ§½åˆ†åŒºç®—æ³•ã€‚</strong></p><blockquote><p>è¯¦ç»†è¯´æ˜</p></blockquote><ul><li>è‡ªåŠ¨å°†æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œæ¯ä¸ª master ä¸Šæ”¾ä¸€éƒ¨åˆ†æ•°æ®</li><li>æä¾›å†…ç½®çš„é«˜å¯ç”¨æ”¯æŒï¼Œéƒ¨åˆ† master ä¸å¯ç”¨æ—¶ï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­å·¥ä½œçš„</li></ul><p>åœ¨ Redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª Redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ  1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚</p><p>16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œ <code>gossip</code> åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚</p><h4 id="èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶" aria-hidden="true">#</a> èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶</h4><h5 id="åŸºæœ¬é€šä¿¡åŸç†" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬é€šä¿¡åŸç†" aria-hidden="true">#</a> åŸºæœ¬é€šä¿¡åŸç†</h5><p>é›†ç¾¤å…ƒæ•°æ®çš„ç»´æŠ¤æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼ã€Gossip åè®®ã€‚Redis cluster èŠ‚ç‚¹é—´é‡‡ç”¨ gossip åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p><strong>é›†ä¸­å¼</strong>æ˜¯å°†é›†ç¾¤å…ƒæ•°æ®ï¼ˆèŠ‚ç‚¹ä¿¡æ¯ã€æ•…éšœç­‰ç­‰ï¼‰é›†ä¸­å­˜å‚¨åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚é›†ä¸­å¼å…ƒæ•°æ®é›†ä¸­å­˜å‚¨çš„ä¸€ä¸ªå…¸å‹ä»£è¡¨ï¼Œå°±æ˜¯å¤§æ•°æ®é¢†åŸŸçš„ <code>storm</code> ã€‚å®ƒæ˜¯åˆ†å¸ƒå¼çš„å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ï¼Œæ˜¯é›†ä¸­å¼çš„å…ƒæ•°æ®å­˜å‚¨çš„ç»“æ„ï¼Œåº•å±‚åŸºäº zookeeperï¼ˆåˆ†å¸ƒå¼åè°ƒçš„ä¸­é—´ä»¶ï¼‰å¯¹æ‰€æœ‰å…ƒæ•°æ®è¿›è¡Œå­˜å‚¨ç»´æŠ¤ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715143320253-6ecd6d24.png" alt="image-20220715143320253" tabindex="0" loading="lazy"><figcaption>image-20220715143320253</figcaption></figure><p>Redis ç»´æŠ¤é›†ç¾¤å…ƒæ•°æ®é‡‡ç”¨å¦ä¸€ä¸ªæ–¹å¼ï¼Œ <code>gossip</code> åè®®ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æŒæœ‰ä¸€ä»½å…ƒæ•°æ®ï¼Œä¸åŒçš„èŠ‚ç‚¹å¦‚æœå‡ºç°äº†å…ƒæ•°æ®çš„å˜æ›´ï¼Œå°±ä¸æ–­å°†å…ƒæ•°æ®å‘é€ç»™å…¶å®ƒçš„èŠ‚ç‚¹ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹ä¹Ÿè¿›è¡Œå…ƒæ•°æ®çš„å˜æ›´ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715143327361-c0dfd188.png" alt="image-20220715143327361" tabindex="0" loading="lazy"><figcaption>image-20220715143327361</figcaption></figure><p><strong>é›†ä¸­å¼</strong>çš„<strong>å¥½å¤„</strong>åœ¨äºï¼Œå…ƒæ•°æ®çš„è¯»å–å’Œæ›´æ–°ï¼Œæ—¶æ•ˆæ€§éå¸¸å¥½ï¼Œä¸€æ—¦å…ƒæ•°æ®å‡ºç°äº†å˜æ›´ï¼Œå°±ç«‹å³æ›´æ–°åˆ°é›†ä¸­å¼çš„å­˜å‚¨ä¸­ï¼Œå…¶å®ƒèŠ‚ç‚¹è¯»å–çš„æ—¶å€™å°±å¯ä»¥æ„ŸçŸ¥åˆ°ï¼›<strong>ä¸å¥½</strong>åœ¨äºï¼Œæ‰€æœ‰çš„å…ƒæ•°æ®çš„æ›´æ–°å‹åŠ›å…¨éƒ¨é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒæ•°æ®çš„å­˜å‚¨æœ‰å‹åŠ›ã€‚</p><p>gossip å¥½å¤„åœ¨äºï¼Œå…ƒæ•°æ®çš„æ›´æ–°æ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ˜¯é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ›´æ–°è¯·æ±‚ä¼šé™†é™†ç»­ç»­æ‰“åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šå»æ›´æ–°ï¼Œé™ä½äº†å‹åŠ›ï¼›ä¸å¥½åœ¨äºï¼Œå…ƒæ•°æ®çš„æ›´æ–°æœ‰å»¶æ—¶ï¼Œå¯èƒ½å¯¼è‡´é›†ç¾¤ä¸­çš„ä¸€äº›æ“ä½œä¼šæœ‰ä¸€äº›æ»åã€‚</p><ul><li>10000 ç«¯å£ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºèŠ‚ç‚¹é—´é€šä¿¡çš„ç«¯å£ï¼Œå°±æ˜¯è‡ªå·±æä¾›æœåŠ¡çš„ç«¯å£å·+10000ï¼Œæ¯”å¦‚ 7001ï¼Œé‚£ä¹ˆç”¨äºèŠ‚ç‚¹é—´é€šä¿¡çš„å°±æ˜¯ 17001 ç«¯å£ã€‚æ¯ä¸ªèŠ‚ç‚¹æ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå¾€å¦å¤–å‡ ä¸ªèŠ‚ç‚¹å‘é€ <code>ping</code> æ¶ˆæ¯ï¼ŒåŒæ—¶å…¶å®ƒå‡ ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ° <code>ping</code> ä¹‹åè¿”å› <code>pong</code> ã€‚</li><li>äº¤æ¢çš„ä¿¡æ¯ï¼šä¿¡æ¯åŒ…æ‹¬æ•…éšœä¿¡æ¯ï¼ŒèŠ‚ç‚¹çš„å¢åŠ å’Œåˆ é™¤ï¼Œhash slot ä¿¡æ¯ç­‰ç­‰ã€‚</li></ul><h5 id="gossip-åè®®" tabindex="-1"><a class="header-anchor" href="#gossip-åè®®" aria-hidden="true">#</a> gossip åè®®</h5><p>gossip åè®®åŒ…å«å¤šç§æ¶ˆæ¯ï¼ŒåŒ…å« <code>ping</code> , <code>pong</code> , <code>meet</code> , <code>fail</code> ç­‰ç­‰ã€‚</p><ul><li>meetï¼šæŸä¸ªèŠ‚ç‚¹å‘é€ meet ç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œè®©æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ï¼Œç„¶åæ–°èŠ‚ç‚¹å°±ä¼šå¼€å§‹ä¸å…¶å®ƒèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Redis-trib.rb add-node
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶å®å†…éƒ¨å°±æ˜¯å‘é€äº†ä¸€ä¸ª gossip meet æ¶ˆæ¯ç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œé€šçŸ¥é‚£ä¸ªèŠ‚ç‚¹å»åŠ å…¥æˆ‘ä»¬çš„é›†ç¾¤ã€‚</p><ul><li>pingï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šé¢‘ç¹ç»™å…¶å®ƒèŠ‚ç‚¹å‘é€ pingï¼Œå…¶ä¸­åŒ…å«è‡ªå·±çš„çŠ¶æ€è¿˜æœ‰è‡ªå·±ç»´æŠ¤çš„é›†ç¾¤å…ƒæ•°æ®ï¼Œäº’ç›¸é€šè¿‡ ping äº¤æ¢å…ƒæ•°æ®ã€‚</li><li>pongï¼šè¿”å› ping å’Œ meetï¼ŒåŒ…å«è‡ªå·±çš„çŠ¶æ€å’Œå…¶å®ƒä¿¡æ¯ï¼Œä¹Ÿç”¨äºä¿¡æ¯å¹¿æ’­å’Œæ›´æ–°ã€‚</li><li>failï¼šæŸä¸ªèŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªèŠ‚ç‚¹ fail ä¹‹åï¼Œå°±å‘é€ fail ç»™å…¶å®ƒèŠ‚ç‚¹ï¼Œé€šçŸ¥å…¶å®ƒèŠ‚ç‚¹è¯´ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºå•¦ã€‚</li></ul><h5 id="ping-æ¶ˆæ¯æ·±å…¥" tabindex="-1"><a class="header-anchor" href="#ping-æ¶ˆæ¯æ·±å…¥" aria-hidden="true">#</a> ping æ¶ˆæ¯æ·±å…¥</h5><p>ping æ—¶è¦æºå¸¦ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚æœå¾ˆé¢‘ç¹ï¼Œå¯èƒ½ä¼šåŠ é‡ç½‘ç»œè´Ÿæ‹…ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹æ¯ç§’ä¼šæ‰§è¡Œ 10 æ¬¡ pingï¼Œæ¯æ¬¡ä¼šé€‰æ‹© 5 ä¸ªæœ€ä¹…æ²¡æœ‰é€šä¿¡çš„å…¶å®ƒèŠ‚ç‚¹ã€‚å½“ç„¶å¦‚æœå‘ç°æŸä¸ªèŠ‚ç‚¹é€šä¿¡å»¶æ—¶è¾¾åˆ°äº† <code>cluster_node_timeout / 2</code> ï¼Œé‚£ä¹ˆç«‹å³å‘é€ pingï¼Œé¿å…æ•°æ®äº¤æ¢å»¶æ—¶è¿‡é•¿ï¼Œè½åçš„æ—¶é—´å¤ªé•¿äº†ã€‚æ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½ 10 åˆ†é’Ÿæ²¡æœ‰äº¤æ¢æ•°æ®äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å¤„äºä¸¥é‡çš„å…ƒæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå°±ä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥ <code>cluster_node_timeout</code> å¯ä»¥è°ƒèŠ‚ï¼Œå¦‚æœè°ƒå¾—æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆä¼šé™ä½ ping çš„é¢‘ç‡ã€‚</p><p>æ¯æ¬¡ pingï¼Œä¼šå¸¦ä¸Šè‡ªå·±èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æœ‰å°±æ˜¯å¸¦ä¸Š 1/10 å…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå‘é€å‡ºå»ï¼Œè¿›è¡Œäº¤æ¢ã€‚è‡³å°‘åŒ…å« <code>3</code> ä¸ªå…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæœ€å¤šåŒ…å« <code>æ€»èŠ‚ç‚¹æ•°å‡ 2</code> ä¸ªå…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><h4 id="åˆ†å¸ƒå¼å¯»å€ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼å¯»å€ç®—æ³•" aria-hidden="true">#</a> åˆ†å¸ƒå¼å¯»å€ç®—æ³•</h4><ul><li>hash ç®—æ³•ï¼ˆå¤§é‡ç¼“å­˜é‡å»ºï¼‰</li><li>ä¸€è‡´æ€§ hash ç®—æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜è¿ç§»ï¼‰+ è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰</li><li>Redis cluster çš„ hash slot ç®—æ³•</li></ul><h5 id="hash-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#hash-ç®—æ³•" aria-hidden="true">#</a> hash ç®—æ³•</h5><p>æ¥äº†ä¸€ä¸ª keyï¼Œé¦–å…ˆè®¡ç®— hash å€¼ï¼Œç„¶åå¯¹èŠ‚ç‚¹æ•°å–æ¨¡ã€‚ç„¶åæ‰“åœ¨ä¸åŒçš„ master èŠ‚ç‚¹ä¸Šã€‚ä¸€æ—¦æŸä¸€ä¸ª master èŠ‚ç‚¹å®•æœºï¼Œæ‰€æœ‰è¯·æ±‚è¿‡æ¥ï¼Œéƒ½ä¼šåŸºäºæœ€æ–°çš„å‰©ä½™ master èŠ‚ç‚¹æ•°å»å–æ¨¡ï¼Œå°è¯•å»å–æ•°æ®ã€‚è¿™ä¼šå¯¼è‡´<strong>å¤§éƒ¨åˆ†çš„è¯·æ±‚è¿‡æ¥ï¼Œå…¨éƒ¨æ— æ³•æ‹¿åˆ°æœ‰æ•ˆçš„ç¼“å­˜</strong>ï¼Œå¯¼è‡´å¤§é‡çš„æµé‡æ¶Œå…¥æ•°æ®åº“ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715143507698-8ae0acbf.png" alt="image-20220715143507698" tabindex="0" loading="lazy"><figcaption>image-20220715143507698</figcaption></figure><h5 id="ä¸€è‡´æ€§-hash-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´æ€§-hash-ç®—æ³•" aria-hidden="true">#</a> ä¸€è‡´æ€§ hash ç®—æ³•</h5><p>ä¸€è‡´æ€§ hash ç®—æ³•å°†æ•´ä¸ª hash å€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œæ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œä¸‹ä¸€æ­¥å°†å„ä¸ª master èŠ‚ç‚¹ï¼ˆä½¿ç”¨æœåŠ¡å™¨çš„ ip æˆ–ä¸»æœºåï¼‰è¿›è¡Œ hashã€‚è¿™æ ·å°±èƒ½ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹åœ¨å…¶å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚</p><p>æ¥äº†ä¸€ä¸ª keyï¼Œé¦–å…ˆè®¡ç®— hash å€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯<strong>é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€</strong>ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹å°±æ˜¯ key æ‰€åœ¨ä½ç½®ã€‚</p><p>åœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤èŠ‚ç‚¹åˆ°ç¯ç©ºé—´å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¹‹é—´çš„æ•°æ®ï¼Œå…¶å®ƒä¸å—å½±å“ã€‚å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ä¹ŸåŒç†ã€‚</p><p>ç‡ƒé¹…ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆ<strong>ç¼“å­˜çƒ­ç‚¹</strong>çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ç§çƒ­ç‚¹é—®é¢˜ï¼Œä¸€è‡´æ€§ hash ç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹è®¡ç®—å¤šä¸ª hashï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚è¿™æ ·å°±å®ç°äº†æ•°æ®çš„å‡åŒ€åˆ†å¸ƒï¼Œè´Ÿè½½å‡è¡¡ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715143520445-6b7dfb84.png" alt="image-20220715143520445" tabindex="0" loading="lazy"><figcaption>image-20220715143520445</figcaption></figure><h5 id="redis-cluster-çš„-hash-slot-ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#redis-cluster-çš„-hash-slot-ç®—æ³•" aria-hidden="true">#</a> Redis cluster çš„ hash slot ç®—æ³•</h5><p>Redis cluster æœ‰å›ºå®šçš„ <code>16384</code> ä¸ª hash slotï¼Œå¯¹æ¯ä¸ª <code>key</code> è®¡ç®— <code>CRC16</code> å€¼ï¼Œç„¶åå¯¹ <code>16384</code> å–æ¨¡ï¼Œå¯ä»¥è·å– key å¯¹åº”çš„ hash slotã€‚</p><p>Redis cluster ä¸­æ¯ä¸ª master éƒ½ä¼šæŒæœ‰éƒ¨åˆ† slotï¼Œæ¯”å¦‚æœ‰ 3 ä¸ª masterï¼Œé‚£ä¹ˆå¯èƒ½æ¯ä¸ª master æŒæœ‰ 5000 å¤šä¸ª hash slotã€‚hash slot è®© node çš„å¢åŠ å’Œç§»é™¤å¾ˆç®€å•ï¼Œå¢åŠ ä¸€ä¸ª masterï¼Œå°±å°†å…¶ä»– master çš„ hash slot ç§»åŠ¨éƒ¨åˆ†è¿‡å»ï¼Œå‡å°‘ä¸€ä¸ª masterï¼Œå°±å°†å®ƒçš„ hash slot ç§»åŠ¨åˆ°å…¶ä»– master ä¸Šå»ã€‚ç§»åŠ¨ hash slot çš„æˆæœ¬æ˜¯éå¸¸ä½çš„ã€‚å®¢æˆ·ç«¯çš„ apiï¼Œå¯ä»¥å¯¹æŒ‡å®šçš„æ•°æ®ï¼Œè®©ä»–ä»¬èµ°åŒä¸€ä¸ª hash slotï¼Œé€šè¿‡ <code>hash tag</code> æ¥å®ç°ã€‚</p><p>ä»»ä½•ä¸€å°æœºå™¨å®•æœºï¼Œå¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸å½±å“çš„ã€‚å› ä¸º key æ‰¾çš„æ˜¯ hash slotï¼Œä¸æ˜¯æœºå™¨ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715143532988-7608d568.png" alt="image-20220715143532988" tabindex="0" loading="lazy"><figcaption>image-20220715143532988</figcaption></figure><h4 id="redis-cluster-çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†" tabindex="-1"><a class="header-anchor" href="#redis-cluster-çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†" aria-hidden="true">#</a> Redis cluster çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†</h4><p>Redis cluster çš„é«˜å¯ç”¨çš„åŸç†ï¼Œå‡ ä¹è·Ÿå“¨å…µæ˜¯ç±»ä¼¼çš„ã€‚</p><h5 id="åˆ¤æ–­èŠ‚ç‚¹å®•æœº" tabindex="-1"><a class="header-anchor" href="#åˆ¤æ–­èŠ‚ç‚¹å®•æœº" aria-hidden="true">#</a> åˆ¤æ–­èŠ‚ç‚¹å®•æœº</h5><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆå°±æ˜¯ <code>pfail</code> ï¼Œ<strong>ä¸»è§‚å®•æœº</strong>ã€‚å¦‚æœå¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>fail</code> ï¼Œ<strong>å®¢è§‚å®•æœº</strong>ï¼Œè·Ÿå“¨å…µçš„åŸç†å‡ ä¹ä¸€æ ·ï¼Œsdownï¼Œodownã€‚</p><p>åœ¨ <code>cluster-node-timeout</code> å†…ï¼ŒæŸä¸ªèŠ‚ç‚¹ä¸€ç›´æ²¡æœ‰è¿”å› <code>pong</code> ï¼Œé‚£ä¹ˆå°±è¢«è®¤ä¸º <code>pfail</code> ã€‚</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºæŸä¸ªèŠ‚ç‚¹ <code>pfail</code> äº†ï¼Œé‚£ä¹ˆä¼šåœ¨ <code>gossip ping</code> æ¶ˆæ¯ä¸­ï¼Œ <code>ping</code> ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¦‚æœ<strong>è¶…è¿‡åŠæ•°</strong>çš„èŠ‚ç‚¹éƒ½è®¤ä¸º <code>pfail</code> äº†ï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆ <code>fail</code> ã€‚</p><h5 id="ä»èŠ‚ç‚¹è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#ä»èŠ‚ç‚¹è¿‡æ»¤" aria-hidden="true">#</a> ä»èŠ‚ç‚¹è¿‡æ»¤</h5><p>å¯¹å®•æœºçš„ master nodeï¼Œä»å…¶æ‰€æœ‰çš„ slave node ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªåˆ‡æ¢æˆ master nodeã€‚</p><p>æ£€æŸ¥æ¯ä¸ª slave node ä¸ master node æ–­å¼€è¿æ¥çš„æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº† <code>cluster-node-timeout * cluster-slave-validity-factor</code> ï¼Œé‚£ä¹ˆå°±<strong>æ²¡æœ‰èµ„æ ¼</strong>åˆ‡æ¢æˆ <code>master</code> ã€‚</p><h5 id="ä»èŠ‚ç‚¹é€‰ä¸¾" tabindex="-1"><a class="header-anchor" href="#ä»èŠ‚ç‚¹é€‰ä¸¾" aria-hidden="true">#</a> ä»èŠ‚ç‚¹é€‰ä¸¾</h5><p>æ¯ä¸ªä»èŠ‚ç‚¹ï¼Œéƒ½æ ¹æ®è‡ªå·±å¯¹ master å¤åˆ¶æ•°æ®çš„ offsetï¼Œæ¥è®¾ç½®ä¸€ä¸ªé€‰ä¸¾æ—¶é—´ï¼Œoffset è¶Šå¤§ï¼ˆå¤åˆ¶æ•°æ®è¶Šå¤šï¼‰çš„ä»èŠ‚ç‚¹ï¼Œé€‰ä¸¾æ—¶é—´è¶Šé å‰ï¼Œä¼˜å…ˆè¿›è¡Œé€‰ä¸¾ã€‚</p><p>æ‰€æœ‰çš„ master node å¼€å§‹ slave é€‰ä¸¾æŠ•ç¥¨ï¼Œç»™è¦è¿›è¡Œé€‰ä¸¾çš„ slave è¿›è¡ŒæŠ•ç¥¨ï¼Œå¦‚æœå¤§éƒ¨åˆ† master node <code>ï¼ˆN/2 + 1ï¼‰</code> éƒ½æŠ•ç¥¨ç»™äº†æŸä¸ªä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé€‰ä¸¾é€šè¿‡ï¼Œé‚£ä¸ªä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆ masterã€‚</p><p>ä»èŠ‚ç‚¹æ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><h5 id="ä¸å“¨å…µæ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#ä¸å“¨å…µæ¯”è¾ƒ" aria-hidden="true">#</a> ä¸å“¨å…µæ¯”è¾ƒ</h5><p>æ•´ä¸ªæµç¨‹è·Ÿå“¨å…µç›¸æ¯”ï¼Œéå¸¸ç±»ä¼¼ï¼Œæ‰€ä»¥è¯´ï¼ŒRedis cluster åŠŸèƒ½å¼ºå¤§ï¼Œç›´æ¥é›†æˆäº† replication å’Œ sentinel çš„åŠŸèƒ½ã€‚</p><h3 id="â­mysql-å’Œ-redis-æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#â­mysql-å’Œ-redis-æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´" aria-hidden="true">#</a> â­MySQL å’Œ Redis æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´?</h3><p>å¯¹äºç¼“å­˜å’Œæ•°æ®åº“çš„æ“ä½œï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€‚</p><h4 id="å…ˆåˆ ç¼“å­˜-å†æ›´æ–°æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#å…ˆåˆ ç¼“å­˜-å†æ›´æ–°æ•°æ®åº“" aria-hidden="true">#</a> å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h4><p>ä¸¾ä¸ª ğŸŒ° å‡è®¾æŸä¸ªç”¨æˆ·çš„å¹´é¾„æ˜¯ 20ï¼Œè¯·æ±‚ A è¦æ›´æ–°ç”¨æˆ·å¹´é¾„ä¸º 21ï¼Œæ‰€ä»¥å®ƒä¼šåˆ é™¤ç¼“å­˜ä¸­çš„å†…å®¹ã€‚è¿™æ—¶ï¼Œå¦ä¸€ä¸ªè¯·æ±‚ B è¦è¯»å–è¿™ä¸ªç”¨æˆ·çš„å¹´é¾„ï¼Œå®ƒæŸ¥è¯¢ç¼“å­˜å‘ç°æœªå‘½ä¸­åï¼Œä¼šä»æ•°æ®åº“ä¸­è¯»å–åˆ°å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åè¯·æ±‚ A ç»§ç»­æ›´æ”¹æ•°æ®åº“ï¼Œå°†ç”¨æˆ·çš„å¹´é¾„æ›´æ–°ä¸º 21ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220714102354617-14a61a48.png" alt="image-20220715152802050" tabindex="0" loading="lazy"><figcaption>image-20220715152802050</figcaption></figure><p>æœ€ç»ˆï¼Œè¯¥ç”¨æˆ·å¹´é¾„åœ¨ç¼“å­˜ä¸­æ˜¯ 20ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 21ï¼ˆæ–°å€¼ï¼‰ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œåœ¨ã€Œè¯» + å†™ã€å¹¶å‘çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</strong>ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆ-å»¶æ—¶åŒåˆ " tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-å»¶æ—¶åŒåˆ " aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ:å»¶æ—¶åŒåˆ </h5><p>å»¶æ—¶åŒåˆ çš„æ–¹æ¡ˆçš„æ€è·¯æ˜¯ï¼Œä¸ºäº†é¿å…æ›´æ–°æ•°æ®åº“çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä»ç¼“å­˜ä¸­è¯»å–ä¸åˆ°æ•°æ®ï¼Œå°±åœ¨æ›´æ–°å®Œæ•°æ®åº“ä¹‹åï¼Œå†sleepä¸€æ®µæ—¶é—´ï¼Œç„¶åå†æ¬¡åˆ é™¤ç¼“å­˜ã€‚</p><p>sleepçš„æ—¶é—´è¦å¯¹ä¸šåŠ¡è¯»å†™ç¼“å­˜çš„æ—¶é—´åšå‡ºè¯„ä¼°ï¼Œsleepæ—¶é—´å¤§äºè¯»å†™ç¼“å­˜çš„æ—¶é—´å³å¯ã€‚</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>çº¿ç¨‹1åˆ é™¤ç¼“å­˜ï¼Œç„¶åå»æ›´æ–°æ•°æ®åº“</li><li>çº¿ç¨‹2æ¥è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–ï¼Œè¿™æ—¶å€™ç”±äºçº¿ç¨‹1è¿˜æ²¡æœ‰æ›´æ–°å®Œæˆï¼Œæ‰€ä»¥è¯»åˆ°çš„æ˜¯æ—§å€¼ï¼Œç„¶åæŠŠæ—§å€¼å†™å…¥ç¼“å­˜</li><li>çº¿ç¨‹1ï¼Œæ ¹æ®ä¼°ç®—çš„æ—¶é—´ï¼Œsleepï¼Œç”±äºsleepçš„æ—¶é—´å¤§äºçº¿ç¨‹2è¯»æ•°æ®+å†™ç¼“å­˜çš„æ—¶é—´ï¼Œæ‰€ä»¥ç¼“å­˜è¢«å†æ¬¡åˆ é™¤</li><li>å¦‚æœè¿˜æœ‰å…¶ä»–çº¿ç¨‹æ¥è¯»å–ç¼“å­˜çš„è¯ï¼Œå°±ä¼šå†æ¬¡ä»æ•°æ®åº“ä¸­è¯»å–åˆ°æœ€æ–°å€¼</li></ol><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715152925965-ef71b1ad.png" alt="image-20220715152925965" tabindex="0" loading="lazy"><figcaption>image-20220715152925965</figcaption></figure><h4 id="å…ˆæ›´æ–°æ•°æ®åº“-å†åˆ é™¤ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#å…ˆæ›´æ–°æ•°æ®åº“-å†åˆ é™¤ç¼“å­˜" aria-hidden="true">#</a> å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</h4><p>ç»§ç»­ç”¨ã€Œè¯» + å†™ã€è¯·æ±‚çš„å¹¶å‘çš„åœºæ™¯æ¥åˆ†æã€‚</p><p>å‡å¦‚æŸä¸ªç”¨æˆ·æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œè¯·æ±‚ A è¯»å–æ•°æ®æ—¶ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¹´é¾„ä¸º 20ï¼Œåœ¨æœªå†™å…¥ç¼“å­˜ä¸­æ—¶å¦ä¸€ä¸ªè¯·æ±‚ B æ›´æ–°æ•°æ®ã€‚å®ƒæ›´æ–°æ•°æ®åº“ä¸­çš„å¹´é¾„ä¸º 21ï¼Œå¹¶ä¸”æ¸…ç©ºç¼“å­˜ã€‚è¿™æ—¶è¯·æ±‚ A æŠŠä»æ•°æ®åº“ä¸­è¯»åˆ°çš„å¹´é¾„ä¸º 20 çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚<img src="/Computer-Science-Learn-Notes/assets/image-20220715152956657-fe3cf128.png" alt="image-20220715152956657" loading="lazy"></p><p>æœ€ç»ˆï¼Œè¯¥ç”¨æˆ·å¹´é¾„åœ¨ç¼“å­˜ä¸­æ˜¯ 20ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 21ï¼ˆæ–°å€¼ï¼‰ï¼Œç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä»ä¸Šé¢çš„ç†è®ºä¸Šåˆ†æï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ä¹Ÿæ˜¯ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œ<strong>ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„æ¦‚ç‡å¹¶ä¸é«˜</strong>ã€‚</p><p><strong>å› ä¸ºç¼“å­˜çš„å†™å…¥é€šå¸¸è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥</strong>ï¼Œæ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”åˆ é™¤äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚</p><p>è€Œä¸€æ—¦è¯·æ±‚ A æ—©äºè¯·æ±‚ B åˆ é™¤ç¼“å­˜ä¹‹å‰æ›´æ–°äº†ç¼“å­˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„è¯·æ±‚å°±ä¼šå› ä¸ºç¼“å­˜ä¸å‘½ä¸­è€Œä»æ•°æ®åº“ä¸­é‡æ–°è¯»å–æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°è¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>ã€Œå…ˆæ›´æ–°æ•°æ®åº“ + å†åˆ é™¤ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œæ˜¯å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„</strong>ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆ1-æ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ1-æ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ1:æ¶ˆæ¯é˜Ÿåˆ—</h5><p>è¿™æ˜¯ç½‘ä¸Šå¾ˆå¤šæ–‡ç« é‡Œéƒ½æœ‰å†™è¿‡çš„æ–¹æ¡ˆã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºé™·ä¼šæ›´æ˜æ˜¾ä¸€ç‚¹ã€‚</p><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåå¾€æ¶ˆæ¯é˜Ÿåˆ—å‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹åˆ°æ¶ˆæ¯åå†åˆ é™¤ç¼“å­˜ï¼Œå€ŸåŠ©æ¶ˆæ¯é˜Ÿåˆ—çš„é‡è¯•æœºåˆ¶æ¥å®ç°ï¼Œè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§çš„æ•ˆæœã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715153053443-219b24d0.png" alt="image-20220715153053443" tabindex="0" loading="lazy"><figcaption>image-20220715153053443</figcaption></figure><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆå…¶å®é—®é¢˜æ›´å¤šã€‚</p><ol><li>å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹åï¼Œé—®é¢˜æ›´å¤æ‚äº†ï¼Œæ€ä¹ˆä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±æ›´éº»çƒ¦</li><li>å°±ç®—æ›´æ–°æ•°æ®åº“å’Œåˆ é™¤ç¼“å­˜éƒ½æ²¡æœ‰å‘ç”Ÿé—®é¢˜ï¼Œæ¶ˆæ¯çš„å»¶è¿Ÿä¹Ÿä¼šå¸¦æ¥çŸ­æš‚çš„ä¸ä¸€è‡´æ€§ï¼Œä¸è¿‡è¿™ä¸ªå»¶è¿Ÿç›¸å¯¹æ¥è¯´è¿˜æ˜¯å¯ä»¥æ¥å—çš„</li></ol><h5 id="è§£å†³æ–¹æ¡ˆ2-è¿›é˜¶ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ2-è¿›é˜¶ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ2:è¿›é˜¶ç‰ˆæ¶ˆæ¯é˜Ÿåˆ—</h5><p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜å•ç‹¬å¼•å…¥ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤ªå¤æ‚äº†ã€‚</p><p>å…¶å®ï¼Œä¸€èˆ¬å¤§å…¬å¸æœ¬èº«éƒ½ä¼šæœ‰ç›‘å¬binlogæ¶ˆæ¯çš„æ¶ˆæ¯é˜Ÿåˆ—å­˜åœ¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†åšä¸€äº›æ ¸å¯¹çš„å·¥ä½œã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç›‘å¬binlogçš„æ¶ˆæ¯é˜Ÿåˆ—æ¥åšåˆ é™¤ç¼“å­˜çš„æ“ä½œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸ç”¨ä½ è‡ªå·±å¼•å…¥ï¼Œä¾µå…¥åˆ°ä½ çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œä¸­é—´ä»¶å¸®ä½ åšäº†è§£è€¦ï¼ŒåŒæ—¶ï¼Œä¸­é—´ä»¶çš„è¿™ä¸ªä¸œè¥¿æœ¬èº«å°±ä¿è¯äº†é«˜å¯ç”¨ã€‚</p><p>å½“ç„¶ï¼Œè¿™æ ·æ¶ˆæ¯å»¶è¿Ÿçš„é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ç›¸æ¯”å•çº¯å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„åšæ³•æ›´å¥½ä¸€ç‚¹ã€‚</p><p>è€Œä¸”ï¼Œå¦‚æœå¹¶å‘ä¸æ˜¯ç‰¹åˆ«é«˜çš„è¯ï¼Œè¿™ç§åšæ³•çš„å®æ—¶æ€§å’Œä¸€è‡´æ€§éƒ½è¿˜ç®—å¯ä»¥æ¥å—çš„ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220715153124553-4ee8fb6c.png" alt="image-20220715153124553" tabindex="0" loading="lazy"><figcaption>image-20220715153124553</figcaption></figure><h5 id="è§£å†³æ–¹æ¡ˆ3-è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ3-è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ3:è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</h5><p>æ¯æ¬¡æ”¾å…¥ç¼“å­˜çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚5åˆ†é’Ÿï¼Œä»¥åçš„æ“ä½œåªä¿®æ”¹æ•°æ®åº“ï¼Œä¸æ“ä½œç¼“å­˜ï¼Œç­‰å¾…ç¼“å­˜è¶…æ—¶åä»æ•°æ®åº“é‡æ–°è¯»å–ã€‚</p><p>å¦‚æœå¯¹äºä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ¡ˆã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆè¿˜ä¼šæœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæ•°æ®æ›´æ–°çš„ç‰¹åˆ«é¢‘ç¹ï¼Œä¸ä¸€è‡´æ€§çš„é—®é¢˜å°±å¾ˆå¤§äº†ã€‚</p><p>åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ´»åŠ¨çš„ç¼“å­˜æ•°æ®æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼å¤„ç†çš„ã€‚</p><p>å› ä¸ºæ´»åŠ¨å¹¶ä¸é¢‘ç¹å‘ç”Ÿæ”¹å˜ï¼Œè€Œä¸”å¯¹äºæ´»åŠ¨æ¥è¯´ï¼ŒçŸ­æš‚çš„ä¸ä¸€è‡´æ€§å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå¤§çš„é—®é¢˜ã€‚</p><p>è¯¦ç»†é—®é¢˜å¯ä»¥çœ‹ï¼š<a href="https://xiaolincoding.com/redis/architecture/mysql_redis_consistency.html#%E5%85%88%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%BF%98%E6%98%AF%E5%85%88%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98" target="_blank" rel="noopener noreferrer">æ•°æ®åº“å’Œç¼“å­˜å¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="â­ï¸rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#â­ï¸rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> â­ï¸Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</h3><p><strong>åˆ†å¸ƒå¼é”</strong>ï¼šå½“å¤šä¸ªè¿›ç¨‹ä¸åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­(æ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ§åˆ¶å…±äº«èµ„æºè®¿é—®)ï¼Œç”¨åˆ†å¸ƒå¼é”æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ã€‚</p><p><a href="https://redis.io/docs/reference/patterns/distributed-locks/" target="_blank" rel="noopener noreferrer">Redisçš„å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸Šå¯¹ä½¿ç”¨åˆ†å¸ƒå¼é”æå‡ºè‡³å°‘éœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªè¦æ±‚ï¼š</p><ol><li><strong>äº’æ–¥</strong>ï¼ˆå±äºå®‰å…¨æ€§ï¼‰ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æŒæœ‰é”ã€‚</li><li><strong>æ— æ­»é”</strong>ï¼ˆå±äºæœ‰æ•ˆæ€§ï¼‰ï¼šå³ä½¿é”å®šèµ„æºçš„å®¢æˆ·ç«¯å´©æºƒæˆ–è¢«åˆ†åŒºï¼Œä¹Ÿæ€»æ˜¯å¯ä»¥è·å¾—é”ï¼›é€šå¸¸é€šè¿‡è¶…æ—¶æœºåˆ¶å®ç°ã€‚</li><li><strong>å®¹é”™æ€§</strong>ï¼ˆå±äºæœ‰æ•ˆæ€§ï¼‰ï¼šåªè¦å¤§å¤šæ•° Redis èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥è·å–å’Œé‡Šæ”¾é”ã€‚</li></ol><p><strong>åŸºäº redis å®ç°åˆ†å¸ƒå¼é”</strong>:</p><ul><li>å•ä¸ªRediså®ä¾‹ï¼šsetnx(key,å½“å‰æ—¶é—´+è¿‡æœŸæ—¶é—´) + Lua</li><li>Redisé›†ç¾¤æ¨¡å¼ï¼šRedlock</li></ul><h4 id="æœ€ç®€åŒ–ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#æœ€ç®€åŒ–ç‰ˆæœ¬" aria-hidden="true">#</a> æœ€ç®€åŒ–ç‰ˆæœ¬</h4><p>é¦–å…ˆï¼Œå½“ç„¶æ˜¯æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„å®ç°æ–¹å¼ï¼Œç›´æ¥ç”¨Redisçš„setnxå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„è¯­æ³•æ˜¯ï¼š<strong>setnx key value</strong></p><p>å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°†keyè®¾ç½®ä¸ºvalueï¼Œå¹¶è¿”å›1ï¼›å¦‚æœkeyå­˜åœ¨ï¼Œä¸ä¼šæœ‰ä»»åŠ¡å½±å“ï¼Œè¿”å›0ã€‚</p><p>åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨setnxå®ç°åŠ é”çš„ç›®çš„ï¼šé€šè¿‡setnxåŠ é”ï¼ŒåŠ é”ä¹‹åå…¶ä»–æœåŠ¡æ— æ³•åŠ é”ï¼Œç”¨å®Œä¹‹åï¼Œå†é€šè¿‡deleteè§£é”ï¼Œæ·±è—åŠŸä¸å</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164349575-5e8ae744.png" alt="image-20220709164349575" tabindex="0" loading="lazy"><figcaption>image-20220709164349575</figcaption></figure><h4 id="æ”¯æŒè¿‡æœŸæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒè¿‡æœŸæ—¶é—´" aria-hidden="true">#</a> æ”¯æŒè¿‡æœŸæ—¶é—´</h4><p>æœ€ç®€åŒ–ç‰ˆæœ¬æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚æœè·å–é”çš„æœåŠ¡æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆé”å°±ä¸€ç›´å¾—ä¸åˆ°é‡Šæ”¾</strong>ï¼Œå°±åƒçŸ³æ²‰å¤§æµ·ï¼Œæ³æ— éŸ³ä¿¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¶…æ—¶æ¥å…œåº•ã€‚</p><p>Redisä¸­æœ‰expireå‘½ä»¤ï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ªkeyçš„è¶…æ—¶æ—¶é—´ã€‚ä½†æ˜¯setnxå’Œexpireä¸å…·å¤‡åŸå­æ€§ï¼Œå¦‚æœsetnxè·å–é”ä¹‹åï¼ŒæœåŠ¡æŒ‚æ‰ï¼Œä¾æ—§æ˜¯æ³¥ç‰›å…¥æµ·ã€‚</p><p>å¾ˆè‡ªç„¶ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°ï¼Œsetå’Œexpireï¼Œæœ‰æ²¡æœ‰åŸå­æ“ä½œï¼Ÿ</p><p>å½“ç„¶æœ‰ï¼ŒRedisæ—©å°±è€ƒè™‘åˆ°äº†è¿™ç§åœºæ™¯ï¼Œæ¨å‡ºäº†å¦‚ä¸‹æ‰§è¡Œè¯­å¥ï¼š<strong>set key value nx ex seconds</strong></p><p>nxè¡¨ç¤ºå…·å¤‡setnxç‰¹å®šï¼Œexè¡¨ç¤ºå¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œæœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯è¿‡æœŸæ—¶é—´çš„å€¼ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164418917-d9309eaa.png" alt="image-20220709164418917" tabindex="0" loading="lazy"><figcaption>image-20220709164418917</figcaption></figure><p>èƒ½å¤Ÿæ”¯æŒè¿‡æœŸæ—¶é—´ï¼Œç›®å‰è¿™ä¸ªé”åŸºæœ¬ä¸Šæ˜¯èƒ½ç”¨äº†ã€‚</p><p>ä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šä¼šå­˜åœ¨æœåŠ¡Aé‡Šæ”¾æ‰æœåŠ¡Bçš„é”çš„å¯èƒ½ã€‚</p><h4 id="åŠ ä¸Šowner" tabindex="-1"><a class="header-anchor" href="#åŠ ä¸Šowner" aria-hidden="true">#</a> åŠ ä¸Šowner</h4><p>æˆ‘ä»¬æ¥è¯•æƒ³ä¸€ä¸‹å¦‚ä¸‹åœºæ™¯ï¼šæœåŠ¡Aè·å–äº†é”ï¼Œç”±äºä¸šåŠ¡æµç¨‹æ¯”è¾ƒé•¿ï¼Œæˆ–è€…ç½‘ç»œå»¶è¿Ÿã€GCå¡é¡¿ç­‰åŸå› ï¼Œå¯¼è‡´é”è¿‡æœŸï¼Œè€Œä¸šåŠ¡è¿˜ä¼šç»§ç»­è¿›è¡Œã€‚è¿™æ—¶å€™ï¼Œä¸šåŠ¡Bå·²ç»æ‹¿åˆ°äº†é”ï¼Œå‡†å¤‡å»æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡Aæ¢å¤è¿‡æ¥å¹¶åšå®Œäº†ä¸šåŠ¡ï¼Œå°±ä¼šé‡Šæ”¾é”ï¼Œè€ŒBå´è¿˜åœ¨ç»§ç»­æ‰§è¡Œã€‚</p><p>åœ¨çœŸå®çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œå¯èƒ½å­˜åœ¨å‡ åä¸ªç«äº‰è€…ï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µå‘ç”Ÿæ¦‚ç‡å°±å¾ˆé«˜ï¼Œå¯¼è‡´åŒä¸€ä»½èµ„æºé¢‘ç¹è¢«ä¸åŒç«äº‰è€…åŒæ—¶è®¿é—®ï¼Œåˆ†å¸ƒå¼é”ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ã€‚</p><p>åŸºäºè¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé—®é¢˜å…³é”®åœ¨äºï¼Œç«äº‰è€…å¯ä»¥é‡Šæ”¾å…¶ä»–äººçš„é”ã€‚é‚£ä¹ˆåœ¨å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼š<strong>åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³è°ç”³è¯·è°é‡Šæ”¾åŸåˆ™ï¼Œä¸èƒ½é‡Šæ”¾åˆ«äººçš„é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†å¸ƒå¼é”ï¼Œæ˜¯è¦æœ‰å½’å±çš„</strong></p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164452895-88614daa.png" alt="image-20220709164452895" tabindex="0" loading="lazy"><figcaption>image-20220709164452895</figcaption></figure><h4 id="å¼•å…¥lua" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥lua" aria-hidden="true">#</a> å¼•å…¥Lua</h4><p>åŠ å…¥owneråçš„ç‰ˆæœ¬å¯ä»¥ç§°å¾—ä¸Šæ˜¯å®Œå–„äº†å—ï¼Ÿè¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆéšæ‚£å‘¢ï¼Ÿ</p><p>æˆ‘ä¹Ÿä¸å–å…³å­äº†ï¼Œåˆ°è¿™ä¸€æ­¥å…¶å®è¿˜å­˜åœ¨ä¸€ä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬å®Œæ•´çš„æµç¨‹æ˜¯ç«äº‰è€…è·å–é”æ‰§è¡Œä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åæ£€æŸ¥é”æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼Œæœ€åè¿›è¡Œé‡Šæ”¾ã€‚</p><p>æµç¨‹ä¸€æ¢³ç†ï¼Œä½ ä»¬è‚¯å®šæ˜ç™½äº†ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œ<strong>æ£€æŸ¥é”ï¼Œå†é‡Šæ”¾ï¼Œè¿™äº›æ“ä½œä¸æ˜¯åŸå­åŒ–çš„ã€‚</strong></p><p><strong>å¯èƒ½é”è·å–æ—¶è¿˜æ˜¯è‡ªå·±çš„ï¼Œåˆ é™¤æ—¶å´å·²ç»æ˜¯åˆ«äººçš„</strong>äº†ã€‚è¿™å¯æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>Rediså¯æ²¡æœ‰ç›´æ¥æä¾›è¿™ç§åœºæ™¯åŸå­åŒ–çš„æ“ä½œå•Šã€‚é‡äº‹ä¸è¦æ…Œï¼Œä»”ç»†æƒ³ä¸€æƒ³ï¼ŒRedisæ˜¯ä¸æ˜¯è¿˜æœ‰ä¸ªç‰¹æ€§ï¼Œä¸“é—¨æ•´åˆåŸå­æ“ä½œï¼Œå¯¹ï¼Œå°±æ˜¯å®ƒâ€”â€”<strong>Lua</strong></p><p>Redisâ•Luaï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºè§£å†³åŸå­é—®é¢˜è€Œç”Ÿã€‚</p><p>æœ‰äº†Luaçš„ç‰¹æ€§ï¼ŒRedisæ‰çœŸæ­£åœ¨åˆ†å¸ƒå¼é”ã€ç§’æ€ç­‰åœºæ™¯ï¼Œæœ‰äº†ç”¨æ­¦ä¹‹åœ°ï¼Œä¸‹é¢ä¾¿æ˜¯æ”¹é€ ä¹‹åçš„æµç¨‹ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164528516-576b6db5.png" alt="image-20220709164528516" tabindex="0" loading="lazy"><figcaption>image-20220709164528516</figcaption></figure><p>å…¶å®åˆ°äº†è¿™ä¸€æ­¥ï¼Œåˆ†å¸ƒå¼é”çš„å‰ä¸‰ä¸ªç‰¹æ€§ï¼šå¯¹ç§°æ€§ã€å®‰å…¨æ€§ã€å¯é æ€§ï¼Œå°±æ»¡è¶³äº†ã€‚å¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¯ç”¨çš„åˆ†å¸ƒå¼é”äº†ï¼Œèƒ½æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„éœ€è¦</p><h4 id="redisson" tabindex="-1"><a class="header-anchor" href="#redisson" aria-hidden="true">#</a> Redisson</h4><p>å¯¹äºå¯èƒ½å­˜åœ¨<strong>é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ</strong> çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®æŠŠé”è¿‡æœŸæ—¶é—´è®¾ç½®é•¿ä¸€äº›ï¼Œå¤§äºæ­£å¸¸ä¸šåŠ¡å¤„ç†æ—¶é—´å°±å¥½å•¦ã€‚å¦‚æœä½ è§‰å¾—ä¸æ˜¯å¾ˆç¨³ï¼Œè¿˜å¯ä»¥ç»™è·å¾—é”çš„çº¿ç¨‹ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶å®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¯¹é”çš„è¿‡æœŸæ—¶é—´å»¶é•¿ï¼Œé˜²æ­¢é”è¿‡æœŸæå‰é‡Šæ”¾ã€‚</p><p>å½“å‰å¼€æºæ¡†æ¶Redissonè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¯ä»¥çœ‹ä¸‹Redissonåº•å±‚åŸç†å›¾ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164742280-5c45428c.png" alt="image-20220709164742280" tabindex="0" loading="lazy"><figcaption>image-20220709164742280</figcaption></figure><p>åªè¦çº¿ç¨‹ä¸€åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ª <code>watch dog</code>çœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœçº¿ç¨‹1è¿˜æŒæœ‰é”ï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚å› æ­¤ï¼ŒRedissonå°±æ˜¯ä½¿ç”¨watch dogè§£å†³äº†**ã€Œé”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œã€**é—®é¢˜ã€‚</p><h4 id="redlock-redisson" tabindex="-1"><a class="header-anchor" href="#redlock-redisson" aria-hidden="true">#</a> Redlock+Redisson</h4><p>å…¶å®Redisä¸€èˆ¬éƒ½æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼š</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164811068-924a66c0.png" alt="image-20220709164811068" tabindex="0" loading="lazy"><figcaption>image-20220709164811068</figcaption></figure><p>å¦‚æœçº¿ç¨‹ä¸€åœ¨Redisçš„masterèŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯åŠ é”çš„keyè¿˜æ²¡åŒæ­¥åˆ°slaveèŠ‚ç‚¹ã€‚æ°å¥½è¿™æ—¶ï¼ŒmasterèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œä¸€ä¸ªslaveèŠ‚ç‚¹å°±ä¼šå‡çº§ä¸ºmasterèŠ‚ç‚¹ã€‚çº¿ç¨‹äºŒå°±å¯ä»¥è·å–åŒä¸ªkeyçš„é”å•¦ï¼Œä½†çº¿ç¨‹ä¸€ä¹Ÿå·²ç»æ‹¿åˆ°é”äº†ï¼Œé”çš„å®‰å…¨æ€§å°±æ²¡äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedisä½œè€… antirezæå‡ºä¸€ç§é«˜çº§çš„åˆ†å¸ƒå¼é”ç®—æ³•ï¼šRedlockã€‚Redlockæ ¸å¿ƒæ€æƒ³æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>â</p><p>æå¤šä¸ªRedis masteréƒ¨ç½²ï¼Œä»¥ä¿è¯å®ƒä»¬ä¸ä¼šåŒæ—¶å®•æ‰ã€‚å¹¶ä¸”è¿™äº›masterèŠ‚ç‚¹æ˜¯å®Œå…¨ç›¸äº’ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´ä¸å­˜åœ¨æ•°æ®åŒæ­¥ã€‚åŒæ—¶ï¼Œéœ€è¦ç¡®ä¿åœ¨è¿™å¤šä¸ªmasterå®ä¾‹ä¸Šï¼Œæ˜¯ä¸åœ¨Rediså•å®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒæ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾é”ã€‚</p><p>â</p></blockquote><p>æˆ‘ä»¬å‡è®¾å½“å‰æœ‰5ä¸ªRedis masterèŠ‚ç‚¹ï¼Œåœ¨5å°æœåŠ¡å™¨ä¸Šé¢è¿è¡Œè¿™äº›Rediså®ä¾‹ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220709164830756-f0547663.png" alt="image-20220709164830756" tabindex="0" loading="lazy"><figcaption>image-20220709164830756</figcaption></figure><p>RedLockçš„å®ç°æ­¥éª¤:å¦‚ä¸‹</p><blockquote><p>â</p><ul><li>1.è·å–å½“å‰æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li><li>2.æŒ‰é¡ºåºå‘5ä¸ªmasterèŠ‚ç‚¹è¯·æ±‚åŠ é”ã€‚å®¢æˆ·ç«¯è®¾ç½®ç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”è¶…æ—¶æ—¶é—´è¦å°äºé”çš„å¤±æ•ˆæ—¶é—´ã€‚ï¼ˆå‡è®¾é”è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ä¸º10ç§’ï¼Œåˆ™è¶…æ—¶æ—¶é—´ä¸€èˆ¬åœ¨5-50æ¯«ç§’ä¹‹é—´,æˆ‘ä»¬å°±å‡è®¾è¶…æ—¶æ—¶é—´æ˜¯50mså§ï¼‰ã€‚å¦‚æœè¶…æ—¶ï¼Œè·³è¿‡è¯¥masterèŠ‚ç‚¹ï¼Œå°½å¿«å»å°è¯•ä¸‹ä¸€ä¸ªmasterèŠ‚ç‚¹ã€‚</li><li>3.å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´ï¼ˆå³æ­¥éª¤1è®°å½•çš„æ—¶é—´ï¼‰ï¼Œå¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚å½“ä¸”ä»…å½“è¶…è¿‡ä¸€åŠï¼ˆN/2+1ï¼Œè¿™é‡Œæ˜¯5/2+1=3ä¸ªèŠ‚ç‚¹ï¼‰çš„Redis masterèŠ‚ç‚¹éƒ½è·å¾—é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸã€‚ï¼ˆå¦‚ä¸Šå›¾ï¼Œ10s&gt; 30ms+40ms+50ms+4m0s+50msï¼‰</li><li>å¦‚æœå–åˆ°äº†é”ï¼Œkeyçš„çœŸæ­£æœ‰æ•ˆæ—¶é—´å°±å˜å•¦ï¼Œéœ€è¦å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚</li><li>å¦‚æœè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨è‡³å°‘N/2+1ä¸ªmasterå®ä¾‹å–åˆ°é”ï¼Œæœ‰æˆ–è€…è·å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯è¦åœ¨æ‰€æœ‰çš„masterèŠ‚ç‚¹ä¸Šè§£é”ï¼ˆå³ä¾¿æœ‰äº›masterèŠ‚ç‚¹æ ¹æœ¬å°±æ²¡æœ‰åŠ é”æˆåŠŸï¼Œä¹Ÿéœ€è¦è§£é”ï¼Œä»¥é˜²æ­¢æœ‰äº›æ¼ç½‘ä¹‹é±¼ï¼‰ã€‚</li></ul><p>â</p></blockquote><p>ç®€åŒ–ä¸‹æ­¥éª¤å°±æ˜¯ï¼š</p><ul><li>æŒ‰é¡ºåºå‘5ä¸ªmasterèŠ‚ç‚¹è¯·æ±‚åŠ é”</li><li>æ ¹æ®è®¾ç½®çš„è¶…æ—¶æ—¶é—´æ¥åˆ¤æ–­ï¼Œæ˜¯ä¸æ˜¯è¦è·³è¿‡è¯¥masterèŠ‚ç‚¹ã€‚</li><li>å¦‚æœå¤§äºç­‰äº3ä¸ªèŠ‚ç‚¹åŠ é”æˆåŠŸï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”çš„æœ‰æ•ˆæœŸï¼Œå³å¯è®¤å®šåŠ é”æˆåŠŸå•¦ã€‚</li><li>å¦‚æœè·å–é”å¤±è´¥ï¼Œè§£é”ï¼</li></ul><h4 id="zookeeperåˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#zookeeperåˆ†å¸ƒå¼é”" aria-hidden="true">#</a> Zookeeperåˆ†å¸ƒå¼é”</h4><p>Zookeeperçš„èŠ‚ç‚¹Znodeæœ‰å››ç§ç±»å‹ï¼š</p><ul><li><strong>æŒä¹…èŠ‚ç‚¹</strong> ï¼šé»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚åˆ›å»ºèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ã€‚</li><li><strong>æŒä¹…èŠ‚ç‚¹é¡ºåºèŠ‚ç‚¹</strong> ï¼šæ‰€è°“é¡ºåºèŠ‚ç‚¹ï¼Œå°±æ˜¯åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼ŒZookeeperæ ¹æ®åˆ›å»ºçš„æ—¶é—´é¡ºåºç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œç¼–å·ï¼ŒæŒä¹…èŠ‚ç‚¹é¡ºåºèŠ‚ç‚¹å°±æ˜¯æœ‰é¡ºåºçš„æŒä¹…èŠ‚ç‚¹ã€‚</li><li><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> ï¼šå’ŒæŒä¹…èŠ‚ç‚¹ç›¸åï¼Œå½“åˆ›å»ºèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œä¸´æ—¶èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ã€‚</li><li><strong>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹</strong> ï¼šæœ‰é¡ºåºçš„ä¸´æ—¶èŠ‚ç‚¹ã€‚</li></ul><p>Zookeeperåˆ†å¸ƒå¼é”å®ç°åº”ç”¨äº†<strong>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹</strong> ã€‚è¿™é‡Œä¸è´´ä»£ç å•¦ï¼Œæ¥è®²ä¸‹zkåˆ†å¸ƒå¼é”çš„å®ç°åŸç†å§ã€‚</p><h5 id="zkè·å–é”è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#zkè·å–é”è¿‡ç¨‹" aria-hidden="true">#</a> zkè·å–é”è¿‡ç¨‹</h5><p>å½“ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥æ—¶ï¼ŒZookeeperå®¢æˆ·ç«¯ä¼šåˆ›å»ºä¸€ä¸ªæŒä¹…èŠ‚ç‚¹<code>locks</code>ã€‚å¦‚æœå®ƒï¼ˆClient1ï¼‰æƒ³è·å¾—é”ï¼Œéœ€è¦åœ¨<code>locks</code>èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªé¡ºåºèŠ‚ç‚¹<code>lock1</code>.å¦‚å›¾</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154831233-64dc32ff.png" alt="image-20220725154831233" tabindex="0" loading="lazy"><figcaption>image-20220725154831233</figcaption></figure><p>æ¥ç€ï¼Œå®¢æˆ·ç«¯Client1ä¼šæŸ¥æ‰¾<code>locks</code>ä¸‹é¢çš„æ‰€æœ‰ä¸´æ—¶é¡ºåºå­èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±çš„èŠ‚ç‚¹<code>lock1</code>æ˜¯ä¸æ˜¯æ’åºæœ€å°çš„é‚£ä¸€ä¸ªï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æˆåŠŸè·å¾—é”ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154850768-457c9a57.png" alt="image-20220725154850768" tabindex="0" loading="lazy"><figcaption>image-20220725154850768</figcaption></figure><p>è¿™æ—¶å€™å¦‚æœåˆæ¥ä¸€ä¸ªå®¢æˆ·ç«¯client2å‰æ¥å°è¯•è·å¾—é”ï¼Œå®ƒä¼šåœ¨locksä¸‹å†åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹<code>lock2</code></p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154905321-4ac6c5b3.png" alt="image-20220725154905321" tabindex="0" loading="lazy"><figcaption>image-20220725154905321</figcaption></figure><p>å®¢æˆ·ç«¯client2ä¸€æ ·ä¹Ÿä¼šæŸ¥æ‰¾locksä¸‹é¢çš„æ‰€æœ‰ä¸´æ—¶é¡ºåºå­èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±çš„èŠ‚ç‚¹lock2æ˜¯ä¸æ˜¯æœ€å°çš„ï¼Œæ­¤æ—¶ï¼Œå‘ç°lock1æ‰æ˜¯æœ€å°çš„ï¼Œäºæ˜¯è·å–é”å¤±è´¥ã€‚è·å–é”å¤±è´¥ï¼Œå®ƒæ˜¯ä¸ä¼šç”˜å¿ƒçš„ï¼Œclient2å‘å®ƒæ’åºé å‰çš„èŠ‚ç‚¹lock1æ³¨å†ŒWatcheräº‹ä»¶ï¼Œç”¨æ¥ç›‘å¬lock1æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´client2æŠ¢é”å¤±è´¥è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154920071-50db46a4.png" alt="image-20220725154920071" tabindex="0" loading="lazy"><figcaption>image-20220725154920071</figcaption></figure><p>æ­¤æ—¶ï¼Œå¦‚æœå†æ¥ä¸€ä¸ªå®¢æˆ·ç«¯Client3æ¥å°è¯•è·å–é”ï¼Œå®ƒä¼šåœ¨locksä¸‹å†åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹lock3</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154933777-478ce9f8.png" alt="image-20220725154933777" tabindex="0" loading="lazy"><figcaption>image-20220725154933777</figcaption></figure><p>åŒæ ·çš„ï¼Œclient3ä¸€æ ·ä¹Ÿä¼šæŸ¥æ‰¾locksä¸‹é¢çš„æ‰€æœ‰ä¸´æ—¶é¡ºåºå­èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±çš„èŠ‚ç‚¹lock3æ˜¯ä¸æ˜¯æœ€å°çš„ï¼Œå‘ç°è‡ªå·±ä¸æ˜¯æœ€å°çš„ï¼Œå°±è·å–é”å¤±è´¥ã€‚å®ƒä¹Ÿæ˜¯ä¸ä¼šç”˜å¿ƒçš„ï¼Œå®ƒä¼šå‘åœ¨å®ƒå‰é¢çš„èŠ‚ç‚¹lock2æ³¨å†ŒWatcheräº‹ä»¶ï¼Œä»¥ç›‘å¬lock2èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚</p><figure><img src="/Computer-Science-Learn-Notes/assets/image-20220725154939637-ca2a0832.png" alt="image-20220725154939637" tabindex="0" loading="lazy"><figcaption>image-20220725154939637</figcaption></figure><h3 id="é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠ" aria-hidden="true">#</a> é›†ç¾¤è„‘è£‚å¯¼è‡´æ•°æ®ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ</h3><blockquote><p>ä»€ä¹ˆæ˜¯è„‘è£‚ï¼Ÿ</p></blockquote><p>å…ˆæ¥ç†è§£é›†ç¾¤çš„è„‘è£‚ç°è±¡ï¼Œè¿™å°±å¥½æ¯”ä¸€ä¸ªäººæœ‰ä¸¤ä¸ªå¤§è„‘ï¼Œé‚£ä¹ˆåˆ°åº•å—è°æ§åˆ¶å‘¢ï¼Ÿ</p><p>é‚£ä¹ˆåœ¨ Redis ä¸­ï¼Œé›†ç¾¤è„‘è£‚äº§ç”Ÿæ•°æ®ä¸¢å¤±çš„ç°è±¡æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>åœ¨ Redis ä¸»ä»æ¶æ„ä¸­ï¼Œéƒ¨ç½²æ–¹å¼ä¸€èˆ¬æ˜¯ã€Œä¸€ä¸»å¤šä»ã€ï¼Œä¸»èŠ‚ç‚¹æä¾›å†™æ“ä½œï¼Œä»èŠ‚ç‚¹æä¾›è¯»æ“ä½œã€‚ å¦‚æœä¸»èŠ‚ç‚¹çš„ç½‘ç»œçªç„¶å‘ç”Ÿäº†é—®é¢˜ï¼Œå®ƒä¸æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½å¤±è”äº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä¸»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯çš„ç½‘ç»œæ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ Redis å†…éƒ¨å·²ç»å‡ºç°äº†é—®é¢˜ï¼Œè¿˜åœ¨ç…§æ ·çš„å‘è¿™ä¸ªå¤±è”çš„ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼ˆè¿‡ç¨‹Aï¼‰ï¼Œæ­¤æ—¶è¿™äº›æ•°æ®è¢«æ—§ä¸»èŠ‚ç‚¹ç¼“å­˜åˆ°äº†ç¼“å†²åŒºé‡Œï¼Œå› ä¸ºä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯æ— æ³•åŒæ­¥ç»™ä»èŠ‚ç‚¹çš„ã€‚</p><p>è¿™æ—¶ï¼Œå“¨å…µä¹Ÿå‘ç°ä¸»èŠ‚ç‚¹å¤±è”äº†ï¼Œå®ƒå°±è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆä½†å®é™…ä¸Šä¸»èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†ï¼‰ï¼Œäºæ˜¯å“¨å…µå°±ä¼šåœ¨ã€Œä»èŠ‚ç‚¹ã€ä¸­é€‰ä¸¾å‡ºä¸€ä¸ª leeder ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿™æ—¶é›†ç¾¤å°±æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹äº† â€”â€” <strong>è„‘è£‚å‡ºç°äº†</strong>ã€‚</p><p>ç„¶åï¼Œç½‘ç»œçªç„¶å¥½äº†ï¼Œå“¨å…µå› ä¸ºä¹‹å‰å·²ç»é€‰ä¸¾å‡ºä¸€ä¸ªæ–°ä¸»èŠ‚ç‚¹äº†ï¼Œå®ƒå°±ä¼šæŠŠæ—§ä¸»èŠ‚ç‚¹é™çº§ä¸ºä»èŠ‚ç‚¹ï¼ˆAï¼‰ï¼Œç„¶åä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šå‘æ–°ä¸»èŠ‚ç‚¹è¯·æ±‚æ•°æ®åŒæ­¥ï¼Œ<strong>å› ä¸ºç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæ­¤æ—¶çš„ä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šæ¸…ç©ºæ‰è‡ªå·±æœ¬åœ°çš„æ•°æ®ï¼Œç„¶åå†åšå…¨é‡åŒæ­¥ã€‚æ‰€ä»¥ï¼Œä¹‹å‰å®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ A å†™å…¥çš„æ•°æ®å°±ä¼šä¸¢å¤±äº†ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±çš„é—®é¢˜</strong>ã€‚</p><p>æ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼šç”±äºç½‘ç»œé—®é¢˜ï¼Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¤±å»è”ç³»ã€‚ä¸»ä»æ•°æ®ä¸åŒæ­¥ï¼›é‡æ–°å¹³è¡¡é€‰ä¸¾ï¼Œäº§ç”Ÿä¸¤ä¸ªä¸»æœåŠ¡ã€‚ç­‰ç½‘ç»œæ¢å¤ï¼Œæ—§ä¸»èŠ‚ç‚¹ä¼šé™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œå†ä¸æ–°ä¸»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„æ—¶å€™ï¼Œç”±äºä¼šä»èŠ‚ç‚¹ä¼šæ¸…ç©ºè‡ªå·±çš„ç¼“å†²åŒºï¼Œæ‰€ä»¥å¯¼è‡´ä¹‹å‰å®¢æˆ·ç«¯å†™å…¥çš„æ•°æ®ä¸¢å¤±äº†ã€‚</p><blockquote><p>è§£å†³æ–¹æ¡ˆ</p></blockquote><p>å½“ä¸»èŠ‚ç‚¹å‘ç°ä»èŠ‚ç‚¹ä¸‹çº¿æˆ–è€…é€šä¿¡è¶…æ—¶çš„æ€»æ•°é‡å°äºé˜ˆå€¼æ—¶ï¼Œé‚£ä¹ˆç¦æ­¢ä¸»èŠ‚ç‚¹è¿›è¡Œå†™æ•°æ®ï¼Œç›´æ¥æŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è®¾ç½®ï¼š</p><ul><li>min-slaves-to-write xï¼Œä¸»èŠ‚ç‚¹å¿…é¡»è¦æœ‰è‡³å°‘ x ä¸ªä»èŠ‚ç‚¹è¿æ¥ï¼Œå¦‚æœå°äºè¿™ä¸ªæ•°ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚</li><li>min-slaves-max-lag xï¼Œä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡ x ç§’ï¼Œå¦‚æœè¶…è¿‡ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠ min-slaves-to-write å’Œ min-slaves-max-lag è¿™ä¸¤ä¸ªé…ç½®é¡¹æ­é…èµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€å®šçš„é˜ˆå€¼ï¼Œå‡è®¾ä¸º N å’Œ Tã€‚</p><p>è¿™ä¸¤ä¸ªé…ç½®é¡¹ç»„åˆåçš„è¦æ±‚æ˜¯ï¼Œä¸»åº“è¿æ¥çš„ä»åº“ä¸­è‡³å°‘æœ‰ N ä¸ªä»åº“ï¼Œå’Œä¸»åº“è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’ï¼Œå¦åˆ™ï¼Œä¸»åº“å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™è¯·æ±‚äº†ã€‚</p><p>å³ä½¿åŸä¸»åº“æ˜¯å‡æ•…éšœï¼Œå®ƒåœ¨å‡æ•…éšœæœŸé—´ä¹Ÿæ— æ³•å“åº”å“¨å…µå¿ƒè·³ï¼Œä¹Ÿä¸èƒ½å’Œä»åº“è¿›è¡ŒåŒæ­¥ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•å’Œä»åº“è¿›è¡Œ ACK ç¡®è®¤äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œmin-slaves-to-write å’Œ min-slaves-max-lag çš„ç»„åˆè¦æ±‚å°±æ— æ³•å¾—åˆ°æ»¡è¶³ï¼Œ<strong>åŸä¸»åº“å°±ä¼šè¢«é™åˆ¶æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±ä¸èƒ½åœ¨åŸä¸»åº“ä¸­å†™å…¥æ–°æ•°æ®äº†</strong>ã€‚</p><p><strong>ç­‰åˆ°æ–°ä¸»åº“ä¸Šçº¿æ—¶ï¼Œå°±åªæœ‰æ–°ä¸»åº“èƒ½æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œæ–°å†™çš„æ•°æ®ä¼šè¢«ç›´æ¥å†™åˆ°æ–°ä¸»åº“ä¸­ã€‚è€ŒåŸä¸»åº“ä¼šè¢«å“¨å…µé™ä¸ºä»åº“ï¼Œå³ä½¿å®ƒçš„æ•°æ®è¢«æ¸…ç©ºäº†ï¼Œä¹Ÿä¸ä¼šæœ‰æ–°æ•°æ®ä¸¢å¤±ã€‚</strong></p><p>å†æ¥ä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬å°† min-slaves-to-write è®¾ç½®ä¸º 1ï¼ŒæŠŠ min-slaves-max-lag è®¾ç½®ä¸º 12sï¼ŒæŠŠå“¨å…µçš„ down-after-milliseconds è®¾ç½®ä¸º 10sï¼Œä¸»åº“å› ä¸ºæŸäº›åŸå› å¡ä½äº† 15sï¼Œå¯¼è‡´å“¨å…µåˆ¤æ–­ä¸»åº“å®¢è§‚ä¸‹çº¿ï¼Œå¼€å§‹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</p><p>åŒæ—¶ï¼Œå› ä¸ºåŸä¸»åº“å¡ä½äº† 15sï¼Œæ²¡æœ‰ä¸€ä¸ªä»åº“èƒ½å’ŒåŸä¸»åº“åœ¨ 12s å†…è¿›è¡Œæ•°æ®å¤åˆ¶ï¼ŒåŸä¸»åº“ä¹Ÿæ— æ³•æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œä¹Ÿåªæœ‰æ–°ä¸»åº“èƒ½æ¥æ”¶è¯·æ±‚ï¼Œä¸ä¼šå‘ç”Ÿè„‘è£‚ï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±çš„é—®é¢˜äº†ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes/edit/main/demo/theme-docs/src/Java/eightpart/redis.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 542716863@qq.com">RrOrange</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/Computer-Science-Learn-Notes/Java/eightpart/mysql.html" class="nav-link prev" aria-label="MySQL"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->MySQL</div></a><a href="/Computer-Science-Learn-Notes/Java/eightpart/distribution.html" class="nav-link next" aria-label="åˆ†å¸ƒå¼"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">åˆ†å¸ƒå¼<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2023 zhiyu1998</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/Computer-Science-Learn-Notes/assets/app-66c72b60.js" defer></script>
  </body>
</html>
