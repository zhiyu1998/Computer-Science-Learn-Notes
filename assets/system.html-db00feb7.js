import{_ as o,W as p,X as c,a0 as n,a1 as s,Z as e,$ as t,C as i}from"./framework-c8643d23.js";const l="/Computer-Science-Learn-Notes/assets/1db038e1d2e5325b05e2bb80475d962a-3247ab50.webp",r="/Computer-Science-Learn-Notes/assets/c88bda5db60029f3ea57e4306e7da936-c867d912.webp",u="/Computer-Science-Learn-Notes/assets/32ä½è™šæ‹Ÿå†…å­˜å¸ƒå±€-91809da0.webp",d="/Computer-Science-Learn-Notes/assets/image-20220717165055763-3c8a2ce3.webp",k="/Computer-Science-Learn-Notes/assets/image-20220725152351105-72e5269e.webp",m="/Computer-Science-Learn-Notes/assets/image-20220725152423113-bfe53376.webp",g="/Computer-Science-Learn-Notes/assets/image-20220725152443546-e9162fec.webp",h="/Computer-Science-Learn-Notes/assets/image-20220725152513494-8dbce8db.webp",v="/Computer-Science-Learn-Notes/assets/image-20220725152523692-7f342349.webp",b="/Computer-Science-Learn-Notes/assets/image-20220725152532905-add3202b.webp",f="/Computer-Science-Learn-Notes/assets/image-20220725152542296-8253ea8a.webp",w="/Computer-Science-Learn-Notes/assets/image-20220627104731025-92dacff0.webp",_="/Computer-Science-Learn-Notes/assets/image-20220627104743508-2d32f774.webp",S="/Computer-Science-Learn-Notes/assets/image-20220702133239391-7eb38c8a.webp",x="/Computer-Science-Learn-Notes/assets/image-20220702133308560-7d0ec9c3.webp",y="/Computer-Science-Learn-Notes/assets/image-20220702133318801-2ca63778.webp",C="/Computer-Science-Learn-Notes/assets/image-20220702133411785-3b71be0f.webp",I="/Computer-Science-Learn-Notes/assets/image-20220731143809167-f4c688fe.webp",P="/Computer-Science-Learn-Notes/assets/image-20220717161851452-4e43ad53.webp",O="/Computer-Science-Learn-Notes/assets/image-20220717163910297-e1dc7785.webp",R="/Computer-Science-Learn-Notes/assets/image-20220717163933495-be82fa67.webp",q="/Computer-Science-Learn-Notes/assets/image-20220717165055763-3c8a2ce3.webp",A="/Computer-Science-Learn-Notes/assets/image-20220717165140152-eeacb104.webp",E="/Computer-Science-Learn-Notes/assets/image-20220717165148621-ea778ee4.webp",D="/Computer-Science-Learn-Notes/assets/brkç”³è¯·-192d5814.webp",U="/Computer-Science-Learn-Notes/assets/mmapç”³è¯·-e079d935.webp",L={},T=t(`<h2 id="ğŸ’»æ“ä½œç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#ğŸ’»æ“ä½œç³»ç»Ÿ" aria-hidden="true">#</a> ğŸ’»æ“ä½œç³»ç»Ÿ</h2><h3 id="åç¨‹-è™šæ‹Ÿçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#åç¨‹-è™šæ‹Ÿçº¿ç¨‹" aria-hidden="true">#</a> åç¨‹ &amp; è™šæ‹Ÿçº¿ç¨‹</h3><p>åç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ã€‚</p><p>åç¨‹ä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼Œè€Œæ˜¯å®Œå…¨ç”±ç”¨æˆ·ç¨‹åºæ‰€æ§åˆ¶ï¼Œè¿™æ ·å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä¸ä¼šåƒçº¿ç¨‹åˆ‡æ¢é‚£æ ·æ¶ˆè€—èµ„æºã€‚</p><p>åç¨‹å¯ä»¥ç†è§£ä¸ºå¯ä»¥æš‚åœæ‰§è¡Œçš„å‡½æ•°ã€‚å®ƒæ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆï¼Œç›´æ¥æ“ä½œæ ˆåˆ™åŸºæœ¬æ²¡æœ‰å†…æ ¸åˆ‡æ¢çš„å¼€é”€ï¼Œå¯ä»¥ä¸åŠ é”çš„è®¿é—®å…¨å±€å˜é‡ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éå¸¸å¿«ã€‚</p><p><strong>Kotlin åç¨‹</strong>:</p><p>Kotlin æä¾›äº† <code>kotlinx.coroutines</code> åº“æ¥æ”¯æŒåç¨‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨åç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼š</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span><span class="token operator">*</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    launch <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;World!&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Hello,&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000L</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Go åç¨‹</strong>:</p><p>Go è¯­è¨€å†…ç½®äº†å¯¹åç¨‹çš„æ”¯æŒï¼Œç§°ä¸º goroutinesã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ goroutines æ‰§è¡Œå¹¶å‘ä»»åŠ¡ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;World!&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello,&quot;</span><span class="token punctuation">)</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è™šæ‹Ÿçº¿ç¨‹</strong></p><p>è™šæ‹Ÿçº¿ç¨‹æ˜¯ Java 19 å¼•å…¥çš„ä¸€ç§è½»é‡çº§çº¿ç¨‹ï¼Œå®ƒä»¬æ—¨åœ¨æé«˜å¹¶å‘æ€§èƒ½ã€‚è™šæ‹Ÿçº¿ç¨‹åœ¨åº•å±‚ä½¿ç”¨ä¸€ç§ç§°ä¸º<strong>ç»“æ„åŒ–å¹¶å‘</strong>çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…è®¸ç¨‹åºæ›´æœ‰æ•ˆåœ°ç®¡ç†èµ„æºã€‚è™šæ‹Ÿçº¿ç¨‹å…è®¸ç¨‹åºåœ¨å•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œè€Œä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„ç³»ç»Ÿèµ„æºã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿçº¿ç¨‹ç¤ºä¾‹ï¼Œä½¿ç”¨ Java 19 ç¼–å†™ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VirtualThreadExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newVirtualThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Runnable</span> task1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">Runnable</span> task2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" aria-hidden="true">#</a> è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><p>ç±»ä¼¼â€**è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½â€œ**è¿™æ ·çš„å›ç­”æ„Ÿè§‰å¤ªæŠ½è±¡ï¼Œéƒ½ä¸å¤ªå®¹æ˜“è®©äººç†è§£ã€‚</p><p>åšä¸ªç®€å•çš„æ¯”å–»ï¼šè¿›ç¨‹=ç«è½¦ï¼Œçº¿ç¨‹=è½¦å¢</p><ul><li><p>çº¿ç¨‹åœ¨è¿›ç¨‹ä¸‹è¡Œè¿›ï¼ˆå•çº¯çš„è½¦å¢æ— æ³•è¿è¡Œï¼‰</p></li><li><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆä¸€è¾†ç«è½¦å¯ä»¥æœ‰å¤šä¸ªè½¦å¢ï¼‰</p></li><li><p>ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ˆä¸€è¾†ç«è½¦ä¸Šçš„ä¹˜å®¢å¾ˆéš¾æ¢åˆ°å¦å¤–ä¸€è¾†ç«è½¦ï¼Œæ¯”å¦‚ç«™ç‚¹æ¢ä¹˜ï¼‰</p></li><li><p>åŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ï¼ˆAè½¦å¢æ¢åˆ°Bè½¦å¢å¾ˆå®¹æ˜“ï¼‰</p></li><li><p>è¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºï¼ˆé‡‡ç”¨å¤šåˆ—ç«è½¦ç›¸æ¯”å¤šä¸ªè½¦å¢æ›´è€—èµ„æºï¼‰</p></li><li><p>è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰ï¼ˆä¸€åˆ—ç«è½¦ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€åˆ—ç«è½¦ï¼Œä½†æ˜¯å¦‚æœä¸€åˆ—ç«è½¦ä¸Šä¸­é—´çš„ä¸€èŠ‚è½¦å¢ç€ç«äº†ï¼Œå°†å½±å“åˆ°æ‰€æœ‰è½¦å¢ï¼‰</p></li><li><p>è¿›ç¨‹å¯ä»¥æ‹“å±•åˆ°å¤šæœºï¼Œè¿›ç¨‹æœ€å¤šé€‚åˆå¤šæ ¸ï¼ˆä¸åŒç«è½¦å¯ä»¥å¼€åœ¨å¤šä¸ªè½¨é“ä¸Šï¼ŒåŒä¸€ç«è½¦çš„è½¦å¢ä¸èƒ½åœ¨è¡Œè¿›çš„ä¸åŒçš„è½¨é“ä¸Šï¼‰</p></li><li><p>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥ä¸Šé”ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„æ´—æ‰‹é—´ï¼‰ï¼&quot;äº’æ–¥é”&quot;</p></li><li><p>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥é™å®šä½¿ç”¨é‡ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„é¤å…ï¼Œæœ€å¤šåªå…è®¸å¤šå°‘äººè¿›å…¥ï¼Œå¦‚æœæ»¡äº†éœ€è¦åœ¨é—¨å£ç­‰ï¼Œç­‰æœ‰äººå‡ºæ¥äº†æ‰èƒ½è¿›å»ï¼‰ï¼â€œä¿¡å·é‡â€</p></li></ul>`,19),B={href:"https://www.zhihu.com/question/25532384",target:"_blank",rel:"noopener noreferrer"},N=t('<h3 id="linux-è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·" tabindex="-1"><a class="header-anchor" href="#linux-è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·" aria-hidden="true">#</a> Linux è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·ï¼Ÿ</h3><p>åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´çš„å†…éƒ¨åˆè¢«åˆ†ä¸º<strong>å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´</strong>ä¸¤éƒ¨åˆ†ï¼Œä¸åŒä½æ•°çš„ç³»ç»Ÿï¼Œåœ°å€ç©ºé—´çš„èŒƒå›´ä¹Ÿä¸åŒã€‚æ¯”å¦‚æœ€å¸¸è§çš„ 32 ä½å’Œ 64 ä½ç³»ç»Ÿï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="'+l+'" alt="æœ€å¸¸è§çš„ 32 ä½å’Œ 64 ä½ç³»ç»Ÿ" tabindex="0" loading="lazy"><figcaption>æœ€å¸¸è§çš„ 32 ä½å’Œ 64 ä½ç³»ç»Ÿ</figcaption></figure><p>é€šè¿‡è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼š</p><ul><li><code>32</code> ä½ç³»ç»Ÿçš„å†…æ ¸ç©ºé—´å ç”¨ <code>1G</code>ï¼Œä½äºæœ€é«˜å¤„ï¼Œå‰©ä¸‹çš„ <code>3G</code> æ˜¯ç”¨æˆ·ç©ºé—´ï¼›</li><li><code>64</code> ä½ç³»ç»Ÿçš„å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´éƒ½æ˜¯ <code>128T</code>ï¼Œåˆ†åˆ«å æ®æ•´ä¸ªå†…å­˜ç©ºé—´çš„æœ€é«˜å’Œæœ€ä½å¤„ï¼Œå‰©ä¸‹çš„ä¸­é—´éƒ¨åˆ†æ˜¯æœªå®šä¹‰çš„ã€‚</li></ul><p>å†æ¥è¯´è¯´ï¼Œå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„åŒºåˆ«ï¼š</p><ul><li>è¿›ç¨‹åœ¨ç”¨æˆ·æ€æ—¶ï¼Œåªèƒ½è®¿é—®ç”¨æˆ·ç©ºé—´å†…å­˜ï¼›</li><li>åªæœ‰è¿›å…¥å†…æ ¸æ€åï¼Œæ‰å¯ä»¥è®¿é—®å†…æ ¸ç©ºé—´çš„å†…å­˜ï¼›</li></ul><p>è™½ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½å„è‡ªæœ‰ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜ï¼Œä½†æ˜¯<strong>æ¯ä¸ªè™šæ‹Ÿå†…å­˜ä¸­çš„å†…æ ¸åœ°å€ï¼Œå…¶å®å…³è”çš„éƒ½æ˜¯ç›¸åŒçš„ç‰©ç†å†…å­˜</strong>ã€‚è¿™æ ·ï¼Œè¿›ç¨‹åˆ‡æ¢åˆ°å†…æ ¸æ€åï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¿é—®å†…æ ¸ç©ºé—´å†…å­˜ã€‚</p><figure><img src="'+r+'" alt="c88bda5db60029f3ea57e4306e7da936" tabindex="0" loading="lazy"><figcaption>c88bda5db60029f3ea57e4306e7da936</figcaption></figure><p>æ¥ä¸‹æ¥ï¼Œè¿›ä¸€æ­¥äº†è§£è™šæ‹Ÿç©ºé—´çš„åˆ’åˆ†æƒ…å†µï¼Œç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åˆ’åˆ†çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œå†…æ ¸ç©ºé—´çš„åˆ†å¸ƒæƒ…å†µå°±ä¸å¤šè¯´äº†ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹ç”¨æˆ·ç©ºé—´åˆ†å¸ƒçš„æƒ…å†µï¼Œä»¥ 32 ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾æ¥è¡¨ç¤ºå®ƒä»¬çš„å…³ç³»ï¼š</p><p>é€šè¿‡è¿™å¼ å›¾ä½ å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·ç©ºé—´å†…å­˜ä»<strong>ä½åˆ°é«˜</strong>åˆ†åˆ«æ˜¯ 6 ç§ä¸åŒçš„å†…å­˜æ®µï¼š</p><figure><img src="'+u+'" alt="32ä½è™šæ‹Ÿå†…å­˜å¸ƒå±€" tabindex="0" loading="lazy"><figcaption>32ä½è™šæ‹Ÿå†…å­˜å¸ƒå±€</figcaption></figure>',13),M=n("li",null,"ä»£ç æ®µï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶å¯æ‰§è¡Œä»£ç ï¼›",-1),z=n("li",null,"æ•°æ®æ®µï¼ŒåŒ…æ‹¬å·²åˆå§‹åŒ–çš„é™æ€å¸¸é‡å’Œå…¨å±€å˜é‡ï¼›",-1),H=n("li",null,"BSS æ®µï¼ŒåŒ…æ‹¬æœªåˆå§‹åŒ–çš„é™æ€å˜é‡å’Œå…¨å±€å˜é‡ï¼›",-1),j=n("li",null,"å †æ®µï¼ŒåŒ…æ‹¬åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä»ä½åœ°å€å¼€å§‹å‘ä¸Šå¢é•¿ï¼›",-1),F={href:"http://lishiwen4.github.io/linux/linux-process-memory-location",target:"_blank",rel:"noopener noreferrer"},K=n("li",null,[s("æ ˆæ®µï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ç­‰ã€‚æ ˆçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸€èˆ¬æ˜¯ "),n("code",null,"8 MB"),s("ã€‚å½“ç„¶ç³»ç»Ÿä¹Ÿæä¾›äº†å‚æ•°ï¼Œä»¥ä¾¿æˆ‘ä»¬è‡ªå®šä¹‰å¤§å°ï¼›")],-1),J=t('<p>åœ¨è¿™ 6 ä¸ªå†…å­˜æ®µä¸­ï¼Œå †å’Œæ–‡ä»¶æ˜ å°„æ®µçš„å†…å­˜æ˜¯åŠ¨æ€åˆ†é…çš„ã€‚æ¯”å¦‚è¯´ï¼Œä½¿ç”¨ C æ ‡å‡†åº“çš„ <code>malloc()</code> æˆ–è€… <code>mmap()</code> ï¼Œå°±å¯ä»¥åˆ†åˆ«åœ¨å †å’Œæ–‡ä»¶æ˜ å°„æ®µåŠ¨æ€åˆ†é…å†…å­˜ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</h3><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œé€šå¸¸çº¿ç¨‹çš„æ•°é‡å¤§äº CPU æ ¸å¿ƒçš„æ•°é‡ï¼Œå°½ç®¡åœ¨ä¸€äº›ç‰¹å®šçš„ç¯å¢ƒï¼ˆä¾‹å¦‚å®æ—¶ç³»ç»Ÿï¼‰æˆ–è€…ä¸ºäº†é¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œå¯èƒ½ä¼šå°†çº¿ç¨‹æ•°é‡é™åˆ¶åœ¨å’Œ CPU æ ¸å¿ƒæ•°ç›¸ç­‰æˆ–è€…æ›´å°‘ã€‚æ— è®ºä½•æ—¶ï¼Œä¸€ä¸ª CPU æ ¸å¿ƒåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚ä¸ºäº†ä¿è¯æ‰€æœ‰çº¿ç¨‹å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶é‡‡ç”¨è½®è½¬çš„å½¢å¼è¿›è¡Œè°ƒåº¦ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼ŒCPU ä¼šå°†è¯¥çº¿ç¨‹çš„çŠ¶æ€ï¼ˆä¾‹å¦‚å¯„å­˜å™¨å€¼ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ä»¥è¿›è¡Œä¸‹ä¸€è½®çš„æ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„&quot;ä¸Šä¸‹æ–‡åˆ‡æ¢&quot;ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ CPU æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li><strong>æ¶ˆè€—</strong>ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦æ¶ˆè€—ä¸€å®šçš„å¤„ç†å™¨æ—¶é—´ï¼Œè™½ç„¶æ¯æ¬¡åˆ‡æ¢åªéœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ï¼Œä½†åœ¨æ¯ç§’éœ€è¦è¿›è¡Œå‡ åæ¬¡ç”šè‡³ä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œè¿™ç§æ¶ˆè€—æ˜¯ç§¯ç´¯çš„ã€‚å› æ­¤ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„ä¸€ç§æ“ä½œã€‚è™½ç„¶ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæ¶ˆè€— CPU èµ„æºï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å…±äº« CPU æ—¶é—´ï¼Œä»è€Œå®ç°å¤šä»»åŠ¡å¹¶å‘æ‰§è¡Œã€‚</li><li><strong>ä¼˜åŒ–</strong>ï¼šå¯¹äºä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ã€‚ä¾‹å¦‚ï¼ŒLinux æ“ä½œç³»ç»Ÿç›¸æ¯”å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» Unix ç³»ç»Ÿï¼‰åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢ï¼ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œæˆ–ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ï¼‰çš„æ—¶é—´æ¶ˆè€—ä¸Šè¡¨ç°å‡ºè¾ƒå¤§çš„ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼ŒLinux æ“ä½œç³»ç»Ÿè¿˜ä¼šä½¿ç”¨ CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼‰è¿›è¡Œè°ƒåº¦ï¼Œä»¥é™ä½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é¢‘ç‡å’Œå¼€é”€ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå‡å°‘é”çš„ä½¿ç”¨ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹ï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜çº§çš„åŒæ­¥æœºåˆ¶ï¼ˆå¦‚æ— é”ç¼–ç¨‹ï¼Œæ¡ä»¶å˜é‡ï¼Œä¿¡å·é‡ç­‰ï¼‰ä»¥åŠé€šè¿‡ä¼˜åŒ–æ•°æ®å±€éƒ¨æ€§æ¥å‡å°‘ç¼“å­˜å¤±æ•ˆç­‰æ–¹æ³•ï¼Œä»è€Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦</h3>',6),G={href:"https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8",target:"_blank",rel:"noopener noreferrer"},V={href:"https://zh.wikipedia.org/wiki/%E8%BF%9B%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},W={href:"https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1",target:"_blank",rel:"noopener noreferrer"},X={href:"https://zh.wikipedia.org/wiki/UNIX",target:"_blank",rel:"noopener noreferrer"},Z={href:"https://zh.wikipedia.org/wiki/Linux",target:"_blank",rel:"noopener noreferrer"},$=n("p",null,"ç®€å•æ¥è¯´ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ¡ç›®æ¥è¡¨ç¤ºè¯¥æ–‡ä»¶ï¼Œå¹¶å­˜å‚¨æœ‰å…³è¯¥æ‰“å¼€æ–‡ä»¶çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨æ‚¨çš„æ“ä½œç³»ç»Ÿä¸­æ‰“å¼€äº†100ä¸ªæ–‡ä»¶ï¼Œåˆ™æ“ä½œç³»ç»Ÿä¸­ä¼šæœ‰100ä¸ªæ¡ç›®ï¼ˆåœ¨å†…æ ¸çš„æŸä¸ªåœ°æ–¹ï¼‰ã€‚è¿™äº›æ¡ç›®ç”±æ•´æ•°è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼ˆ...100ã€101ã€102...ï¼‰ã€‚è¿™ä¸ªæ¡ç›®å·ç å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚å› æ­¤ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ•´æ•°å·ç ï¼Œå”¯ä¸€åœ°è¡¨ç¤ºè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€‚å¦‚æœæ‚¨çš„è¿›ç¨‹æ‰“å¼€äº†10ä¸ªæ–‡ä»¶ï¼Œåˆ™è¿›ç¨‹è¡¨ä¸­ä¼šæœ‰10ä¸ªæ–‡ä»¶æè¿°ç¬¦æ¡ç›®ã€‚",-1),Q=n("p",null,"åŒæ ·ï¼Œå½“æ‚¨æ‰“å¼€ç½‘ç»œå¥—æ¥å­—æ—¶ï¼Œå®ƒä¹Ÿç”±ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼Œç§°ä¸ºå¥—æ¥å­—æè¿°ç¬¦ã€‚",-1),Y=n("blockquote",null,[n("p",null,"å’Œpidæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")],-1),nn=n("p",null,"æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰å’Œè¿›ç¨‹IDï¼ˆprocess IDï¼‰æ˜¯ä¸åŒçš„æ¦‚å¿µã€‚",-1),sn=n("ul",null,[n("li",null,"æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ‰“å¼€çš„æ–‡ä»¶æˆ–å…¶ä»–I/Oèµ„æºï¼Œä¾‹å¦‚ç®¡é“æˆ–å¥—æ¥å­—ã€‚å®ƒæ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿæä¾›çš„æœºåˆ¶ï¼Œç”¨äºè®¿é—®æ–‡ä»¶æˆ–å…¶ä»–I/Oèµ„æºã€‚"),n("li",null,"è¿›ç¨‹IDæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹IDï¼Œå®ƒæ˜¯ç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„ã€‚è¿›ç¨‹IDæ˜¯ç”¨äºæ“ä½œç³»ç»Ÿåœ¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒºåˆ†å’Œè·Ÿè¸ªçš„é‡è¦æ ‡è¯†ç¬¦ã€‚")],-1),an=n("p",null,"å‚è€ƒï¼š",-1),en={href:"https://www.computerhope.com/jargon/f/file-descriptor.htm",target:"_blank",rel:"noopener noreferrer"},tn={href:"https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6",target:"_blank",rel:"noopener noreferrer"},on={href:"https://stackoverflow.com/questions/5256599/what-are-file-descriptors-explained-in-simple-terms",target:"_blank",rel:"noopener noreferrer"},pn=t('<h3 id="è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€" aria-hidden="true">#</a> è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?</h3><ul><li><strong>åˆ›å»ºçŠ¶æ€(new)</strong> ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€ã€‚</li><li><strong>å°±ç»ªçŠ¶æ€(ready)</strong> ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œã€‚</li><li><strong>è¿è¡ŒçŠ¶æ€(running)</strong> ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šä¸Šè¿è¡Œ(å•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€)ã€‚</li><li><strong>é˜»å¡çŠ¶æ€(waiting)</strong> ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œã€‚</li><li><strong>ç»“æŸçŠ¶æ€(terminated)</strong> ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œã€‚</li></ul><h3 id="è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼" aria-hidden="true">#</a> è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼</h3>',3),cn={href:"https://www.jianshu.com/p/c1015f5ffa74",target:"_blank",rel:"noopener noreferrer"},ln=t(`<ol><li><strong>ç®¡é“/åŒ¿åç®¡é“(Pipes)</strong> ï¼šç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„çˆ¶å­è¿›ç¨‹é—´æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li><li><strong>æœ‰åç®¡é“(Names Pipes)</strong> : åŒ¿åç®¡é“ç”±äºæ²¡æœ‰åå­—ï¼Œåªèƒ½ç”¨äºäº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œæå‡ºäº†æœ‰åç®¡é“ã€‚æœ‰åç®¡é“ä¸¥æ ¼éµå¾ª<strong>å…ˆè¿›å…ˆå‡º(first in first out)</strong>ã€‚æœ‰åç®¡é“ä»¥ç£ç›˜æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼Œå¯ä»¥å®ç°æœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ã€‚</li><li><strong>ä¿¡å·(Signal)</strong> ï¼šä¿¡å·æ˜¯ä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿï¼›</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—(Message Queuing)</strong> ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾è¡¨,å…·æœ‰ç‰¹å®šçš„æ ¼å¼,å­˜æ”¾åœ¨å†…å­˜ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„é€šä¿¡æ•°æ®éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚ä¸ç®¡é“ï¼ˆæ— åç®¡é“ï¼šåªå­˜åœ¨äºå†…å­˜ä¸­çš„æ–‡ä»¶ï¼›å‘½åç®¡é“ï¼šå­˜åœ¨äºå®é™…çš„ç£ç›˜ä»‹è´¨æˆ–è€…æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸åŒçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œåªæœ‰åœ¨å†…æ ¸é‡å¯(å³ï¼Œæ“ä½œç³»ç»Ÿé‡å¯)æˆ–è€…æ˜¾å¼åœ°åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—æ‰ä¼šè¢«çœŸæ­£çš„åˆ é™¤ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢,æ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–,ä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–.æ¯” FIFO æ›´æœ‰ä¼˜åŠ¿ã€‚<strong>æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­— èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ã€‚</strong></li><li><strong>ä¿¡å·é‡(Semaphores)</strong> ï¼šä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¿¡å·é‡çš„æ„å›¾åœ¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä¸»è¦ç”¨äºè§£å†³ä¸åŒæ­¥ç›¸å…³çš„é—®é¢˜å¹¶é¿å…ç«äº‰æ¡ä»¶ã€‚</li><li><strong>å…±äº«å†…å­˜(Shared memory)</strong> ï¼šä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œä¸åŒè¿›ç¨‹å¯ä»¥åŠæ—¶çœ‹åˆ°å¯¹æ–¹è¿›ç¨‹ä¸­å¯¹å…±äº«å†…å­˜ä¸­æ•°æ®çš„æ›´æ–°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä¾é æŸç§åŒæ­¥æ“ä½œï¼Œå¦‚äº’æ–¥é”å’Œä¿¡å·é‡ç­‰ã€‚å¯ä»¥è¯´è¿™æ˜¯æœ€æœ‰ç”¨çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</li><li><strong>å¥—æ¥å­—(Sockets)</strong> : æ­¤æ–¹æ³•ä¸»è¦ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å¥—æ¥å­—æ˜¯æ”¯æŒ TCP/IP çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸åŒä¸»æœºä¹‹é—´çš„è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹ï¼Œç®€å•çš„è¯´å°±æ˜¯é€šä¿¡çš„ä¸¤æ–¹çš„ä¸€ç§çº¦å®šï¼Œç”¨å¥—æ¥å­—ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆé€šä¿¡è¿‡ç¨‹ã€‚</li></ol><p>ğŸ¦¹ <em>Javaä¸­å¦‚ä½•åšè¿›ç¨‹é—´é€šè®¯çš„ï¼Ÿ</em></p><p><strong>å¥—æ¥å­—ï¼ˆSocketï¼‰é€šä¿¡</strong></p><p>å¥—æ¥å­—å…è®¸ä¸¤ä¸ªè¿è¡Œåœ¨ä¸åŒè¿›ç¨‹æˆ–ä¸åŒè®¡ç®—æœºä¸Šçš„ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚åœ¨Javaä¸­ï¼Œä½¿ç”¨<code>java.net.Socket</code>ç±»å’Œ<code>java.net.ServerSocket</code>ç±»æ¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„TCPé€šä¿¡ã€‚å¯¹äºUDPé€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨<code>java.net.DatagramSocket</code>ç±»ã€‚</p><p>ç¤ºä¾‹ä»£ç :</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">// æœåŠ¡å™¨ç«¯</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> message <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

        output<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span><span class="token string">&quot;ä½ å¥½ï¼Œå®¢æˆ·ç«¯ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®¢æˆ·ç«¯</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataOutputStream</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataInputStream</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        output<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span><span class="token string">&quot;ä½ å¥½ï¼ŒæœåŠ¡å™¨ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> message <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
\`\`\`
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç®¡é“é€šä¿¡ï¼ˆPipesï¼‰</strong></p><p>ç®¡é“æ˜¯ä¸€ç§å•å‘é€šä¿¡æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æˆ–çº¿ç¨‹ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>java.io.PipedInputStream</code>å’Œ<code>java.io.PipedOutputStream</code>å®ç°ç®¡é“é€šä¿¡ã€‚</p><p>ç¤ºä¾‹ä»£ç :</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipeExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">PipedOutputStream</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">PipedInputStream</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedInputStream</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> sender <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, Receiver!&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> receiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">int</span> data <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        data <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sender<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        receiver<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sender<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        receiver<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="çº¿ç¨‹é—´çš„åŒæ­¥çš„æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹é—´çš„åŒæ­¥çš„æ–¹å¼" aria-hidden="true">#</a> çº¿ç¨‹é—´çš„åŒæ­¥çš„æ–¹å¼</h3><ol><li><strong>äº’æ–¥é‡(Mutex)</strong>ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ¯”å¦‚ Java ä¸­çš„ synchronized å…³é”®è¯å’Œå„ç§ Lock éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚</li><li><strong>ä¿¡å·é‡(Semaphore)</strong> ï¼šå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚</li><li><strong>äº‹ä»¶(Event)</strong> :Wait/Notifyï¼šé€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿çš„å®ç°å¤šçº¿ç¨‹ä¼˜å…ˆçº§çš„æ¯”è¾ƒæ“ä½œ</li></ol><h3 id="è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•" aria-hidden="true">#</a> è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•</h3><p>ä¸ºäº†ç¡®å®šé¦–å…ˆæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥åŠæœ€åæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥å®ç°æœ€å¤§ CPU åˆ©ç”¨ç‡ï¼Œè®¡ç®—æœºç§‘å­¦å®¶å·²ç»å®šä¹‰äº†ä¸€äº›ç®—æ³•ï¼Œå®ƒä»¬æ˜¯ï¼š</p><ul><li><strong>å…ˆåˆ°å…ˆæœåŠ¡(FCFS)è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li><li><strong>çŸ­ä½œä¸šä¼˜å…ˆ(SJF)çš„è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li><li><strong>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</strong> : æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦æ˜¯ä¸€ç§æœ€å¤è€ï¼Œæœ€ç®€å•ï¼Œæœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•ï¼Œåˆç§° RR(Round robin)è°ƒåº¦ã€‚æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ï¼Œå³è¯¥è¿›ç¨‹å…è®¸è¿è¡Œçš„æ—¶é—´ã€‚</li><li><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong> ï¼šå‰é¢ä»‹ç»çš„å‡ ç§è¿›ç¨‹è°ƒåº¦çš„ç®—æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚å¦‚<strong>çŸ­è¿›ç¨‹ä¼˜å…ˆçš„è°ƒåº¦ç®—æ³•ï¼Œä»…ç…§é¡¾äº†çŸ­è¿›ç¨‹è€Œå¿½ç•¥äº†é•¿è¿›ç¨‹</strong> ã€‚å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•æ—¢èƒ½ä½¿é«˜ä¼˜å…ˆçº§çš„ä½œä¸šå¾—åˆ°å“åº”åˆèƒ½ä½¿çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰è¿…é€Ÿå®Œæˆã€‚ï¼Œå› è€Œå®ƒæ˜¯ç›®å‰<strong>è¢«å…¬è®¤çš„ä¸€ç§è¾ƒå¥½çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•</strong>ï¼ŒUNIX æ“ä½œç³»ç»Ÿé‡‡å–çš„ä¾¿æ˜¯è¿™ç§è°ƒåº¦ç®—æ³•ã€‚</li><li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong> ï¼š ä¸ºæ¯ä¸ªæµç¨‹åˆ†é…ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæ‰§è¡Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œä¾æ­¤ç±»æ¨ã€‚å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹ä»¥ FCFS æ–¹å¼æ‰§è¡Œã€‚å¯ä»¥æ ¹æ®å†…å­˜è¦æ±‚ï¼Œæ—¶é—´è¦æ±‚æˆ–ä»»ä½•å…¶ä»–èµ„æºè¦æ±‚æ¥ç¡®å®šä¼˜å…ˆçº§ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯æ­»é”" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ­»é”" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯æ­»é”</h3><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚</p><blockquote><p>æ³¨ï¼šå¤–åŠ›ä½œç”¨æ˜¯æŒ‡æ‰“ç ´æ­»é”çš„ä¸€ç§æœºåˆ¶ï¼Œä¾‹å¦‚è¿›ç¨‹ä¸»åŠ¨æ”¾å¼ƒå·²è·å¾—çš„èµ„æºã€é€šçŸ¥å…¶ä»–è¿›ç¨‹é‡Šæ”¾èµ„æºç­‰ã€‚</p></blockquote>`,18),rn=n("p",null,"å‚è€ƒï¼š",-1),un={href:"https://stackoverflow.com/questions/34512/what-is-a-deadlock",target:"_blank",rel:"noopener noreferrer"},dn={href:"https://www.geeksforgeeks.org/introduction-of-deadlock-in-operating-system/",target:"_blank",rel:"noopener noreferrer"},kn={href:"https://baike.baidu.com/item/%E6%AD%BB%E9%94%81/2196938",target:"_blank",rel:"noopener noreferrer"},mn=t('<h3 id="ğŸŒŸ-æ­»é”çš„å››ä¸ªæ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#ğŸŒŸ-æ­»é”çš„å››ä¸ªæ¡ä»¶" aria-hidden="true">#</a> ğŸŒŸ æ­»é”çš„å››ä¸ªæ¡ä»¶</h3><ul><li><strong>äº’æ–¥</strong>ï¼šè¿™ä¸ªæ¡ä»¶æ„å‘³ç€ä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„èµ„æºã€‚å¦‚æœå…¶ä»–è¿›ç¨‹æƒ³è¦ä½¿ç”¨åŒä¸€ä¸ªèµ„æºï¼Œå®ƒå¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°å½“å‰å ç”¨è¯¥èµ„æºçš„è¿›ç¨‹å®Œæˆå¹¶é‡Šæ”¾è¯¥èµ„æºã€‚æ¯”å¦‚ï¼Œæ‰“å°æœºé€šå¸¸å°±æ˜¯ä¸€ä¸ªäº’æ–¥èµ„æºï¼Œä½ ä¸èƒ½åŒæ—¶æ‰“å°ä¸¤ä»½æ–‡ä»¶ã€‚</li><li><strong>å æœ‰å¹¶ç­‰å¾…</strong>ï¼šè¿™ä¸ªæ¡ä»¶æè¿°çš„æ˜¯ä¸€ä¸ªè¿›ç¨‹åœ¨å æœ‰è‡³å°‘ä¸€ä¸ªèµ„æºçš„åŒæ—¶ï¼Œè¿˜åœ¨ç­‰å¾…è·å–å…¶ä»–èµ„æºã€‚è¿™äº›å…¶ä»–èµ„æºå¯èƒ½æ­£è¢«å…¶ä»–è¿›ç¨‹æ‰€å æœ‰ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½å·²ç»å æœ‰äº†è®¿é—®æ•°æ®åº“çš„æƒé™ï¼Œä½†å®ƒè¿˜éœ€è¦è®¿é—®ç½‘ç»œæ‰èƒ½å®Œæˆå…¶ä»»åŠ¡ã€‚</li><li><strong>éæŠ¢å </strong>ï¼šè¿™æ˜¯æŒ‡ä¸€æ—¦ä¸€ä¸ªè¿›ç¨‹è·å–äº†ä¸€ä¸ªèµ„æºï¼Œå…¶ä»–è¿›ç¨‹å°±ä¸èƒ½å¼ºè¡Œä»å®ƒé‚£é‡Œå–èµ°ã€‚è¿™ä¸ªèµ„æºåªèƒ½è¢«å æœ‰å®ƒçš„è¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨CPUè¿›è¡Œè®¡ç®—ï¼Œè¿™æ—¶å€™å…¶ä»–è¿›ç¨‹ä¸èƒ½å¼ºè¡Œæ‰“æ–­å®ƒï¼Œåªèƒ½ç­‰åˆ°è¿™ä¸ªè¿›ç¨‹å®Œæˆè®¡ç®—åï¼ŒCPUæ‰èƒ½è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚</li><li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šè¿™ä¸ªæ¡ä»¶å½¢æˆäº†ä¸€ç§å¾ªç¯é“¾ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚æœ€åä¸€ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…ç¬¬ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºï¼Œä»è€Œå½¢æˆäº†ä¸€ä¸ªç­‰å¾…å¾ªç¯ã€‚æ¯”å¦‚ï¼Œè¿›ç¨‹Aç­‰å¾…è¢«è¿›ç¨‹Bå æœ‰çš„èµ„æºï¼Œè¿›ç¨‹Bç­‰å¾…è¢«è¿›ç¨‹Cå æœ‰çš„èµ„æºï¼Œè¿›ç¨‹Cç­‰å¾…è¢«è¿›ç¨‹Aå æœ‰çš„èµ„æºï¼Œå½¢æˆäº†ä¸€ä¸ªå¾ªç¯ç­‰å¾…ã€‚</li></ul><h3 id="æ­»é”çš„è§£å†³æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æ­»é”çš„è§£å†³æ–¹å¼" aria-hidden="true">#</a> æ­»é”çš„è§£å†³æ–¹å¼</h3><blockquote><p>å®˜æ–¹è¯´æ³•ï¼š è§£å†³æ­»é”çš„æ–¹æ³•å¯ä»¥ä»å¤šä¸ªè§’åº¦å»åˆ†æï¼Œä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œæœ‰é¢„é˜²ï¼Œé¿å…ï¼Œæ£€æµ‹å’Œè§£é™¤å››ç§ã€‚ <strong>é¢„é˜²</strong> æ˜¯é‡‡ç”¨æŸç§ç­–ç•¥ï¼Œé™åˆ¶å¹¶å‘è¿›ç¨‹å¯¹èµ„æºçš„è¯·æ±‚ï¼Œä»è€Œä½¿å¾—æ­»é”çš„å¿…è¦æ¡ä»¶åœ¨ç³»ç»Ÿæ‰§è¡Œçš„ä»»ä½•æ—¶é—´ä¸Šéƒ½ä¸æ»¡è¶³ã€‚ <strong>é¿å…</strong>åˆ™æ˜¯ç³»ç»Ÿåœ¨åˆ†é…èµ„æºæ—¶ï¼Œæ ¹æ®èµ„æºçš„ä½¿ç”¨æƒ…å†µæå‰åšå‡ºé¢„æµ‹ï¼Œä»è€Œé¿å…æ­»é”çš„å‘ç”Ÿ <strong>æ£€æµ‹</strong>æ˜¯æŒ‡ç³»ç»Ÿè®¾æœ‰ä¸“é—¨çš„æœºæ„ï¼Œå½“æ­»é”å‘ç”Ÿæ—¶ï¼Œè¯¥æœºæ„èƒ½å¤Ÿæ£€æµ‹æ­»é”çš„å‘ç”Ÿï¼Œå¹¶ç²¾ç¡®åœ°ç¡®å®šä¸æ­»é”æœ‰å…³çš„è¿›ç¨‹å’Œèµ„æºã€‚ <strong>è§£é™¤</strong> æ˜¯ä¸æ£€æµ‹ç›¸é…å¥—çš„ä¸€ç§æªæ–½ï¼Œç”¨äºå°†è¿›ç¨‹ä»æ­»é”çŠ¶æ€ä¸‹è§£è„±å‡ºæ¥ã€‚</p></blockquote><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³æˆ–è€…é˜²æ­¢æ­»é”ï¼š</p><ol><li><strong>é¿å…åµŒå¥—é”</strong>ï¼šé¿å…åœ¨ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨å¯¹å¤šä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”ã€‚</li><li><strong>é”é¡ºåº</strong>ï¼šå¦‚æœåœ¨ç¨‹åºä¸­çš„å¤šä¸ªçº¿ç¨‹éƒ½éœ€è¦åŒæ—¶è·å¾—å¤šä¸ªé”ï¼Œé‚£ä¹ˆåº”ç¡®ä¿æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æŒ‰ç…§ç›¸åŒçš„é¡ºåºå»è·å¾—é”ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºçº¿ç¨‹è·å–é”çš„é¡ºåºä¸ä¸€è‡´è€Œå¯¼è‡´æ­»é”ã€‚</li><li><strong>å°è¯•è·å–é”</strong>ï¼šJavaä¸­çš„Lockæ¥å£æä¾›äº†tryLockæ–¹æ³•æ¥å°è¯•è·å–é”ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•è·å–é”ï¼Œé‚£ä¹ˆtryLockå°†è¿”å›falseã€‚è¿™ç§æ–¹å¼å¯ä»¥é˜²æ­¢çº¿ç¨‹æ— é™æœŸåœ°ç­‰å¾…è·å–é”ã€‚</li><li><strong>ä½¿ç”¨ä¸­æ–­</strong>ï¼šåœ¨Javaä¸­ï¼Œé”å®šå¯¹è±¡çš„æ—¶å€™å¯ä»¥å“åº”ä¸­æ–­ï¼Œè¿™æ˜¯ä¸€ç§é¿å…æ­»é”çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”æ—¶ï¼Œå¯ä»¥ä¸­æ–­å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©å®ƒé‡Šæ”¾å·²ç»æŒæœ‰çš„é”ã€‚</li><li><strong>ä½¿ç”¨å®šæ—¶å™¨</strong>ï¼šä½ å¯ä»¥ä½¿ç”¨ScheduledExecutorServiceæ¥è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“çº¿ç¨‹åœ¨ç‰¹å®šæ—¶é—´å†…æ²¡æœ‰å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœæ­¢å®ƒã€‚</li></ol><blockquote><p>ä½¿ç”¨synchronizedå…³é”®å­—ä¸å½“åè€Œæ˜¯Javaä¸­æ­»é”äº§ç”Ÿçš„å¸¸è§åŸå› ã€‚å½“ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å„è‡ªæŒæœ‰ä¸€äº›èµ„æºå¹¶åŒæ—¶è¯·æ±‚å¯¹æ–¹æŒæœ‰çš„èµ„æºæ—¶ï¼Œå°±å¯èƒ½å‘ç”Ÿæ­»é”ã€‚</p></blockquote><h3 id="âœ¨reactoræ¨¡å‹æ·±å…¥æµ…å‡º" tabindex="-1"><a class="header-anchor" href="#âœ¨reactoræ¨¡å‹æ·±å…¥æµ…å‡º" aria-hidden="true">#</a> âœ¨Reactoræ¨¡å‹æ·±å…¥æµ…å‡º</h3><h4 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h4><p>å¦‚æœè¦è®©æœåŠ¡å™¨æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ä¸ºæ¯ä¸€æ¡è¿æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p><p>å…¶å®åˆ›å»ºè¿›ç¨‹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«åœ¨äºçº¿ç¨‹æ¯”è¾ƒè½»é‡çº§äº›ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œçº¿ç¨‹é—´åˆ‡æ¢çš„æˆæœ¬è¦å°äº›ï¼Œä¸ºäº†æè¿°ç®€è¿°ï¼Œåé¢éƒ½ä»¥çº¿ç¨‹ä¸ºä¾‹ã€‚</p><p>å¤„ç†å®Œä¸šåŠ¡é€»è¾‘åï¼Œéšç€è¿æ¥å…³é—­åçº¿ç¨‹ä¹ŸåŒæ ·è¦é”€æ¯äº†ï¼Œä½†æ˜¯è¿™æ ·ä¸åœåœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä¸ä»…ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œä¹Ÿä¼šé€ æˆæµªè´¹èµ„æºï¼Œè€Œä¸”å¦‚æœè¦è¿æ¥å‡ ä¸‡æ¡è¿æ¥ï¼Œåˆ›å»ºå‡ ä¸‡ä¸ªçº¿ç¨‹å»åº”å¯¹ä¹Ÿæ˜¯ä¸ç°å®çš„ã€‚</p><p>è¦è¿™ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œèµ„æºå¤ç”¨ã€çš„æ–¹å¼ã€‚</p><p>ä¹Ÿå°±æ˜¯ä¸ç”¨å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªã€Œçº¿ç¨‹æ± ã€ï¼Œå°†è¿æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œç„¶åä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚</p><p>ä¸è¿‡ï¼Œè¿™æ ·åˆå¼•æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œçº¿ç¨‹æ€æ ·æ‰èƒ½é«˜æ•ˆåœ°å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Ÿ</p><p>å½“ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹ä¸€èˆ¬é‡‡ç”¨ã€Œread -&gt; ä¸šåŠ¡å¤„ç† -&gt; sendã€çš„å¤„ç†æµç¨‹ï¼Œå¦‚æœå½“å‰è¿æ¥æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šé˜»å¡åœ¨ <code>read</code> æ“ä½œä¸Šï¼ˆ socket é»˜è®¤æƒ…å†µæ˜¯é˜»å¡ I/Oï¼‰ï¼Œä¸è¿‡è¿™ç§é˜»å¡æ–¹å¼å¹¶ä¸å½±å“å…¶ä»–çº¿ç¨‹ã€‚</p><p>ä½†æ˜¯å¼•å…¥äº†çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹è¦å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Œçº¿ç¨‹åœ¨å¤„ç†æŸä¸ªè¿æ¥çš„ <code>read</code> æ“ä½œæ—¶ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œå°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±æ²¡åŠæ³•ç»§ç»­å¤„ç†å…¶ä»–è¿æ¥çš„ä¸šåŠ¡ã€‚</p><p>è¦è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å°† socket æ”¹æˆéé˜»å¡ï¼Œç„¶åçº¿ç¨‹ä¸æ–­åœ°è½®è¯¢è°ƒç”¨ <code>read</code> æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ï¼Œè¿™ç§æ–¹å¼è™½ç„¶è¯¥èƒ½å¤Ÿè§£å†³é˜»å¡çš„é—®é¢˜ï¼Œä½†æ˜¯è§£å†³çš„æ–¹å¼æ¯”è¾ƒç²—æš´ï¼Œå› ä¸ºè½®è¯¢æ˜¯è¦æ¶ˆè€— CPU çš„ï¼Œè€Œä¸”éšç€ä¸€ä¸ª çº¿ç¨‹å¤„ç†çš„è¿æ¥è¶Šå¤šï¼Œè½®è¯¢çš„æ•ˆç‡å°±ä¼šè¶Šä½ã€‚</p><p>ä¸Šé¢çš„é—®é¢˜åœ¨äºï¼Œçº¿ç¨‹å¹¶ä¸çŸ¥é“å½“å‰è¿æ¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»ï¼Œä»è€Œéœ€è¦æ¯æ¬¡é€šè¿‡ <code>read</code> å»è¯•æ¢ã€‚</p><p>é‚£æœ‰æ²¡æœ‰åŠæ³•åœ¨åªæœ‰å½“è¿æ¥ä¸Šæœ‰æ•°æ®çš„æ—¶å€™ï¼Œçº¿ç¨‹æ‰å»å‘èµ·è¯»è¯·æ±‚å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå®ç°è¿™ä¸€æŠ€æœ¯çš„å°±æ˜¯ I/O å¤šè·¯å¤ç”¨ã€‚</p><p>I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ä¼šç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥ç›‘å¬æˆ‘ä»¬æ‰€æœ‰å…³å¿ƒçš„è¿æ¥ï¼Œä¹Ÿå°±è¯´å¯ä»¥åœ¨ä¸€ä¸ªç›‘æ§çº¿ç¨‹é‡Œé¢ç›‘æ§å¾ˆå¤šçš„è¿æ¥ã€‚</p><figure><img src="'+d+'" alt="image-20220725152308276" tabindex="0" loading="lazy"><figcaption>image-20220725152308276</figcaption></figure><p>æˆ‘ä»¬ç†Ÿæ‚‰çš„ select/poll/epoll å°±æ˜¯å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ä»å†…æ ¸ä¸­è·å–å¤šä¸ªäº‹ä»¶ã€‚</p><p>select/poll/epoll æ˜¯å¦‚ä½•è·å–ç½‘ç»œäº‹ä»¶çš„å‘¢ï¼Ÿ</p><p>åœ¨è·å–äº‹ä»¶æ—¶ï¼Œå…ˆæŠŠæˆ‘ä»¬è¦å…³å¿ƒçš„è¿æ¥ä¼ ç»™å†…æ ¸ï¼Œå†ç”±å†…æ ¸æ£€æµ‹ï¼š</p><ul><li>å¦‚æœæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹åªéœ€é˜»å¡åœ¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€åƒå‰é¢çš„çº¿ç¨‹æ± æ–¹æ¡ˆé‚£æ ·è½®è®­è°ƒç”¨ read æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ã€‚</li><li>å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå†…æ ¸ä¼šè¿”å›äº§ç”Ÿäº†äº‹ä»¶çš„è¿æ¥ï¼Œçº¿ç¨‹å°±ä¼šä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œç„¶ååœ¨ç”¨æˆ·æ€ä¸­å†å¤„ç†è¿™äº›è¿æ¥å¯¹åº”çš„ä¸šåŠ¡å³å¯ã€‚</li></ul><p>å½“ä¸‹å¼€æºè½¯ä»¶èƒ½åšåˆ°ç½‘ç»œé«˜æ€§èƒ½çš„åŸå› å°±æ˜¯ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ</p><p>æ˜¯çš„ï¼ŒåŸºæœ¬æ˜¯åŸºäº I/O å¤šè·¯å¤ç”¨ï¼Œç”¨è¿‡ I/O å¤šè·¯å¤ç”¨æ¥å£å†™ç½‘ç»œç¨‹åºçš„åŒå­¦ï¼Œè‚¯å®šçŸ¥é“æ˜¯é¢å‘è¿‡ç¨‹çš„æ–¹å¼å†™ä»£ç çš„ï¼Œè¿™æ ·çš„å¼€å‘çš„æ•ˆç‡ä¸é«˜ã€‚</p><p>äºæ˜¯ï¼Œå¤§ä½¬ä»¬åŸºäºé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œå¯¹ I/O å¤šè·¯å¤ç”¨ä½œäº†ä¸€å±‚å°è£…ï¼Œè®©ä½¿ç”¨è€…ä¸ç”¨è€ƒè™‘åº•å±‚ç½‘ç»œ API çš„ç»†èŠ‚ï¼Œåªéœ€è¦å…³æ³¨åº”ç”¨ä»£ç çš„ç¼–å†™ã€‚</p><p>å¤§ä½¬ä»¬è¿˜ä¸ºè¿™ç§æ¨¡å¼å–äº†ä¸ªè®©äººç¬¬ä¸€æ—¶é—´éš¾ä»¥ç†è§£çš„åå­—ï¼š<strong>Reactor æ¨¡å¼</strong>ã€‚</p><p>Reactor ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ã€Œååº”å †ã€ï¼Œå¯èƒ½å¤§å®¶ä¼šè”æƒ³åˆ°ç‰©ç†å­¦é‡Œçš„æ ¸ååº”å †ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯çš„è¿™ä¸ªæ„æ€ã€‚</p><p>è¿™é‡Œçš„ååº”æŒ‡çš„æ˜¯ã€Œ<strong>å¯¹äº‹ä»¶ååº”</strong>ã€ï¼Œä¹Ÿå°±æ˜¯<strong>æ¥äº†ä¸€ä¸ªäº‹ä»¶ï¼ŒReactor å°±æœ‰ç›¸å¯¹åº”çš„ååº”/å“åº”</strong>ã€‚</p><p>äº‹å®ä¸Šï¼ŒReactor æ¨¡å¼ä¹Ÿå« <code>Dispatcher</code> æ¨¡å¼ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåå­—æ›´è´´åˆè¯¥æ¨¡å¼çš„å«ä¹‰ï¼Œå³ <strong>I/O å¤šè·¯å¤ç”¨ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®äº‹ä»¶ç±»å‹åˆ†é…ï¼ˆDispatchï¼‰ç»™æŸä¸ªè¿›ç¨‹ / çº¿ç¨‹</strong>ã€‚</p><p>Reactor æ¨¡å¼ä¸»è¦ç”± Reactor å’Œå¤„ç†èµ„æºæ± è¿™ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼Œå®ƒä¿©è´Ÿè´£çš„äº‹æƒ…å¦‚ä¸‹ï¼š</p><ul><li>Reactor è´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œäº‹ä»¶ç±»å‹åŒ…å«è¿æ¥äº‹ä»¶ã€è¯»å†™äº‹ä»¶ï¼›</li><li>å¤„ç†èµ„æºæ± è´Ÿè´£å¤„ç†äº‹ä»¶ï¼Œå¦‚ read -&gt; ä¸šåŠ¡é€»è¾‘ -&gt; sendï¼›</li></ul><p>Reactor æ¨¡å¼æ˜¯çµæ´»å¤šå˜çš„ï¼Œå¯ä»¥åº”å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œçµæ´»åœ¨äºï¼š</p><ul><li>Reactor çš„æ•°é‡å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼›</li><li>å¤„ç†èµ„æºæ± å¯ä»¥æ˜¯å•ä¸ªè¿›ç¨‹ / çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªè¿›ç¨‹ /çº¿ç¨‹ï¼›</li></ul><p>å°†ä¸Šé¢çš„ä¸¤ä¸ªå› ç´ æ’åˆ—ç»„è®¾ä¸€ä¸‹ï¼Œç†è®ºä¸Šå°±å¯ä»¥æœ‰ 4 ç§æ–¹æ¡ˆé€‰æ‹©ï¼š</p><ul><li>å• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼›</li><li>å• Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼›</li><li>å¤š Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼›</li><li>å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼›</li></ul><p>å…¶ä¸­ï¼Œã€Œå¤š Reactor å•è¿›ç¨‹ / çº¿ç¨‹ã€å®ç°æ–¹æ¡ˆç›¸æ¯”ã€Œå• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ã€æ–¹æ¡ˆï¼Œä¸ä»…å¤æ‚è€Œä¸”ä¹Ÿæ²¡æœ‰æ€§èƒ½ä¼˜åŠ¿ï¼Œå› æ­¤å®é™…ä¸­å¹¶æ²¡æœ‰åº”ç”¨ã€‚</p><p>å‰©ä¸‹çš„ 3 ä¸ªæ–¹æ¡ˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„ï¼Œä¸”éƒ½æœ‰åº”ç”¨åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼š</p><ul><li>å• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼›</li><li>å• Reactor å¤šçº¿ç¨‹ / è¿›ç¨‹ï¼›</li><li>å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼›</li></ul><p>æ–¹æ¡ˆå…·ä½“ä½¿ç”¨è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Œè¦çœ‹ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ä»¥åŠå¹³å°æœ‰å…³ï¼š</p><ul><li>Java è¯­è¨€ä¸€èˆ¬ä½¿ç”¨çº¿ç¨‹ï¼Œæ¯”å¦‚ Netty;</li><li>C è¯­è¨€ä½¿ç”¨è¿›ç¨‹å’Œçº¿ç¨‹éƒ½å¯ä»¥ï¼Œä¾‹å¦‚ Nginx ä½¿ç”¨çš„æ˜¯è¿›ç¨‹ï¼ŒMemcache ä½¿ç”¨çš„æ˜¯çº¿ç¨‹ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä»‹ç»è¿™ä¸‰ä¸ªç»å…¸çš„ Reactor æ–¹æ¡ˆã€‚</p><h4 id="reactor" tabindex="-1"><a class="header-anchor" href="#reactor" aria-hidden="true">#</a> Reactor</h4><h5 id="å•-reactor-å•è¿›ç¨‹-çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#å•-reactor-å•è¿›ç¨‹-çº¿ç¨‹" aria-hidden="true">#</a> å• Reactor å•è¿›ç¨‹ / çº¿ç¨‹</h5><p>ä¸€èˆ¬æ¥è¯´ï¼ŒC è¯­è¨€å®ç°çš„æ˜¯ã€Œ<strong>å• Reactor *å•è¿›ç¨‹*</strong>ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º C è¯­ç¼–å†™å®Œçš„ç¨‹åºï¼Œè¿è¡Œåå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åœ¨è¿›ç¨‹ä¸­å†åˆ›å»ºçº¿ç¨‹ã€‚</p><p>è€Œ Java è¯­è¨€å®ç°çš„æ˜¯ã€Œ<strong>å• Reactor *å•çº¿ç¨‹*</strong>ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Java ç¨‹åºæ˜¯è·‘åœ¨ Java è™šæ‹Ÿæœºè¿™ä¸ªè¿›ç¨‹ä¸Šé¢çš„ï¼Œè™šæ‹Ÿæœºä¸­æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å†™çš„ Java ç¨‹åºåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªçº¿ç¨‹è€Œå·²ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ã€Œ<strong>å• Reactor å•è¿›ç¨‹</strong>ã€çš„æ–¹æ¡ˆç¤ºæ„å›¾ï¼š</p><figure><img src="'+k+'" alt="image-20220725152351105" tabindex="0" loading="lazy"><figcaption>image-20220725152351105</figcaption></figure><p>å¯ä»¥çœ‹åˆ°è¿›ç¨‹é‡Œæœ‰ <strong>Reactorã€Acceptorã€Handler</strong> è¿™ä¸‰ä¸ªå¯¹è±¡ï¼š</p><ul><li>Reactor å¯¹è±¡çš„ä½œç”¨æ˜¯ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼›</li><li>Acceptor å¯¹è±¡çš„ä½œç”¨æ˜¯è·å–è¿æ¥ï¼›</li><li>Handler å¯¹è±¡çš„ä½œç”¨æ˜¯å¤„ç†ä¸šåŠ¡ï¼›</li></ul><p>å¯¹è±¡é‡Œçš„ selectã€acceptã€readã€send æ˜¯ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œdispatch å’Œ ã€Œä¸šåŠ¡å¤„ç†ã€æ˜¯éœ€è¦å®Œæˆçš„æ“ä½œï¼Œå…¶ä¸­ dispatch æ˜¯åˆ†å‘äº‹ä»¶æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸‹ã€Œå• Reactor å•è¿›ç¨‹ã€è¿™ä¸ªæ–¹æ¡ˆï¼š</p><ul><li>Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼›</li><li>å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼›</li><li>å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼›</li><li>Handler å¯¹è±¡é€šè¿‡ read -&gt; ä¸šåŠ¡å¤„ç† -&gt; send çš„æµç¨‹æ¥å®Œæˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚</li></ul><p>å• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆå› ä¸ºå…¨éƒ¨å·¥ä½œéƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…å®Œæˆï¼Œæ‰€ä»¥å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘è¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå¤šè¿›ç¨‹ç«äº‰ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆå­˜åœ¨ 2 ä¸ªç¼ºç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>æ— æ³•å……åˆ†åˆ©ç”¨ å¤šæ ¸ CPU çš„æ€§èƒ½</strong>ï¼›</li><li>ç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒHandler å¯¹è±¡åœ¨ä¸šåŠ¡å¤„ç†æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ˜¯æ— æ³•å¤„ç†å…¶ä»–è¿æ¥çš„äº‹ä»¶çš„ï¼Œ<strong>å¦‚æœä¸šåŠ¡å¤„ç†è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆå°±é€ æˆå“åº”çš„å»¶è¿Ÿ</strong>ï¼›</li></ul><p>æ‰€ä»¥ï¼Œå• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆ<strong>ä¸é€‚ç”¨è®¡ç®—æœºå¯†é›†å‹çš„åœºæ™¯ï¼Œåªé€‚ç”¨äºä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿçš„åœºæ™¯</strong>ã€‚</p><p>Redis æ˜¯ç”± C è¯­è¨€å®ç°çš„ï¼Œåœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹å‰é‡‡ç”¨çš„æ­£æ˜¯ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Redis ä¸šåŠ¡å¤„ç†ä¸»è¦æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œæ“ä½œçš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ä¸Šï¼Œæ‰€ä»¥ Redis å¯¹äºå‘½ä»¤çš„å¤„ç†æ˜¯å•è¿›ç¨‹çš„æ–¹æ¡ˆã€‚</p><h5 id="å•-reactor-å¤šçº¿ç¨‹-å¤šè¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#å•-reactor-å¤šçº¿ç¨‹-å¤šè¿›ç¨‹" aria-hidden="true">#</a> å• Reactor å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹</h5><p>å¦‚æœè¦å…‹æœã€Œå• Reactor å•çº¿ç¨‹ / è¿›ç¨‹ã€æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼•å…¥å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†<strong>å• Reactor å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹</strong>çš„æ–¹æ¡ˆã€‚</p><p>é—»å…¶åä¸å¦‚çœ‹å…¶å›¾ï¼Œå…ˆæ¥çœ‹çœ‹ã€Œå• Reactor å¤šçº¿ç¨‹ã€æ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+m+'" alt="image-20220725152423113" tabindex="0" loading="lazy"><figcaption>image-20220725152423113</figcaption></figure><p>è¯¦ç»†è¯´ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼š</p><ul><li>Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼›</li><li>å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼›</li><li>å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼›</li></ul><p>ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤å’Œå• Reactor å•çº¿ç¨‹æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¼€å§‹ä¸ä¸€æ ·äº†ï¼š</p><ul><li>Handler å¯¹è±¡ä¸å†è´Ÿè´£ä¸šåŠ¡å¤„ç†ï¼Œåªè´Ÿè´£æ•°æ®çš„æ¥æ”¶å’Œå‘é€ï¼ŒHandler å¯¹è±¡é€šè¿‡ read è¯»å–åˆ°æ•°æ®åï¼Œä¼šå°†æ•°æ®å‘ç»™å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼›</li><li>å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡å°±è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¤„ç†å®Œåï¼Œå°†ç»“æœå‘ç»™ä¸»çº¿ç¨‹ä¸­çš„ Handler å¯¹è±¡ï¼Œæ¥ç€ç”± Handler é€šè¿‡ send æ–¹æ³•å°†å“åº”ç»“æœå‘é€ç»™ clientï¼›</li></ul><p>å• Reator å¤šçº¿ç¨‹çš„æ–¹æ¡ˆä¼˜åŠ¿åœ¨äº<strong>èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„èƒ½</strong>ï¼Œé‚£æ—¢ç„¶å¼•å…¥å¤šçº¿ç¨‹ï¼Œé‚£ä¹ˆè‡ªç„¶å°±å¸¦æ¥äº†å¤šçº¿ç¨‹ç«äº‰èµ„æºçš„é—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼Œå­çº¿ç¨‹å®Œæˆä¸šåŠ¡å¤„ç†åï¼Œè¦æŠŠç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹çš„ Handler è¿›è¡Œå‘é€ï¼Œè¿™é‡Œæ¶‰åŠå…±äº«æ•°æ®çš„ç«äº‰ã€‚</p><p>è¦é¿å…å¤šçº¿ç¨‹ç”±äºç«äº‰å…±äº«èµ„æºè€Œå¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ï¼Œå°±éœ€è¦åœ¨æ“ä½œå…±äº«èµ„æºå‰åŠ ä¸Šäº’æ–¥é”ï¼Œä»¥ä¿è¯ä»»æ„æ—¶é—´é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«èµ„æºï¼Œå¾…è¯¥çº¿ç¨‹æ“ä½œå®Œé‡Šæ”¾äº’æ–¥é”åï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šæ“ä½œå…±äº«æ•°æ®ã€‚</p><p>èŠå®Œå• Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œæ¥ç€æ¥çœ‹çœ‹å• Reactor å¤šè¿›ç¨‹çš„æ–¹æ¡ˆã€‚</p><p>äº‹å®ä¸Šï¼Œå• Reactor å¤šè¿›ç¨‹ç›¸æ¯”å• Reactor å¤šçº¿ç¨‹å®ç°èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¸»è¦å› ä¸ºè¦è€ƒè™‘å­è¿›ç¨‹ &lt;-&gt; çˆ¶è¿›ç¨‹çš„åŒå‘é€šä¿¡ï¼Œå¹¶ä¸”çˆ¶è¿›ç¨‹è¿˜å¾—çŸ¥é“å­è¿›ç¨‹è¦å°†æ•°æ®å‘é€ç»™å“ªä¸ªå®¢æˆ·ç«¯ã€‚</p><p>è€Œå¤šçº¿ç¨‹é—´å¯ä»¥å…±äº«æ•°æ®ï¼Œè™½ç„¶è¦é¢å¤–è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯è¿™è¿œæ¯”è¿›ç¨‹é—´é€šä¿¡çš„å¤æ‚åº¦ä½å¾—å¤šï¼Œå› æ­¤å®é™…åº”ç”¨ä¸­ä¹Ÿçœ‹ä¸åˆ°å• Reactor å¤šè¿›ç¨‹çš„æ¨¡å¼ã€‚</p><p>å¦å¤–ï¼Œã€Œå• Reactorã€çš„æ¨¡å¼è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ<strong>å› ä¸ºä¸€ä¸ª Reactor å¯¹è±¡æ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œè€Œä¸”åªåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œåœ¨é¢å¯¹ç¬é—´é«˜å¹¶å‘çš„åœºæ™¯æ—¶ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆçš„åœ°æ–¹</strong>ã€‚</p><h5 id="å¤š-reactor-å¤šè¿›ç¨‹-çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#å¤š-reactor-å¤šè¿›ç¨‹-çº¿ç¨‹" aria-hidden="true">#</a> å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹</h5><p>è¦è§£å†³ã€Œå• Reactorã€çš„é—®é¢˜ï¼Œå°±æ˜¯å°†ã€Œå• Reactorã€å®ç°æˆã€Œå¤š Reactorã€ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ç¬¬ <strong>å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹</strong>çš„æ–¹æ¡ˆã€‚</p><p>è€è§„çŸ©ï¼Œé—»å…¶åä¸å¦‚çœ‹å…¶å›¾ã€‚å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹æ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆä»¥çº¿ç¨‹ä¸ºä¾‹ï¼‰ï¼š</p><figure><img src="'+g+'" alt="image-20220725152443546" tabindex="0" loading="lazy"><figcaption>image-20220725152443546</figcaption></figure><p>æ–¹æ¡ˆè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li>ä¸»çº¿ç¨‹ä¸­çš„ MainReactor å¯¹è±¡é€šè¿‡ select ç›‘æ§è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ Acceptor å¯¹è±¡ä¸­çš„ accept è·å–è¿æ¥ï¼Œå°†æ–°çš„è¿æ¥åˆ†é…ç»™æŸä¸ªå­çº¿ç¨‹ï¼›</li><li>å­çº¿ç¨‹ä¸­çš„ SubReactor å¯¹è±¡å°† MainReactor å¯¹è±¡åˆ†é…çš„è¿æ¥åŠ å…¥ select ç»§ç»­è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler ç”¨äºå¤„ç†è¿æ¥çš„å“åº”äº‹ä»¶ã€‚</li><li>å¦‚æœæœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSubReactor å¯¹è±¡ä¼šè°ƒç”¨å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ã€‚</li><li>Handler å¯¹è±¡é€šè¿‡ read -&gt; ä¸šåŠ¡å¤„ç† -&gt; send çš„æµç¨‹æ¥å®Œæˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚</li></ul><p>å¤š Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆè™½ç„¶çœ‹èµ·æ¥å¤æ‚çš„ï¼Œä½†æ˜¯å®é™…å®ç°æ—¶æ¯”å• Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆè¦ç®€å•çš„å¤šï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹åˆ†å·¥æ˜ç¡®ï¼Œä¸»çº¿ç¨‹åªè´Ÿè´£æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹è´Ÿè´£å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†ã€‚</li><li>ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„äº¤äº’å¾ˆç®€å•ï¼Œä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— é¡»è¿”å›æ•°æ®ï¼Œç›´æ¥å°±å¯ä»¥åœ¨å­çº¿ç¨‹å°†å¤„ç†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>å¤§åé¼é¼çš„ä¸¤ä¸ªå¼€æºè½¯ä»¶ Netty å’Œ Memcache éƒ½é‡‡ç”¨äº†ã€Œå¤š Reactor å¤šçº¿ç¨‹ã€çš„æ–¹æ¡ˆã€‚</p><p>é‡‡ç”¨äº†ã€Œå¤š Reactor å¤šè¿›ç¨‹ã€æ–¹æ¡ˆçš„å¼€æºè½¯ä»¶æ˜¯ Nginxï¼Œä¸è¿‡æ–¹æ¡ˆä¸æ ‡å‡†çš„å¤š Reactor å¤šè¿›ç¨‹æœ‰äº›å·®å¼‚ã€‚</p><p>å…·ä½“å·®å¼‚è¡¨ç°åœ¨ä¸»è¿›ç¨‹ä¸­ä»…ä»…ç”¨æ¥åˆå§‹åŒ– socketï¼Œå¹¶æ²¡æœ‰åˆ›å»º mainReactor æ¥ accept è¿æ¥ï¼Œè€Œæ˜¯ç”±å­è¿›ç¨‹çš„ Reactor æ¥ accept è¿æ¥ï¼Œé€šè¿‡é”æ¥æ§åˆ¶ä¸€æ¬¡åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹è¿›è¡Œ acceptï¼ˆé˜²æ­¢å‡ºç°æƒŠç¾¤ç°è±¡ï¼‰ï¼Œå­è¿›ç¨‹ accept æ–°è¿æ¥åå°±æ”¾åˆ°è‡ªå·±çš„ Reactor è¿›è¡Œå¤„ç†ï¼Œä¸ä¼šå†åˆ†é…ç»™å…¶ä»–å­è¿›ç¨‹ã€‚</p><h4 id="proactor" tabindex="-1"><a class="header-anchor" href="#proactor" aria-hidden="true">#</a> Proactor</h4><p>å‰é¢æåˆ°çš„ Reactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œè€Œ <strong>Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼</strong>ã€‚</p><p>è¿™é‡Œå…ˆç»™å¤§å®¶å¤ä¹ ä¸‹é˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥ I/O çš„æ¦‚å¿µã€‚</p><p>å…ˆæ¥çœ‹çœ‹<strong>é˜»å¡ I/O</strong>ï¼Œå½“ç”¨æˆ·ç¨‹åºæ‰§è¡Œ <code>read</code> ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œä¸€ç›´ç­‰åˆ°å†…æ ¸æ•°æ®å‡†å¤‡å¥½ï¼Œå¹¶æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºä¸­ï¼Œå½“æ‹·è´è¿‡ç¨‹å®Œæˆï¼Œ<code>read</code> æ‰ä¼šè¿”å›ã€‚</p><p>æ³¨æ„ï¼Œ<strong>é˜»å¡ç­‰å¾…çš„æ˜¯ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€è¿™ä¸¤ä¸ªè¿‡ç¨‹</strong>ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+h+'" alt="image-20220725152513494" tabindex="0" loading="lazy"><figcaption>image-20220725152513494</figcaption></figure><p>çŸ¥é“äº†é˜»å¡ I/O ï¼Œæ¥çœ‹çœ‹<strong>éé˜»å¡ I/O</strong>ï¼Œéé˜»å¡çš„ read è¯·æ±‚åœ¨æ•°æ®æœªå‡†å¤‡å¥½çš„æƒ…å†µä¸‹ç«‹å³è¿”å›ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºä¸æ–­è½®è¯¢å†…æ ¸ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œå†…æ ¸å°†æ•°æ®æ‹·è´åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºï¼Œ<code>read</code> è°ƒç”¨æ‰å¯ä»¥è·å–åˆ°ç»“æœã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+v+'" alt="image-20220725152523692" tabindex="0" loading="lazy"><figcaption>image-20220725152523692</figcaption></figure><p>æ³¨æ„ï¼Œ<strong>è¿™é‡Œæœ€åä¸€æ¬¡ read è°ƒç”¨ï¼Œè·å–æ•°æ®çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªåŒæ­¥çš„è¿‡ç¨‹ï¼Œæ˜¯éœ€è¦ç­‰å¾…çš„è¿‡ç¨‹ã€‚è¿™é‡Œçš„åŒæ­¥æŒ‡çš„æ˜¯å†…æ ¸æ€çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¨‹åºçš„ç¼“å­˜åŒºè¿™ä¸ªè¿‡ç¨‹ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ socket è®¾ç½®äº† <code>O_NONBLOCK</code> æ ‡å¿—ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºä½¿ç”¨çš„æ˜¯éé˜»å¡ I/O çš„æ–¹å¼è®¿é—®ï¼Œè€Œä¸åšä»»ä½•è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ˜¯é˜»å¡ I/Oã€‚</p><p>å› æ­¤ï¼Œæ— è®º read å’Œ send æ˜¯é˜»å¡ I/Oï¼Œè¿˜æ˜¯éé˜»å¡ I/O éƒ½æ˜¯åŒæ­¥è°ƒç”¨ã€‚å› ä¸ºåœ¨ read è°ƒç”¨æ—¶ï¼Œå†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„è¿‡ç¨‹éƒ½æ˜¯éœ€è¦ç­‰å¾…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœå†…æ ¸å®ç°çš„æ‹·è´æ•ˆç‡ä¸é«˜ï¼Œread è°ƒç”¨å°±ä¼šåœ¨è¿™ä¸ªåŒæ­¥è¿‡ç¨‹ä¸­ç­‰å¾…æ¯”è¾ƒé•¿çš„æ—¶é—´ã€‚</p><p>è€ŒçœŸæ­£çš„<strong>å¼‚æ­¥ I/O</strong> æ˜¯ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€è¿™<strong>ä¸¤ä¸ªè¿‡ç¨‹éƒ½ä¸ç”¨ç­‰å¾…</strong>ã€‚</p><p>å½“æˆ‘ä»¬å‘èµ· <code>aio_read</code> ï¼ˆå¼‚æ­¥ I/Oï¼‰ ä¹‹åï¼Œå°±ç«‹å³è¿”å›ï¼Œå†…æ ¸è‡ªåŠ¨å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¸ªæ‹·è´è¿‡ç¨‹åŒæ ·æ˜¯å¼‚æ­¥çš„ï¼Œå†…æ ¸è‡ªåŠ¨å®Œæˆçš„ï¼Œå’Œå‰é¢çš„åŒæ­¥æ“ä½œä¸ä¸€æ ·ï¼Œ<strong>åº”ç”¨ç¨‹åºå¹¶ä¸éœ€è¦ä¸»åŠ¨å‘èµ·æ‹·è´åŠ¨ä½œ</strong>ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+b+'" alt="image-20220725152532905" tabindex="0" loading="lazy"><figcaption>image-20220725152532905</figcaption></figure><p>ä¸¾ä¸ªä½ å»é¥­å ‚åƒé¥­çš„ä¾‹å­ï¼Œä½ å¥½æ¯”åº”ç”¨ç¨‹åºï¼Œé¥­å ‚å¥½æ¯”æ“ä½œç³»ç»Ÿã€‚</p><p>é˜»å¡ I/O å¥½æ¯”ï¼Œä½ å»é¥­å ‚åƒé¥­ï¼Œä½†æ˜¯é¥­å ‚çš„èœè¿˜æ²¡åšå¥½ï¼Œç„¶åä½ å°±ä¸€ç›´åœ¨é‚£é‡Œç­‰å•Šç­‰ï¼Œç­‰äº†å¥½é•¿ä¸€æ®µæ—¶é—´ç»ˆäºç­‰åˆ°é¥­å ‚é˜¿å§¨æŠŠèœç«¯äº†å‡ºæ¥ï¼ˆæ•°æ®å‡†å¤‡çš„è¿‡ç¨‹ï¼‰ï¼Œä½†æ˜¯ä½ è¿˜å¾—ç»§ç»­ç­‰é˜¿å§¨æŠŠèœï¼ˆå†…æ ¸ç©ºé—´ï¼‰æ‰“åˆ°ä½ çš„é¥­ç›’é‡Œï¼ˆç”¨æˆ·ç©ºé—´ï¼‰ï¼Œç»å†å®Œè¿™ä¸¤ä¸ªè¿‡ç¨‹ï¼Œä½ æ‰å¯ä»¥ç¦»å¼€ã€‚</p><p>éé˜»å¡ I/O å¥½æ¯”ï¼Œä½ å»äº†é¥­å ‚ï¼Œé—®é˜¿å§¨èœåšå¥½äº†æ²¡æœ‰ï¼Œé˜¿å§¨å‘Šè¯‰ä½ æ²¡ï¼Œä½ å°±ç¦»å¼€äº†ï¼Œè¿‡å‡ ååˆ†é’Ÿï¼Œä½ åˆæ¥é¥­å ‚é—®é˜¿å§¨ï¼Œé˜¿å§¨è¯´åšå¥½äº†ï¼Œäºæ˜¯é˜¿å§¨å¸®ä½ æŠŠèœæ‰“åˆ°ä½ çš„é¥­ç›’é‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä½ æ˜¯å¾—ç­‰å¾…çš„ã€‚</p><p>å¼‚æ­¥ I/O å¥½æ¯”ï¼Œä½ è®©é¥­å ‚é˜¿å§¨å°†èœåšå¥½å¹¶æŠŠèœæ‰“åˆ°é¥­ç›’é‡Œåï¼ŒæŠŠé¥­ç›’é€åˆ°ä½ é¢å‰ï¼Œæ•´ä¸ªè¿‡ç¨‹ä½ éƒ½ä¸éœ€è¦ä»»ä½•ç­‰å¾…ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œå¼‚æ­¥ I/O æ¯”åŒæ­¥ I/O æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå¼‚æ­¥ I/O åœ¨ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½ä¸ç”¨ç­‰å¾…ã€‚</p><p>Proactor æ­£æ˜¯é‡‡ç”¨äº†å¼‚æ­¥ I/O æŠ€æœ¯ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå¼‚æ­¥ç½‘ç»œæ¨¡å‹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å†æ¥ç†è§£ Reactor å’Œ Proactor çš„åŒºåˆ«ï¼Œå°±æ¯”è¾ƒæ¸…æ™°äº†ã€‚</p><ul><li><strong>Reactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œæ„ŸçŸ¥çš„æ˜¯å°±ç»ªå¯è¯»å†™äº‹ä»¶</strong>ã€‚åœ¨æ¯æ¬¡æ„ŸçŸ¥åˆ°æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆæ¯”å¦‚å¯è¯»å°±ç»ªäº‹ä»¶ï¼‰åï¼Œå°±éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨è°ƒç”¨ read æ–¹æ³•æ¥å®Œæˆæ•°æ®çš„è¯»å–ï¼Œä¹Ÿå°±æ˜¯è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å°† socket æ¥æ”¶ç¼“å­˜ä¸­çš„æ•°æ®è¯»åˆ°åº”ç”¨è¿›ç¨‹å†…å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œè¯»å–å®Œæ•°æ®ååº”ç”¨è¿›ç¨‹æ‰èƒ½å¤„ç†æ•°æ®ã€‚</li><li><strong>Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼ï¼Œ æ„ŸçŸ¥çš„æ˜¯å·²å®Œæˆçš„è¯»å†™äº‹ä»¶</strong>ã€‚åœ¨å‘èµ·å¼‚æ­¥è¯»å†™è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¼ å…¥æ•°æ®ç¼“å†²åŒºçš„åœ°å€ï¼ˆç”¨æ¥å­˜æ”¾ç»“æœæ•°æ®ï¼‰ç­‰ä¿¡æ¯ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸æ‰å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠæ•°æ®çš„è¯»å†™å·¥ä½œå®Œæˆï¼Œè¿™é‡Œçš„è¯»å†™å·¥ä½œå…¨ç¨‹ç”±æ“ä½œç³»ç»Ÿæ¥åšï¼Œå¹¶ä¸éœ€è¦åƒ Reactor é‚£æ ·è¿˜éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å‘èµ· read/write æ¥è¯»å†™æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå®Œæˆè¯»å†™å·¥ä½œåï¼Œå°±ä¼šé€šçŸ¥åº”ç”¨è¿›ç¨‹ç›´æ¥å¤„ç†æ•°æ®ã€‚</li></ul><p>å› æ­¤ï¼Œ<strong>Reactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè®©åº”ç”¨è¿›ç¨‹æ¥å¤„ç†ã€</strong>ï¼Œè€Œ <strong>Proactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œå¤„ç†å®Œå†é€šçŸ¥åº”ç”¨è¿›ç¨‹ã€</strong>ã€‚è¿™é‡Œçš„ã€Œäº‹ä»¶ã€å°±æ˜¯æœ‰æ–°è¿æ¥ã€æœ‰æ•°æ®å¯è¯»ã€æœ‰æ•°æ®å¯å†™çš„è¿™äº› I/O äº‹ä»¶è¿™é‡Œçš„ã€Œå¤„ç†ã€åŒ…å«ä»é©±åŠ¨è¯»å–åˆ°å†…æ ¸ä»¥åŠä»å†…æ ¸è¯»å–åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><p>ä¸¾ä¸ªå®é™…ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼ŒReactor æ¨¡å¼å°±æ˜¯å¿«é€’å‘˜åœ¨æ¥¼ä¸‹ï¼Œç»™ä½ æ‰“ç”µè¯å‘Šè¯‰ä½ å¿«é€’åˆ°ä½ å®¶å°åŒºäº†ï¼Œä½ éœ€è¦è‡ªå·±ä¸‹æ¥¼æ¥æ‹¿å¿«é€’ã€‚è€Œåœ¨ Proactor æ¨¡å¼ä¸‹ï¼Œå¿«é€’å‘˜ç›´æ¥å°†å¿«é€’é€åˆ°ä½ å®¶é—¨å£ï¼Œç„¶åé€šçŸ¥ä½ ã€‚</p><p>æ— è®ºæ˜¯ Reactorï¼Œè¿˜æ˜¯ Proactorï¼Œéƒ½æ˜¯ä¸€ç§åŸºäºã€Œäº‹ä»¶åˆ†å‘ã€çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨äº <strong>Reactor æ¨¡å¼æ˜¯åŸºäºã€Œå¾…å®Œæˆã€çš„ I/O äº‹ä»¶ï¼Œè€Œ Proactor æ¨¡å¼åˆ™æ˜¯åŸºäºã€Œå·²å®Œæˆã€çš„ I/O äº‹ä»¶</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸€èµ·çœ‹çœ‹ Proactor æ¨¡å¼çš„ç¤ºæ„å›¾ï¼š</p><figure><img src="'+f+'" alt="image-20220725152542296" tabindex="0" loading="lazy"><figcaption>image-20220725152542296</figcaption></figure><p>ä»‹ç»ä¸€ä¸‹ Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹ï¼š</p><ul><li>Proactor Initiator è´Ÿè´£åˆ›å»º Proactor å’Œ Handler å¯¹è±¡ï¼Œå¹¶å°† Proactor å’Œ Handler éƒ½é€šè¿‡ Asynchronous Operation Processor æ³¨å†Œåˆ°å†…æ ¸ï¼›</li><li>Asynchronous Operation Processor è´Ÿè´£å¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å¤„ç† I/O æ“ä½œï¼›</li><li>Asynchronous Operation Processor å®Œæˆ I/O æ“ä½œåé€šçŸ¥ Proactorï¼›</li><li>Proactor æ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹å›è°ƒä¸åŒçš„ Handler è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼›</li><li>Handler å®Œæˆä¸šåŠ¡å¤„ç†ï¼›</li></ul><p>å¯æƒœçš„æ˜¯ï¼Œåœ¨ Linux ä¸‹çš„å¼‚æ­¥ I/O æ˜¯ä¸å®Œå–„çš„ï¼Œ <code>aio</code> ç³»åˆ—å‡½æ•°æ˜¯ç”± POSIX å®šä¹‰çš„å¼‚æ­¥æ“ä½œæ¥å£ï¼Œä¸æ˜¯çœŸæ­£çš„æ“ä½œç³»ç»Ÿçº§åˆ«æ”¯æŒçš„ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·ç©ºé—´æ¨¡æ‹Ÿå‡ºæ¥çš„å¼‚æ­¥ï¼Œå¹¶ä¸”ä»…ä»…æ”¯æŒåŸºäºæœ¬åœ°æ–‡ä»¶çš„ aio å¼‚æ­¥æ“ä½œï¼Œç½‘ç»œç¼–ç¨‹ä¸­çš„ socket æ˜¯ä¸æ”¯æŒçš„ï¼Œè¿™ä¹Ÿä½¿å¾—åŸºäº Linux çš„é«˜æ€§èƒ½ç½‘ç»œç¨‹åºéƒ½æ˜¯ä½¿ç”¨ Reactor æ–¹æ¡ˆã€‚</p><p>è€Œ Windows é‡Œå®ç°äº†ä¸€å¥—å®Œæ•´çš„æ”¯æŒ socket çš„å¼‚æ­¥ç¼–ç¨‹æ¥å£ï¼Œè¿™å¥—æ¥å£å°±æ˜¯ <code>IOCP</code>ï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿçº§åˆ«å®ç°çš„å¼‚æ­¥ I/Oï¼ŒçœŸæ­£æ„ä¹‰ä¸Šå¼‚æ­¥ I/Oï¼Œå› æ­¤åœ¨ Windows é‡Œå®ç°é«˜æ€§èƒ½ç½‘ç»œç¨‹åºå¯ä»¥ä½¿ç”¨æ•ˆç‡æ›´é«˜çš„ Proactor æ–¹æ¡ˆã€‚</p><h3 id="é›¶æ‹·è´æ·±å…¥æµ…å‡º" tabindex="-1"><a class="header-anchor" href="#é›¶æ‹·è´æ·±å…¥æµ…å‡º" aria-hidden="true">#</a> â­é›¶æ‹·è´æ·±å…¥æµ…å‡º</h3><h4 id="dma" tabindex="-1"><a class="header-anchor" href="#dma" aria-hidden="true">#</a> DMA</h4><p>åœ¨æ²¡æœ‰ DMA æŠ€æœ¯å‰ï¼ŒI/O çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>CPU å‘å‡ºå¯¹åº”çš„æŒ‡ä»¤ç»™ç£ç›˜æ§åˆ¶å™¨ï¼Œç„¶åè¿”å›ï¼›</li><li>ç£ç›˜æ§åˆ¶å™¨æ”¶åˆ°æŒ‡ä»¤åï¼Œäºæ˜¯å°±å¼€å§‹å‡†å¤‡æ•°æ®ï¼Œä¼šæŠŠæ•°æ®æ”¾å…¥åˆ°ç£ç›˜æ§åˆ¶å™¨çš„å†…éƒ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ª<strong>ä¸­æ–­</strong>ï¼›</li><li>CPU æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œåœä¸‹æ‰‹å¤´çš„å·¥ä½œï¼Œæ¥ç€æŠŠç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°è¯»è¿›è‡ªå·±çš„å¯„å­˜å™¨ï¼Œç„¶åå†æŠŠå¯„å­˜å™¨é‡Œçš„æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œè€Œåœ¨æ•°æ®ä¼ è¾“çš„æœŸé—´ CPU æ˜¯æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡çš„ã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å‰¯å›¾ï¼š</p><figure><img src="'+w+'" alt="image-20220702132804386" tabindex="0" loading="lazy"><figcaption>image-20220702132804386</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ï¼Œéƒ½è¦éœ€è¦ CPU äº²è‡ªå‚ä¸æ¬è¿æ•°æ®çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ï¼ŒCPU æ˜¯ä¸èƒ½åšå…¶ä»–äº‹æƒ…çš„ã€‚</p><p>ç®€å•çš„æ¬è¿å‡ ä¸ªå­—ç¬¦æ•°æ®é‚£æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨åƒå…†ç½‘å¡æˆ–è€…ç¡¬ç›˜ä¼ è¾“å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ç”¨ CPU æ¥æ¬è¿çš„è¯ï¼Œè‚¯å®šå¿™ä¸è¿‡æ¥ã€‚</p><p>è®¡ç®—æœºç§‘å­¦å®¶ä»¬å‘ç°äº†äº‹æƒ…çš„ä¸¥é‡æ€§åï¼Œäºæ˜¯å°±å‘æ˜äº† DMA æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯<strong>ç›´æ¥å†…å­˜è®¿é—®ï¼ˆ*Direct Memory Access*ï¼‰</strong> æŠ€æœ¯ã€‚</p><p>ä»€ä¹ˆæ˜¯ DMA æŠ€æœ¯ï¼Ÿç®€å•ç†è§£å°±æ˜¯ï¼Œ<strong>åœ¨è¿›è¡Œ I/O è®¾å¤‡å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡</strong>ã€‚</p><p>é‚£ä½¿ç”¨ DMA æ§åˆ¶å™¨è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ã€‚</p><figure><img src="'+_+`" alt="image-20220702132824828" tabindex="0" loading="lazy"><figcaption>image-20220702132824828</figcaption></figure><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li><li>æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼›</li><li>DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼›</li><li>ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼›</li><li><strong>DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡</strong>ï¼›</li><li>å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼›</li><li>CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼›</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ æ•´ä¸ªæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ï¼ŒCPU ä¸å†å‚ä¸æ•°æ®æ¬è¿çš„å·¥ä½œï¼Œè€Œæ˜¯å…¨ç¨‹ç”± DMA å®Œæˆï¼Œä½†æ˜¯ CPU åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œä¼ è¾“åˆ°å“ªé‡Œï¼Œéƒ½éœ€è¦ CPU æ¥å‘Šè¯‰ DMA æ§åˆ¶å™¨ã€‚</p><p>æ—©æœŸ DMA åªå­˜åœ¨åœ¨ä¸»æ¿ä¸Šï¼Œå¦‚ä»Šç”±äº I/O è®¾å¤‡è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®ä¼ è¾“çš„éœ€æ±‚ä¹Ÿä¸å°½ç›¸åŒï¼Œæ‰€ä»¥æ¯ä¸ª I/O è®¾å¤‡é‡Œé¢éƒ½æœ‰è‡ªå·±çš„ DMA æ§åˆ¶å™¨</p><h4 id="å¦‚ä½•å®ç°é›¶æ‹·è´" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å®ç°é›¶æ‹·è´" aria-hidden="true">#</a> å¦‚ä½•å®ç°é›¶æ‹·è´ï¼Ÿ</h4><p>é›¶æ‹·è´æŠ€æœ¯å®ç°çš„æ–¹å¼é€šå¸¸æœ‰ 2 ç§ï¼š</p><ul><li>mmap + write</li><li>sendfile</li></ul><p>ä¸‹é¢å°±è°ˆä¸€è°ˆï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å‡å°‘ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€å’Œã€Œæ•°æ®æ‹·è´ã€çš„æ¬¡æ•°ã€‚</p><h4 id="mmap-write" tabindex="-1"><a class="header-anchor" href="#mmap-write" aria-hidden="true">#</a> mmap + write</h4><p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œ<code>read()</code> ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯ä¸ºäº†å‡å°‘è¿™ä¸€æ­¥å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>mmap()</code> æ›¿æ¢ <code>read()</code> ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>buf <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>mmap()</code> ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¼šç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®ã€Œ<strong>æ˜ å°„</strong>ã€åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™æ ·ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•çš„æ•°æ®æ‹·è´æ“ä½œã€‚</p><figure><img src="`+S+`" alt="image-20220702133239391" tabindex="0" loading="lazy"><figcaption>image-20220702133239391</figcaption></figure><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨è¿›ç¨‹è°ƒç”¨äº† <code>mmap()</code> åï¼ŒDMA ä¼šæŠŠç£ç›˜çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸çš„ç¼“å†²åŒºé‡Œã€‚æ¥ç€ï¼Œåº”ç”¨è¿›ç¨‹è·Ÿæ“ä½œç³»ç»Ÿå†…æ ¸ã€Œå…±äº«ã€è¿™ä¸ªç¼“å†²åŒºï¼›</li><li>åº”ç”¨è¿›ç¨‹å†è°ƒç”¨ <code>write()</code>ï¼Œæ“ä½œç³»ç»Ÿç›´æ¥å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºä¸­ï¼Œè¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ï¼Œç”± CPU æ¥æ¬è¿æ•°æ®ï¼›</li><li>æœ€åï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± DMA æ¬è¿çš„ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œé€šè¿‡ä½¿ç”¨ <code>mmap()</code> æ¥ä»£æ›¿ <code>read()</code>ï¼Œ å¯ä»¥å‡å°‘ä¸€æ¬¡æ•°æ®æ‹·è´çš„è¿‡ç¨‹ã€‚</p><p>ä½†è¿™è¿˜ä¸æ˜¯æœ€ç†æƒ³çš„é›¶æ‹·è´ï¼Œå› ä¸ºä»ç„¶éœ€è¦é€šè¿‡ CPU æŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œè€Œä¸”ä»ç„¶éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨è¿˜æ˜¯ 2 æ¬¡ã€‚</p><h4 id="sendfile" tabindex="-1"><a class="header-anchor" href="#sendfile" aria-hidden="true">#</a> sendfile</h4><p>åœ¨ Linux å†…æ ¸ç‰ˆæœ¬ 2.1 ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªä¸“é—¨å‘é€æ–‡ä»¶çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•° <code>sendfile()</code>ï¼Œå‡½æ•°å½¢å¼å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token class-name">ssize_t</span> <span class="token function">sendfile</span><span class="token punctuation">(</span><span class="token keyword">int</span> out_fd<span class="token punctuation">,</span> <span class="token keyword">int</span> in_fd<span class="token punctuation">,</span> <span class="token class-name">off_t</span> <span class="token operator">*</span>offset<span class="token punctuation">,</span> <span class="token class-name">size_t</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®çš„ç«¯å’Œæºç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåé¢ä¸¤ä¸ªå‚æ•°æ˜¯æºç«¯çš„åç§»é‡å’Œå¤åˆ¶æ•°æ®çš„é•¿åº¦ï¼Œè¿”å›å€¼æ˜¯å®é™…å¤åˆ¶æ•°æ®çš„é•¿åº¦ã€‚</p><p>é¦–å…ˆï¼Œå®ƒå¯ä»¥æ›¿ä»£å‰é¢çš„ <code>read()</code> å’Œ <code>write()</code> è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±å‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p><p>å…¶æ¬¡ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œä¸å†æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè¿™æ ·å°±åªæœ‰ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 3 æ¬¡æ•°æ®æ‹·è´ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="`+x+`" alt="image-20220702133308560" tabindex="0" loading="lazy"><figcaption>image-20220702133308560</figcaption></figure><p>ä½†æ˜¯è¿™è¿˜ä¸æ˜¯çœŸæ­£çš„é›¶æ‹·è´æŠ€æœ¯ï¼Œå¦‚æœç½‘å¡æ”¯æŒ SG-DMAï¼ˆ<em>The Scatter-Gather Direct Memory Access</em>ï¼‰æŠ€æœ¯ï¼ˆå’Œæ™®é€šçš„ DMA æœ‰æ‰€ä¸åŒï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å‡å°‘é€šè¿‡ CPU æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºçš„è¿‡ç¨‹ã€‚</p><p>ä½ å¯ä»¥åœ¨ä½ çš„ Linux ç³»ç»Ÿé€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹ç½‘å¡æ˜¯å¦æ”¯æŒ scatter-gather ç‰¹æ€§ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">ethtool</span> <span class="token parameter variable">-k</span> eth0 <span class="token operator">|</span> <span class="token function">grep</span> scatter-gather
scatter-gather: on
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>äºæ˜¯ï¼Œä» Linux å†…æ ¸ <code>2.4</code> ç‰ˆæœ¬å¼€å§‹èµ·ï¼Œå¯¹äºæ”¯æŒç½‘å¡æ”¯æŒ SG-DMA æŠ€æœ¯çš„æƒ…å†µä¸‹ï¼Œ <code>sendfile()</code> ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹å‘ç”Ÿäº†ç‚¹å˜åŒ–ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ DMA å°†ç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºé‡Œï¼›</li><li>ç¬¬äºŒæ­¥ï¼Œç¼“å†²åŒºæè¿°ç¬¦å’Œæ•°æ®é•¿åº¦ä¼ åˆ° socket ç¼“å†²åŒºï¼Œè¿™æ ·ç½‘å¡çš„ SG-DMA æ§åˆ¶å™¨å°±å¯ä»¥ç›´æ¥å°†å†…æ ¸ç¼“å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œæ­¤è¿‡ç¨‹ä¸éœ€è¦å°†æ•°æ®ä»æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° socket ç¼“å†²åŒºä¸­ï¼Œè¿™æ ·å°±å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼›</li></ul><p>æ‰€ä»¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹‹ä¸­ï¼Œåªè¿›è¡Œäº† 2 æ¬¡æ•°æ®æ‹·è´ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="`+y+`" alt="image-20220702133318801" tabindex="0" loading="lazy"><figcaption>image-20220702133318801</figcaption></figure><p>è¿™å°±æ˜¯æ‰€è°“çš„<strong>é›¶æ‹·è´ï¼ˆ*Zero-copy*ï¼‰æŠ€æœ¯ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨å†…å­˜å±‚é¢å»æ‹·è´æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å…¨ç¨‹æ²¡æœ‰é€šè¿‡ CPU æ¥æ¬è¿æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é€šè¿‡ DMA æ¥è¿›è¡Œä¼ è¾“çš„ã€‚</strong>ã€‚</p><p>é›¶æ‹·è´æŠ€æœ¯çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ç›¸æ¯”ä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“çš„æ–¹å¼ï¼Œå‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œ<strong>åªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå°±å¯ä»¥å®Œæˆæ–‡ä»¶çš„ä¼ è¾“ï¼Œè€Œä¸” 2 æ¬¡çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦é€šè¿‡ CPUï¼Œ2 æ¬¡éƒ½æ˜¯ç”± DMA æ¥æ¬è¿ã€‚</strong></p><p>æ‰€ä»¥ï¼Œæ€»ä½“æ¥çœ‹ï¼Œ<strong>é›¶æ‹·è´æŠ€æœ¯å¯ä»¥æŠŠæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½æé«˜è‡³å°‘ä¸€å€ä»¥ä¸Š</strong></p><h4 id="ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯çš„é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯çš„é¡¹ç›®" aria-hidden="true">#</a> ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯çš„é¡¹ç›®</h4><p>äº‹å®ä¸Šï¼ŒKafka è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œå°±åˆ©ç”¨äº†ã€Œé›¶æ‹·è´ã€æŠ€æœ¯ï¼Œä»è€Œå¤§å¹…æå‡äº† I/O çš„ååç‡ï¼Œè¿™ä¹Ÿæ˜¯ Kafka åœ¨å¤„ç†æµ·é‡æ•°æ®ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«çš„åŸå› ä¹‹ä¸€ã€‚</p><p>å¦‚æœä½ è¿½æº¯ Kafka æ–‡ä»¶ä¼ è¾“çš„ä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œæœ€ç»ˆå®ƒè°ƒç”¨äº† Java NIO åº“é‡Œçš„ <code>transferTo</code> æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Overridepublic</span> 
<span class="token keyword">long</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token class-name">FileChannel</span> fileChannel<span class="token punctuation">,</span> <span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> fileChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> count<span class="token punctuation">,</span> socketChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ Linux ç³»ç»Ÿæ”¯æŒ <code>sendfile()</code> ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆ <code>transferTo()</code> å®é™…ä¸Šæœ€åå°±ä¼šä½¿ç”¨åˆ° <code>sendfile()</code> ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚</p><p>æ›¾ç»æœ‰å¤§ä½¬ä¸“é—¨å†™è¿‡ç¨‹åºæµ‹è¯•è¿‡ï¼Œåœ¨åŒæ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“å’Œé›¶æ‹·æ‹·è´æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½å·®å¼‚ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™å¼ æµ‹è¯•æ•°æ®å›¾ï¼Œä½¿ç”¨äº†é›¶æ‹·è´èƒ½å¤Ÿç¼©çŸ­ <code>65%</code> çš„æ—¶é—´ï¼Œå¤§å¹…åº¦æå‡äº†æœºå™¨ä¼ è¾“æ•°æ®çš„ååé‡ã€‚</p><figure><img src="`+C+`" alt="image-20220702133411785" tabindex="0" loading="lazy"><figcaption>image-20220702133411785</figcaption></figure><p>å¦å¤–ï¼ŒNginx ä¹Ÿæ”¯æŒé›¶æ‹·è´æŠ€æœ¯ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯å¼€å¯é›¶æ‹·è´æŠ€æœ¯ï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡ï¼Œæ˜¯å¦å¼€å¯é›¶æ‹·è´æŠ€æœ¯çš„é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http {
...
    sendfile on
...
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>sendfile é…ç½®çš„å…·ä½“æ„æ€:</p><ul><li>è®¾ç½®ä¸º on è¡¨ç¤ºï¼Œä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯æ¥ä¼ è¾“æ–‡ä»¶ï¼šsendfile ï¼Œè¿™æ ·åªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 2 æ¬¡æ•°æ®æ‹·è´ã€‚</li><li>è®¾ç½®ä¸º off è¡¨ç¤ºï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“æŠ€æœ¯ï¼šread + writeï¼Œè¿™æ—¶å°±éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 4 æ¬¡æ•°æ®æ‹·è´ã€‚</li></ul><p>å½“ç„¶ï¼Œè¦ä½¿ç”¨ sendfileï¼ŒLinux å†…æ ¸ç‰ˆæœ¬å¿…é¡»è¦ 2.1 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚</p><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><p>æ—©æœŸ I/O æ“ä½œï¼Œå†…å­˜ä¸ç£ç›˜çš„æ•°æ®ä¼ è¾“çš„å·¥ä½œéƒ½æ˜¯ç”± CPU å®Œæˆçš„ï¼Œè€Œæ­¤æ—¶ CPU ä¸èƒ½æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¼šç‰¹åˆ«æµªè´¹ CPU èµ„æºã€‚</p><p>äºæ˜¯ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒDMA æŠ€æœ¯å°±å‡ºç°äº†ï¼Œæ¯ä¸ª I/O è®¾å¤‡éƒ½æœ‰è‡ªå·±çš„ DMA æ§åˆ¶å™¨ï¼Œé€šè¿‡è¿™ä¸ª DMA æ§åˆ¶å™¨ï¼ŒCPU åªéœ€è¦å‘Šè¯‰ DMA æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬è¦ä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œæ¥ï¼Œåˆ°å“ªé‡Œå»ï¼Œå°±å¯ä»¥æ”¾å¿ƒç¦»å¼€äº†ã€‚åç»­çš„å®é™…æ•°æ®ä¼ è¾“å·¥ä½œï¼Œéƒ½ä¼šç”± DMA æ§åˆ¶å™¨æ¥å®Œæˆï¼ŒCPU ä¸éœ€è¦å‚ä¸æ•°æ®ä¼ è¾“çš„å·¥ä½œã€‚</p><p>ä¼ ç»Ÿ IO çš„å·¥ä½œæ–¹å¼ï¼Œä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œç„¶åå†é€šè¿‡ç½‘å¡å‘å¤–å‘é€ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ 4 ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ 2 æ¬¡æ•°æ®æ‹·è´å‘ç”Ÿåœ¨å†…å­˜é‡Œçš„ç¼“å†²åŒºå’Œå¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡ä¹‹é—´ï¼Œè¿™ä¸ªæ˜¯ç”± DMA å®Œæˆï¼Œå¦å¤– 2 æ¬¡åˆ™å‘ç”Ÿåœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´ï¼Œè¿™ä¸ªæ•°æ®æ¬ç§»å·¥ä½œæ˜¯ç”± CPU å®Œæˆçš„ã€‚</p><p>ä¸ºäº†æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ï¼Œäºæ˜¯å°±å‡ºç°äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼ˆ<code>sendfile</code> æ–¹æ³•ï¼‰åˆå¹¶äº†ç£ç›˜è¯»å–ä¸ç½‘ç»œå‘é€ä¸¤ä¸ªæ“ä½œï¼Œé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚å¦å¤–ï¼Œæ‹·è´æ•°æ®éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸ä¸­çš„ï¼Œå¤©ç„¶å°±é™ä½äº†æ•°æ®æ‹·è´çš„æ¬¡æ•°ã€‚</p><p>Kafka å’Œ Nginx éƒ½æœ‰å®ç°é›¶æ‹·è´æŠ€æœ¯ï¼Œè¿™å°†å¤§å¤§æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ã€‚</p><p>é›¶æ‹·è´æŠ€æœ¯æ˜¯åŸºäº PageCache çš„ï¼ŒPageCache ä¼šç¼“å­˜æœ€è¿‘è®¿é—®çš„æ•°æ®ï¼Œæå‡äº†è®¿é—®ç¼“å­˜æ•°æ®çš„æ€§èƒ½ï¼ŒåŒæ—¶ï¼Œä¸ºäº†è§£å†³æœºæ¢°ç¡¬ç›˜å¯»å€æ…¢çš„é—®é¢˜ï¼Œå®ƒè¿˜ååŠ© I/O è°ƒåº¦ç®—æ³•å®ç°äº† IO åˆå¹¶ä¸é¢„è¯»ï¼Œè¿™ä¹Ÿæ˜¯é¡ºåºè¯»æ¯”éšæœºè¯»æ€§èƒ½å¥½çš„åŸå› ã€‚è¿™äº›ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥æå‡äº†é›¶æ‹·è´çš„æ€§èƒ½ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé›¶æ‹·è´æŠ€æœ¯æ˜¯ä¸å…è®¸è¿›ç¨‹å¯¹æ–‡ä»¶å†…å®¹ä½œè¿›ä¸€æ­¥çš„åŠ å·¥çš„ï¼Œæ¯”å¦‚å‹ç¼©æ•°æ®å†å‘é€ã€‚</p><p>å¦å¤–ï¼Œå½“ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œä¸èƒ½ä½¿ç”¨é›¶æ‹·è´ï¼Œå› ä¸ºå¯èƒ½ç”±äº PageCache è¢«å¤§æ–‡ä»¶å æ®ï¼Œè€Œå¯¼è‡´ã€Œçƒ­ç‚¹ã€å°æ–‡ä»¶æ— æ³•åˆ©ç”¨åˆ° PageCacheï¼Œå¹¶ä¸”å¤§æ–‡ä»¶çš„ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ã€Œå¼‚æ­¥ IO + ç›´æ¥ IO ã€çš„æ–¹å¼ã€‚</p><p>åœ¨ Nginx é‡Œï¼Œå¯ä»¥é€šè¿‡é…ç½®ï¼Œè®¾å®šä¸€ä¸ªæ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œé’ˆå¯¹å¤§æ–‡ä»¶ä½¿ç”¨å¼‚æ­¥ IO å’Œç›´æ¥ IOï¼Œè€Œå¯¹å°æ–‡ä»¶ä½¿ç”¨é›¶æ‹·è´ã€‚</p><h3 id="å®ˆæŠ¤çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#å®ˆæŠ¤çº¿ç¨‹" aria-hidden="true">#</a> å®ˆæŠ¤çº¿ç¨‹</h3><blockquote><p>é¡¶çº§ç†è§£ï¼šåœ¨éå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨ç»“æŸä¹‹åæ‰ç»“æŸçš„çº¿ç¨‹ï¼ˆåªæœ‰å½“æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹éƒ½ç»“æŸè¿è¡Œåï¼Œå®ˆæŠ¤çº¿ç¨‹æ‰ä¼šè‡ªåŠ¨ç»“æŸã€‚è¿™å°±æ˜¯å®ˆæŠ¤çº¿ç¨‹â€œå®ˆæŠ¤â€çš„å«ä¹‰ï¼‰</p></blockquote><p><strong>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰</strong> æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯åœ¨åå°ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨Javaä¸­ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ç§å…¸å‹çš„å®ˆæŠ¤çº¿ç¨‹ã€‚å½“ç¨‹åºä¸­æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹éƒ½ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šè‡ªåŠ¨ç»“æŸï¼Œè€Œä¸éœ€è¦æ˜ç¡®çš„è¢«åœæ­¢æˆ–è€…é”€æ¯ã€‚è¿™ç§çº¿ç¨‹çš„å­˜åœ¨ï¼Œå¯ä»¥å¸®åŠ©ä¸»ç¨‹åºåœ¨ä¸éœ€è¦å¤„ç†ä¸€äº›å¸¸è§„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œæ›´é‡è¦çš„ä»»åŠ¡ã€‚</p><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¸»è¦ç”¨äºæ‰§è¡Œä¸€äº›åå°ä»»åŠ¡ï¼Œå¦‚åƒåœ¾å›æ”¶ã€ç³»ç»Ÿç›‘æ§ç­‰ã€‚å®ƒä»¬é€šå¸¸åœ¨åå°è¿è¡Œï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œè€Œç”¨æˆ·é€šå¸¸å¹¶ä¸ç›´æ¥ä¸å®ƒä»¬äº¤äº’ã€‚ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§æ˜¯ï¼Œå½“æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹ï¼ˆå¦‚ç”¨æˆ·ä¸»åŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼‰éƒ½ç»“æŸè¿è¡Œæ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºã€‚è¿™æ˜¯å› ä¸ºæ­¤æ—¶åªå‰©ä¸‹å®ˆæŠ¤çº¿ç¨‹åœ¨è¿è¡Œï¼Œè€ŒJVMè®¤ä¸ºåªæœ‰å®ˆæŠ¤çº¿ç¨‹çš„å­˜åœ¨ä¸è¶³ä»¥ç»§ç»­ä¿æŒç¨‹åºçš„è¿è¡Œï¼Œå› æ­¤ä¼šé€‰æ‹©é€€å‡ºã€‚è¿™æ ·çš„è®¾è®¡å¯ä»¥é¿å…ç¨‹åºå› ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„è¿è¡Œè€Œæ— æ³•é€€å‡ºçš„æƒ…å†µï¼Œæœ‰åŠ©äºç³»ç»Ÿèµ„æºçš„é‡Šæ”¾å’Œç®¡ç†ã€‚</p><h3 id="åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹" aria-hidden="true">#</a> åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹</h3><h4 id="åƒµå°¸è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#åƒµå°¸è¿›ç¨‹" aria-hidden="true">#</a> åƒµå°¸è¿›ç¨‹</h4><p>ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸåï¼Œå®ƒçš„çˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰ç­‰å¾…å®ƒï¼ˆè°ƒç”¨waitæˆ–è€…waitpidï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚åƒµå°¸è¿›ç¨‹æ˜¯ä¸€ä¸ªå·²ç»æ­»äº¡çš„è¿›ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœŸæ­£è¢«é”€æ¯ã€‚å®ƒå·²ç»æ”¾å¼ƒäº†å‡ ä¹æ‰€æœ‰å†…å­˜ç©ºé—´ï¼Œæ²¡æœ‰ä»»ä½•å¯æ‰§è¡Œä»£ç ï¼Œä¹Ÿä¸èƒ½è¢«è°ƒåº¦ï¼Œä»…ä»…åœ¨è¿›ç¨‹è¡¨ä¸­ä¿ç•™ä¸€ä¸ªä½ç½®ï¼Œè®°è½½è¯¥è¿›ç¨‹çš„è¿›ç¨‹IDã€ç»ˆæ­¢çŠ¶æ€ä»¥åŠèµ„æºåˆ©ç”¨ä¿¡æ¯(CPUæ—¶é—´ï¼Œå†…å­˜ä½¿ç”¨é‡ç­‰ç­‰)ä¾›çˆ¶è¿›ç¨‹æ”¶é›†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œåƒµå°¸è¿›ç¨‹ä¸å†å æœ‰ä»»ä½•å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªåƒµå°¸è¿›ç¨‹å¯èƒ½ä¼šä¸€ç›´ç•™åœ¨ç³»ç»Ÿä¸­ç›´åˆ°ç³»ç»Ÿé‡å¯ã€‚</p>`,193),gn=n("li",null,"ã€Šç™¾åº¦ç™¾ç§‘ã€‹è§£é‡Šï¼šåƒµå°¸è¿›ç¨‹æ˜¯å½“å­è¿›ç¨‹æ¯”çˆ¶è¿›ç¨‹å…ˆç»“æŸï¼Œè€Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å›æ”¶å­è¿›ç¨‹ï¼Œé‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œæ­¤æ—¶å­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚å¦‚æœçˆ¶è¿›ç¨‹å…ˆé€€å‡º ï¼Œå­è¿›ç¨‹è¢«initæ¥ç®¡ï¼Œå­è¿›ç¨‹é€€å‡ºåinitä¼šå›æ”¶å…¶å ç”¨çš„ç›¸å…³èµ„æº",-1),hn={href:"https://zh.wikipedia.org/wiki/%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},vn=t('<p>å±å®³ï¼šå ç”¨è¿›ç¨‹å·ï¼Œè€Œç³»ç»Ÿæ‰€èƒ½ä½¿ç”¨çš„è¿›ç¨‹å·æ˜¯æœ‰é™çš„ï¼›å ç”¨å†…å­˜ã€‚</p><p>ä»¥ä¸‹æƒ…å†µä¸ä¼šäº§ç”Ÿåƒµå°¸è¿›ç¨‹ï¼š</p><ul><li>è¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å…ˆç»“æŸäº†ã€‚æ¯ä¸ªè¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œç³»ç»Ÿéƒ½ä¼šæ‰«ææ˜¯å¦å­˜åœ¨å­è¿›ç¨‹ï¼Œå¦‚æœæœ‰åˆ™ç”¨Initè¿›ç¨‹æ¥ç®¡ï¼Œæˆä¸ºè¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨waitç­‰å¾…å…¶ç»“æŸã€‚</li><li>çˆ¶è¿›ç¨‹è°ƒç”¨waitæˆ–è€…waitpidç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼ˆéœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æŸ¥è¯¢å­è¿›ç¨‹æ˜¯å¦ç»“æŸï¼‰ã€‚waitç³»ç»Ÿè°ƒç”¨ä¼šä½¿çˆ¶è¿›ç¨‹æš‚åœæ‰§è¡Œï¼Œç›´åˆ°å®ƒçš„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸä¸ºæ­¢ã€‚waitpidåˆ™å¯ä»¥åŠ å…¥ <code>WNOHANG</code>(wait-no-hang)é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰å‘ç°ç»“æŸçš„å­è¿›ç¨‹ï¼Œå°±ä¼šç«‹å³è¿”å›ï¼Œä¸ä¼šå°†è°ƒç”¨waitpidçš„è¿›ç¨‹é˜»å¡ã€‚åŒæ—¶ï¼Œwaitpidè¿˜å¯ä»¥é€‰æ‹©æ˜¯ç­‰å¾…ä»»ä¸€å­è¿›ç¨‹ï¼ˆåŒwaitï¼‰ï¼Œè¿˜æ˜¯ç­‰å¾…æŒ‡å®špidçš„å­è¿›ç¨‹ï¼Œè¿˜æ˜¯ç­‰å¾…åŒä¸€è¿›ç¨‹ç»„ä¸‹çš„ä»»ä¸€å­è¿›ç¨‹ï¼Œè¿˜æ˜¯ç­‰å¾…ç»„IDç­‰äºpidçš„ä»»ä¸€å­è¿›ç¨‹ï¼›</li><li>å­è¿›ç¨‹ç»“æŸæ—¶ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿ <code>SIGCHLD</code>(signal-child)ä¿¡å·ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨waitpidï¼Œç­‰å¾…æ‰€æœ‰ç»“æŸçš„å­è¿›ç¨‹ï¼ˆæ³¨æ„ï¼šä¸€èˆ¬éƒ½éœ€è¦å¾ªç¯è°ƒç”¨waitpidï¼Œå› ä¸ºåœ¨ä¿¡å·å¤„ç†å‡½æ•°å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œå¯èƒ½å·²ç»æœ‰å¤šä¸ªå­è¿›ç¨‹ç»“æŸäº†ï¼Œè€Œä¿¡å·å¤„ç†å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥è¦å¾ªç¯è°ƒç”¨å°†æ‰€æœ‰ç»“æŸçš„å­è¿›ç¨‹å›æ”¶ï¼‰ï¼›</li><li>ä¹Ÿå¯ä»¥ç”¨ <code>signal(SIGCLD, SIG_IGN)</code>(signal-ignore)é€šçŸ¥å†…æ ¸ï¼Œè¡¨ç¤ºå¿½ç•¥ <code>SIGCHLD</code>ä¿¡å·ï¼Œé‚£ä¹ˆå­è¿›ç¨‹ç»“æŸåï¼Œå†…æ ¸ä¼šè¿›è¡Œå›æ”¶ã€‚</li></ul><h4 id="å­¤å„¿è¿›ç¨‹" tabindex="-1"><a class="header-anchor" href="#å­¤å„¿è¿›ç¨‹" aria-hidden="true">#</a> å­¤å„¿è¿›ç¨‹</h4>',4),bn=n("strong",null,"æ˜¯åœ¨å…¶çˆ¶è¿›ç¨‹æ‰§è¡Œå®Œæˆæˆ–è¢«ç»ˆæ­¢åä»ç»§ç»­è¿è¡Œçš„ä¸€ç±»è¿›ç¨‹",-1),fn={href:"https://zh.wikipedia.org/wiki/%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},wn=t('<p>ä¸€ä¸ªçˆ¶è¿›ç¨‹å·²ç»ç»“æŸäº†ï¼Œä½†æ˜¯å®ƒçš„å­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹ä¼šè¢«Initï¼ˆè¿›ç¨‹IDä¸º1ï¼‰æ¥ç®¡ï¼Œå½“è¿™äº›å­¤å„¿è¿›ç¨‹ç»“æŸæ—¶ç”±Initå®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p><h3 id="ğŸ’«i-o-å¤šè·¯å¤ç”¨-select-poll-epoll" tabindex="-1"><a class="header-anchor" href="#ğŸ’«i-o-å¤šè·¯å¤ç”¨-select-poll-epoll" aria-hidden="true">#</a> ğŸ’«I/O å¤šè·¯å¤ç”¨ï¼šselect/poll/epoll</h3><h4 id="æœ€åŸºæœ¬çš„-socket-æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#æœ€åŸºæœ¬çš„-socket-æ¨¡å‹" aria-hidden="true">#</a> æœ€åŸºæœ¬çš„ Socket æ¨¡å‹</h4><p>è¦æƒ³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èƒ½åœ¨ç½‘ç»œä¸­é€šä¿¡ï¼Œé‚£å¿…é¡»å¾—ä½¿ç”¨ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯è¿›ç¨‹é—´é€šä¿¡é‡Œæ¯”è¾ƒç‰¹åˆ«çš„æ–¹å¼ï¼Œç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒæ˜¯å¯ä»¥è·¨ä¸»æœºé—´é€šä¿¡ã€‚</p><p>Socket çš„ä¸­æ–‡åå«ä½œæ’å£ï¼Œå’‹ä¸€çœ‹è¿˜æŒºè¿·æƒ‘çš„ã€‚äº‹å®ä¸Šï¼ŒåŒæ–¹è¦è¿›è¡Œç½‘ç»œé€šä¿¡å‰ï¼Œå„è‡ªå¾—åˆ›å»ºä¸€ä¸ª Socketï¼Œè¿™ç›¸å½“äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¼€äº†ä¸€ä¸ªâ€œå£å­â€ï¼ŒåŒæ–¹è¯»å–å’Œå‘é€æ•°æ®çš„æ—¶å€™ï¼Œéƒ½é€šè¿‡è¿™ä¸ªâ€œå£å­â€ã€‚è¿™æ ·ä¸€çœ‹ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆåƒå¼„äº†ä¸€æ ¹ç½‘çº¿ï¼Œä¸€å¤´æ’åœ¨å®¢æˆ·ç«¯ï¼Œä¸€å¤´æ’åœ¨æœåŠ¡ç«¯ï¼Œç„¶åè¿›è¡Œé€šä¿¡ã€‚</p><p>åˆ›å»º Socket çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç½‘ç»œå±‚ä½¿ç”¨çš„æ˜¯ IPv4 è¿˜æ˜¯ IPv6ï¼Œä¼ è¾“å±‚ä½¿ç”¨çš„æ˜¯ TCP è¿˜æ˜¯ UDPã€‚</p><p>UDP çš„ Socket ç¼–ç¨‹ç›¸å¯¹ç®€å•äº›ï¼Œè¿™é‡Œæˆ‘ä»¬åªä»‹ç»åŸºäº TCP çš„ Socket ç¼–ç¨‹ã€‚</p><p>æœåŠ¡å™¨çš„ç¨‹åºè¦å…ˆè·‘èµ·æ¥ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœåŠ¡ç«¯çš„ Socket ç¼–ç¨‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ã€‚</p><p>æœåŠ¡ç«¯é¦–å…ˆè°ƒç”¨ <code>socket()</code> å‡½æ•°ï¼Œåˆ›å»ºç½‘ç»œåè®®ä¸º IPv4ï¼Œä»¥åŠä¼ è¾“åè®®ä¸º TCP çš„ Socket ï¼Œæ¥ç€è°ƒç”¨ <code>bind()</code> å‡½æ•°ï¼Œç»™è¿™ä¸ª Socket ç»‘å®šä¸€ä¸ª <strong>IP åœ°å€å’Œç«¯å£</strong>ï¼Œç»‘å®šè¿™ä¸¤ä¸ªçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç»‘å®šç«¯å£çš„ç›®çš„ï¼šå½“å†…æ ¸æ”¶åˆ° TCP æŠ¥æ–‡ï¼Œé€šè¿‡ TCP å¤´é‡Œé¢çš„ç«¯å£å·ï¼Œæ¥æ‰¾åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œç„¶åæŠŠæ•°æ®ä¼ é€’ç»™æˆ‘ä»¬ã€‚</li><li>ç»‘å®š IP åœ°å€çš„ç›®çš„ï¼šä¸€å°æœºå™¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªç½‘å¡çš„ï¼Œæ¯ä¸ªç½‘å¡éƒ½æœ‰å¯¹åº”çš„ IP åœ°å€ï¼Œå½“ç»‘å®šä¸€ä¸ªç½‘å¡æ—¶ï¼Œå†…æ ¸åœ¨æ”¶åˆ°è¯¥ç½‘å¡ä¸Šçš„åŒ…ï¼Œæ‰ä¼šå‘ç»™æˆ‘ä»¬ï¼›</li></ul><p>ç»‘å®šå®Œ IP åœ°å€å’Œç«¯å£åï¼Œå°±å¯ä»¥è°ƒç”¨ <code>listen()</code> å‡½æ•°è¿›è¡Œç›‘å¬ï¼Œæ­¤æ—¶å¯¹åº” TCP çŠ¶æ€å›¾ä¸­çš„ <code>listen</code>ï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ¤å®šæœåŠ¡å™¨ä¸­ä¸€ä¸ªç½‘ç»œç¨‹åºæœ‰æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ <code>netstat</code> å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„ç«¯å£å·æ˜¯å¦æœ‰è¢«ç›‘å¬ã€‚</p><p>æœåŠ¡ç«¯è¿›å…¥äº†ç›‘å¬çŠ¶æ€åï¼Œé€šè¿‡è°ƒç”¨ <code>accept()</code> å‡½æ•°ï¼Œæ¥ä»å†…æ ¸è·å–å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„åˆ°æ¥ã€‚</p><p>é‚£å®¢æˆ·ç«¯æ˜¯æ€ä¹ˆå‘èµ·è¿æ¥çš„å‘¢ï¼Ÿå®¢æˆ·ç«¯åœ¨åˆ›å»ºå¥½ Socket åï¼Œè°ƒç”¨ <code>connect()</code> å‡½æ•°å‘èµ·è¿æ¥ï¼Œè¯¥å‡½æ•°çš„å‚æ•°è¦æŒ‡æ˜æœåŠ¡ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œç„¶åä¸‡ä¼—æœŸå¾…çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å°±å¼€å§‹äº†ã€‚</p><p>åœ¨ TCP è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨çš„å†…æ ¸å®é™…ä¸Šä¸ºæ¯ä¸ª Socket ç»´æŠ¤äº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯è¿˜æ²¡å®Œå…¨å»ºç«‹è¿æ¥çš„é˜Ÿåˆ—ï¼Œç§°ä¸º <strong>TCP åŠè¿æ¥é˜Ÿåˆ—</strong>ï¼Œè¿™ä¸ªé˜Ÿåˆ—éƒ½æ˜¯æ²¡æœ‰å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>syn_rcvd</code> çš„çŠ¶æ€ï¼›</li><li>ä¸€ä¸ªæ˜¯ä¸€ä»¶å»ºç«‹è¿æ¥çš„é˜Ÿåˆ—ï¼Œç§°ä¸º <strong>TCP å…¨è¿æ¥é˜Ÿåˆ—</strong>ï¼Œè¿™ä¸ªé˜Ÿåˆ—éƒ½æ˜¯å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>established</code> çŠ¶æ€ï¼›</li></ul><p>å½“ TCP å…¨è¿æ¥é˜Ÿåˆ—ä¸ä¸ºç©ºåï¼ŒæœåŠ¡ç«¯çš„ <code>accept()</code> å‡½æ•°ï¼Œå°±ä¼šä»å†…æ ¸ä¸­çš„ TCP å…¨è¿æ¥é˜Ÿåˆ—é‡Œæ‹¿å‡ºä¸€ä¸ªå·²ç»å®Œæˆè¿æ¥çš„ Socket è¿”å›åº”ç”¨ç¨‹åºï¼Œåç»­æ•°æ®ä¼ è¾“éƒ½ç”¨è¿™ä¸ª Socketã€‚</p><p>æ³¨æ„ï¼Œç›‘å¬çš„ Socket å’ŒçœŸæ­£ç”¨æ¥ä¼ æ•°æ®çš„ Socket æ˜¯ä¸¤ä¸ªï¼š</p><ul><li>ä¸€ä¸ªå«ä½œ<strong>ç›‘å¬ Socket</strong>ï¼›</li><li>ä¸€ä¸ªå«ä½œ<strong>å·²è¿æ¥ Socket</strong>ï¼›</li></ul><p>è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å¼€å§‹ç›¸äº’ä¼ è¾“æ•°æ®äº†ï¼ŒåŒæ–¹éƒ½å¯ä»¥é€šè¿‡ <code>read()</code> å’Œ <code>write()</code> å‡½æ•°æ¥è¯»å†™æ•°æ®ã€‚</p><p>è‡³æ­¤ï¼Œ TCP åè®®çš„ Socket ç¨‹åºçš„è°ƒç”¨è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+I+'" alt="image-20220731143809167" tabindex="0" loading="lazy"><figcaption>image-20220731143809167</figcaption></figure><p>çœ‹åˆ°è¿™ï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è§‰å¾—è¯»å†™ Socket çš„æ–¹å¼ï¼Œå¥½åƒè¯»å†™æ–‡ä»¶ä¸€æ ·ã€‚</p><p>æ˜¯çš„ï¼ŒåŸºäº Linux ä¸€åˆ‡çš†æ–‡ä»¶çš„ç†å¿µï¼Œåœ¨å†…æ ¸ä¸­ Socket ä¹Ÿæ˜¯ä»¥ã€Œæ–‡ä»¶ã€çš„å½¢å¼å­˜åœ¨çš„ï¼Œä¹Ÿæ˜¯æœ‰å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><blockquote><p>PS : ä¸‹é¢ä¼šè¯´åˆ°å†…æ ¸é‡Œçš„æ•°æ®ç»“æ„ï¼Œä¸æ„Ÿå…´è¶£çš„å¯ä»¥è·³è¿‡è¿™ä¸€éƒ¨åˆ†ï¼Œä¸ä¼šå¯¹åç»­çš„å†…å®¹æœ‰å½±å“ã€‚</p></blockquote><p>æ–‡ä»¶æè¿°ç¬¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ <code>task_struct</code>ï¼Œè¯¥ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªæŒ‡å‘ã€Œæ–‡ä»¶æè¿°ç¬¦æ•°ç»„ã€çš„æˆå‘˜æŒ‡é’ˆã€‚è¯¥æ•°ç»„é‡Œåˆ—å‡ºè¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ•°ç»„çš„ä¸‹æ ‡æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè€Œæ•°ç»„çš„å†…å®¹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å†…æ ¸ä¸­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶çš„åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å†…æ ¸å¯ä»¥é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ‰¾åˆ°å¯¹åº”æ‰“å¼€çš„æ–‡ä»¶ã€‚</p><p>ç„¶åæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ª inodeï¼ŒSocket æ–‡ä»¶çš„ inode æŒ‡å‘äº†å†…æ ¸ä¸­çš„ Socket ç»“æ„ï¼Œåœ¨è¿™ä¸ªç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯<strong>å‘é€é˜Ÿåˆ—</strong>å’Œ<strong>æ¥æ”¶é˜Ÿåˆ—</strong>ï¼Œè¿™ä¸ªä¸¤ä¸ªé˜Ÿåˆ—é‡Œé¢ä¿å­˜çš„æ˜¯ä¸€ä¸ªä¸ª <code>struct sk_buff</code>ï¼Œç”¨é“¾è¡¨çš„ç»„ç»‡å½¢å¼ä¸²èµ·æ¥ã€‚</p><p>sk_buff å¯ä»¥è¡¨ç¤ºå„ä¸ªå±‚çš„æ•°æ®åŒ…ï¼Œåœ¨åº”ç”¨å±‚æ•°æ®åŒ…å« dataï¼Œåœ¨ TCP å±‚æˆ‘ä»¬ç§°ä¸º segmentï¼Œåœ¨ IP å±‚æˆ‘ä»¬å« packetï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ç§°ä¸º frameã€‚</p><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆå…¨éƒ¨æ•°æ®åŒ…åªç”¨ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°å‘¢ï¼Ÿåè®®æ ˆé‡‡ç”¨çš„æ˜¯åˆ†å±‚ç»“æ„ï¼Œä¸Šå±‚å‘ä¸‹å±‚ä¼ é€’æ•°æ®æ—¶éœ€è¦å¢åŠ åŒ…å¤´ï¼Œä¸‹å±‚å‘ä¸Šå±‚æ•°æ®æ—¶åˆéœ€è¦å»æ‰åŒ…å¤´ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½ç”¨ä¸€ä¸ªç»“æ„ä½“ï¼Œé‚£åœ¨å±‚ä¹‹é—´ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œå°±è¦å‘ç”Ÿå¤šæ¬¡æ‹·è´ï¼Œè¿™å°†å¤§å¤§é™ä½ CPU æ•ˆç‡ã€‚</p><p>äºæ˜¯ï¼Œä¸ºäº†åœ¨å±‚çº§ä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼Œä¸å‘ç”Ÿæ‹·è´ï¼Œåªç”¨ sk_buff ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°æ‰€æœ‰çš„ç½‘ç»œåŒ…ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿæ˜¯é€šè¿‡è°ƒæ•´ sk_buff ä¸­ <code>data</code> çš„æŒ‡é’ˆï¼Œæ¯”å¦‚ï¼š</p><ul><li>å½“æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œä»ç½‘å¡é©±åŠ¨å¼€å§‹ï¼Œé€šè¿‡åè®®æ ˆå±‚å±‚å¾€ä¸Šä¼ é€æ•°æ®æŠ¥ï¼Œé€šè¿‡å¢åŠ  skb-&gt;data çš„å€¼ï¼Œæ¥é€æ­¥å‰¥ç¦»åè®®é¦–éƒ¨ã€‚</li><li>å½“è¦å‘é€æŠ¥æ–‡æ—¶ï¼Œåˆ›å»º sk_buff ç»“æ„ä½“ï¼Œæ•°æ®ç¼“å­˜åŒºçš„å¤´éƒ¨é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ï¼Œç”¨æ¥å¡«å……å„å±‚é¦–éƒ¨ï¼Œåœ¨ç»è¿‡å„ä¸‹å±‚åè®®æ—¶ï¼Œé€šè¿‡å‡å°‘ skb-&gt;data çš„å€¼æ¥å¢åŠ åè®®é¦–éƒ¨ã€‚</li></ul><p>ä½ å¯ä»¥ä»ä¸‹é¢è¿™å¼ å›¾çœ‹åˆ°ï¼Œå½“å‘é€æŠ¥æ–‡æ—¶ï¼Œdata æŒ‡é’ˆçš„ç§»åŠ¨è¿‡ç¨‹ã€‚</p><figure><img src="'+P+'" alt="image-20220717161851452" tabindex="0" loading="lazy"><figcaption>image-20220717161851452</figcaption></figure><h4 id="å¦‚ä½•æœåŠ¡æ›´å¤šçš„ç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æœåŠ¡æ›´å¤šçš„ç”¨æˆ·" aria-hidden="true">#</a> å¦‚ä½•æœåŠ¡æ›´å¤šçš„ç”¨æˆ·ï¼Ÿ</h4><p>å‰é¢æåˆ°çš„ TCP Socket è°ƒç”¨æµç¨‹æ˜¯æœ€ç®€å•ã€æœ€åŸºæœ¬çš„ï¼Œå®ƒåŸºæœ¬åªèƒ½ä¸€å¯¹ä¸€é€šä¿¡ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯åŒæ­¥é˜»å¡çš„æ–¹å¼ï¼Œå½“æœåŠ¡ç«¯åœ¨è¿˜æ²¡å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œ I/O æ—¶ï¼Œæˆ–è€… è¯»å†™æ“ä½œå‘ç”Ÿé˜»å¡æ—¶ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯æ— æ³•ä¸æœåŠ¡ç«¯è¿æ¥çš„ã€‚</p><p>å¯å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ï¼Œé‚£è¿™æ ·å°±å¤ªæµªè´¹èµ„æºäº†ï¼Œäºæ˜¯æˆ‘ä»¬è¦æ”¹è¿›è¿™ä¸ªç½‘ç»œ I/O æ¨¡å‹ï¼Œä»¥æ”¯æŒæ›´å¤šçš„å®¢æˆ·ç«¯ã€‚</p><p>åœ¨æ”¹è¿›ç½‘ç»œ I/O æ¨¡å‹å‰ï¼Œæˆ‘å…ˆæ¥æä¸€ä¸ªé—®é¢˜ï¼Œä½ çŸ¥é“æœåŠ¡å™¨å•æœºç†è®ºæœ€å¤§èƒ½è¿æ¥å¤šå°‘ä¸ªå®¢æˆ·ç«¯ï¼Ÿ</p><p>ç›¸ä¿¡ä½ çŸ¥é“ TCP è¿æ¥æ˜¯ç”±å››å…ƒç»„å”¯ä¸€ç¡®è®¤çš„ï¼Œè¿™ä¸ªå››å…ƒç»„å°±æ˜¯ï¼š<strong>æœ¬æœºIP, æœ¬æœºç«¯å£, å¯¹ç«¯IP, å¯¹ç«¯ç«¯å£</strong>ã€‚</p><p>æœåŠ¡å™¨ä½œä¸ºæœåŠ¡æ–¹ï¼Œé€šå¸¸ä¼šåœ¨æœ¬åœ°å›ºå®šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å› æ­¤æœåŠ¡å™¨çš„æœ¬åœ° IP å’Œç«¯å£æ˜¯å›ºå®šçš„ï¼Œäºæ˜¯å¯¹äºæœåŠ¡ç«¯ TCP è¿æ¥çš„å››å…ƒç»„åªæœ‰å¯¹ç«¯ IP å’Œç«¯å£æ˜¯ä¼šå˜åŒ–çš„ï¼Œæ‰€ä»¥<strong>æœ€å¤§ TCP è¿æ¥æ•° = å®¢æˆ·ç«¯ IP æ•°Ã—å®¢æˆ·ç«¯ç«¯å£æ•°</strong>ã€‚</p><p>å¯¹äº IPv4ï¼Œå®¢æˆ·ç«¯çš„ IP æ•°æœ€å¤šä¸º 2 çš„ 32 æ¬¡æ–¹ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£æ•°æœ€å¤šä¸º 2 çš„ 16 æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯<strong>æœåŠ¡ç«¯å•æœºæœ€å¤§ TCP è¿æ¥æ•°çº¦ä¸º 2 çš„ 48 æ¬¡æ–¹</strong>ã€‚</p><p>è¿™ä¸ªç†è®ºå€¼ç›¸å½“â€œä¸°æ»¡â€ï¼Œä½†æ˜¯æœåŠ¡å™¨è‚¯å®šæ‰¿è½½ä¸äº†é‚£ä¹ˆå¤§çš„è¿æ¥æ•°ï¼Œä¸»è¦ä¼šå—ä¸¤ä¸ªæ–¹é¢çš„é™åˆ¶ï¼š</p><ul><li><strong>æ–‡ä»¶æè¿°ç¬¦</strong>ï¼ŒSocket å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±ä¼šå¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ Linux ä¸‹ï¼Œå•ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ²¡æœ‰ç»è¿‡ä¿®æ”¹çš„å€¼ä¸€èˆ¬éƒ½æ˜¯ 1024ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ ulimit å¢å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç›®ï¼›</li><li><strong>ç³»ç»Ÿå†…å­˜</strong>ï¼Œæ¯ä¸ª TCP è¿æ¥åœ¨å†…æ ¸ä¸­éƒ½æœ‰å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæ„å‘³ç€æ¯ä¸ªè¿æ¥éƒ½æ˜¯ä¼šå ç”¨ä¸€å®šå†…å­˜çš„ï¼›</li></ul><p>é‚£å¦‚æœæœåŠ¡å™¨çš„å†…å­˜åªæœ‰ 2 GBï¼Œç½‘å¡æ˜¯åƒå…†çš„ï¼Œèƒ½æ”¯æŒå¹¶å‘ 1 ä¸‡è¯·æ±‚å—ï¼Ÿ</p><p>å¹¶å‘ 1 ä¸‡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ç»å…¸çš„ C10K é—®é¢˜ ï¼ŒC æ˜¯ Client å•è¯é¦–å­—æ¯ç¼©å†™ï¼ŒC10K å°±æ˜¯å•æœºåŒæ—¶å¤„ç† 1 ä¸‡ä¸ªè¯·æ±‚çš„é—®é¢˜ã€‚</p><p>ä»ç¡¬ä»¶èµ„æºè§’åº¦çœ‹ï¼Œå¯¹äº 2GB å†…å­˜åƒå…†ç½‘å¡çš„æœåŠ¡å™¨ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚å¤„ç†å ç”¨ä¸åˆ° 200KB çš„å†…å­˜å’Œ 100Kbit çš„ç½‘ç»œå¸¦å®½å°±å¯ä»¥æ»¡è¶³å¹¶å‘ 1 ä¸‡ä¸ªè¯·æ±‚ã€‚</p><p>ä¸è¿‡ï¼Œè¦æƒ³çœŸæ­£å®ç° C10K çš„æœåŠ¡å™¨ï¼Œè¦è€ƒè™‘çš„åœ°æ–¹åœ¨äºæœåŠ¡å™¨çš„ç½‘ç»œ I/O æ¨¡å‹ï¼Œæ•ˆç‡ä½çš„æ¨¡å‹ï¼Œä¼šåŠ é‡ç³»ç»Ÿå¼€é”€ï¼Œä»è€Œä¼šç¦» C10K çš„ç›®æ ‡è¶Šæ¥è¶Šè¿œã€‚</p><h4 id="å¤šè¿›ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#å¤šè¿›ç¨‹æ¨¡å‹" aria-hidden="true">#</a> å¤šè¿›ç¨‹æ¨¡å‹</h4><p>åŸºäºæœ€åŸå§‹çš„é˜»å¡ç½‘ç»œ I/Oï¼Œ å¦‚æœæœåŠ¡å™¨è¦æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå…¶ä¸­æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨<strong>å¤šè¿›ç¨‹æ¨¡å‹</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚</p><p>æœåŠ¡å™¨çš„ä¸»è¿›ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·çš„è¿æ¥ï¼Œä¸€æ—¦ä¸å®¢æˆ·ç«¯è¿æ¥å®Œæˆï¼Œaccept() å‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªã€Œå·²è¿æ¥ Socketã€ï¼Œè¿™æ—¶å°±é€šè¿‡ <code>fork()</code> å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå®é™…ä¸Šå°±æŠŠçˆ¶è¿›ç¨‹æ‰€æœ‰ç›¸å…³çš„ä¸œè¥¿éƒ½<strong>å¤åˆ¶</strong>ä¸€ä»½ï¼ŒåŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜åœ°å€ç©ºé—´ã€ç¨‹åºè®¡æ•°å™¨ã€æ‰§è¡Œçš„ä»£ç ç­‰ã€‚</p><p>è¿™ä¸¤ä¸ªè¿›ç¨‹åˆšå¤åˆ¶å®Œçš„æ—¶å€™ï¼Œå‡ ä¹ä¸€æ‘¸ä¸€æ ·ã€‚ä¸è¿‡ï¼Œä¼šæ ¹æ®<strong>è¿”å›å€¼</strong>æ¥åŒºåˆ†æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ 0ï¼Œåˆ™æ˜¯å­è¿›ç¨‹ï¼›å¦‚æœè¿”å›å€¼æ˜¯å…¶ä»–çš„æ•´æ•°ï¼Œå°±æ˜¯çˆ¶è¿›ç¨‹ã€‚</p><p>æ­£å› ä¸ºå­è¿›ç¨‹ä¼š<strong>å¤åˆ¶çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œäºæ˜¯å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€Œå·²è¿æ¥ Socket ã€å’Œå®¢æˆ·ç«¯é€šä¿¡äº†ï¼Œ</p><p>å¯ä»¥å‘ç°ï¼Œå­è¿›ç¨‹ä¸éœ€è¦å…³å¿ƒã€Œç›‘å¬ Socketã€ï¼Œåªéœ€è¦å…³å¿ƒã€Œå·²è¿æ¥ Socketã€ï¼›çˆ¶è¿›ç¨‹åˆ™ç›¸åï¼Œå°†å®¢æˆ·æœåŠ¡äº¤ç»™å­è¿›ç¨‹æ¥å¤„ç†ï¼Œå› æ­¤çˆ¶è¿›ç¨‹ä¸éœ€è¦å…³å¿ƒã€Œå·²è¿æ¥ Socketã€ï¼Œåªéœ€è¦å…³å¿ƒã€Œç›‘å¬ Socketã€ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾æè¿°äº†ä»è¿æ¥è¯·æ±‚åˆ°è¿æ¥å»ºç«‹ï¼Œçˆ¶è¿›ç¨‹åˆ›å»ºç”Ÿå­è¿›ç¨‹ä¸ºå®¢æˆ·æœåŠ¡ã€‚</p><figure><img src="'+O+'" alt="image-20220717163910297" tabindex="0" loading="lazy"><figcaption>image-20220717163910297</figcaption></figure><p>å¦å¤–ï¼Œå½“ã€Œå­è¿›ç¨‹ã€é€€å‡ºæ—¶ï¼Œå®é™…ä¸Šå†…æ ¸é‡Œè¿˜ä¼šä¿ç•™è¯¥è¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ä¼šå ç”¨å†…å­˜çš„ï¼Œå¦‚æœä¸åšå¥½â€œå›æ”¶â€å·¥ä½œï¼Œå°±ä¼šå˜æˆ<strong>åƒµå°¸è¿›ç¨‹</strong>ï¼Œéšç€åƒµå°¸è¿›ç¨‹è¶Šå¤šï¼Œä¼šæ…¢æ…¢è€—å°½æˆ‘ä»¬çš„ç³»ç»Ÿèµ„æºã€‚</p><blockquote><p>ä¸€ä¸ªå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦åœ¨å­è¿›ç¨‹é€€å‡ºæ—¶ä¸ä¼šé‡Šæ”¾ï¼Œåªæœ‰å½“çˆ¶è¿›ç¨‹é€šè¿‡ wait() æˆ– waitpid() è·å–äº†å­è¿›ç¨‹ä¿¡æ¯åæ‰ä¼šé‡Šæ”¾ã€‚å¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨ wait() æˆ– waitpid()ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p></blockquote><p>å› æ­¤ï¼Œçˆ¶è¿›ç¨‹è¦â€œå–„åâ€å¥½è‡ªå·±çš„å­©å­ï¼Œæ€ä¹ˆå–„åå‘¢ï¼Ÿé‚£ä¹ˆæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åœ¨å­è¿›ç¨‹é€€å‡ºåå›æ”¶èµ„æºï¼Œåˆ†åˆ«æ˜¯è°ƒç”¨ <code>wait()</code> å’Œ <code>waitpid()</code> å‡½æ•°ã€‚</p><p>è¿™ç§ç”¨å¤šä¸ªè¿›ç¨‹æ¥åº”ä»˜å¤šä¸ªå®¢æˆ·ç«¯çš„æ–¹å¼ï¼Œåœ¨åº”å¯¹ 100 ä¸ªå®¢æˆ·ç«¯è¿˜æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯æ•°é‡é«˜è¾¾ä¸€ä¸‡æ—¶ï¼Œè‚¯å®šæ‰›ä¸ä½çš„ï¼Œå› ä¸ºæ¯äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå¿…ä¼šå æ®ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œè€Œä¸”è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„â€œåŒ…è¢±â€æ˜¯å¾ˆé‡çš„ï¼Œæ€§èƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚</p><p>è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚</p><h4 id="å¤šçº¿ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#å¤šçº¿ç¨‹æ¨¡å‹" aria-hidden="true">#</a> å¤šçº¿ç¨‹æ¨¡å‹</h4><p>æ—¢ç„¶è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„â€œåŒ…è¢±â€å¾ˆé‡ï¼Œé‚£æˆ‘ä»¬å°±æä¸ªæ¯”è¾ƒè½»é‡çº§çš„æ¨¡å‹æ¥åº”å¯¹å¤šç”¨æˆ·çš„è¯·æ±‚ â€”â€” <strong>å¤šçº¿ç¨‹æ¨¡å‹</strong>ã€‚</p><p>çº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªâ€œé€»è¾‘æµâ€ï¼Œå•è¿›ç¨‹ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼ŒåŒè¿›ç¨‹é‡Œçš„çº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹çš„éƒ¨åˆ†èµ„æºçš„ï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨ã€è¿›ç¨‹ç©ºé—´ã€ä»£ç ã€å…¨å±€æ•°æ®ã€å †ã€å…±äº«åº“ç­‰ï¼Œè¿™äº›å…±äº«äº›èµ„æºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ˜¯ä¸éœ€è¦åˆ‡æ¢ï¼Œè€Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ï¼Œå› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¦æ¯”è¿›ç¨‹å°å¾—å¤šã€‚</p><p>å½“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ TCP å®Œæˆè¿æ¥åï¼Œé€šè¿‡ <code>pthread_create()</code> å‡½æ•°åˆ›å»ºçº¿ç¨‹ï¼Œç„¶åå°†ã€Œå·²è¿æ¥ Socketã€çš„æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°ï¼Œæ¥ç€åœ¨çº¿ç¨‹é‡Œå’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¾¾åˆ°å¹¶å‘å¤„ç†çš„ç›®çš„ã€‚</p><p>å¦‚æœæ¯æ¥ä¸€ä¸ªè¿æ¥å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹è¿è¡Œå®Œåï¼Œè¿˜å¾—æ“ä½œç³»ç»Ÿè¿˜å¾—é”€æ¯çº¿ç¨‹ï¼Œè™½è¯´çº¿ç¨‹åˆ‡æ¢çš„ä¸Šå†™æ–‡å¼€é”€ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœé¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œç³»ç»Ÿå¼€é”€ä¹Ÿæ˜¯ä¸å°çš„ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>çº¿ç¨‹æ± </strong>çš„æ–¹å¼æ¥é¿å…çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ï¼Œæ‰€è°“çš„çº¿ç¨‹æ± ï¼Œå°±æ˜¯æå‰åˆ›å»ºè‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å½“ç”±æ–°è¿æ¥å»ºç«‹æ—¶ï¼Œå°†è¿™ä¸ªå·²è¿æ¥çš„ Socket æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç„¶åçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹è´Ÿè´£ä»é˜Ÿåˆ—ä¸­å–å‡ºå·²è¿æ¥ Socket è¿›ç¨‹å¤„ç†ã€‚</p><figure><img src="'+R+'" alt="image-20220717163933495" tabindex="0" loading="lazy"><figcaption>image-20220717163933495</figcaption></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ“ä½œï¼Œä¸ºäº†é¿å…å¤šçº¿ç¨‹ç«äº‰ï¼Œçº¿ç¨‹åœ¨æ“ä½œè¿™ä¸ªé˜Ÿåˆ—å‰è¦åŠ é”ã€‚</p><p>ä¸Šé¢åŸºäºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¨¡å‹çš„ï¼Œå…¶å®è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚æ–°åˆ°æ¥ä¸€ä¸ª TCP è¿æ¥ï¼Œå°±éœ€è¦åˆ†é…ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœè¦è¾¾åˆ° C10Kï¼Œæ„å‘³ç€è¦ä¸€å°æœºå™¨ç»´æŠ¤ 1 ä¸‡ä¸ªè¿æ¥ï¼Œç›¸å½“äºè¦ç»´æŠ¤ 1 ä¸‡ä¸ªè¿›ç¨‹/çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå°±ç®—æ­»æ‰›ä¹Ÿæ˜¯æ‰›ä¸ä½çš„ã€‚</p><h4 id="i-o-å¤šè·¯å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#i-o-å¤šè·¯å¤ç”¨" aria-hidden="true">#</a> I/O å¤šè·¯å¤ç”¨</h4><p>æ—¢ç„¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„æ–¹å¼ä¸åˆé€‚ï¼Œé‚£æœ‰æ²¡æœ‰å¯èƒ½åªä½¿ç”¨ä¸€ä¸ªè¿›ç¨‹æ¥ç»´æŠ¤å¤šä¸ª Socket å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯ <strong>I/O å¤šè·¯å¤ç”¨</strong>æŠ€æœ¯ã€‚</p><figure><img src="'+q+'" alt="image-20220717165055763" tabindex="0" loading="lazy"><figcaption>image-20220717165055763</figcaption></figure><p>ä¸€ä¸ªè¿›ç¨‹è™½ç„¶ä»»ä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å¤„ç†æ¯ä¸ªè¯·æ±‚çš„äº‹ä»¶æ—¶ï¼Œè€—æ—¶æ§åˆ¶åœ¨ 1 æ¯«ç§’ä»¥å†…ï¼Œè¿™æ · 1 ç§’å†…å°±å¯ä»¥å¤„ç†ä¸Šåƒä¸ªè¯·æ±‚ï¼ŒæŠŠæ—¶é—´æ‹‰é•¿æ¥çœ‹ï¼Œå¤šä¸ªè¯·æ±‚å¤ç”¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™å°±æ˜¯å¤šè·¯å¤ç”¨ï¼Œè¿™ç§æ€æƒ³å¾ˆç±»ä¼¼ä¸€ä¸ª CPU å¹¶å‘å¤šä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿå«åšæ—¶åˆ†å¤šè·¯å¤ç”¨ã€‚</p><p>æˆ‘ä»¬ç†Ÿæ‚‰çš„ select/poll/epoll å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>è¿›ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ä»å†…æ ¸ä¸­è·å–å¤šä¸ªäº‹ä»¶</strong>ã€‚</p><p>select/poll/epoll æ˜¯å¦‚ä½•è·å–ç½‘ç»œäº‹ä»¶çš„å‘¢ï¼Ÿåœ¨è·å–äº‹ä»¶æ—¶ï¼Œå…ˆæŠŠæ‰€æœ‰è¿æ¥ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ä¼ ç»™å†…æ ¸ï¼Œå†ç”±å†…æ ¸è¿”å›äº§ç”Ÿäº†äº‹ä»¶çš„è¿æ¥ï¼Œç„¶ååœ¨ç”¨æˆ·æ€ä¸­å†å¤„ç†è¿™äº›è¿æ¥å¯¹åº”çš„è¯·æ±‚å³å¯ã€‚</p><p>select/poll/epoll è¿™æ˜¯ä¸‰ä¸ªå¤šè·¯å¤ç”¨æ¥å£ï¼Œéƒ½èƒ½å®ç° C10K å—ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«è¯´è¯´å®ƒä»¬ã€‚</p><h4 id="select-poll" tabindex="-1"><a class="header-anchor" href="#select-poll" aria-hidden="true">#</a> select/poll</h4><p>select å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼æ˜¯ï¼Œå°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ª<strong>æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œç„¶åè°ƒç”¨ select å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆ<strong>æ‹·è´</strong>åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œæ£€æŸ¥çš„æ–¹å¼å¾ˆç²—æš´ï¼Œå°±æ˜¯é€šè¿‡<strong>éå†</strong>æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„æ–¹å¼ï¼Œå½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤ Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆ<strong>æ‹·è´</strong>å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡<strong>éå†</strong>çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äº select è¿™ç§æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ <strong>2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€ä¸ªæ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œ ï¼Œè€Œä¸”è¿˜ä¼šå‘ç”Ÿ <strong>2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä¿®æ”¹åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p><p>select ä½¿ç”¨å›ºå®šé•¿åº¦çš„ BitsMapï¼Œè¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè€Œä¸”æ‰€æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”±å†…æ ¸ä¸­çš„ FD_SETSIZE é™åˆ¶ï¼Œ é»˜è®¤æœ€å¤§å€¼ä¸º <code>1024</code>ï¼Œåªèƒ½ç›‘å¬ 0~1023 çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>poll ä¸å†ç”¨ BitsMap æ¥å­˜å‚¨æ‰€å…³æ³¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå–è€Œä»£ä¹‹ç”¨åŠ¨æ€æ•°ç»„ï¼Œä»¥é“¾è¡¨å½¢å¼æ¥ç»„ç»‡ï¼Œçªç ´äº† select çš„æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°é™åˆ¶ï¼Œå½“ç„¶è¿˜ä¼šå—åˆ°ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶ã€‚</p><p>ä½†æ˜¯ poll å’Œ select å¹¶æ²¡æœ‰å¤ªå¤§çš„æœ¬è´¨åŒºåˆ«ï¼Œ<strong>éƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆï¼Œå› æ­¤éƒ½éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œä¸”ä¹Ÿéœ€è¦åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ‹·è´æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œè¿™ç§æ–¹å¼éšç€å¹¶å‘æ•°ä¸Šæ¥ï¼Œæ€§èƒ½çš„æŸè€—ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚</p>',80),_n=n("p",null,"select å’Œ poll çš„åŒºåˆ«æ€»ç»“",-1),Sn={href:"https://www.mo4tech.com/io-multiplexing-in-select-poll-epoll-differences.html",target:"_blank",rel:"noopener noreferrer"},xn={href:"https://notes.shichao.io/unp/ch6/",target:"_blank",rel:"noopener noreferrer"},yn={href:"https://www.techrepublic.com/article/using-the-select-and-poll-methods/",target:"_blank",rel:"noopener noreferrer"},Cn=t(`<p>selectå’Œpolléƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„æœºåˆ¶ï¼Œéƒ½éœ€è¦è½®è¯¢æ¥æ£€æŸ¥å“ªäº›æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™æˆ–å‡ºé”™ã€‚å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p><ol><li>å¯ä»¥ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸åŒï¼šselectæœ‰FD_SETSIZEçš„é™åˆ¶ï¼Œä¸€èˆ¬ä¸º1024ï¼Œè€Œpollæ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>äº‹ä»¶è§¦å‘æ¨¡å¼ä¸åŒï¼šselectæ˜¯æ°´å¹³è§¦å‘ï¼Œå³åªè¦æ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™æˆ–å‡ºé”™ï¼Œå°±ä¼šä¸€ç›´é€šçŸ¥åº”ç”¨ç¨‹åºï¼›è€Œpollæ—¢å¯ä»¥æ˜¯æ°´å¹³è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ˜¯è¾¹ç¼˜è§¦å‘ï¼Œç”±åº”ç”¨ç¨‹åºæŒ‡å®šã€‚</li><li>å¯¹äºå¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„å¤„ç†æ•ˆç‡ä¸åŒï¼šselectæ¯æ¬¡éœ€è¦è½®è¯¢æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ•ˆç‡è¾ƒä½ï¼Œè€Œpollæ¯æ¬¡åªéœ€è¦éå†å½“å‰æ·»åŠ çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚</li><li>å¹³å°å…¼å®¹æ€§ä¸åŒï¼šselectåœ¨ä¸åŒå¹³å°ä¸Šçš„å®ç°ç•¥æœ‰å·®å¼‚ï¼Œè€Œpollæ˜¯POSIXæ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ›´åŠ ç¨³å®šå’Œå¯é ã€‚</li></ol><h4 id="epoll" tabindex="-1"><a class="header-anchor" href="#epoll" aria-hidden="true">#</a> epoll</h4><p>å…ˆå¤ä¹ ä¸‹ epoll çš„ç”¨æ³•ã€‚å¦‚ä¸‹çš„ä»£ç ä¸­ï¼Œå…ˆç”¨epoll_create åˆ›å»ºä¸€ä¸ª epollå¯¹è±¡ epfdï¼Œå†é€šè¿‡ epoll_ctl å°†éœ€è¦ç›‘è§†çš„ socket æ·»åŠ åˆ°epfdä¸­ï¼Œæœ€åè°ƒç”¨ epoll_wait ç­‰å¾…æ•°æ®ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bind</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">listen</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token keyword">int</span> epfd <span class="token operator">=</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epfd<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å°†æ‰€æœ‰éœ€è¦ç›‘å¬çš„socketæ·»åŠ åˆ°epfdä¸­</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>æ¥æ”¶åˆ°æ•°æ®çš„socket<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//å¤„ç†</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>epoll é€šè¿‡ä¸¤ä¸ªæ–¹é¢ï¼Œå¾ˆå¥½è§£å†³äº† select/poll çš„é—®é¢˜ã€‚</p><p><em>ç¬¬ä¸€ç‚¹</em>ï¼Œepoll åœ¨å†…æ ¸é‡Œä½¿ç”¨<strong>çº¢é»‘æ ‘æ¥è·Ÿè¸ªè¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„æ–‡ä»¶æè¿°å­—</strong>ï¼ŒæŠŠéœ€è¦ç›‘æ§çš„ socket é€šè¿‡ <code>epoll_ctl()</code> å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œï¼Œçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(logn)</code>ã€‚è€Œ select/poll å†…æ ¸é‡Œæ²¡æœ‰ç±»ä¼¼ epoll çº¢é»‘æ ‘è¿™ç§ä¿å­˜æ‰€æœ‰å¾…æ£€æµ‹çš„ socket çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ select/poll æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥æ•´ä¸ª socket é›†åˆç»™å†…æ ¸ï¼Œè€Œ epoll å› ä¸ºåœ¨å†…æ ¸ç»´æŠ¤äº†çº¢é»‘æ ‘ï¼Œå¯ä»¥ä¿å­˜æ‰€æœ‰å¾…æ£€æµ‹çš„ socket ï¼Œæ‰€ä»¥åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå¾…æ£€æµ‹çš„ socketï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¤§é‡çš„æ•°æ®æ‹·è´å’Œå†…å­˜åˆ†é…ã€‚</p><p><em>ç¬¬äºŒç‚¹</em>ï¼Œ epoll ä½¿ç”¨<strong>äº‹ä»¶é©±åŠ¨</strong>çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œ<strong>ç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨æ¥è®°å½•å°±ç»ªäº‹ä»¶</strong>ï¼Œå½“æŸä¸ª socket æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡<strong>å›è°ƒå‡½æ•°</strong>å†…æ ¸ä¼šå°†å…¶åŠ å…¥åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶åˆ—è¡¨ä¸­ï¼Œå½“ç”¨æˆ·è°ƒç”¨ <code>epoll_wait()</code> å‡½æ•°æ—¶ï¼Œåªä¼šè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ª socket é›†åˆï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚</p><p>ä»ä¸‹å›¾ä½ å¯ä»¥çœ‹åˆ° epoll ç›¸å…³çš„æ¥å£ä½œç”¨ï¼š</p><figure><img src="`+A+'" alt="image-20220717165140152" tabindex="0" loading="lazy"><figcaption>image-20220717165140152</figcaption></figure><p>epoll çš„æ–¹å¼å³ä½¿ç›‘å¬çš„ Socket æ•°é‡è¶Šå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä¸ä¼šå¤§å¹…åº¦é™ä½ï¼Œèƒ½å¤ŸåŒæ—¶ç›‘å¬çš„ Socket çš„æ•°ç›®ä¹Ÿéå¸¸çš„å¤šäº†ï¼Œä¸Šé™å°±ä¸ºç³»ç»Ÿå®šä¹‰çš„è¿›ç¨‹æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°ã€‚å› è€Œï¼Œ<strong>epoll è¢«ç§°ä¸ºè§£å†³ C10K é—®é¢˜çš„åˆ©å™¨</strong>ã€‚</p><p>æ’ä¸ªé¢˜å¤–è¯ï¼Œç½‘ä¸Šæ–‡ç« ä¸å°‘è¯´ï¼Œ<code>epoll_wait</code> è¿”å›æ—¶ï¼Œå¯¹äºå°±ç»ªçš„äº‹ä»¶ï¼Œepoll ä½¿ç”¨çš„æ˜¯å…±äº«å†…å­˜çš„æ–¹å¼ï¼Œå³ç”¨æˆ·æ€å’Œå†…æ ¸æ€éƒ½æŒ‡å‘äº†å°±ç»ªé“¾è¡¨ï¼Œæ‰€ä»¥å°±é¿å…äº†å†…å­˜æ‹·è´æ¶ˆè€—ã€‚</p><p>è¿™æ˜¯é”™çš„ï¼çœ‹è¿‡ epoll å†…æ ¸æºç çš„éƒ½çŸ¥é“ï¼Œ<strong>å‹æ ¹å°±æ²¡æœ‰ä½¿ç”¨å…±äº«å†…å­˜è¿™ä¸ªç©æ„</strong>ã€‚ä½ å¯ä»¥ä»ä¸‹é¢è¿™ä»½ä»£ç çœ‹åˆ°ï¼Œ epoll_wait å®ç°çš„å†…æ ¸ä»£ç ä¸­è°ƒç”¨äº† <code>__put_user</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><figure><img src="'+E+'" alt="image-20220717165148621" tabindex="0" loading="lazy"><figcaption>image-20220717165148621</figcaption></figure><h5 id="è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘" tabindex="-1"><a class="header-anchor" href="#è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘" aria-hidden="true">#</a> è¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘</h5><p>è¿™ä¸¤ä¸ªæœ¯è¯­è¿˜æŒºæŠ½è±¡çš„ï¼Œå…¶å®å®ƒä»¬çš„åŒºåˆ«è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚</p><ul><li>ä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ<strong>æœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡</strong>ï¼Œå³ä½¿è¿›ç¨‹æ²¡æœ‰è°ƒç”¨ read å‡½æ•°ä»å†…æ ¸è¯»å–æ•°æ®ï¼Œä¹Ÿä¾ç„¶åªè‹é†’ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬ç¨‹åºè¦ä¿è¯ä¸€æ¬¡æ€§å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®è¯»å–å®Œï¼›</li><li>ä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ<strong>æœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸ</strong>ï¼Œç›®çš„æ˜¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ•°æ®éœ€è¦è¯»å–ï¼›</li></ul><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><ol><li><strong>æ°´å¹³è§¦å‘ï¼ˆLevel Triggeredï¼ŒLTï¼‰</strong>ï¼šæƒ³è±¡ä½ æœ‰ä¸€ä¸ªé‚®ç®±ï¼Œé‚®å·®åœ¨ä½ çš„é‚®ç®±é‡Œæ”¾äº†ä¸€å°ä¿¡ï¼Œé‚®å·®ä¼šç»™ä½ æ•²é—¨å‘Šè¯‰ä½ æœ‰æ–°ä¿¡ä»¶ã€‚ä½ å–å‡ºä¿¡ä»¶è¯»äº†ä¸€éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„ç•™ç€ç¨åè¯»ï¼Œé‚®å·®çœ‹åˆ°ä½ çš„ä¿¡ç®±é‡Œè¿˜æœ‰ä¿¡ï¼Œå°±ä¼šå†æ¬¡æ•²é—¨æé†’ä½ ã€‚åªè¦ä½ çš„ä¿¡ç®±é‡Œè¿˜æœ‰ä¿¡ï¼Œæ— è®ºä½ æ˜¯å¦å·²ç»å¼€å§‹é˜…è¯»ï¼Œé‚®å·®éƒ½ä¼šæ¯æ¬¡è¿‡æ¥æ—¶æ•²é—¨ã€‚</li><li><strong>è¾¹ç¼˜è§¦å‘ï¼ˆEdge Triggeredï¼ŒETï¼‰</strong>ï¼šè¿˜æ˜¯é‚£ä¸ªé‚®ç®±çš„ä¾‹å­ï¼Œä½†è¿™æ¬¡é‚®å·®åªåœ¨æ”¾å…¥æ–°ä¿¡ä»¶æ—¶æ•²é—¨ä¸€æ¬¡ã€‚å¦‚æœä½ æ²¡æœ‰å®Œå…¨è¯»å®Œä¿¡ä»¶ï¼Œé‚®å·®ä¸ä¼šå†æ•²é—¨æé†’ä½ ã€‚é™¤éæœ‰æ–°çš„ä¿¡ä»¶æ”¾å…¥ä½ çš„ä¿¡ç®±ï¼Œé‚®å·®æ‰ä¼šå†æ¬¡æ•²é—¨ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ²¡åœ¨é‚®å·®ç¬¬ä¸€æ¬¡æ•²é—¨æ—¶å°±æŠŠæ‰€æœ‰ä¿¡ä»¶è¯»å®Œï¼Œä½ å¯èƒ½ä¼šé—æ¼ä¸€äº›ä¿¡ä»¶ã€‚</li></ol><blockquote><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œé‚®å·®å°±åƒæ˜¯ epoll_waitï¼Œä¿¡ä»¶å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªçŠ¶æ€ï¼Œä½ è¯»ä¿¡å°±åƒå¤„ç†å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘çš„åŒºåˆ«å°±åœ¨äº epoll_waitï¼ˆé‚®å·®ï¼‰æ˜¯å¦‚ä½•é€šçŸ¥ä½ æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªçŠ¶æ€ï¼ˆä¿¡ä»¶ï¼‰çš„ã€‚ ps. <strong>ğŸ™‹â€â™‚ï¸å°æŠ€å·§</strong>ï¼šæ°´å¹³è§¦å‘æ˜¯åªè¦æœ‰æ•°æ®è¿˜åœ¨å°±ç»ªepoll_waitå°±ä¼šç›´æ¥è¿”å›ï¼›è¾¹ç¼˜è§¦å‘æ˜¯ï¼Œè¦æœ‰æ–°çš„ï¼ˆ åªåœ¨æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ä»â€œéå°±ç»ªâ€å˜ä¸ºâ€œå°±ç»ªâ€ ï¼‰ï¼Œæ³¨æ„æ˜¯æ–°çš„æ•°æ®å°±ç»ªepoll_waitæ‰ä¼šè¿”å›ï¼Œä½†æ²¡æœ‰æ–°çš„æ•°æ®åˆ°æ¥ï¼Œé‚£ä¹ˆ epoll_wait ä¸ä¼šè¿”å›è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p></blockquote><p>è¿™å°±æ˜¯ä¸¤è€…çš„åŒºåˆ«ï¼Œæ°´å¹³è§¦å‘çš„æ„æ€æ˜¯åªè¦æ»¡è¶³äº‹ä»¶çš„æ¡ä»¶ï¼Œæ¯”å¦‚å†…æ ¸ä¸­æœ‰æ•°æ®éœ€è¦è¯»ï¼Œå°±ä¸€ç›´ä¸æ–­åœ°æŠŠè¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™ç”¨æˆ·ï¼›è€Œè¾¹ç¼˜è§¦å‘çš„æ„æ€æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡æ»¡è¶³æ¡ä»¶çš„æ—¶å€™æ‰è§¦å‘ï¼Œä¹‹åå°±ä¸ä¼šå†ä¼ é€’åŒæ ·çš„äº‹ä»¶äº†ã€‚</p><p>å¦‚æœä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œå½“å†…æ ¸é€šçŸ¥æ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™æ—¶ï¼Œæ¥ä¸‹æ¥è¿˜å¯ä»¥ç»§ç»­å»æ£€æµ‹å®ƒçš„çŠ¶æ€ï¼Œçœ‹å®ƒæ˜¯å¦ä¾ç„¶å¯è¯»æˆ–å¯å†™ã€‚æ‰€ä»¥åœ¨æ”¶åˆ°é€šçŸ¥åï¼Œæ²¡å¿…è¦ä¸€æ¬¡æ‰§è¡Œå°½å¯èƒ½å¤šçš„è¯»å†™æ“ä½œã€‚</p><p>å¦‚æœä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼ŒI/O äº‹ä»¶å‘ç”Ÿæ—¶åªä¼šé€šçŸ¥ä¸€æ¬¡ï¼Œè€Œä¸”æˆ‘ä»¬ä¸çŸ¥é“åˆ°åº•èƒ½è¯»å†™å¤šå°‘æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ”¶åˆ°é€šçŸ¥ååº”å°½å¯èƒ½åœ°è¯»å†™æ•°æ®ï¼Œä»¥å…é”™å¤±è¯»å†™çš„æœºä¼šã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼š<strong>å¾ªç¯</strong>ä»æ–‡ä»¶æè¿°ç¬¦è¯»å†™æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœæ–‡ä»¶æè¿°ç¬¦æ˜¯é˜»å¡çš„ï¼Œæ²¡æœ‰æ•°æ®å¯è¯»å†™æ—¶ï¼Œè¿›ç¨‹ä¼šé˜»å¡åœ¨è¯»å†™å‡½æ•°é‚£é‡Œï¼Œç¨‹åºå°±æ²¡åŠæ³•ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œ<strong>è¾¹ç¼˜è§¦å‘æ¨¡å¼ä¸€èˆ¬å’Œéé˜»å¡ I/O æ­é…ä½¿ç”¨</strong>ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œ I/O æ“ä½œï¼Œç›´åˆ°ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ <code>read</code> å’Œ <code>write</code>ï¼‰è¿”å›é”™è¯¯ï¼Œé”™è¯¯ç±»å‹ä¸º <code>EAGAIN</code> æˆ– <code>EWOULDBLOCK</code>ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¾¹ç¼˜è§¦å‘çš„æ•ˆç‡æ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡è¦é«˜ï¼Œå› ä¸ºè¾¹ç¼˜è§¦å‘å¯ä»¥å‡å°‘ epoll_wait çš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œç³»ç»Ÿè°ƒç”¨ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„å¼€é”€çš„çš„ï¼Œæ¯•ç«Ÿä¹Ÿå­˜åœ¨ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p><p>select/poll åªæœ‰æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œepoll é»˜è®¤çš„è§¦å‘æ¨¡å¼æ˜¯æ°´å¹³è§¦å‘ï¼Œä½†æ˜¯å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯è®¾ç½®ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ã€‚</p><p>å¦å¤–ï¼Œä½¿ç”¨ I/O å¤šè·¯å¤ç”¨æ—¶ï¼Œæœ€å¥½æ­é…éé˜»å¡ I/O ä¸€èµ·ä½¿ç”¨ï¼ŒLinux æ‰‹å†Œå…³äº select çš„å†…å®¹ä¸­æœ‰å¦‚ä¸‹è¯´æ˜ï¼š</p><blockquote><p>Under Linux, select() may report a socket file descriptor as &quot;ready for reading&quot;, while nevertheless a subsequent read blocks. This could for example happen when data has arrived but upon examination has wrong checksum and is discarded. There may be other circumstances in which a file descriptor is spuriously reported as ready. Thus it may be safer to use O_NONBLOCK on sockets that should not block.</p><p>åœ¨Linuxä¸‹ï¼Œselectï¼ˆï¼‰å¯èƒ½ä¼šå°†å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦æŠ¥å‘Šä¸ºâ€œå‡†å¤‡å¥½è¯»å–â€ï¼Œä½†éšåçš„è¯»å–å—ä»ç„¶å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®å·²åˆ°è¾¾ä½†æ£€æŸ¥åæ ¡éªŒå’Œé”™è¯¯å¹¶è¢«ä¸¢å¼ƒæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æè¿°ç¬¦å¯èƒ½ä¼šè¢«è™šå‡åœ°æŠ¥å‘Šä¸ºå‡†å¤‡å°±ç»ªã€‚å› æ­¤ï¼Œåœ¨ä¸åº”è¯¥å±è”½çš„å¥—æ¥å­—ä¸Šä½¿ç”¨O_NONBLOCKå¯èƒ½æ›´å®‰å…¨ã€‚</p></blockquote><p>ç®€å•ç‚¹ç†è§£ï¼Œå°±æ˜¯<strong>å¤šè·¯å¤ç”¨ API è¿”å›çš„äº‹ä»¶å¹¶ä¸ä¸€å®šå¯è¯»å†™çš„</strong>ï¼Œå¦‚æœä½¿ç”¨é˜»å¡ I/Oï¼Œ é‚£ä¹ˆåœ¨è°ƒç”¨ read/write æ—¶åˆ™ä¼šå‘ç”Ÿç¨‹åºé˜»å¡ï¼Œå› æ­¤æœ€å¥½æ­é…éé˜»å¡ I/Oï¼Œä»¥ä¾¿åº”å¯¹æå°‘æ•°çš„ç‰¹æ®Šæƒ…å†µã€‚</p><h4 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1" aria-hidden="true">#</a> æ€»ç»“</h4><p>æœ€åŸºç¡€çš„ TCP çš„ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯é˜»å¡ I/O æ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šåªèƒ½ä¸€å¯¹ä¸€é€šä¿¡ï¼Œé‚£ä¸ºäº†æœåŠ¡æ›´å¤šçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›ç½‘ç»œ I/O æ¨¡å‹ã€‚</p><p>æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ï¼Œæ¯æ¥ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ†é…ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹ï¼Œç„¶ååç»­çš„è¯»å†™éƒ½åœ¨å¯¹åº”çš„è¿›ç¨‹/çº¿ç¨‹ï¼Œè¿™ç§æ–¹å¼å¤„ç† 100 ä¸ªå®¢æˆ·ç«¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯å¢å¤§åˆ° 10000 ä¸ªæ—¶ï¼Œ10000 ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„è°ƒåº¦ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠå®ƒä»¬å ç”¨çš„å†…å­˜ï¼Œéƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå°±å‡ºç°äº† I/O çš„å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åªåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¤„ç†å¤šä¸ªæ–‡ä»¶çš„ I/Oï¼ŒLinux ä¸‹æœ‰ä¸‰ç§æä¾› I/O å¤šè·¯å¤ç”¨çš„ APIï¼Œåˆ†åˆ«æ˜¯ï¼š selectã€pollã€epollã€‚</p><p>select å’Œ poll å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå®ƒä»¬å†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€æ¥å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆã€‚</p><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æŠŠå…³æ³¨çš„ Socket é›†åˆé€šè¿‡ select/poll ç³»ç»Ÿè°ƒç”¨ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œç„¶åç”±å†…æ ¸æ£€æµ‹äº‹ä»¶ï¼Œå½“æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿæ—¶ï¼Œå†…æ ¸éœ€è¦éå†è¿›ç¨‹å…³æ³¨ Socket é›†åˆï¼Œæ‰¾åˆ°å¯¹åº”çš„ Socketï¼Œå¹¶è®¾ç½®å…¶çŠ¶æ€ä¸ºå¯è¯»/å¯å†™ï¼Œç„¶åæŠŠæ•´ä¸ª Socket é›†åˆä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€è¿˜è¦ç»§ç»­éå†æ•´ä¸ª Socket é›†åˆæ‰¾åˆ°å¯è¯»/å¯å†™çš„ Socketï¼Œç„¶åå¯¹å…¶å¤„ç†ã€‚</p><p>å¾ˆæ˜æ˜¾å‘ç°ï¼Œselect å’Œ poll çš„ç¼ºé™·åœ¨äºï¼Œå½“å®¢æˆ·ç«¯è¶Šå¤šï¼Œä¹Ÿå°±æ˜¯ Socket é›†åˆè¶Šå¤§ï¼ŒSocket é›†åˆçš„éå†å’Œæ‹·è´ä¼šå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ï¼Œå› æ­¤ä¹Ÿå¾ˆéš¾åº”å¯¹ C10Kã€‚</p><p>epoll æ˜¯è§£å†³ C10K é—®é¢˜çš„åˆ©å™¨ï¼Œé€šè¿‡ä¸¤ä¸ªæ–¹é¢è§£å†³äº† select/poll çš„é—®é¢˜ã€‚</p><ul><li>epoll åœ¨å†…æ ¸é‡Œä½¿ç”¨ã€Œçº¢é»‘æ ‘ã€æ¥å…³æ³¨è¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„ Socketï¼Œçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œé€šè¿‡å¯¹è¿™æ£µé»‘çº¢æ ‘çš„ç®¡ç†ï¼Œä¸éœ€è¦åƒ select/poll åœ¨æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥æ•´ä¸ª Socket é›†åˆï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¤§é‡çš„æ•°æ®æ‹·è´å’Œå†…å­˜åˆ†é…ã€‚</li><li>epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªã€Œé“¾è¡¨ã€æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œåªå°†æœ‰äº‹ä»¶å‘ç”Ÿçš„ Socket é›†åˆä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ªé›†åˆï¼ˆåŒ…å«æœ‰å’Œæ— äº‹ä»¶çš„ Socket ï¼‰ï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚</li></ul><p>è€Œä¸”ï¼Œepoll æ”¯æŒè¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘çš„æ–¹å¼ï¼Œè€Œ select/poll åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¹ç¼˜è§¦å‘çš„æ–¹å¼ä¼šæ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡é«˜ã€‚</p><h3 id="linuxå†…å­˜ç”³è¯·çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#linuxå†…å­˜ç”³è¯·çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> Linuxå†…å­˜ç”³è¯·çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç”¨äºç”³è¯·å†…å­˜çš„ç³»ç»Ÿè°ƒç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼š<code>brk</code>å’Œ<code>sbrk</code>ï¼Œä»¥åŠ<code>mmap</code>å’Œ<code>mremap</code>ã€‚</p><ol><li><code>brk</code> å’Œ <code>sbrk</code>ï¼šè¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯ç”¨æ¥ç®¡ç†ç¨‹åºæ•°æ®æ®µï¼ˆä¹Ÿç§°ä¸ºå †ï¼‰çš„å¤§å°ã€‚æ•°æ®æ®µåœ¨ç¨‹åºçš„åœ°å€ç©ºé—´ä¸­å­˜å‚¨åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä¾‹å¦‚ç”±<code>malloc</code>åˆ†é…çš„å†…å­˜ã€‚<code>brk</code>è®¾ç½®æ–°çš„å †æœ«å°¾çš„åœ°å€ï¼Œè€Œ<code>sbrk</code>å¢åŠ å †çš„å¤§å°ã€‚å¦‚æœæˆåŠŸï¼Œç³»ç»Ÿè°ƒç”¨å°†è¿”å›é›¶ï¼›å¦‚æœå¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œç”±äºå†…å­˜ä¸è¶³ï¼‰ï¼Œåˆ™è¿”å›éé›¶å€¼ã€‚å½“è°ƒç”¨<code>malloc</code>æˆ–ç±»ä¼¼çš„å‡½æ•°æ¥åˆ†é…å†…å­˜æ—¶ï¼ŒCåº“å¯èƒ½é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å·²åˆ†é…ä½†æœªä½¿ç”¨çš„å †ç©ºé—´æ¥æ»¡è¶³è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†ä½¿ç”¨<code>sbrk</code>æˆ–<code>brk</code>æ¥å¢åŠ å †çš„å¤§å°ã€‚ç„¶åï¼Œåº“å°†è¿”å›æ–°åˆ†é…çš„å†…å­˜å—çš„æŒ‡é’ˆã€‚</li></ol><figure><img src="'+D+'" alt="brkç”³è¯·" tabindex="0" loading="lazy"><figcaption>brkç”³è¯·</figcaption></figure><ol start="2"><li><code>mmap</code>ï¼šè¿™ä¸ªç³»ç»Ÿè°ƒç”¨åœ¨ç¨‹åºçš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ˜ å°„ã€‚<code>mmap</code>å¯ä»¥ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬å†…å­˜åˆ†é…ã€‚å®é™…ä¸Šï¼Œè®¸å¤šç°ä»£çš„Cåº“å®ç°åœ¨åˆ†é…å¤§å—å†…å­˜æ—¶ä½¿ç”¨<code>mmap</code>ï¼Œè€Œä¸æ˜¯<code>brk</code>æˆ–<code>sbrk</code>ã€‚å½“è°ƒç”¨<code>mmap</code>æ—¶ï¼Œå¿…é¡»æŒ‡å®šè¦æ˜ å°„çš„é•¿åº¦ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©ä¸€ä¸ªé¦–é€‰çš„è™šæ‹Ÿåœ°å€ï¼ˆå°½ç®¡æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªåœ°å€ï¼‰ã€‚å¦‚æœæˆåŠŸï¼Œ<code>mmap</code>å°†è¿”å›æ˜ å°„çš„èµ·å§‹åœ°å€ã€‚è¿™å—å†…å­˜ç°åœ¨å¯ä»¥ç”¨äºç¨‹åºä½¿ç”¨ã€‚å¯¹äºé€šè¿‡<code>mmap</code>åˆ†é…çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨<code>munmap</code>æ¥é‡Šæ”¾ã€‚</li></ol><figure><img src="'+U+'" alt="mmapç”³è¯·" tabindex="0" loading="lazy"><figcaption>mmapç”³è¯·</figcaption></figure><ol start="3"><li><code>mremap</code>ï¼šè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜å·²å­˜åœ¨çš„å†…å­˜åŒºåŸŸçš„å¤§å°ï¼Œä¸€èˆ¬åœ¨ä½¿ç”¨reallocå‡½æ•°æ—¶å¯èƒ½ä¼šè°ƒç”¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚</li></ol><blockquote><p>ä»€ä¹ˆåœºæ™¯ä¸‹ malloc() ä¼šé€šè¿‡ brk() åˆ†é…å†…å­˜ï¼Ÿåˆæ˜¯ä»€ä¹ˆåœºæ™¯ä¸‹é€šè¿‡ mmap() åˆ†é…å†…å­˜ï¼Ÿ</p></blockquote><p>malloc() æºç é‡Œé»˜è®¤å®šä¹‰äº†ä¸€ä¸ªé˜ˆå€¼ï¼š</p><ul><li>å¦‚æœç”¨æˆ·åˆ†é…çš„å†…å­˜å°äº 128 KBï¼Œåˆ™é€šè¿‡ brk() ç”³è¯·å†…å­˜ï¼›</li><li>å¦‚æœç”¨æˆ·åˆ†é…çš„å†…å­˜å¤§äº 128 KBï¼Œåˆ™é€šè¿‡ mmap() ç”³è¯·å†…å­˜ï¼›</li></ul><p>æ³¨æ„ï¼Œä¸åŒçš„ glibc ç‰ˆæœ¬å®šä¹‰çš„é˜ˆå€¼ä¹Ÿæ˜¯ä¸åŒçš„ã€‚</p><p>ä»¥ä¸Šæåˆ°çš„è¿™äº›ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯åº•å±‚çš„æœºåˆ¶ï¼Œç›´æ¥ä¸å†…æ ¸äº¤äº’ï¼Œå› æ­¤ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨ä»–ä»¬ï¼Œè€Œæ˜¯ä½¿ç”¨å°è£…äº†è¿™äº›ç³»ç»Ÿè°ƒç”¨çš„åº“å‡½æ•°ï¼Œå¦‚<code>malloc</code>ï¼Œ<code>calloc</code>ï¼Œ<code>realloc</code>ç­‰ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆä¸å…¨éƒ¨ä½¿ç”¨ mmap æ¥åˆ†é…å†…å­˜ï¼Ÿ</p></blockquote><p>å› ä¸ºå‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œæ˜¯è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„ï¼Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ˜¯è¦è¿›å…¥å†…æ ¸æ€çš„ï¼Œç„¶ååœ¨å›åˆ°ç”¨æˆ·æ€ï¼Œè¿è¡Œæ€çš„åˆ‡æ¢ä¼šè€—è´¹ä¸å°‘æ—¶é—´ã€‚</p><p>æ‰€ä»¥ï¼Œç”³è¯·å†…å­˜çš„æ“ä½œåº”è¯¥é¿å…é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚æœéƒ½ç”¨ mmap æ¥åˆ†é…å†…å­˜ï¼Œç­‰äºæ¯æ¬¡éƒ½è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p><p>å¦å¤–ï¼Œå› ä¸º mmap åˆ†é…çš„å†…å­˜æ¯æ¬¡é‡Šæ”¾çš„æ—¶å€™ï¼Œéƒ½ä¼šå½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œäºæ˜¯æ¯æ¬¡ mmap åˆ†é…çš„è™šæ‹Ÿåœ°å€éƒ½æ˜¯ç¼ºé¡µçŠ¶æ€çš„ï¼Œç„¶ååœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¯¥è™šæ‹Ÿåœ°å€çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>é¢‘ç¹é€šè¿‡ mmap åˆ†é…çš„å†…å­˜è¯ï¼Œä¸ä»…æ¯æ¬¡éƒ½ä¼šå‘ç”Ÿè¿è¡Œæ€çš„åˆ‡æ¢ï¼Œè¿˜ä¼šå‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼ˆåœ¨ç¬¬ä¸€æ¬¡è®¿é—®è™šæ‹Ÿåœ°å€åï¼‰ï¼Œè¿™æ ·ä¼šå¯¼è‡´ CPU æ¶ˆè€—è¾ƒå¤§</strong>ã€‚</p><p>ä¸ºäº†æ”¹è¿›è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œmalloc é€šè¿‡ brk() ç³»ç»Ÿè°ƒç”¨åœ¨å †ç©ºé—´ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œç”±äºå †ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ç›´æ¥é¢„åˆ†é…æ›´å¤§çš„å†…å­˜æ¥ä½œä¸ºå†…å­˜æ± ï¼Œå½“å†…å­˜é‡Šæ”¾çš„æ—¶å€™ï¼Œå°±ç¼“å­˜åœ¨å†…å­˜æ± ä¸­ã€‚</p><p><strong>ç­‰ä¸‹æ¬¡åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œå°±ç›´æ¥ä»å†…å­˜æ± å–å‡ºå¯¹åº”çš„å†…å­˜å—å°±è¡Œäº†ï¼Œè€Œä¸”å¯èƒ½è¿™ä¸ªå†…å­˜å—çš„è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»è¿˜å­˜åœ¨ï¼Œè¿™æ ·ä¸ä»…å‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ï¼Œä¹Ÿå‡å°‘äº†ç¼ºé¡µä¸­æ–­çš„æ¬¡æ•°ï¼Œè¿™å°†å¤§å¤§é™ä½ CPU çš„æ¶ˆè€—</strong>ã€‚</p><blockquote><p>æ—¢ç„¶ brk é‚£ä¹ˆç‰›é€¼ï¼Œä¸ºä»€ä¹ˆä¸å…¨éƒ¨ä½¿ç”¨ brk æ¥åˆ†é…ï¼Ÿ</p></blockquote><p>å¦‚æœæˆ‘ä»¬è¿ç»­ç”³è¯·äº† 10kï¼Œ20kï¼Œ30k è¿™ä¸‰ç‰‡å†…å­˜ï¼Œå¦‚æœ 10k å’Œ 20k è¿™ä¸¤ç‰‡é‡Šæ”¾äº†ï¼Œå˜ä¸ºäº†ç©ºé—²å†…å­˜ç©ºé—´ï¼Œå¦‚æœä¸‹æ¬¡ç”³è¯·çš„å†…å­˜å°äº 30kï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡ç”¨è¿™ä¸ªç©ºé—²å†…å­˜ç©ºé—´ã€‚</p><p>ä½†æ˜¯å¦‚æœä¸‹æ¬¡ç”³è¯·çš„å†…å­˜å¤§äº 30kï¼Œæ²¡æœ‰å¯ç”¨çš„ç©ºé—²å†…å­˜ç©ºé—´ï¼Œå¿…é¡»å‘ OS ç”³è¯·ï¼Œå®é™…ä½¿ç”¨å†…å­˜ç»§ç»­å¢å¤§ã€‚</p><p>å› æ­¤ï¼Œéšç€ç³»ç»Ÿé¢‘ç¹åœ° malloc å’Œ free ï¼Œå°¤å…¶å¯¹äºå°å—å†…å­˜ï¼Œå †å†…å°†äº§ç”Ÿè¶Šæ¥è¶Šå¤šä¸å¯ç”¨çš„ç¢ç‰‡ï¼Œå¯¼è‡´â€œå†…å­˜æ³„éœ²â€ã€‚è€Œè¿™ç§â€œæ³„éœ²â€ç°è±¡ä½¿ç”¨ valgrind æ˜¯æ— æ³•æ£€æµ‹å‡ºæ¥çš„ã€‚</p><p>æ‰€ä»¥ï¼Œmalloc å®ç°ä¸­ï¼Œå……åˆ†è€ƒè™‘äº† brk å’Œ mmap è¡Œä¸ºä¸Šçš„å·®å¼‚åŠä¼˜ç¼ºç‚¹ï¼Œé»˜è®¤åˆ†é…å¤§å—å†…å­˜ (128KB) æ‰ä½¿ç”¨ mmap åˆ†é…å†…å­˜ç©ºé—´ã€‚</p>',62),In=n("p",null,"å‚è€ƒï¼š",-1),Pn={href:"https://xiaolincoding.com/os/3_memory/malloc.html#linux-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7",target:"_blank",rel:"noopener noreferrer"},On={href:"https://profoundadvices.com/what-is-brk-and-sbrk-system-calls/",target:"_blank",rel:"noopener noreferrer"},Rn={href:"https://linux.die.net/man/2/brk",target:"_blank",rel:"noopener noreferrer"},qn={href:"https://stackoverflow.com/questions/31261790/sbrk-system-call-in-unix",target:"_blank",rel:"noopener noreferrer"},An={href:"https://stackoverflow.com/questions/6988487/what-does-the-brk-system-call-do",target:"_blank",rel:"noopener noreferrer"},En={href:"https://www.man7.org/linux/man-pages/man2/brk.2.html",target:"_blank",rel:"noopener noreferrer"},Dn={href:"https://stackoverflow.com/questions/1754451/memory-mapped-files-system-call-linux",target:"_blank",rel:"noopener noreferrer"};function Un(Ln,Tn){const a=i("ExternalLinkIcon");return p(),c("div",null,[T,n("blockquote",null,[n("p",null,[n("a",B,[s("æ¥è‡ªbiaodianfuå›ç­”"),e(a)])])]),N,n("ul",null,[M,z,H,j,n("li",null,[s("æ–‡ä»¶æ˜ å°„æ®µï¼ŒåŒ…æ‹¬åŠ¨æ€åº“ã€å…±äº«å†…å­˜ç­‰ï¼Œä»ä½åœ°å€å¼€å§‹å‘ä¸Šå¢é•¿ï¼ˆ"),n("a",F,[s("è·Ÿç¡¬ä»¶å’Œå†…æ ¸ç‰ˆæœ¬æœ‰å…³ (opens new window)"),e(a)]),s("ï¼‰ï¼›")]),K]),J,n("blockquote",null,[n("p",null,[s("ç»´åŸºç™¾ç§‘ï¼šæ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘"),n("a",G,[s("å†…æ ¸"),e(a)]),s("ä¸ºæ¯ä¸€ä¸ª"),n("a",V,[s("è¿›ç¨‹"),e(a)]),s("æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨"),n("a",W,[s("ç¨‹åºè®¾è®¡"),e(a)]),s("ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äº"),n("a",X,[s("UNIX"),e(a)]),s("ã€"),n("a",Z,[s("Linux"),e(a)]),s("è¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚")])]),$,Q,Y,nn,sn,n("blockquote",null,[an,n("ol",null,[n("li",null,[n("a",en,[s("https://www.computerhope.com/jargon/f/file-descriptor.htm"),e(a)])]),n("li",null,[n("a",tn,[s("https://zh.wikipedia.org/wiki/æ–‡ä»¶æè¿°ç¬¦"),e(a)])]),n("li",null,[n("a",on,[s("https://stackoverflow.com/questions/5256599/what-are-file-descriptors-explained-in-simple-terms"),e(a)])])])]),pn,n("blockquote",null,[n("p",null,[s("ä¸‹é¢è¿™éƒ¨åˆ†æ€»ç»“å‚è€ƒäº†:"),n("a",cn,[s("ã€Šè¿›ç¨‹é—´é€šä¿¡ IPC (InterProcess Communication)ã€‹"),e(a)]),s("è¿™ç¯‡æ–‡ç« ï¼Œæ¨èé˜…è¯»ï¼Œæ€»ç»“çš„éå¸¸ä¸é”™ã€‚")])]),ln,n("blockquote",null,[rn,n("ol",null,[n("li",null,[n("a",un,[s("https://stackoverflow.com/questions/34512/what-is-a-deadlock"),e(a)])]),n("li",null,[n("a",dn,[s("https://www.geeksforgeeks.org/introduction-of-deadlock-in-operating-system/"),e(a)])]),n("li",null,[n("a",kn,[s("https://baike.baidu.com/item/%E6%AD%BB%E9%94%81/2196938"),e(a)])])])]),mn,n("blockquote",null,[n("ul",null,[gn,n("li",null,[n("a",hn,[s("ç»´åŸºç™¾ç§‘"),e(a)]),s('ï¼šåœ¨ç±»UNIXç³»ç»Ÿä¸­ï¼Œåƒµå°¸è¿›ç¨‹æ˜¯æŒ‡å®Œæˆæ‰§è¡Œï¼ˆé€šè¿‡exitç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–è¿è¡Œæ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯æˆ–æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ‰€è‡´ï¼‰ï¼Œä½†åœ¨æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è¡¨ä¸­ä»ç„¶å­˜åœ¨å…¶è¿›ç¨‹æ§åˆ¶å—ï¼Œå¤„äº"ç»ˆæ­¢çŠ¶æ€"çš„è¿›ç¨‹ã€‚è¿™å‘ç”Ÿäºå­è¿›ç¨‹éœ€è¦ä¿ç•™è¡¨é¡¹ä»¥å…è®¸å…¶çˆ¶è¿›ç¨‹è¯»å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼šä¸€æ—¦é€€å‡ºæ€é€šè¿‡waitç³»ç»Ÿè°ƒç”¨è¯»å–ï¼Œåƒµå°¸è¿›ç¨‹æ¡ç›®å°±ä»è¿›ç¨‹è¡¨ä¸­åˆ é™¤ï¼Œç§°ä¹‹ä¸º"å›æ”¶"ï¼ˆreapedï¼‰ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç›´æ¥è¢«å…¶çˆ¶è¿›ç¨‹waitå¹¶ç”±ç³»ç»Ÿå›æ”¶ã€‚è¿›ç¨‹é•¿æ—¶é—´ä¿æŒåƒµå°¸çŠ¶æ€ä¸€èˆ¬æ˜¯é”™è¯¯çš„å¹¶å¯¼è‡´èµ„æºæ³„æ¼ã€‚')])])]),vn,n("blockquote",null,[n("p",null,[s("ç™¾åº¦ç™¾ç§‘ï¼šåœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸä¸­ï¼Œå­¤å„¿è¿›ç¨‹æŒ‡çš„"),bn,s("ã€‚è¿™äº›å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹ (è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚ "),n("a",fn,[s("ç»´åŸºç™¾ç§‘"),e(a)]),s("ï¼šåœ¨æ“ä½œç³»ç»Ÿé¢†åŸŸä¸­ï¼Œå­¤å„¿è¿›ç¨‹ï¼ˆOrphan Processï¼‰æŒ‡çš„æ˜¯åœ¨å…¶çˆ¶è¿›ç¨‹æ‰§è¡Œå®Œæˆæˆ–è¢«ç»ˆæ­¢åä»ç»§ç»­è¿è¡Œçš„ä¸€ç±»è¿›ç¨‹ã€‚")])]),wn,n("blockquote",null,[_n,n("ul",null,[n("li",null,[n("a",Sn,[s("https://www.mo4tech.com/io-multiplexing-in-select-poll-epoll-differences.html"),e(a)])]),n("li",null,[n("a",xn,[s("https://notes.shichao.io/unp/ch6/"),e(a)])]),n("li",null,[n("a",yn,[s("https://www.techrepublic.com/article/using-the-select-and-poll-methods/"),e(a)])])])]),Cn,n("blockquote",null,[In,n("ol",null,[n("li",null,[n("a",Pn,[s("https://xiaolincoding.com/os/3_memory/malloc.html#linux-è¿›ç¨‹çš„å†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·"),e(a)])]),n("li",null,[n("a",On,[s("https://profoundadvices.com/what-is-brk-and-sbrk-system-calls/"),e(a)])]),n("li",null,[n("a",Rn,[s("https://linux.die.net/man/2/brk"),e(a)])]),n("li",null,[n("a",qn,[s("https://stackoverflow.com/questions/31261790/sbrk-system-call-in-unix"),e(a)])]),n("li",null,[n("a",An,[s("https://stackoverflow.com/questions/6988487/what-does-the-brk-system-call-do"),e(a)])]),n("li",null,[n("a",En,[s("https://www.man7.org/linux/man-pages/man2/brk.2.html"),e(a)])]),n("li",null,[n("a",Dn,[s("https://stackoverflow.com/questions/1754451/memory-mapped-files-system-call-linux"),e(a)])])])])])}const Nn=o(L,[["render",Un],["__file","system.html.vue"]]);export{Nn as default};
