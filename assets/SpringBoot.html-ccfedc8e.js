import{_ as p,W as o,X as c,a0 as n,a1 as s,Z as t,$ as e,C as i}from"./framework-c8643d23.js";const l="/Computer-Science-Learn-Notes/assets/1-ceac24de.webp",u="/Computer-Science-Learn-Notes/assets/2-ee76fe10.webp",r="/Computer-Science-Learn-Notes/assets/3-c28719c2.webp",k="/Computer-Science-Learn-Notes/assets/4-96f9353e.webp",d="/Computer-Science-Learn-Notes/assets/5-9d99a966.webp",v="/Computer-Science-Learn-Notes/assets/6-b86a4061.webp",m="/Computer-Science-Learn-Notes/assets/7-0aff6229.webp",g="data:image/webp;base64,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",b="/Computer-Science-Learn-Notes/assets/9-48f2c28b.webp",f="data:image/webp;base64,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",y="/Computer-Science-Learn-Notes/assets/11-7c75319a.webp",h="data:image/webp;base64,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",w="data:image/webp;base64,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",A="data:image/webp;base64,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",S="/Computer-Science-Learn-Notes/assets/13.1-57e4cd4b.webp",C="/Computer-Science-Learn-Notes/assets/14-9db482dc.webp",E="/Computer-Science-Learn-Notes/assets/14.1-c3c932e9.webp",x="/Computer-Science-Learn-Notes/assets/15-c56df91d.webp",q="/Computer-Science-Learn-Notes/assets/16-1a6d6690.webp",j="data:image/webp;base64,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",B="data:image/webp;base64,UklGRjYEAABXRUJQVlA4ICoEAADQGgCdASoJAUIAPm02l0ikIqIhJDdI4IANiWdu3V6dZhVHYEbc9QH5s3hvmA6AG8Af0XfHf85X/H2v8erHffZlt8DOKP/ReEX5J6gHmSel/pi+od/sKfa/P825Fte7AfjbpFmX/7e9hddyz9XXxNDmPdAYrlvotCF/M+RNJA616MVdEOmVZLrYSF2PsCAaHX4JI4JAdO/D6HwbAhkIfPDgR1q8CLyfsYH9tvaUxZ3t6QCafO/oz3I1PEhpUyDLPk8B6DIX/spXDfeXJPZFktWT9F3VGD0569HsN3rG71hoAP70ImpxvmWStwekpQzyFC1t8T+zrG7XpoA9kawA3niv0SLZeYoMVEI8b5EX2EiHEHP4gvcWL712YYqHK/OHQyeB0Ub0KGJ///faE/3InD27WPvQVPoSMklUrZKGc8lu+CvZcNLExX4IMK2edWTOE6Iq7PBvC4/8f673J5o96zI8XqzibD9Hn2/ZYgF4zpQmNO/gm5moZNpwARd7lqPzECZWZyJNqexG+4X1uBrA0iZKVU/ABfVgABBy4oXTKQRg9VJ8OSkYtBi3OjyNbApo/q6j7QDkarmv3YAAQEBpANScnefjKaXrh61PUvlHkfzTBB7J8w65YAADOHZ0IijVDyYXidOJD3WzZC2w+H2bfvYcWY/WDhu3r8baIeE53aOBsLqQSwmIrzOXRk7lX9AKIuGwnkXRUH8VAoX5xX12XiXSVsGpWpjdM+8RXHPcUrbXRczJbXMA38JoJGsGwEcOQNy+KfTtsNuj0sNITuKjHZVMQCr8jbqqM9I3CpVCxT0YQIYwFD8ztJaLy9Juqu10myiHQbDwITt0fauAF8ZL0o6jGkJkgwPz9I2kgimbKyM8W3aPaBQFUsDp4boSSthk2TcQbmG2IQ57hRyAqrLVIYfsIDzS7LFwbXIDeigDL+hIfEKTN31MuPuWloR3kD0Y/TqtTiESrb7eFvW9/rnOCFwYH+uGIeSvIh1aoPlG1wIaywB3twNjbo7J0QdjOo2O78cmqlorqVmM2SCFmuI1UEdxS+fJOugYaANVvPau3RsjlX+4t0ar7NOV11VXG/LWElpK0fnJYbD3WiFB8y/7vyu6c7smuBDWV/g2fklXVIZD75skENJo4cgUeL5WBNU9D69ilmtP26y/WQoHfbv0KSkZ8pcW5GpkEInU4Q4wymHutELKhth1XwikjB4gNoa+raiH8NqtsR/pG0YwF9RVSIWjjpT7MQk7PEFPVD8YqU7dIAVfkK4ymTRDD6rPR9apHK4y1/h73V6ECGL5iWJRyGt+XCZac/1HVodj5YJbzSkQtRjJ4AEEgKnSLU6DDxCq+UIIgTsEdoLulKYVKKalU+dAJXFXlKput4Ki9wtCURO/eb+xGYIx1AA1Lx7iQ9dFIAAAAAPcd0AAAAAA",R="/Computer-Science-Learn-Notes/assets/19-8c6b2f81.webp",M="/Computer-Science-Learn-Notes/assets/20-c68c5148.webp",P="/Computer-Science-Learn-Notes/assets/21-edb72af3.webp",I="/Computer-Science-Learn-Notes/assets/22-05699983.webp",F="/Computer-Science-Learn-Notes/assets/23-6bafc20f.webp",L="/Computer-Science-Learn-Notes/assets/24-46398f1d.webp",O="/Computer-Science-Learn-Notes/assets/25-042c69db.webp",D="data:image/webp;base64,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",T="/Computer-Science-Learn-Notes/assets/27-0d86d9bc.webp",N="/Computer-Science-Learn-Notes/assets/28-c64ca718.webp",z="/Computer-Science-Learn-Notes/assets/29-c3fd5108.webp",H="/Computer-Science-Learn-Notes/assets/30-ff498fe6.webp",W="/Computer-Science-Learn-Notes/assets/31-b0640024.webp",V="/Computer-Science-Learn-Notes/assets/32-dc5055c8.webp",U="/Computer-Science-Learn-Notes/assets/33-e94f4e17.webp",J="/Computer-Science-Learn-Notes/assets/34-33ca94f4.webp",X="/Computer-Science-Learn-Notes/assets/35-ed58e913.webp",G="/Computer-Science-Learn-Notes/assets/36-60749859.webp",Y="/Computer-Science-Learn-Notes/assets/37-f9a9072a.webp",K="/Computer-Science-Learn-Notes/assets/38-10dd3066.webp",Q="/Computer-Science-Learn-Notes/assets/39-4de874e9.webp",Z="/Computer-Science-Learn-Notes/assets/40-f49ff34d.webp",_="data:image/webp;base64,UklGRqYCAABXRUJQVlA4IJoCAABQEwCdASoBAh4APm02l0gkIyIhJldomIANiWkAFtPq9V1FYDLA0gWPHzps4b0x7Av6z/7Xrq+i5+xwjNCgWjnp7FnxLc/lLYOHwxwR4e7XfDtltIWAjzvtv4kBWORFw7LIjcGhZCj0qkLYZapoYjsdsrJImWYcNW69La9tFIV0FCK5yMkLja1B8VPz9hHZBSD/vA/pluav1TtnAYfSc53VVRQAAP7/XcJ9p/8zm/ggeKuqZk7CVwK3VYIgmBSKNlzSy34s/ubLBKFPscEvgYNrxJRirf+H0wOvOWcPlq9JvjPxCU64uFvT9F+mOsfH46s80+G4QPRMOveKi71dUg+7HVPL9+Ha6z8ZLIHq4w7mdEOq3WsfLDPUfNijpvDs6mmPqxtuRjBvGAftyvKn9P7Vv97iZhrhGV8B8pI/BYUn/Ld8RzJCg4XB2Cg+vZyx0p435Vl7SMNu5OgmNLJQ5fJiQZ3utxObaIpvIwH4065D67xJIslXSBedt1+7qAjF96f9vCWr6IdTh44V8k40WxidAAdT76pZL9moLGtS98tLqVC3R/45Opm93Uwrb1QpsfEBxZ+vBCCsnvP9nuku52LEOpIJg4QHWVOBMG4TV3DK+/yb6nu9t2nHByqYQbWJFL1fsP8+6q21wTn2p+sGXImXodSKwKN8u8ae2lYRXN8d/flLG82PgKGmDH9c3/S97pqIImpbuHchXaJl2g8fhPoJVXENXo4EO9+Sofnq65atLXTmxdakNn8qIH+oOAce2IB8foSSGJjs6iLnpuuDngmOdl/mw07hdc36OkIivzgJjHbBBW9s+aTjWH5yHAVkVHAg5zjOmYCjMLV122G9QDZkp2cIGbTZQAxAT/Zcl9a+UskramNbjJAAAAA=",$="/Computer-Science-Learn-Notes/assets/42-957defed.webp",nn="/Computer-Science-Learn-Notes/assets/43-370b7c7c.webp",sn="/Computer-Science-Learn-Notes/assets/44-8fd71e02.webp",an="/Computer-Science-Learn-Notes/assets/45-b0bb43e7.webp",tn="/Computer-Science-Learn-Notes/assets/46-1187419d.webp",en="/Computer-Science-Learn-Notes/assets/47-7cbf3d31.webp",pn="/Computer-Science-Learn-Notes/assets/48-7c2a3887.webp",on="/Computer-Science-Learn-Notes/assets/49-f332d08c.webp",cn="/Computer-Science-Learn-Notes/assets/50-dbd2b4c8.webp",ln="/Computer-Science-Learn-Notes/assets/51-0bc55f39.webp",un="/Computer-Science-Learn-Notes/assets/52-413d0cb6.webp",rn="/Computer-Science-Learn-Notes/assets/53-4dc89eab.webp",kn="/Computer-Science-Learn-Notes/assets/54-3b8362a4.webp",dn="/Computer-Science-Learn-Notes/assets/55-8b6ecf46.webp",vn="/Computer-Science-Learn-Notes/assets/56-7001037b.webp",mn="/Computer-Science-Learn-Notes/assets/57-709af6e2.webp",gn="/Computer-Science-Learn-Notes/assets/58-0aa6e572.webp",bn="/Computer-Science-Learn-Notes/assets/59-50e7ed9e.webp",fn="/Computer-Science-Learn-Notes/assets/60-0ddd7da5.webp",yn="data:image/webp;base64,UklGRl4NAABXRUJQVlA4IFINAABQPwCdASojAWoAPm0ylUckIyIhKHX62IANiWNu4W/Q2J8df/WfyfCHke72/zPKHtZf6D1Df7bzJfXf6Zf2A9SH65fsz71PpT/z3pAejt/y/Ya/rPTherh/pukA///A5+K/7n2g/3Pwf8f0F7KXaZ9ZcPj+58JfifqBW/ex41j/E/2j1AvZX5t/wPCp/xfQX63f8v3API//l+El5x7AH8s/vH7De65/Lfs756/qb2Cv1w9Mf2Xekl+vRu2y0eqdg5UsvFUZ0nBqDMfjJ8yGaCSbJd6VnvX//PpQKRYYE0MplMplMph5VlR0pHxNoaEuML7JU6Ysk81Tcqjc6d9RYmo0ulUfov5vN5vN5d7HmqjQ8cZD1zGlRViWf9JfeC10pTbRFZDoyEvGcXmmOLWweMbGxsbGxsbGxr0P755kOhTah9W1UEdqEwfDUFRfU8DCtW39dJUGBGIBjjoivNHrm3pQmK3XuP////////09eUx3WO7sCFpFa/BAX8MBGGQNH92SZrhBrY78u/WkJ0irzI3ArFAzYzKS5bnsYNR5J8VriKH0IBzWGuAvMqxjGq5DVhybCfjE3llVRY2F9/eHtvx2yOwm3ou+Lw13MPmCc/MBfoaEpMObBYCYogEFjvg2rJz5TaaDQaDP+Rub57GcStvH2jRRPJg72H2utj/UCGhgAbDCAAD+/dM53J1x8cNXzxqQNkHNPyTYOKSExrt6Uz7BpX/xSV1hTHtk06SLpP+p6NJ0cEcV/RKgYFKsBD+JD6C62jz4Rd84KufEUyyClsKO3XjWX1s/3+402VsQcEP9gjuw4vWDd34+CRIc7kCi/IP4V+Ul0S0j4Vaxi4nNkcaHHXSuJy7L5k7ChXRIPBhiJV6rZGXDetotTcC2dlFVGQ+aRg+LojGRpYaUI2i5l/lrsuhGSZ5Kml1uFK91fjX1ZJ2cnWVOLmSNSvNx2AmSYgoIP8o7ftVaZjaVDpJh38fHq0hjwwiplDSvC2bKa8axci7/YNKRYqxdQHlpVgsx7Z0BzgQfpC22mqk6MYKdY+YyNr30QJREzGUjfvj6P+ICa/f1HK/IF9KAfXEAPTdshX2FsvevzkIVDZtxuzqkvRKflGDfyiNPtAq0b2RAuW0+WO6MJ7LPohVEoAAp7z2P/6hTjn7UH6rRKKQNRU/apwWPQ7oO64S2Tz/qH73OZWKYOJlKk5Z9ZUMxXGy+4cCNm8WPS8IV4SjoEjyaPQQlEcS7nJwXkVL+2eGesrywzznAhZTY8T0xxU1HcP8KQxlcq18q16yrbnc3FxMYC6qQ18UnZWwJjMsmW5wMJNqT/xzy+qNn2k0c3SGxcuXVonBmsLulQ33+Xsm3dks2t8igXpJq4exXQrpcXyyYZuVaGI8VOVwN69oSXpklTpHnYflQR5mPFXg6LoL6sQBBUfiD+QDx8bPKwldiQOfY3Ldz+rhDquxK2AfSw8R2hhlNr6OI42+FgcQP46KMjIfVHzYvGta+3FgETsXf7Qj87guWLbILA82mPAEL7fEnDHh/19zgBb9qN7s/n3wcjjfRPyEZhFKNPsju/kgAYBNIqvxsvrroK3oaHWx9O1UJ9sF1v/1otfHBO2O1Y3rEYpmbOY7E3TDLw3z/U3yL8SVEdOMAZXsgdia64agOtFkwcZOP7pOnmxRX9/6MEbBDjZxZXvtWqcUlQ+S0JKOZAEmfhGT8UGCAQRp/BDukSL/vedsOn9Njqh+aQLI6Fjupr76ilLDu+l7d9rvmGQ+U/niwpXRhh007IJFMFCXYzPemZAwR0OIb77+3eLKQgD4G+SnyMLgmyltzocZhhqSmvwl8Vrx+10HM8107la+Qy+5ZUQeHJnx/DVzRHNxa2BPRZtDWArODSXqDgSMya3E9xNCG4BuXtseeDRP+XcyASSCYCgFyP2o0lK6BvXP2qvk26Mn/Mneg3Ru2PQcqVn1bIoTOuQnnIIJ7t8DH0Wzl/HIttyAJbAqRZjTe20Uq7xgsPR4LwBleYZB7avMxxyibQQUxSya/26uNXNhsLofLdB5vplgrMm9SQbPo+T6FuBohOD0hIG6qeRXN9CZO0maG8hdPLbuKrQK+FhkXSdys8yEVJx7qIvKzJGiyzMJrVetBq785CdIfh5BN76IV2U3JJGfTZ8K3wGhWhxtGQnJFlEtieoMMUPm6VlixSSuGHRzX+4oV6E51wdb1ViAb0JHChgB1ZqVUTyaaWuQKjxw/4kAFGF9x3m8Io3YgbTsSgNlvqEOMa6DlsLIIfbSI/tbLyiO226Y4YeMy4iqsrWy+d5zJSJefk10Iru9wrAHSFasDNx0m9dWx6MIIoUhWNM/ihU6jhStjiSDmV8uQQ2Ke1E14QClp0NG2mBe7oYCuyCK+NW4YN6fkvwaRJbSp8Yl6IYACWz3e0NKT0Ilu2lSnFIYIgiw4GS1MXGcg+WTmlJdFWWCjE2e+Mm55DJeE16dj6U8g48xh/kaj9dO/3d/uz/DgtbT/rqegpKEItfCuBMJ/hzsOtdYqS/WGYHGpiIXLvLfFXhTu49upY8EUT8Tgc1EhKf9o4zJBZCi8WfHfnSpDx/L5CtYvVyGN99Yl9/4pYkuYhCK8ZAjlhEWT75hvDAmDdBo6ygnV49/XIVmMw1G3DMVqKKYNyeuZRu1IQP/je6DDFjvh0iyVdXmb+DKuPnhjyV2i9WYFTv8xFWn7oOcA69SMrLS262A9mgMBH5aEWNLvA/z3KOn8ewop5I7AzC9YRQ8cEQEdcZ1YhLXiT31mzTzUhvlhXlOul9MXt/PwcfUClXbbPdXV0YrM1ykgXbDWn3xNbVyCO74f6yH+mkhQwpjcU7+6MuBz9ggyCfG2OuDTIUw4nNf54eBS5doSQQMGb/INxxNzh4ae8tCXV6yRsXWsxRASw9YAp+BjsQvYVAUOQ7hcpiPCmqdXSxS6IcZ2x5cemfv3Y19z5LiXz207j5YhcfMJYreFIifYa8Q1qh3A8PHM0RVVrgH1thhW4F+KoKWueZfP/0ws1qy9jaumIYCMYFOcV1lu3lXu7/edyYDPVJ/5+bAsDsYpOk41ueS/jrn4VH4Y2h3RCvZ5piLANaQfPTPL8/pogfmQAFrUnKqY5yXTTAdutx3ouq8WebZXXn3KLXogChjz+R5GTMaNSYYDHe2A0JHvA/Bc9Lju3im9aP2OgHk+fqBefs8n3bGLic2RxocddBvRBilj3xfLIgDEBQ/xPE7L+q2vYmydewbhT788jDkDW6dxj4pwcg/O9ASr3xiEuFwxi1uP+Pqna5r4dWFZsEZpFCY8bO6tUhF51AJprHt1LHfwTlxOY3VNV7vhYDhjBXeit0rcMzBRwltQPjDHMHUlF+wxiuvPrViZonQi//Qcz9C5+hQWEBtyECUNk57eiWJkRJuv/I+9vEm3Xajl1leB8RgQK78pKCiPZxLL/sAGmPrk4Ss7t5SclbNflIQatAiUesCXW6DdqoJmldbB8ECUPwNfNRhOPa8Srwyifaq/k9z/N9BZ7jl/xbAj+t3lcOOSGGE2eJZnRE08eXE7uqRcM3Re4PE9jHcT8GIHyLkV6K0QqlvE7Gjhm9SltnwsH638dnH8WrXtPHc1at0FNAhqc3mam1zseyVSBT1K9ioM1npUpeJs1X2i5HJ+83wRsEBzch+LL2vr0ToyN0tOGiqTYUz6bjW2YOr7eKqHjD3LxDOp8eNXzjdoVfFwJUv17SjXvuMnhUX6fIENf+BqNenmvzeF82t/d2Na3CwFRuiToOmoL+9y+2x5gzSfMQm8d+i1sT9uS2IRD9K8ymdJHA/sgb4utzywseVKQZsH/uJAA/0hC895kp00J2Ugq2gBvWX08I3MoYDVnFnVOqgrzpbMtc9EC9ZB84A1u47hv4/nJrxbOvxjWoHZIBFXRk81NOQ74e7pixjyxlBVROGEUgGZQJaLuqOS6CO5nLzJKnAA5s/jGItBrXGIdt26dfy+TI4pzxfm7Tqn0973hosELMjKJYUiioOJjDq3QcG0WjhBAuk0y08U5oAA9SHgTdLsEY4CiXXD+ksuLvrZPrgt82+83TrxX4Do4C2JShNeRKfTO/xEJXIBPzKNSWvXDCDTxCF/u1GbQMbCzR8C/IspzdVbtEOkC5Ih6EXSVncof9aO5vBtT4sYxtvtzA+Zdzre89saoKa8GprqrKM24ZbuJoMydFVwkvz55FQOuVVdOzafSLi/HNX83QiW5/FHalfkPMAAAfbkTYkvAHXxzD3EDYlIV/XEU39xAURg9I6v9ZHCUFNFnlaUvmaLK0AmGb7aeAb380Je0sn/GFVoc3ATM0sbEKkHZf3QI7ROBx3a0i7C1g7KjTuVK+vQdx7vdE0IY09c0pBptkoV3efjYhac15epK76ZEL+JEA+1Nps+SEDMXNnt80bedZY2yaZdxMCRdJlw4BA2PKlyt6mXA/gbDn83BZI8mDF6nYjjyACDlYrqUVuWYB/V8upeRXlK9Ewnt6uO/8CafvFBNwc1Wegb6LCIZZGnhnBeXqkiajEoPRjc/lC0BKZxufJHkl/qVMXO0AAAAA==",hn="/Computer-Science-Learn-Notes/assets/63-66b3ba31.webp",wn="data:image/webp;base64,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",An="/Computer-Science-Learn-Notes/assets/65-08d71494.webp",Sn="/Computer-Science-Learn-Notes/assets/66-5b4188f2.webp",Cn="/Computer-Science-Learn-Notes/assets/67-4dc57f34.webp",En="/Computer-Science-Learn-Notes/assets/68-db54ba9c.webp",xn="/Computer-Science-Learn-Notes/assets/69-16392b10.webp",qn="/Computer-Science-Learn-Notes/assets/70-c587d13a.webp",jn="/Computer-Science-Learn-Notes/assets/71-9682300e.webp",Bn="/Computer-Science-Learn-Notes/assets/72-98d58161.webp",Rn="/Computer-Science-Learn-Notes/assets/73-4b4a2e7f.webp",Mn="/Computer-Science-Learn-Notes/assets/74-e44e2300.webp",Pn="/Computer-Science-Learn-Notes/assets/75-6fe56989.webp",In="/Computer-Science-Learn-Notes/assets/76-d16103c7.webp",Fn="/Computer-Science-Learn-Notes/assets/77-10c4166c.webp",Ln="/Computer-Science-Learn-Notes/assets/78-1045b17e.webp",On="/Computer-Science-Learn-Notes/assets/79-b03064ed.webp",Dn="/Computer-Science-Learn-Notes/assets/80-c7357884.webp",Tn="/Computer-Science-Learn-Notes/assets/81-80040e64.webp",Nn="/Computer-Science-Learn-Notes/assets/82-51429269.webp",zn={},Hn=e(`<h1 id="spring-boot-note" tabindex="-1"><a class="header-anchor" href="#spring-boot-note" aria-hidden="true">#</a> Spring-Boot-Note</h1><ul><li><a href="#spring-boot-note">Spring-Boot-Note</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA--%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">环境搭建 &amp; 简化部署</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">环境搭建</a></li><li><a href="#%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">简化部署</a></li></ul></li><li><a href="#springbootapplication%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86">@SpringBootApplication启动原理</a></li><li><a href="#idea-%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA">IDEA 快速构建</a></li><li><a href="#yaml">YAML</a><ul><li><a href="#yaml%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">YAML基本语法</a></li></ul></li><li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">单元测试</a><ul><li><a href="#ssm">SSM</a></li><li><a href="#springboot">SpringBoot</a></li></ul></li><li><a href="#configurationpropertiesvalue">@ConfigurationProperties&amp;@Value</a></li><li><a href="#propertysourceimportresource">@PropertySource&amp;@ImportResource</a><ul><li><a href="#%E6%8E%A8%E8%8D%90%E8%87%AA%E5%B7%B1%E5%88%9B%E5%BB%BA%E4%B8%AA%E9%85%8D%E7%BD%AE%E7%B1%BB">【推荐】自己创建个配置类</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8D%A0%E4%BD%8D%E7%AC%A6">配置文件的占位符</a></li><li><a href="#%E5%A4%9Aprofile%E6%94%AF%E6%8C%81">多Profile支持</a></li></ul></li><li><a href="#%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%92%8C%E4%BC%98%E5%85%88%E7%BA%A7">加载配置文件的位置和优先级</a></li><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">自动配置原理</a><ul><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86-1">自动配置原理</a></li><li><a href="#%E4%BB%A5httpencodingautoconfiguration%E4%B8%BA%E4%BE%8B%E8%A7%A3%E9%87%8A%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">以HttpEncodingAutoConfiguration为例解释自动配置原理</a></li><li><a href="#%E5%B0%8F%E7%BB%93">小结</a></li></ul></li><li><a href="#conditional%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3%E5%92%8Cdebug">@Conditional相关注解和Debug</a></li><li><a href="#%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6sl4j">日志框架SL4J</a><ul><li><a href="#%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAsl4j">其他日志框架转换为SL4J</a></li><li><a href="#springboot%E5%92%8C%E6%97%A5%E5%BF%97%E5%85%B3%E7%B3%BB">SpringBoot和日志关系</a></li><li><a href="#%E6%97%A5%E5%BF%97%E7%9A%84%E9%85%8D%E7%BD%AE">日志的配置</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">指定日志框架</a></li><li><a href="#%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">切换日志框架</a></li></ul></li><li><a href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99">静态资源映射规则</a></li><li><a href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8Ethymeleaf">模板引擎Thymeleaf</a></li><li><a href="#springmvc%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">SpringMVC自动配置原理</a><ul><li><a href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">默认配置</a></li><li><a href="#contentnegotiatingviewresolver">ContentNegotiatingViewResolver</a></li><li><a href="#httpmessageconverters">HttpMessageConverters</a></li><li><a href="#messagecodesresolver">MessageCodesResolver</a></li><li><a href="#springboot%E5%9C%A8springmvc%E7%9A%84%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F">SpringBoot在SpringMVC的配置模式</a></li><li><a href="#%E6%8E%A5%E7%AE%A1springboot%E7%9A%84springmvc">接管SpringBoot的SpringMVC</a></li><li><a href="#%E5%B0%8F%E7%BB%93-1">小结：</a></li></ul></li><li><a href="#%E5%9B%BD%E9%99%85%E5%8C%96">国际化</a><ul><li><a href="#%E4%BD%BF%E7%94%A8thymeleaf%E5%9B%BD%E9%99%85%E5%8C%96">使用thymeleaf国际化</a></li><li><a href="#springboot%E5%8C%BA%E5%9F%9F%E4%BF%A1%E6%81%AF%E8%A7%A3%E6%9E%90%E5%99%A8">SpringBoot区域信息解析器</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BD%E9%99%85%E5%8C%96">自定义国际化</a></li></ul></li><li><a href="#%E6%8B%A6%E6%88%AA%E5%99%A8">拦截器</a></li><li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86">错误处理原理</a></li><li><a href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2%E5%92%8Cjson%E9%94%99%E8%AF%AF%E6%95%B0%E6%8D%AE">定制错误页面和JSON错误数据</a><ul><li><a href="#%E5%AE%9A%E5%88%B6%E4%B8%80%E4%B8%AAjson%E6%95%B0%E6%8D%AE">定制一个JSON数据</a></li></ul></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet">嵌入式Servlet</a><ul><li><a href="#spring%E4%B8%A4%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">Spring两种配置方式：</a></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E4%B8%A4%E7%A7%8D%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">嵌入式Servlet两种修改相关配置</a></li><li><a href="#%E6%B3%A8%E5%86%8C%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6">注册三大组件</a><ul><li><a href="#%E5%AE%9A%E5%88%B6servlet">定制Servlet</a></li><li><a href="#%E5%AE%9A%E5%88%B6filter">定制Filter</a></li><li><a href="#%E5%AE%9A%E5%88%B6listener">定制Listener</a></li></ul></li></ul></li><li><a href="#%E6%BA%90%E7%A0%81%E5%88%A8%E6%9E%90-%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%8E%9F%E7%90%86">源码刨析 嵌入式Servlet原理</a><ul><li><a href="#%E4%BB%A5tomcat%E4%B8%BA%E4%BE%8B">以Tomcat为例</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%8E%9F%E7%90%86">配置是如何修改原理</a></li><li><a href="#%E5%B0%8F%E7%BB%93-2">小结：</a></li></ul></li><li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">嵌入式Servlet自动配置原理</a></li><li><a href="#%E6%95%B4%E5%90%88jdbc">整合JDBC</a><ul><li><a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86-2">自动配置原理</a></li></ul></li><li><a href="#%E6%95%B4%E5%90%88druid">整合Druid</a></li><li><a href="#%E6%95%B4%E5%90%88mybatis">整合Mybatis</a><ul><li><a href="#maven">Maven</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3">使用注解</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">使用配置文件</a></li></ul></li><li><a href="#springboot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86">SpringBoot启动原理</a><ul><li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%88%9B%E5%BB%BAspringapplication%E5%AF%B9%E8%B1%A1">第一步：创建SpringApplication对象</a></li><li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8">第二步：启动应用</a></li></ul></li><li><a href="#%E5%9F%BA%E4%BA%8E%E5%8E%9F%E7%90%86%E7%9A%84%E6%B5%8B%E8%AF%95%E7%AC%94%E8%AE%B0%E6%B5%8B%E8%AF%95%E5%90%AF%E5%8A%A8%E7%9A%84%E5%9B%9B%E4%B8%AA%E7%B1%BB">（基于原理的测试笔记）测试启动的四个类</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89starters%E6%9A%82%E6%97%B6%E6%97%A0%E6%B3%95%E7%90%86%E8%A7%A3">自定义starters【暂时无法理解】</a></li><li><a href="#springboot%E7%BC%93%E5%AD%98%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">SpringBoot缓存基本使用</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">基本使用</a></li><li><a href="#%E5%87%A0%E4%B8%AA%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D">几个属性介绍</a></li></ul></li><li><a href="#%E7%BC%93%E5%AD%98%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">缓存自动配置原理</a><ul><li><a href="#%E4%BB%A5cacheable%E4%B8%BA%E4%BE%8B">以@Cacheable为例</a></li><li><a href="#%E5%B0%8F%E7%BB%93-3">小结：</a><ul><li><a href="#%E6%A0%B8%E5%BF%83">核心：</a></li><li><a href="#%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86">思路整理</a></li></ul></li></ul></li><li><a href="#cacheput%E7%9A%84%E4%BD%BF%E7%94%A8">@CachePut的使用</a></li><li><a href="#cacheevict-%E6%B8%85%E9%99%A4%E7%BC%93%E5%AD%98">@CacheEvict 清除缓存</a></li><li><a href="#caching%E5%92%8Ccacheconfig">@Caching和@CacheConfig</a><ul><li><a href="#caching">@Caching</a></li><li><a href="#cacheconfig">@CacheConfig</a></li></ul></li><li><a href="#%E6%95%B4%E5%90%88%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6redis">整合缓存中间件Redis</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89rediscachemanager">自定义RedisCacheManager</a><ul><li><a href="#%E6%89%A9%E5%B1%95cachemanager%E7%9A%84%E7%94%A8%E6%B3%95">扩展CacheManager的用法</a></li></ul></li><li><a href="#springsecurity%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">SpringSecurity的简单使用</a><ul><li><a href="#thymeleaf%E6%95%B4%E5%90%88springsecurity">Thymeleaf整合SpringSecurity</a></li><li><a href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><strong>记住我</strong></a></li><li><a href="#%E5%AE%9A%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2">定制自己的登录页面</a></li></ul></li><li><a href="#shiro%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">Shiro的简单使用</a><ul><li><a href="#%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAshiro">开始配置一个shiro</a></li><li><a href="#%E6%95%B4%E5%90%88shiro%E5%90%AF%E5%8A%A8%E5%99%A8">整合Shiro启动器</a></li><li><a href="#%E6%89%A9%E5%B1%95">扩展：</a><ul><li><a href="#shiro%E9%BB%98%E8%AE%A4%E8%BF%87%E6%BB%A4%E5%99%A8">shiro默认过滤器</a></li><li><a href="#shiro%E5%B8%B8%E7%94%A8%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%B3%A8%E8%A7%A3%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB%E4%B8%8A%E4%BD%BF%E7%94%A8">shiro常用的权限控制注解，可以在控制器类上使用</a></li></ul></li></ul></li></ul></li></ul><h2 id="环境搭建-简化部署" tabindex="-1"><a class="header-anchor" href="#环境搭建-简化部署" aria-hidden="true">#</a> 环境搭建 &amp; 简化部署</h2><h3 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--Spring Boot的版本仲裁中心--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），
只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在默认包下创建一个启动器 标注为SpringBoot程序**@SpringBootApplication**</p><p><strong>注：这个类必须和controller在同一个包下，不然就无法访问controller</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldApplicationContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HelloWorldApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="简化部署" tabindex="-1"><a class="header-anchor" href="#简化部署" aria-hidden="true">#</a> 简化部署</h3><p>Maven下导入这个插件点击package即可打包成功</p><p>java -jar 包名既可以运行</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+l+`" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><p>一些场景启动器：</p><table><thead><tr><th>名称</th><th>描述</th><th>Pom</th></tr></thead><tbody><tr><td><code>spring-boot-starter</code></td><td>核心 starter，包括 auto-configuration 支持，logging 和 YAML</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-activemq</code></td><td>Starter 使用 Apache ActiveMQ 进行 JMS 消息传递</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-amqp</code></td><td>Starter 用于使用 Spring AMQP 和 Rabbit MQ</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-aop</code></td><td>使用 Spring AOP 和 AspectJ 进行 aspect-oriented 编程的 Starter</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-artemis</code></td><td>Starter 使用 Apache Artemis 进行 JMS 消息传递</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-batch</code></td><td>Starter 使用 Spring Batch</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-cache</code></td><td>Starter 用于使用 Spring Framework 的缓存支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-cloud-connectors</code></td><td>Starter 使用 Spring Cloud 连接器简化连接到云平台中的服务，如 Cloud Foundry 和 Heroku</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-cassandra</code></td><td>Starter 用于使用 Cassandra 分布式数据库和 Spring Data Cassandra</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-cassandra-reactive</code></td><td>Starter 用于使用 Cassandra 分布式数据库和 Spring Data Cassandra Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-couchbase</code></td><td>Starter 用于使用 Couchbase document-oriented 数据库和 Spring Data Couchbase</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-couchbase-reactive</code></td><td>Starter 用于使用 Couchbase document-oriented 数据库和 Spring Data Couchbase Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-elasticsearch</code></td><td>Starter 用于使用 Elasticsearch 搜索和分析引擎和 Spring Data Elasticsearch</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-jdbc</code></td><td>Starter 使用 Spring Data JDBC</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-jpa</code></td><td>Starter 使用 Spring Data JPA 和 Hibernate</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-ldap</code></td><td>Starter 使用 Spring Data LDAP</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-mongodb</code></td><td>Starter 用于使用 MongoDB document-oriented 数据库和 Spring Data MongoDB</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-mongodb-reactive</code></td><td>Starter 用于使用 MongoDB document-oriented 数据库和 Spring Data MongoDB Reactive</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-neo4j</code></td><td>Starter 用于使用 Neo4j 图形数据库和 Spring Data Neo4j</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-redis</code></td><td>Starter 使用 Redis key-value data store 与 Spring Data Redis 和 Lettuce client</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-redis-reactive</code></td><td>Starter 用于将 Redis key-value data store 与 Spring Data Redis reactive 和 Lettuce client 一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-rest</code></td><td>Starter 使用 Spring Data REST 在 REST 上公开 Spring Data repositories</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-data-solr</code></td><td>Starter 将 Apache Solr 搜索平台与 Spring Data Solr 一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-freemarker</code></td><td>Starter for building MVC web applications 使用 FreeMarker 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-groovy-templates</code></td><td>Starter for building MVC web applications 使用 Groovy 模板视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-hateoas</code></td><td>Starter for building hypermedia-based RESTful web application with Spring MVC and Spring HATEOAS</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-integration</code></td><td>Starter 使用 Spring Integration</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jdbc</code></td><td>Starter 用于将 JDBC 与 HikariCP 连接池一起使用</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jersey</code></td><td>Starter for building RESTful web applications 使用 JAX-RS 和 Jersey。 spring-boot-starter-web的替代方案</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jooq</code></td><td>Starter 用于使用 jOOQ 访问 SQL 数据库。 spring-boot-starter-data-jpa或spring-boot-starter-jdbc的替代方案</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-json</code></td><td>Starter 用于读写 json</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jta-atomikos</code></td><td>Starter for JTA transactions 使用 Atomikos</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-jta-bitronix</code></td><td>Starter for JTA transactions 使用 Bitronix</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-mail</code></td><td>Starter 用于使用 Java Mail 和 Spring Framework 的电子邮件发送支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-mustache</code></td><td>Starter for building web applications 使用 Mustache 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-oauth2-client</code></td><td>Starter 使用 Spring Security 的 OAuth2/OpenID Connect client features</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-oauth2-resource-server</code></td><td>Starter 用于使用 Spring Security 的 OAuth2 资源服务器 features</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-quartz</code></td><td>Starter 用于使用 Quartz 调度程序</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-security</code></td><td>Starter 使用 Spring Security</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-test</code></td><td>Starter 用于测试 Spring Boot applications with libraries，包括 JUnit，Hamcrest 和 Mockito</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-thymeleaf</code></td><td>Starter for building MVC web applications 使用 Thymeleaf 视图</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-validation</code></td><td>Starter 用于使用 Hibernate Validator 进行 Java Bean 验证</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-web</code></td><td>Starter for building web，包括使用 Spring MVC 的 RESTful，applications。使用 Tomcat 作为默认嵌入式容器</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-web-services</code></td><td>Starter 使用 Spring Web Services</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-webflux</code></td><td>Starter for building WebFlux applications 使用 Spring Framework 的 Reactive Web 支持</td><td>Pom</td></tr><tr><td><code>spring-boot-starter-websocket</code></td><td>Starter for building WebSocket applications 使用 Spring Framework 的 WebSocket 支持</td><td>Pom</td></tr></tbody></table><h2 id="springbootapplication启动原理" tabindex="-1"><a class="header-anchor" href="#springbootapplication启动原理" aria-hidden="true">#</a> @SpringBootApplication启动原理</h2><p><strong>@SpringBootApplication</strong></p><p>Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用</p><p>下面是这个注解的内部：组合注解</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@SpringBootConfiguration：**Spring Boot的配置类；</p><p>​ 标注在某个类上，表示这是一个Spring Boot的配置类；</p><p>这个注解进去后是一个标注了**@Configuration**的类：</p><p>配置类上来标注这个注解；配置类 ----- 配置文件；配置类也是容器中的一个组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@EnableAutoConfiguration：**开启自动配置功能</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**@AutoConfigurationPackage：**自动配置包</p><p>**@Import(AutoConfigurationPackages.Registrar.class)：**Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigurationPackage</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>内部注册SpringBoot启动器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Registrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">DeterminableImports</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PackageImports</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">determineImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackageImports</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过调试可以看出</p><figure><img src="`+u+'" alt="2" tabindex="0" loading="lazy"><figcaption>2</figcaption></figure><p>再次调试这段：<em>register(registry, new PackageImports(metadata).getPackageNames().toArray(new String[0]));</em></p><figure><img src="'+r+`" alt="3" tabindex="0" loading="lazy"><figcaption>3</figcaption></figure><p>可得出结论：将<strong>主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器</strong></p><p>再看**EnableAutoConfiguration的****@Import(AutoConfigurationImportSelector.class)**给容器导入组件，将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">NO_IMPORTS</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察，这个2.0的SpringBoot是跳转到了<strong>getAutoConfigurationEntry</strong>进行了遍历依赖包</p><p>通过单步调试可以看到，这个会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；自动配置类</p><figure><img src="`+k+`" alt="4" tabindex="0" loading="lazy"><figcaption>4</figcaption></figure><p>可以观察到这个查到包的调用方式：getCandidateConfigurations</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">EMPTY_ENTRY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkExcludedClasses</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurations <span class="token operator">=</span> <span class="token function">getConfigurationClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过调用getSpringFactoriesLoaderFactoryClass</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                         <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> <span class="token string">&quot;No auto configuration classes found in META-INF/spring.factories. If you &quot;</span>
                    <span class="token operator">+</span> <span class="token string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法中：loadFactoryNames就是对这个SpringBoot依赖包进行加载（把得到的properties添加到容器中进行加载）</p><figure><img src="`+d+`" alt="5" tabindex="0" loading="lazy"><figcaption>5</figcaption></figure><p>这个<strong>FACTORIES_RESOURCE_LOCATION</strong>静态变量也标识了这些<strong>包的路径位置</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORIES_RESOURCE_LOCATION</span> <span class="token operator">=</span> <span class="token string">&quot;META-INF/spring.factories&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>仔细看，还真是。SpringBoot将这些值作为自动配置类导入到容器中，自动配置类就生效</p><figure><img src="`+v+'" alt="6" tabindex="0" loading="lazy"><figcaption>6</figcaption></figure><p><strong>小结</strong></p><p>将META-INF/spring.factories里面配置的所有通过EnableAutoConfiguration加入到容器中</p><h2 id="idea-快速构建" tabindex="-1"><a class="header-anchor" href="#idea-快速构建" aria-hidden="true">#</a> IDEA 快速构建</h2><figure><img src="'+m+`" alt="7" tabindex="0" loading="lazy"><figcaption>7</figcaption></figure><p>默认生成的Spring Boot项目结果</p><p>resources文件夹中目录结构</p><ul><li><strong>static</strong>：保存所有的静态资源； js css images；</li><li></li><li><strong>templates</strong>：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li><li><strong>application.properties</strong>：Spring Boot应用的配置文件；可以修改一些默认设置；</li></ul><h2 id="yaml" tabindex="-1"><a class="header-anchor" href="#yaml" aria-hidden="true">#</a> YAML</h2><p>XML和YAML区别：</p><p>XML：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;server&gt;
    &lt;port&gt;8080&lt;/port&gt;
&lt;/server&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>YAML:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>server:
  port: 8080
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="yaml基本语法" tabindex="-1"><a class="header-anchor" href="#yaml基本语法" aria-hidden="true">#</a> YAML基本语法</h3><p>写法：Key:(空格)Value</p>`,68),Wn={href:"https://juejin.im/post/5c1a4a0fe51d45344a1c3d2a",target:"_blank",rel:"noopener noreferrer"},Vn=e(`<p>将YAML的配置的属性映射到实体类中**@ConfigurationProperties**对实体类的配置进行绑定</p><p>**prefix：**配置用哪个进行绑定</p><p>在YAML可以配置这样一个案例：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">person</span><span class="token punctuation">:</span>
  <span class="token key atrule">lastName</span><span class="token punctuation">:</span> 张三
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">18</span>
  <span class="token key atrule">isBoss</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">birthday</span><span class="token punctuation">:</span> 2020/2/2
  <span class="token key atrule">map</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">k1</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token key atrule">k2</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">}</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> lisi
    <span class="token punctuation">-</span> zhaoliu
  <span class="token key atrule">dog</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 小狗
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以创建一个实体类进行绑定测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isBoss<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用ConfigurationProperties出现以下错误：</p><figure><img src="`+g+`" alt="8" tabindex="0" loading="lazy"><figcaption>8</figcaption></figure><p>解决方案：导入配置文件处理器</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：这里必须使用**@Component<strong>把它加入到容器中，就像</strong>@Repository**一样才能使用</p><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;张三&#39;<span class="token punctuation">,</span> age=<span class="token number">18</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k1=<span class="token number">12</span><span class="token punctuation">,</span> k2=<span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>lisi<span class="token punctuation">,</span> zhaoliu<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;小狗&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="单元测试" tabindex="-1"><a class="header-anchor" href="#单元测试" aria-hidden="true">#</a> 单元测试</h2><p>注：测试类和主类要包名要统一才能启动</p><figure><img src="`+b+`" alt="9" tabindex="0" loading="lazy"><figcaption>9</figcaption></figure><p><strong>使用SSM和使用SpringBoot的Test功能的对比</strong></p><h3 id="ssm" tabindex="-1"><a class="header-anchor" href="#ssm" aria-hidden="true">#</a> SSM</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//@RunWith 指定用哪种驱动进行单元测试，默认是junit</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:applicationContext.xml&quot;</span><span class="token punctuation">)</span> <span class="token comment">//指定配置文件</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringTest</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookServlet</span> bookServlet<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bookServlet<span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot" aria-hidden="true">#</a> SpringBoot</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot02ApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果要使用RunWith需要进入Maven删除exclusions</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就可以使用Runnwith测试啦：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot02ApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Person</span> person<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configurationproperties-value" tabindex="-1"><a class="header-anchor" href="#configurationproperties-value" aria-hidden="true">#</a> @ConfigurationProperties&amp;@Value</h2><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定（松散语法“-”）</td><td>支持</td><td>不支持</td></tr><tr><td>SpEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table><p><strong>@Value</strong>测试的实体类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token comment">//@ConfigurationProperties(prefix = &quot;person&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;zhiyu&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{2*10}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isBoss<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;zhiyu&#39;<span class="token punctuation">,</span> age=<span class="token number">20</span><span class="token punctuation">,</span> isBoss=<span class="token boolean">true</span><span class="token punctuation">,</span> birthday=<span class="token null keyword">null</span><span class="token punctuation">,</span> map=<span class="token null keyword">null</span><span class="token punctuation">,</span> list=<span class="token null keyword">null</span><span class="token punctuation">,</span> dog=<span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="propertysource-importresource" tabindex="-1"><a class="header-anchor" href="#propertysource-importresource" aria-hidden="true">#</a> @PropertySource&amp;@ImportResource</h2><p><strong>@PropertySource</strong>：加载指定的配置文件</p><p>**注：<strong>加载配置文件时需要配置</strong>@ConfigurationProperties(prefix = &quot;&quot;)**使用</p><p>使用案例：</p><p>YAML文件中只有端口：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在类路径下创建一个配置文件：person.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">person.lastName</span><span class="token punctuation">=</span><span class="token value attr-value">李四</span>
<span class="token key attr-name">person.age</span><span class="token punctuation">=</span><span class="token value attr-value">18</span>
<span class="token key attr-name">person.isBoss</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">person.birthday</span><span class="token punctuation">=</span><span class="token value attr-value">2020/2/2</span>
<span class="token key attr-name">person.map.k1</span><span class="token punctuation">=</span><span class="token value attr-value">12</span>
<span class="token key attr-name">person.map.k2</span><span class="token punctuation">=</span><span class="token value attr-value">13</span>
<span class="token key attr-name">person.list</span><span class="token punctuation">=</span><span class="token value attr-value">a,b</span>
<span class="token key attr-name">person.dog.name</span><span class="token punctuation">=</span><span class="token value attr-value">小狗</span>
<span class="token key attr-name">person.dog.age</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实体类中使用即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:person.properties&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;李四&#39;<span class="token punctuation">,</span> age=<span class="token number">18</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k2=<span class="token number">13</span><span class="token punctuation">,</span> k1=<span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;小狗&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>@ImportResource</strong> 导入自定义的Spring文件</p><p>创建一个配置文件导入一个自定义的bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloService</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个spring配置文件：beans.xml，加入这个类</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.zhiyucs.servcie.HelloService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>helloService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在入口加入这个注解导入这个spring文件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ImportResource</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:beans.xml&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Springboot02Application</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">ApplicationContext</span> ioc<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">containServiceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> b <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span><span class="token string">&quot;helloService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 结果：true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然这是不推荐的，SpringBoot推荐的方式如下：</p><h3 id="【推荐】自己创建个配置类" tabindex="-1"><a class="header-anchor" href="#【推荐】自己创建个配置类" aria-hidden="true">#</a> 【推荐】自己创建个配置类</h3><p>使用**@Configuration**指定这是一个配置类</p><p>使用**@Bean**把这个返回值加入到容器中，ID就是这个方法的方法名。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HelloService</span> <span class="token function">helloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HelloService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置文件的占位符" tabindex="-1"><a class="header-anchor" href="#配置文件的占位符" aria-hidden="true">#</a> 配置文件的占位符</h3><p>在配置文件可以使用\${} 取值random</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">person.lastName</span><span class="token punctuation">=</span><span class="token value attr-value">\${random.uuid}</span>
<span class="token key attr-name">person.age</span><span class="token punctuation">=</span><span class="token value attr-value">\${random.int}</span>
<span class="token key attr-name">person.isBoss</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">person.birthday</span><span class="token punctuation">=</span><span class="token value attr-value">2020/2/2</span>
<span class="token key attr-name">person.map.k1</span><span class="token punctuation">=</span><span class="token value attr-value">12</span>
<span class="token key attr-name">person.map.k2</span><span class="token punctuation">=</span><span class="token value attr-value">13</span>
<span class="token key attr-name">person.list</span><span class="token punctuation">=</span><span class="token value attr-value">a,b</span>
<span class="token key attr-name">person.dog.name</span><span class="token punctuation">=</span><span class="token value attr-value">\${person.last-name}_dog</span>
<span class="token key attr-name">person.dog.age</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>Person<span class="token punctuation">{</span>lastName=&#39;20b50b74<span class="token number">-4721</span>-4d80-a786-f0e726b195f3&#39;<span class="token punctuation">,</span> age=<span class="token number">-790018533</span><span class="token punctuation">,</span> isBoss=<span class="token null keyword">null</span><span class="token punctuation">,</span> birthday=Sun Feb <span class="token number">02</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> CST <span class="token number">2020</span><span class="token punctuation">,</span> map=<span class="token punctuation">{</span>k2=<span class="token number">13</span><span class="token punctuation">,</span> k1=<span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span> list=<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> dog=Dog<span class="token punctuation">{</span>name=&#39;6a1ab7a2-c65c-4df5-be46-3614ef009efd_dog&#39;<span class="token punctuation">,</span> age=<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="多profile支持" tabindex="-1"><a class="header-anchor" href="#多profile支持" aria-hidden="true">#</a> 多Profile支持</h3><p>在编写配置文件的时候，文件名可以是，application-{profile}.yml/properties</p><p>两种激活方式：创建两个环境 -- 开发/生产</p><figure><img src="`+f+`" alt="10" tabindex="0" loading="lazy"><figcaption>10</figcaption></figure><p>application中写激活哪个：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他就写生产/开发环境的配置</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以直接都写在一个配置中</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
    
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> pro
  
<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还可以使用命令行的方式更换环境</p><p>java -jar 包名 --spring.profiles.active=dev/pro</p><p>还可以使用IDEA的虚拟环境激活</p><figure><img src="`+y+'" alt="11" tabindex="0" loading="lazy"><figcaption>11</figcaption></figure><h2 id="加载配置文件的位置和优先级" tabindex="-1"><a class="header-anchor" href="#加载配置文件的位置和优先级" aria-hidden="true">#</a> 加载配置文件的位置和优先级</h2><p>测试<strong>类路径下</strong>（port:8080）和<strong>类路径的config</strong>文件夹下（port:8081）：</p><figure><img src="'+h+'" alt="12" tabindex="0" loading="lazy"><figcaption>12</figcaption></figure><figure><img src="'+w+'" alt="12.1" tabindex="0" loading="lazy"><figcaption>12.1</figcaption></figure><p>前两个同时存在，再把一个端口为8083的文件放在<strong>根目录下</strong>：</p><figure><img src="'+A+'" alt="13" tabindex="0" loading="lazy"><figcaption>13</figcaption></figure><figure><img src="'+S+'" alt="13.1" tabindex="0" loading="lazy"><figcaption>13.1</figcaption></figure><p>前三个同时存在，把这个文件放到<strong>根目录下的config</strong>（端口为8084）：</p><figure><img src="'+C+'" alt="14" tabindex="0" loading="lazy"><figcaption>14</figcaption></figure><figure><img src="'+E+`" alt="14.1" tabindex="0" loading="lazy"><figcaption>14.1</figcaption></figure><p><strong>小结</strong>:优先级由高到低 -file:./config &gt; -file:./ &gt; -classpath:/config/ &gt; -classpath:/ SpringBoot这四个位置的配置文件都会加载 并且会互补配置</p><p><strong>测试：使用最低级的配置文件配置路径</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+x+'" alt="15" tabindex="0" loading="lazy"><figcaption>15</figcaption></figure><figure><img src="'+q+'" alt="16" tabindex="0" loading="lazy"><figcaption>16</figcaption></figure><p><strong>运维配置</strong> 还可以使用命令行： java -jar 包名 --spring.config.location=指定配置文件绝对路径</p><h2 id="自动配置原理" tabindex="-1"><a class="header-anchor" href="#自动配置原理" aria-hidden="true">#</a> 自动配置原理</h2>',92),Un={href:"https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/common-application-properties.html#a-common-application-properties",target:"_blank",rel:"noopener noreferrer"},Jn=e(`<h3 id="自动配置原理-1" tabindex="-1"><a class="header-anchor" href="#自动配置原理-1" aria-hidden="true">#</a> 自动配置原理</h3><p>SpringBoot启动的时候加载主配置类**@SpringBootApplication**，开启了自动配置功能**@EnableAutoConfiguration**</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootAutoconfigApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="wiz://open_document?guid=62a96d1e-af78-4e7c-92d5-9a06b8beedf8&amp;kbguid=&amp;private_kbguid=51ed7a20-5f58-11ea-ac04-65f1a2b61811">@EnableAutoConfiguration的作用</a></p><h3 id="以httpencodingautoconfiguration为例解释自动配置原理" tabindex="-1"><a class="header-anchor" href="#以httpencodingautoconfiguration为例解释自动配置原理" aria-hidden="true">#</a> 以HttpEncodingAutoConfiguration为例解释自动配置原理</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">ConditionalOnWebApplication<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;server.servlet.encoding&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpEncodingAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>@Configuration</strong>：配置类（相当于配置文件）</p><p><strong>@EnableConfigurationProperties</strong>：启用<a href="wiz://open_document?guid=5294ee2c-1921-4f6e-a62d-cd516a7f3bb2&amp;kbguid=&amp;private_kbguid=51ed7a20-5f58-11ea-ac04-65f1a2b61811">ConfigurationProperties</a>（从配置文件中获取值和bean的属性进行绑定）功能（ServerProperties）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;server&quot;</span><span class="token punctuation">,</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerProperties</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Server HTTP port.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相当于把server的属性绑定到这个ServerProperties类中的属性（比如我们熟悉的port）</p><p><strong>@ConditionalOnWebApplication</strong>：根据不同的条件，如果满足指定的条件，整个配置类的配置才会生效</p><p><strong>@ConditionalOnClass</strong>：判断当前项目有无这个类（CharacterEncodingFilter）</p><p><strong>@ConditionalOnProperty</strong>：“判断文件是否存在这个配置</p><p><strong>@Bean</strong>给容器添加组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//和SpringBoot的值映射</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Encoding</span> properties<span class="token punctuation">;</span>
<span class="token comment">//只有一个有参构造器情况，参数从容器中拿</span>
<span class="token keyword">public</span> <span class="token class-name">HttpEncodingAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 给容器添加组件，这个组件从properties获取</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
<span class="token keyword">public</span> <span class="token class-name">CharacterEncodingFilter</span> <span class="token function">characterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CharacterEncodingFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderedCharacterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setForceRequestEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Encoding<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filter<span class="token punctuation">.</span><span class="token function">setForceResponseEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Encoding<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token constant">RESPONSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这一系列下来相当于可以实现</p><p>这个方法在<strong>ServerProperties</strong>中，而自动配置实现了**@EnableConfigurationProperties(ServerProperties.class)**</p><figure><img src="`+j+'" alt="17" tabindex="0" loading="lazy"><figcaption>17</figcaption></figure><p>主配置文件就可以写</p><figure><img src="'+B+'" alt="18" tabindex="0" loading="lazy"><figcaption>18</figcaption></figure><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><p>SpringBoot 启动的时候加载主配置类，开启了自动配置功能 @EnableAutoConfiguration 。</p><p>@EnableAutoConfiguration 给容器导入META-INF/spring.factories 里定义的自动配置类。</p><p>筛选有效的自动配置类。</p><p>每一个自动配置类结合对应的 xxxProperties.java 读取配置文件进行自动配置功能 。</p><ul><li><code>xxxAutoConfiguration</code>：自动配置类给容器中添加组件。</li><li><code>xxxProperties</code>：封装配置文件中相关属性。</li></ul><h2 id="conditional相关注解和debug" tabindex="-1"><a class="header-anchor" href="#conditional相关注解和debug" aria-hidden="true">#</a> @Conditional相关注解和Debug</h2><p>@ConditionalOnBean:仅仅在当前上下文中存在某个对象时，才会实例化一个Bean @ConditionalOnClass:某个class位于类路径上才会实例化一个Bean @ConditionalOnExpression:当表达式为true的时候，才会实例化一个Bean @ConditionalOnMissingBean:仅仅在当前上下文中不存在某个对象时，才会实例化一个Bean @ConditionalOnMissingClass:某个class不位于类路径上才会实例化一个Bean @ConditionalOnNotWebApplication:不是web应用</p><p>开启SpringBoot debug查看使用了哪些配置类</p><figure><img src="'+R+'" alt="19" tabindex="0" loading="lazy"><figcaption>19</figcaption></figure><p>以及没有启动的</p><figure><img src="'+M+'" alt="20" tabindex="0" loading="lazy"><figcaption>20</figcaption></figure><h2 id="日志框架sl4j" tabindex="-1"><a class="header-anchor" href="#日志框架sl4j" aria-hidden="true">#</a> 日志框架SL4J</h2><p>SL4J的几种实现方式：</p><figure><img src="'+P+'" alt="21" tabindex="0" loading="lazy"><figcaption>21</figcaption></figure><h3 id="其他日志框架转换为sl4j" tabindex="-1"><a class="header-anchor" href="#其他日志框架转换为sl4j" aria-hidden="true">#</a> 其他日志框架转换为SL4J</h3><p><strong>SpringBoot（sl4j+lockbcak）</strong></p><p>Spring（commons-logging）</p><p>Hibernate（jboss-logging）</p><p>转换方式如下：</p><figure><img src="'+I+'" alt="22" tabindex="0" loading="lazy"><figcaption>22</figcaption></figure><h3 id="springboot和日志关系" tabindex="-1"><a class="header-anchor" href="#springboot和日志关系" aria-hidden="true">#</a> SpringBoot和日志关系</h3><figure><img src="'+F+'" alt="23" tabindex="0" loading="lazy"><figcaption>23</figcaption></figure><p>SpringBoot使用spring-boot-starter-logging来记录日志</p><figure><img src="'+L+`" alt="24" tabindex="0" loading="lazy"><figcaption>24</figcaption></figure><h3 id="日志的配置" tabindex="-1"><a class="header-anchor" href="#日志的配置" aria-hidden="true">#</a> 日志的配置</h3><p>路径的配置：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># 不指定路径当前项目下生成springboot.log日志</span>
<span class="token comment">#logging.file.name=springboot.log</span>
<span class="token comment"># 在当前磁盘根路径下创建spring文件夹和里面的log文件，使用spring.log作为默认文件</span>
<span class="token key attr-name">logging.file.path</span><span class="token punctuation">=</span><span class="token value attr-value">/springLog/log</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+O+`" alt="25" tabindex="0" loading="lazy"><figcaption>25</figcaption></figure><p>日志输出格式控制：</p><ul><li>日志输出格式：</li><li>%d表示日期时间，</li><li>%thread表示线程名，</li><li>%-5level：级别从左显示5个字符宽度</li><li>%logger{50} 表示logger名字最长50个字符，否则按照句点分割。</li><li>%msg：日志消息，</li><li>%n是换行符</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># 在控制台输出的日志格式
logging.pattern.console=%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n
# 指定文件中日志的输出格式
logging.pattern.file=%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n
输出结果：
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== Starting Springboot04ApplicationTests on DESKTOP-J83JFON with PID 3092 (started by 54271 in C:\\Users\\54271\\Documents\\SpringBoot_Twice\\springboot_04)
2020-07-18 === [main] === DEBUG === cn.zhiyucs.Springboot04ApplicationTests ==== Running with Spring Boot v2.3.1.RELEASE, Spring v5.2.7.RELEASE
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== No active profile set, falling back to default profiles: default
2020-07-18 === [main] === INFO  === o.s.scheduling.concurrent.ThreadPoolTaskExecutor ==== Initializing ExecutorService &#39;applicationTaskExecutor&#39;
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== Started Springboot04ApplicationTests in 1.893 seconds (JVM running for 2.966)
2020-07-18 === [main] === TRACE === cn.zhiyucs.Springboot04ApplicationTests ==== 这是跟踪日志
2020-07-18 === [main] === DEBUG === cn.zhiyucs.Springboot04ApplicationTests ==== 这是调试日志
2020-07-18 === [main] === INFO  === cn.zhiyucs.Springboot04ApplicationTests ==== 这是信息日志
2020-07-18 === [main] === WARN  === cn.zhiyucs.Springboot04ApplicationTests ==== 这是警告日志
2020-07-18 === [main] === ERROR === cn.zhiyucs.Springboot04ApplicationTests ==== 这是错误日志
2020-07-18 === [SpringContextShutdownHook] === INFO  === o.s.scheduling.concurrent.ThreadPoolTaskExecutor ==== Shutting down ExecutorService &#39;applicationTaskExecutor&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="指定日志框架" tabindex="-1"><a class="header-anchor" href="#指定日志框架" aria-hidden="true">#</a> 指定日志框架</h3><p>在类路径下直接指定：logback.xml logback-spring.xml log4j2-spring.xml log4j2.xml</p><figure><img src="`+D+`" alt="26" tabindex="0" loading="lazy"><figcaption>26</figcaption></figure><p>logback.xml：直接被日志框架识别</p><p>logback-spring.xml：可以使用SpringBoot日志的Profile的高级功能</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;
    &lt;springProfile name=&quot;dev&quot;&gt;
        &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} ----&gt; [%thread] ---&gt; %-5level %logger{50} - %msg%n&lt;/pattern&gt;
    &lt;/springProfile&gt;
    &lt;springProfile name=&quot;!dev&quot;&gt;
        &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n&lt;/pattern&gt;
    &lt;/springProfile&gt;
&lt;/layout&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="切换日志框架" tabindex="-1"><a class="header-anchor" href="#切换日志框架" aria-hidden="true">#</a> 切换日志框架</h3><p>直接在Maven的exclude即可</p><h2 id="静态资源映射规则" tabindex="-1"><a class="header-anchor" href="#静态资源映射规则" aria-hidden="true">#</a> 静态资源映射规则</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Default resource handling disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Duration</span> cachePeriod <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CacheControl</span> cacheControl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCachecontrol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHttpCacheControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span><span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/resources/webjars/&quot;</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> staticPathPattern <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">hasMappingForPattern</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customizeResourceHandlerRegistration</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>staticPathPattern<span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token function">getResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                             <span class="token punctuation">.</span><span class="token function">setCachePeriod</span><span class="token punctuation">(</span><span class="token function">getSeconds</span><span class="token punctuation">(</span>cachePeriod<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheControl</span><span class="token punctuation">(</span>cacheControl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>WebJar+Maven方式加载静态资源</li></ol><p><strong>registry.hasMappingForPattern(&quot;/webjars/**)</strong></p>`,65),Xn={href:"https://www.webjars.org/",target:"_blank",rel:"noopener noreferrer"},Gn=e(`<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.webjars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jquery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+T+'" alt="27" tabindex="0" loading="lazy"><figcaption>27</figcaption></figure>',2),Yn={href:"http://localhost:8080/webjars/jquery/3.5.1/jquery.js",target:"_blank",rel:"noopener noreferrer"},Kn=e('<figure><img src="'+N+`" alt="28" tabindex="0" loading="lazy"><figcaption>28</figcaption></figure><ol start="2"><li>可以设置静态资源的有关参数：（ResourceProperties.class）</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.resources&quot;</span><span class="token punctuation">,</span> ignoreUnknownFields <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">CLASSPATH_RESOURCE_LOCATIONS</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;classpath:/META-INF/resources/&quot;</span><span class="token punctuation">,</span>
                                                                  <span class="token string">&quot;classpath:/resources/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/static/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;classpath:/public/&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>访问当前项目的任何资源</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;/&quot;,
&quot;classpath:/META-INF/resources/&quot;,
&quot;classpath:/resources/&quot;, 
&quot;classpath:/static/&quot;, 
&quot;classpath:/public/&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如添加一个资源包：</p><figure><img src="`+z+'" alt="29" tabindex="0" loading="lazy"><figcaption>29</figcaption></figure>',7),Qn={href:"http://localhost:8080/asserts/js/Chart.min.js",target:"_blank",rel:"noopener noreferrer"},Zn=e(`<ol start="4"><li>欢迎页的加载方式：也在WebMvcAutoConfiguration这个类中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WelcomePageHandlerMapping</span> <span class="token function">welcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span>
                                                           <span class="token class-name">FormattingConversionService</span> mvcConversionService<span class="token punctuation">,</span> <span class="token class-name">ResourceUrlProvider</span> mvcResourceUrlProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">WelcomePageHandlerMapping</span> welcomePageHandlerMapping <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">TemplateAvailabilityProviders</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">,</span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setInterceptors</span><span class="token punctuation">(</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>mvcConversionService<span class="token punctuation">,</span> mvcResourceUrlProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    welcomePageHandlerMapping<span class="token punctuation">.</span><span class="token function">setCorsConfigurations</span><span class="token punctuation">(</span><span class="token function">getCorsConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> welcomePageHandlerMapping<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过查看getWelcomePage方法就可以看出是<strong>加载静态资源的index.html</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> <span class="token function">getWelcomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> locations <span class="token operator">=</span> <span class="token function">getResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>locations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">getIndexHtml</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">isReadable</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">Resource</span> <span class="token function">getIndexHtml</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location <span class="token operator">+</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模板引擎thymeleaf" tabindex="-1"><a class="header-anchor" href="#模板引擎thymeleaf" aria-hidden="true">#</a> 模板引擎Thymeleaf</h2><p>整合SpringBoot</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thymeleaf的默认配置</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.thymeleaf&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThymeleafProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Charset</span> <span class="token constant">DEFAULT_ENCODING</span> <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;classpath:/templates/&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_SUFFIX</span> <span class="token operator">=</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注：**Controller中的@RequestMapping(&quot;/su&quot;)不能和return&quot;xx&quot;重复</p><figure><img src="`+H+'" alt="30" tabindex="0" loading="lazy"><figcaption>30</figcaption></figure><h2 id="springmvc自动配置原理" tabindex="-1"><a class="header-anchor" href="#springmvc自动配置原理" aria-hidden="true">#</a> SpringMVC自动配置原理</h2>',12),_n={href:"https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/boot-features-developing-web-applications.html#developing-web-applications",target:"_blank",rel:"noopener noreferrer"},$n=e(`<h3 id="默认配置" tabindex="-1"><a class="header-anchor" href="#默认配置" aria-hidden="true">#</a> 默认配置</h3><p>auto-configuration 在 Spring 的默认值之上添加以下 features：</p><ul><li><p>包含<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code> beans（视图解析器，根据返回值视图对象（View），然后可以进行渲染（转发/重定向））。</p></li><li><p>支持提供静态资源，包括对 WebJars 的支持</p></li><li><p>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code> beans</p></li><li><ul><li>转换器 HttpMessageConverters</li><li>格式化器</li></ul></li><li><p>支持<code>HttpMessageConverters 转换 HTTP 请求和响应</code></p></li><li><p>自动注册<code>MessageCodesResolver 定义错误代码的生成规则</code></p></li><li><p>静态<code>index.html</code>支持。</p></li><li><p>自定义<code>Favicon</code>支持</p></li></ul><h3 id="contentnegotiatingviewresolver" tabindex="-1"><a class="header-anchor" href="#contentnegotiatingviewresolver" aria-hidden="true">#</a> ContentNegotiatingViewResolver</h3><p>首先是<strong>ContentNegotiatingViewResolver</strong>：组合所有的视图解析器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token class-name">ViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;viewResolver&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token class-name">ContentNegotiatingViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ContentNegotiatingViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ContentNegotiatingViewResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentNegotiatingViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resolver<span class="token punctuation">.</span><span class="token function">setContentNegotiationManager</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">ContentNegotiationManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ContentNegotiatingViewResolver uses all the other view resolvers to locate</span>
    <span class="token comment">// a view so it should have a high precedence</span>
    resolver<span class="token punctuation">.</span><span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ContentNegotiatingViewResolver中通过resolveViewName解析视图</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">RequestAttributes</span> attrs <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>attrs <span class="token keyword">instanceof</span> <span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">,</span> <span class="token string">&quot;No current ServletRequestAttributes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> requestedMediaTypes <span class="token operator">=</span> <span class="token function">getMediaTypes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> attrs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestedMediaTypes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> candidateViews <span class="token operator">=</span> <span class="token function">getCandidateViews</span><span class="token punctuation">(</span>viewName<span class="token punctuation">,</span> locale<span class="token punctuation">,</span> requestedMediaTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">View</span> bestView <span class="token operator">=</span> <span class="token function">getBestView</span><span class="token punctuation">(</span>candidateViews<span class="token punctuation">,</span> requestedMediaTypes<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bestView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> bestView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过getCandidateViews进行遍历每个解析</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateViews</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MediaType</span><span class="token punctuation">&gt;</span></span> requestedMediaTypes<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> candidateViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>viewResolvers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>contentNegotiationManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;No ContentNegotiationManager set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ViewResolver</span> viewResolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewResolvers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">View</span> view <span class="token operator">=</span> viewResolver<span class="token punctuation">.</span><span class="token function">resolveViewName</span><span class="token punctuation">(</span>viewName<span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                candidateViews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MediaType</span> requestedMediaType <span class="token operator">:</span> requestedMediaTypes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> extensions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contentNegotiationManager<span class="token punctuation">.</span><span class="token function">resolveFileExtensions</span><span class="token punctuation">(</span>requestedMediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> extension <span class="token operator">:</span> extensions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> viewNameWithExtension <span class="token operator">=</span> viewName <span class="token operator">+</span> <span class="token char">&#39;.&#39;</span> <span class="token operator">+</span> extension<span class="token punctuation">;</span>
                    view <span class="token operator">=</span> viewResolver<span class="token punctuation">.</span><span class="token function">resolveViewName</span><span class="token punctuation">(</span>viewNameWithExtension<span class="token punctuation">,</span> locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        candidateViews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后组合起来<strong>ContentNegotiatingViewResolver</strong>通过initServletContext的beansOfTypeIncludingAncestors</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initServletContext</span><span class="token punctuation">(</span><span class="token class-name">ServletContext</span> servletContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ViewResolver</span><span class="token punctuation">&gt;</span></span> matchingBeans <span class="token operator">=</span>
        <span class="token class-name">BeanFactoryUtils</span><span class="token punctuation">.</span><span class="token function">beansOfTypeIncludingAncestors</span><span class="token punctuation">(</span><span class="token function">obtainApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ViewResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试并调试：在主类创建一个视图解析器进行测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootCrudApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootCrudApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">myViewResovler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ViewResolver</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">resolveViewName</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在doDispatch进行调试：即可看见</p><figure><img src="`+W+`" alt="31" tabindex="0" loading="lazy"><figcaption>31</figcaption></figure><h3 id="httpmessageconverters" tabindex="-1"><a class="header-anchor" href="#httpmessageconverters" aria-hidden="true">#</a> HttpMessageConverters</h3><p>Spring MVC 使用<code>HttpMessageConverter</code>接口转换 HTTP 请求和响应。</p><p>这个组件是从容器中确定的（WebMvcAutoConfiguration.class）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public WebMvcAutoConfigurationAdapter(ResourceProperties resourceProperties, WebMvcProperties mvcProperties,
                                      ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,
                                      ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,
                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath) {
    this.resourceProperties = resourceProperties;
    this.mvcProperties = mvcProperties;
    this.beanFactory = beanFactory;
    this.messageConvertersProvider = messageConvertersProvider;
    this.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();
    this.dispatcherServletPath = dispatcherServletPath;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从构造函数就可以看出这个类是获取了所有的HttpMessageConverter</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>public HttpMessageConverters(HttpMessageConverter&lt;?&gt;... additionalConverters) {
    this(Arrays.asList(additionalConverters));
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可知只要自定义Converter就可以像上面视图解析器一样放容器即可</p><h3 id="messagecodesresolver" tabindex="-1"><a class="header-anchor" href="#messagecodesresolver" aria-hidden="true">#</a> MessageCodesResolver</h3><p>这个是用于定义错误代码的生成规则的，如（WebMvcAutoConfiguration.class）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">MessageCodesResolver</span> <span class="token function">getMessageCodesResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getMessageCodesResolverFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMessageCodesResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMessageCodesResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resolver<span class="token punctuation">.</span><span class="token function">setMessageCodeFormatter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getMessageCodesResolverFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过查看getMessageCodesResolverFormat（）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * Formatting strategy for message codes. For instance, \`PREFIX_ERROR_CODE\`.
     */</span>
<span class="token keyword">private</span> <span class="token class-name">DefaultMessageCodesResolver<span class="token punctuation">.</span>Format</span> messageCodesResolverFormat<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察注释可以看到错误代码的定义：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Format</span> <span class="token keyword">implements</span> <span class="token class-name">MessageCodeFormatter</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
         * Prefix the error code at the beginning of the generated message code. e.g.:
         * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">errorCode <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> object name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> field</span></span><span class="token punctuation">}</span>
         */</span>
    <span class="token constant">PREFIX_ERROR_CODE</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">String</span> errorCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">toDelimitedString</span><span class="token punctuation">(</span>errorCode<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
         * Postfix the error code at the end of the generated message code. e.g.:
         * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">object name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> field <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> errorCode</span></span><span class="token punctuation">}</span>
         */</span>
    <span class="token constant">POSTFIX_ERROR_CODE</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">String</span> errorCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">toDelimitedString</span><span class="token punctuation">(</span>objectName<span class="token punctuation">,</span> field<span class="token punctuation">,</span> errorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="springboot在springmvc的配置模式" tabindex="-1"><a class="header-anchor" href="#springboot在springmvc的配置模式" aria-hidden="true">#</a> SpringBoot在SpringMVC的配置模式</h3><p>以HiddenHttpMethodFilter为例：Spring在自动配置很多组件的时候，先看容器是否么有自己配置的（@Bean @Component）如果有就用用户配置的（如hiddenHttpMethodFilter），如果没有才自动配置，如果可以有多个（ViewResolver）将用户配置和自己默认组合一起</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">HiddenHttpMethodFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.mvc.hiddenmethod.filter&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span> <span class="token function">hiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OrderedHiddenHttpMethodFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="接管springboot的springmvc" tabindex="-1"><a class="header-anchor" href="#接管springboot的springmvc" aria-hidden="true">#</a> 接管SpringBoot的SpringMVC</h3><p>使用WebMvcConfigurer的接口可以扩展SpringMVC</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+V+`" alt="32" tabindex="0" loading="lazy"><figcaption>32</figcaption></figure><p>比如使用SpringMVC的Controller：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析这个WebMvcAutoConfigurationAdapter（WebMvcAutoConfiguration.class）,查看这个Import(EnableWebMvcConfiguration.class)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EnableWebMvcConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">DelegatingWebMvcConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">ResourceLoaderAware</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在它的父类DelegatingWebMvcConfiguration中，setConfigurers通过addWebMvcConfigurers从容器中获取所有的WebMvcConfigure</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigurers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">&gt;</span></span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">addWebMvcConfigurers</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然，下面也有很多方法：</p><figure><img src="`+U+`" alt="33" tabindex="0" loading="lazy"><figcaption>33</figcaption></figure><p>以addViewControllers为例:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurer</span> delegate <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        delegate<span class="token punctuation">.</span><span class="token function">addViewControllers</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小结-1" tabindex="-1"><a class="header-anchor" href="#小结-1" aria-hidden="true">#</a> 小结：</h3><ol><li><p>实现了WebMvcConfigurer接口，SpringBoot就会将这个一起实现，如刚刚MyMvcConfig</p></li><li><p>DelegatingWebMvcConfiguration（也就是是实现了WebMvcConfigurer），SpringBoot会扫描整个能使用的Configurer到SpringMVC，然后就能使用SpringMVC的功能啦（setConfigurers -- addWebMvcConfigurers）</p></li></ol><p>【不推荐】<em>全面接管SpringMVC</em>：自己配SpringMVC@EnableWebMvc</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个的核心就是 -- DelegatingWebMvcConfiguration</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">DelegatingWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableWebMvc</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也是组合自己写的Configurer</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigurers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">&gt;</span></span> configurers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configurers<span class="token punctuation">.</span><span class="token function">addWebMvcConfigurers</span><span class="token punctuation">(</span>configurers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【重点小结】在<strong>DelegatingWebMvcConfiguration</strong>中与<strong>WebMvcAutoConfiguration</strong>（<strong>@ConditionalOnMissingBean</strong>）比较可知：容器中没有这个组件的时候，这个自动配置类才生效，如果我们使用**@EnableWebMvc**，这个自动配置类就不会生效。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelegatingWebMvcConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">DispatcherServletAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TaskExecutionAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                     <span class="token class-name">ValidationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="国际化" tabindex="-1"><a class="header-anchor" href="#国际化" aria-hidden="true">#</a> 国际化</h2><p>创建国际化文件 中文：xxx_zh_CN.properties English：xxx_en_US.properties</p><figure><img src="`+J+'" alt="34" tabindex="0" loading="lazy"><figcaption>34</figcaption></figure><p>IDEA快速创建国际化文件：</p><figure><img src="'+X+'" alt="35" tabindex="0" loading="lazy"><figcaption>35</figcaption></figure><p>可以切换视图快速开发国际化</p><figure><img src="'+G+'" alt="36" tabindex="0" loading="lazy"><figcaption>36</figcaption></figure><p>然后就可以多个文件开发：</p><figure><img src="'+Y+`" alt="37" tabindex="0" loading="lazy"><figcaption>37</figcaption></figure><p>SpringBoot使用MessageSourceAutoConfiguration自动配置了管理国际化的组件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_SOURCE_BEAN_NAME</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">ResourceBundleCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageSourceAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">MessageSource</span> <span class="token function">messageSource</span><span class="token punctuation">(</span><span class="token class-name">MessageSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceBundleMessageSource</span> messageSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBundleMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置国际化资源及出门（去掉语言国家代码）</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setBasenames</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span>
                                   <span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">trimAllWhitespace</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setFallbackToSystemLocale</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isFallbackToSystemLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Duration</span> cacheDuration <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getCacheDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheDuration <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        messageSource<span class="token punctuation">.</span><span class="token function">setCacheMillis</span><span class="token punctuation">(</span>cacheDuration<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setAlwaysUseMessageFormat</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isAlwaysUseMessageFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    messageSource<span class="token punctuation">.</span><span class="token function">setUseCodeAsDefaultMessage</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">isUseCodeAsDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> messageSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由此可以配置主配置文件</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.messages.basename</span><span class="token punctuation">=</span><span class="token value attr-value">i18n/login</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="使用thymeleaf国际化" tabindex="-1"><a class="header-anchor" href="#使用thymeleaf国际化" aria-hidden="true">#</a> 使用thymeleaf国际化</h3><figure><img src="`+K+`" alt="38" tabindex="0" loading="lazy"><figcaption>38</figcaption></figure><h3 id="springboot区域信息解析器" tabindex="-1"><a class="header-anchor" href="#springboot区域信息解析器" aria-hidden="true">#</a> SpringBoot区域信息解析器</h3><p>在WebMvcAutoConfiguration中解析区域信息localeResolver</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.mvc&quot;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;locale&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">LocaleResolver</span> <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WebMvcProperties<span class="token punctuation">.</span>LocaleResolver</span><span class="token punctuation">.</span><span class="token constant">FIXED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FixedLocaleResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">AcceptHeaderLocaleResolver</span> localeResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AcceptHeaderLocaleResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localeResolver<span class="token punctuation">.</span><span class="token function">setDefaultLocale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> localeResolver<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取区域信息的方式：通过AcceptHeaderLocaleResolver，根据请求头的Accept-Language：zh_CN/ en_US获取</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Locale</span> <span class="token function">resolveLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Locale</span> defaultLocale <span class="token operator">=</span> <span class="token function">getDefaultLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultLocale <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> defaultLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Locale</span> requestLocale <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Locale</span><span class="token punctuation">&gt;</span></span> supportedLocales <span class="token operator">=</span> <span class="token function">getSupportedLocales</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>supportedLocales<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> supportedLocales<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>requestLocale<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> requestLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Locale</span> supportedLocale <span class="token operator">=</span> <span class="token function">findSupportedLocale</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> supportedLocales<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>supportedLocale <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> supportedLocale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>defaultLocale <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> defaultLocale <span class="token operator">:</span> requestLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义国际化" tabindex="-1"><a class="header-anchor" href="#自定义国际化" aria-hidden="true">#</a> 自定义国际化</h3><p>前端设置：thymeleaf的(xxx)表示?xxx</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/index(l=&#39;zh_CN&#39;)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>中文<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/index(l=&#39;en_US&#39;)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>English<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义创建一个判别前端传入的参数：要实现LocaleResolver接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLocale</span> <span class="token keyword">implements</span> <span class="token class-name">LocaleResolver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Locale</span> <span class="token function">resolveLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> l <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Locale</span> locale <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            locale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> locale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在自定义的MVC中实现这个国际化：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocaleResolver</span> <span class="token function">localeResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="拦截器" tabindex="-1"><a class="header-anchor" href="#拦截器" aria-hidden="true">#</a> 拦截器</h2><p>以拦截登录为例</p><p>首先把登录名放入到session中：session.setAttribute</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span>
                    <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span><span class="token function">contentEquals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/main&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注册一个拦截器：<strong>HandlerInterceptor</strong></p><p>并且判断，如果用户名为空就不放行，转发到登录页面，并放入没有权限的信息，如果成功就放行</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginHandlerInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> username <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;没有权限请先登录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在SpringMVC中注册这个拦截器，并<strong>拦截响应的访问地址</strong>：</p><p>这里拦截了所有的地址：除了/index / /user/login这三个地址</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoginHandlerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了防止SpringBoot拦截静态资源可以加入<strong>addResourceHandlers</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/static/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="错误处理原理" tabindex="-1"><a class="header-anchor" href="#错误处理原理" aria-hidden="true">#</a> 错误处理原理</h2><p>如果访问了没有的路径网页会：</p><figure><img src="`+Q+`" alt="39" tabindex="0" loading="lazy"><figcaption>39</figcaption></figure><p>其他客户端会发送json数据：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2020-07-18T17:08:27.106+00:00&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
    <span class="token string">&quot;error&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Not Found&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;No message available&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/aaa&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误处理的自动配置：ErrorMvcAutoConfiguration</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Load before the main WebMvcAutoConfiguration so that the error View is available</span>
<span class="token annotation punctuation">@AutoConfigureBefore</span><span class="token punctuation">(</span><span class="token class-name">WebMvcAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorMvcAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个类给容器添加了以下组件：</p><ul><li>DefaultErrorAttributes</li><li>BasicErrorController</li><li>ErrorPageCustomizer</li><li>DefaultErrorViewResolver</li></ul><p>首先看<strong>ErrorPageCustomizer</strong>：看registerErrorPages -- getRelativePath</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ErrorPageCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorPageRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerErrorPages</span><span class="token punctuation">(</span><span class="token class-name">ErrorPageRegistry</span> errorPageRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ErrorPage</span> errorPage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcherServletPath<span class="token punctuation">.</span><span class="token function">getRelativePath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorPageRegistry<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span>errorPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个getPath的跳转位置：可知 -- 系统出现错误，来到error请求进行处理</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${error.path:/error}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/error&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>BasicErrorController</strong>：处理默认/error请求</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;\${server.error.path:\${error.path:/error}}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicErrorController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorController</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>下面有两种处理方式：（这里就可以解释开头的现象），通过RequestHeader - <strong>accept判断</strong></p><p>产生HTML类型的数据</p><figure><img src="`+Z+`" alt="40" tabindex="0" loading="lazy"><figcaption>40</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_HTML_VALUE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">errorHtml</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model <span class="token operator">=</span> <span class="token class-name">Collections</span>
        <span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span><span class="token function">getErrorAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token function">getErrorAttributeOptions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_HTML</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 去哪个页面作为错误页面，包含页面地址和页面内容</span>
    <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> status<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> modelAndView <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>产生JSON数据</p><figure><img src="`+_+`" alt="41" tabindex="0" loading="lazy"><figcaption>41</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">NO_CONTENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token function">getErrorAttributeOptions</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>响应错误页面的解析代码：errorHtml -- resolveErrorView(request, response, status, model);</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span>
                                        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorViewResolver</span> resolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>errorViewResolvers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolveErrorView</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> status<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后看DefaultErrorViewResolver，它首先声明了<em>SERIES_VIEWS</em>，用于判断状态码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Series</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">SERIES_VIEWS</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Series</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> views <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    views<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token constant">CLIENT_ERROR</span><span class="token punctuation">,</span> <span class="token string">&quot;4xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    views<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Series</span><span class="token punctuation">.</span><span class="token constant">SERVER_ERROR</span><span class="token punctuation">,</span> <span class="token string">&quot;5xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">SERIES_VIEWS</span> <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span>views<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注释解释两个方法：SpringBoot是如何找错误页面的</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>modelAndView <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">SERIES_VIEWS</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modelAndView <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">SERIES_VIEWS</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> viewName<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认Springboot可以找到一个页面 error/404</span>
    <span class="token class-name">String</span> errorViewName <span class="token operator">=</span> <span class="token string">&quot;error/&quot;</span> <span class="token operator">+</span> viewName<span class="token punctuation">;</span>
    <span class="token comment">// 模板引擎可以解析这个页面地址就用模板引擎解析</span>
    <span class="token class-name">TemplateAvailabilityProvider</span> provider <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>templateAvailabilityProviders<span class="token punctuation">.</span><span class="token function">getProvider</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span>
                                                                                           <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>provider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模板引擎可用的情况下返回errorviewname指定的地址</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 模板引擎不可用时，就在静态资源文件下找errorViewName页面 /error/404.html</span>
    <span class="token keyword">return</span> <span class="token function">resolveResource</span><span class="token punctuation">(</span>errorViewName<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定制错误页面和json错误数据" tabindex="-1"><a class="header-anchor" href="#定制错误页面和json错误数据" aria-hidden="true">#</a> 定制错误页面和JSON错误数据</h2><p>定制错误页面 直接把文件放到error文件夹下，名字为4xx，5xx即可</p><figure><img src="`+$+'" alt="42" tabindex="0" loading="lazy"><figcaption>42</figcaption></figure><p>当发生错误页面的时候可以获取错误页面的信息（有模板引擎情况下）： timestamp 时间戳 status 状态码 error 错误信息 exception 异常对象 message 异常消息 errors JSR303 数据校验的错误</p><figure><img src="'+nn+`" alt="43" tabindex="0" loading="lazy"><figcaption>43</figcaption></figure><h3 id="定制一个json数据" tabindex="-1"><a class="header-anchor" href="#定制一个json数据" aria-hidden="true">#</a> 定制一个JSON数据</h3><p>这个错误处理属于Controller：</p><ul><li><p><strong>@ControllerAdvice</strong> 是一个特殊的@Component，用于标识一个类，这个类中被以下三种注解标识的方法：@ExceptionHandler，@InitBinder，@ModelAttribute，将作用于所有的@Controller类的接口上</p></li><li><p>@ResponseBody</p></li><li><p><strong>@ExceptionHandler</strong> (错误类.class) 统一异常处理，也可以指定要处理的异常类型</p></li></ul><p>第一种写法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种：注意使用request定制状态码setAttribute(&quot;javax.servlet.error.status_code&quot;, 500);</p><p>设置以后SpringBoot自适应就会进入错误页面：（resource/error/500）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 传入错误状态码</span>
    req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;forward:/error&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**【推荐】**第三种：响应是自适应的，通过ErrorAttributes改变需要返回的内容</p><p>首先定制一个错误控制：定义状态码、错误信息等</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">UserNotException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 传入错误状态码</span>
        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user.notexist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//        map.put(&quot;message&quot;, e.getMessage());</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户不存在啦!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ext&quot;</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;forward:/error&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后创建一个错误数据传输中间，这个类的功能就是把自定义的错误页面的数据传给SpringBoot，然后响应到自适应页面：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorAttributes</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultErrorAttributes</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getErrorAttributes</span><span class="token punctuation">(</span><span class="token class-name">WebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">ErrorAttributeOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>webRequest<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ext&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至于第二个参数scope是怎么定义的：</p><p>0 - request</p><p>1 - session</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestAttributes</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Constant that indicates request scope.
     */</span>
    <span class="token keyword">int</span> <span class="token constant">SCOPE_REQUEST</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * Constant that indicates session scope.
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This preferably refers to a locally isolated session, if such
     * a distinction is available.
     * Else, it simply refers to the common session.
     */</span>
    <span class="token keyword">int</span> <span class="token constant">SCOPE_SESSION</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+sn+`" alt="44" tabindex="0" loading="lazy"><figcaption>44</figcaption></figure><h2 id="嵌入式servlet" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet" aria-hidden="true">#</a> 嵌入式Servlet</h2><h3 id="spring两种配置方式" tabindex="-1"><a class="header-anchor" href="#spring两种配置方式" aria-hidden="true">#</a> Spring两种配置方式：</h3><ul><li>xxxConfigurer扩展配置</li><li>xxxCustomizer定制配置</li></ul><h3 id="嵌入式servlet两种修改相关配置" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet两种修改相关配置" aria-hidden="true">#</a> 嵌入式Servlet两种修改相关配置</h3><ol><li>配置文件</li></ol><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8083</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>在嵌入式Servlet中修改：在自定义的SpringMVC配置</li></ol><p>注：SpringBoot2 使用的是<strong>WebServerFactoryCustomizer</strong><code>&lt;ConfigurableWebServerFactory&gt;</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token function">webServerFactoryCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableWebServerFactory</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            嵌入式servlet容器相关的配置</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableWebServerFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8083</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册三大组件" tabindex="-1"><a class="header-anchor" href="#注册三大组件" aria-hidden="true">#</a> 注册三大组件</h3><ul><li>Filter</li><li>Servlet</li><li>Linstener</li></ul><h4 id="定制servlet" tabindex="-1"><a class="header-anchor" href="#定制servlet" aria-hidden="true">#</a> 定制Servlet</h4><hr><p>创建一个Servlet，继承<strong>HttpServlet</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello MyServlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个自己的配置类，把这个Servlet加入到容器中（<strong>ServletRegistrationBean</strong>、@Bean）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">myServelet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRegistrationBean</span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/myservlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="定制filter" tabindex="-1"><a class="header-anchor" href="#定制filter" aria-hidden="true">#</a> 定制Filter</h4><hr><p>先创建一个自己的Filter，继承<strong>HttpFilter</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFilter</span> <span class="token keyword">extends</span> <span class="token class-name">HttpFilter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyFilter process....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样是在配置类内注册，<strong>FilterRegistrationBean</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FilterRegistrationBean</span> filterRegistrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterRegistrationBean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterRegistrationBean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filterRegistrationBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="定制listener" tabindex="-1"><a class="header-anchor" href="#定制listener" aria-hidden="true">#</a> 定制Listener</h4><hr><p>注册一个监听器，实现接口<strong>ServletContextListener</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyListener</span> <span class="token keyword">implements</span> <span class="token class-name">ServletContextListener</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextInitialized</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;web应用启动!!!!!!!!!!!!!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextDestroyed</span><span class="token punctuation">(</span><span class="token class-name">ServletContextEvent</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;web销毁!!!!!!!!!!!!!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把监听器注册到配置类中，并放入容器<strong>ServletListenerRegistrationBean</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServerConfig</span> <span class="token punctuation">{</span>
<span class="token comment">//    注册三大组件</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletListenerRegistrationBean</span> <span class="token function">myListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyListener</span><span class="token punctuation">&gt;</span></span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletListenerRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> listener<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用其他的嵌入式容器</p><ul><li>Jetty（长连接）</li><li>Undertow（不支持JSP）</li><li>Tomcat（默认）</li></ul><figure><img src="`+an+'" alt="45" tabindex="0" loading="lazy"><figcaption>45</figcaption></figure><p>切换容器的方式：</p><figure><img src="'+tn+`" alt="46" tabindex="0" loading="lazy"><figcaption>46</figcaption></figure><h2 id="源码刨析-嵌入式servlet原理" tabindex="-1"><a class="header-anchor" href="#源码刨析-嵌入式servlet原理" aria-hidden="true">#</a> 源码刨析 嵌入式Servlet原理</h2><p>WebServerFactoryCustomizer嵌入式Servlet的自动配置类：<strong>ServletWebServerFactoryAutoConfiguration</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">HIGHEST_PRECEDENCE</span><span class="token punctuation">)</span>
<span class="token comment">// 仅在类 ServletRequest 存在于 classpath 上时才生效</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// 仅在当前应用是 Servlet Web 应用时才生效</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token constant">SERVLET</span><span class="token punctuation">)</span>
<span class="token comment">// 确保前缀为 server 的配置参数加载到 bean ServerProperties</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 导入 ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar 以注册</span>
<span class="token comment">// BeanPostProcessor : WebServerFactoryCustomizerBeanPostProcessor 和 </span>
<span class="token comment">// ErrorPageRegistrarBeanPostProcessor</span>
<span class="token comment">// 2. 导入 EmbeddedTomcat/EmbeddedJetty/EmbeddedUndertow 这三个属于</span>
<span class="token comment">// ServletWebServerFactoryConfiguration 的嵌套配置类，这三个配置类会分别检测</span>
<span class="token comment">// classpath上存在的类，从而判断当前应用使用的是 Tomcat/Jetty/Undertow,</span>
<span class="token comment">// 从而决定定义哪一个 Servlet Web服务器的工厂 bean :</span>
<span class="token comment">// TomcatServletWebServerFactory/JettyServletWebServerFactory/UndertowServletWebServerFactory</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedTomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedJetty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedUndertow</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>针对当前Servlet容器是Tomcat时定义该 bean，用于定制化 TomcatServletWebServerFactory</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token comment">// 仅在类 org.apache.catalina.startup.Tomcat 存在于 classpath 上时才生效</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;org.apache.catalina.startup.Tomcat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">TomcatServletWebServerFactoryCustomizer</span> <span class="token function">tomcatServletWebServerFactoryCustomizer</span><span class="token punctuation">(</span>
    <span class="token class-name">ServerProperties</span> serverProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactoryCustomizer</span><span class="token punctuation">(</span>serverProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ServletWebServerFactoryConfiguration是一个针对ServletWebServerFactory进行配置的配置类。它通过检测应用classpath存在的类，从而判断当前应用要使用哪个Servlet容器:Tomcat,Jetty还是Undertow。检测出来之后，定义相应的Servlet Web服务器工厂组件bean</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ServletWebServerFactoryConfiguration</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Tomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UpgradeProtocol</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedTomcat</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>   
        
        <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Server</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Loader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebAppContext</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedJetty</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
        
        <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Undertow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SslClientAuthMode</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ServletWebServerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> search <span class="token operator">=</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">CURRENT</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedUndertow</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三个实现类都继承自抽象基类AbstractServletWebServerFactory：</p><figure><img src="`+en+`" alt="47" tabindex="0" loading="lazy"><figcaption>47</figcaption></figure><h4 id="以tomcat为例" tabindex="-1"><a class="header-anchor" href="#以tomcat为例" aria-hidden="true">#</a> 以Tomcat为例</h4><p>进入TomcatServletWebServerFactory，可以看到这个方法，配置Tomcat基本环境，返回一个嵌入式Servlet容器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">WebServer</span> <span class="token function">getWebServer</span><span class="token punctuation">(</span><span class="token class-name">ServletContextInitializer</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> initializers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>disableMBeanRegistry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Registry</span><span class="token punctuation">.</span><span class="token function">disableRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Tomcat</span> tomcat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tomcat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> baseDir <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseDirectory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseDirectory <span class="token operator">:</span> <span class="token function">createTempDir</span><span class="token punctuation">(</span><span class="token string">&quot;tomcat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setBaseDir</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Connector</span> connector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connector<span class="token punctuation">.</span><span class="token function">setThrowOnFailure</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">customizeConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoDeploy</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">configureEngine</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Connector</span> additionalConnector <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>additionalTomcatConnectors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tomcat<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConnector</span><span class="token punctuation">(</span>additionalConnector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">prepareContext</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> initializers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getTomcatWebServer</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看最后返回的getTomcatWebServer，只要端口号大于等于0就自动启动</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">TomcatWebServer</span> <span class="token function">getTomcatWebServer</span><span class="token punctuation">(</span><span class="token class-name">Tomcat</span> tomcat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TomcatWebServer</span><span class="token punctuation">(</span>tomcat<span class="token punctuation">,</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过进入TomcatWebServer的initialize方法就可以看到启动容器</p><figure><img src="`+pn+`" alt="48" tabindex="0" loading="lazy"><figcaption>48</figcaption></figure><h3 id="配置是如何修改原理" tabindex="-1"><a class="header-anchor" href="#配置是如何修改原理" aria-hidden="true">#</a> 配置是如何修改原理</h3><p>看ServletWebServerFactoryAutoConfiguration中，在自动配置之前先导入了BeanPostProcessorsRegistrar（后置处理器，Bean初始化前后，创建完对象没有赋值的除四害工作）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过观察下面的：registerBeanDefinitions方法中WebServerFactoryCustomizerBeanPostProcessor，</p><p>初始之前，如果当前初始化的一个WebServerFactory就调用postProcessBeforeInitialization</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">WebServerFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactory</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取所有的定制其，调用每一个定制其的customize方法来给servlet容器赋值（端口...）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactory</span> webServerFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">LambdaSafe</span><span class="token punctuation">.</span><span class="token function">callbacks</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> webServerFactory<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withLogger</span><span class="token punctuation">(</span><span class="token class-name">WebServerFactoryCustomizerBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>customizer<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> customizer<span class="token punctuation">.</span><span class="token function">customize</span><span class="token punctuation">(</span>webServerFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再看WebServerFactoryCustomizerBeanPostProcessor中的Collection，这个从容器中获取这个类型的组件。定制servlet容器组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Look up does not include the parent context</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getWebServerFactoryCustomizerBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小结-2" tabindex="-1"><a class="header-anchor" href="#小结-2" aria-hidden="true">#</a> 小结：</h3><ol><li>根据导入情况，添加相应的容器工厂：</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ServletWebServerFactoryAutoConfiguration<span class="token punctuation">.</span>BeanPostProcessorsRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedTomcat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedJetty</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">ServletWebServerFactoryConfiguration<span class="token punctuation">.</span>EmbeddedUndertow</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>容器中某个组件创建就会触发<strong>后置处理器（BeanPostProcessorsRegistrar）</strong></li></ol><p>只要是ConfigurableListableBeanFactory就工作：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>这个后置处理器从容器中<strong>获取所有的定制器，然后定制属性（端口..）</strong></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Look up does not include the parent context</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">getWebServerFactoryCustomizerBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>customizers <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>customizers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="嵌入式servlet自动配置原理" tabindex="-1"><a class="header-anchor" href="#嵌入式servlet自动配置原理" aria-hidden="true">#</a> 嵌入式Servlet自动配置原理</h2><p>断点声明：</p><figure><img src="`+on+'" alt="49" tabindex="0" loading="lazy"><figcaption>49</figcaption></figure><p>首先启动SpringBoot</p><figure><img src="'+cn+'" alt="50" tabindex="0" loading="lazy"><figcaption>50</figcaption></figure><p>然后调用run方法：</p><figure><img src="'+ln+'" alt="51" tabindex="0" loading="lazy"><figcaption>51</figcaption></figure><p>创建和刷新容器</p><figure><img src="'+un+`" alt="52" tabindex="0" loading="lazy"><figcaption>52</figcaption></figure><p>查看是如何创建容器的：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContextClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contextClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">SERVLET</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_SERVLET_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">REACTIVE</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_REACTIVE_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是一个WEB容器：<strong>DEFAULT_SERVLET_WEB_CONTEXT_CLASS</strong>，如果是一个普通容器就创建：<strong>DEFAULT_CONTEXT_CLASS</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>    /**
     * The class name of application context that will be used by default for non-web
     * environments.
     */
    public static final String DEFAULT_CONTEXT_CLASS = &quot;org.springframework.context.&quot;
            + &quot;annotation.AnnotationConfigApplicationContext&quot;;
    /**
     * The class name of application context that will be used by default for web
     * environments.
     */
    public static final String DEFAULT_SERVLET_WEB_CONTEXT_CLASS = &quot;org.springframework.boot.&quot;
            + &quot;web.servlet.context.AnnotationConfigServletWebServerApplicationContext&quot;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要是刷新IOC容器</p><figure><img src="`+rn+'" alt="53" tabindex="0" loading="lazy"><figcaption>53</figcaption></figure><p>刷新IOC容器</p><figure><img src="'+kn+'" alt="54" tabindex="0" loading="lazy"><figcaption>54</figcaption></figure><p>以此类推</p><figure><img src="'+dn+'" alt="55" tabindex="0" loading="lazy"><figcaption>55</figcaption></figure><figure><img src="'+vn+'" alt="56" tabindex="0" loading="lazy"><figcaption>56</figcaption></figure><figure><img src="'+mn+'" alt="57" tabindex="0" loading="lazy"><figcaption>57</figcaption></figure><p>然后就创建嵌入式的servlet容器：</p><figure><img src="'+gn+'" alt="58" tabindex="0" loading="lazy"><figcaption>58</figcaption></figure><p>然后就获取到了嵌入式servlet容器</p><figure><img src="'+bn+`" alt="59" tabindex="0" loading="lazy"><figcaption>59</figcaption></figure><p><strong>小结</strong>：IOC容器启动创建嵌入式的servlet容器</p><ol><li><p>SpringBoot启动运行run方法</p></li><li><p>刷新IOC容器（创建IOC容器对象，初始化容器，创建每一个组件）</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后开始创建web容器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果是web环境创建：AnnotationConfigServletWebServerApplicationContext</p><p>否则创建：AnnotationConfigApplicationContext</p><ol start="3"><li>刷新刚才创建号的IOC容器：</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">)</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li><p>调用onRefresh()，web的IOC容器重写了onRefresh方法</p></li><li><p>webIOC容器会创建嵌入式的Servlet容器</p></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">createWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>获取嵌入式的Servlet容器工厂</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token function">getWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后从IOC容器中获取TomcatServletWebServerFactory组件；</p><p>后置处理器：BeanPostProcessorsRegistrar 获取所有的定制器来定制Servlet的相关配置</p><ol start="7"><li>嵌入式Servlet容器创建并启动Tomcat</li></ol><h2 id="整合jdbc" tabindex="-1"><a class="header-anchor" href="#整合jdbc" aria-hidden="true">#</a> 整合JDBC</h2><p>YAML配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自动配置原理-2" tabindex="-1"><a class="header-anchor" href="#自动配置原理-2" aria-hidden="true">#</a> 自动配置原理</h3><p>DataSourceProperties</p><ol><li>DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池，可以使用spring.datasource.type自定义数据源类型</li></ol><ul><li>Tomcat</li><li>Hikari</li><li>Dbcp2</li><li>Generic 自定义数据源</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;spring.datasource.type&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Generic</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 使用DataSourceBuilder创建数据源，利用创建响应type的数据源，并且绑定相关属性</span>
        <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>DataSourceAutoConfiguration</p></li><li><p>JdbcTemplateAutoConfiguration</p></li></ol><h2 id="整合druid" tabindex="-1"><a class="header-anchor" href="#整合druid" aria-hidden="true">#</a> 整合Druid</h2><p>导入POM：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先配置YAML：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token comment">#   数据源其他配置</span>
    <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
    <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
    <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙</span>
    <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>log4j
    <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">useGlobalDataSourceStat</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">connectionProperties</span><span class="token punctuation">:</span> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Druid</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.datasource&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    配置监控</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">statViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServletRegistrationBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StatViewServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;loginUsername&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;loginPassword&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;allow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认所有</span>
<span class="token comment">//        initParams.put(&quot;deny&quot;, &quot;&quot;); // 拒绝访问</span>
        bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    配置一个web监控的filter</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">webStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FilterRegistrationBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebStatFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> initParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initParams<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;exclusions&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.js,*.css,/druid/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setInitParameters</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setUrlPatterns</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就可以看见查询的信息：</p><figure><img src="`+fn+`" alt="60" tabindex="0" loading="lazy"><figcaption>60</figcaption></figure><p>SpringBoot2 使用YAML直接配置监控器和访问地址：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mybatis_test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token comment">#   数据源其他配置</span>
    <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
    <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
    <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙</span>
    <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>log4j
    <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">useGlobalDataSourceStat</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">connectionProperties</span><span class="token punctuation">:</span> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall
      <span class="token key atrule">aop-patterns</span><span class="token punctuation">:</span> com.javayh.druid.*
      <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*
        <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> /druid/*<span class="token punctuation">,</span><span class="token important">*.js</span><span class="token punctuation">,</span><span class="token important">*.gif</span><span class="token punctuation">,</span><span class="token important">*.webp</span><span class="token punctuation">,</span><span class="token important">*.bmp</span><span class="token punctuation">,</span><span class="token important">*.webp</span><span class="token punctuation">,</span><span class="token important">*.css</span><span class="token punctuation">,</span><span class="token important">*.ico</span>
        <span class="token key atrule">session-stat-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">session-stat-max-count</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>
        <span class="token comment"># 是否启用statViewServlet配置</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 访问监控页面</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/druid/*&quot;</span>
        <span class="token comment"># 禁止手动重置监控数据</span>
        <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token comment"># 设置监控页面的登陆名</span>
        <span class="token key atrule">login-username</span><span class="token punctuation">:</span> admin
        <span class="token comment"># 设置监控页面的登陆密码</span>
        <span class="token key atrule">login-password</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="整合mybatis" tabindex="-1"><a class="header-anchor" href="#整合mybatis" aria-hidden="true">#</a> 整合Mybatis</h2><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven" aria-hidden="true">#</a> Maven</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用注解" tabindex="-1"><a class="header-anchor" href="#使用注解" aria-hidden="true">#</a> 使用注解</h3><p>创建实体类进行测试：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> gender<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> dId<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> departmentName<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用注解**@Mapper**标注使用Mybatis</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DepartmentMapper</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot;select * from department where id = #{id} ;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDepById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;delete from department where id = #{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteDepById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">&quot;insert into department (department_name) values (#{departmentName});&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">&quot;update department set department_name=#{departmentName} where id = #{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateDept</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以自定义Mybatis：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@org.springframework.context.annotation.Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConfigurationCustomizer</span> <span class="token function">configurationCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConfigurationCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                configuration<span class="token punctuation">.</span><span class="token function">setMapUnderscoreToCamelCase</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果@Mapper过多可以在主类中使用**@MapperScan**批量扫描接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;cn.zhiyucs.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootMybatis01Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootMybatis01Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用配置文件" tabindex="-1"><a class="header-anchor" href="#使用配置文件" aria-hidden="true">#</a> 使用配置文件</h3><p>创建Mybatis目录结构：</p><figure><img src="`+yn+`" alt="61" tabindex="0" loading="lazy"><figcaption>61</figcaption></figure><p>Mybatis主配置environment可以什么都不写：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>
        <span class="token name">PUBLIC</span> <span class="token string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapUnderscoreToCamelCase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在主配置文件中配置MyBatis：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">config-location</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mybatis<span class="token punctuation">-</span>config.xml
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mapper/<span class="token important">*.xml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springboot启动原理" tabindex="-1"><a class="header-anchor" href="#springboot启动原理" aria-hidden="true">#</a> SpringBoot启动原理</h2><p>程序入口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootStartertheoryApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="第一步-创建springapplication对象" tabindex="-1"><a class="header-anchor" href="#第一步-创建springapplication对象" aria-hidden="true">#</a> 第一步：创建SpringApplication对象</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> primarySource<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> primarySource <span class="token punctuation">}</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> primarySources<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以观察它的构造方法：创建方法见下面</p><p>主要是配置两个类</p><ul><li>ApplicationContextInitializer</li><li>SpringApplicationRunListener</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> primarySources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> resourceLoader<span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">,</span> <span class="token string">&quot;PrimarySources must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 配置source</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>primarySources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断是否是web应用</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType <span class="token operator">=</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span><span class="token function">deduceFromClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建初始化构造器</span>
    <span class="token function">setInitializers</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建应用监听器</span>
    <span class="token function">setListeners</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 推断出main方法类</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass <span class="token operator">=</span> <span class="token function">deduceMainpplicationClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再进入：getSpringFactoriesInstances</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取类加载器</span>
    <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Use names and ensure unique to protect against duplicates</span>
    <span class="token comment">// 通过类加载器，获取指定的META-INF/spring.factories文件，获取文件中工厂类的全类名</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过类路径反射得到工厂对象，构造方法</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> <span class="token function">createSpringFactoriesInstances</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">,</span> classLoader<span class="token punctuation">,</span> args<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> instances<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过loadFactoryNames就可以知道</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORIES_RESOURCE_LOCATION</span> <span class="token operator">=</span> <span class="token string">&quot;META-INF/spring.factories&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="第二步-启动应用" tabindex="-1"><a class="header-anchor" href="#第二步-启动应用" aria-hidden="true">#</a> 第二步：启动应用</h3><p>主类：ConfigurableApplicationContext</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 应用启动计时器开始计时</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">&gt;</span></span> exceptionReporters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Headless模式配置（做AWT，暂时不用管）</span>
    <span class="token function">configureHeadlessProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取启动监听器</span>
    <span class="token class-name">SpringApplicationRunListeners</span> listeners <span class="token operator">=</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 应用启动监听器开始计时（回调所有的SpringApplicationRunListeners.starting()）</span>
    listeners<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 封装命令行参数</span>
        <span class="token class-name">ApplicationArguments</span> applicationArguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultApplicationArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 配置环境模块（祥见下面prepareEnvironment方法）</span>
        <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 配置需要忽略的bean</span>
        <span class="token function">configureIgnoreBeanInfo</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Banner配置(打印Spring的图标)</span>
        <span class="token class-name">Banner</span> printedBanner <span class="token operator">=</span> <span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建应用上下文对象</span>
        context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 异常分析报告</span>
        exceptionReporters <span class="token operator">=</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                                                         <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 上下文基本属性配置（祥见下面prepareContext方法）</span>
        <span class="token function">prepareContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 更新应用上下文/刷新IOC容器（祥见下面refresh方法）</span>
        <span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从IOC容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span>
        <span class="token comment">// 先ApplicationRunner</span>
        <span class="token function">afterRefresh</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">StartupInfoLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logStarted</span><span class="token punctuation">(</span><span class="token function">getApplicationLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stopWatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        listeners<span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callRunners</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        listeners<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRunFailure</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> exceptionReporters<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 整个SpringBoot启动完成返回IOC容器</span>
    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取监听器的方法：<strong>getSpringFactoriesInstances</strong>，可以看出也是从<strong>META-INF</strong>获取</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SpringApplicationRunListeners</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplicationRunListeners</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span>
                                             <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> types<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Listener环境：<strong>prepareEnvironment</strong>(listeners, applicationArguments);</p><p>环境完成后回调SpringApplicationRunListeners.environmentPrepared方法，表示环境准备完成</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span>
                                                   <span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create and configure the environment</span>
    <span class="token comment">// 创建配置环境</span>
    <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">getOrCreateEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 加载属性文件</span>
    <span class="token function">configureEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">.</span><span class="token function">getSourceArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听器监听配置</span>
    listeners<span class="token punctuation">.</span><span class="token function">environmentPrepared</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">bindToSpringApplication</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCustomEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnvironmentConverter</span><span class="token punctuation">(</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertEnvironmentIfNecessary</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span>
                                                                                               <span class="token function">deduceEnvironmentClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> environment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到放行Banner后出现：</p><figure><img src="`+hn+`" alt="63" tabindex="0" loading="lazy"><figcaption>63</figcaption></figure><p>然后看<strong>createApplicationContext</strong>：决定创建</p><p>WEB（DEFAULT_SERVLET_WEB_CONTEXT_CLASS）</p><p>还是</p><p>普通IOC（DEFAULT_CONTEXT_CLASS）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContextClass<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contextClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token constant">SERVLET</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_SERVLET_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token constant">REACTIVE</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_REACTIVE_WEB_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CONTEXT_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Unable create a default ApplicationContext, please specify an ApplicationContextClass&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">)</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>contextClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看<strong>prepareContext</strong>准备上下文：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">prepareContext</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span>
                            <span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">,</span> <span class="token class-name">Banner</span> printedBanner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 保存刚刚的environment</span>
    context<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 后置处理器，注册小组件</span>
    <span class="token function">postProcessApplicationContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 主要：</span>
    <span class="token function">applyInitializers</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listeners<span class="token punctuation">.</span><span class="token function">contextPrepared</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logStartupInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">logStartupProfileInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Add boot specific singleton beans</span>
    <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springApplicationArguments&quot;</span><span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>printedBanner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springBootBanner&quot;</span><span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setAllowBeanDefinitionOverriding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowBeanDefinitionOverriding<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazyInitialization<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">addBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyInitializationBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Load the sources</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sources <span class="token operator">=</span> <span class="token function">getAllSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> <span class="token string">&quot;Sources must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">load</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> sources<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 完成后回调contextLoaded</span>
    listeners<span class="token punctuation">.</span><span class="token function">contextLoaded</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看关键的applyInitializers，回调之前保存的ApplicationContextInitializer的initialize：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">applyInitializers</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationContextInitializer</span> initializer <span class="token operator">:</span> <span class="token function">getInitializers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> requiredType <span class="token operator">=</span> <span class="token class-name">GenericTypeResolver</span><span class="token punctuation">.</span><span class="token function">resolveTypeArgument</span><span class="token punctuation">(</span>initializer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                        <span class="token class-name">ApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span>requiredType<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token string">&quot;Unable to call initializer.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        initializer<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后看 listeners.contextPrepared(context); 回调之前的SpringApplicationRunListener的contextPrepared方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">contextPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span> listener <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        listener<span class="token punctuation">.</span><span class="token function">contextPrepared</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后开始刷新容器<strong>refreshContext(context)</strong>：（配置、组件、自动配置）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> var1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//准备更新上下文时的预备工作：1.初始化PropertySource; 2.验证Enrivonment中必要的属性</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取上下文中的BeanFactory</span>
        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//对BeanFactory做些预备工作</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//对BeanFactory进行预处理</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//执行容器中的BeanFactoryPostProcessor</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//注册BeanPostProcessor</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化MessageSource(国际化相关)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化容器事件广播器(用来发布事件)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//初始化一些特殊的Bean,主要做了: 1.初始化ThemeSource(跟国际化相关的接口) 2.创建WebServer</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将所有监听器注册到前两步创建的事件广播器中</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//结束BeanFactory的初始化工作(这一步主要用来将所有的单例BeanDefinition实例化)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//上下文刷新完毕</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> var9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> <span class="token operator">+</span> var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cancelRefresh</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> var9<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基于原理的测试笔记-测试启动的四个类" tabindex="-1"><a class="header-anchor" href="#基于原理的测试笔记-测试启动的四个类" aria-hidden="true">#</a> （基于原理的测试笔记）测试启动的四个类</h2><p>测试类：</p><ul><li>ApplicationContextInitializer</li><li>SpringApplicationRunListener</li><li>ApplicationRunner</li><li>CommandLineRunner</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloApplicationContextInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationContextInitializer............initialize........&quot;</span> <span class="token operator">+</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloSpringApplicationRunListener</span> <span class="token keyword">implements</span> <span class="token class-name">SpringApplicationRunListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">HelloSpringApplicationRunListener</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span> application<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener......starting.......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">environmentPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>environment<span class="token punctuation">.</span><span class="token function">getSystemEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........environmentPrepared.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........contextPrepared.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoaded</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........contextLoaded.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">started</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SpringApplicationRunListener.........started.............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">running</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloApplicationRunner</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationRunner</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ApplicationRunner.........run.........&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCommandLineRunner</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CommandLineRunner............run........&quot;</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在主配置类中（application.properties）配置前两个类：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">org.springframework.context.ApplicationContextInitializer</span><span class="token punctuation">=</span><span class="token value attr-value">\\
cn.zhiyucs.listener.HelloApplicationContextInitializer</span>
<span class="token key attr-name">org.springframework.boot.SpringApplicationRunListener</span><span class="token punctuation">=</span><span class="token value attr-value">\\
cn.zhiyucs.listener.HelloSpringApplicationRunListener</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义starters【暂时无法理解】" tabindex="-1"><a class="header-anchor" href="#自定义starters【暂时无法理解】" aria-hidden="true">#</a> 自定义starters【暂时无法理解】</h2><p>编写自动配置类需要的注解：</p><ul><li><strong>@Configuration</strong> 指定是一个配置类</li><li><strong>@Conditionalxxx</strong> 指定条件成立的时候自动配置生效</li><li><strong>@AutoConfigureOrder</strong> 指定自动配置类的顺序</li><li><strong>@AutoConfigureAfter</strong></li><li><strong>@Bean</strong> 给容器添加组件</li><li><strong>@ConfigurationProperties(prefix = &quot;&quot;)</strong> 绑定相关的配置</li><li><strong>@EnableConfigurationProperties</strong> 让xxxProperties生效加入到容器中</li></ul><p>加入到META-INF-factories里面：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># Initializers</span>
<span class="token key attr-name">org.springframework.context.ApplicationContextInitializer</span><span class="token punctuation">=</span><span class="token value attr-value">\\
org.springframework.boot.autoconfigure.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>引入模式：</p><p>启动器依赖自动模式，只需引入starter即可</p><p>推荐命名：xxx-spring-boot-starter</p><figure><img src="`+wn+'" alt="64" tabindex="0" loading="lazy"><figcaption>64</figcaption></figure><p>创建一个空工程</p><p>创建一个model</p><figure><img src="'+An+'" alt="65" tabindex="0" loading="lazy"><figcaption>65</figcaption></figure><p>创建一个springbootInitialize</p><figure><img src="'+Sn+'" alt="66" tabindex="0" loading="lazy"><figcaption>66</figcaption></figure><h2 id="springboot缓存基本使用" tabindex="-1"><a class="header-anchor" href="#springboot缓存基本使用" aria-hidden="true">#</a> SpringBoot缓存基本使用</h2><p>应用--缓存--数据库的关系</p><figure><img src="'+Cn+'" alt="67" tabindex="0" loading="lazy"><figcaption>67</figcaption></figure><p>几个重要的缓存注解：</p><table><thead><tr><th>Cache</th><th>缓存接口，定义缓存操作。实现有：RedisCache、EhCacheCache、ConcurrentMapCache等</th></tr></thead><tbody><tr><td>CacheManager</td><td>缓存管理器，管理各种缓存（Cache）组件</td></tr><tr><td>@Cacheable</td><td>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存</td></tr><tr><td>@CacheEvict</td><td>清空缓存</td></tr><tr><td>@CachePut</td><td>保证方法被调用，又希望结果被缓存。</td></tr><tr><td>@EnableCaching</td><td>开启基于注解的缓存</td></tr><tr><td>keyGenerator</td><td>缓存数据时key生成策略</td></tr><tr><td>serialize</td><td>缓存数据时value序列化策略</td></tr></tbody></table><p>缓存的spel</p>',365),ns=n("thead",null,[n("tr",null,[n("th",null,"名字"),n("th",null,"位置"),n("th",null,"描述"),n("th",null,"示例")])],-1),ss=n("tr",null,[n("td",null,"methodName"),n("td",null,"root object"),n("td",null,"当前被调用的方法名"),n("td",null,"#root.methodName")],-1),as=n("td",null,"method",-1),ts=n("td",null,"root object",-1),es=n("td",null,"当前被调用的方法",-1),ps={href:"http://root.method.name",target:"_blank",rel:"noopener noreferrer"},os=n("tr",null,[n("td",null,"target"),n("td",null,"root object"),n("td",null,"当前被调用的目标对象"),n("td",null,"#root.target")],-1),cs=n("tr",null,[n("td",null,"targetClass"),n("td",null,"root object"),n("td",null,"当前被调用的目标对象类"),n("td",null,"#root.targetClass")],-1),is=n("tr",null,[n("td",null,"args"),n("td",null,"root object"),n("td",null,"当前被调用的方法的参数列表"),n("td",null,"#root.args[0]")],-1),ls=n("tr",null,[n("td",null,"caches"),n("td",null,"root object"),n("td",null,'当前方法调用使用的缓存列表（如@Cacheable(value={"cache1", "cache2"})），则有两个cache'),n("td",null,"#root.caches[0].name")],-1),us=n("tr",null,[n("td",null,[n("em",null,"argument name")]),n("td",null,"evaluation context"),n("td",null,"方法参数的名字. 可以直接 #参数名 ，也可以使用 #p0或#a0 的形式，0代表参数的索引；"),n("td",null,"#iban 、 #a0 、 #p0")],-1),rs=n("tr",null,[n("td",null,"result"),n("td",null,"evaluation context"),n("td",null,"方法执行后的返回值（仅当方法执行之后的判断有效，如‘unless’，’cache put’的表达式 ’cache evict’的表达式beforeInvocation=false）"),n("td",null,"#result")],-1),ks=e(`<h3 id="基本使用" tabindex="-1"><a class="header-anchor" href="#基本使用" aria-hidden="true">#</a> 基本使用</h3><p>在主类开启**@EnableCaching**缓存</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;cn.zhiyucs.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootCache01Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringbootCache01Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要缓存的方法开启**@Cacheable**：（介绍见注释）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @Cacheable :将方法结果放入缓存，以后要有相同的数据直接从缓存中获取，不用调方法
     * CacheManager 管理多个cache组件，对缓存的真正CRUD操作再cache组件中，每一个缓存都有自己唯一的名字
     * @Cacheable几个属性：
     *      cacheNames/value: 指定缓存组件的名字
     *      key: 缓存数据使用的key，默认是使用参数方法参数的值， 1-方法的返回值
     *      keyGenerator: key的生成器，可以自己指定key的生成器的组件id
     *          key / keyGenerator 二选一
     *      cacheManager: 指定缓存管理器/缓存解析器（cacheResolver）
     *      condition: 指定符合条件下才缓存
     *      unless: 否定缓存,当unless指定的条件为true，方法的返回值就不会被缓存
     *          eg. unless = &quot;#result == null&quot; 数据为空不缓存
     *      sync: 是否使用异步模式
     * <span class="token keyword">@param</span> <span class="token parameter">id</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>condition <span class="token operator">=</span> <span class="token string">&quot;#id&gt;0&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#result == null&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;缓存测试专业SOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Employee</span> emp <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> emp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据库方面：开启驼峰命名自动映射，开启打印SQL：</p><p>打印SQL：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">logging.level.cn.zhiyucs.mapper</span><span class="token punctuation">=</span><span class="token value attr-value">debug</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>驼峰命名自动映射：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="几个属性介绍" tabindex="-1"><a class="header-anchor" href="#几个属性介绍" aria-hidden="true">#</a> 几个属性介绍</h3><p>cacheNames/value: 指定缓存组件的名字，将方法的返回结果放在哪个缓存中，是数组的方式，可以指定多个</p><p>condition #a0&gt;1的意思是当第一个参数的值大于1才生效</p><p>unless 同理，第一个参数为2的话就不会缓存</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;keyGenerator&quot;</span><span class="token punctuation">,</span> condition <span class="token operator">=</span> <span class="token string">&quot;#a0&gt;1&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#a0==2&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>key的两种方法：</strong></p><ul><li>直接指定：<strong>key = &quot;#root.methodName+&#39;[&#39;+#id+&#39;]&quot;</strong></li><li>使用配置类指定：</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCacheConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KeyGenerator</span> <span class="token function">keyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;[&quot;</span><span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后直接调用即可：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;keyGenerator&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="缓存自动配置原理" tabindex="-1"><a class="header-anchor" href="#缓存自动配置原理" aria-hidden="true">#</a> 缓存自动配置原理</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token class-name">CacheAspectSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">CacheManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;cacheResolver&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">CouchbaseAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">HazelcastAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        <span class="token class-name">HibernateJpaAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RedisAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">CacheConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">CacheManagerEntityManagerFactoryDependsOnPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheAutoConfiguration</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个类主要是导入了：CacheConfigurationImportSelector，导入了缓存要用的组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfigurationImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CacheType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>types<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> types<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            imports<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">CacheConfigurations</span><span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span>types<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> imports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要是导入了这几个组件：默认使用的是 -- SimpleCacheConfiguration</p><figure><img src="`+En+`" alt="68" tabindex="0" loading="lazy"><figcaption>68</figcaption></figure><p><strong>SimpleCacheConfiguration</strong>：给容器中注册了一个cacheManager</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">ConcurrentMapCacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span> cacheProperties<span class="token punctuation">,</span>
                                       <span class="token class-name">CacheManagerCustomizers</span> cacheManagerCustomizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ConcurrentMapCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cacheNames <span class="token operator">=</span> cacheProperties<span class="token punctuation">.</span><span class="token function">getCacheNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cacheNames<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">setCacheNames</span><span class="token punctuation">(</span>cacheNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cacheManagerCustomizers<span class="token punctuation">.</span><span class="token function">customize</span><span class="token punctuation">(</span>cacheManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入<strong>ConcurrentMapCacheManager</strong></p><p>cacheManager的作用是：通过进入<strong>createConcurrentMapCache</strong>方法，可知这个主要是创建了<strong>ConcurrentMapCache</strong>类型的缓存组件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Cache</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Cache</span> cache <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cache <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cache <span class="token operator">=</span> <span class="token function">createConcurrentMapCache</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ConcurrentMapCache</strong>的作用是把数据保存在ConcurrentMap&lt;Object, Object&gt;中：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> store<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="以-cacheable为例" tabindex="-1"><a class="header-anchor" href="#以-cacheable为例" aria-hidden="true">#</a> 以@Cacheable为例</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>condition <span class="token operator">=</span> <span class="token string">&quot;#id&gt;0&quot;</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">&quot;#result == null&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>方法运行之前，先去查询Cache（缓存组件），按照cacheNames指定的名字获取：CacheManager先获取相应的缓存，第一次获取缓存会自动创建出来（createConcurrentMapCache(name)）</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Cache</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+xn+`" alt="69" tabindex="0" loading="lazy"><figcaption>69</figcaption></figure><ol start="2"><li>Cache查找缓存的内容，使用一个key -- 默认是方法的参数，</li></ol><p>key是按照某种策略生成的，默认是使用keyGennerator生成 -- 默认使用的是SimpleKeyGennerator</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 生成策略</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SimpleKey</span><span class="token punctuation">.</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> param <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>param<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> param<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleKey</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>operation<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EvaluationContext</span> evaluationContext <span class="token operator">=</span> <span class="token function">createEvaluationContext</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> evaluator<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>operation<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>methodKey<span class="token punctuation">,</span> evaluationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>keyGenerator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>method<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+qn+`" alt="70" tabindex="0" loading="lazy"><figcaption>70</figcaption></figure><p>查询缓存的方法：（AbstractValueAdaptingCache.class）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">ValueWrapper</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token function">lookup</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">toValueWrapper</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>没有查到缓存就调用目标方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+jn+`" alt="71" tabindex="0" loading="lazy"><figcaption>71</figcaption></figure><ol start="4"><li>将目标方法返回的结果，放进缓存中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">toStoreValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+Bn+`" alt="72" tabindex="0" loading="lazy"><figcaption>72</figcaption></figure><p>第二次再访问时：lookup和getCache都会被访问到</p><p>lookup找到缓存后会转到 ValueWrapper get(Object key) 得到值；</p><h3 id="小结-3" tabindex="-1"><a class="header-anchor" href="#小结-3" aria-hidden="true">#</a> 小结：</h3><h4 id="核心" tabindex="-1"><a class="header-anchor" href="#核心" aria-hidden="true">#</a> 核心：</h4><ol><li><p>使用CacheManager（ConcurrentMapCacheManager）按照名字得到Cache组件（ConcurrentMapCache）</p></li><li><p>key使用的是keyGennerator生成，默认是SimpleKeyGennerator</p></li><li><p>@Cacheable标注的方法执行前先检查缓存中有没有这个数据，默认按照参数的值作为key去查询缓存，如果没有就运行方法并将结果放入缓存。 以后再来调用就直接使用缓存中的数据</p></li><li><p>SimpleKeyGennerator生成策略：</p></li></ol><ul><li>如果没有参数，key就使用key = new SimpleKey()</li><li>如果有一个参数key=参数的值</li><li>如果有多个参数key = new SimpleKey(params)</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleKeyGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">KeyGenerator</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">generateKey</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+Rn+'" alt="73" tabindex="0" loading="lazy"><figcaption>73</figcaption></figure><h4 id="思路整理" tabindex="-1"><a class="header-anchor" href="#思路整理" aria-hidden="true">#</a> 思路整理</h4><p>ConcurrentMapCacheManager通过getCache获取到name（key）</p><ol><li>第一次访问，没有缓存的情况</li></ol><p>createConcurrentMapCache -&gt; lookup根据key(key有生成策略)查找缓存的数据 -&gt; 调用目标方法 -&gt; 把数据放在缓存（store）里(this.store.put(key, toStoreValue(value)))</p><ol start="2"><li>第二次访问</li></ol><figure><img src="'+Mn+'" alt="74" tabindex="0" loading="lazy"><figcaption>74</figcaption></figure><p>Cache cache = this.cacheMap.get(name);调回缓存的数据-&gt; 返回方法</p><h2 id="cacheput的使用" tabindex="-1"><a class="header-anchor" href="#cacheput的使用" aria-hidden="true">#</a> @CachePut的使用</h2><p><strong>@CachePut</strong>的key属性有两种写法：</p>',68),ds={href:"http://employee.id",target:"_blank",rel:"noopener noreferrer"},vs={href:"http://result.id",target:"_blank",rel:"noopener noreferrer"},ms=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @CachePut 既调用方法，又更新缓存
     * 修改了数据库的某个数据，同时更新缓存
     * 运行时机：
     *  1. 先调用目标方法
     *  2. 将目标方法的结果缓存起来
     */</span>
    <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">updateEmp</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        employeeMapper<span class="token punctuation">.</span><span class="token function">updateEmp</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> employee<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了实现同步缓存，这里的cacheNames可以和查询方法的一样，这样就可以实现更新的同时更换缓存的内容，从而达到查询也同步缓存。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+Pn+'" alt="75" tabindex="0" loading="lazy"><figcaption>75</figcaption></figure><figure><img src="'+In+`" alt="76" tabindex="0" loading="lazy"><figcaption>76</figcaption></figure><h2 id="cacheevict-清除缓存" tabindex="-1"><a class="header-anchor" href="#cacheevict-清除缓存" aria-hidden="true">#</a> @CacheEvict 清除缓存</h2><p>@CacheEvict要清除name为emp缓存中key为id的所有数据</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @CacheEvict 缓存清除
     * key 指定要清除的数据
     * allEntries 要清除这个缓存中的所有数据
     * beforeInvocation = false 缓存的清除是否在方法之前执行，默认时在方法执行之后执行
     *      如果出现异常就不会清除
     */</span>
<span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">&quot;#id&quot;</span><span class="token punctuation">,</span> allEntries <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> beforeInvocation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;deleteEmp:&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//        employeeMapper.deleteEmpById(id);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="caching和-cacheconfig" tabindex="-1"><a class="header-anchor" href="#caching和-cacheconfig" aria-hidden="true">#</a> @Caching和@CacheConfig</h2><h3 id="caching" tabindex="-1"><a class="header-anchor" href="#caching" aria-hidden="true">#</a> @Caching</h3><p>​ <strong>@Caching</strong> 这个caching因为使用了**@CachePut**所以第二次还是会执行，但是如果执行了通过id和email查询就在执行了这个方法后就直接执行，因为这个方法已经缓存了这个内容</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * @Caching 定义复杂的缓存规则
     * <span class="token keyword">@param</span> <span class="token parameter">lastName</span>
     * <span class="token keyword">@return</span>
     */</span>
<span class="token annotation punctuation">@Caching</span><span class="token punctuation">(</span>
    cacheable <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#lastName&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    put <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#result.email&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmpByLastName</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpByLastName</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cacheconfig" tabindex="-1"><a class="header-anchor" href="#cacheconfig" aria-hidden="true">#</a> @CacheConfig</h3><p>使用了这个直接之后，之后的所有注解（@Cacheable、@CachePut）就不用写已经在@CacheConfig中写了的属性</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@CacheConfig</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;emp&quot;</span><span class="token punctuation">)</span> <span class="token comment">//抽取缓存的公共配置</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeService</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="整合缓存中间件redis" tabindex="-1"><a class="header-anchor" href="#整合缓存中间件redis" aria-hidden="true">#</a> 整合缓存中间件Redis</h2><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Redis：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在要是有Redis的地方注入redis：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span> <span class="token comment">// 操作字符串</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span> <span class="token comment">// k-v操作对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接使用Redis类型：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> msg <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义Redis类型（JSON类型）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">empRedisTemplate</span><span class="token punctuation">(</span>
            <span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> redisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span>redisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后就可以注入这个自定义的类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employeeRedisTemplate<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Employee</span> emp <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> employeeRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;emp&quot;</span><span class="token punctuation">,</span> emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+Fn+`" alt="77" tabindex="0" loading="lazy"><figcaption>77</figcaption></figure><h2 id="自定义rediscachemanager" tabindex="-1"><a class="header-anchor" href="#自定义rediscachemanager" aria-hidden="true">#</a> 自定义RedisCacheManager</h2><p>在配置类中直接添加即可：实现序列化转为JSON格式</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 缓存管理器
     */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//初始化一个RedisCacheWriter</span>
    <span class="token class-name">RedisCacheWriter</span> redisCacheWriter <span class="token operator">=</span> <span class="token class-name">RedisCacheWriter</span><span class="token punctuation">.</span><span class="token function">nonLockingRedisCacheWriter</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置CacheManager的值序列化方式为json序列化</span>
    <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> jsonSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> pair <span class="token operator">=</span> <span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span>
        <span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jsonSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisCacheConfiguration</span> defaultCacheConfig<span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置默认超过期时间是30秒</span>
    defaultCacheConfig<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化RedisCacheManager</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span>redisCacheWriter<span class="token punctuation">,</span> defaultCacheConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+Ln+`" alt="78" tabindex="0" loading="lazy"><figcaption>78</figcaption></figure><p>有两种调用方式：</p><p>第一种就是常用的注解：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询部门&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> department <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种是注入CacheManager后得到缓存，进行API调用：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">CacheManager</span> cacheManager<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询部门&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> department <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Cache</span> dept <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dept<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> department<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+On+`" alt="79" tabindex="0" loading="lazy"><figcaption>79</figcaption></figure><h4 id="扩展cachemanager的用法" tabindex="-1"><a class="header-anchor" href="#扩展cachemanager的用法" aria-hidden="true">#</a> 扩展CacheManager的用法</h4><p>判断在Redis中是否存在这个nosql，如果有就直接使用缓存，不查数据库，如果没有就查数据库缓存数据：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Department</span> <span class="token function">getDeptById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Department</span> dp<span class="token punctuation">;</span>
    <span class="token class-name">Cache</span> dept <span class="token operator">=</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dp <span class="token operator">=</span> dept<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dp <span class="token operator">=</span> departmentMapper<span class="token punctuation">.</span><span class="token function">getDeptById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dept<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="springsecurity的简单使用" tabindex="-1"><a class="header-anchor" href="#springsecurity的简单使用" aria-hidden="true">#</a> SpringSecurity的简单使用</h2><p>导包：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>建立一个配置类：</p><p>@EnableWebSecurity 开启安全配置，它里面有@Configuration</p><p>继承： WebSecurityConfigurerAdapter</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@EnableWebSecurity
public class MySecurityConfig extends WebSecurityConfigurerAdapter {
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义授权规则和定义认证规则</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 定义授权规则
@Override
protected void configure(HttpSecurity http) throws Exception {
    //        super.configure(http);
    // 定制授权规则
    http.authorizeRequests().antMatchers(&quot;/&quot;).permitAll()
        .antMatchers(&quot;/level1/**&quot;).hasRole(&quot;VIP1&quot;)
        .antMatchers(&quot;/level2/**&quot;).hasRole(&quot;VIP2&quot;)
        .antMatchers(&quot;/level3/**&quot;).hasRole(&quot;VIP3&quot;);
    // 开启自动配置的登录功能
    // /login来到登录页
    // 重定向到/login/error登录失败
    // 如果没有登录权限就会来到登录页面
    http.formLogin();
    // 开启自动配置的注销功能
    // 访问/login注销用户，清空session
    // 注销成功会返回/login?logout
    http.logout().logoutSuccessUrl(&quot;/&quot;);
}
// 定义认证规则
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    //super.configure(auth);
    auth.inMemoryAuthentication().passwordEncoder(NoOpPasswordEncoder.getInstance())
        .withUser(&quot;admin&quot;).password(&quot;123&quot;).roles(&quot;VIP1&quot;,&quot;VIP2&quot;)
        .and()
        .withUser(&quot;lisi&quot;).password(&quot;123&quot;).roles(&quot;VIP2&quot;, &quot;VIP3&quot;)
        .and()
        .withUser(&quot;zhiyu&quot;).password(&quot;123&quot;).roles(&quot;VIP1&quot;, &quot;VIP3&quot;);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="thymeleaf整合springsecurity" tabindex="-1"><a class="header-anchor" href="#thymeleaf整合springsecurity" aria-hidden="true">#</a> Thymeleaf整合SpringSecurity</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf.extras<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-springsecurity5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在前端加入额外的xmlns：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org/extras/spring-security<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>判定是否授权了：<strong>sec:authorize=&quot;!isAuthenticated()&quot;</strong></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">sec:</span>authorize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!isAuthenticated()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>游客您好，如果想查看武林秘籍 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/login}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>请登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>获取授权名：<strong>sec:authentication=&quot;name&quot;</strong></li><li>获取授权的权限名：<strong>sec:authentication=&quot;principal.authorities&quot;</strong></li><li>注销登录：<strong>th:action=&quot;@{/logout}&quot;</strong></li><li>判断是否存在这个权限：<strong>sec:authorize=&quot;hasRole(&#39;权限名字&#39;)&quot;</strong></li></ul><h3 id="记住我" tabindex="-1"><a class="header-anchor" href="#记住我" aria-hidden="true">#</a> <strong>记住我</strong></h3><p>直接在授权规则的configure配置即可</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 开启记住我功能</span>
<span class="token comment">// 登录成功将cookie发给浏览器保存，以后登录就会带上这个cookie(14天)</span>
http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="定制自己的登录页面" tabindex="-1"><a class="header-anchor" href="#定制自己的登录页面" aria-hidden="true">#</a> 定制自己的登录页面</h3><p>直接在授权规则的configure配置，</p><p>前端使用post方式：处理凭据，如果有效，则对用户进行身份验证</p><p>使用get：处理登录表格</p><p>如果action定位到userlogin/error，方法get：重定向到此处以进行失败的身份验证尝试</p><p>如果action定位到userlogin/logout，方法get：成功注销后重定向到此处</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;pwd&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/userlogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认post请求的/login是处理登录</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@{/userlogin}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            用户名:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
            密码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 记住我 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登陆<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shiro的简单使用" tabindex="-1"><a class="header-anchor" href="#shiro的简单使用" aria-hidden="true">#</a> Shiro的简单使用</h2><p>Shiro的功能框架图：</p><figure><img src="`+Dn+`" alt="80" tabindex="0" loading="lazy"><figcaption>80</figcaption></figure><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试环境设置（省略跳转网页的controller）：</p><figure><img src="`+Tn+`" alt="81" tabindex="0" loading="lazy"><figcaption>81</figcaption></figure><p>注：使用Thymeleaf模板的时候需要用到跳转页面@{}注意，如：th:href=&quot;@{/alogin}&quot;，里面内容需要是controller的内容</p><h3 id="开始配置一个shiro" tabindex="-1"><a class="header-anchor" href="#开始配置一个shiro" aria-hidden="true">#</a> 开始配置一个shiro</h3><p>Shiro 架构包含三个主要的理念：Subject 认证主体，SecurityManager 安全管理器和 Realm 域对象</p><ul><li>ShiroFilterFactoryBean ShiroFilter是整个Shiro的入口点，用于拦截需要安全控制的请求进行处理</li><li>DefaultWebSecurityManager 安全管理器</li><li>Realm 域对象</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">shiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;securityManager&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DefaultWebSecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShiroFilterFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置无权限时跳转的 url;</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setUnauthorizedUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/notRole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * anon
         * 无参，开放权限，可以理解为匿名用户或游客
         * authc
         * 无参，需要认证
         * logout
         * 无参，注销，执行后会直接跳转到shiroFilterFactoryBean.setLoginUrl(); 设置的 url
         * authcBasic
         * 无参，表示 httpBasic 认证
         * user
         * 无参，表示必须存在用户，当登入操作时不做检查
         * ssl
         * 无参，表示安全的URL请求，协议为 https
         * perms[user]
         * 参数可写多个，表示需要某个或某些权限才能通过，多个参数时写 perms[&quot;user, admin&quot;]，当有多个参数时必须每个参数都通过才算通过
         * roles[admin]
         * 参数可写多个，表示是某个或某些角色才能通过，多个参数时写 roles[&quot;admin，user&quot;]，当有多个参数时必须每个参数都通过才算通过
         * rest[user]
         * 根据请求的方法，相当于 perms[user:method]，其中 method 为 post，get，delete 等
         * port[8081]
         * 当请求的URL端口不是8081时，跳转到schemal://serverName:8081?queryString 其中 schmal 是协议 http 或 https 等等，serverName 是你访问的 Host，8081 是 Port 端口，queryString 是你访问的 URL 里的 ? 后面的参数
         */</span>
        <span class="token comment">// 设置拦截器</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> filterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/alogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[user:add]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/ulogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>filterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;userRealm&quot;</span><span class="token punctuation">)</span> <span class="token class-name">UserRealm</span> userRealm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultWebSecurityManager</span> securityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        securityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>userRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> securityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">UserRealm</span> <span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>域对象</strong>的创建</p><ul><li>继承AuthorizingRealm</li><li>主要分为：授权和认证</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token comment">// 授权</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行了授权...........&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 只要登录就有权限</span>
<span class="token comment">//        info.addStringPermission(&quot;user:add&quot;);</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> role <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//需要将 role 封装到 Set 作为 info.setRoles() 的参数</span>
        set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置该用户拥有的角色</span>
        <span class="token comment">//将用户对应的角色和权限信息 放到权限器中</span>
        info<span class="token punctuation">.</span><span class="token function">addStringPermissions</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> info<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 认证</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行了认证............&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        一般在数据库中取账号和密码</span>
        <span class="token class-name">UsernamePasswordToken</span> userToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> userToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// SimpleAuthenticationInfo参数：</span>
        <span class="token comment">// principle 认证实体，可以是username，也可以是实体类</span>
        <span class="token comment">// credentials 密码</span>
        <span class="token comment">// realmName 当前realm对象的name，直接调用父类的getName方法即可</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用控制层的请求把数据传输给Shiro和注销</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginAuth&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginAuth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                        <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前用户</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 封装用户的数据</span>
    <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行登录的方法</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResultMap</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//注销</span>
    subject<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> resultMap<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">&quot;成功注销！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="整合shiro启动器" tabindex="-1"><a class="header-anchor" href="#整合shiro启动器" aria-hidden="true">#</a> 整合Shiro启动器</h3><p>导包：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-web-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>项目结构：和security测试的时候一致</p><figure><img src="`+Nn+`" alt="82" tabindex="0" loading="lazy"><figcaption>82</figcaption></figure><p>同样的配置类：（加入了MD5盐值加密算法）</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置用于匹配密码的CredentialsMatcher</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HashedCredentialsMatcher</span> <span class="token function">credentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里是使用sha256加密</span>
        <span class="token comment">/*credentialsMatcher.setHashAlgorithmName(Sha256Hash.ALGORITHM_NAME);  // 散列算法，这里使用更安全的sha256算法
        credentialsMatcher.setStoredCredentialsHexEncoded(false);  // 数据库存储的密码字段使用HEX还是BASE64方式加密
        credentialsMatcher.setHashIterations(1024);  // 散列迭代次数*/</span>
        <span class="token comment">//如果MD5密码加密,可以打开下面配置</span>
        <span class="token comment">//加密算法的名称</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//配置加密的次数</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//是否存储为16进制</span>
        credentialsMatcher<span class="token punctuation">.</span><span class="token function">setStoredCredentialsHexEncoded</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> credentialsMatcher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 配置url过滤器</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">ShiroFilterChainDefinition</span> <span class="token function">shiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultShiroFilterChainDefinition</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultShiroFilterChainDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level1/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip1]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level2/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip2]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/level3/**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;perms[st:vip3]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">addPathDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> filter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultWebSecurityManager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span><span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> manager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 配置自定义Realm</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">UserRealm</span> <span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserRealm</span> userRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span><span class="token function">credentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userRealm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>认证和授权：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>
<span class="token comment">//    授权</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;授权........................&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SimpleAuthorizationInfo</span> authorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 角色</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 权限</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 测试用权限</span>
        <span class="token class-name">String</span> role <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        roles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        permissions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorizationInfo<span class="token punctuation">.</span><span class="token function">setStringPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//    认证</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;认证........................&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAccountException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token comment">//        MD5盐值加密ByteSource.Util.bytes(username)</span>
        <span class="token class-name">SimpleAuthenticationInfo</span> authenticationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> authenticationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>控制层判断：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/loginAuth&quot;</span><span class="token punctuation">,</span>method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginAuth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                        <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取当前用户</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 封装用户的数据</span>
    <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行登录的方法</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;welcome&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;用户名错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">PREFIX</span><span class="token operator">+</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">PREFIX</span><span class="token operator">+</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="扩展" tabindex="-1"><a class="header-anchor" href="#扩展" aria-hidden="true">#</a> 扩展：</h3><h4 id="shiro默认过滤器" tabindex="-1"><a class="header-anchor" href="#shiro默认过滤器" aria-hidden="true">#</a> shiro默认过滤器</h4><ul><li>anon AnonymousFilter 指定url可以匿名访问</li><li>authc FormAuthenticationFilter 指定url需要form表单登录，默认会从请求中获取username、password,rememberMe等参数并尝试登录，如果登录不了就会跳转到loginUrl配置的路径。我们也可以用这个过滤器做默认的登录逻辑，但是一般都是我们自己在控制器写登录逻辑的，自己写的话出错返回的信息都可以定制嘛。</li><li>authcBasic BasicHttpAuthenticationFilter 指定url需要basic登录</li><li>logout LogoutFilter 登出过滤器，配置指定url就可以实现退出功能，非常方便</li><li>noSessionCreation NoSessionCreationFilter 禁止创建会话</li><li>perms PermissionsAuthorizationFilter 需要指定权限才能访问</li><li>port PortFilter 需要指定端口才能访问</li><li>rest HttpMethodPermissionFilter 将http请求方法转化成相应的动词来构造一个权限字符串，这个感觉意义不大，有兴趣自己看源码的注释</li><li>roles RolesAuthorizationFilter 需要指定角色才能访问</li><li>ssl SslFilter 需要https请求才能访问</li><li>user UserFilter 需要已登录或“记住我”的用户才能访问</li></ul><h4 id="shiro常用的权限控制注解-可以在控制器类上使用" tabindex="-1"><a class="header-anchor" href="#shiro常用的权限控制注解-可以在控制器类上使用" aria-hidden="true">#</a> shiro常用的权限控制注解，可以在控制器类上使用</h4><ul><li>@RequiresGuest 只有游客可以访问</li><li>@RequiresAuthentication 需要登录才能访问</li><li>@RequiresUser 已登录的用户或“记住我”的用户能访问</li><li>@RequiresRoles 已登录的用户需具有指定的角色才能访问</li><li>@RequiresPermissions 已登录的用户需具有指定的权限才能访问</li></ul>`,104);function gs(bs,fs){const a=i("ExternalLinkIcon");return o(),c("div",null,[Hn,n("p",null,[s("其他数组、对象语法可以阅读："),n("a",Wn,[s("https://juejin.im/post/5c1a4a0fe51d45344a1c3d2a"),t(a)])]),Vn,n("p",null,[n("a",Un,[s("在YML/Properties能配置的属性"),t(a)])]),Jn,n("p",null,[s("去"),n("a",Xn,[s("WebJars"),t(a)]),s("以jars的方式获取静态资源 如：jquery")]),Gn,n("p",null,[s("路径是在：org\\webjars\\jquery\\3.5.1\\jquery-3.5.1.jar!\\META-INF\\resources\\webjars\\jquery\\3.5.1\\jquery.js 网页访问路径："),n("a",Yn,[s("http://localhost:8080/webjars/jquery/3.5.1/jquery.js"),t(a)])]),Kn,n("p",null,[n("strong",null,[s("网页访问路径："),n("a",Qn,[s("http://localhost:8080/asserts/js/Chart.min.js"),t(a)])])]),Zn,n("p",null,[n("a",_n,[s("文档参考：SpringMVC"),t(a)])]),$n,n("table",null,[ns,n("tbody",null,[ss,n("tr",null,[as,ts,es,n("td",null,[s("#"),n("a",ps,[s("root.method.name"),t(a)])])]),os,cs,is,ls,us,rs])]),ks,n("ul",null,[n("li",null,[s('key = "#'),n("a",ds,[s("employee.id"),t(a)]),s('"')]),n("li",null,[s('key = "#'),n("a",vs,[s("result.id"),t(a)]),s('"')])]),ms])}const hs=p(zn,[["render",gs],["__file","SpringBoot.html.vue"]]);export{hs as default};
