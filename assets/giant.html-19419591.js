import{_ as o,W as i,X as c,a0 as n,a1 as s,Z as e,$ as t,C as l}from"./framework-c8643d23.js";const r="/Computer-Science-Learn-Notes/assets/image-20220613102838011-a9e8c142.webp",u="/Computer-Science-Learn-Notes/assets/image-20220517204202792-37964441.webp",d="/Computer-Science-Learn-Notes/assets/image-20220517210109888-fc77efd8.webp",k="/Computer-Science-Learn-Notes/assets/jdk1.8ä¹‹å‰çš„å†…éƒ¨ç»“æ„-HashMap-7ea5239b.webp",m="/Computer-Science-Learn-Notes/assets/jdk1.8ä¹‹åçš„å†…éƒ¨ç»“æ„-HashMap-db1251ab.webp",g="/Computer-Science-Learn-Notes/assets/image-20220404155517228-3182375f.webp",v="/Computer-Science-Learn-Notes/assets/image-20220404155706856-a5f9f133.webp",b="/Computer-Science-Learn-Notes/assets/image-20220404154959514-7dbcf251.webp",h="/Computer-Science-Learn-Notes/assets/image-20220404155241287-ffcd32c7.webp",f="/Computer-Science-Learn-Notes/assets/image-20220404172630199-9b5e696f.webp",y="/Computer-Science-Learn-Notes/assets/image-20220404172644652-ddd171b0.webp",w="/Computer-Science-Learn-Notes/assets/image-20220404172657626-bdf1804c.webp",C="/Computer-Science-Learn-Notes/assets/image-20220404172710500-c5412a39.webp",S="/Computer-Science-Learn-Notes/assets/image-20220404172718185-1b4882b2.webp",x="/Computer-Science-Learn-Notes/assets/image-20220411184115018-2e0e31ee.webp",_="/Computer-Science-Learn-Notes/assets/image-20220614175742196-8f441035.webp",T="/Computer-Science-Learn-Notes/assets/image-20220616155057751-7a7d06ec.webp",P="/Computer-Science-Learn-Notes/assets/image-20220616155140634-ba7158ba.webp",L="/Computer-Science-Learn-Notes/assets/image-20220616155221157-d63e9121.webp",R="/Computer-Science-Learn-Notes/assets/image-20220613102732800-e35ad8de.webp",I="/Computer-Science-Learn-Notes/assets/image-20220613102739353-01449ba0.webp",A="/Computer-Science-Learn-Notes/assets/image-20220627102520442-46f9dab0.webp",N="/Computer-Science-Learn-Notes/assets/image-20220627102705221-7552a7fd.webp",M="/Computer-Science-Learn-Notes/assets/image-20220627102814208-e875a8ba.webp",E="/Computer-Science-Learn-Notes/assets/image-20220603195940545-6778e13b.webp",O="/Computer-Science-Learn-Notes/assets/image-20220603195954495-5a95bb0e.webp",B="/Computer-Science-Learn-Notes/assets/image-20220602105047295-8af8998d.webp",D="/Computer-Science-Learn-Notes/assets/1597213385700-a5ec1ccb.webp",z="/Computer-Science-Learn-Notes/assets/1597213783265-30d6d64a.webp",q="/Computer-Science-Learn-Notes/assets/image-20220430114558079-4d10de10.webp",j="/Computer-Science-Learn-Notes/assets/image-20220430115319810-ded6b829.webp",H="/Computer-Science-Learn-Notes/assets/image-20220430115715440-fd01682b.webp",F="/Computer-Science-Learn-Notes/assets/image-20220414190315596-3c83325a.webp",J="/Computer-Science-Learn-Notes/assets/image-20220414190353272-7c40d6c8.webp",U="/Computer-Science-Learn-Notes/assets/image-20220414190450946-994b8126.webp",K="/Computer-Science-Learn-Notes/assets/image-20220414190541400-c530bdec.webp",Q="/Computer-Science-Learn-Notes/assets/image-20220602105145976-45439286.webp",V="/Computer-Science-Learn-Notes/assets/image-20220602105203619-e338d91d.webp",G="/Computer-Science-Learn-Notes/assets/image-20220602105232952-4b32a458.webp",X="/Computer-Science-Learn-Notes/assets/image-20220618221951116-f4f44271.webp",W="/Computer-Science-Learn-Notes/assets/image-20220613095814545-fdd992fc.webp",Y="/Computer-Science-Learn-Notes/assets/image-20220613095822121-5558b192.webp",Z="/Computer-Science-Learn-Notes/assets/image-20220615221901423-d3aee32e.webp",$="/Computer-Science-Learn-Notes/assets/image-20220615222525633-6ace9bc8.webp",nn="/Computer-Science-Learn-Notes/assets/image-20220614222755372-40dfbb28.webp",sn="/Computer-Science-Learn-Notes/assets/image-20220618221301273-15dbf44f.webp",an="/Computer-Science-Learn-Notes/assets/image-20220618222305758-5338ef66.webp",en="/Computer-Science-Learn-Notes/assets/v2-98ad0b6c4c56cc6e1f1771d6717ff1be_r-6040dfc4.webp",tn="/Computer-Science-Learn-Notes/assets/v2-eb942305f30fc2cc4557f4a9c7fc48f8_r-06e07baf.webp",pn="/Computer-Science-Learn-Notes/assets/v2-4538a8cb2841347fbb9fc118423323fe_r-9352a66b.webp",on="/Computer-Science-Learn-Notes/assets/v2-fa4f08b5e4fc6e8478d5d84f4b89c961_r-8e15d89d.webp",cn="/Computer-Science-Learn-Notes/assets/v2-02f9aa3113546908140829fd81b5a214_r-39ba3d40.webp",ln="/Computer-Science-Learn-Notes/assets/v2-f94c4fbf49a6a4d14a00d57fe3fa8d22_r-d9fec1ec.webp",rn="/Computer-Science-Learn-Notes/assets/image-20220717152305383-7562334f.webp",un="/Computer-Science-Learn-Notes/assets/image-20220717152417214-d5727a91.webp",dn="/Computer-Science-Learn-Notes/assets/image-20220717152747462-f13c005e.webp",kn="/Computer-Science-Learn-Notes/assets/image-20220413200722639-1749cb4a.webp",mn="/Computer-Science-Learn-Notes/assets/image-20220413200736328-433e13c5.webp",gn="/Computer-Science-Learn-Notes/assets/image-20220413200753503-8a5b1da9.webp",vn="/Computer-Science-Learn-Notes/assets/image-20220413200828028-0bc9c9b2.webp",bn="/Computer-Science-Learn-Notes/assets/image-20220413200847394-cea15dc4.webp",hn="/Computer-Science-Learn-Notes/assets/image-20220413200847394-cea15dc4.webp",fn="/Computer-Science-Learn-Notes/assets/image-20220413201027769-c0939960.webp",yn="/Computer-Science-Learn-Notes/assets/image-20220618230509703-8cb44a87.webp",wn="/Computer-Science-Learn-Notes/assets/image-20220618230223383-c4937ef0.webp",Cn="/Computer-Science-Learn-Notes/assets/image-20220618230229851-a62f04bc.webp",Sn="/Computer-Science-Learn-Notes/assets/image-20220618230320793-7c047f73.webp",xn="/Computer-Science-Learn-Notes/assets/image-20220618230753821-230c2b3d.webp",_n="/Computer-Science-Learn-Notes/assets/image-20220413202257122-2fe0b76a.webp",Tn="/Computer-Science-Learn-Notes/assets/image-20220413202322292-d109e880.webp",Pn="/Computer-Science-Learn-Notes/assets/image-20220413202333112-65623216.webp",Ln="/Computer-Science-Learn-Notes/assets/image-20220404155942489-bf7700d0.webp",Rn="/Computer-Science-Learn-Notes/assets/image-20220404155949898-72e49b03.webp",In="/Computer-Science-Learn-Notes/assets/image-20220404155956076-f975d97e.webp",An="/Computer-Science-Learn-Notes/assets/image-20220413201943773-58e7ccf5.webp",Nn="/Computer-Science-Learn-Notes/assets/image-20220404202112266-233bbc0f.webp",Mn="/Computer-Science-Learn-Notes/assets/image-20220404202121152-64fec0cb.webp",En="/Computer-Science-Learn-Notes/assets/image-20220614225609663-8e3e1c25.webp",On="/Computer-Science-Learn-Notes/assets/image-20220404201525588-e5ea910e.webp",Bn="/Computer-Science-Learn-Notes/assets/image-20220404201536147-43a54a97.webp",Dn="/Computer-Science-Learn-Notes/assets/image-20220404201544332-b452c2c1.webp",zn="/Computer-Science-Learn-Notes/assets/image-20220404201554850-afadc0be.webp",qn="/Computer-Science-Learn-Notes/assets/image-20220404201603748-9bd81d1b.webp",jn="/Computer-Science-Learn-Notes/assets/image-20220404201608058-3e0107ff.webp",Hn="/Computer-Science-Learn-Notes/assets/image-20220404201755252-36e7e7bb.webp",Fn="/Computer-Science-Learn-Notes/assets/image-20220404202341804-d98927ce.webp",Jn="/Computer-Science-Learn-Notes/assets/image-20220404202354007-ff2e2dc6.webp",Un="/Computer-Science-Learn-Notes/assets/image-20220610095635066-8fe50b95.webp",Kn="/Computer-Science-Learn-Notes/assets/image-20220610095709053-64e4e33a.webp",Qn="/Computer-Science-Learn-Notes/assets/image-20220618222546298-5182d396.webp",Vn="/Computer-Science-Learn-Notes/assets/image-20220618222556764-566901a8.webp",Gn="/Computer-Science-Learn-Notes/assets/image-20220618222606838-a4e4f864.webp",Xn="/Computer-Science-Learn-Notes/assets/image-20220618222642015-d70f3ad7.webp",Wn="/Computer-Science-Learn-Notes/assets/image-20220618222700381-d424b9f3.webp",Yn="/Computer-Science-Learn-Notes/assets/image-20220614142936584-97ec3c5d.webp",Zn="data:image/webp;base64,UklGRswFAABXRUJQVlA4IMAFAACwJACdASoQAjsAPm00lkgkIqIhIVM74IANiU3fC9UHsvx4DRKfkZrbeWpwJzd/YPy7/o3z29AHiKdLfzAfql+u/vL/hX7uvQA/S/rHfQP/ZXrSv7r/0vSA1avwBpmPk8A0ydnA2cGkBpSvinPTf33lB+cP+/7iP6u/8nsN+jf+sZT18gSg3QL4fQafZAlBugXw+gd7X0dAiGqWMPt86w28Iak/fVNSQzfFn65APO1d55jIu7vwuw0SzVdL/aVOjJpZWh/tkQ7O32K+pMFKC1OVTJ1rAj4201BVab7+IHezYuO9sMod7RtSWpeFKOh/7KqHPyFFX6EVMOzHfkD3YbDhgUuNlLVqIndHNJfn4920i2DYDAWIDydkKa1CZQwa6IE/uQfGzgtpDuWl9a8R0AD+/syAAAAAAB93uEmY21fZ5esf8M06jsjQ842w55jL2G7yY1snbzYzCYduzZnuJuXkQ7kH9/YMVr5P/2OVnxJV5VYX0PZmgc6EYODQX9+sqeNXGLiCcy4fjmanMuxnGD69p+DmgqUzyvowHaNXTRyzBS/rUVgRd74LR2nh3KdMkJZNN6DkbcGHWa8xBN5m5Pb9BRMxfTog4IKHEFovhnwsEfkgE9+VGQcrQ0PjG6FFfoONRPtzOntAmu84ST8mu+h03B2L48pojjvpH24/79/vrMjhmGD4BjJBYZJSC7oPLWYxvjsClIZ7Tb0DIvIMmW8WcrxgJuFkcIoRR86pEhfXIXwGw5pJ8MZbodcraJG6batmc9uivD8ahMP+S7c6WWrTBRhcp44LdhiM2K0evY2Uwx8OlKIf+Otzz7nNurHGSnlAdz/ASP2aO91vN+e7iorMud9Kno00aS5RYQUBtHli5NG/t+Bcq7vX2V3Fcxn/N00yjlgB/ALorCYbGTxVhtdZ3Vbd4TQirlKE3obvWZI1z5ueIsXfvOEq5q3HfrW2aZNB/OMhTBjgEPHy/qjgT8w4WSZ1EYrH+SIPaMLXoTPRetbsC9fL5ut3dTGRr+e72iO1MMV8pF6fM7DfglSaKsKIBREo6cPa4rFwZ33Ra++7y7F4Y9jHYx8jMCUP1L/lPEm2hPiocyAWtoh+pc66LyTIg9aUKlw9lmwA1uDXUR69Llqjuob7xqyHlYHJXOMVVNm8bDMVWP0/lpB+ev0425LaRM5AbozCyqoVFrhOIsB73/FVHNcZ4Ij+PMlXGgxzWkTdxK/DvKTnelKe4ycvG3wSaZPWe5ZC6lCCzDrhQD+cDYrBSDz6evixQ1Tb564oDizhr8V6XMFpzNA8A/hM/mD3fIahRPtSsAdyITPUDi5stISkGsO4frnuBGnr1Q618f/BytLWndRH2EfTAuO/cKX1V8xI93nAXG1HvJFGjeYnVfzfbHMRbPKm8XTzmdlZn1sL3zW4cYdvY00cG5/CBf6U9M3WnX5mZoG/377d5ZYBINlgcEbYLKrchC+gZNTtX+lIIdw4isCpp9efMfnzytVAiZY7qhgWp1Xjw189jOMpLBQjlDXzuTXEGR2cts6ywVOuErfGULx8tuDNSXPIdk8Ygz52W44ftZkCOxdILoMh9tlgmSXCg8jgfS76x9RShe8FKJFOhxPFf1jKFb79HrwPUu6T+oggRQIuYbZ1kP0rFzC+KDkx1gUBemLMrmwukiq7ggNM2LMgyvgVhhqsk/8YxW9erqSizwlBK2fW2Zcob73cpk6RmA0EH9yTyaz87zvsWU6vOd/ehMqLUhT+28PM7UYiDSVqR3gP7erre7xoSVXzgYZk1ICk7Y3yNJi7t3VNPNH1mdswzDm4eyZwEAw5LkscYtBefpTq/jcwHba/kpjwSpYdGpeIIv8X8cNrz4mqzZtCiEum1XBXhK/CoI17MfmU+pxuyBwd4xJwAX/5Wn4Y/ItcCi7gDD3Bcoa7LRhpWHtJFSkr2U5EamVq2vPacSECbkAAAAAAAAAAAAAAAA==",$n="/Computer-Science-Learn-Notes/assets/image-20220614143012262-00c9c254.webp",ns="/Computer-Science-Learn-Notes/assets/image-20220614143018917-551a7ae8.webp",ss="/Computer-Science-Learn-Notes/assets/image-20220714102354617-3a3eef57.webp",as="/Computer-Science-Learn-Notes/assets/image-20220714102403176-195428d9.webp",es="/Computer-Science-Learn-Notes/assets/image-20220714102025861-e23b315e.webp",ts="/Computer-Science-Learn-Notes/assets/image-20220714102028966-918c15db.webp",ps="/Computer-Science-Learn-Notes/assets/image-20220714102236860-3a25f997.webp",os="/Computer-Science-Learn-Notes/assets/image-20220714102307741-2644e85f.webp",is="/Computer-Science-Learn-Notes/assets/image-20220404205106515-71b71e70.webp",cs="/Computer-Science-Learn-Notes/assets/image-20220404205121978-9ae87c38.webp",ls="/Computer-Science-Learn-Notes/assets/image-20220404205205248-b1cb797d.webp",rs="/Computer-Science-Learn-Notes/assets/image-20220404205224920-4ec74f82.webp",us="/Computer-Science-Learn-Notes/assets/image-20220404205326561-d0517202.webp",ds="/Computer-Science-Learn-Notes/assets/image-20220404205326561-d0517202.webp",ks="/Computer-Science-Learn-Notes/assets/image-20220404205423809-b74b4c3a.webp",ms="/Computer-Science-Learn-Notes/assets/image-20220404205503926-a78cc040.webp",gs="/Computer-Science-Learn-Notes/assets/1090617-20190618183025891-1248337684-186e0e59.webp",vs="/Computer-Science-Learn-Notes/assets/1090617-20190618183037704-975536201-edae6120.webp",bs="/Computer-Science-Learn-Notes/assets/1090617-20190618183046827-1994396879-4402a22e.webp",hs="/Computer-Science-Learn-Notes/assets/image-20220612134312190-d59563e7.webp",fs="/Computer-Science-Learn-Notes/assets/image-20220404124727498-5bb1a322.webp",ys="/Computer-Science-Learn-Notes/assets/image-20220404124818143-6e372a84.webp",ws="/Computer-Science-Learn-Notes/assets/image-20220404124827143-2464fc74.webp",Cs="/Computer-Science-Learn-Notes/assets/image-20220404124853946-1bf8530f.webp",Ss="/Computer-Science-Learn-Notes/assets/image-20220404124910100-4527cc14.webp",xs="/Computer-Science-Learn-Notes/assets/image-20220404124922094-36cb6a1a.webp",_s="/Computer-Science-Learn-Notes/assets/image-20220404131205113-0316efc1.webp",Ts="/Computer-Science-Learn-Notes/assets/image-20220404131213494-4f6cd32e.webp",Ps="/Computer-Science-Learn-Notes/assets/image-20220404132619617-a17bcbde.webp",Ls="/Computer-Science-Learn-Notes/assets/image-20220404132738181-1c2be671.webp",Rs="/Computer-Science-Learn-Notes/assets/image-20220404132804754-b013a8ec.webp",Is="/Computer-Science-Learn-Notes/assets/image-20220404132833298-8c484a18.webp",As="/Computer-Science-Learn-Notes/assets/image-20220404132904142-73c7f504.webp",Ns="data:image/webp;base64,UklGRlQNAABXRUJQVlA4IEgNAAAwXgCdASq4ApcAPm0yl0ckIyKhJZObiIANiWNu4W5Bp0cQ4537Rj/M7usmYoaeH8XrtSz/ehH/Z+oB/h+hJ5gP109Wb/l+o/+7dMz/wvZG/pX+x9hf+G/431rP/N7M3+ByavxB/K/yA8Kf6n+N/iG+h/sf5M8mzmP/a+g/zXe1eOP9E/KPzd9DvqBepP7z9rXpc/uXar5V/jPQC9dPjf9z/N/zQ/4D0A+rP+H9Vf9F/z35hfEX+A/xnjT/O/9B7Av8n/r3/E+5n6Vf27/j/3X/I/s97a/nX/ue4T/P/6X/0OwB+63sd/uWZY2g0V0iKxfa57FFLfg47QaK6RFYvtc9iiQDEyIJpK9RfxNOZzIxYtsdFxzIgmkr1F/E05nPY98oXxKd5zU3fHdeh4dKF8SwGcC0opNgZJsDrx59D+Wg24e/iq7eBgmyAAZ2woI4v8JlEoaVLfg47QaK59FamMXtrUMLNkdu8ZYj+QW7uALPZlpZkaBJc658msoELTbpgWdKqAQVBgEK0aR0b69rqW46jttmLGoC7uS7Z+aemBrf9vLnDJ7ilI79VQT0KvIheqQgHyTx5cnXkkMxcelmPBpp5t9PpmcoDpxRqIBetksMvn1UMqVe5Xx23BuKFVggvHgpkQHv83nIXXnMFr16bqZaDHwaaXQJCVQFs5t9Pk7NT39pp1aMI6ehUEqMO8ZByImh9Kxb5Up2Sl2yYzCPu00vr5MXG/Uy+5LAc7bNb7GgAbyUISXQlpgvlnKfpgQGG7lKP8jsud6C9f/odO2DKVa8f2LLEVaQz9AsSc2tsly1TytbH9A8vBzJFmnUugSAUiAwo+/4IIxJuKuKgMmjMAe2ksK+A50wjaUVl98O11L+tc5Uc81R67zf43NC0wSdq8Ay+gHm4wgcrWJ4LiAE5nPY96Nhwbs1/ccAG5JUTUKZz2PfKF8RHh8C0wPpEgwtZdoJFz/Nex75QviWAoWC/w4VukRWL7XPYopb8HHaDRXSIrF9rnsUUt+DjSAA/v7rQAAAAABZvc93T50xJb/RRRJ/gjutDkfQZQ5lS3pJ9Am1dkAg6Mysdj+cPYF4KtOqHf/94W59e70Ad5dPw9cciTvWq4kNAFesqaD/RRRJ/gjutDkfQZQ5lS3pJ9Am1dkAg6Mysdj+cPYF4KtOqqn8XE5v/dY/Ii+iQq4zmYDFe5Y+HarLtVHoWNBYsHPd3XLMdcDY/nuiZi7mNiYsL3/IOu5knjyoCYlHfxtBG3/+1yCSpodihPWsqo5F99K2pvuJtl7IHwipNHjCA7tYrIgxVKUQs1uXmWNJUG+QyJ1bDJlrfugrWsE+kaMzmpqIssFBMKxMVrTxn1mIrgdfVUYsYpFgRgUM0PauH76mjcGco09ujTr85/SNCJzSe+SiYsJauYKCyvlGk/c3upkf1MNtbHCiEx5+K6zvEQsbZ9SxyWhx0OT3Pn6/cj35C5eQXkBE9f4wescHWZLOoZOE0Rw3mup3BNhmzg6MlmkBwv8t3YKROFyNMkVot02WQLFqkG3spaE6EcnqkijEasTgxo51uBGayQ7X2VcT8s6f/1NL9TGjn0h9ITFCiKeH8KNWQ+/TJfX5a9Iyq8iWA+vBzb+7W1RQMwj60U8I8ib3Z5G8DDKx6R38hEdCQaXMZCg+dbF2seuzUXEcWg1OHAAAAApVBQ3WdxlvEZki43Si4Mz1Slnk6ieJGCpRmoAi3/ndBqTPPIExpu/+eMCCIjYm9f2dMAKDT5E38QrG4k7g+8f/Y/MIq81hrpZAWP1+wIAUn+BXAMGD4Dpg8j+uPuG60TtQ90aLi6MzpC5EnYyosOWf/G7yDHtSPvI60J3z2+OJJFRpZpW2ID9/cP5bSKvAmznZNgERGl6NOlijRzcF+hgb0Q0S5NZLMnCKbLjA6gny4ez5afAYTshgUra4nJvBB0H+SaD+w0cj3PMXkLAltRhYxSK4HK8ueZuAy2QtvwudkZfEHWqepe0PgM97uPgYZqi1aKN8B0NMcPgS6uaS9M+fM0IeVP9Swjr1+kD2xP31fe6Shq8t8azFKHzhPv6AurV6HiusdeVfYdIaYD6L+UGor3iRhQN0kGkKCmcASUP7/gD9bDBwhMdiI3NEY1WznrwCmTdLcVUsMd4vBZVr9kWY4MOVm1mAfza3oxwGuTe7blvyfLWU9BtdzLvuh13dKJ8UnA3oXVhVn/GWiLovOkzPUIeLkY0WDBUAdDpS62iT4+qZQA8slzhtEz56k9Rr5XW3oLpYX28l7y9D2N2R0tJE2d896jfvmqNCwY8HvDUq0ttu1DqOgmSZXZ639BfE6UbzkHiyvwttnvFaG+TwnRbgJ3qzs2k/tYqzshefwwSzeS3nxa61hcBU10dYEf91fJsOpPBM+7b8WfgwGxE1t7QPw654HhBSPeq+YyDxnflZVf37+ZGGtN2LB/aBAWmDV8wAk0IuUftSKnXokOVRaoOqaz3R6hrPhIcbOUz/cVrhVc/2+0NyZPTXlVKMS6xiyV5A1o16engM1zg5gsBr6r1/8g/AaNKgW/jPdnViKt0tyga2wZIdaphb68xhPhFGTwGxZ9JK4W0b+0Y9nYEbKImUB/plgjHiFqnSUhE6MCMsl+6qOmlh1dUJhnL4WG8KFjBTNUTM4jVuyIF9qpoOTvzPGSsON6/QEvwoXjwgICbesrf74dIaOu0VMSZZs/Pmh6j+LNeBoUgdegueaB40UjA+rex+Sj8gv22/Oi+FHhT8Q1J5H3E5bGffmRpPCibV+BkXI2c2ijnqD3QngF1GYe7e+qSoWBI4rTXoCbo3znkloZmZGKeYzZEbLts4HOk4FbszIvz7OBMgWP1gRohdblKs7GaX4SwAsJq7tdnn1hHag/bN+LWMWk7jqx56j1ndxKvkAQeKb3LVyvFamCdCDOMyX1zhqwPYqZ5dlOvUf0QL/HH5DfbjAqX2cDTUn+AeOcUh48GB9Oi5zmIxO6QjUs9brlx8op3h3cPDS6ka3luO0gzWSPheG1nIc9y6gMJEgJ2UHLf9Vf+Jf6d+u7owQmAX2NMFFxV0PzYAValCUuvkHh7pY+266mfQZFP/LNXkB3Y5QEao94OIlSL33GICCMQVBcSyVvWvYBZTxfbQWydYeBAGZg8i/dCxQPCkmn7cmxOmA/PwbJ23nz0A2P5EIFYoIV5IV7Y7GLIEHfgCgltL4SAAs7aDpYsFGdjeTEoYcQgE9ozMK60tmSW9lv9qVE9cbEk+hpUO0+mI/u5eCZud6Aqo9eHAxs39I/Ypn5ig38o8LTcfSjC34qqFCTvGRC0QgC6iedkM4EEv5yuraB/sX3FbxMDJSyynlKcBhqi8b6FWoSNrx9P4HMLZ5xI+lKQxPfSGepG7kfoBO4J9GTA/748hCUjpPJ202F90jXBA1IWNwnpCZ2S+j3ZZyJ1vsb/Gns5q/fZQ5xyDNU+TCE/ejvDCHWH13FURLr3wKLdgvGIaRIqd4rsBm0VpR13szK1R/2uS//z9OscDRp649JCOv1jsLbH7FEj45r+t8V3WvzznBCbrnoictRigwv28cNmyN/1eWhS/zr6e/H/kh09QQM/aKi9nhDZCVE7O+i8bCFeDQcKjciur/tx+GkVZSCyC8deaI+PXAfIcx8/6iOXRJP9YsiIaBcBPcwJ/4HRw/T39+vvgIRtMO4iCrVFe0YhXeDeCmvR3hhDxh2ETorvX2ElzimMaC0LYAh4ieHMR4OB+UMO5BRmLv/rUZh/7kVircnU2aGYuMTU//R+Hh7VBmE6zxc53kNnBlovVFqy3NnmJqf/o/Dw9qgzCOwOYo8Xf2SEk8vNE1KrkVl+GsvLf5VjT8Q/bNcSR8uoFr+rw0UC7iayT+/J8haCtu2ZaMB2+t1lzYg1v8/+k3RFWaDWB2uykaC/S1w6xE8Woa5h31NKmTgYxe1TiygFsHjwh5HDtrCvJ7dennLlE3k5o46ZS/3DxnVW1NFl8APSFambX91s8iFZy4qalBNFMo4vY4fO2mI1TNUsxdyxxIBkhP2V2Yta450hg4PEmGuQN8WVVXpA9joFDx5eFMzgIFJ41GvNG3Zc0IOfH0wctiTRbgir8lmGaQeRmizvZs1jjSpd2wwB7uudhE+FJP5dnJ1axLVePB8FFTQuhJMABI5HCKCSnwp+Ec7c/hczc/LDs0fof2YvN9pQ0s4/2UiQMoJZvmfBt9YEHfn8I2h3Cevp4V4/CTaK19hlod0GaOAqw/acNzLYghS17MP5IX/C0BmwDGO6Gw1vhbP4P/EiA4wSgvTRXyq3PeaQnh8Zibbd3ExmJA+UJBUq9jwFTDqL3Q2VhKkcyC9Rv+DxL4blDHEYOgAXg11o96O61FF+HOq5sNsSADWDv2Dg/S9KEtIejfeHLjCWUWRMj0BN1HwdmV7I2oovw51XNhtiQAawd+wcH6XpQlpD19m/jPexyiW9MAMy1leQMdXkQpQx7TgZv6xmHsm2ICbuAMuYdeOmqs7NQxkQFcEDxFOOTegJdX/ZAsosioFVu/IHhkdcAAAAAAAAA",Ms="/Computer-Science-Learn-Notes/assets/image-20220404132956262-dde0c048.webp",Es="/Computer-Science-Learn-Notes/assets/image-20220404133007326-10cbf292.webp",Os="/Computer-Science-Learn-Notes/assets/image-20220404131943705-c616f059.webp",Bs="/Computer-Science-Learn-Notes/assets/image-20220404131957890-9708805f.webp",Ds="/Computer-Science-Learn-Notes/assets/image-20220404125754531-c452a3b1.webp",zs="/Computer-Science-Learn-Notes/assets/image-20220404131009734-725fff4e.webp",qs="/Computer-Science-Learn-Notes/assets/image-20220613101500219-09ba936e.webp",js="/Computer-Science-Learn-Notes/assets/image-20220613101750929-759be886.webp",Hs="/Computer-Science-Learn-Notes/assets/image-20220613101819752-e8621a51.webp",Fs="/Computer-Science-Learn-Notes/assets/image-20220613101934371-60692a61.webp",Js="/Computer-Science-Learn-Notes/assets/image-20220613101941132-ab15f80e.webp",Us="/Computer-Science-Learn-Notes/assets/image-20220613101950349-93d47a22.webp",Ks="/Computer-Science-Learn-Notes/assets/image-20220613102027079-4ffccfa1.webp",Qs="/Computer-Science-Learn-Notes/assets/image-20220613102027079-4ffccfa1.webp",Vs="/Computer-Science-Learn-Notes/assets/image-20220717151007781-826ce464.webp",Gs="/Computer-Science-Learn-Notes/assets/image-20220717151014970-113a3e29.webp",Xs="/Computer-Science-Learn-Notes/assets/image-20220717151021020-00338c61.webp",Ws="/Computer-Science-Learn-Notes/assets/image-20220717151028612-9d69b8f7.webp",Ys="/Computer-Science-Learn-Notes/assets/image-20220613100825505-082d4258.webp",Zs="/Computer-Science-Learn-Notes/assets/image-20220613100842261-94b4c200.webp",$s="/Computer-Science-Learn-Notes/assets/image-20220613100912699-fbdfaec7.webp",na="/Computer-Science-Learn-Notes/assets/image-20220613100927156-a2eb76db.webp",sa="/Computer-Science-Learn-Notes/assets/image-20220405202743331-414755fb.webp",aa="/Computer-Science-Learn-Notes/assets/image-20220405202828582-94f93bdc.webp",ea="/Computer-Science-Learn-Notes/assets/image-20220405202846995-ae765d91.webp",ta="/Computer-Science-Learn-Notes/assets/image-20220405202857835-c8235712.webp",pa="/Computer-Science-Learn-Notes/assets/image-20220405202647832-fcf431d6.webp",oa="/Computer-Science-Learn-Notes/assets/image-20220405202602054-c8d333bc.webp",ia="/Computer-Science-Learn-Notes/assets/image-20220405202610223-e0d1b563.webp",ca="/Computer-Science-Learn-Notes/assets/image-20220717151708558-70ea1f88.webp",la="/Computer-Science-Learn-Notes/assets/image-20220517212306882-767cd723.webp",ra="/Computer-Science-Learn-Notes/assets/image-20220613102319669-104f74b3.webp",ua="/Computer-Science-Learn-Notes/assets/image-20220613102612771-e78eb5b7.webp",da="/Computer-Science-Learn-Notes/assets/image-20220613102619845-43cf39d1.webp",ka="/Computer-Science-Learn-Notes/assets/image-20220627104731025-92dacff0.webp",ma="/Computer-Science-Learn-Notes/assets/image-20220627104743508-2d32f774.webp",ga="/Computer-Science-Learn-Notes/assets/image-20220618222110248-025b04e9.webp",va="/Computer-Science-Learn-Notes/assets/image-20220618222136120-75e06806.webp",ba="/Computer-Science-Learn-Notes/assets/image-20220618222201604-3758fcd2.webp",ha="/Computer-Science-Learn-Notes/assets/image-20220618222223377-bc073b9a.webp",fa="/Computer-Science-Learn-Notes/assets/image-20220404173153591-08b10439.webp",ya="/Computer-Science-Learn-Notes/assets/image-20220404173240800-a57c4d2f.webp",wa="/Computer-Science-Learn-Notes/assets/image-20220607144016086-7747b77c.webp",Ca="/Computer-Science-Learn-Notes/assets/image-20220607144024751-739c82ce.webp",Sa="/Computer-Science-Learn-Notes/assets/image-20220618221642375-537f9828.webp",xa="/Computer-Science-Learn-Notes/assets/image-20220727205646242-5c2129d9.webp",_a="/Computer-Science-Learn-Notes/assets/image-20220727224105269-2f83e1c4.webp",Ta="/Computer-Science-Learn-Notes/assets/image-20220727224111385-4b370459.webp",Pa="/Computer-Science-Learn-Notes/assets/image-20220727224117545-ffb86f6d.webp",La="/Computer-Science-Learn-Notes/assets/image-20220727224120760-ebb5f99b.webp",Ra="/Computer-Science-Learn-Notes/assets/2020-05-29-15906831530375-random-access-memory-7c1fdb6c.webp",Ia="/Computer-Science-Learn-Notes/assets/2020-05-29-15906831530398-four-level-page-tables-81847f75.webp",Aa="/Computer-Science-Learn-Notes/assets/2020-05-29-15906831530405-memory-utilization-2d682cca.webp",Na="/Computer-Science-Learn-Notes/assets/image-20220404171544021-b2f3a011.webp",Ma="/Computer-Science-Learn-Notes/assets/image-20220404171424811-007c7c48.webp",Ea="/Computer-Science-Learn-Notes/assets/image-20220404171434074-c156a5f6.webp",Oa="/Computer-Science-Learn-Notes/assets/image-20220404171446235-55075e5b.webp",Ba="/Computer-Science-Learn-Notes/assets/image-20220606202244867-2e68f8bf.webp",Da="/Computer-Science-Learn-Notes/assets/image-20220606203824170-62490e8d.webp",za="/Computer-Science-Learn-Notes/assets/image-20220606203831080-884cde42.webp",qa="/Computer-Science-Learn-Notes/assets/image-20220404172009498-2bcc59b1.webp",ja="/Computer-Science-Learn-Notes/assets/image-20220404172035072-56d8b7f5.webp",p="/Computer-Science-Learn-Notes/assets/image-20220404172044696-5bd694b4.webp",Ha="/Computer-Science-Learn-Notes/assets/image-20220622170005400-92c17a06.webp",Fa="/Computer-Science-Learn-Notes/assets/image-20220405203700321-7ee269bd.webp",Ja="/Computer-Science-Learn-Notes/assets/image-20220606204018346-14e429a1.webp",Ua="/Computer-Science-Learn-Notes/assets/image-20220606204134384-e0dc68b7.webp",Ka="/Computer-Science-Learn-Notes/assets/image-20220606204140948-b98a3490.webp",Qa="/Computer-Science-Learn-Notes/assets/image-20220606204212582-433c3558.webp",Va="/Computer-Science-Learn-Notes/assets/image-20220606204221063-7bc1377c.webp",Ga="/Computer-Science-Learn-Notes/assets/image-20220606204229061-2fbe3358.webp",Xa="/Computer-Science-Learn-Notes/assets/image-20220606204236323-939890c0.webp",Wa="/Computer-Science-Learn-Notes/assets/image-20220606204247237-2418df00.webp",Ya="/Computer-Science-Learn-Notes/assets/image-20220606204255302-cfa2e70b.webp",Za="/Computer-Science-Learn-Notes/assets/image-20220606204316378-625b8a3e.webp",$a="/Computer-Science-Learn-Notes/assets/image-20220606204411787-1192cdb1.webp",ne="/Computer-Science-Learn-Notes/assets/image-20220606204418891-4784424b.webp",se="/Computer-Science-Learn-Notes/assets/image-20220606204425586-56d02666.webp",ae="/Computer-Science-Learn-Notes/assets/image-20220606204437905-d792f30c.webp",ee="/Computer-Science-Learn-Notes/assets/image-20220606204518089-ffd0f4ed.webp",te="/Computer-Science-Learn-Notes/assets/image-20220606204530377-36a9ca33.webp",pe="/Computer-Science-Learn-Notes/assets/image-20220606204629174-f2ef5c4f.webp",oe="/Computer-Science-Learn-Notes/assets/image-20220606204646339-d6e9968c.webp",ie="/Computer-Science-Learn-Notes/assets/image-20220606204654767-55c8eab1.webp",ce="/Computer-Science-Learn-Notes/assets/image-20220606204710119-5612113c.webp",le="/Computer-Science-Learn-Notes/assets/image-20220607142829952-807fa119.webp",re="/Computer-Science-Learn-Notes/assets/image-20220607143304815-ebec37ed.webp",ue="/Computer-Science-Learn-Notes/assets/image-20220607142735506-2d698b7b.webp",de="/Computer-Science-Learn-Notes/assets/image-20220405200858423-e16b5a8c.webp",ke="/Computer-Science-Learn-Notes/assets/image-20220405200926547-083dcc5f.webp",me="/Computer-Science-Learn-Notes/assets/image-20220405200945067-1c87feca.webp",ge="/Computer-Science-Learn-Notes/assets/image-20220405201020933-abb58c90.webp",ve="/Computer-Science-Learn-Notes/assets/image-20220405202121578-91011cb0.webp",be="/Computer-Science-Learn-Notes/assets/image-20220411180808761-2089f002.webp",he="/Computer-Science-Learn-Notes/assets/image-20220405203101620-0756ecde.webp",fe="/Computer-Science-Learn-Notes/assets/image-20220413195638289-956d23c5.webp",ye="/Computer-Science-Learn-Notes/assets/image-20220413195646340-1e7c9188.webp",we="/Computer-Science-Learn-Notes/assets/image-20220717144735430-4ab17c37.webp",Ce="/Computer-Science-Learn-Notes/assets/image-20220717150335032-44235253.webp",Se="/Computer-Science-Learn-Notes/assets/image-20220717150345746-68e17f9b.webp",xe="/Computer-Science-Learn-Notes/assets/image-20220727220128549-a65dec69.webp",_e="/Computer-Science-Learn-Notes/assets/image-20220727220131425-06b2a244.webp",Te="/Computer-Science-Learn-Notes/assets/image-20220727213947423-73d9d794.webp",Pe="/Computer-Science-Learn-Notes/assets/image-20220827111050845-fc3e46f4.webp",Le="/Computer-Science-Learn-Notes/assets/image-20220827111109255-3bdf38be.webp",Re="/Computer-Science-Learn-Notes/assets/image-20220827110512850-c4e5f1aa.webp",Ie="/Computer-Science-Learn-Notes/assets/image-20220827110523321-8393b5ef.webp",Ae="/Computer-Science-Learn-Notes/assets/a49a6bb8cd38ae1738d9c00aec68b444-b8b1fdad.webp",Ne="/Computer-Science-Learn-Notes/assets/image-20220618221719773-f2de5dc4.webp",Me="/Computer-Science-Learn-Notes/assets/image-20220718141022014-d2a5ec33.webp",Ee="/Computer-Science-Learn-Notes/assets/image-20220727223840133-9a81716a.webp",Oe="/Computer-Science-Learn-Notes/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhbmdndW9zYg___size_16_color_FFFFFF_t_70-d25c8ee3.webp",Be="/Computer-Science-Learn-Notes/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhbmdndW9zYg___size_16_color_FFFFFF_t_70-166168653604411-d3edeeee.webp",De="/Computer-Science-Learn-Notes/assets/604386b709b90bf917091116-41c1c366.webp",ze="/Computer-Science-Learn-Notes/assets/image-20220405113827690-e6cb552f.webp",qe="/Computer-Science-Learn-Notes/assets/image-20220405113843485-809bf1cc.webp",je="/Computer-Science-Learn-Notes/assets/604386d109f9e9bd18341217-df99973c.webp",He="/Computer-Science-Learn-Notes/assets/604386f709dc22db18401234-2d89d285.webp",Fe="/Computer-Science-Learn-Notes/assets/60444358094e9b7216340760-87454696.webp",Je="/Computer-Science-Learn-Notes/assets/6044436f0995834018051026-6d2d151e.webp",Ue="/Computer-Science-Learn-Notes/assets/60444385099c283408310195-74c79d8c.webp",Ke="/Computer-Science-Learn-Notes/assets/6044439a0982319007390083-ad639752.webp",Qe="/Computer-Science-Learn-Notes/assets/image-20220405151704557-1477b87b.webp",Ve="/Computer-Science-Learn-Notes/assets/759200-20160806092734215-279978821-32caa852.webp",Ge={},Xe=n("h2",{id:"ğŸ¤å…«è‚¡æ–‡ç»éªŒ-é¢ç»ç²¾é€‰",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ğŸ¤å…«è‚¡æ–‡ç»éªŒ-é¢ç»ç²¾é€‰","aria-hidden":"true"},"#"),s(" ğŸ¤å…«è‚¡æ–‡ç»éªŒ&é¢ç»ç²¾é€‰")],-1),We={href:"https://leetcode-cn.com/circle/discuss/2Ypo9Z/",target:"_blank",rel:"noopener noreferrer"},Ye={href:"https://leetcode-cn.com/circle/discuss/jq9Zke/",target:"_blank",rel:"noopener noreferrer"},Ze={href:"https://leetcode.cn/circle/discuss/h1JhXf/",target:"_blank",rel:"noopener noreferrer"},$e={href:"https://www.nowcoder.com/discuss/987725",target:"_blank",rel:"noopener noreferrer"},nt={href:"https://leetcode.cn/circle/discuss/xdOrsL/",target:"_blank",rel:"noopener noreferrer"},st=t('<h2 id="ğŸ¦java-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#ğŸ¦java-åŸºç¡€" aria-hidden="true">#</a> ğŸ¦Java åŸºç¡€</h2><h3 id="linkedlistå’Œarraylistçš„åŒºåˆ«-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#linkedlistå’Œarraylistçš„åŒºåˆ«-2022é£ä¹¦" aria-hidden="true">#</a> LinkedListå’ŒArrayListçš„åŒºåˆ« (2022é£ä¹¦)</h3><ol><li><strong>æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</strong> <code>ArrayList</code> å’Œ <code>LinkedList</code> éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</li><li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> <code>Arraylist</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong><code>Object</code> æ•°ç»„</strong>ï¼›<code>LinkedList</code> åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong>åŒå‘é“¾è¡¨</strong> æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰</li><li><strong>æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š</strong> â‘  <strong><code>ArrayList</code> é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚</strong> æ¯”å¦‚ï¼šæ‰§è¡Œ <code>add(E e)</code>æ–¹æ³•çš„æ—¶å€™ï¼Œ <code>ArrayList</code> ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼‰æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n-i)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½/å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚ â‘¡ <strong><code>LinkedList</code> é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹äº <code>add(E e)</code>æ–¹æ³•çš„æ’å…¥ï¼Œåˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼Œè¿‘ä¼¼ O(1)ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½® <code>i</code>æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>(add(int index, E element)</code>ï¼‰ æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ä¸º <code>o(n))</code>å› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥ã€‚</strong></li><li><strong>æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š</strong> <code>LinkedList</code> ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ <code>ArrayList</code> æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äº <code>get(int index)</code>æ–¹æ³•)ã€‚</li><li><strong>å†…å­˜ç©ºé—´å ç”¨ï¼š</strong> <code>ArrayList</code> çš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ <code>LinkedList</code> çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” <code>ArrayList</code> æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</li></ol><h3 id="æ‰€æœ‰å¼‚å¸¸çš„å…±åŒçš„ç¥–å…ˆæ˜¯-è¿è¡Œæ—¶å¼‚å¸¸æœ‰å“ªå‡ ä¸ª" tabindex="-1"><a class="header-anchor" href="#æ‰€æœ‰å¼‚å¸¸çš„å…±åŒçš„ç¥–å…ˆæ˜¯-è¿è¡Œæ—¶å¼‚å¸¸æœ‰å“ªå‡ ä¸ª" aria-hidden="true">#</a> æ‰€æœ‰å¼‚å¸¸çš„å…±åŒçš„ç¥–å…ˆæ˜¯ï¼Ÿè¿è¡Œæ—¶å¼‚å¸¸æœ‰å“ªå‡ ä¸ªï¼Ÿ</h3><figure><img src="'+r+'" alt="image-20220613102838011" tabindex="0" loading="lazy"><figcaption>image-20220613102838011</figcaption></figure><p>Java å¼‚å¸¸çš„é¡¶å±‚çˆ¶ç±»æ˜¯ <code>Throwable</code>ï¼Œå®ƒç”Ÿäº†ä¸¤ä¸ªå„¿å­ï¼Œå¤§å„¿å­å« <code>Error</code>,äºŒå„¿å­å« <code>Exception</code>ã€‚</p><ul><li><strong>Error</strong>ï¼šæ˜¯ç¨‹åºâ½†æ³•å¤„ç†çš„é”™è¯¯ï¼Œä¸€èˆ¬è¡¨ç¤ºç³»ç»Ÿé”™è¯¯ï¼Œä¾‹å¦‚è™šæ‹Ÿæœºç›¸å…³çš„é”™è¯¯ <code>OutOfMemoryError</code></li><li><strong>Exception</strong>ï¼šç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚å®ƒå¯ä»¥åˆ†ä¸ºRuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’ŒCheckedExceptionï¼ˆå¯æ£€æŸ¥çš„å¼‚å¸¸ï¼‰ã€‚</li></ul><p><strong>ä»€ä¹ˆæ˜¯RuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰</strong>ï¼Ÿ</p><p><code>è¿è¡Œæ—¶å¼‚å¸¸æ˜¯ä¸æ£€æŸ¥å¼‚å¸¸ï¼Œç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚</code></p><p>å¸¸è§çš„<strong>RuntimeExceptionå¼‚å¸¸</strong>ï¼š</p><ul><li>NullPointerExceptionï¼šç©ºæŒ‡é’ˆå¼‚å¸¸</li><li>ArithmeticExceptionï¼šå‡ºç°å¼‚å¸¸çš„è¿ç®—æ¡ä»¶æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸</li><li>IndexOutOfBoundsExceptionï¼šæ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸</li><li>ClassNotFoundExceptionï¼šæ‰¾ä¸åˆ°ç±»å¼‚å¸¸</li><li>IllegalArgumentException(éæ³•å‚æ•°å¼‚å¸¸)</li></ul><p>ä»€ä¹ˆæ˜¯<strong>CheckedExceptionï¼ˆå¯æ£€æŸ¥çš„å¼‚å¸¸ï¼‰</strong>ï¼Ÿ</p><p><code>ä»ç¨‹åºè¯­æ³•è§’åº¦è®²æ˜¯å¿…é¡»è¿›è¡Œå¤„ç†çš„å¼‚å¸¸ï¼Œå¦‚æœä¸å¤„ç†ï¼Œç¨‹åºå°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚å¦‚IOExceptionã€SQLExceptionç­‰ã€‚</code></p><p><strong>å¸¸è§çš„ Checked Exception å¼‚å¸¸ï¼š</strong></p><ul><li>IOExceptionï¼š(æ“ä½œè¾“å…¥æµå’Œè¾“å‡ºæµæ—¶å¯èƒ½å‡ºç°çš„å¼‚å¸¸)</li><li>SQLException</li></ul><h3 id="åŠ¨æ€ä»£ç†äº†è§£å—-è¯´ä¸€ä¸‹åŸç†" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ€ä»£ç†äº†è§£å—-è¯´ä¸€ä¸‹åŸç†" aria-hidden="true">#</a> åŠ¨æ€ä»£ç†äº†è§£å—ï¼Ÿè¯´ä¸€ä¸‹åŸç†ï¼Ÿ</h3><ol><li>ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ</li></ol><p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½ç†è§£çš„è®¾è®¡æ¨¡å¼ã€‚ç®€å•æ¥è¯´å°±æ˜¯ <strong>æˆ‘ä»¬ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥ä»£æ›¿å¯¹çœŸå®å¯¹è±¡(real object)çš„è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸç›®æ ‡å¯¹è±¡çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚</strong></p><p><strong>ä»£ç†æ¨¡å¼çš„ä¸»è¦ä½œç”¨æ˜¯æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´åœ¨ç›®æ ‡å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ‰§è¡Œå‰åä½ å¯ä»¥å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼šä½ æ‰¾äº†å°çº¢æ¥å¸®ä½ é—®è¯ï¼Œå°çº¢å°±å¯ä»¥çœ‹ä½œæ˜¯ä»£ç†ä½ çš„ä»£ç†å¯¹è±¡ï¼Œä»£ç†çš„è¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰æ˜¯é—®è¯ã€‚</p><figure><img src="'+u+'" alt="image-20220517204202792" tabindex="0" loading="lazy"><figcaption>image-20220517204202792</figcaption></figure><ol start="2"><li>é™æ€ä»£ç†</li></ol><p><strong>é™æ€ä»£ç†ä¸­ï¼Œæˆ‘ä»¬å¯¹ç›®æ ‡å¯¹è±¡çš„æ¯ä¸ªæ–¹æ³•çš„å¢å¼ºéƒ½æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼Œéå¸¸ä¸çµæ´»ï¼ˆ*æ¯”å¦‚æ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹*ï¼‰ä¸”éº»çƒ¦(*éœ€è¦å¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬å†™ä¸€ä¸ªä»£ç†ç±»*)ã€‚</strong> å®é™…åº”ç”¨åœºæ™¯éå¸¸éå¸¸å°‘ï¼Œæ—¥å¸¸å¼€å‘å‡ ä¹çœ‹ä¸åˆ°ä½¿ç”¨é™æ€ä»£ç†çš„åœºæ™¯ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬æ˜¯ä»å®ç°å’Œåº”ç”¨è§’åº¦æ¥è¯´çš„é™æ€ä»£ç†ï¼Œä» JVM å±‚é¢æ¥è¯´ï¼Œ <strong>é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚</strong></p><p>é™æ€ä»£ç†å®ç°æ­¥éª¤:</p><ol><li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li><li>åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ ·å®ç°è¿™ä¸ªæ¥å£</li><li>å°†ç›®æ ‡å¯¹è±¡æ³¨å…¥è¿›ä»£ç†ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»çš„å¯¹åº”æ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†ç±»å±è”½å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚</li><li>åŠ¨æ€ä»£ç†</li></ol><p>ç›¸æ¯”äºé™æ€ä»£ç†æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ã€‚æˆ‘ä»¬ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦æˆ‘ä»¬å¿…é¡»å®ç°æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»( <em>CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶</em>)ã€‚</p><p><strong>ä» JVM è§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</strong></p><p>è¯´åˆ°åŠ¨æ€ä»£ç†ï¼ŒSpring AOPã€RPC æ¡†æ¶åº”è¯¥æ˜¯ä¸¤ä¸ªä¸å¾—ä¸æçš„ï¼Œå®ƒä»¬çš„å®ç°éƒ½ä¾èµ–äº†åŠ¨æ€ä»£ç†ã€‚</p><p><strong>åŠ¨æ€ä»£ç†åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯åœ¨æ¡†æ¶ä¸­çš„å‡ ä¹æ˜¯å¿…ç”¨çš„ä¸€é—¨æŠ€æœ¯ã€‚å­¦ä¼šäº†åŠ¨æ€ä»£ç†ä¹‹åï¼Œå¯¹äºæˆ‘ä»¬ç†è§£å’Œå­¦ä¹ å„ç§æ¡†æ¶çš„åŸç†ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚</strong></p><p>å°± Java æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ <strong>JDK åŠ¨æ€ä»£ç†</strong>ã€<strong>CGLIB åŠ¨æ€ä»£ç†</strong>ç­‰ç­‰ã€‚</p><figure><img src="'+d+`" alt="image-20220517210109888" tabindex="0" loading="lazy"><figcaption>image-20220517210109888</figcaption></figure><p>3.1 æœºåˆ¶ä»‹ç»</p><p><strong>åœ¨ Java åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ <code>InvocationHandler</code> æ¥å£å’Œ <code>Proxy</code> ç±»æ˜¯æ ¸å¿ƒã€‚</strong></p><p>å½“éœ€è¦åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡æ—¶ï¼Œç¨‹åºé€šè¿‡Proxyç±»çš„é™æ€æ–¹æ³•newProxyInstance()æ¥åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªç±»åŠ è½½å™¨ã€ä¸€ç»„æ¥å£ä»¥åŠä¸€ä¸ªInvocationHandlerå¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span>
                                          <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">,</span>
                                          <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ³•ä¸€å…±æœ‰ 3 ä¸ªå‚æ•°ï¼š</p><ol><li><strong>loader</strong> :ç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†å¯¹è±¡ã€‚</li><li><strong>interfaces</strong> : è¢«ä»£ç†ç±»å®ç°çš„ä¸€äº›æ¥å£ï¼›</li><li><strong>h</strong> : å®ç°äº† <code>InvocationHandler</code> æ¥å£çš„å¯¹è±¡ï¼›</li></ol><p>ä»£ç†å¯¹è±¡å®ç°äº†è¿™äº›æ¥å£ï¼Œå¹¶å°†æ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨å§”æ‰˜ç»™InvocationHandlerå¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</p><p>è¦å®ç°åŠ¨æ€ä»£ç†çš„è¯ï¼Œè¿˜å¿…é¡»éœ€è¦å®ç° <code>InvocationHandler</code> æ¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚ å½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘åˆ°å®ç° <code>InvocationHandler</code> æ¥å£ç±»çš„ <code>invoke</code> æ–¹æ³•æ¥è°ƒç”¨ã€‚ åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ã€æ£€æŸ¥æƒé™ã€ä¿®æ”¹å‚æ•°ç­‰ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ä»£ç†å¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å½“ä½ ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•çš„æ—¶å€™å®é™…ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>invoke()</code> æ–¹æ³•æœ‰ä¸‹é¢ä¸‰ä¸ªå‚æ•°ï¼š</p><ol><li><strong>proxy</strong> :åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»</li><li><strong>method</strong> : ä¸ä»£ç†ç±»å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ç›¸å¯¹åº”</li><li><strong>args</strong> : å½“å‰ method æ–¹æ³•çš„å‚æ•°</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>ä½ é€šè¿‡ <code>Proxy</code> ç±»çš„ <code>newProxyInstance()</code> åˆ›å»ºçš„ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…ä¼šè°ƒç”¨åˆ°å®ç° <code>InvocationHandler</code> æ¥å£çš„ç±»çš„ <code>invoke()</code>æ–¹æ³•ã€‚</strong> ä½ å¯ä»¥åœ¨ <code>invoke()</code> æ–¹æ³•ä¸­è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚åœ¨æ–¹æ³•æ‰§è¡Œå‰ååšä»€ä¹ˆäº‹æƒ…</p><p>3.2 åŠ¨æ€ä»£ç†ä½¿ç”¨æ­¥éª¤</p><ol><li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li><li>è‡ªå®šä¹‰ <code>InvocationHandler</code> å¹¶é‡å†™ <code>invoke</code>æ–¹æ³•ï¼Œåœ¨ <code>invoke</code> æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘ï¼›</li><li>é€šè¿‡ <code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</code> æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡</li></ol><p><strong>1.å®šä¹‰å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmsService</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SmsService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;send message:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3.å®šä¹‰ä¸€ä¸ª JDK åŠ¨æ€ä»£ç†ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> shuang.kou
 * <span class="token keyword">@createTime</span> 2020å¹´05æœˆ11æ—¥ 11:23:00
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DebugInvocationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DebugInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before method &quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after method &quot;</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>invoke()</code> æ–¹æ³•: å½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨åŸç”Ÿæ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆå®é™…ä¸Šè°ƒç”¨åˆ°çš„æ˜¯ <code>invoke()</code> æ–¹æ³•ï¼Œç„¶å <code>invoke()</code> æ–¹æ³•ä»£æ›¿æˆ‘ä»¬å»è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„åŸç”Ÿæ–¹æ³•ã€‚</p><h3 id="è®²è®²-hashmap-åº•å±‚åŸç†æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è®²è®²-hashmap-åº•å±‚åŸç†æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> è®²è®² hashmapï¼Œåº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><strong>JDK1.8 ä¹‹å‰</strong></p><p>JDK1.8 ä¹‹å‰ HashMap åº•å±‚æ˜¯ <strong>æ•°ç»„å’Œé“¾è¡¨</strong> ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ä¹Ÿå°±æ˜¯ é“¾è¡¨æ•£åˆ—ã€‚HashMap é€šè¿‡ key çš„ hashCode ç»è¿‡æ‰°åŠ¨å‡½æ•°å¤„ç†è¿‡åå¾—åˆ° hash å€¼ï¼Œç„¶åé€šè¿‡ (n - 1) &amp; hash åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾çš„ä½ç½®ï¼ˆè¿™é‡Œçš„ n æŒ‡çš„æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´ çš„è¯ï¼Œå°±åˆ¤æ–­è¯¥å…ƒç´ ä¸è¦å­˜å…¥çš„å…ƒç´ çš„ hash å€¼ä»¥åŠ key æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒçš„è¯ï¼Œç›´æ¥è¦†ç›–ï¼Œ<em>ä¸ç›¸åŒå°±é€šè¿‡æ‹‰é“¾æ³•è§£å†³å†²çª</em>ã€‚</p><p>æ‰€è°“æ‰°åŠ¨å‡½æ•°æŒ‡çš„å°±æ˜¯ HashMap çš„ hash æ–¹æ³•ã€‚ä½¿ç”¨ hash æ–¹æ³•ä¹Ÿå°±æ˜¯æ‰°åŠ¨å‡½æ•°æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å®ç°æ¯”è¾ƒå·®çš„ hashCode() æ–¹æ³• æ¢å¥è¯è¯´ä½¿ç”¨æ‰°åŠ¨å‡½æ•°ä¹‹åå¯ä»¥å‡å°‘ç¢°æ’ã€‚</p><p>JDK 1.8 HashMap çš„ hash æ–¹æ³•æºç :</p><p>JDK 1.8 çš„ hash æ–¹æ³• ç›¸æ¯”äº JDK 1.7 hash æ–¹æ³•æ›´åŠ ç®€åŒ–ï¼Œä½†æ˜¯åŸç†ä¸å˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> h<span class="token punctuation">;</span>
      <span class="token comment">// key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode</span>
      <span class="token comment">// ^ ï¼šæŒ‰ä½å¼‚æˆ–</span>
      <span class="token comment">// &gt;&gt;&gt;:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹æ¯”ä¸€ä¸‹ JDK1.7 çš„ HashMap çš„ hash æ–¹æ³•æºç .</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This function ensures that hashCodes that differ only by</span>
    <span class="token comment">// constant multiples at each bit position have a bounded</span>
    <span class="token comment">// number of collisions (approximately 8 at default load factor).</span>

    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸æ¯”äº JDK1.8 çš„ hash æ–¹æ³• ï¼ŒJDK 1.7 çš„ hash æ–¹æ³•çš„æ€§èƒ½ä¼šç¨å·®ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæ‰°åŠ¨äº† 4 æ¬¡ã€‚</p><p>æ‰€è°“ <strong>â€œæ‹‰é“¾æ³•â€</strong> å°±æ˜¯ï¼šå°†é“¾è¡¨å’Œæ•°ç»„ç›¸ç»“åˆã€‚ä¹Ÿå°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€æ ¼å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è‹¥é‡åˆ°å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­å³å¯ã€‚</p><figure><img src="`+k+'" alt="jdk1.8ä¹‹å‰çš„å†…éƒ¨ç»“æ„-HashMap" tabindex="0" loading="lazy"><figcaption>jdk1.8ä¹‹å‰çš„å†…éƒ¨ç»“æ„-HashMap</figcaption></figure><p><strong>JDK1.8 ä¹‹å</strong></p><p>ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ JDK1.8 ä¹‹ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</p><figure><img src="'+m+`" alt="jdk1.8ä¹‹åçš„å†…éƒ¨ç»“æ„-HashMap" tabindex="0" loading="lazy"><figcaption>jdk1.8ä¹‹åçš„å†…éƒ¨ç»“æ„-HashMap</figcaption></figure><p>TreeMapã€TreeSet ä»¥åŠ JDK1.8 ä¹‹åçš„ HashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘å°±æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç¼ºé™·ï¼Œå› ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€åŒ–æˆä¸€ä¸ªçº¿æ€§ç»“æ„ã€‚</p><h3 id="stringbuilder-æœ‰ç”¨è¿‡å—-stringbuilder-å’Œ-stringbuffer-ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#stringbuilder-æœ‰ç”¨è¿‡å—-stringbuilder-å’Œ-stringbuffer-ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> stringbuilder æœ‰ç”¨è¿‡å—ï¼Ÿstringbuilder å’Œ stringbuffer ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>å¯å˜æ€§</p><p><code>String</code> æ˜¯ä¸å¯å˜çš„ï¼ˆåé¢ä¼šè¯¦ç»†åˆ†æåŸå› ï¼‰ã€‚</p><p><code>StringBuilder</code> ä¸ <code>StringBuffer</code> éƒ½ç»§æ‰¿è‡ª <code>AbstractStringBuilder</code> ç±»ï¼Œåœ¨ <code>AbstractStringBuilder</code> ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¸è¿‡æ²¡æœ‰ä½¿ç”¨ <code>final</code> å’Œ <code>private</code> å…³é”®å­—ä¿®é¥°ï¼Œæœ€å…³é”®çš„æ˜¯è¿™ä¸ª <code>AbstractStringBuilder</code> ç±»è¿˜æä¾›äº†å¾ˆå¤šä¿®æ”¹å­—ç¬¦ä¸²çš„æ–¹æ³•æ¯”å¦‚ <code>append</code> æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractStringBuilder</span> <span class="token keyword">implements</span> <span class="token class-name">Appendable</span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">AbstractStringBuilder</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token function">appendNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>count <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        str<span class="token punctuation">.</span><span class="token function">getChars</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> value<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count <span class="token operator">+=</span> len<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€é‡è¦ã€‘çº¿ç¨‹å®‰å…¨æ€§</strong></p><p><code>String</code> ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œçº¿ç¨‹å®‰å…¨ã€‚<code>AbstractStringBuilder</code> æ˜¯ <code>StringBuilder</code> ä¸ <code>StringBuffer</code> çš„å…¬å…±çˆ¶ç±»ï¼Œå®šä¹‰äº†ä¸€äº›å­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ <code>expandCapacity</code>ã€<code>append</code>ã€<code>insert</code>ã€<code>indexOf</code> ç­‰å…¬å…±æ–¹æ³•ã€‚<code>StringBuffer</code> å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<code>StringBuilder</code> å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>å°ç»“ï¼š</p><ul><li>String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥</li></ul><p><strong>æ€§èƒ½</strong></p><p>æ¯æ¬¡å¯¹ <code>String</code> ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ <code>String</code> å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ <code>String</code> å¯¹è±¡ã€‚<code>StringBuffer</code> æ¯æ¬¡éƒ½ä¼šå¯¹ <code>StringBuffer</code> å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨ <code>StringBuilder</code> ç›¸æ¯”ä½¿ç”¨ <code>StringBuffer</code> ä»…èƒ½è·å¾— 10%~15% å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†å´è¦å†’å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©ã€‚</p><p><strong>å¯¹äºä¸‰è€…ä½¿ç”¨çš„æ€»ç»“ï¼š</strong></p><ol><li>æ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ <code>String</code></li><li>å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ <code>StringBuilder</code></li><li>å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ <code>StringBuffer</code></li></ol><h3 id="stringbuilder-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨-åº•å±‚åŸç†æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#stringbuilder-ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨-åº•å±‚åŸç†æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> stringbuilder ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿåº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><code>StringBuilder</code> å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”</p><p>ä»¥StringBufferä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°åº•å±‚åŠ å…¥äº†åŒæ­¥é”</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€ŒStringBuilderåˆ™æ²¡æœ‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Returns the length (character count).
     *
     * <span class="token keyword">@return</span>  the length of the sequence of characters currently
     *          represented by this object
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Returns the current capacity. The capacity is the amount of storage
     * available for newly inserted characters, beyond which an allocation
     * will occur.
     *
     * <span class="token keyword">@return</span>  the current capacity
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åº•å±‚åŸç†ï¼š</p><p>StringBuilderæ— å‚æ„é€ æ–¹æ³•é»˜è®¤åœ¨å †ä¸­åˆ›å»º16ä¸ªé•¿åº¦çš„char[ ]æ•°ç»„ï¼Œè°ƒç”¨çš„æ˜¯çˆ¶ç±»AbstractStringBuilderçš„æ„é€ æ–¹æ³•ï¼ŒStringBuilderçš„æœ‰å‚æ„é€ æ–¹æ³•åœ¨å †ä¸­åˆ›å»ºå‚æ•°çš„é•¿åº¦+16çš„char[ ]æ•°ç»„ï¼Œæ·»åŠ çš„å­—ç¬¦ä¸²ä¾æ¬¡ä»char[]æ•°ç»„å‰é¢ä¸ºç©ºçš„ä½ç½®å­˜å…¥ã€‚å½“å†æ¬¡æ·»åŠ çš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡åˆ›å»ºçš„char[ ]æ•°ç»„é•¿åº¦,å°±ä¼šè¿›è¡Œæ‰©å®¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Constructs a string builder with no characters in it and an
     * initial capacity of 16 characters.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Constructs a string builder with no characters in it and an
     * initial capacity specified by the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">capacity</span></span><span class="token punctuation">}</span> argument.
     *
     * <span class="token keyword">@param</span>      <span class="token parameter">capacity</span>  the initial capacity.
     * <span class="token keyword">@throws</span>     <span class="token reference"><span class="token class-name">NegativeArraySizeException</span></span>  if the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">capacity</span></span><span class="token punctuation">}</span>
     *               argument is less than <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token number">0</span></span></span><span class="token punctuation">}</span>.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Constructs a string builder initialized to the contents of the
     * specified string. The initial capacity of the string builder is
     * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token number">16</span></span></span><span class="token punctuation">}</span> plus the length of the string argument.
     *
     * <span class="token keyword">@param</span>   <span class="token parameter">str</span>   the initial contents of the buffer.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰©å®¹æœºåˆ¶ï¼š</p><p>å½“è¦æ·»åŠ çš„å­—ç¬¦ä¸²å¤§äº &gt; å½“å‰å­—ç¬¦æ•°ç»„çš„é•¿åº¦çš„æ—¶å€™æ‰©å®¹ï¼Œæ‰©å®¹æ˜¯ï¼š åŸæ¥é•¿åº¦*2+2 çš„æ–¹å¼æ‰©å®¹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Returns a capacity at least as large as the given minimum capacity.
     * Returns the current capacity increased by the same amount + 2 if
     * that suffices.
     * Will not return a capacity greater than <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token constant">MAX_ARRAY_SIZE</span></span></span><span class="token punctuation">}</span>
     * unless the given minimum capacity is greater than that.
     *
     * <span class="token keyword">@param</span>  <span class="token parameter">minCapacity</span> the desired minimum capacity
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">OutOfMemoryError</span></span> if minCapacity is less than zero or
     *         greater than Integer.MAX_VALUE
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">newCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// overflow-conscious code</span>
        <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token constant">MAX_ARRAY_SIZE</span> <span class="token operator">-</span> newCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span>
            <span class="token operator">:</span> newCapacity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«-å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«-å·¥ä½œåŸç†" aria-hidden="true">#</a> æ·±æ‹·è´å’Œæµ…æ‹·è´åŒºåˆ«ï¼Œå·¥ä½œåŸç†</h3><ol><li>æµ…æ‹·è´ï¼šå¯¹å¼•ç”¨æ•°æ®ç±»å‹è¿›è¡Œå¼•ç”¨ä¼ é€’èˆ¬çš„æ‹·è´ï¼Œæ­¤ä¸ºæµ…æ‹·è´ã€‚</li><li>æ·±æ‹·è´ï¼šå¯¹åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œå€¼ä¼ é€’ï¼Œå¯¹å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å¤åˆ¶å…¶å†…å®¹ï¼Œæ­¤ä¸ºæ·±æ‹·è´ã€‚</li></ol><p>æ·±æ‹·è´çš„å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè·å–ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p><p>æµ…æ‹·è´çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ä»¬è¿™é‡Œå®ç°äº† <code>Cloneable</code> æ¥å£ï¼Œå¹¶é‡å†™äº† <code>clone()</code> æ–¹æ³•ã€‚</p><p><code>clone()</code> æ–¹æ³•çš„å®ç°å¾ˆç®€å•ï¼Œç›´æ¥è°ƒç”¨çš„æ˜¯çˆ¶ç±» <code>Object</code> çš„ <code>clone()</code> æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// çœç•¥æ„é€ å‡½æ•°ã€Getter&amp;Setteræ–¹æ³•</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Address</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>
    <span class="token comment">// çœç•¥æ„é€ å‡½æ•°ã€Getter&amp;Setteræ–¹æ³•</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> person<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ·±æ‹·è´</strong></p><p>è¿™é‡Œæˆ‘ä»¬ç®€å•å¯¹ <code>Person</code> ç±»çš„ <code>clone()</code> æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œè¿å¸¦ç€è¦æŠŠ <code>Person</code> å¯¹è±¡å†…éƒ¨çš„ <code>Address</code> å¯¹è±¡ä¸€èµ·å¤åˆ¶ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> person<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+g+'" alt="image-20220404155517228" tabindex="0" loading="lazy"><figcaption>image-20220404155517228</figcaption></figure><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µ-æ–¹å¼-ä¾‹å­-2022ç¾å›¢" tabindex="-1"><a class="header-anchor" href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µ-æ–¹å¼-ä¾‹å­-2022ç¾å›¢" aria-hidden="true">#</a> åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µï¼Œæ–¹å¼ï¼Œä¾‹å­ï¼ˆ2022ç¾å›¢ï¼‰</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦æŒä¹…åŒ– Java å¯¹è±¡æ¯”å¦‚å°† Java å¯¹è±¡ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨ç½‘ç»œä¼ è¾“ Java å¯¹è±¡ï¼Œè¿™äº›åœºæ™¯éƒ½éœ€è¦ç”¨åˆ°åºåˆ—åŒ–ã€‚</p><p>ç®€å•æ¥è¯´ï¼š</p><ul><li><strong>åºåˆ—åŒ–</strong>ï¼š å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹</li><li><strong>ååºåˆ—åŒ–</strong>ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹</li></ul><p>å¯¹äº Java è¿™ç§é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œæˆ‘ä»¬åºåˆ—åŒ–çš„éƒ½æ˜¯å¯¹è±¡ï¼ˆObjectï¼‰ä¹Ÿå°±æ˜¯å®ä¾‹åŒ–åçš„ç±»(Class)ï¼Œä½†æ˜¯åœ¨ C++è¿™ç§åŠé¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œstruct(ç»“æ„ä½“)å®šä¹‰çš„æ˜¯æ•°æ®ç»“æ„ç±»å‹ï¼Œè€Œ class å¯¹åº”çš„æ˜¯å¯¹è±¡ç±»å‹ã€‚</p><p>ç»´åŸºç™¾ç§‘æ˜¯å¦‚æ˜¯ä»‹ç»åºåˆ—åŒ–çš„ï¼š</p><blockquote><p><strong>åºåˆ—åŒ–</strong>ï¼ˆserializationï¼‰åœ¨è®¡ç®—æœºç§‘å­¦çš„æ•°æ®å¤„ç†ä¸­ï¼Œæ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯å–ç”¨æ ¼å¼ï¼ˆä¾‹å¦‚å­˜æˆæ–‡ä»¶ï¼Œå­˜äºç¼“å†²ï¼Œæˆ–ç»ç”±ç½‘ç»œä¸­å‘é€ï¼‰ï¼Œä»¥ç•™å¾…åç»­åœ¨ç›¸åŒæˆ–å¦ä¸€å°è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œèƒ½æ¢å¤åŸå…ˆçŠ¶æ€çš„è¿‡ç¨‹ã€‚ä¾ç…§åºåˆ—åŒ–æ ¼å¼é‡æ–°è·å–å­—èŠ‚çš„ç»“æœæ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥äº§ç”Ÿä¸åŸå§‹å¯¹è±¡ç›¸åŒè¯­ä¹‰çš„å‰¯æœ¬ã€‚å¯¹äºè®¸å¤šå¯¹è±¡ï¼Œåƒæ˜¯ä½¿ç”¨å¤§é‡å¼•ç”¨çš„å¤æ‚å¯¹è±¡ï¼Œè¿™ç§åºåˆ—åŒ–é‡å»ºçš„è¿‡ç¨‹å¹¶ä¸å®¹æ˜“ã€‚é¢å‘å¯¹è±¡ä¸­çš„å¯¹è±¡åºåˆ—åŒ–ï¼Œå¹¶ä¸æ¦‚æ‹¬ä¹‹å‰åŸå§‹å¯¹è±¡æ‰€å…³ç³»çš„å‡½æ•°ã€‚è¿™ç§è¿‡ç¨‹ä¹Ÿç§°ä¸ºå¯¹è±¡ç¼–ç»„ï¼ˆmarshallingï¼‰ã€‚ä»ä¸€ç³»åˆ—å­—èŠ‚æå–æ•°æ®ç»“æ„çš„åå‘æ“ä½œï¼Œæ˜¯ååºåˆ—åŒ–ï¼ˆä¹Ÿç§°ä¸ºè§£ç¼–ç»„ã€deserializationã€unmarshallingï¼‰ã€‚</p></blockquote><p>ç»¼ä¸Šï¼š<strong>åºåˆ—åŒ–çš„ä¸»è¦ç›®çš„æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“å¯¹è±¡æˆ–è€…è¯´æ˜¯å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€å†…å­˜ä¸­ã€‚</strong></p><figure><img src="'+v+`" alt="image-20220404155706856" tabindex="0" loading="lazy"><figcaption>image-20220404155706856</figcaption></figure><p>ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/*
     * ä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡ï¼Œè¿™ç§æ–¹å¼å…¶å®æ˜¯æ ¹æ®æ—¢æœ‰çš„å¯¹è±¡è¿›è¡Œå¤åˆ¶ï¼Œè¿™ä¸ªéœ€è¦äº‹å…ˆå°†å¯åºåˆ—åŒ–çš„å¯¹è±¡çº¿å­˜åˆ°æ–‡ä»¶é‡Œ
     */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Worker</span> <span class="token function">createWorker4</span><span class="token punctuation">(</span><span class="token class-name">String</span> objectPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ObjectInput</span> input <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Worker</span> worker <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>objectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        worker <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Worker</span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> worker<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
     * å°†åˆ›å»ºçš„å¯¹è±¡å­˜å…¥åˆ°æ–‡ä»¶å†…
     */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">storeObject2File</span><span class="token punctuation">(</span><span class="token class-name">String</span> objectPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Worker</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ObjectOutputStream</span> objectOutputStream<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>
            objectPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO Auto-generated catch block</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO Auto-generated catch block</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¼‚å¸¸åˆ†ç±»-å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«-è‡ªå®šä¹‰å¼‚å¸¸ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¼‚å¸¸åˆ†ç±»-å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«-è‡ªå®šä¹‰å¼‚å¸¸ä¼˜ç‚¹" aria-hidden="true">#</a> å¼‚å¸¸åˆ†ç±»ï¼Œå—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸åŒºåˆ«ï¼Œè‡ªå®šä¹‰å¼‚å¸¸ä¼˜ç‚¹</h3><p>Java å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾ï¼š</p><figure><img src="`+b+'" alt="image-20220404154959514" tabindex="0" loading="lazy"><figcaption>image-20220404154959514</figcaption></figure><p>ç¨‹åºæœ¬èº«å¯ä»¥æ•è·å¹¶ä¸”å¯ä»¥å¤„ç†çš„å¼‚å¸¸ã€‚Exception è¿™ç§å¼‚å¸¸åˆåˆ†ä¸ºä¸¤ç±»ï¼šè¿è¡Œæ—¶å¼‚å¸¸å’Œç¼–è¯‘æ—¶å¼‚å¸¸ã€‚</p><ul><li><strong>è¿è¡Œæ—¶å¼‚å¸¸</strong></li></ul><p>éƒ½æ˜¯ RuntimeException ç±»åŠå…¶å­ç±»å¼‚å¸¸ï¼Œå¦‚ NullPointerException(ç©ºæŒ‡é’ˆå¼‚å¸¸)ã€IndexOutOfBoundsException(ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸)ç­‰ï¼Œè¿™äº›å¼‚å¸¸æ˜¯ä¸æ£€æŸ¥å¼‚å¸¸ï¼Œç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚è¿™äº›å¼‚å¸¸ä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚</p><p>è¿è¡Œæ—¶å¼‚å¸¸çš„ç‰¹ç‚¹æ˜¯ Java ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¨‹åºä¸­å¯èƒ½å‡ºç°è¿™ç±»å¼‚å¸¸ï¼Œå³ä½¿æ²¡æœ‰ç”¨ try-catch è¯­å¥æ•è·å®ƒï¼Œä¹Ÿæ²¡æœ‰ç”¨ throws å­å¥å£°æ˜æŠ›å‡ºå®ƒï¼Œä¹Ÿä¼šç¼–è¯‘é€šè¿‡ã€‚</p><ul><li><strong>éè¿è¡Œæ—¶å¼‚å¸¸</strong> ï¼ˆç¼–è¯‘å¼‚å¸¸ï¼‰</li></ul><p>æ˜¯ RuntimeException ä»¥å¤–çš„å¼‚å¸¸ï¼Œç±»å‹ä¸Šéƒ½å±äº Exception ç±»åŠå…¶å­ç±»ã€‚ä»ç¨‹åºè¯­æ³•è§’åº¦è®²æ˜¯å¿…é¡»è¿›è¡Œå¤„ç†çš„å¼‚å¸¸ï¼Œå¦‚æœä¸å¤„ç†ï¼Œç¨‹åºå°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚å¦‚ IOExceptionã€SQLException ç­‰ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰çš„ Exception å¼‚å¸¸ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸è‡ªå®šä¹‰æ£€æŸ¥å¼‚å¸¸ã€‚</p><p>å—æ£€å¼‚å¸¸ ï¼šéœ€è¦ç”¨ try...catch... è¯­å¥æ•è·å¹¶è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥ä»å¼‚å¸¸ä¸­æ¢å¤ï¼›</p><p>éå—æ£€å¼‚å¸¸ ï¼šæ˜¯ç¨‹åºè¿è¡Œæ—¶é”™è¯¯ï¼Œä¾‹å¦‚é™¤ 0 ä¼šå¼•å‘ Arithmetic Exceptionï¼Œæ­¤æ—¶ç¨‹åºå´©æºƒå¹¶ä¸”æ— æ³•æ¢å¤</p><h3 id="æœ‰æ²¡æœ‰ç”¨è¿‡è‡ªå®šä¹‰å¼‚å¸¸-å£°æ˜å¼å¼‚å¸¸å·¥ä½œæµç¨‹-å’Œ-return-åŒºåˆ«-é¡¹ç›®ä¸­è‡ªå®šä¹‰å¼‚å¸¸å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#æœ‰æ²¡æœ‰ç”¨è¿‡è‡ªå®šä¹‰å¼‚å¸¸-å£°æ˜å¼å¼‚å¸¸å·¥ä½œæµç¨‹-å’Œ-return-åŒºåˆ«-é¡¹ç›®ä¸­è‡ªå®šä¹‰å¼‚å¸¸å·¥ä½œæµç¨‹" aria-hidden="true">#</a> æœ‰æ²¡æœ‰ç”¨è¿‡è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå£°æ˜å¼å¼‚å¸¸å·¥ä½œæµç¨‹ï¼Œå’Œ return åŒºåˆ«ï¼Œé¡¹ç›®ä¸­è‡ªå®šä¹‰å¼‚å¸¸å·¥ä½œæµç¨‹</h3><p>ç”¨è¿‡</p><p>é¡¹ç›®ä¸­è‡ªå®šä¹‰å¼‚å¸¸å·¥ä½œæµç¨‹ï¼š</p><ol><li>æ–°å»ºå¼‚å¸¸ç±»ï¼Œå¯ä»¥ç»§æ‰¿Exceptionç±»ï¼Œæˆ–è€…ç»§æ‰¿RuntimeException</li><li>å®šä¹‰codeå’Œmessageå‚æ•°ï¼Œä»¥ä¾¿è°ƒç”¨æ—¶ä¼ å…¥å¯¹åº”çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</li><li>ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸</li></ol><p><strong>throwæŒ‡æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä»¥åŠè°ƒç”¨è¯¥æ–¹æ³•çš„ä¸€åˆ‡æ–¹æ³•å°†ä¸ä¼šå‘ä¸‹æ‰§è¡Œã€‚</strong></p><p><em><strong>returnçš„ä½œç”¨å¾ˆç®€å•ï¼Œæ„æ€æ˜¯æ–¹æ³•ç›´æ¥è¿”å›äº†ï¼Œè¯¥æ–¹æ³•ä¸åœ¨å‘ä¸‹æ‰§è¡Œã€‚ä½†æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„æ–¹æ³•ç»§ç»­æ‰§è¡Œã€‚</strong></em></p><p>Java ä¸­çš„å¼‚å¸¸å¤„ç†é™¤äº†åŒ…æ‹¬æ•è·å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬å£°æ˜å¼‚å¸¸å’Œæ‹‹å‡ºå¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ throws å…³é”®å­—åœ¨æ–¹æ³•ä¸Šå£°æ˜è¯¥æ–¹æ³•è¦æ‹‹å‡ºçš„å¼‚å¸¸ï¼Œç„¶ååœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ throw æ‹‹å‡ºå¼‚å¸¸å¯¹è±¡</p><h3 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ-ä»€ä¹ˆæ—¶å€™å›æ”¶" tabindex="-1"><a class="header-anchor" href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ-ä»€ä¹ˆæ—¶å€™å›æ”¶" aria-hidden="true">#</a> ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»€ä¹ˆæ—¶å€™å›æ”¶</h3><p>å…¶ä¸­ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬äº† <code>åŠ è½½</code>ã€<code>éªŒè¯</code>ã€<code>å‡†å¤‡</code>ã€<code>è§£æ</code>ã€<code>åˆå§‹åŒ–</code>äº”ä¸ªé˜¶æ®µã€‚åœ¨è¿™äº”ä¸ªé˜¶æ®µä¸­ï¼Œ<code>åŠ è½½</code>ã€<code>éªŒè¯</code>ã€<code>å‡†å¤‡</code>å’Œ <code>åˆå§‹åŒ–</code>è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œ<em>è€Œ <code>è§£æ</code>é˜¶æ®µåˆ™ä¸ä¸€å®šï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒ Java è¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®š(ä¹Ÿç§°ä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®š)</em>ã€‚å¦å¤–æ³¨æ„è¿™é‡Œçš„å‡ ä¸ªé˜¶æ®µæ˜¯æŒ‰é¡ºåºå¼€å§‹ï¼Œè€Œä¸æ˜¯æŒ‰é¡ºåºè¿›è¡Œæˆ–å®Œæˆï¼Œå› ä¸ºè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œçš„ï¼Œé€šå¸¸åœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨æˆ–æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><figure><img src="'+h+'" alt="image-20220404155241287" tabindex="0" loading="lazy"><figcaption>image-20220404155241287</figcaption></figure><p><strong>Java è™šæ‹Ÿæœºå°†ç»“æŸç”Ÿå‘½å‘¨æœŸçš„å‡ ç§æƒ…å†µ</strong></p><ul><li>æ‰§è¡Œäº† System.exit()æ–¹æ³•</li><li>ç¨‹åºæ­£å¸¸æ‰§è¡Œç»“æŸ</li><li>ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢</li><li>ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´ Java è™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢</li></ul><h3 id="nio-å’Œ-aio" tabindex="-1"><a class="header-anchor" href="#nio-å’Œ-aio" aria-hidden="true">#</a> NIO å’Œ AIO</h3><p><strong>NIO (Non-blocking/New I/O)</strong></p><hr><p>Java ä¸­çš„ NIO äº Java 1.4 ä¸­å¼•å…¥ï¼Œå¯¹åº” <code>java.nio</code> åŒ…ï¼Œæä¾›äº† <code>Channel</code> , <code>Selector</code>ï¼Œ<code>Buffer</code> ç­‰æŠ½è±¡ã€‚NIO ä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ˜¯æ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO ã€‚</p><p>Java ä¸­çš„ NIO å¯ä»¥çœ‹ä½œæ˜¯ <strong>I/O å¤šè·¯å¤ç”¨æ¨¡å‹</strong>ã€‚ä¹Ÿæœ‰å¾ˆå¤šäººè®¤ä¸ºï¼ŒJava ä¸­çš„ NIO å±äºåŒæ­¥éé˜»å¡ IO æ¨¡å‹ã€‚</p><p>è·Ÿç€æˆ‘çš„æ€è·¯å¾€ä¸‹çœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¼šå¾—åˆ°ç­”æ¡ˆï¼</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <strong>åŒæ­¥éé˜»å¡ IO æ¨¡å‹</strong>ã€‚</p><figure><img src="'+f+'" alt="image-20220404172630199" tabindex="0" loading="lazy"><figcaption>image-20220404172630199</figcaption></figure><p>åŒæ­¥éé˜»å¡ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¼šä¸€ç›´å‘èµ· read è°ƒç”¨ï¼Œç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„è¿™æ®µæ—¶é—´é‡Œï¼Œçº¿ç¨‹ä¾ç„¶æ˜¯é˜»å¡çš„ï¼Œç›´åˆ°åœ¨å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><p>ç›¸æ¯”äºåŒæ­¥é˜»å¡ IO æ¨¡å‹ï¼ŒåŒæ­¥éé˜»å¡ IO æ¨¡å‹ç¡®å®æœ‰äº†å¾ˆå¤§æ”¹è¿›ã€‚é€šè¿‡è½®è¯¢æ“ä½œï¼Œé¿å…äº†ä¸€ç›´é˜»å¡ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§ IO æ¨¡å‹åŒæ ·å­˜åœ¨é—®é¢˜ï¼š<strong>åº”ç”¨ç¨‹åºä¸æ–­è¿›è¡Œ I/O ç³»ç»Ÿè°ƒç”¨è½®è¯¢æ•°æ®æ˜¯å¦å·²ç»å‡†å¤‡å¥½çš„è¿‡ç¨‹æ˜¯ååˆ†æ¶ˆè€— CPU èµ„æºçš„ã€‚</strong></p><p>è¿™ä¸ªæ—¶å€™ï¼Œ<strong>I/O å¤šè·¯å¤ç”¨æ¨¡å‹</strong> å°±ä¸Šåœºäº†ã€‚</p><figure><img src="'+y+'" alt="image-20220404172644652" tabindex="0" loading="lazy"><figcaption>image-20220404172644652</figcaption></figure><p>IO å¤šè·¯å¤ç”¨æ¨¡å‹ä¸­ï¼Œçº¿ç¨‹é¦–å…ˆå‘èµ· select è°ƒç”¨ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œç­‰å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ· read è°ƒç”¨ã€‚read è°ƒç”¨çš„è¿‡ç¨‹ï¼ˆæ•°æ®ä»å†…æ ¸ç©ºé—´ -&gt; ç”¨æˆ·ç©ºé—´ï¼‰è¿˜æ˜¯é˜»å¡çš„ã€‚</p><blockquote><p>ç›®å‰æ”¯æŒ IO å¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæœ‰ selectï¼Œepoll ç­‰ç­‰ã€‚select ç³»ç»Ÿè°ƒç”¨ï¼Œç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æœ‰æ”¯æŒã€‚</p><ul><li><strong>select è°ƒç”¨</strong> ï¼šå†…æ ¸æä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæ”¯æŒä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªç³»ç»Ÿè°ƒç”¨çš„å¯ç”¨çŠ¶æ€ã€‚å‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒã€‚</li><li><strong>epoll è°ƒç”¨</strong> ï¼šlinux 2.6 å†…æ ¸ï¼Œå±äº select è°ƒç”¨çš„å¢å¼ºç‰ˆæœ¬ï¼Œä¼˜åŒ–äº† IO çš„æ‰§è¡Œæ•ˆç‡ã€‚</li></ul></blockquote><p><strong>IO å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œé€šè¿‡å‡å°‘æ— æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘äº†å¯¹ CPU èµ„æºçš„æ¶ˆè€—ã€‚</strong></p><p>Java ä¸­çš„ NIO ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„<strong>é€‰æ‹©å™¨ ( Selector )</strong> çš„æ¦‚å¿µï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸º <strong>å¤šè·¯å¤ç”¨å™¨</strong>ã€‚é€šè¿‡å®ƒï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹ä¾¿å¯ä»¥ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æ•°æ®åˆ°äº†ä¹‹åï¼Œæ‰ä¼šä¸ºå…¶æœåŠ¡ã€‚</p><figure><img src="'+w+'" alt="image-20220404172657626" tabindex="0" loading="lazy"><figcaption>image-20220404172657626</figcaption></figure><p><strong>AIO</strong></p><hr><p>AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥ IO æ¨¡å‹ã€‚</p><p>å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p><figure><img src="'+C+'" alt="image-20220404172710500" tabindex="0" loading="lazy"><figcaption>image-20220404172710500</figcaption></figure><p>ç›®å‰æ¥è¯´ AIO çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¹¿æ³›ã€‚Netty ä¹‹å‰ä¹Ÿå°è¯•ä½¿ç”¨è¿‡ AIOï¼Œä¸è¿‡åˆæ”¾å¼ƒäº†ã€‚è¿™æ˜¯å› ä¸ºï¼ŒNetty ä½¿ç”¨äº† AIO ä¹‹åï¼Œåœ¨ Linux ç³»ç»Ÿä¸Šçš„æ€§èƒ½å¹¶æ²¡æœ‰å¤šå°‘æå‡ã€‚</p><p>æœ€åï¼Œæ¥ä¸€å¼ å›¾ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ Java ä¸­çš„ BIOã€NIOã€AIOã€‚</p><figure><img src="'+S+'" alt="image-20220404172718185" tabindex="0" loading="lazy"><figcaption>image-20220404172718185</figcaption></figure><h3 id="java-å¤šæ€æ¦‚å¿µ-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#java-å¤šæ€æ¦‚å¿µ-å®ç°åŸç†" aria-hidden="true">#</a> Java å¤šæ€æ¦‚å¿µï¼Œå®ç°åŸç†</h3><p>å¤šæ€åˆ†ä¸ºç¼–è¯‘æ—¶å¤šæ€å’Œè¿è¡Œæ—¶å¤šæ€:</p><ul><li>ç¼–è¯‘æ—¶å¤šæ€ä¸»è¦æŒ‡æ–¹æ³•çš„é‡è½½</li><li>è¿è¡Œæ—¶å¤šæ€æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¯¹è±¡å¼•ç”¨æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹åœ¨è¿è¡ŒæœŸé—´æ‰ç¡®å®š</li></ul><p>è¿è¡Œæ—¶å¤šæ€æœ‰ä¸‰ä¸ªæ¡ä»¶:</p><ul><li>ç»§æ‰¿</li><li>è¦†ç›–(é‡å†™)</li><li>å‘ä¸Šè½¬å‹</li></ul><p>Javaä¸­çš„å¤šæ€ï¼ˆPolymorphismï¼‰æ˜¯æŒ‡åŒä¸€ä¸ªæ–¹æ³•åœ¨ä¸åŒæƒ…å†µä¸‹çš„å¤šç§å®ç°æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç±»å‹ã€ä¸ªæ•°æˆ–è€…å¯¹è±¡ç±»å‹è€Œæœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚Javaä¸­å®ç°å¤šæ€çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šæ–¹æ³•é‡è½½ï¼ˆOverloadingï¼‰å’Œæ–¹æ³•é‡å†™ï¼ˆOverridingï¼‰ã€‚</p><ol><li>æ–¹æ³•é‡è½½ æ–¹æ³•é‡è½½æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•åç›¸åŒä½†æ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°æˆ–è€…é¡ºåºä¸åŒçš„æ–¹æ³•ã€‚Javaç¼–è¯‘å™¨æ ¹æ®æ–¹æ³•çš„å‚æ•°ç±»å‹ã€ä¸ªæ•°æˆ–è€…é¡ºåºæ¥ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œä»è€Œå®ç°å¤šæ€ã€‚</li><li>æ–¹æ³•é‡å†™ æ–¹æ³•é‡å†™æ˜¯æŒ‡å­ç±»é‡å†™äº†çˆ¶ç±»ä¸­çš„åŒååŒå‚æ•°çš„æ–¹æ³•ï¼Œä»è€Œå®ç°å¤šæ€ã€‚åœ¨æ–¹æ³•é‡å†™æ—¶ï¼Œå­ç±»å¿…é¡»ä¿è¯é‡å†™æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ã€æ–¹æ³•åå’Œå‚æ•°ç±»å‹ä¸çˆ¶ç±»ä¸­çš„æ–¹æ³•ç›¸åŒæˆ–è€…æ˜¯å…¶å­ç±»ã€‚</li></ol><h3 id="nio-çš„-buffer-åŒºæ˜¯åŒå‘çš„å—" tabindex="-1"><a class="header-anchor" href="#nio-çš„-buffer-åŒºæ˜¯åŒå‘çš„å—" aria-hidden="true">#</a> NIO çš„ buffer åŒºæ˜¯åŒå‘çš„å—ï¼Ÿ</h3><p>æ˜¯åŒå‘çš„</p><p>æ•°æ®ç¼“å­˜åŒº: åœ¨ JAVA NIO æ¡†æ¶ä¸­ï¼Œä¸ºäº†ä¿è¯æ¯ä¸ªé€šé“çš„æ•°æ®è¯»å†™é€Ÿåº¦ JAVA NIO æ¡†æ¶ä¸ºæ¯ä¸€ç§éœ€è¦æ”¯æŒæ•°æ®è¯»å†™çš„é€šé“é›†æˆäº† Buffer çš„æ”¯æŒã€‚</p><p>è¿™å¥è¯æ€ä¹ˆç†è§£å‘¢? ä¾‹å¦‚ ServerSocketChannel é€šé“å®ƒåªæ”¯æŒå¯¹ OP_ACCEPT äº‹ä»¶çš„ç›‘å¬ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸èƒ½ç›´æ¥è¿›è¡Œç½‘ç»œæ•°æ®å†…å®¹çš„è¯»å†™çš„ã€‚æ‰€ä»¥ ServerSocketChannel æ˜¯æ²¡æœ‰é›†æˆ Buffer çš„ã€‚</p><p>Buffer æœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼: å†™æ¨¡å¼å’Œè¯»æ¨¡å¼ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºåªèƒ½ä» Buffer ä¸­è¯»å–æ•°æ®ï¼Œä¸èƒ½è¿›è¡Œå†™æ“ä½œã€‚ä½†æ˜¯åœ¨å†™æ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºæ˜¯å¯ä»¥è¿›è¡Œè¯»æ“ä½œçš„ï¼Œè¿™å°±è¡¨ç¤ºå¯èƒ½ä¼šå‡ºç°è„è¯»çš„æƒ…å†µã€‚æ‰€ä»¥ä¸€æ—¦æ‚¨å†³å®šè¦ä» Buffer ä¸­è¯»å–æ•°æ®ï¼Œä¸€å®šè¦å°† Buffer çš„çŠ¶æ€æ”¹ä¸ºè¯»æ¨¡å¼ã€‚</p><p>å¦‚ä¸‹å›¾:</p><figure><img src="'+x+'" alt="image-20220411184115018" tabindex="0" loading="lazy"><figcaption>image-20220411184115018</figcaption></figure><ul><li>position: ç¼“å­˜åŒºç›®å‰æ­£åœ¨æ“ä½œçš„æ•°æ®å—ä½ç½®</li><li>limit: ç¼“å­˜åŒºæœ€å¤§å¯ä»¥è¿›è¡Œæ“ä½œçš„ä½ç½®ã€‚ç¼“å­˜åŒºçš„è¯»å†™çŠ¶æ€æ­£æ˜¯ç”±è¿™ä¸ªå±æ€§æ§åˆ¶çš„ã€‚</li><li>capacity: ç¼“å­˜åŒºçš„æœ€å¤§å®¹é‡ã€‚è¿™ä¸ªå®¹é‡æ˜¯åœ¨ç¼“å­˜åŒºåˆ›å»ºæ—¶è¿›è¡ŒæŒ‡å®šçš„ã€‚ç”±äºé«˜å¹¶å‘æ—¶é€šé“æ•°é‡å¾€å¾€ä¼šå¾ˆåºå¤§ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªç¼“å­˜åŒºçš„å®¹é‡æœ€å¥½ä¸è¦è¿‡å¤§ã€‚</li></ul><p>åœ¨ä¸‹æ–‡ JAVA NIO æ¡†æ¶çš„ä»£ç å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è¿›è¡Œ Buffer ç¼“å­˜åŒºæ“ä½œçš„æ¼”ç¤º</p><h3 id="æ³›å‹æœ‰å•¥ç”¨-æ³›å‹æ“¦é™¤æ˜¯å•¥" tabindex="-1"><a class="header-anchor" href="#æ³›å‹æœ‰å•¥ç”¨-æ³›å‹æ“¦é™¤æ˜¯å•¥" aria-hidden="true">#</a> æ³›å‹æœ‰å•¥ç”¨ï¼Ÿæ³›å‹æ“¦é™¤æ˜¯å•¥ï¼Ÿ</h3><p>æ³›å‹çš„æœ¬è´¨æ˜¯ä¸ºäº†å‚æ•°åŒ–ç±»å‹ï¼ˆåœ¨ä¸åˆ›å»ºæ–°çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šçš„ä¸åŒç±»å‹æ¥æ§åˆ¶å½¢å‚å…·ä½“é™åˆ¶çš„ç±»å‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ³›å‹ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚</p><p>å¼•å…¥æ³›å‹çš„æ„ä¹‰åœ¨äºï¼š</p><ul><li><strong>é€‚ç”¨äºå¤šç§æ•°æ®ç±»å‹æ‰§è¡Œç›¸åŒçš„ä»£ç </strong>ï¼ˆä»£ç å¤ç”¨ï¼‰</li><li>æ³›å‹ä¸­çš„ç±»å‹åœ¨ä½¿ç”¨æ—¶æŒ‡å®šï¼Œä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆ<strong>ç±»å‹å®‰å…¨</strong>ï¼Œç¼–è¯‘å™¨ä¼š<strong>æ£€æŸ¥ç±»å‹</strong>ï¼‰</li></ul><p>æ³›å‹æ“¦é™¤ï¼š</p><p>Javaè¯­è¨€ä¸­çš„æ³›å‹è¢«ç§°ä¸ºä¼ªæ³›å‹ï¼Œå› ä¸ºè¿™ç§æ³›å‹å®ƒåªåœ¨ç¼–å†™çš„æºç ä¸­å­˜åœ¨ï¼Œåœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ä¸ä¼šåŒ…å«æ³›å‹ä¸­çš„ç±»å‹ä¿¡æ¯äº†ï¼Œæ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«æ“¦é™¤äº†ï¼Œå¹¶ä¸”ä¼šåœ¨ç›¸åº”çš„åœ°æ–¹æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ä»£ç ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ³›å‹æ“¦é™¤ã€‚ä¾‹å¦‚<code>new ArrayList&lt;String&gt;()</code>ï¼Œæ³›å‹æ“¦é™¤åå°±æ˜¯<code>new ArrayList()</code>ï¼Œå¯¹å…¶å…ƒç´ çš„æ“ä½œä¹Ÿä¼šåŠ ä¸Š(String)å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p><h3 id="å¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰-å“ˆå¸Œè¡¨ç»“æ„å±äºå“ªç§åœºæ™¯-2022oppo" tabindex="-1"><a class="header-anchor" href="#å¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰-å“ˆå¸Œè¡¨ç»“æ„å±äºå“ªç§åœºæ™¯-2022oppo" aria-hidden="true">#</a> å¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰ï¼Ÿå“ˆå¸Œè¡¨ç»“æ„å±äºå“ªç§åœºæ™¯ï¼Ÿï¼ˆ2022OPPOï¼‰</h3><p>å“ˆå¸Œè¡¨ã€æœ‰åºæ•°ç»„å’Œæœç´¢æ ‘ã€‚</p><ul><li>å“ˆå¸Œè¡¨è¿™ç§ç»“æ„é€‚ç”¨äºåªæœ‰ç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯</li><li>æœ‰åºæ•°ç»„é€‚åˆèŒƒå›´æŸ¥è¯¢ï¼Œç”¨äºŒåˆ†æ³•å¿«é€Ÿå¾—åˆ°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(log(N))ã€‚æŸ¥è¯¢è¿˜å¥½ï¼Œå¦‚æœæ˜¯æ’å…¥ï¼Œå°±å¾—æŒªåŠ¨åé¢æ‰€æœ‰çš„è®°å½•ï¼Œæˆæœ¬å¤ªé«˜ã€‚å› æ­¤å®ƒä¸€èˆ¬åªé€‚ç”¨é™æ€å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚ä¿å­˜2018å¹´æŸä¸ªåŸå¸‚çš„æ‰€æœ‰äººå£ä¿¡æ¯ã€‚</li><li>B+æ ‘é€‚åˆèŒƒå›´æŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬å»ºçš„ç´¢å¼•ç»“æ„éƒ½æ˜¯B+æ ‘ã€‚</li></ul><p><strong>æ‹“å±•</strong>ï¼šç»™ä½ ab,ac,abcå­—æ®µï¼Œä½ æ˜¯å¦‚ä½•åŠ ç´¢å¼•çš„ï¼Ÿ</p><p>è¿™ä¸»è¦è€ƒå¯Ÿè”åˆç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™çŸ¥è¯†ç‚¹ã€‚</p><ul><li>è¿™ä¸ªæœ€å·¦å‰ç¼€å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦ <code>N</code>ä¸ªå­—æ®µã€‚æ¯”å¦‚ç»„åˆç´¢å¼• <code>ï¼ˆa,b,cï¼‰</code>å¯ä»¥ç›¸å½“äºå»ºäº† <code>ï¼ˆaï¼‰ï¼Œï¼ˆa,bï¼‰,(a,b,c)</code>ä¸‰ä¸ªç´¢å¼•ï¼Œå¤§å¤§æé«˜äº†ç´¢å¼•å¤ç”¨èƒ½åŠ›ã€‚</li><li>æœ€å·¦å‰ç¼€ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ <code>M</code>ä¸ªå­—ç¬¦ã€‚</li></ul><p>å› æ­¤ç»™ä½  <code>ab,ac,abc</code>å­—æ®µï¼Œä½ å¯ä»¥ç›´æ¥åŠ  <code>abc</code>è”åˆç´¢å¼•å’Œ <code>ac</code>è”åˆç´¢å¼•å³å¯ã€‚</p><h3 id="è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆ</h3><p>åŸºäºå¤šä¸ªå­—æ®µåˆ›å»ºçš„ç´¢å¼•æˆ‘ä»¬ç§°ä¸ºè”åˆç´¢å¼•ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºç´¢å¼•<strong>create index idx on table(A,B,C)</strong> æˆ‘ä»¬ç§°åœ¨å­—æ®µA,B,Cä¸Šåˆ›å»ºäº†ä¸€ä¸ªè”åˆç´¢å¼•</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œç´¢å¼•å­˜å‚¨åº•å±‚æ˜¯B+æ ‘ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹ï¼Œä¸»é”®ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æ•°æ®ï¼Œéä¸»é”®ç´¢å¼•ä¸Šå­˜å‚¨çš„æ˜¯ä¸»é”®idï¼Œåœ¨è”åˆç´¢å¼•ä¸‹ï¼Œè¿™ä¸ªB+æ ‘æ˜¯å¦‚ä½•ç»„ç»‡çš„å‘¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªè¡¨ï¼Œå‘è¡¨é‡Œæ·»åŠ ä¸€äº›æ•°æ®ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span>\n  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ä¸»é”®idè‡ªå¢&#39;</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å¹´é¾„&#39;</span><span class="token punctuation">,</span>\n    <span class="token identifier"><span class="token punctuation">`</span>money<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è´¦æˆ·ä½™é¢ ,çœŸæ­£å¼€å‘æ—¶å€™ï¼Œä½™é¢ä¸èƒ½ç”¨æ•´æ•°å“ˆ&#39;</span><span class="token punctuation">,</span>\n    <span class="token identifier"><span class="token punctuation">`</span>ismale<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">comment</span> <span class="token string">&#39;æ€§åˆ« 0ç”·1å¥³&#39;</span><span class="token punctuation">,</span>\n    <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">comment</span> <span class="token string">&#39;åç§°&#39;</span><span class="token punctuation">,</span>\n  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>\n  <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>index_bcd<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>money<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>\n<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è”åˆç´¢å¼•å’Œå•ä¸ªç´¢å¼•å¯¹æ¯”æ¥è®²ï¼Œè”åˆç´¢å¼•çš„æ‰€æœ‰ç´¢å¼•é¡¹éƒ½ä¼šå‡ºç°åœ¨ç´¢å¼•ä¸Šï¼Œå­˜å‚¨å¼•æ“ä¼šå…ˆæ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•é¡¹æ’åºï¼Œå¦‚æœç¬¬ä¸€ä¸ªç´¢å¼•é¡¹ç›¸åŒçš„è¯æ‰ä¼šå»çœ‹ç¬¬äºŒä¸ªï¼Œæ‰€æœ‰æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœå¤´ç´¢å¼•ä¸å¸¦çš„è¯ï¼Œè”åˆç´¢å¼•å°±ä¼šå¤±æ•ˆï¼Œå› ä¸ºåœ¨æ ¹èŠ‚ç‚¹ä»–å°±ä¸çŸ¥é“æ€ä¹ˆå¾€ä¸‹èµ°ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨<strong>select * from USER us where us.age=20 and us.money=30</strong>è¿™ä¸ªsqlå»æŸ¥çš„ï¼Œé¦–å…ˆåœ¨æ ¹èŠ‚ç‚¹ä¸Šage&gt;1å¹¶ä¸”&lt;60,é‚£ä¹ˆè¯»ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨è¯»åˆ°å¶å­èŠ‚ç‚¹ä¸Šå–å‡ºä¸»é”®idå›è¡¨æŸ¥è¯¢æ‰€æœ‰çš„å­—æ®µå€¼ã€‚</p>',198),at={href:"https://segmentfault.com/a/1190000040866035",target:"_blank",rel:"noopener noreferrer"},et=t('<h3 id="java-bio-nio-aio-ä¸‰è€…çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#java-bio-nio-aio-ä¸‰è€…çš„åŒºåˆ«" aria-hidden="true">#</a> Java BIO NIO AIO ä¸‰è€…çš„åŒºåˆ«ï¼Ÿ</h3><figure><img src="'+_+'" alt="image-20220614175742196" tabindex="0" loading="lazy"><figcaption>image-20220614175742196</figcaption></figure><ul><li><p>Java BIO[Blocking I/O] | åŒæ­¥é˜»å¡I/Oæ¨¡å¼</p><ul><li>BIO å…¨ç§°Block-IO æ˜¯ä¸€ç§åŒæ­¥ä¸”é˜»å¡çš„é€šä¿¡æ¨¡å¼ã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¼ ç»Ÿçš„é€šä¿¡æ–¹å¼ï¼Œæ¨¡å¼ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚ä½†å¹¶å‘å¤„ç†èƒ½åŠ›ä½ï¼Œé€šä¿¡è€—æ—¶ï¼Œä¾èµ–ç½‘é€Ÿã€‚</li></ul></li><li><p>Java NIO[New I/O] | åŒæ­¥éé˜»å¡æ¨¡å¼(ä¹Ÿå¯ä»¥ç§°ä¸ºIOå¤šè·¯å¤ç”¨æ¨¡å‹)</p><ul><li>Java NIOï¼Œå…¨ç¨‹ Non-Block IO ï¼Œæ˜¯Java SE 1.4ç‰ˆä»¥åï¼Œé’ˆå¯¹ç½‘ç»œä¼ è¾“æ•ˆèƒ½ä¼˜åŒ–çš„æ–°åŠŸèƒ½ã€‚æ˜¯ä¸€ç§éé˜»å¡åŒæ­¥çš„é€šä¿¡æ¨¡å¼ã€‚</li><li>NIO ä¸åŸæ¥çš„ I/O æœ‰åŒæ ·çš„ä½œç”¨å’Œç›®çš„, ä»–ä»¬ä¹‹é—´æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ã€‚åŸæ¥çš„ I/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</li><li>é¢å‘æµçš„ I/O ç³»ç»Ÿä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°å¤„ç†æ•°æ®ã€‚ä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚</li><li>é¢å‘å—çš„ I/O ç³»ç»Ÿä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®ã€‚æ¯ä¸€ä¸ªæ“ä½œéƒ½åœ¨ä¸€æ­¥ä¸­äº§ç”Ÿæˆ–è€…æ¶ˆè´¹ä¸€ä¸ªæ•°æ®å—ã€‚æŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰(æµå¼çš„)å­—èŠ‚å¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O - ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</li></ul></li><li><p>Java AIO[Asynchronous I/O] | å¼‚æ­¥éé˜»å¡I/Oæ¨¡å‹</p><ul><li>Java AIOï¼Œå…¨ç¨‹ Asynchronous IOï¼Œæ˜¯å¼‚æ­¥éé˜»å¡çš„IOã€‚æ˜¯ä¸€ç§éé˜»å¡å¼‚æ­¥çš„é€šä¿¡æ¨¡å¼ã€‚åœ¨NIOçš„åŸºç¡€ä¸Šå¼•å…¥äº†æ–°çš„å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œå¹¶æä¾›äº†å¼‚æ­¥æ–‡ä»¶é€šé“å’Œå¼‚æ­¥å¥—æ¥å­—é€šé“çš„å®ç°ã€‚</li></ul></li></ul><h3 id="hashmap-put-å·¥ä½œæµç¨‹-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#hashmap-put-å·¥ä½œæµç¨‹-2022é£ä¹¦" aria-hidden="true">#</a> hashmap put() å·¥ä½œæµç¨‹ï¼ˆ2022é£ä¹¦ï¼‰</h3><p><code>put(K key, V value)</code>æ–¹æ³•æ˜¯å°†æŒ‡å®šçš„ <code>key, value</code>å¯¹æ·»åŠ åˆ° <code>map</code>é‡Œã€‚è¯¥æ–¹æ³•é¦–å…ˆä¼šå¯¹ <code>map</code>åšä¸€æ¬¡æŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦åŒ…å«è¯¥å…ƒç»„ï¼Œå¦‚æœå·²ç»åŒ…å«åˆ™ç›´æ¥è¿”å›ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç±»ä¼¼äº <code>getEntry()</code>æ–¹æ³•ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šé€šè¿‡ <code>addEntry(int hash, K key, V value, int bucketIndex)</code>æ–¹æ³•æ’å…¥æ–°çš„ <code>entry</code>ï¼Œæ’å…¥æ–¹å¼ä¸º<strong>å¤´æ’æ³•</strong>ã€‚</p><figure><img src="'+T+`" alt="image-20220616155057751" tabindex="0" loading="lazy"><figcaption>image-20220616155057751</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//addEntry()</span>
<span class="token keyword">void</span> <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è‡ªåŠ¨æ‰©å®¹ï¼Œå¹¶é‡æ–°å“ˆå¸Œ</span>
        hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> key<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        bucketIndex <span class="token operator">=</span> hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>table<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hash%table.length</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//åœ¨å†²çªé“¾è¡¨å¤´éƒ¨æ’å…¥æ–°çš„entry</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‹“å±•ï¼šget() remove()</p><p><code>get(Object key)</code>æ–¹æ³•æ ¹æ®æŒ‡å®šçš„ <code>key</code>å€¼è¿”å›å¯¹åº”çš„ <code>value</code>ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº† <code>getEntry(Object key)</code>å¾—åˆ°ç›¸åº”çš„ <code>entry</code>ï¼Œç„¶åè¿”å› <code>entry.getValue()</code>ã€‚å› æ­¤ <code>getEntry()</code>æ˜¯ç®—æ³•çš„æ ¸å¿ƒã€‚ ç®—æ³•æ€æƒ³æ˜¯é¦–å…ˆé€šè¿‡ <code>hash()</code>å‡½æ•°å¾—åˆ°å¯¹åº” <code>bucket</code>çš„ä¸‹æ ‡ï¼Œç„¶åä¾æ¬¡éå†å†²çªé“¾è¡¨ï¼Œé€šè¿‡ <code>key.equals(k)</code>æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è¦æ‰¾çš„é‚£ä¸ª <code>entry</code>ã€‚</p><figure><img src="`+P+`" alt="image-20220616155140634" tabindex="0" loading="lazy"><figcaption>image-20220616155140634</figcaption></figure><p>ä¸Šå›¾ä¸­ <code>hash(k)&amp;(table.length-1)</code>ç­‰ä»·äº <code>hash(k)%table.length</code>ï¼ŒåŸå› æ˜¯<em>HashMap</em>è¦æ±‚ <code>table.length</code>å¿…é¡»æ˜¯2çš„æŒ‡æ•°ï¼Œå› æ­¤ <code>table.length-1</code>å°±æ˜¯äºŒè¿›åˆ¶ä½ä½å…¨æ˜¯1ï¼Œè·Ÿ <code>hash(k)</code>ç›¸ä¸ä¼šå°†å“ˆå¸Œå€¼çš„é«˜ä½å…¨æŠ¹æ‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½™æ•°äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//getEntry()æ–¹æ³•</span>
<span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>hash<span class="token operator">&amp;</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ°å†²çªé“¾è¡¨</span>
         e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//ä¾æ¬¡éå†å†²çªé“¾è¡¨ä¸­çš„æ¯ä¸ªentry</span>
        <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
        <span class="token comment">//ä¾æ®equals()æ–¹æ³•åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>remove()</strong></p><p><code>remove(Object key)</code>çš„ä½œç”¨æ˜¯åˆ é™¤ <code>key</code>å€¼å¯¹åº”çš„ <code>entry</code>ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“é€»è¾‘æ˜¯åœ¨ <code>removeEntryForKey(Object key)</code>é‡Œå®ç°çš„ã€‚<code>removeEntryForKey()</code>æ–¹æ³•ä¼šé¦–å…ˆæ‰¾åˆ° <code>key</code>å€¼å¯¹åº”çš„ <code>entry</code>ï¼Œç„¶ååˆ é™¤è¯¥ <code>entry</code>(ä¿®æ”¹é“¾è¡¨çš„ç›¸åº”å¼•ç”¨)ã€‚æŸ¥æ‰¾è¿‡ç¨‹è·Ÿ <code>getEntry()</code>è¿‡ç¨‹ç±»ä¼¼ã€‚</p><figure><img src="`+L+`" alt="image-20220616155221157" tabindex="0" loading="lazy"><figcaption>image-20220616155221157</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//removeEntryForKey()</span>
<span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">removeEntryForKey</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//hash&amp;(table.length-1)</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> prev <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å¾—åˆ°å†²çªé“¾è¡¨</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> e <span class="token operator">=</span> prev<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//éå†å†²çªé“¾è¡¨</span>
        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ‰¾åˆ°è¦åˆ é™¤çš„entry</span>
            modCount<span class="token operator">++</span><span class="token punctuation">;</span> size<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prev <span class="token operator">==</span> e<span class="token punctuation">)</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> next<span class="token punctuation">;</span><span class="token comment">//åˆ é™¤çš„æ˜¯å†²çªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªentry</span>
            <span class="token keyword">else</span> prev<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token keyword">return</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        prev <span class="token operator">=</span> e<span class="token punctuation">;</span> e <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="unsafeç±»åœ¨ç¡¬ä»¶å±‚é¢çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#unsafeç±»åœ¨ç¡¬ä»¶å±‚é¢çš„å®ç°" aria-hidden="true">#</a> Unsafeç±»åœ¨ç¡¬ä»¶å±‚é¢çš„å®ç°ï¼Ÿ</h3><p>ä¸å¦¨å†çœ‹çœ‹Unsafeçš„compareAndSwap*æ–¹æ³•æ¥å®ç°CASæ“ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ç°ä½äºunsafe.cppä¸­ã€‚</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">UNSAFE_ENTRY</span><span class="token punctuation">(</span>jboolean<span class="token punctuation">,</span> <span class="token function">Unsafe_CompareAndSwapInt</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject unsafe<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jlong offset<span class="token punctuation">,</span> jint e<span class="token punctuation">,</span> jint x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">UnsafeWrapper</span><span class="token punctuation">(</span><span class="token string">&quot;Unsafe_CompareAndSwapInt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oop p <span class="token operator">=</span> JNIHandles<span class="token operator">::</span><span class="token function">resolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  jint<span class="token operator">*</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>jint <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">index_oop_from_field_offset_long</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>jint<span class="token punctuation">)</span><span class="token punctuation">(</span>Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> e<span class="token punctuation">;</span>
UNSAFE_END
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å®ƒé€šè¿‡ <code>Atomic::cmpxchg</code> æ¥å®ç°æ¯”è¾ƒå’Œæ›¿æ¢æ“ä½œã€‚å…¶ä¸­å‚æ•°xæ˜¯å³å°†æ›´æ–°çš„å€¼ï¼Œå‚æ•°eæ˜¯åŸå†…å­˜çš„å€¼ã€‚</p><p>å¦‚æœæ˜¯Linuxçš„x86ï¼Œ<code>Atomic::cmpxchg</code>æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">inline</span> jint Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span> <span class="token punctuation">(</span>jint exchange_value<span class="token punctuation">,</span> <span class="token keyword">volatile</span> jint<span class="token operator">*</span> dest<span class="token punctuation">,</span> jint compare_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> mp <span class="token operator">=</span> os<span class="token operator">::</span><span class="token function">is_MP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __asm__ <span class="token keyword">volatile</span> <span class="token punctuation">(</span><span class="token function">LOCK_IF_MP</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;cmpxchgl %1,(%3)&quot;</span>
                    <span class="token operator">:</span> <span class="token string">&quot;=a&quot;</span> <span class="token punctuation">(</span>exchange_value<span class="token punctuation">)</span>
                    <span class="token operator">:</span> <span class="token string">&quot;r&quot;</span> <span class="token punctuation">(</span>exchange_value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">(</span>compare_value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span> <span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span> <span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
                    <span class="token operator">:</span> <span class="token string">&quot;cc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;memory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> exchange_value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œwindowsçš„x86çš„å®ç°å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">inline</span> jint Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span> <span class="token punctuation">(</span>jint exchange_value<span class="token punctuation">,</span> <span class="token keyword">volatile</span> jint<span class="token operator">*</span> dest<span class="token punctuation">,</span> jint compare_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> mp <span class="token operator">=</span> os<span class="token operator">::</span><span class="token function">isMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¤šå¤„ç†å™¨</span>
    _asm <span class="token punctuation">{</span>
        mov edx<span class="token punctuation">,</span> dest
        mov ecx<span class="token punctuation">,</span> exchange_value
        mov eax<span class="token punctuation">,</span> compare_value
        <span class="token function">LOCK_IF_MP</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
        cmpxchg dword ptr <span class="token punctuation">[</span>edx<span class="token punctuation">]</span><span class="token punctuation">,</span> ecx
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Adding a lock prefix to an instruction on MP machine</span>
<span class="token comment">// VC++ doesn&#39;t like the lock prefix to be on a single line</span>
<span class="token comment">// so we can&#39;t insert a label after the lock prefix.</span>
<span class="token comment">// By emitting a lock prefix, we can define a label after it.</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LOCK_IF_MP</span><span class="token expression"><span class="token punctuation">(</span>mp<span class="token punctuation">)</span> __asm cmp mp<span class="token punctuation">,</span> <span class="token number">0</span>  </span><span class="token punctuation">\\</span>
                       <span class="token expression">__asm je L0      </span><span class="token punctuation">\\</span>
                       <span class="token expression">__asm _emit <span class="token number">0xF0</span> </span><span class="token punctuation">\\</span>
                       <span class="token expression">__asm L0<span class="token operator">:</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯å¤šå¤„ç†å™¨ï¼Œä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚åä¹‹ï¼Œå°±çœç•¥lockå‰ç¼€(å•å¤„ç†å™¨ä¼šä¸éœ€è¦lockå‰ç¼€æä¾›çš„å†…å­˜å±éšœæ•ˆæœ)ã€‚è¿™é‡Œçš„lockå‰ç¼€å°±æ˜¯ä½¿ç”¨äº†å¤„ç†å™¨çš„æ€»çº¿é”(æœ€æ–°çš„å¤„ç†å™¨éƒ½ä½¿ç”¨ç¼“å­˜é”ä»£æ›¿æ€»çº¿é”æ¥æé«˜æ€§èƒ½)ã€‚</p><p><code>cmpxchg(void* ptr, int old, int new)ï¼Œå¦‚æœptrå’Œoldçš„å€¼ä¸€æ ·ï¼Œåˆ™æŠŠnewå†™åˆ°ptrå†…å­˜ï¼Œå¦åˆ™è¿”å›ptrçš„å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚åœ¨Intelå¹³å°ä¸‹ï¼Œä¼šç”¨lock cmpxchgæ¥å®ç°ï¼Œä½¿ç”¨lockè§¦å‘ç¼“å­˜é”ï¼Œè¿™æ ·å¦ä¸€ä¸ªçº¿ç¨‹æƒ³è®¿é—®ptrçš„å†…å­˜ï¼Œå°±ä¼šè¢«blockä½ã€‚</code></p><h2 id="ğŸƒå¸¸ç”¨æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#ğŸƒå¸¸ç”¨æ¡†æ¶" aria-hidden="true">#</a> ğŸƒå¸¸ç”¨æ¡†æ¶</h2><h3 id="spring" tabindex="-1"><a class="header-anchor" href="#spring" aria-hidden="true">#</a> Spring</h3><h4 id="å¯¹-spring-å’Œ-springboot-çš„ç†è§£" tabindex="-1"><a class="header-anchor" href="#å¯¹-spring-å’Œ-springboot-çš„ç†è§£" aria-hidden="true">#</a> å¯¹ spring å’Œ springboot çš„ç†è§£</h4><p>spring</p><hr><p>æˆ‘ä»¬ä¸€èˆ¬è¯´ Spring æ¡†æ¶æŒ‡çš„éƒ½æ˜¯ Spring Frameworkï¼Œå®ƒæ˜¯å¾ˆå¤šæ¨¡å—çš„é›†åˆï¼Œä½¿ç”¨è¿™äº›æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ååŠ©æˆ‘ä»¬è¿›è¡Œå¼€å‘ã€‚</p><p>æ¯”å¦‚è¯´ Spring è‡ªå¸¦ IoCï¼ˆInverse of Control:æ§åˆ¶åè½¬ï¼‰ å’Œ AOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)ã€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æ•°æ®åº“è¿›è¡Œè®¿é—®ã€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆç”µå­é‚®ä»¶ï¼Œä»»åŠ¡ï¼Œè°ƒåº¦ï¼Œç¼“å­˜ç­‰ç­‰ï¼‰ã€å¯¹å•å…ƒæµ‹è¯•æ”¯æŒæ¯”è¾ƒå¥½ã€æ”¯æŒ RESTful Java åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚</p><p>Spring æœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯ä¸é‡æ–°é€ è½®å­ï¼Œå¼€ç®±å³ç”¨ï¼</p><p>Spring æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ä¸»è¦æ˜¯ IoC å’Œ AOPã€‚å­¦ä¹  Spring ï¼Œä¸€å®šè¦æŠŠ IoC å’Œ AOP çš„æ ¸å¿ƒæ€æƒ³ææ‡‚ï¼</p><p>springboot</p><hr><p>Spring Boot åªæ˜¯ç®€åŒ–äº†é…ç½®ï¼Œå¦‚æœä½ éœ€è¦æ„å»º MVC æ¶æ„çš„ Web ç¨‹åºï¼Œä½ è¿˜æ˜¯éœ€è¦ä½¿ç”¨ Spring MVC ä½œä¸º MVC æ¡†æ¶ï¼Œåªæ˜¯è¯´ Spring Boot å¸®ä½ ç®€åŒ–äº† Spring MVC çš„å¾ˆå¤šé…ç½®ï¼ŒçœŸæ­£åšåˆ°å¼€ç®±å³ç”¨ï¼</p><h4 id="springboot-æ˜¯æ€ä¹ˆåŠ è½½-redis-çš„" tabindex="-1"><a class="header-anchor" href="#springboot-æ˜¯æ€ä¹ˆåŠ è½½-redis-çš„" aria-hidden="true">#</a> springboot æ˜¯æ€ä¹ˆåŠ è½½ redis çš„</h4>`,39),tt={href:"https://javaguide.cn/system-design/framework/spring/spring-boot-auto-assembly-principles.html#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA-starter",target:"_blank",rel:"noopener noreferrer"},pt={href:"https://javaguide.cn/system-design/framework/spring/spring-boot-auto-assembly-principles.html#springboot-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E7%9A%84",target:"_blank",rel:"noopener noreferrer"},ot=t(`<h4 id="åŠ è½½çš„-redis-æˆ–è€…-bean-æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹" tabindex="-1"><a class="header-anchor" href="#åŠ è½½çš„-redis-æˆ–è€…-bean-æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹" aria-hidden="true">#</a> åŠ è½½çš„ redis æˆ–è€… bean æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹</h4><p>é»˜è®¤å•ä¾‹</p><h4 id="springboot-æ˜¯æ€ä¹ˆå®ç°å•ä¾‹æ¨¡å¼çš„å‘¢" tabindex="-1"><a class="header-anchor" href="#springboot-æ˜¯æ€ä¹ˆå®ç°å•ä¾‹æ¨¡å¼çš„å‘¢" aria-hidden="true">#</a> springboot æ˜¯æ€ä¹ˆå®ç°å•ä¾‹æ¨¡å¼çš„å‘¢ï¼Ÿ</h4><p>åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›å¯¹è±¡å…¶å®æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ï¼šçº¿ç¨‹æ± ã€ç¼“å­˜ã€å¯¹è¯æ¡†ã€æ³¨å†Œè¡¨ã€æ—¥å¿—å¯¹è±¡ã€å……å½“æ‰“å°æœºã€æ˜¾å¡ç­‰è®¾å¤‡é©±åŠ¨ç¨‹åºçš„å¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸€ç±»å¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœåˆ¶é€ å‡ºå¤šä¸ªå®ä¾‹å°±å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜çš„äº§ç”Ÿï¼Œæ¯”å¦‚ï¼šç¨‹åºçš„è¡Œä¸ºå¼‚å¸¸ã€èµ„æºä½¿ç”¨è¿‡é‡ã€æˆ–è€…ä¸ä¸€è‡´æ€§çš„ç»“æœã€‚</p><p><strong>ä½¿ç”¨å•ä¾‹æ¨¡å¼çš„å¥½å¤„:</strong></p><ul><li>å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‚£äº›é‡é‡çº§å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ï¼›</li><li>ç”±äº new æ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½» GC å‹åŠ›ï¼Œç¼©çŸ­ GC åœé¡¿æ—¶é—´ã€‚</li></ul><p><strong>Spring ä¸­ bean çš„é»˜è®¤ä½œç”¨åŸŸå°±æ˜¯ singleton(å•ä¾‹)çš„ã€‚</strong> é™¤äº† singleton ä½œç”¨åŸŸï¼ŒSpring ä¸­ bean è¿˜æœ‰ä¸‹é¢å‡ ç§ä½œç”¨åŸŸï¼š</p><ul><li>prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚</li><li>request : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼Œè¯¥beanä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚</li><li>session : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥beanä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚</li><li>global-sessionï¼š å…¨å±€sessionä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäºportletçš„webåº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring5å·²ç»æ²¡æœ‰äº†ã€‚Portletæ˜¯èƒ½å¤Ÿç”Ÿæˆè¯­ä¹‰ä»£ç (ä¾‹å¦‚ï¼šHTML)ç‰‡æ®µçš„å°å‹Java Webæ’ä»¶ã€‚å®ƒä»¬åŸºäºportletå®¹å™¨ï¼Œå¯ä»¥åƒservletä¸€æ ·å¤„ç†HTTPè¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä¸ servlet ä¸åŒï¼Œæ¯ä¸ª portlet éƒ½æœ‰ä¸åŒçš„ä¼šè¯</li></ul><p><strong>Spring å®ç°å•ä¾‹çš„æ–¹å¼ï¼š</strong></p><ul><li>xml:<code>&lt;bean id=&quot;userService&quot; class=&quot;top.snailclimb.UserService&quot; scope=&quot;singleton&quot;/&gt;</code></li><li>æ³¨è§£ï¼š<code>@Scope(value = &quot;singleton&quot;)</code></li></ul><p>Spring é€šè¿‡ <code>ConcurrentHashMap</code> å®ç°å•ä¾‹æ³¨å†Œè¡¨çš„ç‰¹æ®Šæ–¹å¼å®ç°å•ä¾‹æ¨¡å¼ã€‚Spring å®ç°å•ä¾‹çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// é€šè¿‡ ConcurrentHashMapï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ å®ç°å•ä¾‹æ³¨å†Œè¡¨</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token string">&quot;&#39;beanName&#39; must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®ä¾‹  </span>
            <span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//...çœç•¥äº†å¾ˆå¤šä»£ç </span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//...çœç•¥äº†å¾ˆå¤šä»£ç </span>
                <span class="token comment">// å¦‚æœå®ä¾‹å¯¹è±¡åœ¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ³¨å†Œåˆ°å•ä¾‹æ³¨å†Œè¡¨ä¸­ã€‚</span>
                <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token constant">NULL_OBJECT</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å°†å¯¹è±¡æ·»åŠ åˆ°å•ä¾‹æ³¨å†Œè¡¨</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token constant">NULL_OBJECT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="spring-bean-å¯åŠ¨æµç¨‹å’Œç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#spring-bean-å¯åŠ¨æµç¨‹å’Œç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Spring bean å¯åŠ¨æµç¨‹å’Œç”Ÿå‘½å‘¨æœŸ</h4>`,13),it={href:"https://mp.weixin.qq.com/s/ut3mRwhfqXNjrBtTmI0oWg",target:"_blank",rel:"noopener noreferrer"},ct=t('<p>1ã€å®ä¾‹åŒ–ä¸€ä¸ªBeanï¼ï¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„newï¼›</p><p>2ã€æŒ‰ç…§Springä¸Šä¸‹æ–‡å¯¹å®ä¾‹åŒ–çš„Beanè¿›è¡Œé…ç½®ï¼ï¼ä¹Ÿå°±æ˜¯IOCæ³¨å…¥ï¼›</p><p>3ã€å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanNameAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanName(String)æ–¹æ³•ï¼Œæ­¤å¤„ä¼ é€’çš„å°±æ˜¯Springé…ç½®æ–‡ä»¶ä¸­Beançš„idå€¼</p><p>4ã€å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanFactoryAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanFactory(setBeanFactory(BeanFactory)ä¼ é€’çš„æ˜¯Springå·¥å‚è‡ªèº«ï¼ˆå¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼æ¥è·å–å…¶å®ƒBeanï¼Œåªéœ€åœ¨Springé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªæ™®é€šçš„Beanå°±å¯ä»¥ï¼‰ï¼›</p><p>5ã€å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œä¼šè°ƒç”¨setApplicationContext(ApplicationContext)æ–¹æ³•ï¼Œä¼ å…¥Springä¸Šä¸‹æ–‡ï¼ˆåŒæ ·è¿™ä¸ªæ–¹å¼ä¹Ÿå¯ä»¥å®ç°æ­¥éª¤4çš„å†…å®¹ï¼Œä½†æ¯”4æ›´å¥½ï¼Œå› ä¸ºApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ï¼Œæœ‰æ›´å¤šçš„å®ç°æ–¹æ³•ï¼‰ï¼›</p><p>6ã€å¦‚æœè¿™ä¸ªBeanå…³è”äº†BeanPostProcessoræ¥å£ï¼Œå°†ä¼šè°ƒç”¨postProcessBeforeInitialization(Object obj, String s)æ–¹æ³•ï¼ŒBeanPostProcessorç»å¸¸è¢«ç”¨ä½œæ˜¯Beanå†…å®¹çš„æ›´æ”¹ï¼Œå¹¶ä¸”ç”±äºè¿™ä¸ªæ˜¯åœ¨Beanåˆå§‹åŒ–ç»“æŸæ—¶è°ƒç”¨é‚£ä¸ªçš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è¢«åº”ç”¨äºå†…å­˜æˆ–ç¼“å­˜æŠ€æœ¯ï¼›</p><p>7ã€å¦‚æœBeanåœ¨Springé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†init-methodå±æ€§ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><p>8ã€å¦‚æœè¿™ä¸ªBeanå…³è”äº†BeanPostProcessoræ¥å£ï¼Œå°†ä¼šè°ƒç”¨postProcessAfterInitialization(Object obj, String s)æ–¹æ³•ã€ï¼›</p><p><code>æ³¨ï¼šä»¥ä¸Šå·¥ä½œå®Œæˆä»¥åå°±å¯ä»¥åº”ç”¨è¿™ä¸ªBeanäº†ï¼Œé‚£è¿™ä¸ªBeanæ˜¯ä¸€ä¸ªSingletonçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è°ƒç”¨åŒä¸€ä¸ªidçš„Beanä¼šæ˜¯åœ¨å†…å®¹åœ°å€ç›¸åŒçš„å®ä¾‹ï¼Œå½“ç„¶åœ¨Springé…ç½®æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥é…ç½®éSingletonï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšèµ˜è¿°ã€‚</code></p><p>9ã€å½“Beanä¸å†éœ€è¦æ—¶ï¼Œä¼šç»è¿‡æ¸…ç†é˜¶æ®µï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanè¿™ä¸ªæ¥å£ï¼Œä¼šè°ƒç”¨é‚£ä¸ªå…¶å®ç°çš„destroy()æ–¹æ³•ï¼›</p><p>10ã€æœ€åï¼Œå¦‚æœè¿™ä¸ªBeançš„Springé…ç½®ä¸­é…ç½®äº†destroy-methodå±æ€§ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„é”€æ¯æ–¹æ³•ã€‚</p><h4 id="springè®¾è®¡æ¨¡å¼-ç¾å›¢" tabindex="-1"><a class="header-anchor" href="#springè®¾è®¡æ¨¡å¼-ç¾å›¢" aria-hidden="true">#</a> Springè®¾è®¡æ¨¡å¼ï¼ˆç¾å›¢ï¼‰</h4>',12),lt={href:"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485303&idx=1&sn=9e4626a1e3f001f9b0d84a6fa0cff04a&chksm=cea248bcf9d5c1aaf48b67cc52bac74eb29d6037848d6cf213b0e5466f2d1fda970db700ba41&token=255050878&lang=zh_CN#rd",target:"_blank",rel:"noopener noreferrer"},rt=t('<p><strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong> : Spring ä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ <code>BeanFactory</code>ã€<code>ApplicationContext</code> åˆ›å»º bean å¯¹è±¡ã€‚</p><p><strong>ä»£ç†è®¾è®¡æ¨¡å¼</strong> : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</p><p><strong>å•ä¾‹è®¾è®¡æ¨¡å¼</strong> : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</p><p><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> : Spring ä¸­ <code>jdbcTemplate</code>ã€<code>hibernateTemplate</code> ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚</p><p><strong>åŒ…è£…å™¨è®¾è®¡æ¨¡å¼</strong> : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚</p><p><strong>è§‚å¯Ÿè€…æ¨¡å¼:</strong> Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚</p><p><strong>é€‚é…å™¨æ¨¡å¼</strong> : Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… <code>Controller</code>ã€‚****</p><h4 id="springå¸¸ç”¨æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#springå¸¸ç”¨æ³¨è§£" aria-hidden="true">#</a> Springå¸¸ç”¨æ³¨è§£</h4><p>@Valueï¼šå±æ€§èµ‹å€¼</p><p>@Component:ä¸ä¸šåŠ¡å±‚ã€daoå±‚ã€æ§åˆ¶å±‚ä¸ç›¸å…³çš„ç±»éœ€è¦åœ¨springå®¹å™¨ä¸­åˆ›å»ºä½¿ç”¨</p><p>@Repository:daoå±‚å¯¹è±¡çš„åˆ›å»º</p><p>@Service:ä¸šåŠ¡å±‚å±‚å¯¹è±¡çš„åˆ›å»º</p><p>@Controller:æ§åˆ¶å±‚å¯¹è±¡çš„åˆ›å»º</p><p>@Autowired:å¼•ç”¨ç±»å‹èµ‹å€¼,æ”¯æŒbyNameã€‚é»˜è®¤æ˜¯byType</p><h4 id="springå£°æ˜å¼äº‹åŠ¡åŸç†-å“ªäº›åœºæ™¯äº‹åŠ¡ä¼šå¤±æ•ˆ-oppo" tabindex="-1"><a class="header-anchor" href="#springå£°æ˜å¼äº‹åŠ¡åŸç†-å“ªäº›åœºæ™¯äº‹åŠ¡ä¼šå¤±æ•ˆ-oppo" aria-hidden="true">#</a> Springå£°æ˜å¼äº‹åŠ¡åŸç†ï¼Ÿå“ªäº›åœºæ™¯äº‹åŠ¡ä¼šå¤±æ•ˆï¼Ÿ(OPPO)</h4><p>å£°æ˜å¼äº‹åŠ¡åŸç†</p><hr><p>springå£°æ˜å¼äº‹åŠ¡ï¼Œå³ <code>@Transactional</code>,å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠäº‹åŠ¡å¼€å¯ã€æäº¤æˆ–è€…å›æ»šçš„æ“ä½œï¼Œé€šè¿‡Aopçš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚</p><figure><img src="'+R+'" alt="image-20220613102732800" tabindex="0" loading="lazy"><figcaption>image-20220613102732800</figcaption></figure><p>åœ¨springçš„beançš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå°±éœ€è¦å¯¹å®ä¾‹åŒ–çš„beanè¿›è¡Œä»£ç†ï¼Œå¹¶ä¸”ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚ç”Ÿæˆä»£ç†å¯¹è±¡çš„ä»£ç†é€»è¾‘ä¸­ï¼Œè¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶ï¼Œéœ€è¦å…ˆè·å–åˆ‡é¢é€»è¾‘ï¼Œ@Transactionalæ³¨è§£çš„åˆ‡é¢é€»è¾‘ç±»ä¼¼äº@Aroundï¼Œåœ¨springä¸­æ˜¯å®ç°ä¸€ç§ç±»ä¼¼ä»£ç†é€»è¾‘ã€‚</p><figure><img src="'+I+'" alt="image-20220613102739353" tabindex="0" loading="lazy"><figcaption>image-20220613102739353</figcaption></figure><p>springå£°æ˜å¼äº‹åŠ¡å“ªäº›åœºæ™¯ä¼šå¤±æ•ˆ</p><hr><ul><li>æ–¹æ³•çš„è®¿é—®æƒé™å¿…é¡»æ˜¯publicï¼Œå…¶ä»–privateç­‰æƒé™ï¼Œäº‹åŠ¡å¤±æ•ˆ</li><li>æ–¹æ³•è¢«å®šä¹‰æˆäº†finalçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</li><li>åœ¨åŒä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ç›´æ¥å†…éƒ¨è°ƒç”¨ï¼Œä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</li><li>ä¸€ä¸ªæ–¹æ³•å¦‚æœæ²¡äº¤ç»™springç®¡ç†ï¼Œå°±ä¸ä¼šç”Ÿæˆspringäº‹åŠ¡ã€‚</li><li>å¤šçº¿ç¨‹è°ƒç”¨ï¼Œä¸¤ä¸ªæ–¹æ³•ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè·å–åˆ°çš„æ•°æ®åº“è¿æ¥ä¸ä¸€æ ·çš„ã€‚</li><li>è¡¨çš„å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡</li><li>å¦‚æœè‡ªå·±try...catchè¯¯åäº†å¼‚å¸¸ï¼Œäº‹åŠ¡å¤±æ•ˆã€‚</li><li>é”™è¯¯çš„ä¼ æ’­</li></ul><h3 id="spring-boot" tabindex="-1"><a class="header-anchor" href="#spring-boot" aria-hidden="true">#</a> Spring Boot</h3><h4 id="æ¥å£å¹‚ç­‰æ˜¯å¦‚ä½•ä¿è¯çš„" tabindex="-1"><a class="header-anchor" href="#æ¥å£å¹‚ç­‰æ˜¯å¦‚ä½•ä¿è¯çš„" aria-hidden="true">#</a> æ¥å£å¹‚ç­‰æ˜¯å¦‚ä½•ä¿è¯çš„</h4><p><strong>ä»€ä¹ˆæ˜¯å¹‚ç­‰</strong>ï¼Ÿ</p><hr><p><code>å¹‚ç­‰åŸå…ˆæ˜¯æ•°å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¡¨ç¤ºè¿›è¡Œ1æ¬¡å˜æ¢å’Œè¿›è¡ŒNæ¬¡å˜æ¢äº§ç”Ÿçš„æ•ˆæœç›¸åŒã€‚</code></p><p>å½“æˆ‘ä»¬è®¨è®ºæ¥å£çš„å¹‚ç­‰æ€§æ—¶ä¸€èˆ¬æ˜¯åœ¨è¯´ï¼šä»¥ç›¸åŒçš„è¯·æ±‚è°ƒç”¨è¿™ä¸ªæ¥å£ä¸€æ¬¡å’Œè°ƒç”¨è¿™ä¸ªæ¥å£å¤šæ¬¡ï¼Œå¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ç›¸åŒçš„ã€‚å¦‚æœä¸€ä¸ªæ¥å£æ»¡è¶³è¿™ä¸ªç‰¹æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´è¿™ä¸ª æ¥å£æ˜¯ä¸€ä¸ªå¹‚ç­‰æ¥å£ã€‚</p><ul><li><strong>æ¥å£å¹‚ç­‰å’Œé˜²æ­¢é‡å¤æäº¤æ˜¯ä¸€å›äº‹å—</strong>ï¼Ÿ</li></ul><p>ä¸¥æ ¼æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ã€‚</p><ol><li><strong>å¹‚ç­‰</strong>: æ›´å¤šçš„æ˜¯åœ¨é‡å¤è¯·æ±‚å·²ç»å‘ç”Ÿï¼Œæˆ–æ˜¯æ— æ³•é¿å…çš„æƒ…å†µä¸‹ï¼Œé‡‡å–ä¸€å®šçš„æŠ€æœ¯æ‰‹æ®µè®©è¿™äº›é‡å¤è¯·æ±‚ä¸ç»™ç³»ç»Ÿå¸¦æ¥å‰¯ä½œç”¨ã€‚</li><li><strong>é˜²æ­¢é‡å¤</strong>: æäº¤æ›´å¤šçš„æ˜¯ä¸è®©ç”¨æˆ·å‘èµ·å¤šæ¬¡ä¸€æ ·çš„è¯·æ±‚ã€‚æ¯”å¦‚è¯´ç”¨æˆ·åœ¨çº¿è´­ç‰©ä¸‹å•æ—¶ç‚¹äº†æäº¤è®¢å•æŒ‰é’®ï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› å“åº”å¾ˆæ…¢ï¼Œæ­¤æ—¶ç”¨æˆ·æ¯”è¾ƒå¿ƒæ€¥å¤šæ¬¡ç‚¹å‡»äº†è®¢å•æäº¤æŒ‰é’®ã€‚ è¿™ç§æƒ…å†µä¸‹å°±å¯èƒ½ä¼šé€ æˆå¤šæ¬¡ä¸‹å•ã€‚ä¸€èˆ¬é˜²æ­¢é‡å¤æäº¤çš„æ–¹æ¡ˆæœ‰ï¼šå°†è®¢å•æŒ‰é’®ç½®ç°ï¼Œè·³è½¬åˆ°ç»“æœé¡µç­‰ã€‚ä¸»è¦è¿˜æ˜¯ä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ol><ul><li><strong>å“ªäº›æƒ…å†µä¸‹å®¢æˆ·ç«¯æ˜¯é˜²æ­¢ä¸äº†é‡å¤æäº¤çš„</strong>ï¼Ÿ</li></ul><p>è™½ç„¶æˆ‘ä»¬å¯åœ¨å®¢æˆ·ç«¯åšä¸€äº›é˜²æ­¢æ¥å£é‡å¤æäº¤çš„äº‹ï¼ˆæ¯”å¦‚å°†è®¢å•æŒ‰é’®ç½®ç°ï¼Œè·³è½¬åˆ°ç»“æœé¡µç­‰ï¼‰ï¼Œ ä½†æ˜¯å¦‚ä¸‹æƒ…å†µä¾ç„¶å®¢æˆ·ç«¯æ˜¯å¾ˆéš¾æ§åˆ¶æ¥å£é‡å¤æäº¤åˆ°åå°çš„ï¼Œè¿™ä¹Ÿè¿›ä¸€æ­¥è¡¨æ˜äº†<strong>æ¥å£å¹‚ç­‰å’Œé˜²æ­¢é‡å¤æäº¤ä¸æ˜¯ä¸€å›äº‹</strong>ä»¥åŠ<strong>åç«¯æ¥å£ä¿è¯æ¥å£å¹‚ç­‰çš„å¿…è¦æ€§</strong>æ‰€åœ¨ã€‚</p><ol><li><strong>æ¥å£è¶…æ—¶é‡è¯•</strong>ï¼šæ¥å£å¯èƒ½ä¼šå› ä¸ºæŸäº›åŸå› è€Œè°ƒç”¨å¤±è´¥ï¼Œå‡ºäºå®¹é”™æ€§è€ƒè™‘ä¼šåŠ ä¸Šå¤±è´¥é‡è¯•çš„æœºåˆ¶ã€‚å¦‚æœæ¥å£è°ƒç”¨ä¸€åŠï¼Œå†æ¬¡è°ƒç”¨å°±ä¼šå› ä¸ºè„æ•°æ®çš„å­˜åœ¨è€Œå‡ºç°å¼‚å¸¸ã€‚</li><li><strong>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</strong>ï¼šåœ¨ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¥å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸”æ‰‹åŠ¨ackç¡®è®¤æ¶ˆæ¯è¢«æ­£å¸¸æ¶ˆè´¹æ—¶ã€‚å¦‚æœæ¶ˆè´¹è€…çªç„¶æ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆå·²ç»æ‰§è¡Œäº†ä¸€åŠçš„æ¶ˆæ¯ä¼šé‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚è¢«å…¶ä»–æ¶ˆè´¹è€…é‡æ–°æ¶ˆè´¹æ—¶å°±ä¼šå¯¼è‡´ç»“æœå¼‚å¸¸ï¼Œå¦‚æ•°æ®åº“é‡å¤æ•°æ®ï¼Œæ•°æ®åº“æ•°æ®å†²çªï¼Œèµ„æºé‡å¤ç­‰ã€‚</li><li><strong>è¯·æ±‚é‡å‘</strong>ï¼šç½‘ç»œæŠ–åŠ¨å¼•å‘çš„nginxé‡å‘è¯·æ±‚ï¼Œé€ æˆé‡å¤è°ƒç”¨ï¼›</li></ol><p><strong>ä»€ä¹ˆæ˜¯å¹‚ç­‰æ¥å£</strong>ï¼Ÿ</p><hr><p>åœ¨HTTP/1.1ä¸­ï¼Œå¯¹å¹‚ç­‰æ€§è¿›è¡Œäº†å®šä¹‰ã€‚å®ƒæè¿°äº†ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºå¯¹äºèµ„æºæœ¬èº«åº”è¯¥å…·æœ‰åŒæ ·çš„ç»“æœï¼ˆç½‘ç»œè¶…æ—¶ç­‰é—®é¢˜é™¤å¤–ï¼‰ï¼Œå³ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å¯¹èµ„æºäº§ç”Ÿäº†å‰¯ä½œç”¨ï¼Œä½†æ˜¯ä»¥åçš„å¤šæ¬¡è¯·æ±‚éƒ½ä¸ä¼šå†å¯¹èµ„æºäº§ç”Ÿå‰¯ä½œç”¨ã€‚</p><p>è¿™é‡Œçš„å‰¯ä½œç”¨æ˜¯ä¸ä¼šå¯¹ç»“æœäº§ç”Ÿç ´åæˆ–è€…äº§ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œå¯¹èµ„æºæœ¬èº«æ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚</p><ul><li><strong>å¯¹å“ªäº›ç±»å‹çš„æ¥å£éœ€è¦ä¿è¯æ¥å£å¹‚ç­‰</strong>ï¼Ÿ</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹æ ‡å‡†çš„restfulè¯·æ±‚ï¼Œå¹‚ç­‰æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„ï¼š</p><ol><li>SELECTæŸ¥è¯¢æ“ä½œ <ol><li>GETï¼šåªæ˜¯è·å–èµ„æºï¼Œå¯¹èµ„æºæœ¬èº«æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ï¼Œå¤©ç„¶çš„å¹‚ç­‰æ€§ã€‚</li><li>HEADï¼šæœ¬è´¨ä¸Šå’ŒGETä¸€æ ·ï¼Œè·å–å¤´ä¿¡æ¯ï¼Œä¸»è¦æ˜¯æ¢æ´»çš„ä½œç”¨ï¼Œå…·æœ‰å¹‚ç­‰æ€§ã€‚</li><li>OPTIONSï¼šè·å–å½“å‰URLæ‰€æ”¯æŒçš„æ–¹æ³•ï¼Œå› æ­¤ä¹Ÿæ˜¯å…·æœ‰å¹‚ç­‰æ€§çš„ã€‚</li></ol></li><li>DELETEåˆ é™¤æ“ä½œ <ol><li>åˆ é™¤çš„æ“ä½œï¼Œå¦‚æœä»åˆ é™¤çš„ä¸€æ¬¡å’Œåˆ é™¤å¤šæ¬¡çš„è§’åº¦çœ‹ï¼Œæ•°æ®å¹¶ä¸ä¼šå˜åŒ–ï¼Œè¿™ä¸ªè§’åº¦çœ‹å®ƒæ˜¯å¹‚ç­‰çš„</li><li>ä½†æ˜¯å¦‚æœï¼Œä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œåˆ é™¤æ•°æ®ä¸€èˆ¬æ˜¯è¿”å›å—å½±å“çš„è¡Œæ•°ï¼Œåˆ é™¤ä¸€æ¬¡å’Œå¤šæ¬¡åˆ é™¤è¿”å›çš„å—å½±å“è¡Œæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦å®ƒéœ€è¦ä¿è¯å¹‚ç­‰ã€‚ï¼ˆæŠ˜ä¸­è€Œè¨€DELETEæ“ä½œé€šå¸¸ä¹Ÿä¼šè¢«çº³å…¥ä¿è¯æ¥å£å¹‚ç­‰çš„è¦æ±‚ï¼‰</li></ol></li><li>ADD/EDITæ“ä½œ <ol><li>PUTï¼šç”¨äºæ›´æ–°èµ„æºï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†æ˜¯å®ƒåº”è¯¥æ»¡è¶³å¹‚ç­‰æ€§ï¼Œæ¯”å¦‚æ ¹æ®idæ›´æ–°æ•°æ®ï¼Œè°ƒç”¨å¤šæ¬¡å’ŒNæ¬¡çš„ä½œç”¨æ˜¯ç›¸åŒçš„ï¼ˆæ ¹æ®ä¸šåŠ¡éœ€æ±‚è€Œå˜ï¼‰ã€‚</li><li>POSTï¼šç”¨äºæ·»åŠ èµ„æºï¼Œå¤šæ¬¡æäº¤å¾ˆå¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨ï¼Œæ¯”å¦‚è®¢å•æäº¤ï¼Œå¤šæ¬¡æäº¤å¾ˆå¯èƒ½äº§ç”Ÿå¤šç¬”è®¢å•ã€‚</li></ol></li></ol><p><strong>å¸¸è§çš„ä¿è¯å¹‚ç­‰çš„æ–¹å¼</strong></p><hr><p>å¦‚æœä½ è°ƒç”¨ä¸‹æ¸¸æ¥å£è¶…æ—¶äº†ï¼Œæ˜¯ä¸æ˜¯è€ƒè™‘é‡è¯•ï¼Ÿå¦‚æœé‡è¯•ï¼Œä¸‹æ¸¸æ¥å£å°±éœ€è¦æ”¯æŒå¹‚ç­‰å•¦ã€‚</p><p>å®ç°å¹‚ç­‰ä¸€èˆ¬æœ‰è¿™8ç§æ–¹æ¡ˆï¼š</p><ul><li>select+insert+ä¸»é”®/å”¯ä¸€ç´¢å¼•å†²çª</li><li>ç›´æ¥insert + ä¸»é”®/å”¯ä¸€ç´¢å¼•å†²çª</li><li>çŠ¶æ€æœºå¹‚ç­‰</li><li>æŠ½å–é˜²é‡è¡¨</li><li>tokenä»¤ç‰Œ</li><li>æ‚²è§‚é”(å¦‚select for updateï¼Œå¾ˆå°‘ç”¨) <ul><li>å…¸å‹çš„æ•°æ®åº“æ‚²è§‚é”ï¼šfor update</li></ul></li><li>ä¹è§‚é” <ul><li>é’ˆå¯¹æ›´æ–°æ“ä½œã€‚</li></ul></li><li>åˆ†å¸ƒå¼é” <ul><li>åˆ†å¸ƒå¼é”å®ç°å¹‚ç­‰æ€§çš„é€»è¾‘æ˜¯ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œæ–¹æ³•ä¹‹å‰åˆ¤æ–­ï¼Œæ˜¯å¦å¯ä»¥è·å–åˆ°åˆ†å¸ƒå¼é”ï¼Œå¦‚æœå¯ä»¥ï¼Œåˆ™è¡¨ç¤ºä¸ºç¬¬ä¸€æ¬¡æ‰§è¡Œæ–¹æ³•ï¼Œå¦åˆ™ç›´æ¥èˆå¼ƒè¯·æ±‚å³å¯</li></ul></li></ul><h3 id="netty" tabindex="-1"><a class="header-anchor" href="#netty" aria-hidden="true">#</a> Netty</h3><h4 id="è®²è®²ä½ ç†è§£çš„netty-çš„é›¶æ‹·è´-æœ‰ä»€ä¹ˆä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#è®²è®²ä½ ç†è§£çš„netty-çš„é›¶æ‹·è´-æœ‰ä»€ä¹ˆä¼˜ç‚¹" aria-hidden="true">#</a> è®²è®²ä½ ç†è§£çš„Netty çš„é›¶æ‹·è´ï¼Œæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h4><p><code>é›¶å¤åˆ¶ï¼ˆè‹±è¯­ï¼šZero-copyï¼›ä¹Ÿè¯‘é›¶æ‹·è´ï¼‰æŠ€æœ¯æ˜¯æŒ‡è®¡ç®—æœºæ‰§è¡Œæ“ä½œæ—¶ï¼ŒCPU ä¸éœ€è¦å…ˆå°†æ•°æ®ä»æŸå¤„å†…å­˜å¤åˆ¶åˆ°å¦ä¸€ä¸ªç‰¹å®šåŒºåŸŸã€‚è¿™ç§æŠ€æœ¯é€šå¸¸ç”¨äºé€šè¿‡ç½‘ç»œä¼ è¾“æ–‡ä»¶æ—¶èŠ‚çœ CPU å‘¨æœŸå’Œå†…å­˜å¸¦å®½ã€‚</code></p><p>åœ¨ OS å±‚é¢ä¸Šçš„ <code>Zero-copy</code> é€šå¸¸æŒ‡é¿å…åœ¨ <code>ç”¨æˆ·æ€(User-space)</code> ä¸ <code>å†…æ ¸æ€(Kernel-space)</code> ä¹‹é—´æ¥å›æ‹·è´æ•°æ®ã€‚è€Œåœ¨ Netty å±‚é¢ ï¼Œé›¶æ‹·è´ä¸»è¦ä½“ç°åœ¨å¯¹äºæ•°æ®æ“ä½œçš„ä¼˜åŒ–ã€‚</p><p>Netty ä¸­çš„é›¶æ‹·è´ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>ä½¿ç”¨ Netty æä¾›çš„ <code>CompositeByteBuf</code> ç±», å¯ä»¥å°†å¤šä¸ª <code>ByteBuf</code> åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ <code>ByteBuf</code>, é¿å…äº†å„ä¸ª <code>ByteBuf</code> ä¹‹é—´çš„æ‹·è´ã€‚</li><li><code>ByteBuf</code> æ”¯æŒ slice æ“ä½œ, å› æ­¤å¯ä»¥å°† ByteBuf åˆ†è§£ä¸ºå¤šä¸ªå…±äº«åŒä¸€ä¸ªå­˜å‚¨åŒºåŸŸçš„ <code>ByteBuf</code>, é¿å…äº†å†…å­˜çš„æ‹·è´ã€‚</li><li>é€šè¿‡ <code>FileRegion</code> åŒ…è£…çš„ <code>FileChannel.tranferTo</code> å®ç°æ–‡ä»¶ä¼ è¾“, å¯ä»¥ç›´æ¥å°†æ–‡ä»¶ç¼“å†²åŒºçš„æ•°æ®å‘é€åˆ°ç›®æ ‡ <code>Channel</code>, é¿å…äº†ä¼ ç»Ÿé€šè¿‡å¾ªç¯ write æ–¹å¼å¯¼è‡´çš„å†…å­˜æ‹·è´é—®é¢˜ã€‚</li><li>åœ¨å°†ä¸€ä¸ªbyteæ•°ç»„è½¬æ¢ä¸ºä¸€ä¸ªByteBufå¯¹è±¡çš„åœºæ™¯ä¸‹ï¼ŒNettyæä¾›äº†ä¸€ç³»åˆ—çš„åŒ…è£…ç±»ï¼Œé¿å…äº†è½¬æ¢è¿‡ç¨‹ä¸­çš„å†…å­˜æ‹·è´ã€‚</li><li>å¦‚æœé€šé“æ¥æ”¶å’Œå‘é€ByteBuféƒ½ä½¿ç”¨ç›´æ¥å†…å­˜è¿›è¡ŒSocketè¯»å†™ï¼Œå°±ä¸éœ€è¦è¿›è¡Œç¼“å†²åŒºçš„äºŒæ¬¡æ‹·è´ã€‚å¦‚æœä½¿ç”¨JVMçš„å †å†…å­˜è¿›è¡ŒSocketè¯»å†™ï¼Œé‚£ä¹ˆJVMä¼šå…ˆå°†å †å†…å­˜Bufferæ‹·è´ä¸€ä»½åˆ°ç›´æ¥å†…å­˜å†å†™å…¥Socketä¸­ï¼Œç›¸æ¯”äºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œè¿™ç§æƒ…å†µåœ¨å‘é€è¿‡ç¨‹ä¸­ä¼šå¤šå‡ºä¸€æ¬¡ç¼“å†²åŒºçš„å†…å­˜æ‹·è´ã€‚æ‰€ä»¥ï¼Œåœ¨å‘é€ByteBufferåˆ°Socketæ—¶ï¼Œå°½é‡ä½¿ç”¨ç›´æ¥å†…å­˜è€Œä¸æ˜¯JVMå †å†…å­˜</li></ol><h4 id="è®²è®²reactorçº¿ç¨‹æ¨¡å‹-nettyæ˜¯åŸºäºreactorçš„å“ªç§æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#è®²è®²reactorçº¿ç¨‹æ¨¡å‹-nettyæ˜¯åŸºäºreactorçš„å“ªç§æ¨¡å¼" aria-hidden="true">#</a> è®²è®²Reactorçº¿ç¨‹æ¨¡å‹ï¼Œnettyæ˜¯åŸºäºReactorçš„å“ªç§æ¨¡å¼ï¼Ÿ</h4><p>Reactoræ˜¯ä¸€ç§å¹¶å‘å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å“åº”çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚æœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åé‡‡ç”¨å¤šè·¯å¤ç”¨ç­–ç•¥ï¼Œé€šè¿‡ä¸€ä¸ªéé˜»å¡çš„çº¿ç¨‹æ¥å¼‚æ­¥æ¥æ”¶æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚è½¬å‘åˆ°ç›¸å…³çš„å·¥ä½œçº¿ç¨‹ç»„ä¸Šè¿›è¡Œå¤„ç†ã€‚Reactoræ¨¡å‹å¸¸å¸¸åŸºäºå¼‚æ­¥çº¿ç¨‹çš„æ–¹å¼å®ç°ï¼Œå¸¸ç”¨çš„Reactorçº¿ç¨‹æ¨¡å‹æœ‰3ç§ï¼šReactorå•çº¿ç¨‹æ¨¡å‹ã€Reactorå¤šçº¿ç¨‹æ¨¡å‹å’ŒReactorä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹</p><p>Reactoræ¨¡å¼ç”±Reactorçº¿ç¨‹ã€Handlerså¤„ç†å™¨ä¸¤å¤§è§’è‰²ç»„æˆï¼Œä¸¤å¤§è§’è‰²çš„èŒè´£åˆ†åˆ«å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰Reactorçº¿ç¨‹çš„èŒè´£ï¼šè´Ÿè´£å“åº”IOäº‹ä»¶ï¼Œå¹¶ä¸”åˆ†å‘åˆ°Handlerså¤„ç†å™¨ã€‚</p><p>ï¼ˆ2ï¼‰Handlerså¤„ç†å™¨çš„èŒè´£ï¼šéé˜»å¡çš„æ‰§è¡Œä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚</p><p>1.<strong>å•çº¿ç¨‹æ¨¡å‹</strong> ï¼š</p><p>æ€»ä½“æ¥è¯´ï¼ŒReactoræ¨¡å¼æœ‰ç‚¹ç±»ä¼¼äº‹ä»¶é©±åŠ¨æ¨¡å¼ã€‚åœ¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸­ï¼Œå½“æœ‰äº‹ä»¶è§¦å‘æ—¶ï¼Œäº‹ä»¶æºä¼šå°†äº‹ä»¶åˆ†å‘åˆ°Handlerï¼ˆå¤„ç†å™¨ï¼‰ï¼Œç”±Handlerè´Ÿè´£äº‹ä»¶å¤„ç†ã€‚Reactoræ¨¡å¼ä¸­çš„ååº”å™¨è§’è‰²ç±»ä¼¼äºäº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸­çš„äº‹ä»¶åˆ†å‘å™¨ï¼ˆDispatcherï¼‰è§’è‰²ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨Reactoræ¨¡å¼ä¸­æœ‰Reactorå’ŒHandlerä¸¤ä¸ªé‡è¦çš„ç»„ä»¶ï¼š</p><p>ï¼ˆ1ï¼‰Reactorï¼šè´Ÿè´£æŸ¥è¯¢IOäº‹ä»¶ï¼Œå½“æ£€æµ‹åˆ°ä¸€ä¸ªIOäº‹ä»¶æ—¶å°†å…¶å‘é€ç»™ç›¸åº”çš„Handlerå¤„ç†å™¨å»å¤„ç†ã€‚è¿™é‡Œçš„IOäº‹ä»¶å°±æ˜¯NIOä¸­é€‰æ‹©å™¨æŸ¥è¯¢å‡ºæ¥çš„é€šé“IOäº‹ä»¶ã€‚</p><p>ï¼ˆ2ï¼‰Handlerï¼šä¸IOäº‹ä»¶ï¼ˆæˆ–è€…é€‰æ‹©é”®ï¼‰ç»‘å®šï¼Œè´Ÿè´£IOäº‹ä»¶çš„å¤„ç†ï¼Œå®ŒæˆçœŸæ­£çš„è¿æ¥å»ºç«‹ã€é€šé“çš„è¯»å–ã€å¤„ç†ä¸šåŠ¡é€»è¾‘ã€è´Ÿè´£å°†ç»“æœå†™åˆ°é€šé“ç­‰ã€‚</p><p>ä»€ä¹ˆæ˜¯å•çº¿ç¨‹ç‰ˆæœ¬çš„Reactoræ¨¡å¼å‘¢ï¼Ÿç®€å•åœ°è¯´ï¼ŒReactorå’ŒHandlerså¤„äºä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™æ˜¯æœ€ç®€å•çš„Reactoræ¨¡å‹ï¼ˆå›¾ç‰‡æ¥è‡ªã€Šofferæ¥äº†ã€‹ï¼‰</p><figure><img src="'+A+'" alt="image-20220627102520442" tabindex="0" loading="lazy"><figcaption>image-20220627102520442</figcaption></figure><p>2.<strong>å¤šçº¿ç¨‹æ¨¡å‹</strong></p><p>Reactorå’ŒHandleræŒ¤åœ¨å•ä¸ªçº¿ç¨‹ä¸­ä¼šé€ æˆéå¸¸ä¸¥é‡çš„æ€§èƒ½ç¼ºé™·ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¯¹åŸºç¡€çš„Reactoræ¨¡å¼è¿›è¡Œæ”¹é€ å’Œæ¼”è¿›</p><p>å¤šçº¿ç¨‹Reactorçš„æ¼”è¿›åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼š</p><p>ï¼ˆ1ï¼‰å‡çº§Handlerã€‚æ—¢è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œåˆè¦å°½å¯èƒ½é«˜æ•ˆç‡ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p><p>ï¼ˆ2ï¼‰å‡çº§Reactorã€‚å¯ä»¥è€ƒè™‘å¼•å…¥å¤šä¸ªSelectorï¼ˆé€‰æ‹©å™¨ï¼‰ï¼Œæå‡é€‰æ‹©å¤§é‡é€šé“çš„èƒ½åŠ›ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œå¤šçº¿ç¨‹ç‰ˆæœ¬çš„Reactoræ¨¡å¼å¤§è‡´å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰å°†è´Ÿè´£æ•°æ®ä¼ è¾“å¤„ç†çš„IOHandlerå¤„ç†å™¨çš„æ‰§è¡Œæ”¾å…¥ç‹¬ç«‹çš„çº¿ç¨‹æ± ä¸­ã€‚è¿™æ ·ï¼Œä¸šåŠ¡å¤„ç†çº¿ç¨‹ä¸è´Ÿè´£æ–°è¿æ¥ç›‘å¬çš„ååº”å™¨çº¿ç¨‹å°±èƒ½ç›¸äº’éš”ç¦»ï¼Œé¿å…æœåŠ¡å™¨çš„è¿æ¥ç›‘å¬å—åˆ°é˜»å¡ã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœæœåŠ¡å™¨ä¸ºå¤šæ ¸çš„CPUï¼Œå¯ä»¥å°†ååº”å™¨çº¿ç¨‹æ‹†åˆ†ä¸ºå¤šä¸ªå­ååº”å™¨ï¼ˆSubReactorï¼‰çº¿ç¨‹ï¼›åŒæ—¶ï¼Œå¼•å…¥å¤šä¸ªé€‰æ‹©å™¨ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªSubReactorå¼•å…¥ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ä¸€ä¸ªé€‰æ‹©å™¨çš„äº‹ä»¶è½®è¯¢ã€‚è¿™æ ·å……åˆ†é‡Šæ”¾äº†ç³»ç»Ÿèµ„æºçš„èƒ½åŠ›ï¼Œä¹Ÿå¤§å¤§æå‡äº†ååº”å™¨ç®¡ç†å¤§é‡è¿æ¥æˆ–è€…ç›‘å¬å¤§é‡ä¼ è¾“é€šé“çš„èƒ½åŠ›</p><p>Reactorå¤šçº¿ç¨‹æ¨¡å‹ä¸å•çº¿ç¨‹æ¨¡å‹æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ç”±ä¸€ç»„çº¿ç¨‹ï¼ˆThread Pollï¼‰å¤„ç†å®¢æˆ·ç«¯çš„I/Oè¯·æ±‚æ“ä½œã€‚Reactorå¤šçº¿ç¨‹æ¨¡å‹å°†Acceptorçš„æ“ä½œå°è£…åœ¨ä¸€ç»„çº¿ç¨‹æ± ä¸­ï¼Œé‡‡ç”¨çº¿ç¨‹æ± çš„æ–¹å¼ç›‘å¬æœåŠ¡ç«¯ç«¯å£ã€æ¥æ”¶å®¢æˆ·ç«¯çš„TCPè¿æ¥è¯·æ±‚ã€å¤„ç†ç½‘ç»œI/Oè¯»å†™ç­‰æ“ä½œã€‚çº¿ç¨‹æ± ä¸€èˆ¬ä½¿ç”¨æ ‡å‡†çš„JDKçº¿ç¨‹æ± ï¼Œåœ¨è¯¥çº¿ç¨‹æ± ä¸­åŒ…å«ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å’Œä¸€ç³»åˆ—NIOçº¿ç¨‹ï¼Œè¿™äº›NIOçº¿ç¨‹è´Ÿè´£å…·ä½“çš„æ¶ˆæ¯è¯»å–ã€è§£ç ã€ç¼–ç å’Œå‘é€ã€‚Reactorå¤šçº¿ç¨‹æ¨¡å‹å¦‚å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªã€Šofferæ¥äº†ã€‹ï¼‰</p><figure><img src="'+N+'" alt="image-20220627102705221" tabindex="0" loading="lazy"><figcaption>image-20220627102705221</figcaption></figure><p><strong>3.ä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹</strong> [nettyä½¿ç”¨çš„æ–¹å¼]</p><p>åœ¨Reactorä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒæœåŠ¡ç«¯ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„ä¸å†æ˜¯ä¸€ä¸ªNIOçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„NIOçº¿ç¨‹æ± ã€‚ä¸»çº¿ç¨‹Acceptoråœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„TCPè¿æ¥è¯·æ±‚å¹¶å»ºç«‹å®Œæˆè¿æ¥åï¼ˆå¯èƒ½è¦ç»è¿‡é‰´æƒã€ç™»å½•ç­‰è¿‡ç¨‹ï¼‰ï¼Œå°†æ–°åˆ›å»ºçš„SocketChannelæ³¨å†Œåˆ°å­I/Oçº¿ç¨‹æ± ï¼ˆSub Reactor Poolï¼‰çš„æŸä¸ªI/Oçº¿ç¨‹ä¸Šï¼Œç”±å®ƒè´Ÿè´£å…·ä½“çš„SocketChannelçš„è¯»å†™å’Œç¼–è§£ç å·¥ä½œã€‚Reactorä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹ä¸­çš„Acceptorçº¿ç¨‹æ± ï¼ˆAcceptor Thread Poolï¼‰åªç”¨äºå®¢æˆ·ç«¯çš„é‰´æƒã€ç™»å½•ã€æ¡æ‰‹å’Œå®‰å…¨è®¤è¯ï¼Œä¸€æ—¦é“¾è·¯å»ºç«‹æˆåŠŸï¼Œå°±å°†é“¾è·¯æ³¨å†Œåˆ°åç«¯Sub Reactorçº¿ç¨‹æ± çš„I/Oçº¿ç¨‹ä¸Šï¼Œç”±I/Oçº¿ç¨‹è´Ÿè´£åç»­çš„I/Oæ“ä½œã€‚è¿™æ ·å°±å°†å®¢æˆ·ç«¯è¿æ¥çš„å»ºç«‹å’Œæ¶ˆæ¯çš„å“åº”éƒ½ä»¥å¼‚æ­¥çº¿ç¨‹çš„æ–¹å¼æ¥å®ç°ï¼Œå¤§å¤§æé«˜äº†ç³»ç»Ÿçš„ååé‡ã€‚Reactorä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹å¦‚å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªã€Šofferæ¥äº†ã€‹ï¼‰</p><figure><img src="'+M+'" alt="image-20220627102814208" tabindex="0" loading="lazy"><figcaption>image-20220627102814208</figcaption></figure><h4 id="äº†è§£nio-çš„epoll-bugå—-è°ˆè°ˆepoll-bugçš„å±å®³-æ»´æ»´" tabindex="-1"><a class="header-anchor" href="#äº†è§£nio-çš„epoll-bugå—-è°ˆè°ˆepoll-bugçš„å±å®³-æ»´æ»´" aria-hidden="true">#</a> äº†è§£NIO çš„epoll bugå—ï¼Ÿè°ˆè°ˆepoll bugçš„å±å®³ ï¼ˆæ»´æ»´ï¼‰</h4><p>epollæ˜¯Linuxä¸‹ä¸€ç§é«˜æ•ˆçš„IOå¤ç”¨æ–¹å¼ï¼Œç›¸è¾ƒäºselectå’Œpollæœºåˆ¶æ¥è¯´ã€‚å…¶é«˜æ•ˆçš„åŸå› æ˜¯å°†åŸºäºäº‹ä»¶çš„fdæ”¾åˆ°å†…æ ¸ä¸­æ¥å®Œæˆï¼Œåœ¨å†…æ ¸ä¸­åŸºäºçº¢é»‘æ ‘+é“¾è¡¨æ•°æ®ç»“æ„æ¥å®ç°ï¼Œé“¾è¡¨å­˜æ”¾æœ‰äº‹ä»¶å‘ç”Ÿçš„fdé›†åˆï¼Œç„¶ååœ¨è°ƒç”¨epoll_waitæ—¶è¿”å›ç»™åº”ç”¨ç¨‹åºï¼Œç”±åº”ç”¨ç¨‹åºæ¥å¤„ç†è¿™äº›fdäº‹ä»¶ã€‚</p><p>ä½¿ç”¨IOå¤šè·¯å¤ç”¨ï¼ŒLinuxä¸‹ä¸€èˆ¬é»˜è®¤å°±æ˜¯epollï¼ŒJava NIOåœ¨Linuxä¸‹é»˜è®¤ä¹Ÿæ˜¯epollæœºåˆ¶ï¼Œä½†æ˜¯JDKä¸­epollçš„å®ç°å´æ˜¯æœ‰æ¼æ´çš„ã€‚å…¶ä¸­ä¸€ä¸ªå°±æ˜¯Epollçš„ç©ºè½®è¯¢Bug, å°±æ˜¯å³ä½¿æ˜¯å…³æ³¨çš„selectè½®è¯¢äº‹ä»¶è¿”å›æ•°é‡ä¸º0ï¼ŒNIOç…§æ ·ä¸æ–­çš„ä»selectæœ¬åº”è¯¥é˜»å¡çš„Selector.select()/Selector.select(timeout)ä¸­wake upå‡ºæ¥ï¼Œå¯¼è‡´CPUé£™åˆ°100%é—®é¢˜ã€‚</p><p>å®˜æ–¹ç»™çš„Bugå¤ç°æ–¹æ³•:</p><p>A DESCRIPTION OF THE PROBLEM : The NIO selector wakes up infinitely in this situation.. 0. server waits for connectionã€</p><ol><li>client connects and write message</li><li>server accepts and register OP_READ</li><li>server reads message and remove OP_READ from interest op set</li><li>client close the connection</li><li>server write message (without any reading.. surely OP_READ is not set)</li><li>serverâ€™s select wakes up infinitely with return value 0</li></ol><p>äº§ç”Ÿè¿™ä¸€Bugçš„åŸå› ï¼š</p><p>å› ä¸ºpollå’Œepollå¯¹äºçªç„¶ä¸­æ–­çš„è¿æ¥socketä¼šå¯¹è¿”å›çš„eventSetäº‹ä»¶é›†åˆç½®ä¸ºEPOLLHUPæˆ–è€…EPOLLERRï¼ŒeventSetäº‹ä»¶é›†åˆå‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™å°±å¯¼è‡´Selectorä¼šè¢«å”¤é†’ï¼Œå¦‚æœä»…ä»…æ˜¯å› ä¸ºè¿™ä¸ªåŸå› å”¤é†’ä¸”æ²¡æœ‰æ„Ÿå…´è¶£çš„æ—¶é—´å‘ç”Ÿçš„è¯ï¼Œå°±ä¼šå˜æˆç©ºè½®è¯¢ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼šè‹¥Selectorçš„è½®è¯¢ç»“æœä¸ºç©ºï¼Œä¹Ÿæ²¡æœ‰wakeupæˆ–æ–°æ¶ˆæ¯å¤„ç†ï¼Œåˆ™å‘ç”Ÿç©ºè½®è¯¢ï¼ŒCPUä½¿ç”¨ç‡100%</p><p><strong>Nettyçš„è§£å†³åŠæ³•</strong></p><ul><li>å¯¹Selectorçš„selectæ“ä½œå‘¨æœŸè¿›è¡Œç»Ÿè®¡ï¼Œæ¯å®Œæˆä¸€æ¬¡ç©ºçš„selectæ“ä½œè¿›è¡Œä¸€æ¬¡è®¡æ•°ï¼Œ</li><li>è‹¥åœ¨æŸä¸ªå‘¨æœŸå†…è¿ç»­å‘ç”ŸNæ¬¡ç©ºè½®è¯¢ï¼Œåˆ™è§¦å‘äº†epollæ­»å¾ªç¯bugã€‚</li><li>é‡å»ºSelectorï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯å…¶ä»–çº¿ç¨‹å‘èµ·çš„é‡å»ºè¯·æ±‚ï¼Œè‹¥ä¸æ˜¯åˆ™å°†åŸSocketChannelä»æ—§çš„Selectorä¸Šå»é™¤æ³¨å†Œï¼Œé‡æ–°æ³¨å†Œåˆ°æ–°çš„Selectorä¸Šï¼Œå¹¶å°†åŸæ¥çš„Selectorå…³é—­ã€‚</li></ul><h2 id="ğŸ¤¹â€â™‚ï¸å¾®æœåŠ¡ã€åˆ†å¸ƒå¼" tabindex="-1"><a class="header-anchor" href="#ğŸ¤¹â€â™‚ï¸å¾®æœåŠ¡ã€åˆ†å¸ƒå¼" aria-hidden="true">#</a> ğŸ¤¹â€â™‚ï¸å¾®æœåŠ¡ã€åˆ†å¸ƒå¼</h2><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡äº†è§£å—" aria-hidden="true">#</a> åˆ†å¸ƒå¼äº‹åŠ¡äº†è§£å—ï¼Ÿ</h3><p><strong>äº‹åŠ¡</strong>æ˜¯ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒï¼Œé‡Œé¢çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™äº›æ“ä½œå¯èƒ½æ˜¯ä½äºä¸åŒçš„æœåŠ¡ä¸­ï¼Œé‚£ä¹ˆå¦‚æœä¹Ÿèƒ½ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥å‘¢ï¼Ÿè¿™ä¾¿æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜ã€‚</p><p><strong>ä»¥ä¸€ä¸ªç½‘ä¸Šçš„ç»å…¸ä¸‹å•å‡åº“å­˜ä¾‹å­ä¸ºä¾‹</strong>ï¼š</p><p>å•ä½“åº”ç”¨æ‰€æœ‰çš„ä¸šåŠ¡éƒ½ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ï¼Œæ•´ä¸ªä¸‹å•æµç¨‹æˆ–è®¸åªç”¨åœ¨ä¸€ä¸ªæ–¹æ³•é‡ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸‹æ“ä½œæ•°æ®åº“å³å¯ã€‚æ­¤æ—¶æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œè¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚</p><figure><img src="'+E+'" alt="image-20220603195940545" tabindex="0" loading="lazy"><figcaption>image-20220603195940545</figcaption></figure><p>ä½†éšç€ä¸šåŠ¡é‡ä¸æ–­å¢é•¿ï¼Œä¸šåŠ¡æœåŠ¡åŒ–æ‹†åˆ†ï¼Œå°±ä¼šåˆ†ç¦»å‡ºè®¢å•ä¸­å¿ƒã€åº“å­˜ä¸­å¿ƒç­‰ã€‚è€Œè¿™æ ·å°±é€ æˆä¸šåŠ¡é—´ç›¸äº’éš”ç¦»ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½ç»´æŠ¤ç€è‡ªå·±çš„æ•°æ®åº“ï¼Œæ•°æ®çš„äº¤æ¢åªèƒ½è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚</p><p>ç”¨æˆ·å†ä¸‹å•æ—¶ï¼Œåˆ›å»ºè®¢å•å’Œæ‰£å‡åº“å­˜ï¼Œéœ€è¦åŒæ—¶å¯¹è®¢å•DBå’Œåº“å­˜DBè¿›è¡Œæ“ä½œã€‚ä¸¤æ­¥æ“ä½œå¿…é¡»åŒæ—¶æˆåŠŸï¼Œå¦åˆ™å°±ä¼šé€ æˆä¸šåŠ¡æ··ä¹±ï¼Œå¯æ­¤æ—¶æˆ‘ä»¬åªèƒ½ä¿è¯è‡ªå·±æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæ— æ³•ä¿è¯è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ“ä½œæ˜¯å¦æˆåŠŸï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯æ•´ä¸ªä¸‹å•æµç¨‹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå°±éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ä»‹å…¥ã€‚</p><figure><img src="'+O+'" alt="image-20220603195954495" tabindex="0" loading="lazy"><figcaption>image-20220603195954495</figcaption></figure>',99),ut={href:"https://www.pdai.tech/md/arch/arch-z-transection.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1",target:"_blank",rel:"noopener noreferrer"},dt=t('<p>ä»¥åŠåç»­å¯èƒ½ä¼šé—®åˆ°ï¼šè¯´ä¸€ä¸‹æ€ä¹ˆå®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„è§£å†³æ–¹æ¡ˆï¼ŸRocketMQ èƒ½åšåˆ†å¸ƒå¼äº‹åŠ¡å—ï¼Ÿ</p><h3 id="rpcäº†è§£å—" tabindex="-1"><a class="header-anchor" href="#rpcäº†è§£å—" aria-hidden="true">#</a> rpcäº†è§£å—</h3><p><strong>ä½•ä¸º RPC?</strong></p><hr><p>RPCï¼ˆRemote Procedure Callï¼‰ å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé€šè¿‡åå­—æˆ‘ä»¬å°±èƒ½çœ‹å‡º RPC å…³æ³¨çš„æ˜¯è¿œç¨‹è°ƒç”¨è€Œéæœ¬åœ°è°ƒç”¨ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ RPC ï¼Ÿ å› ä¸ºï¼Œä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„æœåŠ¡æä¾›çš„æ–¹æ³•ä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ‰èƒ½ä¼ é€’æ–¹æ³•è°ƒç”¨æ‰€éœ€è¦çš„å‚æ•°ã€‚å¹¶ä¸”ï¼Œæ–¹æ³•è°ƒç”¨çš„ç»“æœä¹Ÿéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ¥æ¥æ”¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ç½‘ç»œç¼–ç¨‹æ¥å®ç°è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹çš„è¯å·¥ä½œé‡æ˜¯éå¸¸å¤§çš„ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åº•å±‚ä¼ è¾“æ–¹å¼ï¼ˆTCPè¿˜æ˜¯UDPï¼‰ã€åºåˆ—åŒ–æ–¹å¼ç­‰ç­‰æ–¹é¢ã€‚</p><p>RPC èƒ½å¸®åŠ©æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ ç®€å•æ¥è¯´ï¼Œé€šè¿‡ RPC å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸ŠæŸä¸ªæœåŠ¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å¹¶ä¸”ï¼æˆ‘ä»¬ä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œç¼–ç¨‹çš„å…·ä½“ç»†èŠ‚ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šä¸¤ä¸ªä¸åŒçš„æœåŠ¡ Aã€B éƒ¨ç½²åœ¨ä¸¤å°ä¸åŒçš„æœºå™¨ä¸Šï¼ŒæœåŠ¡ A å¦‚æœæƒ³è¦è°ƒç”¨æœåŠ¡ B ä¸­çš„æŸä¸ªæ–¹æ³•çš„è¯å°±å¯ä»¥é€šè¿‡ RPC æ¥åšã€‚</p><p>ä¸€è¨€è”½ä¹‹ï¼šRPC çš„å‡ºç°å°±æ˜¯ä¸ºäº†è®©ä½ è°ƒç”¨è¿œç¨‹æ–¹æ³•åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚</p><p><strong>RPC çš„åŸç†æ˜¯ä»€ä¹ˆ?</strong></p><hr><p>ä¸ºäº†èƒ½å¤Ÿå¸®åŠ©å°ä¼™ä¼´ä»¬ç†è§£ RPC åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ª RPCçš„ æ ¸å¿ƒåŠŸèƒ½çœ‹ä½œæ˜¯ä¸‹é¢ğŸ‘‡ 6 ä¸ªéƒ¨åˆ†å®ç°çš„ï¼š</p><ol><li><strong>å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹ç«¯ï¼‰</strong> ï¼šè°ƒç”¨è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚</li><li><strong>å®¢æˆ·ç«¯ Stubï¼ˆæ¡©ï¼‰</strong> ï¼š è¿™å…¶å®å°±æ˜¯ä¸€ä»£ç†ç±»ã€‚ä»£ç†ç±»ä¸»è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠä½ è°ƒç”¨æ–¹æ³•ã€ç±»ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯ä¼ é€’åˆ°æœåŠ¡ç«¯ã€‚</li><li><strong>ç½‘ç»œä¼ è¾“</strong> ï¼š ç½‘ç»œä¼ è¾“å°±æ˜¯ä½ è¦æŠŠä½ è°ƒç”¨çš„æ–¹æ³•çš„ä¿¡æ¯æ¯”å¦‚è¯´å‚æ•°å•Šè¿™äº›ä¸œè¥¿ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯æ‰§è¡Œå®Œä¹‹åå†æŠŠè¿”å›ç»“æœé€šè¿‡ç½‘ç»œä¼ è¾“ç»™ä½ ä¼ è¾“å›æ¥ã€‚ç½‘ç»œä¼ è¾“çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§æ¯”å¦‚æœ€è¿‘åŸºæœ¬çš„ Socketæˆ–è€…æ€§èƒ½ä»¥åŠå°è£…æ›´åŠ ä¼˜ç§€çš„ Nettyï¼ˆæ¨èï¼‰ã€‚</li><li><strong>æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰</strong> ï¼šè¿™ä¸ªæ¡©å°±ä¸æ˜¯ä»£ç†ç±»äº†ã€‚æˆ‘è§‰å¾—ç†è§£ä¸ºæ¡©å®é™…ä¸å¤ªå¥½ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹å°±å¥½ã€‚è¿™é‡Œçš„æœåŠ¡ç«¯ Stub å®é™…æŒ‡çš„å°±æ˜¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ‰§è¡Œæ–¹æ³•çš„è¯·æ±‚åï¼Œå»æŒ‡å®šå¯¹åº”çš„æ–¹æ³•ç„¶åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯çš„ç±»ã€‚</li><li><strong>æœåŠ¡ç«¯ï¼ˆæœåŠ¡æä¾›ç«¯ï¼‰</strong> ï¼šæä¾›è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚</li></ol><p>å…·ä½“åŸç†å›¾å¦‚ä¸‹ï¼Œåé¢æˆ‘ä¼šä¸²èµ·æ¥å°†æ•´ä¸ªRPCçš„è¿‡ç¨‹ç»™å¤§å®¶è¯´ä¸€ä¸‹ã€‚</p><figure><img src="'+B+'" alt="image-20220602105047295" tabindex="0" loading="lazy"><figcaption>image-20220602105047295</figcaption></figure><ol><li>æœåŠ¡æ¶ˆè´¹ç«¯ï¼ˆclientï¼‰ä»¥æœ¬åœ°è°ƒç”¨çš„æ–¹å¼è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼›</li><li>å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼ˆåºåˆ—åŒ–ï¼‰ï¼š<code>RpcRequest</code>ï¼›</li><li>å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ‰¾åˆ°è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡æä¾›ç«¯ï¼›</li><li>æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ”¶åˆ°æ¶ˆæ¯å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡: <code>RpcRequest</code>ï¼›</li><li>æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ ¹æ® <code>RpcRequest</code>ä¸­çš„ç±»ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯è°ƒç”¨æœ¬åœ°çš„æ–¹æ³•ï¼›</li><li>æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰å¾—åˆ°æ–¹æ³•æ‰§è¡Œç»“æœå¹¶å°†ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼š<code>RpcResponse</code>ï¼ˆåºåˆ—åŒ–ï¼‰å‘é€è‡³æ¶ˆè´¹æ–¹ï¼›</li><li>å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡:<code>RpcResponse</code> ï¼Œè¿™æ ·ä¹Ÿå°±å¾—åˆ°äº†æœ€ç»ˆç»“æœã€‚over!</li></ol><p>ç›¸ä¿¡å°ä¼™ä¼´ä»¬çœ‹å®Œä¸Šé¢çš„è®²è§£ä¹‹åï¼Œå·²ç»äº†è§£äº† RPC çš„åŸç†ã€‚</p><p>è™½ç„¶ç¯‡å¹…ä¸å¤šï¼Œä½†æ˜¯åŸºæœ¬æŠŠ RPC æ¡†æ¶çš„æ ¸å¿ƒåŸç†è®²æ¸…æ¥šäº†ï¼å¦å¤–ï¼Œå¯¹äºä¸Šé¢çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ‘ä¼šåœ¨åé¢çš„ç« èŠ‚ä»‹ç»åˆ°ã€‚</p><p><strong>æœ€åï¼Œå¯¹äº RPC çš„åŸç†ï¼Œå¸Œæœ›å°ä¼™ä¼´ä¸å•å•è¦ç†è§£ï¼Œè¿˜è¦èƒ½å¤Ÿè‡ªå·±ç”»å‡ºæ¥å¹¶ä¸”èƒ½å¤Ÿç»™åˆ«äººè®²å‡ºæ¥ã€‚å› ä¸ºï¼Œåœ¨é¢è¯•ä¸­è¿™ä¸ªé—®é¢˜åœ¨é¢è¯•å®˜é—®åˆ° RPC ç›¸å…³å†…å®¹çš„æ—¶å€™åŸºæœ¬éƒ½ä¼šç¢°åˆ°ã€‚</strong></p><h3 id="rpcå¦‚ä½•å®ç°çš„-å¦‚ä½•å®ç°è°ƒåº¦çš„-2022è™¾çš®" tabindex="-1"><a class="header-anchor" href="#rpcå¦‚ä½•å®ç°çš„-å¦‚ä½•å®ç°è°ƒåº¦çš„-2022è™¾çš®" aria-hidden="true">#</a> RPCå¦‚ä½•å®ç°çš„ï¼Ÿå¦‚ä½•å®ç°è°ƒåº¦çš„ï¼Ÿï¼ˆ2022è™¾çš®ï¼‰</h3><h3 id="è®²è®²å¾®æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#è®²è®²å¾®æœåŠ¡" aria-hidden="true">#</a> è®²è®²å¾®æœåŠ¡</h3><p>ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ</p><hr><ul><li>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒæŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†æˆä¸ºä¸åŒçš„æœåŠ¡å•å…ƒï¼Œè§£å†³å•ä½“ç³»ç»Ÿæ€§èƒ½ç­‰ä¸è¶³ã€‚</li><li>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œä¸€ä¸ªå¤§å‹è½¯ä»¶åº”ç”¨ç”±å¤šä¸ªæœåŠ¡å•å…ƒç»„æˆã€‚ç³»ç»Ÿä¸­çš„æœåŠ¡å•å…ƒå¯ä»¥å•ç‹¬éƒ¨ç½²ï¼Œå„ä¸ªæœåŠ¡å•å…ƒä¹‹é—´æ˜¯æ¾è€¦åˆçš„ã€‚</li></ul><h3 id="å¾®æœåŠ¡ä¸¤å°æœºå™¨æ€ä¹ˆé€šä¿¡å‘¢-å¾®æœåŠ¡ä¹‹é—´æ˜¯æ€ä¹ˆè”ç³»" tabindex="-1"><a class="header-anchor" href="#å¾®æœåŠ¡ä¸¤å°æœºå™¨æ€ä¹ˆé€šä¿¡å‘¢-å¾®æœåŠ¡ä¹‹é—´æ˜¯æ€ä¹ˆè”ç³»" aria-hidden="true">#</a> å¾®æœåŠ¡ä¸¤å°æœºå™¨æ€ä¹ˆé€šä¿¡å‘¢ï¼Ÿ | å¾®æœåŠ¡ä¹‹é—´æ˜¯æ€ä¹ˆè”ç³»ï¼Ÿ</h3><p>åŒæ­¥é€šä¿¡ï¼šdobboé€šè¿‡ <strong>RPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€springcloudé€šè¿‡ REST æ¥å£jsonè°ƒç”¨</strong> ç­‰ã€‚</p><p>å¼‚æ­¥ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ï¼š<strong>RabbitMqã€ActiveMã€Kafka</strong> ç­‰ã€‚</p><h3 id="å¾®æœåŠ¡éƒ½æœ‰ä»€ä¹ˆéƒ¨åˆ†å‘¢" tabindex="-1"><a class="header-anchor" href="#å¾®æœåŠ¡éƒ½æœ‰ä»€ä¹ˆéƒ¨åˆ†å‘¢" aria-hidden="true">#</a> å¾®æœåŠ¡éƒ½æœ‰ä»€ä¹ˆéƒ¨åˆ†å‘¢</h3><p>è¿™é‡Œè°ƒç”¨é˜³å“¥PPTçš„ç¥å›¾</p><figure><img src="'+D+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+z+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="æ³¨å†Œä¸­å¿ƒæ˜¯ä»€ä¹ˆè®²è®²" tabindex="-1"><a class="header-anchor" href="#æ³¨å†Œä¸­å¿ƒæ˜¯ä»€ä¹ˆè®²è®²" aria-hidden="true">#</a> æ³¨å†Œä¸­å¿ƒæ˜¯ä»€ä¹ˆè®²è®²</h3><p>å‚è€ƒï¼š</p>',33),kt={href:"https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/",target:"_blank",rel:"noopener noreferrer"},mt=t('<p>æœåŠ¡å‘ç°ï¼š</p><p>ä¸ºäº†å‘å‡ºè¯·æ±‚ï¼Œæ‚¨çš„ä»£ç éœ€è¦çŸ¥é“æœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®ï¼ˆIP åœ°å€å’Œç«¯å£ï¼‰ï¼Œä¼ ç»Ÿåº”ç”¨ç¨‹åºä¸­ï¼ŒæœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®æ˜¯ç›¸å¯¹é™æ€çš„ã€‚ ä¾‹å¦‚ï¼Œæ‚¨çš„ä»£ç å¯ä»¥ä»å¶å°”æ›´æ–°çš„é…ç½®æ–‡ä»¶ä¸­è¯»å–ç½‘ç»œä½ç½®ã€‚ ç„¶è€Œï¼Œåœ¨ç°ä»£çš„ã€åŸºäºäº‘çš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´éš¾è§£å†³çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="'+q+'" alt="image-20220430114558079" tabindex="0" loading="lazy"><figcaption>image-20220430114558079</figcaption></figure><p>ä½¿ç”¨æ³¨å†Œä¸­å¿ƒæœåŠ¡å®ä¾‹å…·æœ‰åŠ¨æ€åˆ†é…çš„ç½‘ç»œä½ç½®ã€‚ æ­¤å¤–ï¼ŒæœåŠ¡å®ä¾‹é›†ä¼šå› è‡ªåŠ¨ç¼©æ”¾ã€æ•…éšœå’Œå‡çº§è€ŒåŠ¨æ€å˜åŒ–ã€‚</p><p>ä¸¤ç§ä¸»è¦çš„æœåŠ¡å‘ç°æ¨¡å¼ï¼šå®¢æˆ·ç«¯å‘ç°å’ŒæœåŠ¡å™¨ç«¯å‘ç°</p><p>å®¢æˆ·ç«¯å‘ç°</p><p>å®¢æˆ·ç«¯è´Ÿè´£ç¡®å®šå¯ç”¨æœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®ï¼ˆä¾‹å¦‚10.4.3.20:333ï¼‰å¹¶åœ¨å®ƒä»¬ä¹‹é—´å®ç°è¯·æ±‚çš„è´Ÿè½½å¹³è¡¡ã€‚ å®¢æˆ·ç«¯æŸ¥è¯¢æœåŠ¡æ³¨å†Œè¡¨ï¼Œæ³¨å†Œè¡¨æ˜¯å¯ç”¨æœåŠ¡å®ä¾‹çš„æ•°æ®åº“ã€‚ ç„¶åå®¢æˆ·ç«¯ä½¿ç”¨è´Ÿè½½å¹³è¡¡ç®—æ³•æ¥é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å®ä¾‹å¹¶å‘å‡ºè¯·æ±‚ã€‚</p><figure><img src="'+j+'" alt="image-20220430115319810" tabindex="0" loading="lazy"><figcaption>image-20220430115319810</figcaption></figure><p>æœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®åœ¨å¯åŠ¨æ—¶å‘æœåŠ¡æ³¨å†Œè¡¨æ³¨å†Œï¼›å½“å®ä¾‹ç»ˆæ­¢æ—¶ï¼Œå®ƒä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­åˆ é™¤ã€‚ æœåŠ¡å®ä¾‹çš„æ³¨å†Œé€šå¸¸ä½¿ç”¨å¿ƒè·³æœºåˆ¶å®šæœŸåˆ·æ–°ã€‚</p><p>Netflix OSS æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å®¢æˆ·ç«¯å‘ç°æ¨¡å¼ç¤ºä¾‹ã€‚ Netflix Eureka æ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚ å®ƒæä¾›äº†ä¸€ä¸ª REST API æ¥ç®¡ç†æœåŠ¡å®ä¾‹æ³¨å†Œå’ŒæŸ¥è¯¢å¯ç”¨å®ä¾‹ã€‚ Netflix Ribbon æ˜¯ä¸€ä¸ª IPC å®¢æˆ·ç«¯ï¼Œå®ƒä¸ Eureka ä¸€èµ·åœ¨å¯ç”¨æœåŠ¡å®ä¾‹ä¹‹é—´è´Ÿè½½å¹³è¡¡è¯·æ±‚ã€‚</p><p>æœåŠ¡ç«¯å‘ç°</p><figure><img src="'+H+'" alt="image-20220430115715440" tabindex="0" loading="lazy"><figcaption>image-20220430115715440</figcaption></figure><p>å®¢æˆ·ç«¯é€šè¿‡è´Ÿè½½å‡è¡¡å™¨å‘æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚ è´Ÿè½½å‡è¡¡å™¨æŸ¥è¯¢æœåŠ¡æ³¨å†Œè¡¨å¹¶å°†æ¯ä¸ªè¯·æ±‚è·¯ç”±åˆ°å¯ç”¨çš„æœåŠ¡å®ä¾‹ã€‚ ä¸å®¢æˆ·ç«¯å‘ç°ä¸€æ ·ï¼ŒæœåŠ¡å®ä¾‹åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­æ³¨å†Œå’Œæ³¨é”€ã€‚</p><p>æ³¨å†Œä¸­å¿ƒï¼š</p><p>æœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯æœåŠ¡å‘ç°çš„å…³é”®éƒ¨åˆ†ã€‚ å®ƒæ˜¯ä¸€ä¸ªåŒ…å«æœåŠ¡å®ä¾‹çš„ç½‘ç»œä½ç½®çš„æ•°æ®åº“ã€‚ æœåŠ¡æ³¨å†Œä¸­å¿ƒéœ€è¦é«˜åº¦å¯ç”¨å¹¶ä¸”æ˜¯æœ€æ–°çš„ã€‚ å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜ä»æœåŠ¡æ³¨å†Œè¡¨è·å¾—çš„ç½‘ç»œä½ç½®ã€‚ ä½†æ˜¯ï¼Œè¯¥ä¿¡æ¯æœ€ç»ˆä¼šè¿‡æ—¶ï¼Œå®¢æˆ·ç«¯å°†æ— æ³•å‘ç°æœåŠ¡å®ä¾‹ã€‚ å› æ­¤ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒç”±ä¸€ç»„æœåŠ¡å™¨ç»„æˆï¼Œè¿™äº›æœåŠ¡å™¨ä½¿ç”¨å¤åˆ¶åè®®æ¥ä¿æŒä¸€è‡´æ€§ã€‚</p><p>Netflix Eureka æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªç”¨äºæ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡å®ä¾‹çš„ REST APIã€‚ æœåŠ¡å®ä¾‹ä½¿ç”¨ POST è¯·æ±‚æ³¨å†Œå…¶ç½‘ç»œä½ç½®ã€‚ æ¯ 30 ç§’ï¼Œå®ƒå¿…é¡»ä½¿ç”¨ PUT è¯·æ±‚åˆ·æ–°å…¶æ³¨å†Œã€‚ é€šè¿‡ä½¿ç”¨ HTTP DELETE è¯·æ±‚æˆ–å®ä¾‹æ³¨å†Œè¶…æ—¶æ¥åˆ é™¤æ³¨å†Œã€‚ å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ HTTP GET è¯·æ±‚æ£€ç´¢æ³¨å†Œçš„æœåŠ¡å®ä¾‹ã€‚</p><h3 id="ç½‘å…³æ˜¯ä»€ä¹ˆå‘¢" tabindex="-1"><a class="header-anchor" href="#ç½‘å…³æ˜¯ä»€ä¹ˆå‘¢" aria-hidden="true">#</a> ç½‘å…³æ˜¯ä»€ä¹ˆå‘¢</h3><p>ä½•ä¸ºç½‘å…³ï¼Ÿä¸ºä»€ä¹ˆè¦ç½‘å…³ï¼Ÿ</p><hr><figure><img src="'+F+'" alt="image-20220414190315596" tabindex="0" loading="lazy"><figcaption>image-20220414190315596</figcaption></figure><p>å¾®æœåŠ¡èƒŒæ™¯ä¸‹ï¼Œä¸€ä¸ªç³»ç»Ÿè¢«æ‹†åˆ†ä¸ºå¤šä¸ªæœåŠ¡ï¼Œä½†æ˜¯åƒå®‰å…¨è®¤è¯ï¼Œæµé‡æ§åˆ¶ï¼Œæ—¥å¿—ï¼Œç›‘æ§ç­‰åŠŸèƒ½æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦çš„ï¼Œæ²¡æœ‰ç½‘å…³çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡ä¸­å•ç‹¬å®ç°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬åšäº†å¾ˆå¤šé‡å¤çš„äº‹æƒ…å¹¶ä¸”æ²¡æœ‰ä¸€ä¸ªå…¨å±€çš„è§†å›¾æ¥ç»Ÿä¸€ç®¡ç†è¿™äº›åŠŸèƒ½ã€‚</p><p>ç»¼ä¸Šï¼š<strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç½‘å…³éƒ½ä¼šæä¾›è¯·æ±‚è½¬å‘ã€å®‰å…¨è®¤è¯ï¼ˆèº«ä»½/æƒé™è®¤è¯ï¼‰ã€æµé‡æ§åˆ¶ã€è´Ÿè½½å‡è¡¡ã€å®¹ç¾ã€æ—¥å¿—ã€ç›‘æ§è¿™äº›åŠŸèƒ½ã€‚</strong></p><p>ä¸Šé¢ä»‹ç»äº†è¿™ä¹ˆå¤šåŠŸèƒ½ï¼Œå®é™…ä¸Šï¼Œç½‘å…³ä¸»è¦åšäº†ä¸€ä»¶äº‹æƒ…ï¼š<strong>è¯·æ±‚è¿‡æ»¤</strong></p><p>æ‹“å±•ï¼šæœ‰å“ªäº›å¸¸è§çš„ç½‘å…³ç³»ç»Ÿï¼Ÿ</p><p>Netflix Zuul</p><p>Zuul æ˜¯ Netflix å¼€å‘çš„ä¸€æ¬¾æä¾›åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ã€å®‰å…¨çš„ç½‘å…³æœåŠ¡ã€‚</p><p>Zuul ä¸»è¦é€šè¿‡è¿‡æ»¤å™¨ï¼ˆç±»ä¼¼äº AOPï¼‰æ¥è¿‡æ»¤è¯·æ±‚ï¼Œä»è€Œå®ç°ç½‘å…³å¿…å¤‡çš„å„ç§åŠŸèƒ½</p><figure><img src="'+J+'" alt="image-20220414190353272" tabindex="0" loading="lazy"><figcaption>image-20220414190353272</figcaption></figure>',28),gt={href:"https://github.com/marcosbarbero/spring-cloud-zuul-ratelimit",target:"_blank",rel:"noopener noreferrer"},vt=t(`<p>(è¿™é‡Œåªæ˜¯ä¸¾ä¾‹è¯´æ˜ï¼Œä¸€èˆ¬æ˜¯é…åˆ hystrix æ¥åšé™æµ)ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.marcosbarbero.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-zuul-ratelimit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Zuul 1.x åŸºäºåŒæ­¥ IOï¼Œæ€§èƒ½è¾ƒå·®ã€‚Zuul 2.x åŸºäº Netty å®ç°äº†å¼‚æ­¥ IOï¼Œæ€§èƒ½å¾—åˆ°äº†å¤§å¹…æ”¹è¿›ã€‚</p>`,3),bt={href:"https://github.com/Netflix/zuul",target:"_blank",rel:"noopener noreferrer"},ht={href:"https://github.com/Netflix/zuul/wiki",target:"_blank",rel:"noopener noreferrer"},ft=n("p",null,"Spring Cloud Gateway",-1),yt=n("hr",null,null,-1),wt=n("p",null,"SpringCloud Gateway å±äº Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œå…¶è¯ç”Ÿçš„ç›®æ ‡æ˜¯ä¸ºäº†æ›¿ä»£è€ç‰Œç½‘å…³ **Zuul **ã€‚å‡†ç¡®ç‚¹æ¥è¯´ï¼Œåº”è¯¥æ˜¯ Zuul 1.xã€‚SpringCloud Gateway èµ·æ­¥è¦æ¯” Zuul 2.x æ›´æ—©ã€‚",-1),Ct=n("p",null,"ä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gateway åŸºäº Spring WebFlux ã€‚Spring WebFlux ä½¿ç”¨ Reactor åº“æ¥å®ç°å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œåº•å±‚åŸºäº Netty å®ç°å¼‚æ­¥ IOã€‚",-1),St=n("p",null,"Spring Cloud Gateway çš„ç›®æ ‡ï¼Œä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµã€‚",-1),xt=n("p",null,"Spring Cloud Gateway å’Œ Zuul 2.x çš„å·®åˆ«ä¸å¤§ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å¤„ç†è¯·æ±‚ã€‚ä¸è¿‡ï¼Œç›®å‰æ›´åŠ æ¨èä½¿ç”¨ Spring Cloud Gateway è€Œé Zuulï¼ŒSpring Cloud ç”Ÿæ€å¯¹å…¶æ”¯æŒæ›´åŠ å‹å¥½ã€‚",-1),_t={href:"https://github.com/spring-cloud/spring-cloud-gateway",target:"_blank",rel:"noopener noreferrer"},Tt={href:"https://spring.io/projects/spring-cloud-gateway",target:"_blank",rel:"noopener noreferrer"},Pt=n("p",null,"Kong",-1),Lt=n("hr",null,null,-1),Rt={href:"https://github.com/openresty/",target:"_blank",rel:"noopener noreferrer"},It=t(`<p>çš„é«˜æ€§èƒ½ã€äº‘åŸç”Ÿã€å¯æ‰©å±•çš„ç½‘å…³ç³»ç»Ÿã€‚</p><blockquote><p>OpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚</p></blockquote><p>Kong æä¾›äº†æ’ä»¶æœºåˆ¶æ¥æ‰©å±•å…¶åŠŸèƒ½ã€‚æ¯”å¦‚ã€åœ¨æœåŠ¡ä¸Šå¯ç”¨ Zipkin æ’ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST http://kong:8001/services/<span class="token punctuation">{</span>service<span class="token punctuation">}</span>/plugins <span class="token punctuation">\\</span>
    <span class="token parameter variable">--data</span> <span class="token string">&quot;name=zipkin&quot;</span>  <span class="token punctuation">\\</span>
    <span class="token parameter variable">--data</span> <span class="token string">&quot;config.http_endpoint=http://your.zipkin.collector:9411/api/v2/spans&quot;</span> <span class="token punctuation">\\</span>
    <span class="token parameter variable">--data</span> <span class="token string">&quot;config.sample_ratio=0.001&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),At={href:"https://github.com/Kong/kong",target:"_blank",rel:"noopener noreferrer"},Nt={href:"https://konghq.com/kong",target:"_blank",rel:"noopener noreferrer"},Mt=t('<p>APISIX</p><hr><p>APISIX æ˜¯ä¸€æ¬¾åŸºäº Nginx å’Œ etcd çš„é«˜æ€§èƒ½ã€äº‘åŸç”Ÿã€å¯æ‰©å±•çš„ç½‘å…³ç³»ç»Ÿã€‚</p><blockquote><p><em>etcd</em>æ˜¯ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ key-value å­˜å‚¨ç³»ç»Ÿï¼Œä½¿ç”¨ Raft åè®®åšåˆ†å¸ƒå¼å…±è¯†ã€‚</p></blockquote><p>ä¸ä¼ ç»Ÿ API ç½‘å…³ç›¸æ¯”ï¼ŒAPISIX å…·æœ‰åŠ¨æ€è·¯ç”±å’Œæ’ä»¶çƒ­åŠ è½½ï¼Œç‰¹åˆ«é€‚åˆå¾®æœåŠ¡ç³»ç»Ÿä¸‹çš„ API ç®¡ç†ã€‚å¹¶ä¸”ï¼ŒAPISIX ä¸ SkyWalkingï¼ˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼‰ã€Zipkinï¼ˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼‰ã€Prometheusï¼ˆç›‘æ§ç³»ç»Ÿï¼‰ ç­‰ DevOps ç”Ÿæ€å·¥å…·å¯¹æ¥éƒ½ååˆ†æ–¹ä¾¿ã€‚</p><figure><img src="'+U+'" alt="image-20220414190450946" tabindex="0" loading="lazy"><figcaption>image-20220414190450946</figcaption></figure><p>ä½œä¸º NGINX å’Œ Kong çš„æ›¿ä»£é¡¹ç›®ï¼ŒAPISIX ç›®å‰å·²ç»æ˜¯ Apache é¡¶çº§å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”æ˜¯æœ€å¿«æ¯•ä¸šçš„å›½äº§å¼€æºé¡¹ç›®ã€‚å›½å†…ç›®å‰å·²ç»æœ‰å¾ˆå¤šçŸ¥åä¼ä¸šï¼ˆæ¯”å¦‚é‡‘å±±ã€æœ‰èµã€çˆ±å¥‡è‰ºã€è…¾è®¯ã€è´å£³ï¼‰ä½¿ç”¨ APISIX å¤„ç†æ ¸å¿ƒçš„ä¸šåŠ¡æµé‡ã€‚</p><p>æ ¹æ®å®˜ç½‘ä»‹ç»ï¼šâ€œAPISIX å·²ç»ç”Ÿäº§å¯ç”¨ï¼ŒåŠŸèƒ½ã€æ€§èƒ½ã€æ¶æ„å…¨é¢ä¼˜äº Kongâ€ã€‚</p>',8),Et={href:"https://github.com/apache/apisix",target:"_blank",rel:"noopener noreferrer"},Ot={href:"https://apisix.apache.org/zh/",target:"_blank",rel:"noopener noreferrer"},Bt=n("p",null,"Shenyu",-1),Dt=n("p",null,"Shenyu æ˜¯ä¸€æ¬¾åŸºäº WebFlux çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å“åº”å¼ç½‘å…³ï¼ŒApache é¡¶çº§å¼€æºé¡¹ç›®ã€‚",-1),zt=n("figure",null,[n("img",{src:K,alt:"image-20220414190541400",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20220414190541400")],-1),qt=n("p",null,"Shenyu é€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ï¼Œæ’ä»¶æ˜¯ ShenYu çš„çµé­‚ï¼Œå¹¶ä¸”æ’ä»¶ä¹Ÿæ˜¯å¯æ‰©å±•å’Œçƒ­æ’æ‹”çš„ã€‚ä¸åŒçš„æ’ä»¶å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚Shenyu è‡ªå¸¦äº†è¯¸å¦‚é™æµã€ç†”æ–­ã€è½¬å‘ ã€é‡å†™ã€é‡å®šå‘ã€å’Œè·¯ç”±ç›‘æ§ç­‰æ’ä»¶ã€‚",-1),jt={href:"https://github.com/apache/incubator-shenyu",target:"_blank",rel:"noopener noreferrer"},Ht={href:"https://shenyu.apache.org/",target:"_blank",rel:"noopener noreferrer"},Ft=n("h3",{id:"dubboäº†è§£å—",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#dubboäº†è§£å—","aria-hidden":"true"},"#"),s(" dubboäº†è§£å—ï¼Ÿ")],-1),Jt=n("p",null,[n("strong",null,"ä»€ä¹ˆæ˜¯ Dubbo?")],-1),Ut=n("hr",null,null,-1),Kt=n("figure",null,[n("img",{src:Q,alt:"image-20220602105145976",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20220602105145976")],-1),Qt={href:"https://github.com/apache/dubbo",target:"_blank",rel:"noopener noreferrer"},Vt={href:"https://dubbo.apache.org/zh/",target:"_blank",rel:"noopener noreferrer"},Gt=t('<p>çš„ä»‹ç»ï¼ŒDubbo æä¾›äº†å…­å¤§æ ¸å¿ƒèƒ½åŠ›</p><ol><li>é¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½RPCè°ƒç”¨ã€‚</li><li>æ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ã€‚</li><li>æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚</li><li>é«˜åº¦å¯æ‰©å±•èƒ½åŠ›ã€‚</li><li>è¿è¡ŒæœŸæµé‡è°ƒåº¦ã€‚</li><li>å¯è§†åŒ–çš„æœåŠ¡æ²»ç†ä¸è¿ç»´ã€‚</li></ol><figure><img src="'+V+'" alt="image-20220602105203619" tabindex="0" loading="lazy"><figcaption>image-20220602105203619</figcaption></figure><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š <strong>Dubbo ä¸å…‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè¿˜æä¾›äº†ä¸€äº›å…¶ä»–å¼€ç®±å³ç”¨çš„åŠŸèƒ½æ¯”å¦‚æ™ºèƒ½è´Ÿè½½å‡è¡¡ã€‚</strong></p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨ Dubbo?</strong></p><hr><p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™çš„è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šã€‚å•ä¸€åº”ç”¨æ¶æ„ ã€å‚ç›´åº”ç”¨æ¶æ„æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™åˆ†å¸ƒå¼æœåŠ¡æ¶æ„å°±è¯ç”Ÿäº†ã€‚</p><p>åˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä¸‹ï¼Œç³»ç»Ÿè¢«æ‹†åˆ†æˆä¸åŒçš„æœåŠ¡æ¯”å¦‚çŸ­ä¿¡æœåŠ¡ã€å®‰å…¨æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æä¾›ç³»ç»Ÿçš„æŸä¸ªæ ¸å¿ƒæœåŠ¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java RMIï¼ˆJava Remote Method Invocationï¼‰ã€Hessianè¿™ç§æ”¯æŒè¿œç¨‹è°ƒç”¨çš„æ¡†æ¶æ¥ç®€å•åœ°æš´éœ²å’Œå¼•ç”¨è¿œç¨‹æœåŠ¡ã€‚ä½†æ˜¯ï¼å½“æœåŠ¡è¶Šæ¥è¶Šå¤šä¹‹åï¼ŒæœåŠ¡è°ƒç”¨å…³ç³»è¶Šæ¥è¶Šå¤æ‚ã€‚å½“åº”ç”¨è®¿é—®å‹åŠ›è¶Šæ¥è¶Šå¤§åï¼Œè´Ÿè½½å‡è¡¡ä»¥åŠæœåŠ¡ç›‘æ§çš„éœ€æ±‚ä¹Ÿè¿«åœ¨çœ‰ç«ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ F5 è¿™ç±»ç¡¬ä»¶æ¥åšè´Ÿè½½å‡è¡¡ï¼Œä½†è¿™æ ·å¢åŠ äº†æˆæœ¬ï¼Œå¹¶ä¸”å­˜åœ¨å•ç‚¹æ•…éšœçš„é£é™©ã€‚</p><p>ä¸è¿‡ï¼ŒDubbo çš„å‡ºç°è®©ä¸Šè¿°é—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚<strong>Dubbo å¸®åŠ©æˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</strong></p><ol><li><strong>è´Ÿè½½å‡è¡¡</strong> ï¼š åŒä¸€ä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨æ—¶è¯¥è°ƒç”¨å“ªä¸€å°æœºå™¨ä¸Šçš„æœåŠ¡ã€‚</li><li><strong>æœåŠ¡è°ƒç”¨é“¾è·¯ç”Ÿæˆ</strong> ï¼š éšç€ç³»ç»Ÿçš„å‘å±•ï¼ŒæœåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡é—´ä¾èµ–å…³ç³»å˜å¾—é”™è¸ªå¤æ‚ï¼Œç”šè‡³åˆ†ä¸æ¸…å“ªä¸ªåº”ç”¨è¦åœ¨å“ªä¸ªåº”ç”¨ä¹‹å‰å¯åŠ¨ï¼Œæ¶æ„å¸ˆéƒ½ä¸èƒ½å®Œæ•´çš„æè¿°åº”ç”¨çš„æ¶æ„å…³ç³»ã€‚Dubbo å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³æœåŠ¡ä¹‹é—´äº’ç›¸æ˜¯å¦‚ä½•è°ƒç”¨çš„ã€‚</li><li><strong>æœåŠ¡è®¿é—®å‹åŠ›ä»¥åŠæ—¶é•¿ç»Ÿè®¡ã€èµ„æºè°ƒåº¦å’Œæ²»ç†</strong> ï¼šåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚</li><li>......</li></ol><figure><img src="'+G+`" alt="image-20220602105232952" tabindex="0" loading="lazy"><figcaption>image-20220602105232952</figcaption></figure><p>å¦å¤–ï¼ŒDubbo é™¤äº†èƒ½å¤Ÿåº”ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨ç°åœ¨æ¯”è¾ƒç«çš„å¾®æœåŠ¡ç³»ç»Ÿä¸­ã€‚ä¸è¿‡ï¼Œç”±äº Spring Cloud åœ¨å¾®æœåŠ¡ä¸­åº”ç”¨æ›´åŠ å¹¿æ³›ï¼Œæ‰€ä»¥ï¼Œæˆ‘è§‰å¾—ä¸€èˆ¬æˆ‘ä»¬æ Dubbo çš„è¯ï¼Œå¤§éƒ¨åˆ†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æƒ…å†µã€‚</p><h3 id="æ˜¯æ€ä¹ˆä½¿ç”¨åˆ†å¸ƒå¼é”çš„" tabindex="-1"><a class="header-anchor" href="#æ˜¯æ€ä¹ˆä½¿ç”¨åˆ†å¸ƒå¼é”çš„" aria-hidden="true">#</a> æ˜¯æ€ä¹ˆä½¿ç”¨åˆ†å¸ƒå¼é”çš„?</h3><p>åˆ†å¸ƒå¼é”ï¼Œæ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¸åŒè¿›ç¨‹å…±åŒè®¿é—®å…±äº«èµ„æºçš„ä¸€ç§é”çš„å®ç°ã€‚ç§’æ€ä¸‹å•ã€æŠ¢çº¢åŒ…ç­‰ç­‰ä¸šåŠ¡åœºæ™¯ï¼Œéƒ½éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­ç»å¸¸ä½¿ç”¨Redisä½œä¸ºåˆ†å¸ƒå¼é”ã€‚</p><p>é€‰äº†Redisåˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ³•ï¼Œå¤§å®¶æ¥è®¨è®ºä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰å•¥é—®é¢˜å“ˆã€‚</p><ul><li>å‘½ä»¤setnx + expireåˆ†å¼€å†™</li><li>setnx + valueå€¼æ˜¯è¿‡æœŸæ—¶é—´</li><li>setçš„æ‰©å±•å‘½ä»¤ï¼ˆset ex px nxï¼‰</li><li>set ex px nx + æ ¡éªŒå”¯ä¸€éšæœºå€¼,å†åˆ é™¤</li><li>Redisson</li></ul><p><strong>å‘½ä»¤setnx + expireåˆ†å¼€å†™</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ifï¼ˆjedis.setnx(key,lock_value) == 1ï¼‰{ //åŠ é”
    expireï¼ˆkeyï¼Œ100ï¼‰; //è®¾ç½®è¿‡æœŸæ—¶é—´
    try {
        do something  //ä¸šåŠ¡è¯·æ±‚
    }catch(){
  }
  finally {
       jedis.del(key); //é‡Šæ”¾é”
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ‰§è¡Œå®Œ <code>setnx</code>åŠ é”ï¼Œæ­£è¦æ‰§è¡Œ <code>expire</code>è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œè¿›ç¨‹crashæ‰æˆ–è€…è¦é‡å¯ç»´æŠ¤äº†ï¼Œé‚£è¿™ä¸ªé”å°±â€œé•¿ç”Ÿä¸è€â€äº†ï¼Œåˆ«çš„çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”å•¦ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼é”ä¸èƒ½è¿™ä¹ˆå®ç°ã€‚</p><p><strong>setnx + valueå€¼æ˜¯è¿‡æœŸæ—¶é—´</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>long expires = System.currentTimeMillis() + expireTime; //ç³»ç»Ÿæ—¶é—´+è®¾ç½®çš„è¿‡æœŸæ—¶é—´
String expiresStr = String.valueOf(expires);

// å¦‚æœå½“å‰é”ä¸å­˜åœ¨ï¼Œè¿”å›åŠ é”æˆåŠŸ
if (jedis.setnx(key, expiresStr) == 1) {
        return true;
} 
// å¦‚æœé”å·²ç»å­˜åœ¨ï¼Œè·å–é”çš„è¿‡æœŸæ—¶é—´
String currentValueStr = jedis.get(key);

// å¦‚æœè·å–åˆ°çš„è¿‡æœŸæ—¶é—´ï¼Œå°äºç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œè¡¨ç¤ºå·²ç»è¿‡æœŸ
if (currentValueStr != null &amp;&amp; Long.parseLong(currentValueStr) &lt; System.currentTimeMillis()) {

     // é”å·²è¿‡æœŸï¼Œè·å–ä¸Šä¸€ä¸ªé”çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶è®¾ç½®ç°åœ¨é”çš„è¿‡æœŸæ—¶é—´ï¼ˆä¸äº†è§£redisçš„getSetå‘½ä»¤çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å»å®˜ç½‘çœ‹ä¸‹å“ˆï¼‰
    String oldValueStr = jedis.getSet(key_resource_id, expiresStr);
  
    if (oldValueStr != null &amp;&amp; oldValueStr.equals(currentValueStr)) {
         // è€ƒè™‘å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è®¾ç½®å€¼å’Œå½“å‰å€¼ç›¸åŒï¼Œå®ƒæ‰å¯ä»¥åŠ é”
         return true;
    }
}
      
//å…¶ä»–æƒ…å†µï¼Œå‡è¿”å›åŠ é”å¤±è´¥
return false;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬”è€…çœ‹è¿‡æœ‰å¼€å‘å°ä¼™ä¼´å°±æ˜¯è¿™ä¹ˆå®ç°åˆ†å¸ƒå¼é”çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¹Ÿæœ‰è¿™äº›ç¼ºç‚¹ï¼š</p><ul><li>è¿‡æœŸæ—¶é—´æ˜¯å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆçš„ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯çš„æ—¶é—´å¿…é¡»åŒæ­¥ã€‚</li><li>æ²¡æœ‰ä¿å­˜æŒæœ‰è€…çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯èƒ½è¢«åˆ«çš„å®¢æˆ·ç«¯é‡Šæ”¾/è§£é”ã€‚</li><li>é”è¿‡æœŸçš„æ—¶å€™ï¼Œå¹¶å‘å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯·æ±‚è¿‡æ¥ï¼Œéƒ½æ‰§è¡Œäº† <code>jedis.getSet()</code>ï¼Œæœ€ç»ˆåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åŠ é”æˆåŠŸï¼Œä½†æ˜¯è¯¥å®¢æˆ·ç«¯é”çš„è¿‡æœŸæ—¶é—´ï¼Œå¯èƒ½è¢«åˆ«çš„å®¢æˆ·ç«¯è¦†ç›–ã€‚</li></ul><p><strong>setçš„æ‰©å±•å‘½ä»¤ï¼ˆset ex px nxï¼‰ï¼ˆæ³¨æ„å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼‰</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ifï¼ˆjedis.set(key, lock_value, &quot;NX&quot;, &quot;EX&quot;, 100s) == 1ï¼‰{ //åŠ é”
    try {
        do something  //ä¸šåŠ¡å¤„ç†
    }catch(){
  }
  finally {
       jedis.del(key); //é‡Šæ”¾é”
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ–¹æ¡ˆå¯èƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼š</p><ul><li>é”è¿‡æœŸé‡Šæ”¾äº†ï¼Œä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œã€‚</li><li>é”è¢«åˆ«çš„çº¿ç¨‹è¯¯åˆ ã€‚</li></ul><p><strong>set ex px nx + æ ¡éªŒå”¯ä¸€éšæœºå€¼,å†åˆ é™¤</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ifï¼ˆjedis.set(key, uni_request_id, &quot;NX&quot;, &quot;EX&quot;, 100s) == 1ï¼‰{ //åŠ é”
    try {
        do something  //ä¸šåŠ¡å¤„ç†
    }catch(){
  }
  finally {
       //åˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹åŠ çš„é”,æ˜¯æ‰é‡Šæ”¾
       if (uni_request_id.equals(jedis.get(key))) {
        jedis.del(key); //é‡Šæ”¾é”
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹åŠ çš„é”å’Œé‡Šæ”¾é”æ˜¯ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚å¦‚æœè°ƒç”¨jedis.del()é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå¯èƒ½è¿™æŠŠé”å·²ç»ä¸å±äºå½“å‰å®¢æˆ·ç«¯ï¼Œä¼šè§£é™¤ä»–äººåŠ çš„é”ã€‚</p><p>ä¸€èˆ¬ä¹Ÿæ˜¯ç”¨luaè„šæœ¬ä»£æ›¿ã€‚luaè„šæœ¬å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>if redis.call(&#39;get&#39;,KEYS[1]) == ARGV[1] then 
   return redis.call(&#39;del&#39;,KEYS[1]) 
else
   return 0
end;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼æ¯”è¾ƒä¸é”™äº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå·²ç»å¯ä»¥ä½¿ç”¨è¿™ç§å®ç°æ–¹å¼ã€‚ä½†æ˜¯å­˜åœ¨é”è¿‡æœŸé‡Šæ”¾äº†ï¼Œä¸šåŠ¡è¿˜æ²¡æ‰§è¡Œå®Œçš„é—®é¢˜ï¼ˆå®é™…ä¸Šï¼Œä¼°ç®—ä¸ªä¸šåŠ¡å¤„ç†çš„æ—¶é—´ï¼Œä¸€èˆ¬æ²¡å•¥é—®é¢˜äº†ï¼‰ã€‚</p><p><strong>Redisson</strong></p><p>åˆ†å¸ƒå¼é”å¯èƒ½å­˜åœ¨é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œçš„é—®é¢˜ã€‚æœ‰äº›å°ä¼™ä¼´è®¤ä¸ºï¼Œç¨å¾®æŠŠé”è¿‡æœŸæ—¶é—´è®¾ç½®é•¿ä¸€äº›å°±å¯ä»¥å•¦ã€‚å…¶å®æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œæ˜¯å¦å¯ä»¥ç»™è·å¾—é”çš„çº¿ç¨‹ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶å®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¯¹é”çš„è¿‡æœŸæ—¶é—´å»¶é•¿ï¼Œé˜²æ­¢é”è¿‡æœŸæå‰é‡Šæ”¾ã€‚</p><p>å½“å‰å¼€æºæ¡†æ¶Redissonå°±è§£å†³äº†è¿™ä¸ªåˆ†å¸ƒå¼é”é—®é¢˜ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹Redissonåº•å±‚åŸç†æ˜¯æ€æ ·çš„å§ï¼š</p><figure><img src="`+X+'" alt="image-20220618221951116" tabindex="0" loading="lazy"><figcaption>image-20220618221951116</figcaption></figure><p>åªè¦çº¿ç¨‹ä¸€åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ª <code>watch dog</code>çœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœçº¿ç¨‹1è¿˜æŒæœ‰é”ï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚å› æ­¤ï¼ŒRedissonå°±æ˜¯ä½¿ç”¨Redissonè§£å†³äº†é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œé—®é¢˜</p><h3 id="redissonåˆ†å¸ƒå¼é”-watchæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#redissonåˆ†å¸ƒå¼é”-watchæœºåˆ¶" aria-hidden="true">#</a> redissonåˆ†å¸ƒå¼é”ï¼Œwatchæœºåˆ¶ï¼Ÿ</h3><p>è¿™é‡ŒRedisçš„å®¢æˆ·ç«¯ï¼ˆJedis, Redisson, Lettuceç­‰ï¼‰éƒ½æ˜¯åŸºäºä¸Šè¿°ä¸¤ç±»å½¢å¼æ¥å®ç°åˆ†å¸ƒå¼é”çš„ï¼Œåªæ˜¯ä¸¤ç±»å½¢å¼çš„å°è£…ä»¥åŠä¸€äº›ä¼˜åŒ–ï¼ˆæ¯”å¦‚Redissonçš„watch dog)ã€‚</p><p>ä»¥åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”ä¸ºä¾‹ï¼ˆæ”¯æŒäº† å•å®ä¾‹ã€Rediså“¨å…µã€redis clusterã€redis master-slaveç­‰å„ç§éƒ¨ç½²æ¶æ„ï¼‰ï¼š</p><p><strong>ç‰¹è‰²</strong>ï¼Ÿ</p><ol><li>redissonæ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡luaè„šæœ¬æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œçš„åŸå­æ€§</li><li>redissonè®¾ç½®äº†watchdogçœ‹é—¨ç‹—ï¼Œâ€œçœ‹é—¨ç‹—â€çš„é€»è¾‘ä¿è¯äº†æ²¡æœ‰æ­»é”å‘ç”Ÿ</li><li>redissonæ”¯æŒRedlockçš„å®ç°æ–¹å¼ã€‚</li></ol><p><strong>è¿‡ç¨‹</strong>ï¼Ÿ</p><ol><li>çº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸ: æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</li><li>çº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: è®¢é˜…äº†è§£é”æ¶ˆæ¯ï¼Œç„¶åå†å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</li></ol><p><strong>äº’æ–¥</strong>ï¼Ÿ</p><p>å¦‚æœè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯Bæ¥å°è¯•åŠ é”ï¼Œæ‰§è¡Œäº†åŒæ ·çš„ä¸€æ®µluaè„šæœ¬ã€‚ç¬¬ä¸€ä¸ªifåˆ¤æ–­ä¼šæ‰§è¡Œâ€œexists myLockâ€ï¼Œå‘ç°myLockè¿™ä¸ªé”keyå·²ç»å­˜åœ¨ã€‚æ¥ç€ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­myLocké”keyçš„hashæ•°æ®ç»“æ„ä¸­ï¼Œæ˜¯å¦åŒ…å«å®¢æˆ·ç«¯Bçš„IDï¼Œä½†æ˜æ˜¾æ²¡æœ‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯Bä¼šè·å–åˆ°pttl myLockè¿”å›çš„ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨myLockè¿™ä¸ªé”keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚æ­¤æ—¶å®¢æˆ·ç«¯Bä¼šè¿›å…¥ä¸€ä¸ªwhileå¾ªç¯ï¼Œä¸å¬çš„å°è¯•åŠ é”ã€‚</p><p><strong>watch dogè‡ªåŠ¨å»¶æ—¶æœºåˆ¶</strong>ï¼Ÿ</p><p>å®¢æˆ·ç«¯AåŠ é”çš„é”keyé»˜è®¤ç”Ÿå­˜æ—¶é—´åªæœ‰30ç§’ï¼Œå¦‚æœè¶…è¿‡äº†30ç§’ï¼Œå®¢æˆ·ç«¯Aè¿˜æƒ³ä¸€ç›´æŒæœ‰è¿™æŠŠé”ï¼Œæ€ä¹ˆåŠï¼Ÿå…¶å®åªè¦å®¢æˆ·ç«¯Aä¸€æ—¦åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœå®¢æˆ·ç«¯Aè¿˜æŒæœ‰é”keyï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚</p><p><strong>å¯é‡å…¥</strong>ï¼Ÿ</p><p>æ¯æ¬¡lockä¼šè°ƒç”¨incrbyï¼Œæ¯æ¬¡unlockä¼šå‡ä¸€ã€‚</p><h3 id="å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3><p><code>**åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šå°±æ˜¯æŒ‡äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚ç®€å•æ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹åŠ¡ï¼Œå®ƒçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†ä¿è¯ä¸åŒæ•°æ®åº“èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</code></p><p>èŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¤§å®¶è®°å¾—è¿™ä¸¤ä¸ªç†è®ºå“ˆï¼š<strong>CAPç†è®º å’Œ BASE ç†è®º</strong></p><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>2PC(äºŒé˜¶æ®µæäº¤)æ–¹æ¡ˆã€3PC</li><li>TCCï¼ˆTryã€Confirmã€Cancelï¼‰</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>æœ€å¤§åŠªåŠ›é€šçŸ¥</li><li>seata</li></ul><p><strong>2PC(äºŒé˜¶æ®µæäº¤)æ–¹æ¡ˆ</strong></p><p>2PCï¼Œå³ä¸¤é˜¶æ®µæäº¤ï¼Œå®ƒå°†åˆ†å¸ƒå¼äº‹åŠ¡çš„æäº¤æ‹†åˆ†ä¸º2ä¸ªé˜¶æ®µï¼š<code>prepareå’Œcommit/rollback</code>ï¼Œå³å‡†å¤‡é˜¶æ®µå’Œæäº¤æ‰§è¡Œé˜¶æ®µã€‚åœ¨prepareå‡†å¤‡é˜¶æ®µéœ€è¦ç­‰å¾…æ‰€æœ‰å‚ä¸å­äº‹åŠ¡çš„åé¦ˆï¼Œå› æ­¤å¯èƒ½é€ æˆæ•°æ®åº“èµ„æºé”å®šæ—¶é—´è¿‡é•¿ï¼Œä¸é€‚åˆå¹¶å‘é«˜ä»¥åŠå­äº‹åŠ¡ç”Ÿå‘½å‘¨é•¿è¾ƒé•¿çš„ä¸šåŠ¡åœºæ™¯ã€‚å¹¶ä¸”åè°ƒè€…å®•æœºçš„è¯ï¼Œæ‰€æœ‰çš„å‚ä¸è€…éƒ½æ”¶ä¸åˆ°æäº¤æˆ–å›æ»šæŒ‡ä»¤ã€‚</p><p><strong>3PC</strong></p><p>ä¸¤é˜¶æ®µæäº¤åˆ†åˆ«æ˜¯ï¼š<code>CanCommitï¼ŒPreCommit å’Œ doCommit</code>ï¼Œè¿™é‡Œä¸å†è¯¦è¿°ã€‚3PC åˆ©ç”¨è¶…æ—¶æœºåˆ¶è§£å†³äº† 2PC çš„åŒæ­¥é˜»å¡é—®é¢˜ï¼Œé¿å…èµ„æºè¢«æ°¸ä¹…é”å®šï¼Œè¿›ä¸€æ­¥åŠ å¼ºäº†æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹çš„å¯é æ€§ã€‚ä½†æ˜¯ 3PC åŒæ ·æ— æ³•åº”å¯¹ç±»ä¼¼çš„å®•æœºé—®é¢˜ï¼Œåªä¸è¿‡å‡ºç°å¤šæ•°æ®æºä¸­æ•°æ®ä¸ä¸€è‡´é—®é¢˜çš„æ¦‚ç‡æ›´å°ã€‚</p><p><strong>TCC</strong></p><p>TCC é‡‡ç”¨äº†è¡¥å¿æœºåˆ¶ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé’ˆå¯¹æ¯ä¸ªæ“ä½œï¼Œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸å…¶å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼ˆæ’¤é”€ï¼‰æ“ä½œã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š<code>Try-Confirm-Cancel</code></p><ul><li>tryé˜¶æ®µï¼šå°è¯•å»æ‰§è¡Œï¼Œå®Œæˆæ‰€æœ‰ä¸šåŠ¡çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œé¢„ç•™å¿…é¡»çš„ä¸šåŠ¡èµ„æºã€‚</li><li>Confirmé˜¶æ®µï¼šè¯¥é˜¶æ®µå¯¹ä¸šåŠ¡è¿›è¡Œç¡®è®¤æäº¤ï¼Œä¸åšä»»ä½•æ£€æŸ¥ï¼Œå› ä¸ºtryé˜¶æ®µå·²ç»æ£€æŸ¥è¿‡äº†ï¼Œé»˜è®¤Confirmé˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ã€‚</li><li>Cancel é˜¶æ®µï¼šè‹¥ä¸šåŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è¿›å…¥è¯¥é˜¶æ®µï¼Œå®ƒä¼šé‡Šæ”¾tryé˜¶æ®µå ç”¨çš„æ‰€æœ‰ä¸šåŠ¡èµ„æºï¼Œå¹¶å›æ»šConfirmé˜¶æ®µæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œã€‚</li></ul><p>TCCæ–¹æ¡ˆè®©åº”ç”¨å¯ä»¥è‡ªå®šä¹‰æ•°æ®åº“æ“ä½œçš„ç²’åº¦ï¼Œé™ä½äº†é”å†²çªï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚ä½†æ˜¯åº”ç”¨ä¾µå…¥æ€§å¼ºï¼Œtryã€confirmã€cancelä¸‰ä¸ªé˜¶æ®µéƒ½éœ€è¦ä¸šåŠ¡é€»è¾‘å®ç°ã€‚</p><p><strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong></p><p>ebayæœ€åˆæå‡ºæœ¬åœ°æ¶ˆæ¯è¡¨è¿™ä¸ªæ–¹æ¡ˆï¼Œæ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ä¸šç•Œç›®å‰ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆæœ¬åœ°äº‹åŠ¡è¿›è¡Œå¤„ç†ã€‚å¯ä»¥çœ‹ä¸€ä¸‹åŸºæœ¬çš„å®ç°æµç¨‹å›¾ï¼š</p><figure><img src="'+W+'" alt="image-20220613095814545" tabindex="0" loading="lazy"><figcaption>image-20220613095814545</figcaption></figure><p><strong>æœ€å¤§åŠªåŠ›é€šçŸ¥</strong></p><p>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆçš„ç›®æ ‡ï¼Œå°±æ˜¯å‘èµ·é€šçŸ¥æ–¹é€šè¿‡ä¸€å®šçš„æœºåˆ¶ï¼Œæœ€å¤§åŠªåŠ›å°†ä¸šåŠ¡å¤„ç†ç»“æœé€šçŸ¥åˆ°æ¥æ”¶æ–¹ã€‚</p><figure><img src="'+Y+'" alt="image-20220613095822121" tabindex="0" loading="lazy"><figcaption>image-20220613095822121</figcaption></figure><p><strong>seata</strong></p><p>Saga æ¨¡å¼æ˜¯ Seata æä¾›çš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œç”±Sagaäº‹åŠ¡åè°ƒå™¨åè°ƒï¼Œå¦‚æœæ­£å¸¸ç»“æŸé‚£å°±æ­£å¸¸å®Œæˆï¼Œå¦‚æœæŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™æ ¹æ®ç›¸åé¡ºåºä¸€æ¬¡è°ƒç”¨è¡¥å¿æ“ä½œã€‚</p><p>Sagaçš„å¹¶å‘åº¦é«˜ï¼Œä½†æ˜¯ä¸€è‡´æ€§å¼±ï¼Œå¯¹äºè½¬è´¦ï¼Œå¯èƒ½å‘ç”Ÿç”¨æˆ·å·²æ‰£æ¬¾ï¼Œæœ€åè½¬è´¦åˆå¤±è´¥çš„æƒ…å†µã€‚</p><h3 id="è®²è®²capç†è®º-æ€ä¹ˆç†è§£åˆ†åŒºå®¹é”™æ€§" tabindex="-1"><a class="header-anchor" href="#è®²è®²capç†è®º-æ€ä¹ˆç†è§£åˆ†åŒºå®¹é”™æ€§" aria-hidden="true">#</a> è®²è®²CAPç†è®ºï¼Ÿæ€ä¹ˆç†è§£åˆ†åŒºå®¹é”™æ€§ï¼Ÿ</h3>',75),Xt={href:"https://zh.wikipedia.org/wiki/CAP%E5%AE%9A%E7%90%86",target:"_blank",rel:"noopener noreferrer"},Wt=t('<p>èµ·æºäº 2000å¹´ï¼Œç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„Eric Breweræ•™æˆåœ¨åˆ†å¸ƒå¼è®¡ç®—åŸç†ç ”è®¨ä¼šï¼ˆPODCï¼‰ä¸Šæå‡ºï¼Œå› æ­¤ CAPå®šç†åˆè¢«ç§°ä½œ <strong>å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰</strong></p><p>2å¹´åï¼Œéº»çœç†å·¥å­¦é™¢çš„Seth Gilbertå’ŒNancy Lynch å‘è¡¨äº†å¸ƒé²å°”çŒœæƒ³çš„è¯æ˜ï¼ŒCAPç†è®ºæ­£å¼æˆä¸ºåˆ†å¸ƒå¼é¢†åŸŸçš„å®šç†ã€‚</p><p>ç®€ä»‹</p><p><strong>CAP</strong> ä¹Ÿå°±æ˜¯ <strong>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰</strong>ã€<strong>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰</strong>ã€<strong>Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</strong> è¿™ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„åˆã€‚</p><figure><img src="'+Z+'" alt="image-20220615221901423" tabindex="0" loading="lazy"><figcaption>image-20220615221901423</figcaption></figure><p>CAP ç†è®ºçš„æå‡ºè€…å¸ƒé²å°”åœ¨æå‡º CAP çŒœæƒ³çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†å®šä¹‰ <strong>Consistency</strong>ã€<strong>Availability</strong>ã€<strong>Partition Tolerance</strong> ä¸‰ä¸ªå•è¯çš„æ˜ç¡®å®šä¹‰ã€‚</p><p>å› æ­¤ï¼Œå¯¹äº CAP çš„æ°‘é—´è§£è¯»æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬æ¯”è¾ƒè¢«å¤§å®¶æ¨èçš„æ˜¯ä¸‹é¢ ğŸ‘‡ è¿™ç§ç‰ˆæœ¬çš„è§£è¯»ã€‚</p><p>åœ¨ç†è®ºè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒCAP å®šç†ï¼ˆCAP theoremï¼‰æŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå½“è®¾è®¡è¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ä¸­çš„ä¸¤ä¸ªï¼š</p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong> : æ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong>: éæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯æˆ–è€…è¶…æ—¶çš„å“åº”ï¼‰ã€‚</li><li><strong>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰</strong> : åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ul><p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œæ•°æ®å­˜åœ¨çš„èŠ‚ç‚¹è¶Šå¤šï¼Œåˆ†åŒºå®¹å¿æ€§è¶Šé«˜ï¼Œä½†è¦å¤åˆ¶æ›´æ–°çš„æ•°æ®å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p><h3 id="springcloudå’ŒdubboåŒºåˆ«åœ¨å“ª-å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#springcloudå’ŒdubboåŒºåˆ«åœ¨å“ª-å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> springcloudå’ŒdubboåŒºåˆ«åœ¨å“ªï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>æœåŠ¡è°ƒç”¨æ–¹å¼ï¼šdubboæ˜¯RPC springcloud Rest Api</p><p>æ³¨å†Œä¸­å¿ƒï¼šdubbo æ˜¯zookeeper springcloudæ˜¯eurekaï¼Œä¹Ÿå¯ä»¥æ˜¯zookeeper</p><p>æœåŠ¡ç½‘å…³ï¼Œdubboæœ¬èº«æ²¡æœ‰å®ç°ï¼Œåªèƒ½é€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹æŠ€æœ¯æ•´åˆï¼Œspringcloudæœ‰Zuulè·¯ç”±ç½‘å…³ï¼Œä½œä¸ºè·¯ç”±æœåŠ¡å™¨ï¼Œè¿›è¡Œæ¶ˆè´¹è€…çš„è¯·æ±‚åˆ†å‘,springcloudæ”¯æŒæ–­è·¯å™¨ï¼Œä¸gitå®Œç¾é›†æˆé…ç½®æ–‡ä»¶æ”¯æŒç‰ˆæœ¬æ§åˆ¶ï¼Œäº‹ç‰©æ€»çº¿å®ç°é…ç½®æ–‡ä»¶çš„æ›´æ–°ä¸æœåŠ¡è‡ªåŠ¨è£…é…ç­‰ç­‰ä¸€ç³»åˆ—çš„å¾®æœåŠ¡æ¶æ„è¦ç´ ã€‚</p><h3 id="nacosæ³¨å†Œä¸­å¿ƒå’Œzkæœ‰å•¥åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#nacosæ³¨å†Œä¸­å¿ƒå’Œzkæœ‰å•¥åŒºåˆ«" aria-hidden="true">#</a> nacosæ³¨å†Œä¸­å¿ƒå’Œzkæœ‰å•¥åŒºåˆ«ï¼Ÿ</h3><figure><img src="'+$+'" alt="image-20220615222525633" tabindex="0" loading="lazy"><figcaption>image-20220615222525633</figcaption></figure><h3 id="åˆ†å¸ƒå¼ç™»å½•æ€ä¹ˆä¿æŒçŠ¶æ€-ç®€è€Œè¨€ä¹‹-å•ç‚¹ç™»å½•æ€ä¹ˆå®ç°" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼ç™»å½•æ€ä¹ˆä¿æŒçŠ¶æ€-ç®€è€Œè¨€ä¹‹-å•ç‚¹ç™»å½•æ€ä¹ˆå®ç°" aria-hidden="true">#</a> åˆ†å¸ƒå¼ç™»å½•æ€ä¹ˆä¿æŒçŠ¶æ€ ï¼ˆç®€è€Œè¨€ä¹‹ï¼šå•ç‚¹ç™»å½•æ€ä¹ˆå®ç°ï¼Ÿï¼‰</h3>',17),Yt={href:"https://zhuanlan.zhihu.com/p/66037342",target:"_blank",rel:"noopener noreferrer"},Zt={href:"https://mp.weixin.qq.com/s?__biz=MzI4MTY5NTk4Ng==&mid=2247489168&idx=1&sn=194ade3bfe3ae19436fd80853c135f54&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},$t=t('<h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿä¸­-æœ¬åœ°ç¼“å­˜å’Œ-redis-ä¸­çš„æ•°æ®æ˜¯å¦æ˜¯æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤‡ä»½åŒæ ·çš„æ•°æ®-æš‚æ—¶ç†è§£ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼ç³»ç»Ÿä¸­-æœ¬åœ°ç¼“å­˜å’Œ-redis-ä¸­çš„æ•°æ®æ˜¯å¦æ˜¯æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤‡ä»½åŒæ ·çš„æ•°æ®-æš‚æ—¶ç†è§£ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§" aria-hidden="true">#</a> åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ¬åœ°ç¼“å­˜å’Œ Redis ä¸­çš„æ•°æ®æ˜¯å¦æ˜¯æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤‡ä»½åŒæ ·çš„æ•°æ®ï¼ˆæš‚æ—¶ç†è§£ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§ï¼‰</h3><p>åˆ†å¸ƒå¼ç¼“å­˜çš„è¯ï¼Œä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸»è¦æ˜¯ <strong>Memcached</strong> å’Œ <strong>Redis</strong>ã€‚ä¸è¿‡ï¼Œç°åœ¨åŸºæœ¬æ²¡æœ‰çœ‹è¿‡è¿˜æœ‰é¡¹ç›®ä½¿ç”¨ <strong>Memcached</strong> æ¥åšç¼“å­˜ï¼Œéƒ½æ˜¯ç›´æ¥ç”¨ <strong>Redis</strong>ã€‚</p><p>Memcached æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æœ€å¼€å§‹å…´èµ·çš„é‚£ä¼šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ã€‚åæ¥ï¼Œéšç€ Redis çš„å‘å±•ï¼Œå¤§å®¶æ…¢æ…¢éƒ½è½¬è€Œä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ Redis äº†ã€‚</p><p>åˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯å•æœºç¼“å­˜çš„å®¹é‡å—æœåŠ¡å™¨é™åˆ¶å¹¶ä¸”æ— æ³•ä¿å­˜é€šç”¨ä¿¡æ¯çš„é—®é¢˜ã€‚å› ä¸ºï¼Œæœ¬åœ°ç¼“å­˜åªåœ¨å½“å‰æœåŠ¡é‡Œæœ‰æ•ˆï¼Œæ¯”å¦‚å¦‚æœä½ éƒ¨ç½²äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œä»–ä»¬ä¸¤è€…ä¹‹é—´çš„ç¼“å­˜æ•°æ®æ˜¯æ— æ³•å…±åŒçš„ã€‚</p><p>å…·ä½“æ–¹æ¡ˆï¼š</p>',5),np={href:"https://blog.csdn.net/alionsss/article/details/107451485",target:"_blank",rel:"noopener noreferrer"},sp=n("h3",{id:"åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³æ¦‚å¿µ-åºåˆ—åŒ–åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨-è®²ä¸€ä¸‹-thrift",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³æ¦‚å¿µ-åºåˆ—åŒ–åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨-è®²ä¸€ä¸‹-thrift","aria-hidden":"true"},"#"),s(" åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³æ¦‚å¿µï¼Œåºåˆ—åŒ–åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œè®²ä¸€ä¸‹ thrift")],-1),ap={href:"https://thrift.apache.org/",target:"_blank",rel:"noopener noreferrer"},ep=n("h3",{id:"nacosä½œä¸ºé…ç½®ä¸­å¿ƒæ˜¯åŸºäºæ¨è¿˜æ˜¯æ‹‰å–æ›´æ–°é…ç½®-è¿™ä¸ªè¿‡ç¨‹ç”¨é•¿è½®è¯¢ä¼šæœ‰ä»€ä¹ˆé—®é¢˜",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nacosä½œä¸ºé…ç½®ä¸­å¿ƒæ˜¯åŸºäºæ¨è¿˜æ˜¯æ‹‰å–æ›´æ–°é…ç½®-è¿™ä¸ªè¿‡ç¨‹ç”¨é•¿è½®è¯¢ä¼šæœ‰ä»€ä¹ˆé—®é¢˜","aria-hidden":"true"},"#"),s(" nacosä½œä¸ºé…ç½®ä¸­å¿ƒæ˜¯åŸºäºæ¨è¿˜æ˜¯æ‹‰å–æ›´æ–°é…ç½®ï¼Ÿè¿™ä¸ªè¿‡ç¨‹ç”¨é•¿è½®è¯¢ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ")],-1),tp={href:"https://developer.aliyun.com/article/785050",target:"_blank",rel:"noopener noreferrer"},pp=t('<p>å®¢æˆ·ç«¯ä¸»åŠ¨æ‹‰çš„ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹ <code>TCP</code>é•¿è¿æ¥ï¼Œå½“æœåŠ¡ç«¯é…ç½®æ•°æ®æœ‰å˜åŠ¨ï¼Œç«‹åˆ»é€šè¿‡å»ºç«‹çš„é•¿è¿æ¥å°†æ•°æ®æ¨é€ç»™å®¢æˆ·ç«¯</p><p>é•¿è½®è¯¢å¯ä¸æ˜¯ä»€ä¹ˆæ–°æŠ€æœ¯ï¼Œå®ƒä¸è¿‡æ˜¯ç”±æœåŠ¡ç«¯æ§åˆ¶å“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„è¿”å›æ—¶é—´ï¼Œæ¥å‡å°‘å®¢æˆ·ç«¯æ— æ•ˆè¯·æ±‚çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µï¼Œå…¶å®å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä¸çŸ­è½®è¯¢çš„ä½¿ç”¨å¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚</p><p>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡ç«¯ä¸ä¼šç«‹å³è¿”å›è¯·æ±‚ç»“æœï¼Œè€Œæ˜¯å°†è¯·æ±‚æŒ‚èµ·ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæ­¤æ®µæ—¶é—´å†…æœåŠ¡ç«¯æ•°æ®å˜æ›´ï¼Œç«‹å³å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè‹¥æ˜¯ä¸€ç›´æ— å˜åŒ–åˆ™ç­‰åˆ°æŒ‡å®šçš„è¶…æ—¶æ—¶é—´åå“åº”è¯·æ±‚ï¼Œå®¢æˆ·ç«¯é‡æ–°å‘èµ·é•¿é“¾æ¥ã€‚</p><figure><img src="'+nn+'" alt="image-20220614222755372" tabindex="0" loading="lazy"><figcaption>image-20220614222755372</figcaption></figure><h3 id="é€šè¿‡-referenceæ³¨è§£-dubboæ˜¯æ€ä¹ˆå¾—åˆ°æœåŠ¡æä¾›è€…çš„å®ä¾‹åŒ–å¯¹è±¡-ä¸­é—´çš„è¿‡ç¨‹èƒ½å¦ç®€å•è®²ä¸€ä¸‹" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡-referenceæ³¨è§£-dubboæ˜¯æ€ä¹ˆå¾—åˆ°æœåŠ¡æä¾›è€…çš„å®ä¾‹åŒ–å¯¹è±¡-ä¸­é—´çš„è¿‡ç¨‹èƒ½å¦ç®€å•è®²ä¸€ä¸‹" aria-hidden="true">#</a> é€šè¿‡@Referenceæ³¨è§£ï¼Œdubboæ˜¯æ€ä¹ˆå¾—åˆ°æœåŠ¡æä¾›è€…çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Ÿä¸­é—´çš„è¿‡ç¨‹èƒ½å¦ç®€å•è®²ä¸€ä¸‹</h3><h3 id="hystrix-å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#hystrix-å·¥ä½œåŸç†" aria-hidden="true">#</a> hystrix å·¥ä½œåŸç†</h3><p>Hystrix å·¥ä½œæµç¨‹å›¾å¦‚ä¸‹:</p><figure><img src="'+sn+'" alt="image-20220618221301273" tabindex="0" loading="lazy"><figcaption>image-20220618221301273</figcaption></figure><p><strong>æ„å»ºå‘½ä»¤</strong></p><blockquote><p>Hystrix æä¾›äº†ä¸¤ä¸ªå‘½ä»¤å¯¹è±¡ï¼šHystrixCommandå’ŒHystrixObservableCommandï¼Œå®ƒå°†ä»£è¡¨ä½ çš„ä¸€ä¸ªä¾èµ–è¯·æ±‚ä»»åŠ¡ï¼Œå‘æ„é€ å‡½æ•°ä¸­ä¼ å…¥è¯·æ±‚ä¾èµ–æ‰€éœ€è¦çš„å‚æ•°ã€‚</p></blockquote><p><strong>æ‰§è¡Œå‘½ä»¤</strong></p><p>æœ‰å››ç§æ–¹å¼æ‰§è¡ŒHystrixå‘½ä»¤ã€‚åˆ†åˆ«æ˜¯ï¼š</p><ul><li>R execute()ï¼šåŒæ­¥é˜»å¡æ‰§è¡Œçš„ï¼Œä»ä¾èµ–è¯·æ±‚ä¸­æ¥æ”¶åˆ°å•ä¸ªå“åº”ã€‚</li><li>Future queue()ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å•ä¸ªå“åº”çš„Futureå¯¹è±¡ã€‚</li><li>Observable observe()ï¼šåˆ›å»ºObservableåä¼šè®¢é˜…Observableï¼Œä»ä¾èµ–è¯·æ±‚ä¸­è¿”å›ä»£è¡¨å“åº”çš„Observableå¯¹è±¡</li><li>Observable toObservable()ï¼šcold observableï¼Œè¿”å›ä¸€ä¸ªObservableï¼Œåªæœ‰è®¢é˜…æ—¶æ‰ä¼šæ‰§è¡ŒHystrixå‘½ä»¤ï¼Œå¯ä»¥è¿”å›å¤šä¸ªç»“æœ</li></ul><p><strong>æ£€æŸ¥å“åº”æ˜¯å¦è¢«ç¼“å­˜</strong></p><p>å¦‚æœå¯ç”¨äº† Hystrixç¼“å­˜ï¼Œä»»åŠ¡æ‰§è¡Œå‰å°†å…ˆåˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒå‘½ä»¤æ‰§è¡Œçš„ç¼“å­˜ã€‚å¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›åŒ…å«ç¼“å­˜å“åº”çš„Observableï¼›å¦‚æœæ²¡æœ‰ç¼“å­˜çš„ç»“æœï¼Œä½†å¯åŠ¨äº†ç¼“å­˜ï¼Œå°†ç¼“å­˜æœ¬æ¬¡æ‰§è¡Œç»“æœä»¥ä¾›åç»­ä½¿ç”¨ã€‚</p><ul><li>æ£€æŸ¥å›è·¯å™¨æ˜¯å¦æ‰“å¼€ å›è·¯å™¨(circuit-breaker)å’Œä¿é™©ä¸ç±»ä¼¼ï¼Œä¿é™©ä¸åœ¨å‘ç”Ÿå±é™©æ—¶å°†ä¼šçƒ§æ–­ä»¥ä¿æŠ¤ç”µè·¯ï¼Œè€Œå›è·¯å™¨å¯ä»¥åœ¨è¾¾åˆ°æˆ‘ä»¬è®¾å®šçš„é˜€å€¼æ—¶è§¦å‘çŸ­è·¯(æ¯”å¦‚è¯·æ±‚å¤±è´¥ç‡è¾¾åˆ°50%)ï¼Œæ‹’ç»æ‰§è¡Œä»»ä½•è¯·æ±‚ã€‚</li></ul><p>å¦‚æœå›è·¯å™¨è¢«æ‰“å¼€ï¼ŒHystrixå°†ä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œç›´æ¥è¿›å…¥Fallbackå¤„ç†é€»è¾‘ã€‚</p><ol><li>æ£€æŸ¥çº¿ç¨‹æ± /ä¿¡å·é‡/é˜Ÿåˆ—æƒ…å†µ Hystrix éš”ç¦»æ–¹å¼æœ‰çº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ã€‚å½“ä½¿ç”¨Hystrixçº¿ç¨‹æ± æ—¶ï¼ŒHystrix é»˜è®¤ä¸ºæ¯ä¸ªä¾èµ–æœåŠ¡åˆ†é…10ä¸ªçº¿ç¨‹ï¼Œå½“10ä¸ªçº¿ç¨‹éƒ½ç¹å¿™æ—¶ï¼Œå°†æ‹’ç»æ‰§è¡Œå‘½ä»¤,ï¼Œè€Œæ˜¯ç«‹å³è·³åˆ°æ‰§è¡Œfallbacké€»è¾‘ã€‚</li><li>æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡ é€šè¿‡HystrixObservableCommand.construct() æˆ–è€… HystrixCommand.run() æ¥è¿è¡Œç”¨æˆ·çœŸæ­£çš„ä»»åŠ¡ã€‚</li><li>è®¡ç®—å›è·¯å¥åº·æƒ…å†µ æ¯æ¬¡å¼€å§‹æ‰§è¡Œcommandã€ç»“æŸæ‰§è¡Œcommandä»¥åŠå‘ç”Ÿå¼‚å¸¸ç­‰æƒ…å†µæ—¶ï¼Œéƒ½ä¼šè®°å½•æ‰§è¡Œæƒ…å†µï¼Œä¾‹å¦‚ï¼šæˆåŠŸã€å¤±è´¥ã€æ‹’ç»å’Œè¶…æ—¶ç­‰æŒ‡æ ‡æƒ…å†µï¼Œä¼šå®šæœŸå¤„ç†è¿™äº›æ•°æ®ï¼Œå†æ ¹æ®è®¾å®šçš„æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å¼€å¯å›è·¯å™¨ã€‚</li><li>å‘½ä»¤å¤±è´¥æ—¶æ‰§è¡ŒFallbacké€»è¾‘ åœ¨å‘½ä»¤å¤±è´¥æ—¶æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„ Fallback é€»è¾‘ã€‚ä¸Šå›¾ä¸­çš„æ–­è·¯ã€çº¿ç¨‹æ± æ‹’ç»ã€ä¿¡å·é‡æ‹’ç»ã€æ‰§è¡Œæ‰§è¡Œã€æ‰§è¡Œè¶…æ—¶éƒ½ä¼šè¿›å…¥Fallbackå¤„ç†ã€‚</li><li>è¿”å›æ‰§è¡Œç»“æœ åŸå§‹å¯¹è±¡ç»“æœå°†ä»¥Observableå½¢å¼è¿”å›ï¼Œåœ¨è¿”å›ç»™ç”¨æˆ·ä¹‹å‰ï¼Œä¼šæ ¹æ®è°ƒç”¨æ–¹å¼çš„ä¸åŒåšä¸€äº›å¤„ç†ã€‚</li></ol><h3 id="åˆ†å¸ƒå¼idç”Ÿæˆæ–¹æ¡ˆæœ‰å“ªäº›-ä»€ä¹ˆæ˜¯é›ªèŠ±ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼idç”Ÿæˆæ–¹æ¡ˆæœ‰å“ªäº›-ä»€ä¹ˆæ˜¯é›ªèŠ±ç®—æ³•" aria-hidden="true">#</a> åˆ†å¸ƒå¼idç”Ÿæˆæ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿä»€ä¹ˆæ˜¯é›ªèŠ±ç®—æ³•ï¼Ÿ</h3><p>åˆ†å¸ƒå¼idç”Ÿæˆæ–¹æ¡ˆä¸»è¦æœ‰ï¼š</p><ul><li>UUID</li><li>æ•°æ®åº“è‡ªå¢ID</li><li>åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰å®ç°</li><li>ç™¾åº¦ ï¼ˆUidgeneratorï¼‰</li><li>ç¾å›¢ï¼ˆLeafï¼‰</li></ul><p>ä»€ä¹ˆæ˜¯<strong>é›ªèŠ±ç®—æ³•</strong>ï¼Ÿ</p><blockquote><p>é›ªèŠ±ç®—æ³•æ˜¯ä¸€ç§ç”Ÿæˆåˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDçš„ç®—æ³•ï¼Œç”Ÿæˆçš„IDç§°ä¸ºSnowflake IDsã€‚è¿™ç§ç®—æ³•ç”±Twitteråˆ›å»ºï¼Œå¹¶ç”¨äºæ¨æ–‡çš„IDã€‚</p></blockquote><p>ä¸€ä¸ªSnowflake IDæœ‰64ä½ã€‚</p><ul><li>ç¬¬1ä½ï¼šJavaä¸­longçš„æœ€é«˜ä½æ˜¯ç¬¦å·ä½ä»£è¡¨æ­£è´Ÿï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œä¸€èˆ¬ç”ŸæˆIDéƒ½ä¸ºæ­£æ•°ï¼Œæ‰€ä»¥é»˜è®¤ä¸º0ã€‚</li><li>æ¥ä¸‹æ¥å‰41ä½æ˜¯æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºäº†è‡ªé€‰å®šçš„æ—¶æœŸä»¥æ¥çš„æ¯«ç§’æ•°ã€‚</li><li>æ¥ä¸‹æ¥çš„10ä½ä»£è¡¨è®¡ç®—æœºIDï¼Œé˜²æ­¢å†²çªã€‚</li><li>å…¶ä½™12ä½ä»£è¡¨æ¯å°æœºå™¨ä¸Šç”ŸæˆIDçš„åºåˆ—å·ï¼Œè¿™å…è®¸åœ¨åŒä¸€æ¯«ç§’å†…åˆ›å»ºå¤šä¸ªSnowflake IDã€‚</li></ul><figure><img src="'+an+`" alt="image-20220618222305758" tabindex="0" loading="lazy"><figcaption>image-20220618222305758</figcaption></figure><h3 id="åˆ†å¸ƒå¼é”æ–¹æ¡ˆ-mysqlåˆ°redlock-è®¨è®ºé”ç»­æœŸ-gcå½±å“-2022å­—èŠ‚ç•ªèŒ„" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼é”æ–¹æ¡ˆ-mysqlåˆ°redlock-è®¨è®ºé”ç»­æœŸ-gcå½±å“-2022å­—èŠ‚ç•ªèŒ„" aria-hidden="true">#</a> åˆ†å¸ƒå¼é”æ–¹æ¡ˆ(MySQLåˆ°redlock)ï¼Œè®¨è®ºé”ç»­æœŸï¼ŒGCå½±å“ ï¼ˆ2022å­—èŠ‚ç•ªèŒ„ï¼‰</h3><h4 id="æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“" aria-hidden="true">#</a> æ•°æ®åº“</h4><h5 id="åŸºäºæ•°æ®åº“è¡¨-é”è¡¨-å¾ˆå°‘ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åŸºäºæ•°æ®åº“è¡¨-é”è¡¨-å¾ˆå°‘ä½¿ç”¨" aria-hidden="true">#</a> åŸºäºæ•°æ®åº“è¡¨ï¼ˆé”è¡¨ï¼Œå¾ˆå°‘ä½¿ç”¨ï¼‰</h5><p>æœ€ç®€å•çš„æ–¹å¼å¯èƒ½å°±æ˜¯ç›´æ¥åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°äº†ã€‚å½“æˆ‘ä»¬æƒ³è¦è·å¾—é”çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> database_lock <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>resource<span class="token punctuation">\`</span></span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;é”å®šçš„èµ„æº&#39;</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>description<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&quot;&quot;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;æè¿°&#39;</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> uiq_idx_resource <span class="token punctuation">(</span>resource<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;æ•°æ®åº“åˆ†å¸ƒå¼é”è¡¨&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬æƒ³è¦è·å¾—é”æ—¶ï¼Œå¯ä»¥æ’å…¥ä¸€æ¡æ•°æ®ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> database_lock<span class="token punctuation">(</span>resource<span class="token punctuation">,</span> description<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;lock&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å½“éœ€è¦é‡Šæ”¾é”çš„æ—¶ï¼Œå¯ä»¥åˆ é™¤è¿™æ¡æ•°æ®ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> database_lock <span class="token keyword">WHERE</span> resource<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="åŸºäºæ‚²è§‚é”" tabindex="-1"><a class="header-anchor" href="#åŸºäºæ‚²è§‚é”" aria-hidden="true">#</a> åŸºäºæ‚²è§‚é”</h5><p>åœ¨å¯¹ä»»æ„è®°å½•è¿›è¡Œä¿®æ”¹å‰ï¼Œå…ˆå°è¯•ä¸ºè¯¥è®°å½•åŠ ä¸Šæ’ä»–é”ï¼ˆexclusive lockingï¼‰ã€‚</p><p>å¦‚æœåŠ é”å¤±è´¥ï¼Œè¯´æ˜è¯¥è®°å½•æ­£åœ¨è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰æŸ¥è¯¢å¯èƒ½è¦ç­‰å¾…æˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ å…·ä½“å“åº”æ–¹å¼ç”±å¼€å‘è€…æ ¹æ®å®é™…éœ€è¦å†³å®šã€‚</p><p>å¦‚æœæˆåŠŸåŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹è®°å½•åšä¿®æ”¹ï¼Œäº‹åŠ¡å®Œæˆåå°±ä¼šè§£é”äº†ã€‚</p><p>å…¶é—´å¦‚æœæœ‰å…¶ä»–å¯¹è¯¥è®°å½•åšä¿®æ”¹æˆ–åŠ æ’ä»–é”çš„æ“ä½œï¼Œéƒ½ä¼šç­‰å¾…æˆ‘ä»¬è§£é”æˆ–ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>è¦ä½¿ç”¨æ‚²è§‚é”ï¼Œæˆ‘ä»¬å¿…é¡»å…³é—­mysqlæ•°æ®åº“çš„è‡ªåŠ¨æäº¤å±æ€§ï¼Œå› ä¸ºMySQLé»˜è®¤ä½¿ç”¨autocommitæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œåï¼ŒMySQLä¼šç«‹åˆ»å°†ç»“æœè¿›è¡Œæäº¤ã€‚set autocommit=0;</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">//0.å¼€å§‹äº‹åŠ¡</span>
<span class="token keyword">begin</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token keyword">begin</span> <span class="token keyword">work</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>ä¸‰è€…é€‰ä¸€å°±å¯ä»¥<span class="token punctuation">)</span>
<span class="token comment">//1.æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯</span>
<span class="token keyword">select</span> <span class="token keyword">status</span> <span class="token keyword">from</span> t_goods <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>
<span class="token comment">//2.æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t_orders <span class="token punctuation">(</span>id<span class="token punctuation">,</span>goods_id<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.ä¿®æ”¹å•†å“statusä¸º2</span>
<span class="token keyword">update</span> t_goods <span class="token keyword">set</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//4.æäº¤äº‹åŠ¡</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token keyword">commit</span> <span class="token keyword">work</span><span class="token punctuation">;</span>
    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>selectâ€¦for update</code>çš„æ–¹å¼ï¼Œè¿™æ ·å°±é€šè¿‡å¼€å¯æ’ä»–é”çš„æ–¹å¼å®ç°äº†æ‚²è§‚é”ã€‚æ­¤æ—¶åœ¨t_goodsè¡¨ä¸­ï¼Œidä¸º1çš„ é‚£æ¡æ•°æ®å°±è¢«æˆ‘ä»¬é”å®šäº†ï¼Œå…¶å®ƒçš„äº‹åŠ¡å¿…é¡»ç­‰æœ¬æ¬¡äº‹åŠ¡æäº¤ä¹‹åæ‰èƒ½æ‰§è¡Œã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ä¿è¯å½“å‰çš„æ•°æ®ä¸ä¼šè¢«å…¶å®ƒäº‹åŠ¡ä¿®æ”¹ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œä½¿ç”¨<code>selectâ€¦for update</code>ä¼šæŠŠæ•°æ®ç»™é”ä½ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€äº›é”çš„çº§åˆ«ï¼ŒMySQL InnoDBé»˜è®¤è¡Œçº§é”ã€‚è¡Œçº§é”éƒ½æ˜¯åŸºäºç´¢å¼•çš„ï¼Œå¦‚æœä¸€æ¡SQLè¯­å¥ç”¨ä¸åˆ°ç´¢å¼•æ˜¯ä¸ä¼šä½¿ç”¨è¡Œçº§é”çš„ï¼Œä¼šä½¿ç”¨è¡¨çº§é”æŠŠæ•´å¼ è¡¨é”ä½ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ã€‚</p><h5 id="åŸºäºä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#åŸºäºä¹è§‚é”" aria-hidden="true">#</a> åŸºäºä¹è§‚é”</h5><p>ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆåˆåâ€œä¹è§‚é”â€ï¼ŒOptimistic Concurrency Controlï¼Œç¼©å†™â€œOCCâ€ï¼‰æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ã€‚å®ƒå‡è®¾å¤šç”¨æˆ·å¹¶å‘çš„äº‹åŠ¡åœ¨å¤„ç†æ—¶ä¸ä¼šå½¼æ­¤äº’ç›¸å½±å“ï¼Œå„äº‹åŠ¡èƒ½å¤Ÿåœ¨ä¸äº§ç”Ÿé”çš„æƒ…å†µä¸‹å¤„ç†å„è‡ªå½±å“çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚åœ¨æäº¤æ•°æ®æ›´æ–°ä¹‹å‰ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šå…ˆæ£€æŸ¥åœ¨è¯¥äº‹åŠ¡è¯»å–æ•°æ®åï¼Œæœ‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡åˆä¿®æ”¹äº†è¯¥æ•°æ®ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡æœ‰æ›´æ–°çš„è¯ï¼Œæ­£åœ¨æäº¤çš„äº‹åŠ¡ä¼šè¿›è¡Œå›æ»šã€‚</p><p>ä½¿ç”¨ç‰ˆæœ¬å·æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®åˆå§‹åŒ–æ—¶æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ•°æ®çš„æ›´æ–°æ“ä½œéƒ½å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1æ“ä½œã€‚å¹¶åˆ¤æ–­å½“å‰ç‰ˆæœ¬å·æ˜¯ä¸æ˜¯è¯¥æ•°æ®çš„æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token number">1.</span>æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯
<span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">status</span><span class="token punctuation">,</span><span class="token keyword">status</span><span class="token punctuation">,</span>version<span class="token punctuation">)</span> <span class="token keyword">from</span> t_goods <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token comment">#{id}</span>
<span class="token number">2.</span>æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•
<span class="token number">3.</span>ä¿®æ”¹å•†å“<span class="token keyword">status</span>ä¸º<span class="token number">2</span>
<span class="token keyword">update</span> t_goods 
<span class="token keyword">set</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>version<span class="token operator">=</span>version<span class="token operator">+</span><span class="token number">1</span>
<span class="token keyword">where</span> id<span class="token operator">=</span><span class="token comment">#{id} and version=#{version};</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”æœºåˆ¶å¾€å¾€åŸºäºç³»ç»Ÿä¸­æ•°æ®å­˜å‚¨é€»è¾‘ï¼Œå› æ­¤ä¹Ÿå…·å¤‡ä¸€å®šçš„å±€é™æ€§ã€‚ç”±äºä¹è§‚é”æœºåˆ¶æ˜¯åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­å®ç°çš„ï¼Œå¯¹äºæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„ç”¨æˆ·æ•°æ®æ›´æ–°æ“ä½œä¸å—æˆ‘ä»¬ç³»ç»Ÿçš„æ§åˆ¶ï¼Œå› æ­¤å¯èƒ½ä¼šé€ æˆè„æ•°æ®è¢«æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬åº”è¯¥å……åˆ†è€ƒè™‘åˆ°è¿™äº›æƒ…å†µï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼ˆå¦‚å°†ä¹è§‚é”ç­–ç•¥åœ¨æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°ï¼Œå¯¹å¤–åªå¼€æ”¾åŸºäºæ­¤å­˜å‚¨è¿‡ç¨‹çš„æ•°æ®æ›´æ–°é€”å¾„ï¼Œè€Œä¸æ˜¯å°†æ•°æ®åº“è¡¨ç›´æ¥å¯¹å¤–å…¬å¼€ï¼‰</p><h4 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> redis</h4><h5 id="set-nx-px-lua" tabindex="-1"><a class="header-anchor" href="#set-nx-px-lua" aria-hidden="true">#</a> set NX PX + Lua</h5><p><strong>åŠ é”</strong>ï¼š set NX PX + é‡è¯• + é‡è¯•é—´éš”</p><p>å‘Rediså‘èµ·å¦‚ä¸‹å‘½ä»¤: <code>SET productId:lock 0xx9p03001 NX PX 30000</code> å…¶ä¸­ï¼Œ&quot;productId&quot;ç”±è‡ªå·±å®šä¹‰ï¼Œå¯ä»¥æ˜¯ä¸æœ¬æ¬¡ä¸šåŠ¡æœ‰å…³çš„idï¼Œ&quot;0xx9p03001&quot;æ˜¯ä¸€ä¸²éšæœºå€¼ï¼Œå¿…é¡»ä¿è¯å…¨å±€å”¯ä¸€(åŸå› åœ¨åæ–‡ä¸­ä¼šæåˆ°)ï¼Œâ€œNX&quot;æŒ‡çš„æ˜¯å½“ä¸”ä»…å½“key(ä¹Ÿå°±æ˜¯æ¡ˆä¾‹ä¸­çš„&quot;productId:lockâ€)åœ¨Redisä¸­ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›æ‰§è¡ŒæˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œå¤±è´¥ã€‚&quot;PX 30000&quot;æŒ‡çš„æ˜¯åœ¨30ç§’åï¼Œkeyå°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚æ‰§è¡Œå‘½ä»¤åè¿”å›æˆåŠŸï¼Œè¡¨æ˜æœåŠ¡æˆåŠŸçš„è·å¾—äº†é”ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> expire<span class="token punctuation">,</span> <span class="token keyword">int</span> retryTimes<span class="token punctuation">,</span> <span class="token keyword">long</span> retryDuration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// use JedisCommands instead of setIfAbsense</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token function">setRedis</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// retry if needed</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> retryTimes<span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;lock failed, retrying...&quot;</span> <span class="token operator">+</span> retryTimes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>retryDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// use JedisCommands instead of setIfAbsense</span>
        result <span class="token operator">=</span> <span class="token function">setRedis</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">setRedis</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> expire<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisCallback <span class="token operator">=</span> connection <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">JedisCommands</span> commands <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JedisCommands</span><span class="token punctuation">)</span> connection<span class="token punctuation">.</span><span class="token function">getNativeConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token class-name">SnowIDUtil</span><span class="token punctuation">.</span><span class="token function">uniqueStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lockFlag<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> commands<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> <span class="token constant">NX</span><span class="token punctuation">,</span> <span class="token constant">PX</span><span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çœ‹è¿™é‡Œ</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>redisCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;set redis occurred an exception&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£é”</strong>ï¼šé‡‡ç”¨luaè„šæœ¬</p><p>åœ¨åˆ é™¤keyä¹‹å‰ï¼Œä¸€å®šè¦åˆ¤æ–­æœåŠ¡AæŒæœ‰çš„valueä¸Rediså†…å­˜å‚¨çš„valueæ˜¯å¦ä¸€è‡´ã€‚å¦‚æœè´¸ç„¶ä½¿ç”¨æœåŠ¡AæŒæœ‰çš„keyæ¥åˆ é™¤é”ï¼Œåˆ™ä¼šè¯¯å°†æœåŠ¡Bçš„é”é‡Šæ”¾æ‰ã€‚</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token keyword">if</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span>ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
	<span class="token keyword">return</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;del&quot;</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
	<span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åŸºäºredlockå®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#åŸºäºredlockå®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> åŸºäºRedLockå®ç°åˆ†å¸ƒå¼é”</h5>`,59),op={href:"http://antirez.com/news/101",target:"_blank",rel:"noopener noreferrer"},ip=t('<p>å‡è®¾æœ‰ä¸¤ä¸ªæœåŠ¡Aã€Béƒ½å¸Œæœ›è·å¾—é”ï¼Œæœ‰ä¸€ä¸ªåŒ…å«äº†5ä¸ªredis masterçš„Redis Clusterï¼Œæ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹:</p><ol><li>å®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½: æ¯«ç§’</li><li>æœåŠ¡Aè½®å¯»æ¯ä¸ªmasterèŠ‚ç‚¹ï¼Œå°è¯•åˆ›å»ºé”ã€‚(è¿™é‡Œé”çš„è¿‡æœŸæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œä¸€èˆ¬å°±å‡ åæ¯«ç§’) RedLockç®—æ³•ä¼šå°è¯•åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šåˆ†åˆ«åˆ›å»ºé”ï¼Œå‡å¦‚èŠ‚ç‚¹æ€»æ•°ä¸ºnï¼Œé‚£ä¹ˆå¤§å¤šæ•°èŠ‚ç‚¹æŒ‡çš„æ˜¯n/2+1ã€‚</li><li>å®¢æˆ·ç«¯è®¡ç®—æˆåŠŸå»ºç«‹å®Œé”çš„æ—¶é—´ï¼Œå¦‚æœå»ºé”æ—¶é—´å°äºè¶…æ—¶æ—¶é—´ï¼Œå°±å¯ä»¥åˆ¤å®šé”åˆ›å»ºæˆåŠŸã€‚å¦‚æœé”åˆ›å»ºå¤±è´¥ï¼Œåˆ™ä¾æ¬¡(éå†masterèŠ‚ç‚¹)åˆ é™¤é”ã€‚</li><li>åªè¦æœ‰å…¶å®ƒæœåŠ¡åˆ›å»ºè¿‡åˆ†å¸ƒå¼é”ï¼Œé‚£ä¹ˆå½“å‰æœåŠ¡å°±å¿…é¡»è½®å¯»å°è¯•è·å–é”ã€‚</li></ol><h5 id="åŸºäºredisçš„å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#åŸºäºredisçš„å®¢æˆ·ç«¯" aria-hidden="true">#</a> åŸºäºRedisçš„å®¢æˆ·ç«¯</h5><blockquote><p>è¿™é‡ŒRedisçš„å®¢æˆ·ç«¯ï¼ˆJedis, Redisson, Lettuceç­‰ï¼‰éƒ½æ˜¯åŸºäºä¸Šè¿°ä¸¤ç±»å½¢å¼æ¥å®ç°åˆ†å¸ƒå¼é”çš„ï¼Œåªæ˜¯ä¸¤ç±»å½¢å¼çš„å°è£…ä»¥åŠä¸€äº›ä¼˜åŒ–ï¼ˆæ¯”å¦‚Redissonçš„watch dog)ã€‚</p></blockquote><p>ä»¥åŸºäºRedissonå®ç°åˆ†å¸ƒå¼é”ä¸ºä¾‹ï¼ˆæ”¯æŒäº† å•å®ä¾‹ã€Rediså“¨å…µã€redis clusterã€redis master-slaveç­‰å„ç§éƒ¨ç½²æ¶æ„ï¼‰ï¼š</p><p><strong>ç‰¹è‰²</strong>ï¼Ÿ</p><ol><li>redissonæ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡luaè„šæœ¬æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œçš„åŸå­æ€§</li><li>redissonè®¾ç½®äº†watchdogçœ‹é—¨ç‹—ï¼Œâ€œçœ‹é—¨ç‹—â€çš„é€»è¾‘ä¿è¯äº†æ²¡æœ‰æ­»é”å‘ç”Ÿ</li><li>redissonæ”¯æŒRedlockçš„å®ç°æ–¹å¼ã€‚</li></ol><p><strong>è¿‡ç¨‹</strong>ï¼Ÿ</p><ol><li>çº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸ: æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</li><li>çº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: è®¢é˜…äº†è§£é”æ¶ˆæ¯ï¼Œç„¶åå†å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</li></ol><p><strong>äº’æ–¥</strong>ï¼Ÿ</p><p>å¦‚æœè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯Bæ¥å°è¯•åŠ é”ï¼Œæ‰§è¡Œäº†åŒæ ·çš„ä¸€æ®µluaè„šæœ¬ã€‚ç¬¬ä¸€ä¸ªifåˆ¤æ–­ä¼šæ‰§è¡Œâ€œexists myLockâ€ï¼Œå‘ç°myLockè¿™ä¸ªé”keyå·²ç»å­˜åœ¨ã€‚æ¥ç€ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­myLocké”keyçš„hashæ•°æ®ç»“æ„ä¸­ï¼Œæ˜¯å¦åŒ…å«å®¢æˆ·ç«¯Bçš„IDï¼Œä½†æ˜æ˜¾æ²¡æœ‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯Bä¼šè·å–åˆ°pttl myLockè¿”å›çš„ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨myLockè¿™ä¸ªé”keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚æ­¤æ—¶å®¢æˆ·ç«¯Bä¼šè¿›å…¥ä¸€ä¸ªwhileå¾ªç¯ï¼Œä¸å¬çš„å°è¯•åŠ é”ã€‚</p><p><strong>watch dogè‡ªåŠ¨å»¶æ—¶æœºåˆ¶</strong>ï¼Ÿ</p><p>å®¢æˆ·ç«¯AåŠ é”çš„é”keyé»˜è®¤ç”Ÿå­˜æ—¶é—´åªæœ‰30ç§’ï¼Œå¦‚æœè¶…è¿‡äº†30ç§’ï¼Œå®¢æˆ·ç«¯Aè¿˜æƒ³ä¸€ç›´æŒæœ‰è¿™æŠŠé”ï¼Œæ€ä¹ˆåŠï¼Ÿå…¶å®åªè¦å®¢æˆ·ç«¯Aä¸€æ—¦åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœå®¢æˆ·ç«¯Aè¿˜æŒæœ‰é”keyï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚</p><p><strong>å¯é‡å…¥</strong>ï¼Ÿ</p><p>æ¯æ¬¡lockä¼šè°ƒç”¨incrbyï¼Œæ¯æ¬¡unlockä¼šå‡ä¸€ã€‚</p><h6 id="è¿›ä¸€æ­¥ç†è§£" tabindex="-1"><a class="header-anchor" href="#è¿›ä¸€æ­¥ç†è§£" aria-hidden="true">#</a> è¿›ä¸€æ­¥ç†è§£</h6>',16),cp=n("li",null,"å€ŸåŠ©Rediså®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œæœ‰ä¸€ä¸ªå…±åŒçš„ç¼ºé™·: å½“è·å–é”è¢«æ‹’ç»åï¼Œéœ€è¦ä¸æ–­çš„å¾ªç¯ï¼Œé‡æ–°å‘é€è·å–é”(åˆ›å»ºkey)çš„è¯·æ±‚ï¼Œç›´åˆ°è¯·æ±‚æˆåŠŸã€‚è¿™å°±é€ æˆç©ºè½¬ï¼Œæµªè´¹å®è´µçš„CPUèµ„æºã€‚",-1),lp={href:"https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html",target:"_blank",rel:"noopener noreferrer"},rp={href:"http://antirez.com/news/101",target:"_blank",rel:"noopener noreferrer"},up=t('<h3 id="æ€ä¹ˆç”¨çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡-ä¸ºä»€ä¹ˆç”¨" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆç”¨çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡-ä¸ºä»€ä¹ˆç”¨" aria-hidden="true">#</a> æ€ä¹ˆç”¨çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼Œä¸ºä»€ä¹ˆç”¨</h3><p><code>Timer</code>/<code>ScheduledExecutorService</code>/<code>SpringTask(@Schedule)</code>éƒ½æ˜¯å•æœºçš„ï¼Œä½†æˆ‘ä»¬ä¸€æ—¦ä¸Šäº†ç”Ÿäº§ç¯å¢ƒï¼Œåº”ç”¨éƒ¨ç½²<strong>å¾€å¾€</strong>éƒ½æ˜¯é›†ç¾¤æ¨¡å¼çš„ã€‚</p><p>åœ¨é›†ç¾¤ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å¸Œæœ›<strong>æŸä¸ªå®šæ—¶ä»»åŠ¡</strong>åªåœ¨æŸå°æœºå™¨ä¸Šæ‰§è¡Œï¼Œé‚£è¿™æ—¶å€™ï¼Œå•æœºå®ç°çš„å®šæ—¶ä»»åŠ¡å°±ä¸å¤ªå¥½å¤„ç†äº†ã€‚</p><p><code>Quartz</code>æ˜¯æœ‰<strong>é›†ç¾¤éƒ¨ç½²</strong>æ–¹æ¡ˆçš„ï¼Œæ‰€ä»¥æœ‰çš„äººä¼šåˆ©ç”¨<strong>æ•°æ®åº“è¡Œé”</strong>æˆ–è€…ä½¿ç”¨<strong>Redisåˆ†å¸ƒå¼é”</strong>æ¥è‡ªå·±å®ç°å®šæ—¶ä»»åŠ¡è·‘åœ¨æŸä¸€å°<strong>åº”ç”¨æœºå™¨</strong>ä¸Šï¼›åšè‚¯å®šæ˜¯èƒ½åšçš„ï¼ŒåŒ…æ‹¬æœ‰äº›æŒºå‡ºåçš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œèƒ½è§£å†³é—®é¢˜ã€‚</p><p>ä½†æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ä¸å•å•åªæœ‰è¿™äº›ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦æ”¯æŒ<strong>å®¹é”™</strong>åŠŸèƒ½ï¼ˆå¤±è´¥é‡è¯•ï¼‰ã€<strong>åˆ†ç‰‡</strong>åŠŸèƒ½ã€<strong>æ‰‹åŠ¨è§¦å‘</strong>ä¸€æ¬¡ä»»åŠ¡ã€æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç®¡ç†å®šæ—¶ä»»åŠ¡çš„<strong>åå°ç•Œé¢</strong>ã€<strong>è·¯ç”±</strong>è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚è¿™äº›åŠŸèƒ½ï¼Œå°±æ˜¯ä½œä¸ºã€Œ<strong>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶</strong>ã€æ‰€å…·å¤‡çš„ã€‚</p><p>æ—¢ç„¶ç°åœ¨å·²ç»æœ‰è¿™ä¹ˆå¤šçš„è½®å­äº†ï¼Œé‚£æˆ‘ä»¬ä½œä¸º<strong>ä½¿ç”¨æ–¹/éœ€æ±‚æ–¹</strong>å°±æ²¡å¿…è¦è‡ªå·±é‡æ–°å®ç°ä¸€å¥—äº†ï¼Œç”¨ç°æœ‰çš„å°±å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ç°æœ‰è½®å­çš„å®ç°è®¾è®¡æ€æƒ³ã€‚</p><h4 id="åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡åŸºç¡€" aria-hidden="true">#</a> åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡åŸºç¡€</h4><p><code>Quartz</code>æ˜¯ä¼˜ç§€çš„å¼€æºç»„ä»¶ï¼Œå®ƒå°†å®šæ—¶ä»»åŠ¡æŠ½è±¡äº†ä¸‰ä¸ªè§’è‰²ï¼š<strong>è°ƒåº¦å™¨</strong>ã€<strong>æ‰§è¡Œå™¨</strong>å’Œ<strong>ä»»åŠ¡</strong>ï¼Œä»¥è‡³äºå¸‚é¢ä¸Šçš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶éƒ½æœ‰ç±»ä¼¼è§’è‰²åˆ’åˆ†ã€‚</p><figure><img src="'+en+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯¹äºæˆ‘ä»¬ä½¿ç”¨æ–¹è€Œè¨€ï¼Œä¸€èˆ¬æ˜¯å¼•å…¥ä¸€ä¸ª<code>client</code>åŒ…ï¼Œç„¶åæ ¹æ®å®ƒçš„è§„åˆ™ï¼ˆå¯èƒ½æ˜¯ä½¿ç”¨æ³¨è§£æ ‡è¯†ï¼Œåˆæˆ–æ˜¯å®ç°æŸä¸ªæ¥å£ï¼‰ï¼Œéšåè‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„å®šæ—¶ä»»åŠ¡é€»è¾‘ã€‚</p><figure><img src="'+tn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>çœ‹ç€ä¸Šé¢çš„æ‰§è¡Œå›¾å¯¹åº”çš„è§’è‰²æŠ½è±¡ä»¥åŠä¸€èˆ¬ä½¿ç”¨å§¿åŠ¿ï¼Œåº”è¯¥è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£è¿™ä¸ªè¿‡ç¨‹çš„ã€‚æˆ‘ä»¬åˆå¯ä»¥å†ç¨å¾®æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><p><strong>1</strong>ã€ ä»»åŠ¡ä¿¡æ¯ä»¥åŠè°ƒåº¦çš„ä¿¡æ¯æ˜¯éœ€è¦<strong>å­˜å‚¨</strong>çš„ï¼Œå­˜å‚¨åœ¨å“ªï¼Ÿè°ƒåº¦å™¨æ˜¯éœ€è¦ã€Œ<strong>é€šçŸ¥</strong>ã€æ‰§è¡Œå™¨å»æ‰§è¡Œçš„ï¼Œé‚£ã€Œ<strong>é€šçŸ¥</strong>ã€æ˜¯ä»¥ä»€ä¹ˆæ–¹å¼å»åšï¼Ÿ</p><p><strong>2</strong>ã€è°ƒåº¦å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°å³å°†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡çš„å‘¢ï¼Ÿ</p><p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶åˆå¯ä»¥åˆ†æˆäº†<strong>ä¸¤ä¸ªæµæ´¾</strong>ï¼šä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–</p><ul><li>æ‰€è°“çš„ã€Œä¸­å¿ƒåŒ–ã€æŒ‡çš„æ˜¯ï¼šè°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨<strong>åˆ†ç¦»</strong>ï¼Œè°ƒåº¦å™¨ç»Ÿä¸€è¿›è¡Œè°ƒåº¦ï¼Œé€šçŸ¥æ‰§è¡Œå™¨å»æ‰§è¡Œå®šæ—¶ä»»åŠ¡</li><li>æ‰€è°“çš„ã€Œå»ä¸­å¿ƒåŒ–ã€æŒ‡çš„æ˜¯ï¼šè°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨<strong>è€¦åˆ</strong>ï¼Œè‡ªå·±è°ƒåº¦è‡ªå·±æ‰§è¡Œ</li></ul><p>å¯¹äºã€Œä¸­å¿ƒåŒ–ã€æµæ´¾æ¥è¯´ï¼Œå­˜å‚¨ç›¸å…³çš„ä¿¡æ¯å¾ˆå¯èƒ½æ˜¯åœ¨<strong>æ•°æ®åº“</strong>ï¼ˆDataBaseï¼‰ï¼Œè€Œæˆ‘ä»¬å¼•å…¥çš„<code>client</code>åŒ…å®é™…ä¸Šå°±æ˜¯<strong>æ‰§è¡Œå™¨</strong>ç›¸å…³çš„ä»£ç ã€‚è°ƒåº¦å™¨<strong>å®ç°äº†ä»»åŠ¡è°ƒåº¦</strong>çš„é€»è¾‘ï¼Œ<strong>è¿œç¨‹è°ƒç”¨</strong>æ‰§è¡Œå™¨è§¦å‘å¯¹åº”çš„é€»è¾‘ã€‚</p><figure><img src="'+pn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è°ƒåº¦å™¨ã€Œé€šçŸ¥ã€æ‰§è¡Œå™¨å»æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¯ä»¥æ˜¯é€šè¿‡ã€ŒRPCã€è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠŠä»»åŠ¡ä¿¡æ¯å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ç»™æ‰§è¡Œå™¨æ¶ˆè´¹æ¥è¾¾åˆ°ç›®çš„ã€‚</p><figure><img src="'+on+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¯¹äºã€Œå»ä¸­å¿ƒåŒ–ã€æµæ´¾æ¥è¯´å­˜å‚¨ç›¸å…³çš„ä¿¡æ¯å¾ˆå¯èƒ½æ˜¯åœ¨<strong>æ³¨å†Œä¸­å¿ƒ</strong>ï¼ˆZookeeperï¼‰ï¼Œè€Œæˆ‘ä»¬å¼•å…¥çš„<code>client</code>åŒ…å®é™…ä¸Šå°±æ˜¯<strong>æ‰§è¡Œå™¨+è°ƒåº¦å™¨</strong>ç›¸å…³çš„ä»£ç ã€‚</p><p>ä¾èµ–æ³¨å†Œä¸­å¿ƒæ¥å®Œæˆ<strong>ä»»åŠ¡çš„åˆ†é…</strong>ï¼Œã€Œä¸­å¿ƒåŒ–ã€æµæ´¾åœ¨è°ƒåº¦çš„æ—¶å€™æ˜¯éœ€è¦ä¿è¯ä¸€ä¸ªä»»åŠ¡åªè¢«ä¸€å°æœºå™¨æ¶ˆè´¹ï¼Œè¿™å°±éœ€è¦åœ¨ä»£ç é‡Œå†™åˆ†å¸ƒå¼é”ç›¸å…³é€»è¾‘è¿›è¡Œä¿è¯ï¼Œè€Œã€Œå»ä¸­å¿ƒåŒ–ã€ä¾èµ–æ³¨å†Œä¸­å¿ƒå°±å…å»äº†è¿™ä¸ªç¯èŠ‚ã€‚</p><figure><img src="'+cn+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œè°ƒåº¦å™¨æ˜¯æ€ä¹ˆæ‰¾åˆ°å³å°†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡çš„å‘¢ï¼Ÿç°åœ¨ä¸€èˆ¬è¾ƒæ–°çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶éƒ½ç”¨äº†ã€Œ<strong>æ—¶é—´è½®</strong>ã€ã€‚</p><p><strong>1</strong>ã€å¦‚æœæˆ‘ä»¬æ—¥å¸¸è¦æ‰¾åˆ°å‡†å¤‡è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯èƒ½ä¼šæŠŠè¿™äº›ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ª<code>List</code>é‡Œç„¶åè¿›è¡Œåˆ¤æ–­ï¼Œé‚£æ­¤æ—¶æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)</p><p><strong>2</strong>ã€ç¨å¾®æ”¹è¿›ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æŠŠè¿™äº›ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ªæœ€å°å †é‡Œï¼ˆå¯¹æ—¶é—´è¿›è¡Œæ’åºï¼‰ï¼Œé‚£æ­¤æ—¶çš„å¢åˆ æ”¹æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼Œè€ŒæŸ¥è¯¢æ˜¯O(1)</p><p><strong>3</strong>ã€å†æ”¹è¿›ä¸‹ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ª<strong>ç¯å½¢æ•°ç»„</strong>é‡Œï¼Œé‚£è¿™æ—¶å€™çš„å¢åˆ æ”¹æŸ¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚ä½†æ­¤æ—¶çš„ç¯å½¢æ•°ç»„å¤§å°å†³å®šç€æˆ‘ä»¬èƒ½å­˜æ”¾ä»»åŠ¡çš„å¤§å°ï¼Œè¶…å‡ºç¯å½¢æ•°ç»„çš„ä»»åŠ¡å°±éœ€è¦ç”¨å¦å¤–çš„æ•°ç»„ç»“æ„å­˜æ”¾ã€‚</p><p><strong>4</strong>ã€æœ€åå†æ”¹è¿›ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰<strong>å¤šå±‚</strong>ç¯å½¢æ•°ç»„ï¼Œä¸åŒå±‚æ¬¡çš„ç¯å½¢æ•°ç»„çš„<strong>ç²¾åº¦</strong>æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½¿ç”¨å¤šå±‚ç¯å½¢æ•°ç»„èƒ½å¤§å¤§æé«˜æˆ‘ä»¬çš„ç²¾åº¦ã€‚</p><figure><img src="'+ln+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶é€‰å‹" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶é€‰å‹" aria-hidden="true">#</a> åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶é€‰å‹</h4><p>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶ç°åœ¨å¯é€‰æ‹©çš„è¿˜æ˜¯æŒºå¤šçš„ï¼Œæ¯”è¾ƒå‡ºåçš„æœ‰ï¼š<code>XXL-JOB</code>/<code>Elastic-Job</code>/<code>LTS</code>/<code>SchedulerX</code>/<code>Saturn</code>/<code>PowerJob</code>ç­‰ç­‰ç­‰ã€‚æœ‰æ¡ä»¶çš„å…¬å¸å¯èƒ½ä¼šåŸºäº<code>Quartz</code>è¿›è¡Œæ‹“å±•ï¼Œè‡ªç ”ä¸€å¥—ç¬¦åˆè‡ªå·±çš„å…¬å¸å†…çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶ã€‚</p><p>æˆ‘å¹¶ä¸æ˜¯åšè¿™å—å‡ºèº«çš„ï¼Œå¯¹äºæˆ‘è€Œè¨€ï¼Œæˆ‘çš„<code>austin</code>é¡¹ç›®æŠ€æœ¯é€‰å‹ä¸»è¦ä¼šå…³æ³¨ä¸¤å—ï¼ˆå…¶å®è·Ÿé€‰æ‹©apolloä½œä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒçš„ç†ç”±æ˜¯ä¸€æ ·çš„ï¼‰ï¼š<strong>æˆç†Ÿã€ç¨³å®šã€ç¤¾åŒºæ˜¯å¦æ´»è·ƒ</strong>ã€‚</p><p>è¿™ä¸€æ¬¡æˆ‘é€‰æ‹©äº†<code>xxl-job</code>ä½œä¸º<code>austin</code>çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ã€‚<code>xxl-job</code>å·²ç»æœ‰å¾ˆå¤šå…¬å¸éƒ½å·²ç»æ¥å…¥äº†ï¼ˆè¯´æ˜ä»–çš„<strong>å¼€ç®±å³ç”¨</strong>è¿˜æ˜¯å¾ˆåˆ°ä½çš„ï¼‰ã€‚ä¸è¿‡æœ€æ–°çš„ä¸€ä¸ªç‰ˆæœ¬åœ¨<code>2021-02</code>ï¼Œè¿‘ä¸€å¹´æ²¡æœ‰æ¯”è¾ƒå¤§çš„æ›´æ–°äº†ã€‚</p>',33),dp={href:"https://www.xuxueli.com/xxl-job/#%E4%BA%8C%E3%80%81%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8",target:"_blank",rel:"noopener noreferrer"},kp=t('<h2 id="â™»ï¸è™šæ‹Ÿæœº" tabindex="-1"><a class="header-anchor" href="#â™»ï¸è™šæ‹Ÿæœº" aria-hidden="true">#</a> â™»ï¸è™šæ‹Ÿæœº</h2><h3 id="å¯¹è±¡åˆ›å»ºè¿‡ç¨‹-2022è”šæ¥æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡åˆ›å»ºè¿‡ç¨‹-2022è”šæ¥æå‰æ‰¹" aria-hidden="true">#</a> å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼ˆ2022è”šæ¥æå‰æ‰¹ï¼‰</h3><figure><img src="'+rn+'" alt="image-20220717152305383" tabindex="0" loading="lazy"><figcaption>image-20220717152305383</figcaption></figure><h4 id="ç±»åŠ è½½æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½æ£€æŸ¥" aria-hidden="true">#</a> ç±»åŠ è½½æ£€æŸ¥</h4><p>å¯¹è±¡åˆ›å»ºè¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œæ‰€è°“ç±»åŠ è½½æ£€æŸ¥ï¼Œå°±æ˜¯æ£€æµ‹æˆ‘ä»¬æ¥ä¸‹æ¥è¦ new å‡ºæ¥çš„è¿™ä¸ªå¯¹è±¡æ‰€å±çš„ç±»æ˜¯å¦å·²ç»è¢« JVM æˆåŠŸåŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡äº†ï¼ˆå…·ä½“çš„ç±»åŠ è½½è¿‡ç¨‹ä¼šåœ¨åç»­æ–‡ç« è¯¦ç»†è§£é‡Š~ï¼‰</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ Java è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å­—èŠ‚ç  new æŒ‡ä»¤æ—¶ï¼š</p><p>1ï¼‰é¦–å…ˆæ£€æŸ¥æ ¹æ® class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰èƒ½å¦æ‰¾åˆ°è¿™ä¸ªç±»å¯¹åº”çš„ç¬¦å·å¼•ç”¨</p><blockquote><p>æ­¤å¤„å¯ä»¥å›é¡¾ä¸€æ³¢<strong>å¸¸é‡æ± è¡¨ (Constant Pool Table)</strong> çš„æ¦‚å¿µï¼š</p><p>ç”¨äºå­˜æ”¾<strong>ç¼–è¯‘æœŸ</strong>ç”Ÿæˆçš„å„ç§å­—é¢é‡ï¼ˆå­—é¢é‡ç›¸å½“äº Java è¯­è¨€å±‚é¢å¸¸é‡çš„æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå£°æ˜ä¸º final çš„å¸¸é‡å€¼ç­‰ï¼‰ä¸ç¬¦å·å¼•ç”¨ã€‚æœ‰ä¸€äº›æ–‡ç« ä¼šæŠŠ class å¸¸é‡æ± è¡¨ç§°ä¸º<strong>é™æ€å¸¸é‡æ± </strong>ã€‚</p><p>éƒ½æ˜¯å¸¸é‡æ± ï¼Œå¸¸é‡æ± è¡¨å’Œæ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶å¸¸é‡æ± æœ‰å•¥å…³ç³»å—ï¼Ÿè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ</p><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± å¯ä»¥åœ¨è¿è¡ŒæœŸé—´å°† class å¸¸é‡æ± è¡¨ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</strong>ã€‚ç®€å•æ¥è¯´ï¼Œclass å¸¸é‡æ± è¡¨å°±ç›¸å½“äºä¸€å †ç´¢å¼•ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± æ ¹æ®è¿™äº›ç´¢å¼•æ¥æŸ¥æ‰¾å¯¹åº”æ–¹æ³•æˆ–å­—æ®µæ‰€å±çš„ç±»å‹ä¿¡æ¯å’Œåç§°åŠæè¿°ç¬¦ä¿¡æ¯</p></blockquote><p>2ï¼‰ç„¶åå»æ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æŸ¥æ‰¾è¯¥ç¬¦å·å¼•ç”¨æ‰€æŒ‡å‘çš„ç±»æ˜¯å¦å·²è¢« JVM åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡</p><ul><li>å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹</li><li>å¦‚æœæœ‰ï¼Œé‚£ä¹ˆè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜</li></ul><h4 id="åˆ†é…å†…å­˜" tabindex="-1"><a class="header-anchor" href="#åˆ†é…å†…å­˜" aria-hidden="true">#</a> åˆ†é…å†…å­˜</h4><p>ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œè¿™ä¸ªå¯¹è±¡å¾…ä¼šå„¿è¦æ˜¯è¢«åˆ›å»ºå‡ºæ¥å¾—æœ‰åœ°æ–¹æ”¾ä»–å¯¹å§ï¼Ÿ</p><p>æ‰€ä»¥æ¥ä¸‹æ¥ JVM ä¼šä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ã€‚</p><p>è‡³äº JVM æ€ä¹ˆçŸ¥é“è¿™ä¸ªç©ºé—´å¾—åˆ†é…å¤šå¤§å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œå¯¹è±¡æ‰€éœ€å†…å­˜çš„å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåå°±å·²ç»å¯ä»¥å®Œå…¨ç¡®å®šäº†ã€‚</p><p>HotSpotè™šæ‹Ÿæœºæ˜¯ä¸€ç§Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ï¼Œå®ƒæ˜¯Oracle JDKä¸­é»˜è®¤çš„JVMã€‚ åœ¨ Hotspot è™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´</strong>ã€<strong>å®ä¾‹æ•°æ®</strong>å’Œ<strong>å¯¹é½å¡«å……</strong>ã€‚</p><p>1ï¼‰Hotspot è™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ˆå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨ 32 ä½å’Œ 64 ä½çš„è™šæ‹Ÿæœºï¼ˆæœªå¼€å¯å‹ç¼©æŒ‡é’ˆï¼‰ä¸­åˆ†åˆ«ä¸º 32 ä¸ªæ¯”ç‰¹å’Œ 64 ä¸ªæ¯”ç‰¹ï¼Œå®˜æ–¹ç§°å®ƒä¸º â€œMark Wordâ€ã€‚å­¦è¿‡ synchronized çš„å°ä¼™ä¼´å¯¹è¿™ä¸ªä¸€å®šä¸é™Œç”Ÿ~ï¼‰</li><li>å¦ä¸€éƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å‹å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹</li></ul><p>2ï¼‰<strong>å®ä¾‹æ•°æ®éƒ¨åˆ†å­˜å‚¨çš„æ˜¯è¿™ä¸ªå¯¹è±¡çœŸæ­£çš„æœ‰æ•ˆä¿¡æ¯</strong>ï¼Œå³æˆ‘ä»¬åœ¨ç¨‹åºä»£ç é‡Œé¢æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ï¼Œæ— è®ºæ˜¯ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰çš„å­—æ®µéƒ½å¿…é¡»è®°å½•èµ·æ¥ã€‚</p><p>3ï¼‰<strong>å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œä»…ä»…èµ·å ä½ä½œç”¨</strong>ã€‚ å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯ 8 å­—èŠ‚çš„å€æ•°ï¼ˆ1 å€æˆ– 2 å€ï¼‰ï¼Œå› æ­¤ï¼Œå½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</p><h5 id="å¯¹è±¡åœ¨å †ä¸Šçš„ä¸¤ç§åˆ†é…æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡åœ¨å †ä¸Šçš„ä¸¤ç§åˆ†é…æ–¹å¼" aria-hidden="true">#</a> å¯¹è±¡åœ¨å †ä¸Šçš„ä¸¤ç§åˆ†é…æ–¹å¼</h5><p><strong>ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´çš„ä»»åŠ¡é€šä¿—æ¥è¯´æŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜å—ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ç»™è¿™ä¸ªå¯¹è±¡ç”¨</strong>ã€‚</p><p>æ ¹æ®å †ä¸­çš„å†…å­˜æ˜¯å¦è§„æ•´ï¼Œæœ‰ä¸¤ç§åˆ’åˆ†æ–¹å¼ï¼Œæˆ–è€…è¯´å¯¹è±¡åœ¨å †ä¸Šçš„åˆ†é…æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ï¼‰<strong>å‡è®¾ Java å †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„</strong>ï¼Œæ‰€æœ‰è¢«ä½¿ç”¨è¿‡çš„å†…å­˜éƒ½è¢«æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜è¢«æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠè¿™ä¸ªæŒ‡é’ˆ å‘ ç©ºé—²ç©ºé—´æ–¹å‘ æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º <strong>æŒ‡é’ˆç¢°æ’</strong>ï¼ˆBump The Pointerï¼‰</p><figure><img src="'+un+`" alt="image-20220717152417214" tabindex="0" loading="lazy"><figcaption>image-20220717152417214</figcaption></figure><p>2ï¼‰<strong>å¦‚æœ Java å †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„</strong>ï¼Œå·²è¢«ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™åœ¨ä¸€èµ·ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´åˆ’åˆ†ç»™è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼ç§°ä¸º <strong>ç©ºé—²åˆ—è¡¨</strong>ï¼ˆFree Listï¼‰ã€‚</p><blockquote><p>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œé‚£åˆæœ‰åŒå­¦ä¼šé—®äº†ï¼Œå †æ˜¯å¦è§„æ•´åˆç”±è°æ¥å†³å®šå‘¢ï¼Ÿ</p><p>Java å †æ˜¯å¦è§„æ•´ç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰ç©ºé—´å‹ç¼©æ•´ç†ï¼ˆCompactï¼‰çš„èƒ½åŠ›å†³å®šçš„ï¼ˆæˆ–è€…è¯´ç”±åƒåœ¾æ”¶é›†å™¨é‡‡ç”¨çš„åƒåœ¾æ”¶é›†ç®—æ³•æ¥å†³å®šçš„ï¼Œå…·ä½“åƒåœ¾æ”¶é›†ç®—æ³•è§åç»­æ–‡ç« ï¼‰ï¼š</p><ul><li>å› æ­¤ï¼Œå½“ä½¿ç”¨ Serialã€ParNew ç­‰å¸¦å‹ç¼©æ•´ç†è¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çš„åˆ†é…ç®—æ³•æ˜¯æŒ‡é’ˆç¢°æ’ï¼Œæ—¢ç®€å•åˆé«˜æ•ˆ</li><li>è€Œå½“ä½¿ç”¨ CMS è¿™ç§åŸºäºæ¸…é™¤ï¼ˆSweepï¼‰ç®—æ³•çš„æ”¶é›†å™¨æ—¶ï¼Œç†è®ºä¸Šå°±åªèƒ½é‡‡ç”¨è¾ƒä¸ºå¤æ‚çš„ç©ºé—²åˆ—è¡¨æ¥åˆ†é…å†…å­˜</li></ul></blockquote><h5 id="å¯¹è±¡åˆ›å»ºæ—¶å€™çš„å¹¶å‘å®‰å…¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡åˆ›å»ºæ—¶å€™çš„å¹¶å‘å®‰å…¨é—®é¢˜" aria-hidden="true">#</a> å¯¹è±¡åˆ›å»ºæ—¶å€™çš„å¹¶å‘å®‰å…¨é—®é¢˜</h5><p>å¦å¤–ï¼Œåœ¨ä¸ºå¯¹è±¡åˆ›å»ºå†…å­˜çš„æ—¶å€™ï¼Œè¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¹¶å‘å®‰å…¨é—®é¢˜</strong>ã€‚</p><p>å¯¹è±¡åˆ›å»ºåœ¨è™šæ‹Ÿæœºä¸­æ˜¯éå¸¸é¢‘ç¹çš„è¡Œä¸ºï¼Œä»¥ä¸Šé¢ä»‹ç»çš„æŒ‡é’ˆç¢°æ’æ³•ä¸ºä¾‹ï¼Œå³ä½¿åªä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½å‡ºç°æŸä¸ªçº¿ç¨‹æ­£åœ¨ç»™å¯¹è±¡ A åˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¯¹è±¡ B åˆåŒæ—¶ä½¿ç”¨äº†åŸæ¥çš„æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æƒ…å†µã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§å¯é€‰æ–¹æ¡ˆï¼š</p><ul><li>æ–¹æ¡ˆ 1ï¼š<strong>CAS + å¤±è´¥é‡è¯•</strong>ï¼šCAS å¤§ä¼™åº”è¯¥éƒ½ç†Ÿæ‚‰ï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œä¹è§‚é”æ–¹æ¡ˆï¼Œå¦‚æœå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢</li><li>æ–¹æ¡ˆ 2ï¼š<strong>æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²</strong>ï¼ˆThread Local Allocation Bufferï¼Œ<code>TLAB</code>ï¼‰ï¼šæ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰çš„è¿™ä¸€å°å—å†…å­˜å°±ç§°ä¸º TLABã€‚å“ªä¸ªçº¿ç¨‹è¦åˆ†é…å†…å­˜äº†ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹çš„ TLAB ä¸­è¿›è¡Œåˆ†é…ï¼Œè¿™æ ·å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹çš„ TLAB ç”¨å®Œäº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±éœ€è¦ä¸ºå®ƒåˆ†é…æ–°çš„ TLABï¼Œè¿™æ—¶æ‰éœ€è¦è¿›è¡ŒåŒæ­¥é”å®šã€‚å¯ä»¥é€šè¿‡ <code>-XXï¼š+/-UseTLAB</code> å‚æ•°æ¥è®¾å®šæ˜¯å¦ä½¿ç”¨ TLABã€‚</li></ul><h4 id="åˆå§‹åŒ–é›¶å€¼" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–é›¶å€¼" aria-hidden="true">#</a> åˆå§‹åŒ–é›¶å€¼</h4><p>å†…å­˜åˆ†é…å®Œæˆä¹‹åï¼Œ<strong>JVM ä¼šå°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼</strong>ï¼Œæ¯”å¦‚ boolean å­—æ®µéƒ½åˆå§‹åŒ–ä¸º false å•Šï¼Œint å­—æ®µéƒ½åˆå§‹åŒ–ä¸º 0 å•Šä¹‹ç±»çš„</p><p>è¿™æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œä½¿ç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><blockquote><p>å¦‚æœä½¿ç”¨äº† TLAB çš„è¯ï¼Œåˆå§‹åŒ–é›¶å€¼è¿™é¡¹å·¥ä½œå¯ä»¥æå‰è‡³ TLAB åˆ†é…æ—¶å°±é¡ºä¾¿è¿›è¡Œäº†</p></blockquote><h4 id="è®¾ç½®å¯¹è±¡å¤´" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®å¯¹è±¡å¤´" aria-hidden="true">#</a> è®¾ç½®å¯¹è±¡å¤´</h4><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……</p><p>å¯¹é½å¡«å……å¹¶ä¸æ˜¯ä»€ä¹ˆæœ‰æ„ä¹‰çš„æ•°æ®ï¼Œå®ä¾‹æ•°æ®æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥æ“ä½œä¸­è¿›è¡Œäº†åˆå§‹åŒ–é›¶å€¼ï¼Œé‚£ä¹ˆå¯¹äºå‰©ä¸‹çš„å¯¹è±¡å¤´ä¸­çš„ä¿¡æ¯æ¥è¯´ï¼Œè‡ªç„¶ä¸å¿…å¤šè¯´ï¼Œä¹Ÿæ˜¯è¦è¿›è¡Œä¸€äº›èµ‹å€¼æ“ä½œçš„ï¼šä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚æ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</p><h4 id="æ‰§è¡Œ-init-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œ-init-æ–¹æ³•" aria-hidden="true">#</a> æ‰§è¡Œ init æ–¹æ³•</h4><p>ä¸Šé¢å››ä¸ªæ­¥éª¤éƒ½èµ°å®Œä¹‹åï¼Œä» JVM çš„è§†è§’æ¥çœ‹ï¼Œå…¶å®ä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»æˆåŠŸè¯ç”Ÿäº†ã€‚</p><p>ä½†æ˜¯ä»æˆ‘ä»¬ç¨‹åºå‘˜çš„è§†è§’æ¥çœ‹ï¼Œè¿™ä¸ªå¯¹è±¡ç¡®å®æ˜¯åˆ›å»ºå‡ºæ¥äº†ï¼Œä½†æ˜¯è¿˜æ²¡æŒ‰ç…§æˆ‘ä»¬å®šä¹‰çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œèµ‹å€¼å‘¢ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜æ˜¯é»˜è®¤çš„é›¶å€¼å•Šã€‚</p><p>æ„é€ å‡½æ•°å³ Class æ–‡ä»¶ä¸­çš„ <code>&lt;init&gt;()</code> æ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œnew æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ <code>&lt;init&gt;()</code> æ–¹æ³•ï¼ŒæŒ‰ç…§æ„é€ å‡½æ•°çš„æ„å›¾å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨åœ°è¢«æ„é€ å‡ºæ¥äº†ï¼Œçš†å¤§æ¬¢å–œã€‚</p><h3 id="åƒåœ¾çš„åˆ¤æ–­æ–¹æ³•-å¼•ç”¨è®¡æ•°æ³•ä¸ºä»€ä¹ˆç”¨çš„æ²¡æœ‰gcrootçš„å¤š-ç¼ºç‚¹æ˜¯ä»€ä¹ˆ-ä¸ºä»€ä¹ˆ-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾çš„åˆ¤æ–­æ–¹æ³•-å¼•ç”¨è®¡æ•°æ³•ä¸ºä»€ä¹ˆç”¨çš„æ²¡æœ‰gcrootçš„å¤š-ç¼ºç‚¹æ˜¯ä»€ä¹ˆ-ä¸ºä»€ä¹ˆ-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> åƒåœ¾çš„åˆ¤æ–­æ–¹æ³•ï¼Œå¼•ç”¨è®¡æ•°æ³•ä¸ºä»€ä¹ˆç”¨çš„æ²¡æœ‰GCRootçš„å¤šï¼Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h3><h4 id="å¼•ç”¨è®¡æ•°æ³•" tabindex="-1"><a class="header-anchor" href="#å¼•ç”¨è®¡æ•°æ³•" aria-hidden="true">#</a> å¼•ç”¨è®¡æ•°æ³•</h4><p>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼š</p><ul><li>æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼›</li><li>å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1ï¼›</li><li>ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</li></ul><p><strong>è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</strong></p><p>æ‰€è°“å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼šé™¤äº†å¯¹è±¡ <code>objA</code> å’Œ <code>objB</code> ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGc</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ReferenceCountingGc</span> objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ReferenceCountingGc</span> objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objA<span class="token punctuation">.</span>instance <span class="token operator">=</span> objB<span class="token punctuation">;</span>
        objB<span class="token punctuation">.</span>instance <span class="token operator">=</span> objA<span class="token punctuation">;</span>
        objA <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        objB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å¯è¾¾æ€§åˆ†æç®—æ³•" aria-hidden="true">#</a> å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º <strong>â€œGC Rootsâ€</strong> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</p><p>ä¸‹å›¾ä¸­çš„ <code>Object 6 ~ Object 10</code> ä¹‹é—´è™½æœ‰å¼•ç”¨å…³ç³»ï¼Œä½†å®ƒä»¬åˆ° GC Roots ä¸å¯è¾¾ï¼Œå› æ­¤ä¸ºéœ€è¦è¢«å›æ”¶çš„å¯¹è±¡ã€‚</p><figure><img src="`+dn+'" alt="image-20220717152747462" tabindex="0" loading="lazy"><figcaption>image-20220717152747462</figcaption></figure><p><strong>å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Roots å‘¢ï¼Ÿ</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆ(Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</li></ul><p><strong>å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œå°±ä»£è¡¨ä¸€å®šä¼šè¢«å›æ”¶å—ï¼Ÿ</strong></p><p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘é˜¶æ®µâ€ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼›å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ <code>finalize</code> æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›– <code>finalize</code> æ–¹æ³•ï¼Œæˆ– <code>finalize</code> æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µè§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œã€‚</p><p>è¢«åˆ¤å®šä¸ºéœ€è¦æ‰§è¡Œçš„å¯¹è±¡å°†ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œé™¤éè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œå¦åˆ™å°±ä¼šè¢«çœŸçš„å›æ”¶ã€‚</p><blockquote><p><code>Object</code> ç±»ä¸­çš„ <code>finalize</code> æ–¹æ³•ä¸€ç›´è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç³Ÿç³•çš„è®¾è®¡ï¼Œæˆä¸ºäº† Java è¯­è¨€çš„è´Ÿæ‹…ï¼Œå½±å“äº† Java è¯­è¨€çš„å®‰å…¨å’Œ GC çš„æ€§èƒ½ã€‚JDK9 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬ä¸­å„ä¸ªç±»ä¸­çš„ <code>finalize</code> æ–¹æ³•ä¼šè¢«é€æ¸å¼ƒç”¨ç§»é™¤ã€‚å¿˜æ‰å®ƒçš„å­˜åœ¨å§ï¼</p></blockquote><h3 id="ä»€ä¹ˆæ—¶å€™ä¼šoom-æœåŠ¡oomæ€ä¹ˆåŠ-å¦‚ä½•æ’æŸ¥-2022-ç¾å›¢" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ—¶å€™ä¼šoom-æœåŠ¡oomæ€ä¹ˆåŠ-å¦‚ä½•æ’æŸ¥-2022-ç¾å›¢" aria-hidden="true">#</a> ä»€ä¹ˆæ—¶å€™ä¼šOOMï¼ŒæœåŠ¡OOMæ€ä¹ˆåŠï¼Œå¦‚ä½•æ’æŸ¥ï¼ˆ2022 ç¾å›¢ï¼‰</h3>',60),mp={href:"https://github.com/StabilityMan/StabilityGuide/blob/master/docs/diagnosis/jvm/exception/%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E6%80%A7%E2%80%94%E2%80%94OutOfMemoryError%E5%B8%B8%E8%A7%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95.md",target:"_blank",rel:"noopener noreferrer"},gp=t('<h3 id="java-static-å˜é‡å­˜åœ¨-jvm-å“ªä¸ªåŒºåŸŸå’Œç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#java-static-å˜é‡å­˜åœ¨-jvm-å“ªä¸ªåŒºåŸŸå’Œç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Java static å˜é‡å­˜åœ¨ JVM å“ªä¸ªåŒºåŸŸå’Œç”Ÿå‘½å‘¨æœŸ</h3><p>Staticï¼š</p><ul><li>åŠ è½½ï¼šjavaè™šæ‹Ÿæœºåœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­ä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜ã€‚</li><li>ç±»å˜é‡ï¼šstaticå˜é‡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªï¼Œå­˜æ”¾åœ¨æ–¹æ³•åŒºï¼Œå±äºç±»å˜é‡ï¼Œè¢«æ‰€æœ‰å®ä¾‹æ‰€å…±äº«</li><li>é”€æ¯ï¼šç±»è¢«å¸è½½æ—¶ï¼Œé™æ€å˜é‡è¢«é”€æ¯ï¼Œå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚staticå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå–å†³äºç±»çš„ç”Ÿå‘½å‘¨æœŸ</li></ul><p>ç±»åˆå§‹åŒ–é¡ºåºï¼š</p><ul><li>é™æ€å˜é‡ã€é™æ€ä»£ç å—åˆå§‹åŒ–</li><li>æ„é€ å‡½æ•°</li><li>è‡ªå®šä¹‰æ„é€ å‡½æ•°</li></ul><p>ç»“è®ºï¼šæƒ³è¦ç”¨staticå­˜ä¸€ä¸ªå˜é‡ï¼Œä½¿å¾—ä¸‹æ¬¡ç¨‹åºè¿è¡Œæ—¶è¿˜èƒ½ä½¿ç”¨ä¸Šæ¬¡çš„å€¼æ˜¯ä¸å¯è¡Œçš„ã€‚å› ä¸ºé™æ€å˜é‡ç”Ÿå‘½å‘¨æœŸè™½ç„¶é•¿ï¼ˆå°±æ˜¯ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œä½†æ˜¯å½“ç¨‹åºæ‰§è¡Œå®Œï¼Œä¹Ÿå°±æ˜¯è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å·²ç»è¢«å›æ”¶ï¼Œæˆ–è€…åŠ è½½ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ï¼Œé‚£ä¹ˆè¯¥ç±»å°±ä¼šä»jvmçš„æ–¹æ³•åŒºå¸è½½ï¼Œå³ç”Ÿå‘½æœŸç»ˆæ­¢ã€‚</p><h3 id="gc-çš„å‡ ç§ç®—æ³•-2022æºç¨‹-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#gc-çš„å‡ ç§ç®—æ³•-2022æºç¨‹-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> GC çš„å‡ ç§ç®—æ³•ï¼ˆ2022æºç¨‹ï¼Œ2022ç•ªèŒ„å°è¯´ï¼‰</h3><p>æ ‡è®°-æ¸…é™¤ç®—æ³•</p><hr><p>è¯¥ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€é˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚å®ƒæ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œåç»­çš„ç®—æ³•éƒ½æ˜¯å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›å¾—åˆ°ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç®—æ³•ä¼šå¸¦æ¥ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š</p><ol><li><strong>æ•ˆç‡é—®é¢˜</strong></li><li><strong>ç©ºé—´é—®é¢˜ï¼ˆæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„ç¢ç‰‡ï¼‰</strong></li></ol><figure><img src="'+kn+'" alt="image-20220413200722639" tabindex="0" loading="lazy"><figcaption>image-20220413200722639</figcaption></figure><p>æ ‡è®°-å¤åˆ¶ç®—æ³•</p><hr><p>ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œâ€œæ ‡è®°-å¤åˆ¶â€æ”¶é›†ç®—æ³•å‡ºç°äº†ã€‚å®ƒå¯ä»¥å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ä½¿ç”¨å®Œåï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå†æŠŠä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·å°±ä½¿æ¯æ¬¡çš„å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„ä¸€åŠè¿›è¡Œå›æ”¶ã€‚</p><figure><img src="'+mn+'" alt="image-20220413200736328" tabindex="0" loading="lazy"><figcaption>image-20220413200736328</figcaption></figure><p>æ ‡è®°-æ•´ç†ç®—æ³•</p><hr><p>æ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹æå‡ºçš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡å›æ”¶ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><figure><img src="'+gn+'" alt="image-20220413200753503" tabindex="0" loading="lazy"><figcaption>image-20220413200753503</figcaption></figure><p>åˆ†ä»£æ”¶é›†ç®—æ³•</p><hr><p>å½“å‰è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬å°† java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p><p>æ¯”å¦‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©â€æ ‡è®°-å¤åˆ¶â€œç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†ã€‚è€Œè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</p><p>å»¶ä¼¸é¢è¯•é—®é¢˜ï¼š HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ</p><p>æ ¹æ®ä¸Šé¢çš„å¯¹åˆ†ä»£æ”¶é›†ç®—æ³•çš„ä»‹ç»å›ç­”ã€‚</p><blockquote><p>è°ˆè°ˆä½ äº†è§£çš„å‡ ç§åƒåœ¾å›æ”¶å™¨ï¼ˆ2022-04-11 æºç¨‹ï¼‰</p></blockquote><p>Serial æ”¶é›†å™¨</p><hr><p>Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚å®ƒçš„ <strong>â€œå•çº¿ç¨‹â€</strong> çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ <strong>&quot;Stop The World&quot;</strong> ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚</p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><figure><img src="'+vn+'" alt="image-20220413200828028" tabindex="0" loading="lazy"><figcaption>image-20220413200828028</figcaption></figure><p>è™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬å½“ç„¶çŸ¥é“ Stop The World å¸¦æ¥çš„ä¸è‰¯ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åœ¨åç»­çš„åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´åœ¨ä¸æ–­ç¼©çŸ­ï¼ˆä»ç„¶è¿˜æœ‰åœé¡¿ï¼Œå¯»æ‰¾æœ€ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ã€‚</p><p>ä½†æ˜¯ Serial æ”¶é›†å™¨æœ‰æ²¡æœ‰ä¼˜äºå…¶ä»–åƒåœ¾æ”¶é›†å™¨çš„åœ°æ–¹å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œå®ƒ<strong>ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰</strong>ã€‚Serial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè‡ªç„¶å¯ä»¥è·å¾—å¾ˆé«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚Serial æ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p>ParNew æ”¶é›†å™¨</p><hr><p><strong>ParNew æ”¶é›†å™¨å…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚</strong></p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><figure><img src="'+bn+`" alt="image-20220413200847394" tabindex="0" loading="lazy"><figcaption>image-20220413200847394</figcaption></figure><p>å®ƒæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°ï¼‰é…åˆå·¥ä½œã€‚</p><p><strong>å¹¶è¡Œå’Œå¹¶å‘æ¦‚å¿µè¡¥å……ï¼š</strong></p><ul><li><strong>å¹¶è¡Œï¼ˆParallelï¼‰</strong> ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚</li><li><strong>å¹¶å‘ï¼ˆConcurrentï¼‰</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ª CPU ä¸Šã€‚</li></ul><p>Parallel Scavenge æ”¶é›†å™¨</p><hr><p>Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä½¿ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒçœ‹ä¸Šå»å‡ ä¹å’Œ ParNew éƒ½ä¸€æ ·ã€‚ <strong>é‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelGC</span>

    ä½¿ç”¨ <span class="token class-name">Parallel</span> æ”¶é›†å™¨<span class="token operator">+</span> è€å¹´ä»£ä¸²è¡Œ

<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseParallelOldGC</span>

    ä½¿ç”¨ <span class="token class-name">Parallel</span> æ”¶é›†å™¨<span class="token operator">+</span> è€å¹´ä»£å¹¶è¡Œ

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Parallel Scavenge æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆé«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼‰ã€‚CMS ç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯ CPU ä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚</strong> Parallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„æ—¶å€™ï¼Œä½¿ç”¨ Parallel Scavenge æ”¶é›†å™¨é…åˆè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ŒæŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><figure><img src="`+hn+`" alt="image-20220413200923423" tabindex="0" loading="lazy"><figcaption>image-20220413200923423</figcaption></figure><p><strong>è¿™æ˜¯ JDK1.8 é»˜è®¤æ”¶é›†å™¨</strong></p><p>ä½¿ç”¨ java -XX:+PrintCommandLineFlags -version å‘½ä»¤æŸ¥çœ‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-XX:InitialHeapSize=262921408 -XX:MaxHeapSize=4206742528 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC
java version &quot;1.8.0_211&quot;
Java(TM) SE Runtime Environment (build 1.8.0_211-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JDK1.8 é»˜è®¤ä½¿ç”¨çš„æ˜¯ Parallel Scavenge + Parallel Oldï¼Œå¦‚æœæŒ‡å®šäº†-XX:+UseParallelGC å‚æ•°ï¼Œåˆ™é»˜è®¤æŒ‡å®šäº†-XX:+UseParallelOldGCï¼Œå¯ä»¥ä½¿ç”¨-XX:-UseParallelOldGC æ¥ç¦ç”¨è¯¥åŠŸèƒ½</p><p>Serial Old æ”¶é›†å™¨</p><hr><p><strong>Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚</p><p>Parallel Old æ”¶é›†å™¨</p><hr><p><strong>Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ã€‚ä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge æ”¶é›†å™¨å’Œ Parallel Old æ”¶é›†å™¨ã€‚</p><p>CMS æ”¶é›†å™¨</p><hr><p><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚å®ƒéå¸¸ç¬¦åˆåœ¨æ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨ä¸Šä½¿ç”¨ã€‚</strong></p><p><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚</strong></p><p>ä»åå­—ä¸­çš„<strong>Mark Sweep</strong>è¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMS æ”¶é›†å™¨æ˜¯ä¸€ç§ <strong>â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•</strong>å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸æ¯”äºå‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong> æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong> åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong> é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong> å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li></ul><figure><img src="`+fn+'" alt="image-20220413201027769" tabindex="0" loading="lazy"><figcaption>image-20220413201027769</figcaption></figure><p>ä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦ä¼˜ç‚¹ï¼š<strong>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</strong>ã€‚ä½†æ˜¯å®ƒæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ul><li><strong>å¯¹ CPU èµ„æºæ•æ„Ÿï¼›</strong></li><li><strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›</strong></li><li><strong>å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚</strong></li></ul><p>G1 æ”¶é›†å™¨</p><hr><p><strong>G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾.</strong></p><p>è¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong>ï¼šG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li><strong>åˆ†ä»£æ”¶é›†</strong>ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</li><li><strong>ç©ºé—´æ•´åˆ</strong>ï¼šä¸ CMS çš„â€œæ ‡è®°-æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚</li><li><strong>å¯é¢„æµ‹çš„åœé¡¿</strong>ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚</li></ul><p>G1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°</strong></li><li><strong>å¹¶å‘æ ‡è®°</strong></li><li><strong>æœ€ç»ˆæ ‡è®°</strong></li><li><strong>ç­›é€‰å›æ”¶</strong></li></ul><p><strong>G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)</strong> ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰</p><p>ZGC æ”¶é›†å™¨</p><hr><p>ä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚</p><p>åœ¨ ZGC ä¸­å‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼</p>',80),vp={href:"https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html",target:"_blank",rel:"noopener noreferrer"},bp=t(`<h3 id="æƒ³è¦åœ¨æŒ‡å®šæ—¶é—´ç»“æŸåƒåœ¾å›æ”¶-é€‰ç”¨å“ªç§åƒåœ¾å›æ”¶å™¨-2022-04-11-æºç¨‹" tabindex="-1"><a class="header-anchor" href="#æƒ³è¦åœ¨æŒ‡å®šæ—¶é—´ç»“æŸåƒåœ¾å›æ”¶-é€‰ç”¨å“ªç§åƒåœ¾å›æ”¶å™¨-2022-04-11-æºç¨‹" aria-hidden="true">#</a> æƒ³è¦åœ¨æŒ‡å®šæ—¶é—´ç»“æŸåƒåœ¾å›æ”¶ï¼Œé€‰ç”¨å“ªç§åƒåœ¾å›æ”¶å™¨ï¼ˆ2022-04-11 æºç¨‹ï¼‰</h3><p>G1</p><h3 id="ä»€ä¹ˆæ˜¯gcroot" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯gcroot" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯GCROOT?</h3><p><strong>åœ¨ Java è¯­è¨€ä¸­ï¼ŒGC Roots åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»å…ƒç´ ï¼š</strong></p><ul><li><p>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚ï¼šå„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li></ul></li><li><p>æœ¬åœ°æ–¹æ³•æ ˆå†… JNIï¼ˆé€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</p></li><li><p>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚ï¼šJava ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li></ul></li><li><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Tableï¼‰é‡Œçš„å¼•ç”¨</li></ul></li><li><p>æ‰€æœ‰è¢«åŒæ­¥é” synchronized æŒæœ‰çš„å¯¹è±¡</p></li><li><p>Java è™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚</p></li><li><p>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚ï¼š<code>NullPointerException</code>ã€<code>OutOfMemoryError</code>ï¼‰ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</p></li><li><p>åæ˜  java è™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„ JMXBeanã€JVMTI ä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</p></li><li><p>é™¤äº†è¿™äº›å›ºå®šçš„ GC Roots é›†åˆä»¥å¤–ï¼Œæ ¹æ®ç”¨æˆ·æ‰€é€‰ç”¨çš„åƒåœ¾æ”¶é›†å™¨ä»¥åŠå½“å‰å›æ”¶çš„å†…å­˜åŒºåŸŸä¸åŒï¼Œ</p><p>è¿˜å¯ä»¥æœ‰å…¶ä»–å¯¹è±¡ â€œä¸´æ—¶æ€§â€ åœ°åŠ å…¥ï¼Œå…±åŒæ„æˆå®Œæ•´ GC Roots é›†åˆã€‚æ¯”å¦‚ï¼šåˆ†ä»£æ”¶é›†å’Œå±€éƒ¨å›æ”¶</p><p>ï¼ˆPartialGCï¼‰ã€‚</p><ul><li>å¦‚æœåªé’ˆå¯¹ Java å †ä¸­çš„æŸä¸€å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆæ¯”å¦‚ï¼šå…¸å‹çš„åªé’ˆå¯¹æ–°ç”Ÿä»£ï¼‰ï¼Œå¿…é¡»è€ƒè™‘åˆ°å†…å­˜åŒºåŸŸæ˜¯è™šæ‹Ÿæœºè‡ªå·±çš„å®ç°ç»†èŠ‚ï¼Œæ›´ä¸æ˜¯å­¤ç«‹å°é—­çš„ï¼Œè¿™ä¸ªåŒºåŸŸçš„å¯¹è±¡å®Œå…¨æœ‰å¯èƒ½è¢«å…¶ä»–åŒºåŸŸçš„å¯¹è±¡æ‰€å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€å¹¶å°†å…³è”çš„åŒºåŸŸå¯¹è±¡ä¹ŸåŠ å…¥ GCRoots é›†åˆä¸­å»è€ƒè™‘ï¼Œæ‰èƒ½ä¿è¯å¯è¾¾æ€§åˆ†æçš„å‡†ç¡®æ€§ã€‚</li><li>å…¸å‹çš„åªé’ˆå¯¹æ–°ç”Ÿä»£ï¼šå› ä¸ºæ–°ç”Ÿä»£é™¤å¤–ï¼Œè¿˜æœ‰å…³è”çš„è€å¹´ä»£ï¼Œæ‰€ä»¥éœ€è¦å°†è€å¹´ä»£ä¹Ÿä¸€å¹¶åŠ å…¥ GC Roots é›†åˆä¸­</li></ul></li><li><p>å°æŠ€å·§</p><ul><li>ç”±äº Root é‡‡ç”¨æ ˆæ–¹å¼å­˜æ”¾å˜é‡å’ŒæŒ‡é’ˆï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒä¿å­˜äº†å †å†…å­˜é‡Œé¢çš„å¯¹è±¡ï¼Œä½†æ˜¯è‡ªå·±åˆä¸å­˜æ”¾åœ¨å †å†…å­˜é‡Œé¢ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ª Rootã€‚</li></ul></li></ul><p>ä¸€ç³»åˆ—çš„ç§°ä¸º <strong>â€œGC Rootsâ€</strong> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</p><p><strong>æ³¨æ„</strong></p><ul><li>å¦‚æœè¦ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œé‚£ä¹ˆåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœ<strong>ä¸€è‡´æ€§</strong> (æŸä¸€åˆ»çš„é™æ­¢çŠ¶æ€) çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ã€‚</li><li>è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´ GC è¿›è¡Œæ—¶å¿…é¡» â€œstop The Worldâ€ çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚ <ul><li>å³ä½¿æ˜¯å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„ CMS æ”¶é›†å™¨ä¸­ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚</li></ul></li></ul><h3 id="å¦‚ä½•ç ´ååŒäº²å§”æ´¾-å­—èŠ‚å®ä¹ " tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç ´ååŒäº²å§”æ´¾-å­—èŠ‚å®ä¹ " aria-hidden="true">#</a> å¦‚ä½•ç ´ååŒäº²å§”æ´¾ï¼Ÿ ï¼ˆå­—èŠ‚å®ä¹ ï¼‰</h3><p>åœ¨Javaä¸­ï¼ŒåŒäº²å§”æ´¾æ˜¯ä¸€ç§ç±»åŠ è½½æœºåˆ¶ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼æ˜¯å½“ä¸€ä¸ªç±»åŠ è½½å™¨éœ€è¦åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒé¦–å…ˆå°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™ç»§ç»­å‘ä¸Šå§”æ´¾ï¼Œç›´åˆ°å§”æ´¾åˆ°Bootstrap ClassLoaderä¸ºæ­¢ã€‚å¦‚æœæ‰€æœ‰çš„çˆ¶ç±»åŠ è½½å™¨éƒ½æ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå†ç”±å½“å‰ç±»åŠ è½½å™¨è‡ªå·±å»åŠ è½½ã€‚</p><p>è¿™ä¸ªæœºåˆ¶çš„ç›®çš„æ˜¯ä¿è¯Javaä¸­çš„ç±»çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ã€‚ç”±äºç±»çš„å”¯ä¸€æ€§æ˜¯ç”±ç±»åŠ è½½å™¨å’Œç±»åä¸€èµ·å†³å®šçš„ï¼Œå¦‚æœå¤šä¸ªç±»åŠ è½½å™¨éƒ½å¯ä»¥åŠ è½½åŒä¸€ä¸ªç±»ï¼Œå°±å¯èƒ½å¯¼è‡´ç±»çš„å”¯ä¸€æ€§è¢«ç ´åï¼Œä»è€Œå¯¼è‡´ç±»çš„åŠŸèƒ½å¼‚å¸¸æˆ–å®‰å…¨é—®é¢˜ã€‚é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šè¢«å…ˆç”±æœ€é¡¶å±‚çš„Bootstrap ClassLoaderåŠ è½½ï¼Œä¿è¯äº†ç±»çš„å”¯ä¸€æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“éœ€è¦åŠ è½½ä¸€ä¸ªåä¸º&quot;java.lang.Object&quot;çš„ç±»æ—¶ï¼Œé¦–å…ˆç”±ç³»ç»Ÿè‡ªå¸¦çš„Bootstrap ClassLoaderåŠ è½½ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç”±Extension ClassLoaderåŠ è½½ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç”±App ClassLoaderåŠ è½½ã€‚å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç”±å½“å‰çº¿ç¨‹çš„ClassLoaderå»åŠ è½½ã€‚</p><p>è¿™ç§æœºåˆ¶ä¹Ÿæœ‰åˆ©äºé¿å…ç±»åº“çš„é‡å¤åŠ è½½ï¼Œå› ä¸ºçˆ¶ç±»åŠ è½½å™¨å·²ç»åŠ è½½è¿‡ç±»åº“ï¼Œå­ç±»åŠ è½½å™¨å°±ä¸ä¼šå†æ¬¡åŠ è½½ï¼Œè¿™æœ‰åŠ©äºå‡å°‘Javaè™šæ‹Ÿæœºå†…å­˜çš„ä½¿ç”¨ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>å¦‚æœä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ClassLoaderç±»ä¸­çš„findClass()æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚è€Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™loadClass()æ–¹æ³•</p><p>å…¸å‹çš„æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹çš„æ¡†æ¶å’Œä¸­é—´ä»¶æœ‰tomcatä¸osgi</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ç ´ååŒäº²å§”æ´¾æ¨¡å‹</span>
  <span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> myPath <span class="token operator">=</span> <span class="token string">&quot;D:/&quot;</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.class&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>myPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>myPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    classBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>classBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> classBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jvmå†…å­˜æ¨¡å‹-jniåœ¨å“ªä¸ªåŒºåŸŸ-ç™¾åº¦" tabindex="-1"><a class="header-anchor" href="#jvmå†…å­˜æ¨¡å‹-jniåœ¨å“ªä¸ªåŒºåŸŸ-ç™¾åº¦" aria-hidden="true">#</a> JVMå†…å­˜æ¨¡å‹ï¼ŸJNIåœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ ï¼ˆç™¾åº¦ï¼‰</h3><p>JVMå†…å­˜æ¨¡å‹æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå®ƒå°†Javaè™šæ‹Ÿæœºçš„å†…å­˜åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŒºåŸŸï¼š</p><ol><li>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç çš„åœ°å€ã€‚</li><li>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ï¼šæ¯ä¸ªJavaçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„Javaè™šæ‹Ÿæœºæ ˆï¼Œç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨çš„æ ˆå¸§ã€‚æ¯ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šåœ¨æ ˆä¸Šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åå°†å…¶å¼¹å‡ºã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ï¼šç”¨äºå­˜å‚¨æœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰çš„æ ˆå¸§ã€‚</li><li>Javaå †ï¼ˆJava Heapï¼‰ï¼šæ˜¯Javaè™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜åŒºåŸŸä¸­æœ€å¤§çš„ä¸€å—ã€‚æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…å†…å­˜ã€‚Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚</li><li>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ï¼šç”¨äºå­˜å‚¨å·²åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰ï¼šæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚æ¯ä¸ªç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒåŒ…æ‹¬è¯¥ç±»æ‰€å¼•ç”¨çš„å…¶ä»–ç±»å’Œæ¥å£çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰ï¼šä¸æ˜¯JVMç®¡ç†çš„åŒºåŸŸï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œç”¨äºå®ç°NIOï¼ˆNew Input/Outputï¼‰åŠŸèƒ½ã€‚</li></ol><p>è¿™äº›å†…å­˜åŒºåŸŸéƒ½å…·æœ‰å„è‡ªçš„ç‰¹ç‚¹å’Œç”¨é€”ï¼ŒJVMå†…å­˜æ¨¡å‹çš„åˆç†ä½¿ç”¨å’Œä¼˜åŒ–å¯ä»¥æœ‰æ•ˆåœ°æé«˜Javaåº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><figure><img src="`+yn+'" alt="image-20220618230509703" tabindex="0" loading="lazy"><figcaption>image-20220618230509703</figcaption></figure><p>JNIåœ¨æœ¬åœ°æ–¹æ³•æ ˆ</p><p>JNIï¼ˆJava Native Interfaceï¼‰æ˜¯Javaè¯­è¨€ä¸æœ¬åœ°ä»£ç äº¤äº’çš„ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå…è®¸Javaç¨‹åºè°ƒç”¨æœ¬åœ°ï¼ˆCã€C++ç­‰ï¼‰ä»£ç ï¼Œä¹Ÿå¯ä»¥ä½¿æœ¬åœ°ä»£ç è°ƒç”¨Javaä»£ç ã€‚</p><p>åœ¨Javaä¸­ï¼Œé€šè¿‡JNIå¯ä»¥è®¿é—®æ“ä½œç³»ç»Ÿçš„æœ¬åœ°APIï¼Œä»¥å®ç°ä¸€äº›Javaæ— æ³•å®Œæˆçš„ä»»åŠ¡ï¼Œä¾‹å¦‚è®¿é—®ç¡¬ä»¶ã€æ‰§è¡Œåº•å±‚ç³»ç»Ÿæ“ä½œç­‰ã€‚åŒæ—¶ï¼Œé€šè¿‡JNIä¹Ÿå¯ä»¥åˆ©ç”¨æœ¬åœ°ä»£ç çš„æ€§èƒ½ä¼˜åŠ¿ï¼ŒåŠ é€ŸJavaåº”ç”¨ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>JNIçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡Java Native Method Interfaceï¼ˆJNMIï¼‰æä¾›äº†ä¸€äº›Javaæœ¬åœ°æ–¹æ³•ï¼Œç”¨äºä¸æœ¬åœ°ä»£ç è¿›è¡Œäº¤äº’ã€‚åœ¨Javaä»£ç ä¸­å£°æ˜æœ¬åœ°æ–¹æ³•æ—¶ï¼Œéœ€è¦ä½¿ç”¨nativeå…³é”®å­—æ ‡è®°ï¼Œè¿™è¡¨æ˜è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒçš„å…·ä½“å®ç°ç”±æœ¬åœ°ä»£ç æä¾›ã€‚åœ¨Javaç¨‹åºè¿è¡Œæ—¶ï¼ŒJVMä¼šåœ¨æœ¬åœ°ä»£ç åº“ä¸­æŸ¥æ‰¾å¯¹åº”çš„æœ¬åœ°æ–¹æ³•ï¼Œå¹¶å°†Javaç¨‹åºä¼ é€’ç»™å®ƒè¿›è¡Œå¤„ç†ã€‚</p><h3 id="jvmçš„è¿è¡Œæ—¶æ•°æ®åŒºæœ‰ä»€ä¹ˆ-å †æ ˆå„æ”¾ä»€ä¹ˆ-è¯´ä¸€ä¸‹æ ˆå¸§-ç™¾åº¦" tabindex="-1"><a class="header-anchor" href="#jvmçš„è¿è¡Œæ—¶æ•°æ®åŒºæœ‰ä»€ä¹ˆ-å †æ ˆå„æ”¾ä»€ä¹ˆ-è¯´ä¸€ä¸‹æ ˆå¸§-ç™¾åº¦" aria-hidden="true">#</a> JVMçš„è¿è¡Œæ—¶æ•°æ®åŒºæœ‰ä»€ä¹ˆï¼Ÿå †æ ˆå„æ”¾ä»€ä¹ˆï¼Œè¯´ä¸€ä¸‹æ ˆå¸§ ï¼ˆç™¾åº¦ï¼‰</h3><p>Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚JDK 1.8 å’Œä¹‹å‰çš„ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼Œä¸‹é¢ä¼šä»‹ç»åˆ°ã€‚</p><p><strong>JDK 1.8 ä¹‹å‰</strong> ï¼š</p><figure><img src="'+wn+'" alt="image-20220618230223383" tabindex="0" loading="lazy"><figcaption>image-20220618230223383</figcaption></figure><p><strong>JDK 1.8</strong> ï¼š</p><figure><img src="'+Cn+'" alt="image-20220618230229851" tabindex="0" loading="lazy"><figcaption>image-20220618230229851</figcaption></figure><p><strong>çº¿ç¨‹ç§æœ‰çš„ï¼š</strong></p><ul><li>ç¨‹åºè®¡æ•°å™¨</li><li>è™šæ‹Ÿæœºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•æ ˆ</li></ul><p><strong>çº¿ç¨‹å…±äº«çš„ï¼š</strong></p><ul><li>å †</li><li>æ–¹æ³•åŒº</li><li>ç›´æ¥å†…å­˜ (éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†)</li></ul><p>Java è™šæ‹Ÿæœºè§„èŒƒå¯¹äºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„è§„å®šæ˜¯ç›¸å½“å®½æ¾çš„ã€‚ä»¥å †ä¸ºä¾‹ï¼šå †å¯ä»¥æ˜¯è¿ç»­ç©ºé—´ï¼Œä¹Ÿå¯ä»¥ä¸è¿ç»­ã€‚å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‰éœ€æ‰©å±• ã€‚è™šæ‹Ÿæœºå®ç°è€…å¯ä»¥ä½¿ç”¨ä»»ä½•åƒåœ¾å›æ”¶ç®—æ³•ç®¡ç†å †ï¼Œç”šè‡³å®Œå…¨ä¸è¿›è¡Œåƒåœ¾æ”¶é›†ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>æ ˆï¼š</p><p>å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š <strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚</strong> åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</p><p>æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚</p><p>æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° <code>StackOverFlowError</code> å’Œ <code>OutOfMemoryError</code> ä¸¤ç§é”™è¯¯ã€‚</p><p>Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚<strong>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</strong></p><p>Java ä¸–ç•Œä¸­â€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…ï¼Œä½†æ˜¯ï¼Œéšç€ JIT ç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ä» JDK 1.7 å¼€å§‹å·²ç»é»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ <strong>GC å †ï¼ˆGarbage Collected Heapï¼‰</strong>ã€‚ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenã€Survivorã€Old ç­‰ç©ºé—´ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚</p><p>åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p>ä¸‹å›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 éƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ï¼Œæœ€ä¸‹é¢ä¸€å±‚å±äºæ°¸ä¹…ä»£ã€‚</p><figure><img src="'+Sn+'" alt="image-20220618230320793" tabindex="0" loading="lazy"><figcaption>image-20220618230320793</figcaption></figure><p><strong>JDK 8 ç‰ˆæœ¬ä¹‹å PermGen(æ°¸ä¹…) å·²è¢« Metaspace(å…ƒç©ºé—´) å–ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜</strong> ï¼ˆæˆ‘ä¼šåœ¨æ–¹æ³•åŒºè¿™éƒ¨åˆ†å†…å®¹è¯¦ç»†ä»‹ç»åˆ°ï¼‰ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>-XX:MaxTenuringThreshold</code> æ¥è®¾ç½®ã€‚</p><p><code>ğŸ› ä¿®æ­£â€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚</code></p><p>æ¯ä¸ª<strong>æ ˆå¸§</strong>ï¼ˆStack Frameï¼‰ä¸­å­˜å‚¨ç€ï¼š</p><ul><li>å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</li><li>æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰(æˆ–ç§°ä¸ºè¡¨è¾¾å¼æ ˆ)</li><li>åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ï¼šæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨</li><li>æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ï¼šæ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºçš„åœ°å€</li><li>ä¸€äº›é™„åŠ ä¿¡æ¯</li></ul><figure><img src="'+xn+`" alt="image-20220618230753821" tabindex="0" loading="lazy"><figcaption>image-20220618230753821</figcaption></figure><h2 id="ğŸ•å¹¶å‘ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ•å¹¶å‘ç¼–ç¨‹" aria-hidden="true">#</a> ğŸ•å¹¶å‘ç¼–ç¨‹</h2><h3 id="javaåˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#javaåˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼" aria-hidden="true">#</a> Javaåˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼ï¼Ÿ</h3><ol><li>ç»§æ‰¿Theadç±»åˆ›å»ºçº¿ç¨‹</li><li>å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹</li><li>ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</li></ol><h3 id="çº¿ç¨‹èƒ½ä¸èƒ½-start-ä¸¤æ¬¡-çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ºä»€ä¹ˆèƒ½å¾ªç¯åˆ©ç”¨" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹èƒ½ä¸èƒ½-start-ä¸¤æ¬¡-çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ºä»€ä¹ˆèƒ½å¾ªç¯åˆ©ç”¨" aria-hidden="true">#</a> çº¿ç¨‹èƒ½ä¸èƒ½ start ä¸¤æ¬¡ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ºä»€ä¹ˆèƒ½å¾ªç¯åˆ©ç”¨</h3><p>é¦–å…ˆ demo çœ¼è§ä¸ºå®ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æè¿°ï¼š      å¯¹æ¯”startå’Œrunä¸¤ç§å¯åŠ¨çº¿ç¨‹çš„æ–¹å¼
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartAndRunMethod</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        runnable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><figure><img src="`+_n+`" alt="image-20220413202257122" tabindex="0" loading="lazy"><figcaption>image-20220413202257122</figcaption></figure><p>é€šè¿‡è¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼Œrun()æ–¹æ³•åªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œstart()æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¯åŠ¨çº¿ç¨‹çš„æ–¹æ³• ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸¤æ¬¡ start()ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆ demoï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æè¿°ï¼š      æ¼”ç¤ºä¸èƒ½ä¸¤æ¬¡è°ƒç”¨startæ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥é”™
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CantStartTwice</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼šæŠ¥éæ³•çš„çº¿ç¨‹çŠ¶æ€</p><figure><img src="`+Tn+'" alt="image-20220413202322292" tabindex="0" loading="lazy"><figcaption>image-20220413202322292</figcaption></figure><p>åŸå› åˆ†æï¼š</p><figure><img src="'+Pn+'" alt="image-20220413202333112" tabindex="0" loading="lazy"><figcaption>image-20220413202333112</figcaption></figure><p>é—®é¢˜ 2ï¼šçº¿ç¨‹æ± å°†çº¿ç¨‹å’Œä»»åŠ¡è¿›è¡Œè§£è€¦ï¼Œçº¿ç¨‹æ˜¯çº¿ç¨‹ï¼Œä»»åŠ¡æ˜¯ä»»åŠ¡ï¼Œæ‘†è„±äº†ä¹‹å‰é€šè¿‡ Thread åˆ›å»ºçº¿ç¨‹æ—¶çš„ä¸€ä¸ªçº¿ç¨‹å¿…é¡»å¯¹åº”ä¸€ä¸ªä»»åŠ¡çš„é™åˆ¶ã€‚</p><p>åœ¨çº¿ç¨‹æ± ä¸­ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä»é˜»å¡é˜Ÿåˆ—ä¸­ä¸æ–­è·å–æ–°ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå…¶æ ¸å¿ƒåŸç†åœ¨äºçº¿ç¨‹æ± å¯¹ Thread è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»»åŠ¡éƒ½ä¼šè°ƒç”¨ Thread.start() æ¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯è®©æ¯ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ï¼Œåœ¨è¿™ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ä¸­ä¸åœçš„æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡éœ€è¦è¢«æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä»»åŠ¡ä¸­çš„ run æ–¹æ³•ï¼Œå°† run æ–¹æ³•å½“æˆä¸€ä¸ªæ™®é€šçš„æ–¹æ³•æ‰§è¡Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°†åªä½¿ç”¨å›ºå®šçš„çº¿ç¨‹å°±å°†æ‰€æœ‰ä»»åŠ¡çš„ run æ–¹æ³•ä¸²è”èµ·æ¥</p><p>å½“ä»»åŠ¡æäº¤ä¹‹åï¼Œçº¿ç¨‹æ± é¦–å…ˆä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹æ•°ï¼Œå¦‚æœå½“å‰çš„çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰ï¼Œæ¯”å¦‚æœ€å¼€å§‹åˆ›å»ºçš„æ—¶å€™çº¿ç¨‹æ•°ä¸º 0ï¼Œåˆ™æ–°å»ºçº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡ã€‚ å½“æäº¤çš„ä»»åŠ¡ä¸æ–­å¢åŠ ï¼Œåˆ›å»ºçš„çº¿ç¨‹æ•°ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰ï¼Œæ–°å¢çš„ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ° workQueue ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œå®Œå½“å‰ä»»åŠ¡åï¼Œé‡æ–°ä» workQueue ä¸­è·å–ä»»åŠ¡æ‰§è¡Œã€‚ å‡è®¾ä»»åŠ¡éå¸¸å¤šï¼Œè¾¾åˆ°äº† workQueue çš„æœ€å¤§å®¹é‡ï¼Œä½†æ˜¯å½“å‰çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ï¼Œçº¿ç¨‹æ± ä¼šåœ¨æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰çš„åŸºç¡€ä¸Šç»§ç»­åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ å‡è®¾ä»»åŠ¡ç»§ç»­å¢åŠ ï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ï¼Œå¦‚æœä»»åŠ¡ç»§ç»­å¢åŠ ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹æ± å°±ä¼šé‡‡ç”¨æ‹’ç»ç­–ç•¥æ¥æ‹’ç»è¿™äº›ä»»åŠ¡ã€‚ åœ¨ä»»åŠ¡ä¸æ–­å¢åŠ çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹æ± ä¼šé€ä¸€è¿›è¡Œä»¥ä¸‹ 4 ä¸ªæ–¹é¢çš„åˆ¤æ–­</p><p>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰ ä»»åŠ¡é˜Ÿåˆ—ï¼ˆworkQueueï¼‰ æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ æ‹’ç»ç­–ç•¥</p><h3 id="åˆ©ç”¨å¤šçº¿ç¨‹æ—¶æœ€å¤§çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆ-æ€ä¹ˆè§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åˆ©ç”¨å¤šçº¿ç¨‹æ—¶æœ€å¤§çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆ-æ€ä¹ˆè§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜" aria-hidden="true">#</a> åˆ©ç”¨å¤šçº¿ç¨‹æ—¶æœ€å¤§çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆè§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>å¤šçº¿ç¨‹çš„éš¾ç‚¹æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«çš„æ•°æ®æˆ–èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ•°æ®å†²çªæˆ–ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è¿™å°±æ˜¯å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è§£å†³å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä½¿ç”¨åŸå­ç±»ã€åŒæ­¥é”ã€å¯é‡å…¥é”ã€çº¿ç¨‹æœ¬åœ°å˜é‡</p><ul><li>åŸå­ç±»æ˜¯ä¸€ç§ä½¿ç”¨äº†åŸå­æ“ä½œçš„ç±»ï¼ŒåŸå­æ“ä½œæ˜¯æŒ‡ä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œã€‚åŸå­ç±»å¯ä»¥ä¿è¯å¤šçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚Javaæä¾›äº†å¾ˆå¤šåŸå­ç±»ï¼Œæ¯”å¦‚AtomicIntegerã€AtomicLongã€AtomicBooleanç­‰ã€‚</li><li>åŒæ­¥é”æ˜¯ä¸€ç§ä½¿ç”¨synchronizedå…³é”®å­—æˆ–è€…Lockæ¥å£å®ç°çš„é”æœºåˆ¶ï¼Œå®ƒå¯ä»¥è®©å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œæ’ä»–æ€§è®¿é—®ï¼Œåªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼Œå…¶ä»–çº¿ç¨‹åˆ™è¦ç­‰å¾…é”é‡Šæ”¾åæ‰èƒ½ç«äº‰é”ã€‚</li><li>å¯é‡å…¥é”æ˜¯ä¸€ç§æ”¯æŒé‡å…¥åŠŸèƒ½çš„é”ï¼Œé‡å…¥æŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ã€‚å¯é‡å…¥é”å¯ä»¥é¿å…æ­»é”å’Œé€’å½’è°ƒç”¨å¯¼è‡´çš„æ ˆæº¢å‡ºé—®é¢˜ã€‚ReentrantLockå°±æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œå®ƒå®ç°äº†Lockæ¥å£ï¼Œå¹¶æä¾›äº†å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§æ¨¡å¼ã€‚</li><li>çº¿ç¨‹æœ¬åœ°å˜é‡æ˜¯ä¸€ç§ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå•ç‹¬å‰¯æœ¬çš„å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸èƒ½è®¿é—®å…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬ã€‚è¿™æ ·å°±é¿å…äº†å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œä¿®æ”¹è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ThreadLocalå°±æ˜¯ä¸€ç§çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œå®ƒæä¾›äº†get()å’Œset()æ–¹æ³•æ¥è·å–å’Œè®¾ç½®å½“å‰çº¿ç¨‹çš„å‰¯æœ¬Â¹Â³ã€‚</li></ul><h3 id="æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹ä¸‹é¢å•ä¾‹æ¨¡å¼å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹ä¸‹é¢å•ä¾‹æ¨¡å¼å®‰å…¨" aria-hidden="true">#</a> æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹ä¸‹é¢å•ä¾‹æ¨¡å¼å®‰å…¨</h3><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå•ä¾‹æ¨¡å¼éœ€è¦ç‰¹åˆ«å°å¿ƒä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œä»è€Œè¿åäº†å•ä¾‹æ¨¡å¼çš„è®¾è®¡åŸåˆ™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¿è¯å¤šçº¿ç¨‹ä¸‹å•ä¾‹æ¨¡å¼å®‰å…¨çš„æ–¹æ³•ï¼š</p><ol><li>æ‡’æ±‰å¼åŒé‡æ ¡éªŒé”ï¼ˆDouble-Checked Lockingï¼‰ è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå®ä¾‹çš„é—®é¢˜ï¼Œå¹¶ä¸”åœ¨å®ä¾‹å·²ç»å­˜åœ¨æ—¶å¯ä»¥é¿å…ä½¿ç”¨é”ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œé¦–å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰è¿›è¡ŒåŒæ­¥ï¼Œåªæœ‰è·å–åˆ°é”çš„çº¿ç¨‹æ‰èƒ½åˆ›å»ºå®ä¾‹ã€‚å½“å…¶ä»–çº¿ç¨‹å†æ¬¡å°è¯•åˆ›å»ºå®ä¾‹æ—¶ï¼Œå› ä¸ºå·²ç»å­˜åœ¨å®ä¾‹ï¼Œæ‰€ä»¥ä¸ä¼šå†è¿›å…¥åŒæ­¥å—ä¸­ã€‚</li><li>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆEager Initializationï¼‰ è¿™ç§æ–¹å¼åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºäº†å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯å¯èƒ½ä¼šæµªè´¹ä¸€äº›ç³»ç»Ÿèµ„æºã€‚å®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœå®ä¾‹åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä»æœªä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆå®ƒå°±æµªè´¹äº†ç³»ç»Ÿèµ„æºã€‚</li><li>é™æ€å†…éƒ¨ç±»æ–¹å¼ è¿™ç§æ–¹å¼åˆ©ç”¨äº† Java ç±»åŠ è½½å™¨çš„æœºåˆ¶æ¥ä¿è¯å¤šçº¿ç¨‹ä¸‹åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºã€‚å½“é™æ€å†…éƒ¨ç±»è¢«åŠ è½½æ—¶ï¼Œå®ä¾‹å°±ä¼šè¢«åˆ›å»ºï¼Œè€Œä¸”å› ä¸ºç±»åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åˆ›å»ºå¤šä¸ªå®ä¾‹çš„æƒ…å†µå‘ç”Ÿã€‚</li><li>ä½¿ç”¨volatileå…³é”®å­— åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œvolatileå…³é”®å­—å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œä»è€Œå¯ä»¥ä¿è¯å•ä¾‹æ¨¡å¼çš„æ­£ç¡®æ€§ã€‚åœ¨å˜é‡å£°æ˜æ—¶ä½¿ç”¨volatileå…³é”®å­—å¯ä»¥ç¡®ä¿å˜é‡çš„å¯è§æ€§ï¼Œä»è€Œé¿å…å¤šçº¿ç¨‹ä¸‹åˆ›å»ºå¤šä¸ªå®ä¾‹çš„é—®é¢˜ã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥ä¸Šæ–¹æ³•è™½ç„¶å¯ä»¥ä¿è¯å•ä¾‹æ¨¡å¼çš„æ­£ç¡®æ€§ï¼Œä½†æ˜¯ä¹Ÿä¼šå¯¹ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚å› æ­¤ï¼Œåœ¨é€‰æ‹©å®ç°å•ä¾‹æ¨¡å¼æ—¶éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæƒè¡¡ã€‚</p><h3 id="concurrentmap-å’Œ-hashmap-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#concurrentmap-å’Œ-hashmap-æœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> concurrentMap å’Œ hashmap æœ‰ä»€ä¹ˆåŒºåˆ«</h3><p><code>ConcurrentHashMap</code> å’Œ <code>Hashtable</code> çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸Šä¸åŒã€‚</p><ul><li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> JDK1.7 çš„ <code>ConcurrentHashMap</code> åº•å±‚é‡‡ç”¨ <strong>åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨</strong> å®ç°ï¼ŒJDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·Ÿ <code>HashMap1.8</code> çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚<code>Hashtable</code> å’Œ JDK1.8 ä¹‹å‰çš„ <code>HashMap</code> çš„åº•å±‚æ•°æ®ç»“æ„ç±»ä¼¼éƒ½æ˜¯é‡‡ç”¨ <strong>æ•°ç»„+é“¾è¡¨</strong> çš„å½¢å¼ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼›</li><li><strong>å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ˆé‡è¦ï¼‰ï¼š</strong> â‘  <strong>åœ¨ JDK1.7 çš„æ—¶å€™ï¼Œ<code>ConcurrentHashMap</code>ï¼ˆåˆ†æ®µé”ï¼‰</strong> å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(<code>Segment</code>)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚ <strong>åˆ°äº† JDK1.8 çš„æ—¶å€™å·²ç»æ‘’å¼ƒäº† <code>Segment</code> çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ <code>Node</code> æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ <code>synchronized</code> å’Œ CAS æ¥æ“ä½œã€‚ï¼ˆJDK1.6 ä»¥å å¯¹ <code>synchronized</code> é”åšäº†å¾ˆå¤šä¼˜åŒ–ï¼‰</strong> æ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ <code>HashMap</code>ï¼Œè™½ç„¶åœ¨ JDK1.8 ä¸­è¿˜èƒ½çœ‹åˆ° <code>Segment</code> çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼›â‘¡ <strong><code>Hashtable</code>(åŒä¸€æŠŠé”)</strong> :ä½¿ç”¨ <code>synchronized</code> æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œå¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ getï¼Œç«äº‰ä¼šè¶Šæ¥è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</li></ul><p>HashMapå’ŒHashtableéƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹çš„Javaé›†åˆæ¡†æ¶ç±»ï¼Œå®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›ä¸åŒä¹‹å¤„ã€‚</p><p>ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>çº¿ç¨‹å®‰å…¨æ€§ï¼šHashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒHashMapä¸æ˜¯ã€‚å› ä¸ºHashtableçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ï¼Œè€ŒHashMapä¸æ˜¯ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®Hashtableï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥æªæ–½ï¼Œè€ŒHashMapéœ€è¦é€šè¿‡åŒæ­¥æªæ–½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li>Nullé”®å’Œå€¼ï¼šHashtableä¸å…è®¸ä½¿ç”¨nullä½œä¸ºé”®æˆ–å€¼ï¼Œå¦åˆ™ä¼šæŠ›å‡ºNullPointerExceptionå¼‚å¸¸ï¼Œè€ŒHashMapåˆ™å…è®¸ä½¿ç”¨ä¸€ä¸ªnullé”®å’Œä»»æ„æ•°é‡çš„nullå€¼ã€‚</li><li>è¿­ä»£å™¨ï¼šHashtableçš„è¿­ä»£å™¨æ˜¯Enumerationæ¥å£çš„å®ä¾‹ï¼Œè€ŒHashMapçš„è¿­ä»£å™¨æ˜¯Iteratoræ¥å£çš„å®ä¾‹ã€‚</li><li>æ€§èƒ½ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒHashMapçš„æ€§èƒ½è¦æ¯”Hashtableæ›´å¥½ã€‚è¿™æ˜¯å› ä¸ºHashtableçš„æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ï¼Œè€ŒHashMapçš„æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥HashMapçš„è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚åŒæ—¶ï¼ŒHashMapå…è®¸ä½¿ç”¨nullé”®å’Œå€¼ï¼Œé¿å…äº†Hashtableåœ¨å¤„ç†nullå€¼æ—¶éœ€è¦è¿›è¡Œé¢å¤–çš„æ£€æŸ¥ã€‚</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œè™½ç„¶å®ƒä»¬éƒ½æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹çš„é›†åˆæ¡†æ¶ç±»ï¼Œä½†ç”±äºå®ƒä»¬çš„ä¸€äº›å·®å¼‚ï¼Œå¼€å‘äººå‘˜éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªã€‚å¦‚æœéœ€è¦çº¿ç¨‹å®‰å…¨æ€§æˆ–ä¸èƒ½ä½¿ç”¨nullé”®æˆ–å€¼ï¼Œåˆ™å¯ä»¥é€‰æ‹©Hashtableã€‚å¦‚æœéœ€è¦æ›´å¥½çš„æ€§èƒ½æˆ–å¯ä»¥ä½¿ç”¨nullé”®æˆ–å€¼ï¼Œåˆ™å¯ä»¥é€‰æ‹©HashMapã€‚</p><p>ConcurrentMapå’ŒHashMapéƒ½æ˜¯Javaé›†åˆæ¡†æ¶ä¸­ç”¨äºå­˜å‚¨é”®å€¼å¯¹çš„ç±»ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ï¼š</p><ol><li>çº¿ç¨‹å®‰å…¨æ€§ï¼šConcurrentMapæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒHashMapä¸æ˜¯ã€‚ConcurrentMapæä¾›äº†å¤šç§çº¿ç¨‹å®‰å…¨çš„å®ç°ï¼Œå¦‚ConcurrentHashMapï¼Œå®ƒèƒ½å¤ŸåŒæ—¶æ”¯æŒé«˜å¹¶å‘çš„è¯»å†™æ“ä½œï¼Œè€ŒHashMapåœ¨å¤šçº¿ç¨‹å¹¶å‘ç¯å¢ƒä¸‹éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥æªæ–½æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ol><p><strong>ä¸¤è€…çš„å¯¹æ¯”å›¾ï¼š</strong></p><p><strong>Hashtable:</strong></p><figure><img src="'+Ln+'" alt="image-20220404155942489" tabindex="0" loading="lazy"><figcaption>image-20220404155942489</figcaption></figure><p><strong>JDK1.7 çš„ ConcurrentHashMapï¼š</strong></p><figure><img src="'+Rn+'" alt="image-20220404155949898" tabindex="0" loading="lazy"><figcaption>image-20220404155949898</figcaption></figure><p><strong>JDK1.8 çš„ ConcurrentHashMapï¼š</strong></p><figure><img src="'+In+`" alt="image-20220404155956076" tabindex="0" loading="lazy"><figcaption>image-20220404155956076</figcaption></figure><p>JDK1.8 çš„ <code>ConcurrentHashMap</code> ä¸å†æ˜¯ <strong>Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨</strong>ï¼Œè€Œæ˜¯ <strong>Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘</strong>ã€‚ä¸è¿‡ï¼ŒNode åªèƒ½ç”¨äºé“¾è¡¨çš„æƒ…å†µï¼Œçº¢é»‘æ ‘çš„æƒ…å†µéœ€è¦ä½¿ç”¨ <strong><code>TreeNode</code></strong>ã€‚å½“å†²çªé“¾è¡¨è¾¾åˆ°ä¸€å®šé•¿åº¦æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ã€‚</p><h3 id="concurrenthashmap-çº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼-åº•å±‚å…·ä½“å®ç°" tabindex="-1"><a class="header-anchor" href="#concurrenthashmap-çº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼-åº•å±‚å…·ä½“å®ç°" aria-hidden="true">#</a> ConcurrentHashMap çº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼/åº•å±‚å…·ä½“å®ç°</h3><p>JDK1.7ï¼ˆä¸Šé¢æœ‰ç¤ºæ„å›¾ï¼‰</p><p>é¦–å…ˆå°†æ•°æ®åˆ†ä¸ºä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®æ—¶ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p><p><strong><code>ConcurrentHashMap</code> æ˜¯ç”± <code>Segment</code> æ•°ç»„ç»“æ„å’Œ <code>HashEntry</code> æ•°ç»„ç»“æ„ç»„æˆ</strong>ã€‚</p><p>Segment å®ç°äº† <code>ReentrantLock</code>,æ‰€ä»¥ <code>Segment</code> æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œæ‰®æ¼”é”çš„è§’è‰²ã€‚<code>HashEntry</code> ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ª <code>ConcurrentHashMap</code> é‡ŒåŒ…å«ä¸€ä¸ª <code>Segment</code> æ•°ç»„ã€‚<code>Segment</code> çš„ç»“æ„å’Œ <code>HashMap</code> ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª <code>Segment</code> åŒ…å«ä¸€ä¸ª <code>HashEntry</code> æ•°ç»„ï¼Œæ¯ä¸ª <code>HashEntry</code> æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œæ¯ä¸ª <code>Segment</code> å®ˆæŠ¤ç€ä¸€ä¸ª <code>HashEntry</code> æ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹ <code>HashEntry</code> æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ <code>Segment</code> çš„é”ã€‚</p><p>JDK1.8 ï¼ˆä¸Šé¢æœ‰ç¤ºæ„å›¾ï¼‰</p><p><code>ConcurrentHashMap</code> å–æ¶ˆäº† <code>Segment</code> åˆ†æ®µé”ï¼Œé‡‡ç”¨ CAS å’Œ <code>synchronized</code> æ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚æ•°æ®ç»“æ„è·Ÿ HashMap1.8 çš„ç»“æ„ç±»ä¼¼ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚Java 8 åœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆ8ï¼‰æ—¶å°†é“¾è¡¨ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼‰è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸º O(log(N))ï¼‰</p><p><code>synchronized</code> åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦ hash ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œæ•ˆç‡åˆæå‡ N å€ã€‚</p><h3 id="çº¿ç¨‹å®‰å…¨æ˜¯ä»€ä¹ˆæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹å®‰å…¨æ˜¯ä»€ä¹ˆæ¦‚å¿µ" aria-hidden="true">#</a> çº¿ç¨‹å®‰å…¨æ˜¯ä»€ä¹ˆæ¦‚å¿µ</h3><p>ä¸€ä¸ªç±»åœ¨å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨è°ƒç”¨æ—¶å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>çº¿ç¨‹å®‰å…¨ä¸æ˜¯ä¸€ä¸ªéçœŸå³å‡çš„å‘½é¢˜ï¼Œå¯ä»¥å°†å…±äº«æ•°æ®æŒ‰ç…§å®‰å…¨ç¨‹åº¦çš„å¼ºå¼±é¡ºåºåˆ†æˆä»¥ä¸‹äº”ç±»: ä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹å¯¹ç«‹</p><h3 id="hashmap-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¸å®‰å…¨-èƒ½ä¸¾å‡ºä¾‹å­æ¥å—" tabindex="-1"><a class="header-anchor" href="#hashmap-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¸å®‰å…¨-èƒ½ä¸¾å‡ºä¾‹å­æ¥å—" aria-hidden="true">#</a> hashmap ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¸å®‰å…¨ï¼Œèƒ½ä¸¾å‡ºä¾‹å­æ¥å—</h3><p>ä¸€èˆ¬æ¥è¯´ï¼ŒHashè¡¨è¿™ä¸ªå®¹å™¨å½“æœ‰æ•°æ®è¦æ’å…¥æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥å®¹é‡æœ‰æ²¡æœ‰è¶…è¿‡è®¾å®šçš„thredholdï¼Œå¦‚æœè¶…è¿‡ï¼Œéœ€è¦å¢å¤§Hashè¡¨çš„å°ºå¯¸ï¼Œä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œæ•´ä¸ªHashè¡¨é‡Œçš„æ— ç´ éƒ½éœ€è¦è¢«é‡ç®—ä¸€éã€‚è¿™å«rehashï¼Œè¿™ä¸ªæˆæœ¬ç›¸å½“çš„å¤§</p><p>ä¸»è¦åŸå› åœ¨äºå¹¶å‘ä¸‹çš„ Rehash ä¼šé€ æˆå…ƒç´ ä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚ä¸è¿‡ï¼Œjdk 1.8 åè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap,å› ä¸ºå¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ HashMap è¿˜æ˜¯ä¼šå­˜åœ¨å…¶ä»–é—®é¢˜æ¯”å¦‚æ•°æ®ä¸¢å¤±ã€‚å¹¶å‘ç¯å¢ƒä¸‹æ¨èä½¿ç”¨ ConcurrentHashMap ã€‚</p>`,112),hp={href:"https://coolshell.cn/articles/9606.html",target:"_blank",rel:"noopener noreferrer"},fp=t(`<h3 id="æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨" aria-hidden="true">#</a> æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨</h3><ol><li>äº’æ–¥åŒæ­¥</li></ol><p>synchronized å…³é”®å­—å’Œ ReentrantLockç±»ã€‚</p><p>åˆæ­¥äº†è§£ä½ å¯ä»¥çœ‹ï¼š</p><ul><li>Java å¹¶å‘ - çº¿ç¨‹åŸºç¡€ï¼šçº¿ç¨‹äº’æ–¥åŒæ­¥</li></ul><p>è¯¦ç»†åˆ†æè¯·çœ‹ï¼š</p><ul><li>å…³é”®å­—: Synchronized è¯¦è§£</li><li>JUC é”: ReentrantLock è¯¦è§£</li></ul><p>synchronizedå…³é”®å­—æ˜¯Javaä¸­æœ€å¸¸ç”¨çš„åŒæ­¥æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•å’Œä»£ç å—ï¼Œç”¨äºä¿è¯å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶çš„äº’æ–¥æ€§å’ŒåŒæ­¥æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªè¢«synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½è¿›å…¥ä¸´ç•ŒåŒºè®¿é—®å…±äº«èµ„æºã€‚synchronizedå…³é”®å­—å¯ä»¥ä¿è¯äº’æ–¥æ€§å’Œå¯è§æ€§ï¼Œæ˜¯Javaä¸­å®ç°çº¿ç¨‹å®‰å…¨çš„é‡è¦æ‰‹æ®µã€‚</p><p>ReentrantLockç±»æ˜¯Javaæä¾›çš„å¦ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒæä¾›äº†æ¯”synchronizedå…³é”®å­—æ›´çµæ´»çš„é”æœºåˆ¶ã€‚ä¸synchronizedå…³é”®å­—ä¸åŒï¼ŒReentrantLockç±»å¯ä»¥å®ç°å¯é‡å…¥é”ã€å…¬å¹³é”ã€é™æ—¶é”ç­‰ä¸åŒç±»å‹çš„é”ï¼Œå¹¶æä¾›äº†ä¸€äº›é¢å¤–çš„ç‰¹æ€§ï¼Œå¦‚å¯ä¸­æ–­ã€å¯è½®è¯¢ç­‰ã€‚ä½¿ç”¨ReentrantLockç±»éœ€è¦æ‰‹åŠ¨è·å–é”å’Œé‡Šæ”¾é”ï¼Œæ¯”è¾ƒçµæ´»ï¼Œä½†ä¹Ÿéœ€è¦æ³¨æ„é¿å…æ­»é”å’Œæ´»é”ç­‰é—®é¢˜ã€‚</p><ol start="2"><li>éé˜»å¡åŒæ­¥</li></ol><p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p><p>äº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”(è¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”)ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p><p><strong>(ä¸€)CAS</strong></p><p>éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥: å…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™é‡‡å–è¡¥å¿æªæ–½(ä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢)ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦å°†çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p><p>ä¹è§‚é”éœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ï¼Œè¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯äº†ï¼Œåªèƒ½é ç¡¬ä»¶æ¥å®Œæˆã€‚ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯: æ¯”è¾ƒå¹¶äº¤æ¢(Compare-and-Swapï¼ŒCAS)ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œåªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º Bã€‚</p><p><strong>(äºŒ)AtomicInteger</strong></p><p>J.U.C åŒ…é‡Œé¢çš„æ•´æ•°åŸå­ç±» AtomicIntegerï¼Œå…¶ä¸­çš„ compareAndSet() å’Œ getAndIncrement() ç­‰æ–¹æ³•éƒ½ä½¿ç”¨äº† Unsafe ç±»çš„ CAS æ“ä½œã€‚</p><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨äº† AtomicInteger æ‰§è¡Œäº†è‡ªå¢çš„æ“ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> cnt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cnt<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>æ— åŒæ­¥æ–¹æ¡ˆ</li></ol><p>è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯ä¸€å®šå°±è¦è¿›è¡ŒåŒæ­¥ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ã€‚</p><p>(ä¸€)æ ˆå°é—­</p><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ã€‚</p><p>(äºŒ)çº¿ç¨‹æœ¬åœ°å­˜å‚¨(Thread Local Storage)</p><p>å¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·ï¼Œæ— é¡»åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨çš„é—®é¢˜ã€‚</p><p>ç¬¦åˆè¿™ç§ç‰¹ç‚¹çš„åº”ç”¨å¹¶ä¸å°‘è§ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨æ¶ˆè´¹é˜Ÿåˆ—çš„æ¶æ„æ¨¡å¼(å¦‚â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼)éƒ½ä¼šå°†äº§å“çš„æ¶ˆè´¹è¿‡ç¨‹å°½é‡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ¶ˆè´¹å®Œã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹å°±æ˜¯ç»å…¸ Web äº¤äº’æ¨¡å‹ä¸­çš„â€œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨çº¿ç¨‹â€(Thread-per-Request)çš„å¤„ç†æ–¹å¼ï¼Œè¿™ç§å¤„ç†æ–¹å¼çš„å¹¿æ³›åº”ç”¨ä½¿å¾—å¾ˆå¤š Web æœåŠ¡ç«¯åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>å¯ä»¥ä½¿ç”¨ java.lang.ThreadLocal ç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨åŠŸèƒ½ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œthread1 ä¸­è®¾ç½® threadLocal ä¸º 1ï¼Œè€Œ thread2 è®¾ç½® threadLocal ä¸º 2ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œthread1 è¯»å– threadLocal ä¾ç„¶æ˜¯ 1ï¼Œä¸å— thread2 çš„å½±å“ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadLocal</span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†ç†è§£ ThreadLocalï¼Œå…ˆçœ‹ä»¥ä¸‹ä»£ç :</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalExample1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadLocal</span> threadLocal1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocal</span> threadLocal2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            threadLocal1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadLocal2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            threadLocal1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadLocal2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒæ‰€å¯¹åº”çš„åº•å±‚ç»“æ„å›¾ä¸º:</p><figure><img src="`+An+`" alt="image-20220413201943773" tabindex="0" loading="lazy"><figcaption>image-20220413201943773</figcaption></figure><p>æ¯ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap å¯¹è±¡ï¼ŒThread ç±»ä¸­å°±å®šä¹‰äº† ThreadLocal.ThreadLocalMap æˆå‘˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/* ThreadLocal values pertaining to this thread. This map is maintained
 * by the ThreadLocal class. */</span>
<span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è°ƒç”¨ä¸€ä¸ª ThreadLocal çš„ set(T value) æ–¹æ³•æ—¶ï¼Œå…ˆå¾—åˆ°å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå°† ThreadLocal-&gt;value é”®å€¼å¯¹æ’å…¥åˆ°è¯¥ Map ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>get() æ–¹æ³•ç±»ä¼¼ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadLocalMap<span class="token punctuation">.</span>Entry</span> e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
            <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ThreadLocal ä»ç†è®ºä¸Šè®²å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜çš„ï¼Œå› ä¸ºæ ¹æœ¬ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ã€‚</p><p>åœ¨ä¸€äº›åœºæ™¯ (å°¤å…¶æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ) ä¸‹ï¼Œç”±äº ThreadLocal.ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„å¯¼è‡´ ThreadLocal æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œåº”è¯¥å°½å¯èƒ½åœ¨æ¯æ¬¡ä½¿ç”¨ ThreadLocal åæ‰‹åŠ¨è°ƒç”¨ remove()ï¼Œä»¥é¿å…å‡ºç° ThreadLocal ç»å…¸çš„å†…å­˜æ³„æ¼ç”šè‡³æ˜¯é€ æˆè‡ªèº«ä¸šåŠ¡æ··ä¹±çš„é£é™©ã€‚</p><p>æ›´è¯¦ç»†çš„åˆ†æçœ‹ï¼šJava å¹¶å‘ - ThreadLocal è¯¦è§£</p><p><strong>(ä¸‰)å¯é‡å…¥ä»£ç (Reentrant Code)</strong></p><p>è¿™ç§ä»£ç ä¹Ÿå«åšçº¯ä»£ç (Pure Code)ï¼Œå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç (åŒ…æ‹¬é€’å½’è°ƒç”¨å®ƒæœ¬èº«)ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚</p><p>å¯é‡å…¥ä»£ç æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾ï¼Œä¾‹å¦‚ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®å’Œå…¬ç”¨çš„ç³»ç»Ÿèµ„æºã€ç”¨åˆ°çš„çŠ¶æ€é‡éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ã€ä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ã€‚</p><h3 id="volatile-å’Œ-synchronize-æœ‰ä»€ä¹ˆåŒºåˆ«-volatile-å’Œ-synchronized" tabindex="-1"><a class="header-anchor" href="#volatile-å’Œ-synchronize-æœ‰ä»€ä¹ˆåŒºåˆ«-volatile-å’Œ-synchronized" aria-hidden="true">#</a> volatile å’Œ synchronize æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ / volatile å’Œ synchronized</h3><p><code>synchronized</code> å…³é”®å­—å’Œ <code>volatile</code> å…³é”®å­—æ˜¯ä¸¤ä¸ªäº’è¡¥çš„å­˜åœ¨ï¼Œè€Œä¸æ˜¯å¯¹ç«‹çš„å­˜åœ¨ï¼</p><ul><li><strong><code>volatile</code> å…³é”®å­—</strong>æ˜¯çº¿ç¨‹åŒæ­¥çš„<strong>è½»é‡çº§å®ç°</strong>ï¼Œæ‰€ä»¥ <strong><code>volatile </code>æ€§èƒ½è‚¯å®šæ¯” <code>synchronized</code>å…³é”®å­—è¦å¥½</strong> ã€‚ä½†æ˜¯ <strong><code>volatile</code> å…³é”®å­—åªèƒ½ç”¨äºå˜é‡è€Œ <code>synchronized</code> å…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—</strong> ã€‚</li><li><strong><code>volatile</code> å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚<code>synchronized</code> å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</strong></li><li><strong><code>volatile</code>å…³é”®å­—ä¸»è¦ç”¨äºè§£å†³å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œ <code>synchronized</code> å…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§</strong></li></ul><h3 id="volatile-èƒ½ä¿è¯-i-å®‰å…¨å—-i-ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#volatile-èƒ½ä¿è¯-i-å®‰å…¨å—-i-ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§" aria-hidden="true">#</a> volatile èƒ½ä¿è¯ i++å®‰å…¨å— / i++ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§?</h3><p>å¯¹äºåŸå­æ€§ï¼Œéœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œä¹Ÿæ˜¯å¤§å®¶å®¹æ˜“è¯¯è§£çš„ä¸€ç‚¹ï¼šå¯¹ volatile å˜é‡çš„å•æ¬¡è¯»/å†™æ“ä½œå¯ä»¥ä¿è¯åŸå­æ€§çš„ï¼Œå¦‚ long å’Œ double ç±»å‹å˜é‡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ i++è¿™ç§æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºæœ¬è´¨ä¸Š i++æ˜¯è¯»ã€å†™ä¸¤æ¬¡æ“ä½œã€‚ ç°åœ¨æˆ‘ä»¬å°±é€šè¿‡ä¸‹åˆ—ç¨‹åºæ¥æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileTest01</span> <span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span>  <span class="token class-name">VolatileTest01</span> test01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VolatileTest01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    test01<span class="token punctuation">.</span><span class="token function">addI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç­‰å¾…10ç§’ï¼Œä¿è¯ä¸Šé¢ç¨‹åºæ‰§è¡Œå®Œæˆ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test01<span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤§å®¶å¯èƒ½ä¼šè¯¯è®¤ä¸ºå¯¹å˜é‡ i åŠ ä¸Šå…³é”®å­— volatile åï¼Œè¿™æ®µç¨‹åºå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¤§å®¶å¯ä»¥å°è¯•è¿è¡Œä¸Šé¢çš„ç¨‹åºã€‚ä¸‹é¢æ˜¯æˆ‘æœ¬åœ°è¿è¡Œçš„ç»“æœï¼š981 å¯èƒ½æ¯ä¸ªäººè¿è¡Œçš„ç»“æœä¸ç›¸åŒã€‚ä¸è¿‡åº”è¯¥èƒ½çœ‹å‡ºï¼Œvolatile æ˜¯æ— æ³•ä¿è¯åŸå­æ€§çš„(å¦åˆ™ç»“æœåº”è¯¥æ˜¯ 1000)ã€‚åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œi++å…¶å®æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼ŒåŒ…æ‹¬ä¸‰æ­¥éª¤ï¼š</p><ul><li>è¯»å– i çš„å€¼ã€‚</li><li>å¯¹ i åŠ  1ã€‚</li><li>å°† i çš„å€¼å†™å›å†…å­˜ã€‚ volatile æ˜¯æ— æ³•ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œæ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ AtomicInteger æˆ–è€… Synchronized æ¥ä¿è¯+1 æ“ä½œçš„åŸå­æ€§ã€‚ æ³¨ï¼šä¸Šé¢å‡ æ®µä»£ç ä¸­å¤šå¤„æ‰§è¡Œäº† Thread.sleep()æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†å¢åŠ å¹¶å‘é—®é¢˜çš„äº§ç”Ÿå‡ ç‡ï¼Œæ— å…¶ä»–ä½œç”¨ã€‚</li></ul><h3 id="ä¹è§‚é”å’Œæ‚²è§‚é”-å…·ä½“å®ç°" tabindex="-1"><a class="header-anchor" href="#ä¹è§‚é”å’Œæ‚²è§‚é”-å…·ä½“å®ç°" aria-hidden="true">#</a> ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå…·ä½“å®ç°</h3><p><strong>æ‚²è§‚é”</strong></p><p><code>æ‚²è§‚é”</code>å¯¹åº”äºç”Ÿæ´»ä¸­æ‚²è§‚çš„äººï¼Œæ‚²è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€åçš„æ–¹å‘å‘å±•ã€‚</p><p>ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå‡è®¾å•æ‰€åªæœ‰ä¸€ä¸ªå‘ä½äº†ï¼Œæ‚²è§‚é”ä¸Šå•æ‰€ä¼šç¬¬ä¸€æ—¶é—´æŠŠé—¨åé”ä¸Šï¼Œè¿™æ ·å…¶ä»–äººä¸Šå•æ‰€åªèƒ½åœ¨é—¨å¤–ç­‰å€™ï¼Œè¿™ç§çŠ¶æ€å°±æ˜¯ã€Œé˜»å¡ã€äº†ã€‚</p><p>å›åˆ°ä»£ç ä¸–ç•Œä¸­ï¼Œä¸€ä¸ªå…±äº«æ•°æ®åŠ äº†æ‚²è§‚é”ï¼Œé‚£çº¿ç¨‹æ¯æ¬¡æƒ³æ“ä½œè¿™ä¸ªæ•°æ®å‰éƒ½ä¼šå‡è®¾å…¶ä»–çº¿ç¨‹ä¹Ÿå¯èƒ½ä¼šæ“ä½œè¿™ä¸ªæ•°æ®ï¼Œæ‰€ä»¥æ¯æ¬¡æ“ä½œå‰éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ“ä½œè¿™ä¸ªæ•°æ®æ‹¿ä¸åˆ°é”åªèƒ½é˜»å¡äº†ã€‚</p><figure><img src="`+Nn+'" alt="image-20220404202112266" tabindex="0" loading="lazy"><figcaption>image-20220404202112266</figcaption></figure><p>åœ¨ Java è¯­è¨€ä¸­ <code>synchronized</code> å’Œ <code>ReentrantLock</code>ç­‰å°±æ˜¯å…¸å‹çš„æ‚²è§‚é”ï¼Œè¿˜æœ‰ä¸€äº›ä½¿ç”¨äº† synchronized å…³é”®å­—çš„å®¹å™¨ç±»å¦‚ <code>HashTable</code> ç­‰ä¹Ÿæ˜¯æ‚²è§‚é”çš„åº”ç”¨ã€‚</p><blockquote><p>ã€Šofferæ¥äº†ã€‹è§£é‡Šï¼š</p><p>æ‚²è§‚é”é‡‡ç”¨æ‚²è§‚æ€æƒ³å¤„ç†æ•°æ®ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è¯»å†™æ•°æ®æ—¶éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³è¯»å†™è¿™ä¸ªæ•°æ®æ—¶å°±ä¼šé˜»å¡ã€ç­‰å¾…ç›´åˆ°æ‹¿åˆ°é”ã€‚Javaä¸­çš„æ‚²è§‚é”å¤§éƒ¨åˆ†åŸºäºAQSï¼ˆAbstract Queued Synchronizedï¼ŒæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰æ¶æ„å®ç°ã€‚AQSå®šä¹‰äº†ä¸€å¥—å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„åŒæ­¥æ¡†æ¶ï¼Œè®¸å¤šåŒæ­¥ç±»çš„å®ç°éƒ½ä¾èµ–äºå®ƒï¼Œä¾‹å¦‚å¸¸ç”¨çš„Synchronizedã€ReentrantLockã€Semaphoreã€CountDownLatchç­‰ã€‚è¯¥æ¡†æ¶ä¸‹çš„é”ä¼šå…ˆå°è¯•ä»¥CASä¹è§‚é”å»è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™ä¼šè½¬ä¸ºæ‚²è§‚é”ï¼ˆå¦‚RetreenLockï¼‰ã€‚</p></blockquote><p><strong>ä¹è§‚é”</strong></p><p><code>ä¹è§‚é”</code> å¯¹åº”äºç”Ÿæ´»ä¸­ä¹è§‚çš„äººï¼Œä¹è§‚çš„äººæ€»æ˜¯æƒ³ç€äº‹æƒ…å¾€å¥½çš„æ–¹å‘å‘å±•ã€‚</p><p>ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå‡è®¾å•æ‰€åªæœ‰ä¸€ä¸ªå‘ä½äº†ï¼Œä¹è§‚é”è®¤ä¸ºï¼šè¿™è’éƒŠé‡å¤–çš„ï¼Œåˆæ²¡æœ‰ä»€ä¹ˆäººï¼Œä¸ä¼šæœ‰äººæŠ¢æˆ‘å‘ä½çš„ï¼Œæ¯æ¬¡å…³é—¨ä¸Šé”å¤šæµªè´¹æ—¶é—´ï¼Œè¿˜æ˜¯ä¸åŠ é”å¥½äº†ã€‚ä½ çœ‹ä¹è§‚é”å°±æ˜¯å¤©ç”Ÿä¹è§‚ï¼</p><p>å›åˆ°ä»£ç ä¸–ç•Œä¸­ï¼Œä¹è§‚é”æ“ä½œæ•°æ®æ—¶ä¸ä¼šä¸Šé”ï¼Œåœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚</p><figure><img src="'+Mn+`" alt="image-20220404202121152" tabindex="0" loading="lazy"><figcaption>image-20220404202121152</figcaption></figure><p>ä¹è§‚é”å¯ä»¥ä½¿ç”¨ <code>ç‰ˆæœ¬å·æœºåˆ¶</code>å’Œ <code>CASç®—æ³•</code>å®ç°ã€‚åœ¨ Java è¯­è¨€ä¸­ <code>java.util.concurrent.atomic</code>åŒ…ä¸‹çš„åŸå­ç±»å°±æ˜¯ä½¿ç”¨ CAS ä¹è§‚é”å®ç°çš„ã€‚</p><p><strong>ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</strong></p><p>æ‚²è§‚é”å’Œä¹è§‚é”æ²¡æœ‰å­°ä¼˜å­°åŠ£ï¼Œæœ‰å…¶å„è‡ªé€‚åº”çš„åœºæ™¯ã€‚</p><p>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘ï¼ˆå†²çªæ¯”è¾ƒå°ï¼‰çš„åœºæ™¯ï¼Œå› ä¸ºä¸ç”¨ä¸Šé”ã€é‡Šæ”¾é”ï¼Œçœå»äº†é”çš„å¼€é”€ï¼Œä»è€Œæå‡äº†ååé‡ã€‚</p><p>å¦‚æœæ˜¯å†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œå³å†²çªæ¯”è¾ƒä¸¥é‡ï¼Œçº¿ç¨‹é—´ç«äº‰æ¿€åŠ±ï¼Œä½¿ç”¨ä¹è§‚é”å°±æ˜¯å¯¼è‡´çº¿ç¨‹ä¸æ–­è¿›è¡Œé‡è¯•ï¼Œè¿™æ ·å¯èƒ½è¿˜é™ä½äº†æ€§èƒ½ï¼Œè¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ã€Šofferæ¥äº†ã€‹è§£é‡Š:
ä¹è§‚é”é‡‡ç”¨ä¹è§‚çš„æ€æƒ³å¤„ç†æ•°æ®ï¼Œåœ¨æ¯æ¬¡è¯»å–æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹è¯¥æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†åœ¨æ›´æ–°æ—¶ä¼šåˆ¤æ–­åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰æ›´æ–°è¯¥æ•°æ®ï¼Œé€šå¸¸é‡‡ç”¨åœ¨å†™æ—¶å…ˆè¯»å‡ºå½“å‰ç‰ˆæœ¬å·ç„¶ååŠ é”çš„æ–¹æ³•ã€‚å…·ä½“è¿‡ç¨‹ä¸ºï¼šæ¯”è¾ƒå½“å‰ç‰ˆæœ¬å·ä¸ä¸Šä¸€æ¬¡çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸€è‡´ï¼Œåˆ™æ›´æ–°ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåˆ™é‡å¤è¿›è¡Œè¯»ã€æ¯”è¾ƒã€å†™æ“ä½œã€‚Javaä¸­çš„ä¹è§‚é”å¤§éƒ¨åˆ†æ˜¯é€šè¿‡CASï¼ˆCompare And Swapï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼‰æ“ä½œå®ç°çš„ï¼ŒCASæ˜¯ä¸€ç§åŸå­æ›´æ–°æ“ä½œï¼Œåœ¨å¯¹æ•°æ®æ“ä½œä¹‹å‰é¦–å…ˆä¼šæ¯”è¾ƒå½“å‰å€¼è·Ÿä¼ å…¥çš„å€¼æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·åˆ™æ›´æ–°ï¼Œå¦åˆ™ä¸æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œç›´æ¥è¿”å›å¤±è´¥çŠ¶æ€ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‹“å±•ï¼šè‡ªæ—‹é”</p><p><code>è‡ªæ—‹é”</code>æ˜¯æŒ‡çº¿ç¨‹åœ¨æ²¡æœ‰è·å¾—é”æ—¶ä¸æ˜¯è¢«ç›´æ¥æŒ‚èµ·ï¼Œè€Œæ˜¯æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯ï¼Œè¿™ä¸ªå¿™å¾ªç¯å°±æ˜¯æ‰€è°“çš„è‡ªæ—‹ã€‚</p><figure><img src="`+En+`" alt="image-20220614225609663" tabindex="0" loading="lazy"><figcaption>image-20220614225609663</figcaption></figure><p>è‡ªæ—‹é”çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘çº¿ç¨‹è¢«æŒ‚èµ·çš„å‡ ç‡ï¼Œå› ä¸ºçº¿ç¨‹çš„æŒ‚èµ·å’Œå”¤é†’ä¹Ÿéƒ½æ˜¯è€—èµ„æºçš„æ“ä½œã€‚</p><p>å¦‚æœé”è¢«å¦ä¸€ä¸ªçº¿ç¨‹å ç”¨çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå³ä½¿è‡ªæ—‹äº†ä¹‹åå½“å‰çº¿ç¨‹è¿˜æ˜¯ä¼šè¢«æŒ‚èµ·ï¼Œå¿™å¾ªç¯å°±ä¼šå˜æˆæµªè´¹ç³»ç»Ÿèµ„æºçš„æ“ä½œï¼Œåè€Œé™ä½äº†æ•´ä½“æ€§èƒ½ã€‚å› æ­¤è‡ªæ—‹é”æ˜¯ä¸é€‚åº”é”å ç”¨æ—¶é—´é•¿çš„å¹¶å‘æƒ…å†µçš„ã€‚</p><p>åœ¨ Java ä¸­ï¼Œ<code>AtomicInteger</code> ç±»æœ‰è‡ªæ—‹çš„æ“ä½œï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAddInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> v<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        v <span class="token operator">=</span> <span class="token function">getIntVolatile</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> v<span class="token punctuation">,</span> v <span class="token operator">+</span> delta<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CAS æ“ä½œå¦‚æœå¤±è´¥å°±ä¼šä¸€ç›´å¾ªç¯è·å–å½“å‰ value å€¼ç„¶åé‡è¯•ã€‚</p><p>å¦å¤–è‡ªé€‚åº”è‡ªæ—‹é”ä¹Ÿéœ€è¦äº†è§£ä¸€ä¸‹ã€‚</p><p>åœ¨JDK1.6åˆå¼•å…¥äº†è‡ªé€‚åº”è‡ªæ—‹ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒæ™ºèƒ½äº†ï¼Œè‡ªæ—‹æ—¶é—´ä¸å†å›ºå®šï¼Œç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´ä»¥åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœè™šæ‹Ÿæœºè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸé‚£å°±ä¼šæŒç»­è¾ƒå¤šçš„æ—¶é—´ï¼Œå¦‚æœè‡ªæ—‹å¾ˆå°‘æˆåŠŸï¼Œé‚£ä»¥åå¯èƒ½å°±ç›´æ¥çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ã€Šofferæ¥äº†ã€‹è§£é‡Š:
è‡ªæ—‹é”è®¤ä¸ºï¼šå¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…é‡Šæ”¾é”èµ„æºï¼Œé‚£ä¹ˆé‚£äº›ç­‰å¾…ç«äº‰é”çš„çº¿ç¨‹å°±ä¸éœ€è¦åšå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢è¿›å…¥é˜»å¡ã€æŒ‚èµ·çŠ¶æ€ï¼Œåªéœ€ç­‰ä¸€ç­‰ï¼ˆä¹Ÿå«ä½œè‡ªæ—‹ï¼‰ï¼Œåœ¨ç­‰å¾…æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åå³å¯ç«‹å³è·å–é”ï¼Œè¿™æ ·å°±é¿å…äº†ç”¨æˆ·çº¿ç¨‹åœ¨å†…æ ¸çŠ¶æ€çš„åˆ‡æ¢ä¸Šå¯¼è‡´çš„é”æ—¶é—´æ¶ˆè€—ã€‚çº¿ç¨‹åœ¨è‡ªæ—‹æ—¶ä¼šå ç”¨CPUï¼Œåœ¨çº¿ç¨‹é•¿æ—¶é—´è‡ªæ—‹è·å–ä¸åˆ°é”æ—¶ï¼Œå°†ä¼šäº§CPUçš„æµªè´¹ï¼Œç”šè‡³æœ‰æ—¶çº¿ç¨‹æ°¸è¿œæ— æ³•è·å–é”è€Œå¯¼è‡´CPUèµ„æºè¢«æ°¸ä¹…å ç”¨ï¼Œæ‰€ä»¥éœ€è¦è®¾å®šä¸€ä¸ªè‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´ã€‚åœ¨çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´è¶…è¿‡è‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´åï¼Œçº¿ç¨‹ä¼šé€€å‡ºè‡ªæ—‹æ¨¡å¼å¹¶é‡Šæ”¾å…¶æŒæœ‰çš„é”ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="çº¿ç¨‹æ± å‚æ•°-å·¥ä½œæµç¨‹-é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠ è½½åˆ°çº¿ç¨‹ä¸­" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æ± å‚æ•°-å·¥ä½œæµç¨‹-é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠ è½½åˆ°çº¿ç¨‹ä¸­" aria-hidden="true">#</a> çº¿ç¨‹æ± å‚æ•°ï¼Œå·¥ä½œæµç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ€ä¹ˆåŠ è½½åˆ°çº¿ç¨‹ä¸­ï¼Ÿ</h3><p><strong>å‚æ•°</strong></p><hr><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                              <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                              <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                              <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                              <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>corePoolSize</code> çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äº corePoolSize, å³ä½¿æœ‰å…¶ä»–ç©ºé—²çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡, ä¹Ÿä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°ä¸º corePoolSizeï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡è¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„ prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚</li><li><code>workQueue</code> ç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—. åœ¨ JDK ä¸­æä¾›äº†å¦‚ä¸‹é˜»å¡é˜Ÿåˆ—: å…·ä½“å¯ä»¥å‚è€ƒ JUC é›†åˆ: BlockQueue è¯¦è§£ <ul><li><code>ArrayBlockingQueue</code>: åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ FIFO æ’åºä»»åŠ¡ï¼›</li><li><code>LinkedBlockingQuene</code>: åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ FIFO æ’åºä»»åŠ¡ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueneï¼›</li><li><code>SynchronousQuene</code>: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äº LinkedBlockingQueneï¼›</li><li><code>PriorityBlockingQuene</code>: å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li></ul></li></ul><p><code>LinkedBlockingQueue</code>æ¯” <code>ArrayBlockingQueue</code>åœ¨æ’å…¥åˆ é™¤èŠ‚ç‚¹æ€§èƒ½æ–¹é¢æ›´ä¼˜ï¼Œä½†æ˜¯äºŒè€…åœ¨ <code>put()</code>, <code>take()</code>ä»»åŠ¡çš„æ—¶å‡éœ€è¦åŠ é”ï¼Œ<code>SynchronousQueue</code>ä½¿ç”¨æ— é”ç®—æ³•ï¼Œæ ¹æ®èŠ‚ç‚¹çš„çŠ¶æ€åˆ¤æ–­æ‰§è¡Œï¼Œè€Œä¸éœ€è¦ç”¨åˆ°é”ï¼Œå…¶æ ¸å¿ƒæ˜¯ <code>Transfer.transfer()</code>.</p><ul><li><code>maximumPoolSize</code> çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå‰ææ˜¯å½“å‰çº¿ç¨‹æ•°å°äº maximumPoolSizeï¼›å½“é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—, åˆ™ maximumPoolSize åˆ™ä¸èµ·ä½œç”¨, å› ä¸ºæ— æ³•æäº¤è‡³æ ¸å¿ƒçº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šä¸€ç›´æŒç»­åœ°æ”¾å…¥ workQueue.</li><li><code>keepAliveTime</code> çº¿ç¨‹ç©ºé—²æ—¶çš„å­˜æ´»æ—¶é—´ï¼Œå³å½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè¯¥çº¿ç¨‹ç»§ç»­å­˜æ´»çš„æ—¶é—´ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åªåœ¨çº¿ç¨‹æ•°å¤§äº corePoolSize æ—¶æ‰æœ‰ç”¨, è¶…è¿‡è¿™ä¸ªæ—¶é—´çš„ç©ºé—²çº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼›</li><li><code>unit</code> keepAliveTime çš„å•ä½</li><li><code>threadFactory</code> åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„çº¿ç¨‹å·¥å‚å¯ä»¥ç»™æ¯ä¸ªæ–°å»ºçš„çº¿ç¨‹è®¾ç½®ä¸€ä¸ªå…·æœ‰è¯†åˆ«åº¦çš„çº¿ç¨‹åã€‚é»˜è®¤ä¸º DefaultThreadFactory</li><li><code>handler</code> çº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº† 4 ç§ç­–ç•¥: <ul><li><code>AbortPolicy</code>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</li><li><code>CallerRunsPolicy</code>: ç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</li><li><code>DiscardOldestPolicy</code>: ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</li><li><code>DiscardPolicy</code>: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</li></ul></li></ul><p>å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯å®ç° RejectedExecutionHandler æ¥å£ï¼Œè‡ªå®šä¹‰é¥±å’Œç­–ç•¥ï¼Œå¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–å­˜å‚¨ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</p><h3 id="threadlocal-å…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#threadlocal-å…³é”®å­—" aria-hidden="true">#</a> ThreadLocal å…³é”®å­—</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ã€‚<strong>å¦‚æœæƒ³å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</strong> JDK ä¸­æä¾›çš„ <code>ThreadLocal</code>ç±»æ­£æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ <strong><code>ThreadLocal</code>ç±»ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œå¯ä»¥å°† <code>ThreadLocal</code>ç±»å½¢è±¡çš„æ¯”å–»æˆå­˜æ”¾æ•°æ®çš„ç›’å­ï¼Œç›’å­ä¸­å¯ä»¥å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€‚</strong></p><p><strong>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ª <code>ThreadLocal</code>å˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œè¿™ä¹Ÿæ˜¯ <code>ThreadLocal</code>å˜é‡åçš„ç”±æ¥ã€‚ä»–ä»¬å¯ä»¥ä½¿ç”¨ <code>getï¼ˆï¼‰</code> å’Œ <code>setï¼ˆï¼‰</code> æ–¹æ³•æ¥è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</strong></p><p>å†ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>æ¯”å¦‚æœ‰ä¸¤ä¸ªäººå»å®å±‹æ”¶é›†å®ç‰©ï¼Œè¿™ä¸¤ä¸ªå…±ç”¨ä¸€ä¸ªè¢‹å­çš„è¯è‚¯å®šä¼šäº§ç”Ÿäº‰æ‰§ï¼Œä½†æ˜¯ç»™ä»–ä»¬ä¸¤ä¸ªäººæ¯ä¸ªäººåˆ†é…ä¸€ä¸ªè¢‹å­çš„è¯å°±ä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚å¦‚æœæŠŠè¿™ä¸¤ä¸ªäººæ¯”ä½œçº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆ ThreadLocal å°±æ˜¯ç”¨æ¥é¿å…è¿™ä¸¤ä¸ªçº¿ç¨‹ç«äº‰çš„</p><p>å·¥ä½œåŸç†</p><hr><p>å½“ä¸€ä¸ªä»»åŠ¡æäº¤è‡³çº¿ç¨‹æ± ä¹‹å:</p><ol><li>çº¿ç¨‹æ± é¦–å…ˆå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦å°‘äº corePoolSizeã€‚å¦‚æœæ˜¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœéƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™è¿›å…¥ 2.</li><li>åˆ¤æ–­ BlockingQueue æ˜¯å¦å·²ç»æ»¡äº†ï¼Œå€˜è‹¥è¿˜æ²¡æœ‰æ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥ BlockingQueueã€‚å¦åˆ™è¿›å…¥ 3.</li><li>å¦‚æœåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¶…è¿‡ maximumPoolSizeï¼Œåˆ™äº¤ç»™ RejectedExecutionHandler æ¥å¤„ç†ä»»åŠ¡ã€‚</li></ol><p>å½“ ThreadPoolExecutor åˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼Œé€šè¿‡ CAS æ¥æ›´æ–°çº¿ç¨‹æ± çš„çŠ¶æ€ ctl.</p><h3 id="cas-æ˜¯ä»€ä¹ˆ-åŸç†-åŸå­æ€§æ€ä¹ˆä¿è¯" tabindex="-1"><a class="header-anchor" href="#cas-æ˜¯ä»€ä¹ˆ-åŸç†-åŸå­æ€§æ€ä¹ˆä¿è¯" aria-hidden="true">#</a> CAS æ˜¯ä»€ä¹ˆï¼ŒåŸç†ï¼ŒåŸå­æ€§æ€ä¹ˆä¿è¯</h3><p>ä»€ä¹ˆæ˜¯ CASï¼Ÿ</p><hr><p>CASï¼ˆCompare-And-Swapï¼‰æ˜¯ <code>æ¯”è¾ƒå¹¶äº¤æ¢</code>çš„æ„æ€ï¼Œå®ƒæ˜¯ä¸€æ¡ CPU å¹¶å‘åŸè¯­ï¼Œç”¨äºåˆ¤æ–­å†…å­˜ä¸­æŸä¸ªå€¼æ˜¯å¦ä¸ºé¢„æœŸå€¼ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ”¹ä¸ºæ–°çš„å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ <code>åŸå­</code>çš„ã€‚ä¸‹é¢ç”¨ä¸€ä¸ªå°ç¤ºä¾‹è§£é‡Šä¸€ä¸‹ã€‚</p><p>CAS æœºåˆ¶å½“ä¸­ä½¿ç”¨äº† 3 ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€ Vï¼Œæ—§çš„é¢„æœŸå€¼ Aï¼Œè®¡ç®—åè¦ä¿®æ”¹åçš„æ–°å€¼ Bã€‚</p><p>ï¼ˆ1ï¼‰åˆå§‹çŠ¶æ€ï¼šåœ¨å†…å­˜åœ°å€ V ä¸­å­˜å‚¨ç€å˜é‡å€¼ä¸º 1</p><figure><img src="`+On+'" alt="image-20220404201525588" tabindex="0" loading="lazy"><figcaption>image-20220404201525588</figcaption></figure><p>ï¼ˆ2ï¼‰çº¿ç¨‹ 1 æƒ³è¦æŠŠå†…å­˜åœ°å€ä¸º V çš„å˜é‡å€¼å¢åŠ  1ã€‚è¿™ä¸ªæ—¶å€™å¯¹çº¿ç¨‹ 1 æ¥è¯´ï¼Œæ—§çš„é¢„æœŸå€¼ A=1ï¼Œè¦ä¿®æ”¹çš„æ–°å€¼ B=2ã€‚</p><figure><img src="'+Bn+'" alt="image-20220404201536147" tabindex="0" loading="lazy"><figcaption>image-20220404201536147</figcaption></figure><p>ï¼ˆ3ï¼‰åœ¨çº¿ç¨‹ 1 è¦æäº¤æ›´æ–°ä¹‹å‰ï¼Œçº¿ç¨‹ 2 æ·è¶³å…ˆç™»äº†ï¼Œå·²ç»æŠŠå†…å­˜åœ°å€ V ä¸­çš„å˜é‡å€¼ç‡å…ˆæ›´æ–°æˆäº† 2ã€‚</p><figure><img src="'+Dn+'" alt="image-20220404201544332" tabindex="0" loading="lazy"><figcaption>image-20220404201544332</figcaption></figure><p>ï¼ˆ4ï¼‰çº¿ç¨‹ 1 å¼€å§‹æäº¤æ›´æ–°ï¼Œé¦–å…ˆå°†é¢„æœŸå€¼ A å’Œå†…å­˜åœ°å€ V çš„å®é™…å€¼æ¯”è¾ƒï¼ˆCompareï¼‰ï¼Œå‘ç° A ä¸ç­‰äº V çš„å®é™…å€¼ï¼Œæäº¤å¤±è´¥ã€‚</p><figure><img src="'+zn+'" alt="image-20220404201554850" tabindex="0" loading="lazy"><figcaption>image-20220404201554850</figcaption></figure><p>ï¼ˆ5ï¼‰çº¿ç¨‹ 1 é‡æ–°è·å–å†…å­˜åœ°å€ V çš„å½“å‰å€¼ï¼Œå¹¶é‡æ–°è®¡ç®—æƒ³è¦ä¿®æ”¹çš„æ–°å€¼ã€‚æ­¤æ—¶å¯¹çº¿ç¨‹ 1 æ¥è¯´ï¼ŒA=2ï¼ŒB=3ã€‚è¿™ä¸ªé‡æ–°å°è¯•çš„è¿‡ç¨‹è¢«ç§°ä¸º <code>è‡ªæ—‹</code>ã€‚å¦‚æœå¤šæ¬¡å¤±è´¥ä¼šæœ‰å¤šæ¬¡è‡ªæ—‹ã€‚</p><figure><img src="'+qn+'" alt="image-20220404201603748" tabindex="0" loading="lazy"><figcaption>image-20220404201603748</figcaption></figure><p>ï¼ˆ6ï¼‰çº¿ç¨‹ 1 å†æ¬¡æäº¤æ›´æ–°ï¼Œè¿™ä¸€æ¬¡æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜åœ°å€ V çš„å€¼ã€‚çº¿ç¨‹ 1 è¿›è¡Œ Compareï¼Œå‘ç°é¢„æœŸå€¼ A å’Œå†…å­˜åœ°å€ V çš„å®é™…å€¼æ˜¯ç›¸ç­‰çš„ï¼Œè¿›è¡Œ Swap æ“ä½œï¼Œå°†å†…å­˜åœ°å€ V çš„å®é™…å€¼ä¿®æ”¹ä¸º Bã€‚</p><figure><img src="'+jn+`" alt="image-20220404201608058" tabindex="0" loading="lazy"><figcaption>image-20220404201608058</figcaption></figure><p>æ€»ç»“ï¼šæ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼ A å’Œå†…å­˜åœ°å€ V ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€ V å¯¹åº”çš„å€¼ä¿®æ”¹ä¸º Bï¼Œè¿™æ•´ä¸ªæ“ä½œå°±æ˜¯ <code>CAS</code>ã€‚</p><p>CAS åŸºæœ¬åŸç†</p><hr><p>CAS ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ“ä½œï¼š<code>Compare</code>å’Œ <code>Swap</code>ï¼Œæœ‰äººå¯èƒ½è¦é—®äº†ï¼šä¸¤ä¸ªæ“ä½œèƒ½ä¿è¯æ˜¯åŸå­æ€§å—ï¼Ÿå¯ä»¥çš„ã€‚</p><p>CAS æ˜¯ä¸€ç§ <code>ç³»ç»ŸåŸè¯­</code>ï¼ŒåŸè¯­å±äºæ“ä½œç³»ç»Ÿç”¨è¯­ï¼ŒåŸè¯­ç”±è‹¥å¹²æŒ‡ä»¤ç»„æˆï¼Œç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´ CAS æ˜¯ä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ï¼Œç”±æ“ä½œç³»ç»Ÿç¡¬ä»¶æ¥ä¿è¯ã€‚</p><blockquote><p>åœ¨ Intel çš„ CPU ä¸­ï¼Œä½¿ç”¨ cmpxchg æŒ‡ä»¤ã€‚</p></blockquote><p>å›åˆ° Java è¯­è¨€ï¼ŒJDK æ˜¯åœ¨ 1.5 ç‰ˆæœ¬åæ‰å¼•å…¥ CAS æ“ä½œï¼Œåœ¨ <code>sun.misc.Unsafe</code>è¿™ä¸ªç±»ä¸­å®šä¹‰äº† CAS ç›¸å…³çš„æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token class-name">Object</span> expected<span class="token punctuation">,</span> <span class="token class-name">Object</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> expected<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapLong</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">long</span> expected<span class="token punctuation">,</span> <span class="token keyword">long</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æ–¹æ³•è¢«å£°æ˜ä¸º <code>native</code>ï¼Œå¦‚æœå¯¹ C++ æ¯”è¾ƒç†Ÿæ‚‰å¯ä»¥è‡ªè¡Œä¸‹è½½ OpenJDK çš„æºç æŸ¥çœ‹ unsafe.cppï¼Œè¿™é‡Œä¸å†å±•å¼€åˆ†æã€‚</p><p>CAS åœ¨ Java è¯­è¨€ä¸­çš„åº”ç”¨ï¼š</p><p>åœ¨ Java ç¼–ç¨‹ä¸­æˆ‘ä»¬é€šå¸¸ä¸ä¼šç›´æ¥ä½¿ç”¨åˆ° CASï¼Œéƒ½æ˜¯é€šè¿‡ JDK å°è£…å¥½çš„å¹¶å‘å·¥å…·ç±»æ¥é—´æ¥ä½¿ç”¨çš„ï¼Œè¿™äº›å¹¶å‘å·¥å…·ç±»éƒ½åœ¨ <code>java.util.concurrent</code>åŒ…ä¸­ã€‚</p><p><code>J.U.C æ˜¯</code>java.util.concurrent <code>çš„ç®€ç§°ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ Java å¹¶å‘ç¼–ç¨‹å·¥å…·åŒ…ï¼Œé¢è¯•å¸¸è€ƒï¼Œéå¸¸éå¸¸é‡è¦ã€‚</code></p><p>ç›®å‰ CAS åœ¨ JDK ä¸­ä¸»è¦åº”ç”¨åœ¨ J.U.C åŒ…ä¸‹çš„ Atomic ç›¸å…³ç±»ä¸­ã€‚</p><figure><img src="`+Hn+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ¯”å¦‚è¯´ AtomicInteger ç±»å°±å¯ä»¥è§£å†³ i++ éåŸå­æ€§é—®é¢˜ï¼Œé€šè¿‡æŸ¥çœ‹æºç å¯ä»¥å‘ç°ä¸»è¦æ˜¯é  volatile å…³é”®å­—å’Œ CAS æ“ä½œæ¥å®ç°ï¼Œå…·ä½“åŸç†å’Œæºç åˆ†æåé¢çš„æ–‡ç« ä¼šå±•å¼€åˆ†æã€‚</p><p>=<mark><mark><mark><mark><mark><mark><mark><mark><mark><mark>åŸç†çš„ç²¾ç®€å›ç­”</mark></mark></mark></mark></mark></mark></mark></mark></mark></mark>===========</p><p>CAS å«åš CompareAndSwapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œä¸»è¦æ˜¯é€šè¿‡å¤„ç†å™¨çš„æŒ‡ä»¤æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><ol><li>å˜é‡å†…å­˜åœ°å€ï¼ŒV è¡¨ç¤º</li><li>æ—§çš„é¢„æœŸå€¼ï¼ŒA è¡¨ç¤º</li><li>å‡†å¤‡è®¾ç½®çš„æ–°å€¼ï¼ŒB è¡¨ç¤º</li></ol><p>å½“æ‰§è¡Œ CAS æŒ‡ä»¤æ—¶ï¼Œåªæœ‰å½“ V ç­‰äº A æ—¶ï¼Œæ‰ä¼šç”¨ B å»æ›´æ–° V çš„å€¼ï¼Œå¦åˆ™å°±ä¸ä¼šæ‰§è¡Œæ›´æ–°æ“ä½œã€‚</p><p>åªèƒ½ä¿è¯å•ä¸ªå˜é‡çš„åŸå­æ€§</p><hr><p>å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ CAS æ¥ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¦‚æœè¦å¯¹å¤šä¸ªå…±äº«å˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼ŒCAS æ˜¯æ— æ³•ä¿è¯åŸå­æ€§çš„ï¼Œæ¯”å¦‚éœ€è¦å°† i å’Œ j åŒæ—¶åŠ  1ï¼š</p><p>i++ï¼›j++ï¼›</p><p>è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ synchronized è¿›è¡ŒåŠ é”ï¼Œæœ‰æ²¡æœ‰å…¶ä»–åŠæ³•å‘¢ï¼Ÿæœ‰ï¼Œå°†å¤šä¸ªå˜é‡æ“ä½œåˆæˆä¸€ä¸ªå˜é‡æ“ä½œã€‚ä» JDK1.5 å¼€å§‹æä¾›äº† <code>AtomicReference</code> ç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œã€‚</p><h3 id="jmm-æ˜¯ä»€ä¹ˆ-jmm-å†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#jmm-æ˜¯ä»€ä¹ˆ-jmm-å†…å­˜æ¨¡å‹" aria-hidden="true">#</a> JMM æ˜¯ä»€ä¹ˆï¼Ÿ / JMM å†…å­˜æ¨¡å‹ï¼Ÿ</h3><p>JMM æŒ‡çš„æ˜¯ Java å†…å­˜æ¨¡å‹ ï¼ŒJava å†…å­˜æ¨¡å‹æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Œå°±æ¯”å¦‚è¯´çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å¿…é¡»å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚Java å†…å­˜æ¨¡å‹ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å±è”½ç³»ç»Ÿå’Œç¡¬ä»¶çš„å·®å¼‚ï¼Œé¿å…ä¸€å¥—ä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸‹äº§ç”Ÿçš„æ•ˆæœä¸ä¸€è‡´ã€‚</p><p>åœ¨ JDK1.2 ä¹‹å‰ï¼ŒJava çš„å†…å­˜æ¨¡å‹å®ç°æ€»æ˜¯ä»<strong>ä¸»å­˜</strong>ï¼ˆå³å…±äº«å†…å­˜ï¼‰è¯»å–å˜é‡ï¼Œæ˜¯ä¸éœ€è¦è¿›è¡Œç‰¹åˆ«çš„æ³¨æ„çš„ã€‚è€Œåœ¨å½“å‰çš„ Java å†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜<strong>æœ¬åœ°å†…å­˜</strong>ï¼ˆæ¯”å¦‚æœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å†™ã€‚è¿™å°±å¯èƒ½é€ æˆä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿˜ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆ<strong>æ•°æ®çš„ä¸ä¸€è‡´</strong>ã€‚</p><blockquote><ul><li><strong>ä¸»å†…å­˜</strong> ï¼šæ‰€æœ‰çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œä¸ç®¡è¯¥å®ä¾‹å¯¹è±¡æ˜¯æˆå‘˜å˜é‡è¿˜æ˜¯æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡(ä¹Ÿç§°å±€éƒ¨å˜é‡)</li><li><strong>æœ¬åœ°å†…å­˜</strong> ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜æ¥å­˜å‚¨å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œæ— æ³•è®¿é—®å…¶ä»–çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå­˜å‚¨äº†ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬ã€‚</li></ul></blockquote><figure><img src="'+Fn+'" alt="image-20220404202341804" tabindex="0" loading="lazy"><figcaption>image-20220404202341804</figcaption></figure><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æŠŠå˜é‡å£°æ˜ä¸º <strong><code>volatile</code></strong> ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong><code>volatile</code> å…³é”®å­— é™¤äº†é˜²æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨å°±æ˜¯ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚</strong></p><figure><img src="'+Jn+'" alt="image-20220404202354007" tabindex="0" loading="lazy"><figcaption>image-20220404202354007</figcaption></figure><h3 id="å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹-å¤šçº¿ç¨‹ä¸å•çº¿ç¨‹æ¯”è¾ƒ-cpu-å¯†é›†-io-å¯†é›†" tabindex="-1"><a class="header-anchor" href="#å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹-å¤šçº¿ç¨‹ä¸å•çº¿ç¨‹æ¯”è¾ƒ-cpu-å¯†é›†-io-å¯†é›†" aria-hidden="true">#</a> å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹ä¸å•çº¿ç¨‹æ¯”è¾ƒï¼ˆCPU å¯†é›†ï¼ŒIO å¯†é›†ï¼‰</h3><p>ä»ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­ï¼Œä»»åŠ¡çš„æ€§è´¨(CPU å¯†é›†/ IO å¯†é›†)ï¼Œä»»åŠ¡çš„ä¾èµ–å…³ç³»è¿™å››ä¸ªè§’åº¦æ¥åˆ†æã€‚å¹¶ä¸”è¿‘å¯èƒ½åœ°ä½¿ç”¨æœ‰ç•Œçš„å·¥ä½œé˜Ÿåˆ—ã€‚</p><p>ä»ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¥çœ‹ï¼š</p><p>å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹ç›¸æ¯”ï¼Œä¸¤è€…éƒ½å¯ä»¥é€šè¿‡ä¼˜å…ˆçº§æ¥å®ç°ä¼˜å…ˆçº§è°ƒåº¦ï¼Œä½†æ˜¯ï¼Œå¤šçº¿ç¨‹æ¯”å¤šè¿›ç¨‹æ›´åŠ è½»é‡çº§ï¼Œçº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»£ä»·éƒ½æ¯”è¿›ç¨‹å°ï¼Œå› æ­¤åœ¨ä¸€äº›éœ€è¦é«˜å¹¶å‘å¤„ç†çš„åœºæ™¯ä¸­ï¼Œå¤šçº¿ç¨‹å¾€å¾€æ¯”å¤šè¿›ç¨‹æ›´å…·ä¼˜åŠ¿ã€‚</p><p>ä»ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­æ¥çœ‹ï¼š</p><p>å¯¹äºé•¿æ—¶é—´æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹å¾€å¾€æ¯”å•çº¿ç¨‹æ›´åŠ åˆé€‚ï¼Œå› ä¸ºå¤šçº¿ç¨‹å¯ä»¥å°†ä»»åŠ¡åˆ†è§£æˆè‹¥å¹²ä¸ªå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ã€‚è€Œå¤šè¿›ç¨‹åˆ™éœ€è¦æ›´å¤šçš„è¿›ç¨‹é—´é€šä¿¡å’Œæ•°æ®å…±äº«ï¼Œè¿™å¢åŠ äº†è¿›ç¨‹é—´çš„å¼€é”€å’Œå¤æ‚åº¦ã€‚</p><p>ä»ä»»åŠ¡çš„æ€§è´¨ï¼ˆCPU å¯†é›†/IO å¯†é›†ï¼‰æ¥çœ‹ï¼š</p><p>å¯¹äº CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹å¾€å¾€èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸ CPU çš„ä¼˜åŠ¿ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è€Œå¯¹äº I/O å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹å¾€å¾€ä¼šå› ä¸ºç­‰å¾… I/O æ“ä½œè€Œæµªè´¹ CPU èµ„æºï¼Œæ­¤æ—¶å¤šè¿›ç¨‹å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ CPU èµ„æºï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ CPU æ—¶é—´ç‰‡ã€‚</p><p>ä»ä»»åŠ¡çš„ä¾èµ–å…³ç³»æ¥çœ‹ï¼š</p><p>å¯¹äºæœ‰ä¾èµ–å…³ç³»çš„ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹å¯ä»¥é€šè¿‡çº¿ç¨‹é—´çš„åŒæ­¥å’Œåä½œæ¥å®Œæˆä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè€Œå¤šè¿›ç¨‹åˆ™éœ€è¦é€šè¿‡è¿›ç¨‹é—´é€šä¿¡æ¥å®Œæˆä»»åŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å› æ­¤ï¼Œå¯¹äºä¾èµ–å…³ç³»æ¯”è¾ƒç®€å•çš„ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹æ›´åŠ é€‚åˆï¼Œè€Œå¯¹äºä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚çš„ä»»åŠ¡ï¼Œå¤šè¿›ç¨‹åˆ™å¯èƒ½æ›´åŠ é€‚åˆã€‚</p><h3 id="ä»‹ç»ä¸€ä¸‹-java-ä¸åŒå±‚é¢çš„é”-2022-04-11-æºç¨‹" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»ä¸€ä¸‹-java-ä¸åŒå±‚é¢çš„é”-2022-04-11-æºç¨‹" aria-hidden="true">#</a> ä»‹ç»ä¸€ä¸‹ Java ä¸åŒå±‚é¢çš„é”ï¼ˆ2022-04-11 æºç¨‹ï¼‰</h3><p>JVM å±‚é¢ä¸ JDK å±‚é¢ï¼Œå°±æ˜¯ synchronized+Lockï¼Œä¼˜ç¼ºç‚¹ã€å¯¹æ¯”ã€AQS</p><p>Java ä¸­çš„é”å¯ä»¥åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œä» JVM å±‚é¢å’Œ JDK å±‚é¢æ¥ä»‹ç»ä¸åŒå±‚æ¬¡çš„é”ï¼š</p><ol><li>JVM å±‚é¢çš„é”ï¼š JVM æä¾›äº†å†…ç½®é”ï¼ˆä¹Ÿç§°ä¸ºç›‘è§†å™¨é”ï¼‰å’Œè½»é‡çº§é”ã€‚å†…ç½®é”æ˜¯ Java ä¸­æœ€å¸¸è§çš„é”ï¼Œå®ƒåŸºäºäº’æ–¥é‡çš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨ synchronized å…³é”®å­—æ¥è·å–å’Œé‡Šæ”¾é”ã€‚è½»é‡çº§é”åˆ™æ˜¯ä¸ºäº†åœ¨å¹¶å‘åœºæ™¯ä¸‹å‡å°‘é”ç«äº‰è€Œæä¾›çš„ä¸€ç§ä¼˜åŒ–ï¼Œå®ƒåœ¨ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µä¸‹ä½¿ç”¨ CAS æ“ä½œï¼ˆCompare-And-Swapï¼‰æ¥è¿›è¡ŒåŠ é”å’Œè§£é”ï¼Œé¿å…äº†äº’æ–¥é‡çš„å¼€é”€ã€‚</li><li>JDK å±‚é¢çš„é”ï¼š JDK æä¾›äº†å¤šç§é”ï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</li></ol><ul><li>ReentrantLockï¼šé‡å…¥é”ï¼Œå¯é‡å…¥ã€å¯ä¸­æ–­ã€å¯é™æ—¶ã€å¯å…¬å¹³æˆ–éå…¬å¹³è·å–é”ã€‚</li><li>ReadWriteLockï¼šè¯»å†™é”ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œä½†åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥å…±äº«èµ„æºã€‚</li></ul><p>ä»¥ä¸‹æ˜¯å„ç§é”çš„ä¼˜ç¼ºç‚¹å’Œå¯¹æ¯”ï¼š</p><ol><li>å†…ç½®é” ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå…·æœ‰å¾ˆå¥½çš„äº’æ–¥æ€§å’Œå¯è§æ€§ã€‚ ç¼ºç‚¹ï¼šç«äº‰æ¿€çƒˆæ—¶æ€§èƒ½è¾ƒå·®ï¼Œæ²¡æœ‰å¯ä¸­æ–­ã€å¯é™æ—¶ç­‰é«˜çº§ç‰¹æ€§ã€‚</li><li>è½»é‡çº§é” ä¼˜ç‚¹ï¼šå¯¹äºç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µï¼Œæ€§èƒ½æ¯”å†…ç½®é”è¦å¥½ã€‚ ç¼ºç‚¹ï¼šç«äº‰æ¿€çƒˆæ—¶æ€§èƒ½è¾ƒå·®ï¼Œå¯¹é”çš„çŠ¶æ€è½¬æ¢éœ€è¦é¢å¤–çš„å¼€é”€ã€‚</li><li>ReentrantLock ä¼˜ç‚¹ï¼šæ”¯æŒå¯é‡å…¥ã€å¯ä¸­æ–­ã€å¯é™æ—¶ã€å¯å…¬å¹³æˆ–éå…¬å¹³è·å–é”ï¼Œç›¸å¯¹äºå†…ç½®é”å…·æœ‰æ›´å¥½çš„çµæ´»æ€§å’Œå¯æ§æ€§ã€‚ ç¼ºç‚¹ï¼šä½¿ç”¨å¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä½¿ç”¨ä¸å½“å®¹æ˜“å‡ºç°æ­»é”æˆ–è€…é¥¥é¥¿é—®é¢˜ï¼Œæ€§èƒ½ç¨å·®äºå†…ç½®é”ã€‚</li><li>ReadWriteLock ä¼˜ç‚¹ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚ ç¼ºç‚¹ï¼šå†™å…¥æ“ä½œéœ€è¦æ’ä»–è®¿é—®ï¼Œå¯èƒ½å‡ºç°é¥¥é¥¿é—®é¢˜ï¼Œè¯»å†™é”çš„å®ç°ç›¸å¯¹å¤æ‚ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</li></ol><p>åœ¨ä¸€äº›ä½å¹¶å‘ã€æ— éœ€çµæ´»æ§åˆ¶çš„åœºæ™¯ä¸‹ï¼Œå†…ç½®é”æ˜¯æœ€ç®€å•å’Œé«˜æ•ˆçš„é€‰æ‹©ï¼›åœ¨ä¸€äº›éœ€è¦çµæ´»æ§åˆ¶å¹¶å‘ã€å®ç°é«˜çº§ç‰¹æ€§çš„åœºæ™¯ä¸‹ï¼ŒReentrantLock æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼›åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹ï¼ŒReadWriteLock å¯ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚</p><h3 id="synchronized-æœ‰äº†ä¸ºä»€ä¹ˆè¿˜è¦-reentranlock-æœ‰å•¥ä¸ä¸€æ ·-shopline" tabindex="-1"><a class="header-anchor" href="#synchronized-æœ‰äº†ä¸ºä»€ä¹ˆè¿˜è¦-reentranlock-æœ‰å•¥ä¸ä¸€æ ·-shopline" aria-hidden="true">#</a> synchronized æœ‰äº†ä¸ºä»€ä¹ˆè¿˜è¦ ReentranLock ï¼Œæœ‰å•¥ä¸ä¸€æ ·ï¼Ÿï¼ˆshoplineï¼‰</h3><p>ä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é”</p><p><strong>â€œå¯é‡å…¥é”â€</strong> æŒ‡çš„æ˜¯è‡ªå·±å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„ï¼Œå¦‚æœæ˜¯ä¸å¯é‡å…¥é”çš„è¯ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚åŒä¸€ä¸ªçº¿ç¨‹æ¯æ¬¡è·å–é”ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢ 1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º 0 æ—¶æ‰èƒ½é‡Šæ”¾é”ã€‚</p><p>synchronized ä¾èµ–äº JVM è€Œ ReentrantLock ä¾èµ–äº API</p><p><code>synchronized</code> æ˜¯ä¾èµ–äº JVM å®ç°çš„ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè®²åˆ°äº† è™šæ‹Ÿæœºå›¢é˜Ÿåœ¨ JDK1.6 ä¸º <code>synchronized</code> å…³é”®å­—è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä½†æ˜¯è¿™äº›ä¼˜åŒ–éƒ½æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼Œå¹¶æ²¡æœ‰ç›´æ¥æš´éœ²ç»™æˆ‘ä»¬ã€‚<code>ReentrantLock</code> æ˜¯ JDK å±‚é¢å®ç°çš„ï¼ˆä¹Ÿå°±æ˜¯ API å±‚é¢ï¼Œéœ€è¦ lock() å’Œ unlock() æ–¹æ³•é…åˆ try/finally è¯­å¥å—æ¥å®Œæˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å®ƒçš„æºä»£ç ï¼Œæ¥çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>ReentrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½</p><p>ç›¸æ¯” <code>synchronized</code>ï¼Œ<code>ReentrantLock</code>å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ä¸»è¦æ¥è¯´ä¸»è¦æœ‰ä¸‰ç‚¹ï¼š</p><ul><li><strong>ç­‰å¾…å¯ä¸­æ–­</strong> : <code>ReentrantLock</code>æä¾›äº†ä¸€ç§èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡ <code>lock.lockInterruptibly()</code> æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚</li><li><strong>å¯å®ç°å…¬å¹³é”</strong> : <code>ReentrantLock</code>å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚è€Œ <code>synchronized</code>åªèƒ½æ˜¯éå…¬å¹³é”ã€‚æ‰€è°“çš„å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚<code>ReentrantLock</code>é»˜è®¤æƒ…å†µæ˜¯éå…¬å¹³çš„ï¼Œå¯ä»¥é€šè¿‡ <code>ReentrantLock</code>ç±»çš„ <code>ReentrantLock(boolean fair)</code>æ„é€ æ–¹æ³•æ¥åˆ¶å®šæ˜¯å¦æ˜¯å…¬å¹³çš„ã€‚</li><li><strong>å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰</strong>: <code>synchronized</code>å…³é”®å­—ä¸ <code>wait()</code>å’Œ <code>notify()</code>/<code>notifyAll()</code>æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚<code>ReentrantLock</code>ç±»å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äº <code>Condition</code>æ¥å£ä¸ <code>newCondition()</code>æ–¹æ³•ã€‚</li></ul><blockquote><p><code>Condition</code>æ˜¯ JDK1.5 ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ª <code>Lock</code>å¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ª <code>Condition</code>å®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§†å™¨ï¼‰ï¼Œ<strong>çº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„ <code>Condition</code>ä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµæ´»ã€‚ åœ¨ä½¿ç”¨ <code>notify()/notifyAll()</code>æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œç”¨ <code>ReentrantLock</code>ç±»ç»“åˆ <code>Condition</code>å®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€</strong> ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯ Condition æ¥å£é»˜è®¤æä¾›çš„ã€‚è€Œ <code>synchronized</code>å…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ª Lock å¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ª <code>Condition</code>å®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒä¸€ä¸ªèº«ä¸Šã€‚å¦‚æœæ‰§è¡Œ <code>notifyAll()</code>æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ï¼Œè€Œ <code>Condition</code>å®ä¾‹çš„ <code>signalAll()</code>æ–¹æ³• åªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥ <code>Condition</code>å®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚</p></blockquote><p><strong>å¦‚æœä½ æƒ³ä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œé‚£ä¹ˆé€‰æ‹© ReentrantLock æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æ€§èƒ½å·²ä¸æ˜¯é€‰æ‹©æ ‡å‡†</strong></p><h3 id="synchronizedå®ç°ç­‰å¾…å”¤é†’æœºåˆ¶-shopline" tabindex="-1"><a class="header-anchor" href="#synchronizedå®ç°ç­‰å¾…å”¤é†’æœºåˆ¶-shopline" aria-hidden="true">#</a> synchronizedå®ç°ç­‰å¾…å”¤é†’æœºåˆ¶(shopline)</h3>',179),yp={href:"https://blog.csdn.net/it_lihongmin/article/details/109230696",target:"_blank",rel:"noopener noreferrer"},wp=t('<blockquote><p>ç­‰å¾…å”¤é†’æœºåˆ¶ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå¤šï¼Œ<code>ä¸€ä¸ªå®Œæ•´çš„ç­‰å¾…å”¤é†’æœºåˆ¶è¿‡ç¨‹ï¼šçº¿ç¨‹é¦–å…ˆè·å–äº’æ–¥é”ï¼Œå½“çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶é‡Šæ”¾äº’æ–¥é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“è¦æ±‚çš„æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ï¼Œé‡æ–°è·å–äº’æ–¥é”</code>ã€‚ç›´æ¥åœ¨å¹¶å‘ç¼–ç¨‹æ¨¡å¼ - Guarded Suspensionè®¾è®¡æ¨¡å¼ä¸­ä½¿ç”¨ReentrantLock+Conditionå®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¹Ÿåˆ†æäº† Dubboçš„å¼‚æ­¥è¯·æ±‚Apiçš„å¼‚æ­¥è½¬åŒæ­¥çš„è¿‡ç¨‹ã€‚<code>Objectçš„ waitã€notifyã€notifyAll</code>æ–¹æ³•éœ€è¦é…åˆsynchronizedä½¿ç”¨ï¼Œå³åœ¨å…¶å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å†™æ³•åŸºæœ¬å›ºå®šã€‚å¦‚æœåœ¨synchronizedå¤–éƒ¨è°ƒç”¨ waitæ–¹æ³•ç­‰ï¼Œåˆ™ä¼šæŠ¥ java.lang.IllegalMonitorStateExceptionã€‚</p></blockquote><figure><img src="'+Un+'" alt="image-20220610095635066" tabindex="0" loading="lazy"><figcaption>image-20220610095635066</figcaption></figure><figure><img src="'+Kn+`" alt="image-20220610095709053" tabindex="0" loading="lazy"><figcaption>image-20220610095709053</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Allocator</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> als<span class="token punctuation">;</span>
  <span class="token comment">// ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº</span>
  <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span>
    <span class="token class-name">Object</span> from<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ç»å…¸å†™æ³•</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>als<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">||</span>
         als<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token punctuation">}</span>   
    <span class="token punctuation">}</span> 
    als<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
    als<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
  <span class="token comment">// å½’è¿˜èµ„æº</span>
  <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">free</span><span class="token punctuation">(</span>
    <span class="token class-name">Object</span> from<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    als<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
    als<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="atomicç±»åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#atomicç±»åº•å±‚åŸç†" aria-hidden="true">#</a> Atomicç±»åº•å±‚åŸç†</h3><p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ CAS (compare and swap) + volatile å’Œ nativeæ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p><p>AtomicåŸå­ç±»åº•å±‚ç”¨çš„ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯æ— é”åŒ–çš„CASæœºåˆ¶ï¼Œé€šè¿‡CASæœºåˆ¶ä¿è¯å¤šçº¿ç¨‹ä¿®æ”¹ä¸€ä¸ªæ•°å€¼çš„å®‰å…¨æ€§</p><h3 id="è®²è®²synchronized" tabindex="-1"><a class="header-anchor" href="#è®²è®²synchronized" aria-hidden="true">#</a> è®²è®²<strong>synchronized</strong></h3><p>synchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œæ˜¯ä¸€ç§åŒæ­¥é”ã€‚synchronizedå…³é”®å­—å¯ä»¥ä½œç”¨äºæ–¹æ³•æˆ–è€…ä»£ç å—ã€‚</p><p>ä¸€èˆ¬é¢è¯•æ—¶ã€‚å¯ä»¥è¿™ä¹ˆå›ç­”ï¼š</p><ul><li>åç¼–è¯‘åï¼Œmonitorenterã€monitorexitã€ACC_SYNCHRONIZED</li><li>monitorç›‘è§†å™¨</li><li>Java Monitor çš„å·¥ä½œæœºç†</li><li>å¯¹è±¡ä¸monitorå…³è”</li></ul><p><strong>monitorenterã€monitorexitã€ACC_SYNCHRONIZED</strong></p><p>å¦‚æœ<strong>synchronized</strong>ä½œç”¨äº<strong>ä»£ç å—</strong>ï¼Œåç¼–è¯‘å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæŒ‡ä»¤ï¼š<code>monitorenterã€monitorexit</code>ï¼ŒJVMä½¿ç”¨ <code>monitorenterå’Œmonitorexit</code>ä¸¤ä¸ªæŒ‡ä»¤å®ç°åŒæ­¥ï¼›å¦‚æœsynchronizedä½œç”¨äº<strong>æ–¹æ³•</strong>,åç¼–è¯‘å¯ä»¥çœ‹åˆ° <code>ACCSYNCHRONIZEDæ ‡è®°</code>ï¼ŒJVMé€šè¿‡åœ¨æ–¹æ³•è®¿é—®æ ‡è¯†ç¬¦(flags)ä¸­åŠ å…¥ <code>ACCSYNCHRONIZED</code>æ¥å®ç°åŒæ­¥åŠŸèƒ½ã€‚</p><ul><li>åŒæ­¥ä»£ç å—æ˜¯é€šè¿‡ <code>monitorenterå’Œmonitorexit</code>æ¥å®ç°ï¼Œå½“çº¿ç¨‹æ‰§è¡Œåˆ°monitorenterçš„æ—¶å€™è¦å…ˆè·å¾—monitoré”ï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ–¹æ³•ã€‚å½“çº¿ç¨‹æ‰§è¡Œåˆ°monitorexitçš„æ—¶å€™åˆ™è¦é‡Šæ”¾é”ã€‚</li><li>åŒæ­¥æ–¹æ³•æ˜¯é€šè¿‡ä¸­è®¾ç½® <code>ACCSYNCHRONIZED</code>æ ‡å¿—æ¥å®ç°ï¼Œå½“çº¿ç¨‹æ‰§è¡Œæœ‰ACCSYNCHRONIZEDæ ‡å¿—çš„æ–¹æ³•ï¼Œéœ€è¦è·å¾—monitoré”ã€‚æ¯ä¸ªå¯¹è±¡éƒ½ä¸ä¸€ä¸ªmonitorç›¸å…³è”ï¼Œçº¿ç¨‹å¯ä»¥å æœ‰æˆ–è€…é‡Šæ”¾monitorã€‚</li></ul><p><strong>monitorç›‘è§†å™¨</strong></p><p>monitoræ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ“ä½œç³»ç»Ÿçš„ç®¡ç¨‹ï¼ˆmonitorsï¼‰æ˜¯æ¦‚å¿µåŸç†ï¼ŒObjectMonitoræ˜¯å®ƒçš„åŸç†å®ç°ã€‚</p><figure><img src="`+Qn+`" alt="image-20220618222546298" tabindex="0" loading="lazy"><figcaption>image-20220618222546298</figcaption></figure><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆHotSpotï¼‰ä¸­ï¼ŒMonitorï¼ˆç®¡ç¨‹ï¼‰æ˜¯ç”±ObjectMonitorå®ç°çš„ï¼Œå…¶ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> ObjectMonitor() {
    _header       = NULL;
    _count        = 0; // è®°å½•ä¸ªæ•°
    _waiters      = 0,
    _recursions   = 0;
    _object       = NULL;
    _owner        = NULL;
    _WaitSet      = NULL;  // å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet
    _WaitSetLock  = 0 ;
    _Responsible  = NULL ;
    _succ         = NULL ;
    _cxq          = NULL ;
    FreeNext      = NULL ;
    _EntryList    = NULL ;  // å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨
    _SpinFreq     = 0 ;
    _SpinClock    = 0 ;
    OwnerIsThread = 0 ;
  }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ObjectMonitorä¸­å‡ ä¸ªå…³é”®å­—æ®µçš„å«ä¹‰å¦‚å›¾æ‰€ç¤ºï¼š</p><figure><img src="`+Vn+'" alt="image-20220618222556764" tabindex="0" loading="lazy"><figcaption>image-20220618222556764</figcaption></figure><p><strong>Java Monitor çš„å·¥ä½œæœºç†</strong></p><figure><img src="'+Gn+'" alt="image-20220618222606838" tabindex="0" loading="lazy"><figcaption>image-20220618222606838</figcaption></figure><ul><li>æƒ³è¦è·å–monitorçš„çº¿ç¨‹,é¦–å…ˆä¼šè¿›å…¥_EntryListé˜Ÿåˆ—ã€‚</li><li>å½“æŸä¸ªçº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„monitorå,è¿›å…¥OwneråŒºåŸŸï¼Œè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹,åŒæ—¶è®¡æ•°å™¨countåŠ 1ã€‚</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨äº†wait()æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥WaitSeté˜Ÿåˆ—ã€‚å®ƒä¼šé‡Šæ”¾monitoré”ï¼Œå³å°†ownerèµ‹å€¼ä¸ºnull,countè‡ªå‡1,è¿›å…¥WaitSeté˜Ÿåˆ—é˜»å¡ç­‰å¾…ã€‚</li><li>å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨ notify() / notifyAll() ï¼Œä¼šå”¤é†’WaitSetä¸­çš„æŸä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å†æ¬¡å°è¯•è·å–monitoré”ï¼ŒæˆåŠŸå³è¿›å…¥OwneråŒºåŸŸã€‚</li><li>åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•äº†ï¼Œçº¿ç¨‹é€€å‡ºä¸´ç•ŒåŒºï¼Œä¼šå°†monitorçš„ownerè®¾ä¸ºnullï¼Œå¹¶é‡Šæ”¾ç›‘è§†é”ã€‚</li></ul><p><strong>å¯¹è±¡ä¸monitorå…³è”</strong></p><figure><img src="'+Xn+'" alt="image-20220618222642015" tabindex="0" loading="lazy"><figcaption>image-20220618222642015</figcaption></figure><ul><li>åœ¨HotSpotè™šæ‹Ÿæœºä¸­,å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º3å—åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰ï¼Œå®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹è±¡å¡«å……ï¼ˆPaddingï¼‰</strong>ã€‚</li><li>å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼š<strong>Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Class Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰</strong>ã€‚</li></ul><p>Mark Word æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ã€‚</p><figure><img src="'+Wn+'" alt="image-20220618222700381" tabindex="0" loading="lazy"><figcaption>image-20220618222700381</figcaption></figure><p><strong>é‡é‡çº§é”ï¼ŒæŒ‡å‘äº’æ–¥é‡çš„æŒ‡é’ˆã€‚å…¶å®synchronizedæ˜¯é‡é‡çº§é”ï¼Œä¹Ÿå°±æ˜¯è¯´Synchronizedçš„å¯¹è±¡é”ï¼ŒMark Wordé”æ ‡è¯†ä½ä¸º10ï¼Œå…¶ä¸­æŒ‡é’ˆæŒ‡å‘çš„æ˜¯Monitorå¯¹è±¡çš„èµ·å§‹åœ°å€ã€‚</strong></p><h2 id="ğŸ“‘æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#ğŸ“‘æ•°æ®åº“" aria-hidden="true">#</a> ğŸ“‘æ•°æ®åº“</h2><h3 id="redis-1" tabindex="-1"><a class="header-anchor" href="#redis-1" aria-hidden="true">#</a> Redis</h3><h4 id="ç®€å•ä»‹ç»ä¸€ä¸‹-redis" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»ä¸€ä¸‹-redis" aria-hidden="true">#</a> ç®€å•ä»‹ç»ä¸€ä¸‹ Redis</h4><p>ç®€å•æ¥è¯´ <strong>Redis å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“</strong>ï¼Œä¸è¿‡ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ <strong>Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„</strong> ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚</p><p>å¦å¤–ï¼Œ<strong>Redis é™¤äº†åšç¼“å­˜ä¹‹å¤–ï¼Œä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ï¼Œç”šè‡³æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚</strong></p><p><strong>Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚Redis è¿˜æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</strong></p><h4 id="redis-åŸºæœ¬çš„æ•°æ®ç»“æ„éƒ½æœ‰å“ªäº›-å…·ä½“æ“ä½œå‘½ä»¤æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#redis-åŸºæœ¬çš„æ•°æ®ç»“æ„éƒ½æœ‰å“ªäº›-å…·ä½“æ“ä½œå‘½ä»¤æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> Redis åŸºæœ¬çš„æ•°æ®ç»“æ„éƒ½æœ‰å“ªäº›ï¼Ÿå…·ä½“æ“ä½œå‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>Stringå­—ç¬¦ä¸²</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¿°</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>GET</td><td>è·å–å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼</td><td>GET name</td></tr><tr><td>SET</td><td>è®¾ç½®å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼</td><td>SET name value</td></tr><tr><td>DEL</td><td>åˆ é™¤å­˜å‚¨åœ¨ç»™å®šé”®ä¸­çš„å€¼</td><td>DEL name</td></tr><tr><td>INCR</td><td>å°†é”®å­˜å‚¨çš„å€¼åŠ 1</td><td>INCR key</td></tr><tr><td>DECR</td><td>å°†é”®å­˜å‚¨çš„å€¼å‡1</td><td>DECR key</td></tr><tr><td>INCRBY</td><td>å°†é”®å­˜å‚¨çš„å€¼åŠ ä¸Šæ•´æ•°</td><td>INCRBY key amount</td></tr><tr><td>DECRBY</td><td>å°†é”®å­˜å‚¨çš„å€¼å‡å»æ•´æ•°</td><td>DECRBY key amount</td></tr></tbody></table><ul><li>Liståˆ—è¡¨</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¿°</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>RPUSH</td><td>å°†ç»™å®šå€¼æ¨å…¥åˆ°åˆ—è¡¨å³ç«¯</td><td>RPUSH key value</td></tr><tr><td>LPUSH</td><td>å°†ç»™å®šå€¼æ¨å…¥åˆ°åˆ—è¡¨å·¦ç«¯</td><td>LPUSH key value</td></tr><tr><td>RPOP</td><td>ä»åˆ—è¡¨çš„å³ç«¯å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¢«å¼¹å‡ºçš„å€¼</td><td>RPOP key</td></tr><tr><td>LPOP</td><td>ä»åˆ—è¡¨çš„å·¦ç«¯å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¢«å¼¹å‡ºçš„å€¼</td><td>LPOP key</td></tr><tr><td>LRANGE</td><td>è·å–åˆ—è¡¨åœ¨ç»™å®šèŒƒå›´ä¸Šçš„æ‰€æœ‰å€¼</td><td>LRANGE key 0 -1</td></tr><tr><td>LINDEX</td><td>é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ä¸‹æ ‡ï¼Œä»¥ -1 è¡¨ç¤ºåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ -2 è¡¨ç¤ºåˆ—è¡¨çš„å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚</td><td>LINDEX key index</td></tr></tbody></table><ul><li>Seté›†åˆ</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¿°</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>SADD</td><td>å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td><td>SADD key value</td></tr><tr><td>SCARD</td><td>è·å–é›†åˆçš„æˆå‘˜æ•°</td><td>SCARD key</td></tr><tr><td>SMEMBERS</td><td>è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</td><td>SMEMBERS key member</td></tr><tr><td>SISMEMBER</td><td>åˆ¤æ–­ member å…ƒç´ æ˜¯å¦æ˜¯é›†åˆ key çš„æˆå‘˜</td><td>SISMEMBER key member</td></tr></tbody></table><ul><li>Hashæ•£åˆ—</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¿°</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>HSET</td><td>æ·»åŠ é”®å€¼å¯¹</td><td>HSET hash-key sub-key1 value1</td></tr><tr><td>HGET</td><td>è·å–æŒ‡å®šæ•£åˆ—é”®çš„å€¼</td><td>HGET hash-key key1</td></tr><tr><td>HGETALL</td><td>è·å–æ•£åˆ—ä¸­åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹</td><td>HGETALL hash-key</td></tr><tr><td>HDEL</td><td>å¦‚æœç»™å®šé”®å­˜åœ¨äºæ•£åˆ—ä¸­ï¼Œé‚£ä¹ˆå°±ç§»é™¤è¿™ä¸ªé”®</td><td>HDEL hash-key sub-key1</td></tr></tbody></table><ul><li>Zsetæœ‰åºé›†åˆ</li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç®€è¿°</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>ZADD</td><td>å°†ä¸€ä¸ªå¸¦æœ‰ç»™å®šåˆ†å€¼çš„æˆå‘˜æ·»åŠ åˆ°æœ‰åºé›†åˆé‡Œé¢</td><td>ZADD zset-key 178 member1</td></tr><tr><td>ZRANGE</td><td>æ ¹æ®å…ƒç´ åœ¨æœ‰åºé›†åˆä¸­æ‰€å¤„çš„ä½ç½®ï¼Œä»æœ‰åºé›†åˆä¸­è·å–å¤šä¸ªå…ƒç´ </td><td>ZRANGE zset-key 0-1 withccores</td></tr><tr><td>ZREM</td><td>å¦‚æœç»™å®šå…ƒç´ æˆå‘˜å­˜åœ¨äºæœ‰åºé›†åˆä¸­ï¼Œé‚£ä¹ˆå°±ç§»é™¤è¿™ä¸ªå…ƒç´ </td><td>ZREM zset-key member1</td></tr></tbody></table><h4 id="redis-åŸºæœ¬æ•°æ®ç»“æ„çš„åº•å±‚å®ç°åŸç†æœ‰äº†è§£å—" tabindex="-1"><a class="header-anchor" href="#redis-åŸºæœ¬æ•°æ®ç»“æ„çš„åº•å±‚å®ç°åŸç†æœ‰äº†è§£å—" aria-hidden="true">#</a> Redis åŸºæœ¬æ•°æ®ç»“æ„çš„åº•å±‚å®ç°åŸç†æœ‰äº†è§£å—ï¼Ÿ</h4><figure><img src="'+Yn+'" alt="image-20220614142936584" tabindex="0" loading="lazy"><figcaption>image-20220614142936584</figcaption></figure>',49),Cp={href:"https://www.pdai.tech/md/db/nosql-redis/db-redis-x-redis-ds.html",target:"_blank",rel:"noopener noreferrer"},Sp=t('<h4 id="redis-ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨-c-å­—ç¬¦ä¸²-è€Œè¦è‡ªå·±æ„å»ºä¸€ç§å­—ç¬¦ä¸²æŠ½è±¡ç±»å‹-sds-simple-dynamic-string" tabindex="-1"><a class="header-anchor" href="#redis-ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨-c-å­—ç¬¦ä¸²-è€Œè¦è‡ªå·±æ„å»ºä¸€ç§å­—ç¬¦ä¸²æŠ½è±¡ç±»å‹-sds-simple-dynamic-string" aria-hidden="true">#</a> Redis ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ C å­—ç¬¦ä¸²ï¼Œè€Œè¦è‡ªå·±æ„å»ºä¸€ç§å­—ç¬¦ä¸²æŠ½è±¡ç±»å‹ SDS(simple dynamic string)ï¼Ÿ</h4><ul><li><strong>å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</strong></li></ul><p>ç”±äº len å±æ€§çš„å­˜åœ¨ï¼Œæˆ‘ä»¬è·å– SDS å­—ç¬¦ä¸²çš„é•¿åº¦åªéœ€è¦è¯»å– len å±æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚è€Œå¯¹äº C è¯­è¨€ï¼Œè·å–å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯ç»è¿‡éå†è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚é€šè¿‡ <code>strlen key</code> å‘½ä»¤å¯ä»¥è·å– key çš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</p><ul><li><strong>æœç»ç¼“å†²åŒºæº¢å‡º</strong></li></ul><p>æˆ‘ä»¬çŸ¥é“åœ¨ C è¯­è¨€ä¸­ä½¿ç”¨ <code>strcat</code> å‡½æ•°æ¥è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚è€Œå¯¹äº SDS æ•°æ®ç±»å‹ï¼Œåœ¨è¿›è¡Œå­—ç¬¦ä¿®æ”¹çš„æ—¶å€™ï¼Œ<strong>ä¼šé¦–å…ˆæ ¹æ®è®°å½•çš„ len å±æ€§æ£€æŸ¥å†…å­˜ç©ºé—´æ˜¯å¦æ»¡è¶³éœ€æ±‚</strong>ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œä¼šè¿›è¡Œç›¸åº”çš„ç©ºé—´æ‰©å±•ï¼Œç„¶ååœ¨è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºã€‚</p><ul><li><strong>å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å­˜é‡æ–°åˆ†é…æ¬¡æ•°</strong></li></ul><p>Cè¯­è¨€ç”±äºä¸è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆå…ˆé‡Šæ”¾å†ç”³è¯·ï¼‰ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é‡æ–°åˆ†é…ï¼Œå­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶ä¼šé€ æˆå†…å­˜ç¼“å†²åŒºæº¢å‡ºï¼Œå­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚</p><p>è€Œå¯¹äºSDSï¼Œç”±äº <code>len</code>å±æ€§å’Œ <code>alloc</code>å±æ€§çš„å­˜åœ¨ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ä¸²SDSå®ç°äº†<strong>ç©ºé—´é¢„åˆ†é…</strong>å’Œ<strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong>ä¸¤ç§ç­–ç•¥ï¼š</p><p>1ã€<code>ç©ºé—´é¢„åˆ†é…</code>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œæ‰©å±•çš„å†…å­˜æ¯”å®é™…éœ€è¦çš„å¤šï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</p><p>2ã€<code>æƒ°æ€§ç©ºé—´é‡Šæ”¾</code>ï¼šå¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡æ–°åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šä½™çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>alloc</code> å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚ï¼ˆå½“ç„¶SDSä¹Ÿæä¾›äº†ç›¸åº”çš„APIï¼Œå½“æˆ‘ä»¬æœ‰éœ€è¦æ—¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡Šæ”¾è¿™äº›æœªä½¿ç”¨çš„ç©ºé—´ã€‚ï¼‰</p><ul><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong></li></ul><p>å› ä¸ºCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè€Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œå†…å®¹å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤Cå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®å­˜å–ï¼›è€Œæ‰€æœ‰ SDS çš„API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† <code>buf</code> é‡Œé¢çš„å…ƒç´ ï¼Œå¹¶ä¸” SDS ä¸æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œè€Œæ˜¯ä»¥ len å±æ€§è¡¨ç¤ºçš„é•¿åº¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸã€‚</p><ul><li><strong>å…¼å®¹éƒ¨åˆ† C å­—ç¬¦ä¸²å‡½æ•°</strong></li></ul><p>è™½ç„¶ SDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸€æ ·éµä»æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²ç»“å°¾çš„æƒ¯ä¾‹ï¼Œè¿™æ ·å¯ä»¥é‡ç”¨ C è¯­è¨€åº“ <code>&lt;string.h&gt;</code> ä¸­çš„ä¸€éƒ¨åˆ†å‡½æ•°ã€‚</p><p><code>æ‹“å±•:ä»€ä¹ˆæ˜¯SDS</code></p><p><strong>SDSçš„æ€»ä½“æ¦‚è§ˆ</strong>å¦‚ä¸‹å›¾:</p><figure><img src="'+Zn+'" alt="image-20220614143000054" tabindex="0" loading="lazy"><figcaption>image-20220614143000054</figcaption></figure><p>å…¶ä¸­ <code>sdshdr</code>æ˜¯å¤´éƒ¨, <code>buf</code>æ˜¯çœŸå®å­˜å‚¨ç”¨æˆ·æ•°æ®çš„åœ°æ–¹. å¦å¤–æ³¨æ„, ä»å‘½åä¸Šèƒ½çœ‹å‡ºæ¥, è¿™ä¸ªæ•°æ®ç»“æ„é™¤äº†èƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®, æ˜¾ç„¶æ˜¯ç”¨äºè®¾è®¡ä½œä¸ºå­—ç¬¦ä¸²ä½¿ç”¨çš„, æ‰€ä»¥åœ¨bufä¸­, ç”¨æˆ·æ•°æ®åæ€»è·Ÿç€ä¸€ä¸ª\\0. å³å›¾ä¸­ <code>&quot;æ•°æ®&quot; + &quot;\\0&quot;</code>æ˜¯ä¸ºæ‰€è°“çš„bufã€‚</p><ul><li>å¦‚ä¸‹æ˜¯<strong>6.0æºç ä¸­sdsç›¸å…³çš„ç»“æ„</strong>ï¼š</li></ul><figure><img src="'+$n+'" alt="image-20220614143012262" tabindex="0" loading="lazy"><figcaption>image-20220614143012262</figcaption></figure><p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSDSæœ‰äº”ç§ä¸åŒçš„å¤´éƒ¨. å…¶ä¸­sdshdr5å®é™…å¹¶æœªä½¿ç”¨åˆ°. æ‰€ä»¥å®é™…ä¸Šæœ‰å››ç§ä¸åŒçš„å¤´éƒ¨, åˆ†åˆ«å¦‚ä¸‹:</p><figure><img src="'+ns+'" alt="image-20220614143018917" tabindex="0" loading="lazy"><figcaption>image-20220614143018917</figcaption></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>len</code> ä¿å­˜äº†SDSä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦</li><li><code>buf[]</code> æ•°ç»„ç”¨æ¥ä¿å­˜å­—ç¬¦ä¸²çš„æ¯ä¸ªå…ƒç´ </li><li><code>alloc</code>åˆ†åˆ«ä»¥uint8, uint16, uint32, uint64è¡¨ç¤ºæ•´ä¸ªSDS, é™¤è¿‡å¤´éƒ¨ä¸æœ«å°¾çš„\\0, å‰©ä½™çš„å­—èŠ‚æ•°.</li><li><code>flags</code> å§‹ç»ˆä¸ºä¸€å­—èŠ‚, ä»¥ä½ä¸‰ä½æ ‡ç¤ºç€å¤´éƒ¨çš„ç±»å‹, é«˜5ä½æœªä½¿ç”¨.</li></ul><h4 id="redis-çš„æŒä¹…åŒ–æ–¹å¼æœ‰äº†è§£å—-èƒ½å¤§æ¦‚è¯´ä¸€ä¸‹å—" tabindex="-1"><a class="header-anchor" href="#redis-çš„æŒä¹…åŒ–æ–¹å¼æœ‰äº†è§£å—-èƒ½å¤§æ¦‚è¯´ä¸€ä¸‹å—" aria-hidden="true">#</a> Redis çš„æŒä¹…åŒ–æ–¹å¼æœ‰äº†è§£å—ï¼Ÿèƒ½å¤§æ¦‚è¯´ä¸€ä¸‹å—ï¼Ÿ</h4>',25),xp={href:"https://redis.io/topics/persistence%EF%BC%89%EF%BC%9ARDB%E5%92%8CAOF%E3%80%82",target:"_blank",rel:"noopener noreferrer"},_p={href:"https://www.pdai.tech/md/db/nosql-redis/db-redis-x-rdb-aof.html#redis%E6%8C%81%E4%B9%85%E5%8C%96%E7%AE%80%E4%BB%8B",target:"_blank",rel:"noopener noreferrer"},Tp=t(`<h4 id="redis-æ€ä¹ˆç»Ÿè®¡åœ¨çº¿ç”¨æˆ·" tabindex="-1"><a class="header-anchor" href="#redis-æ€ä¹ˆç»Ÿè®¡åœ¨çº¿ç”¨æˆ·" aria-hidden="true">#</a> Redis æ€ä¹ˆç»Ÿè®¡åœ¨çº¿ç”¨æˆ·</h4><p>è§ä¸‹ä¸€ä¸ªé—®é¢˜çš„ <code>bitmap</code>çš„ä½¿ç”¨åœºæ™¯</p><h4 id="redis-çš„æ•°æ®ç»“æ„è®²ä¸€è®²-ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#redis-çš„æ•°æ®ç»“æ„è®²ä¸€è®²-ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> Redis çš„æ•°æ®ç»“æ„è®²ä¸€è®² + ä½¿ç”¨åœºæ™¯</h4><p>string</p><hr><ol><li><strong>ä»‹ç»</strong> ï¼šstring æ•°æ®ç»“æ„æ˜¯ç®€å•çš„ key-value ç±»å‹ã€‚è™½ç„¶ Redis æ˜¯ç”¨ C è¯­è¨€å†™çš„ï¼Œä½†æ˜¯ Redis å¹¶æ²¡æœ‰ä½¿ç”¨ C çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§ <strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼ˆsimple dynamic stringï¼Œ<strong>SDS</strong>ï¼‰ã€‚ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼ŒRedis çš„ SDS ä¸å…‰å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®è¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦ä¸º O(1)ï¼ˆC å­—ç¬¦ä¸²ä¸º O(N)ï¼‰,é™¤æ­¤ä¹‹å¤–ï¼ŒRedis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>set,get,strlen,exists,decr,incr,setex</code> ç­‰ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> ä¸€èˆ¬å¸¸ç”¨åœ¨éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ç­‰ã€‚</li></ol><p>list</p><hr><ol><li><strong>ä»‹ç»</strong> ï¼š<strong>list</strong> å³æ˜¯ <strong>é“¾è¡¨</strong>ã€‚é“¾è¡¨æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯æ˜“äºæ•°æ®å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸”å¯ä»¥çµæ´»è°ƒæ•´é“¾è¡¨é•¿åº¦ï¼Œä½†æ˜¯é“¾è¡¨çš„éšæœºè®¿é—®å›°éš¾ã€‚è®¸å¤šé«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½å†…ç½®äº†é“¾è¡¨çš„å®ç°æ¯”å¦‚ Java ä¸­çš„ <strong>LinkedList</strong>ï¼Œä½†æ˜¯ C è¯­è¨€å¹¶æ²¡æœ‰å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥ Redis å®ç°äº†è‡ªå·±çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚Redis çš„ list çš„å®ç°ä¸ºä¸€ä¸ª <strong>åŒå‘é“¾è¡¨</strong>ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤:</strong> <code>rpush,lpop,lpush,rpop,lrange,llen</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚</li></ol><p>hash</p><hr><ol><li><strong>ä»‹ç»</strong> ï¼šhash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚ä¸è¿‡ï¼ŒRedis çš„ hash åšäº†æ›´å¤šä¼˜åŒ–ã€‚å¦å¤–ï¼Œhash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ<strong>ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡</strong>ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»…ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ hash æ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>hset,hmset,hexists,hget,hgetall,hkeys,hvals</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ã€‚</li></ol><p>set</p><hr><ol><li><strong>ä»‹ç» ï¼š</strong> set ç±»ä¼¼äº Java ä¸­çš„ <code>HashSet</code> ã€‚Redis ä¸­çš„ set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚å¯ä»¥åŸºäº set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>sadd,spop,smembers,sismember,scard,sinterstore,sunion</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯:</strong> éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤ä»¥åŠéœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†å’Œå¹¶é›†ç­‰åœºæ™¯</li></ol><p>sorted set</p><hr><ol><li><strong>ä»‹ç»ï¼š</strong> å’Œ set ç›¸æ¯”ï¼Œsorted set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚æœ‰ç‚¹åƒæ˜¯ Java ä¸­ HashMap å’Œ TreeSet çš„ç»“åˆä½“ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>zadd,zcard,zscore,zrange,zrevrange,zrem</code> ç­‰ã€‚</li><li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚æ¯”å¦‚åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ã€‚</li></ol><p>bitmap</p><hr><ol><li><strong>ä»‹ç»ï¼š</strong> bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚</li><li><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong> <code>setbit</code> ã€<code>getbit</code> ã€<code>bitcount</code>ã€<code>bitop</code></li><li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> é€‚åˆéœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦ç™»å½•...ï¼‰å¹¶éœ€è¦è¿›ä¸€æ­¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æçš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚</li></ol><p><strong>ä½¿ç”¨åœºæ™¯ä¸€ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æ</strong> å¾ˆå¤šç½‘ç«™ä¸ºäº†åˆ†æä½ çš„å–œå¥½ï¼Œéœ€è¦ç ”ç©¶ä½ ç‚¹èµè¿‡çš„å†…å®¹ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è®°å½•ä½ å–œæ¬¢è¿‡ 001 å·å°å§å§</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit beauty_girl_001 uid <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨åœºæ™¯äºŒï¼šç»Ÿè®¡æ´»è·ƒç”¨æˆ·</strong></p><p>ä½¿ç”¨æ—¶é—´ä½œä¸º keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœå½“æ—¥æ´»è·ƒè¿‡å°±è®¾ç½®ä¸º 1</p><p>é‚£ä¹ˆæˆ‘è¯¥å¦‚ä½•è®¡ç®—æŸå‡ å¤©/æœˆ/å¹´çš„æ´»è·ƒç”¨æˆ·å‘¢(æš‚ä¸”çº¦å®šï¼Œç»Ÿè®¡æ—¶é—´å†…åªè¦æœ‰ä¸€å¤©åœ¨çº¿å°±ç§°ä¸ºæ´»è·ƒ)ï¼Œæœ‰è¯·ä¸‹ä¸€ä¸ª redis çš„å‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸² key è¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey ä¸Šã€‚</span>
<span class="token comment"># BITOP å‘½ä»¤æ”¯æŒ AND ã€ OR ã€ NOT ã€ XOR è¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§å‚æ•°</span>
BITOP operation destkey key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹åŒ–æ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210308</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210308</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210309</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»Ÿè®¡ 20210308~20210309 æ€»æ´»è·ƒç”¨æˆ·æ•°: 1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitop and desk1 <span class="token number">20210308</span> <span class="token number">20210309</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount desk1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»Ÿè®¡ 20210308~20210309 åœ¨çº¿æ´»è·ƒç”¨æˆ·æ•°: 2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitop or desk2 <span class="token number">20210308</span> <span class="token number">20210309</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount desk2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨åœºæ™¯ä¸‰ï¼šç”¨æˆ·åœ¨çº¿çŠ¶æ€</strong></p><p>å¯¹äºè·å–æˆ–è€…ç»Ÿè®¡ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼Œä½¿ç”¨ bitmap æ˜¯ä¸€ä¸ªèŠ‚çº¦ç©ºé—´ä¸”æ•ˆç‡åˆé«˜çš„ä¸€ç§æ–¹æ³•ã€‚</p><p>åªéœ€è¦ä¸€ä¸ª keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœåœ¨çº¿å°±è®¾ç½®ä¸º 1ï¼Œä¸åœ¨çº¿å°±è®¾ç½®ä¸º 0ã€‚</p><h4 id="zset-é‡Œé¢è·³è¡¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#zset-é‡Œé¢è·³è¡¨æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> Zset é‡Œé¢è·³è¡¨æ˜¯ä»€ä¹ˆ</h4><p><strong>è·³è·ƒè¡¨ï¼ˆzSkiplist)</strong>: è·³è·ƒè¡¨çš„æ€§èƒ½å¯ä»¥ä¿è¯åœ¨æŸ¥æ‰¾ï¼Œåˆ é™¤ï¼Œæ·»åŠ ç­‰æ“ä½œçš„æ—¶å€™åœ¨å¯¹æ•°æœŸæœ›æ—¶é—´å†…å®Œæˆï¼Œè¿™ä¸ªæ€§èƒ½æ˜¯å¯ä»¥å’Œå¹³è¡¡æ ‘æ¥ç›¸æ¯”è¾ƒçš„ï¼Œè€Œä¸”åœ¨å®ç°æ–¹é¢æ¯”å¹³è¡¡æ ‘è¦ä¼˜é›…ï¼Œè¿™æ˜¯é‡‡ç”¨è·³è·ƒè¡¨çš„ä¸»è¦åŸå› ã€‚è·³è·ƒè¡¨çš„å¤æ‚åº¦æ˜¯O(log(n))ã€‚</p><h4 id="å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§-2022é£ä¹¦" aria-hidden="true">#</a> å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿï¼ˆ2022é£ä¹¦ï¼‰</h4><p>ç»†è¯´çš„è¯å¯ä»¥æ‰¯å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘è§‰å¾—å…¶å®æ²¡å¤ªå¤§å¿…è¦ï¼ˆå°å£° BBï¼šå¾ˆå¤šè§£å†³æ–¹æ¡ˆæˆ‘ä¹Ÿæ²¡å¤ªå¼„æ˜ç™½ï¼‰ã€‚æˆ‘ä¸ªäººè§‰å¾—å¼•å…¥ç¼“å­˜ä¹‹åï¼Œå¦‚æœä¸ºäº†çŸ­æ—¶é—´çš„ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œé€‰æ‹©è®©ç³»ç»Ÿè®¾è®¡å˜å¾—æ›´åŠ å¤æ‚çš„è¯ï¼Œå®Œå…¨æ²¡å¿…è¦ã€‚</p><p>ä¸‹é¢å•ç‹¬å¯¹ <strong>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</strong> æ¥èŠèŠã€‚</p><p>Cache Aside Pattern ä¸­é‡åˆ°å†™è¯·æ±‚æ˜¯è¿™æ ·çš„ï¼šæ›´æ–° DBï¼Œç„¶åç›´æ¥åˆ é™¤ cache ã€‚</p><p>å¦‚æœæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œè€Œåˆ é™¤ç¼“å­˜è¿™ä¸€æ­¥å¤±è´¥çš„æƒ…å†µçš„è¯ï¼Œç®€å•è¯´ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p><ol><li><strong>ç¼“å­˜å¤±æ•ˆæ—¶é—´å˜çŸ­ï¼ˆä¸æ¨èï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼‰</strong> ï¼šæˆ‘ä»¬è®©ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´å˜çŸ­ï¼Œè¿™æ ·çš„è¯ç¼“å­˜å°±ä¼šä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®ã€‚å¦å¤–ï¼Œè¿™ç§è§£å†³åŠæ³•å¯¹äºå…ˆæ“ä½œç¼“å­˜åæ“ä½œæ•°æ®åº“çš„åœºæ™¯ä¸é€‚ç”¨ã€‚</li><li><strong>å¢åŠ  cache æ›´æ–°é‡è¯•æœºåˆ¶ï¼ˆå¸¸ç”¨ï¼‰</strong>ï¼š å¦‚æœ cache æœåŠ¡å½“å‰ä¸å¯ç”¨å¯¼è‡´ç¼“å­˜åˆ é™¤å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å°±éš”ä¸€æ®µæ—¶é—´è¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°å¯ä»¥è‡ªå·±å®šã€‚å¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå½“å‰æ›´æ–°å¤±è´¥çš„ key å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰ç¼“å­˜æœåŠ¡å¯ç”¨ä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­å¯¹åº”çš„ key åˆ é™¤å³å¯ã€‚</li></ol>`,44),Pp={href:"https://mp.weixin.qq.com/s?__biz=MzIyOTYxNDI5OA==&mid=2247487312&idx=1&sn=fa19566f5729d6598155b5c676eee62d&chksm=e8beb8e5dfc931f3e35655da9da0b61c79f2843101c130cf38996446975014f958a6481aacf1&scene=178&cur_album_id=1699766580538032128#rd",target:"_blank",rel:"noopener noreferrer"},Lp=t('<blockquote><p>è¿˜æœ‰å¦å¤–çš„ç­”æ¡ˆï¼ˆç”¨äºç†è§£ï¼‰</p></blockquote><p><strong>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</strong>ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><p>1.å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p><figure><img src="'+ss+'" alt="image-20220714102354617" tabindex="0" loading="lazy"><figcaption>image-20220714102354617</figcaption></figure><p>2.å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</p><figure><img src="'+as+'" alt="image-20220714102403176" tabindex="0" loading="lazy"><figcaption>image-20220714102403176</figcaption></figure><p>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><h5 id="_4ç§ç›¸å…³æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_4ç§ç›¸å…³æ¨¡å¼" aria-hidden="true">#</a> 4ç§ç›¸å…³æ¨¡å¼</h5>',8),Rp={href:"https://coolshell.cn/articles/17416.html",target:"_blank",rel:"noopener noreferrer"},Ip=t('<p><strong>èŠ‚é€‰æœ€æœ€å¸¸ç”¨çš„Cache Aside Pattern, æ€»ç»“æ¥è¯´å°±æ˜¯</strong></p><ul><li><strong>è¯»çš„æ—¶å€™</strong>ï¼Œå…ˆè¯»ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰çš„è¯ï¼Œå°±è¯»æ•°æ®åº“ï¼Œç„¶åå–å‡ºæ•°æ®åæ”¾å…¥ç¼“å­˜ï¼ŒåŒæ—¶è¿”å›å“åº”ã€‚</li><li><strong>æ›´æ–°çš„æ—¶å€™</strong>ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜ã€‚</li></ul><p>å…¶å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li><strong>å¤±æ•ˆ</strong>ï¼šåº”ç”¨ç¨‹åºå…ˆä»cacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚</li><li><strong>å‘½ä¸­</strong>ï¼šåº”ç”¨ç¨‹åºä»cacheä¸­å–æ•°æ®ï¼Œå–åˆ°åè¿”å›ã€‚</li><li><strong>æ›´æ–°</strong>ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚</li></ul><figure><img src="'+es+'" alt="image-20220714102025861" tabindex="0" loading="lazy"><figcaption>image-20220714102025861</figcaption></figure><figure><img src="'+ts+'" alt="image-20220714102028966" tabindex="0" loading="lazy"><figcaption>image-20220714102028966</figcaption></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ›´æ–°æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåï¼Œè®©ç¼“å­˜å¤±æ•ˆã€‚é‚£ä¹ˆï¼Œè¿™ç§æ–¹å¼æ˜¯å¦å¯ä»¥æ²¡æœ‰æ–‡ç« å‰é¢æåˆ°è¿‡çš„é‚£ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è„‘è¡¥ä¸€ä¸‹ã€‚</p><p>ä¸€ä¸ªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œçš„å¹¶å‘ï¼Œé¦–å…ˆï¼Œæ²¡æœ‰äº†åˆ é™¤cacheæ•°æ®çš„æ“ä½œäº†ï¼Œè€Œæ˜¯å…ˆæ›´æ–°äº†æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ï¼Œç¼“å­˜ä¾ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥ï¼Œå¹¶å‘çš„æŸ¥è¯¢æ“ä½œæ‹¿çš„æ˜¯æ²¡æœ‰æ›´æ–°çš„æ•°æ®ï¼Œä½†æ˜¯ï¼Œæ›´æ–°æ“ä½œé©¬ä¸Šè®©ç¼“å­˜çš„å¤±æ•ˆäº†ï¼Œåç»­çš„æŸ¥è¯¢æ“ä½œå†æŠŠæ•°æ®ä»æ•°æ®åº“ä¸­æ‹‰å‡ºæ¥ã€‚è€Œä¸ä¼šåƒæ–‡ç« å¼€å¤´çš„é‚£ä¸ªé€»è¾‘äº§ç”Ÿçš„é—®é¢˜ï¼Œåç»­çš„æŸ¥è¯¢æ“ä½œä¸€ç›´éƒ½åœ¨å–è€çš„æ•°æ®ã€‚</p>',8),Ap={href:"https://www.usenix.org/system/files/conference/nsdi13/nsdi13-final170_update.pdf",target:"_blank",rel:"noopener noreferrer"},Np={href:"https://www.quora.com/Why-does-Facebook-use-delete-to-remove-the-key-value-pair-in-Memcached-instead-of-updating-the-Memcached-during-write-request-to-the-backend",target:"_blank",rel:"noopener noreferrer"},Mp=t('<p>é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯Cache Asideè¿™ä¸ªå°±ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜äº†ï¼Ÿä¸æ˜¯çš„ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªæ˜¯è¯»æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç„¶åå°±åˆ°æ•°æ®åº“ä¸­å–æ•°æ®ï¼Œæ­¤æ—¶æ¥äº†ä¸€ä¸ªå†™æ“ä½œï¼Œå†™å®Œæ•°æ®åº“åï¼Œè®©ç¼“å­˜å¤±æ•ˆï¼Œç„¶åï¼Œä¹‹å‰çš„é‚£ä¸ªè¯»æ“ä½œå†æŠŠè€çš„æ•°æ®æ”¾è¿›å»ï¼Œæ‰€ä»¥ï¼Œä¼šé€ æˆè„æ•°æ®ã€‚</p><p>ä½†ï¼Œè¿™ä¸ªcaseç†è®ºä¸Šä¼šå‡ºç°ï¼Œä¸è¿‡ï¼Œå®é™…ä¸Šå‡ºç°çš„æ¦‚ç‡å¯èƒ½éå¸¸ä½ï¼Œå› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”å¹¶å‘ç€æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚è€Œå®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦é”è¡¨ï¼Œè€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜ï¼Œæ‰€æœ‰çš„è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡åŸºæœ¬å¹¶ä¸å¤§ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯Quoraä¸Šçš„é‚£ä¸ªç­”æ¡ˆé‡Œè¯´çš„ï¼Œè¦ä¹ˆé€šè¿‡2PCæˆ–æ˜¯Paxosåè®®ä¿è¯ä¸€è‡´æ€§ï¼Œè¦ä¹ˆå°±æ˜¯æ‹¼å‘½çš„é™ä½å¹¶å‘æ—¶è„æ•°æ®çš„æ¦‚ç‡ï¼Œè€ŒFacebookä½¿ç”¨äº†è¿™ä¸ªé™ä½æ¦‚ç‡çš„ç©æ³•ï¼Œå› ä¸º2PCå¤ªæ…¢ï¼Œè€ŒPaxoså¤ªå¤æ‚ã€‚å½“ç„¶ï¼Œæœ€å¥½è¿˜æ˜¯ä¸ºç¼“å­˜è®¾ç½®ä¸Šè¿‡æœŸæ—¶é—´ã€‚</p><h5 id="æ–¹æ¡ˆ-é˜Ÿåˆ—-é‡è¯•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆ-é˜Ÿåˆ—-é‡è¯•æœºåˆ¶" aria-hidden="true">#</a> æ–¹æ¡ˆï¼šé˜Ÿåˆ— + é‡è¯•æœºåˆ¶</h5><figure><img src="'+ps+'" alt="image-20220714102236860" tabindex="0" loading="lazy"><figcaption>image-20220714102236860</figcaption></figure><p>æµç¨‹å¦‚ä¸‹æ‰€ç¤º</p><ul><li>æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</li><li>ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥</li><li>å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—</li><li>è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key</li><li>ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</li></ul><p>ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚äºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œåœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚</p><h5 id="æ–¹æ¡ˆ-å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆ-å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" aria-hidden="true">#</a> æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</h5><figure><img src="'+os+'" alt="image-20220714102307741" tabindex="0" loading="lazy"><figcaption>image-20220714102307741</figcaption></figure><p>MySQL binlogå¢é‡è®¢é˜…æ¶ˆè´¹+æ¶ˆæ¯é˜Ÿåˆ—+å¢é‡æ•°æ®æ›´æ–°åˆ°redis</p><p>1ï¼‰è¯»Redisï¼šçƒ­æ•°æ®åŸºæœ¬éƒ½åœ¨Redis</p><p>2ï¼‰å†™MySQL: å¢åˆ æ”¹éƒ½æ˜¯æ“ä½œMySQL</p><p>3ï¼‰æ›´æ–°Redisæ•°æ®ï¼šMySQçš„æ•°æ®æ“ä½œbinlogï¼Œæ¥æ›´æ–°åˆ°Redis</p><ol><li><strong>Redisæ›´æ–°</strong></li></ol><p>1ï¼‰<strong>æ•°æ®æ“ä½œ</strong>ä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯å…¨é‡(å°†å…¨éƒ¨æ•°æ®ä¸€æ¬¡å†™å…¥åˆ°redis)</li><li>ä¸€ä¸ªæ˜¯å¢é‡ï¼ˆå®æ—¶æ›´æ–°ï¼‰</li></ul><p>è¿™é‡Œè¯´çš„æ˜¯å¢é‡,æŒ‡çš„æ˜¯mysqlçš„updateã€insertã€delateå˜æ›´æ•°æ®ã€‚</p><p>2ï¼‰<strong>è¯»å–binlogååˆ†æ ï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—,æ¨é€æ›´æ–°å„å°çš„redisç¼“å­˜æ•°æ®</strong>ã€‚</p><p>è¿™æ ·ä¸€æ—¦MySQLä¸­äº§ç”Ÿäº†æ–°çš„å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå°±å¯ä»¥æŠŠbinlogç›¸å…³çš„æ¶ˆæ¯æ¨é€è‡³Redisï¼ŒRediså†æ ¹æ®binlogä¸­çš„è®°å½•ï¼Œå¯¹Redisè¿›è¡Œæ›´æ–°ã€‚</p><p>å…¶å®è¿™ç§æœºåˆ¶ï¼Œå¾ˆç±»ä¼¼MySQLçš„ä¸»ä»å¤‡ä»½æœºåˆ¶ï¼Œå› ä¸ºMySQLçš„ä¸»å¤‡ä¹Ÿæ˜¯é€šè¿‡binlogæ¥å®ç°çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>è¿™é‡Œå¯ä»¥ç»“åˆä½¿ç”¨canal(é˜¿é‡Œçš„ä¸€æ¬¾å¼€æºæ¡†æ¶)ï¼Œé€šè¿‡è¯¥æ¡†æ¶å¯ä»¥å¯¹MySQLçš„binlogè¿›è¡Œè®¢é˜…ï¼Œè€Œcanalæ­£æ˜¯æ¨¡ä»¿äº†mysqlçš„slaveæ•°æ®åº“çš„å¤‡ä»½è¯·æ±‚ï¼Œä½¿å¾—Redisçš„æ•°æ®æ›´æ–°è¾¾åˆ°äº†ç›¸åŒçš„æ•ˆæœã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œçš„æ¶ˆæ¯æ¨é€å·¥å…·ä½ ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ«çš„ç¬¬ä¸‰æ–¹ï¼škafkaã€rabbitMQç­‰æ¥å®ç°æ¨é€æ›´æ–°Redisã€‚</p><h4 id="ç¼“å­˜å¤±æ•ˆç­–ç•¥-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å¤±æ•ˆç­–ç•¥-2022è”šæ¥" aria-hidden="true">#</a> ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼ˆ2022è”šæ¥ï¼‰</h4><h4 id="redisçš„è¿‡æœŸç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#redisçš„è¿‡æœŸç­–ç•¥" aria-hidden="true">#</a> redisçš„è¿‡æœŸç­–ç•¥</h4><p>åœ¨å•æœºç‰ˆRedisä¸­ï¼Œå­˜åœ¨ä¸¤ç§åˆ é™¤ç­–ç•¥ï¼š</p><ul><li><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œåªæœ‰å½“å®¢æˆ·ç«¯æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ã€‚</li><li><strong>å®šæœŸåˆ é™¤</strong>ï¼šæœåŠ¡å™¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡åˆ é™¤è¿‡æœŸæ•°æ®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å†…å­˜å’ŒCPUçš„æŠ˜ä¸­ï¼ˆåˆ é™¤ä¼šé‡Šæ”¾å†…å­˜ï¼Œä½†æ˜¯é¢‘ç¹çš„åˆ é™¤æ“ä½œå¯¹CPUä¸å‹å¥½ï¼‰ï¼Œè¯¥åˆ é™¤çš„é¢‘ç‡å’Œæ‰§è¡Œæ—¶é—´éƒ½å—åˆ°äº†é™åˆ¶ã€‚</li></ul><p>åœ¨ä¸»ä»å¤åˆ¶åœºæ™¯ä¸‹ï¼Œä¸ºäº†ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä»èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ç”±ä¸»èŠ‚ç‚¹æ§åˆ¶ä»èŠ‚ç‚¹ä¸­è¿‡æœŸæ•°æ®çš„åˆ é™¤ã€‚ç”±äºä¸»èŠ‚ç‚¹çš„æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç­–ç•¥ï¼Œéƒ½ä¸èƒ½ä¿è¯ä¸»èŠ‚ç‚¹åŠæ—¶å¯¹è¿‡æœŸæ•°æ®æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œå› æ­¤ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡Redisä»èŠ‚ç‚¹è¯»å–æ•°æ®æ—¶ï¼Œå¾ˆå®¹æ˜“è¯»å–åˆ°å·²ç»è¿‡æœŸçš„æ•°æ®ã€‚</p><p>Redis 3.2ä¸­ï¼Œä»èŠ‚ç‚¹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå¢åŠ äº†å¯¹æ•°æ®æ˜¯å¦è¿‡æœŸçš„åˆ¤æ–­ï¼šå¦‚æœè¯¥æ•°æ®å·²è¿‡æœŸï¼Œåˆ™ä¸è¿”å›ç»™å®¢æˆ·ç«¯ï¼›å°†Rediså‡çº§åˆ°3.2å¯ä»¥è§£å†³æ•°æ®è¿‡æœŸé—®é¢˜ã€‚</p><h4 id="å¦‚ä½•åˆ†é…redisç©ºé—´-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ†é…redisç©ºé—´-2022é£ä¹¦" aria-hidden="true">#</a> å¦‚ä½•åˆ†é…redisç©ºé—´ï¼ˆ2022é£ä¹¦ï¼‰</h4><p>Redisæ˜¯ä¸€ç§å†…å­˜æ•°æ®åº“ï¼Œå› æ­¤ï¼Œç©ºé—´çš„åˆ†é…ä¸»è¦æ¶‰åŠåˆ°å†…å­˜çš„ç®¡ç†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•åˆ†é…Redisç©ºé—´çš„æ–¹æ³•ï¼š</p><ol><li>é…ç½®Rediså†…å­˜å¤§å°ï¼šåœ¨Redisçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹â€œmaxmemoryâ€å‚æ•°æ¥è®¾ç½®Redisçš„æœ€å¤§å†…å­˜å¤§å°ã€‚è¿™ä¸ªå‚æ•°å€¼çš„è®¾ç½®éœ€è¦è€ƒè™‘æœåŠ¡å™¨çš„å†…å­˜å®¹é‡ï¼Œä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºçš„å†…å­˜éœ€æ±‚ã€‚</li><li>ä½¿ç”¨Redisè¿‡æœŸæœºåˆ¶ï¼šRedisæä¾›äº†ä¸€ç§é”®è¿‡æœŸæœºåˆ¶ï¼Œå¯ä»¥è®©è¿‡æœŸçš„é”®è‡ªåŠ¨ä»å†…å­˜ä¸­ç§»é™¤ï¼Œä»è€Œé‡Šæ”¾ç©ºé—´ã€‚é€šè¿‡è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†Redisçš„ç©ºé—´ã€‚</li><li>ä½¿ç”¨Rediså†…å­˜å›æ”¶æœºåˆ¶ï¼šå½“Redisçš„å†…å­˜å ç”¨è¾¾åˆ°äº†æœ€å¤§é™åˆ¶æ—¶ï¼ŒRedisä¼šä½¿ç”¨å†…å­˜å›æ”¶æœºåˆ¶æ¥å°è¯•é‡Šæ”¾ä¸€äº›å†…å­˜ã€‚è¿™ä¸ªæœºåˆ¶ä¼šæ ¹æ®é”®çš„ä½¿ç”¨é¢‘ç‡å’Œè¿‡æœŸæ—¶é—´ç­‰å› ç´ æ¥å†³å®šè¦å›æ”¶å“ªäº›é”®ã€‚</li><li>ä½¿ç”¨RedisæŒä¹…åŒ–æœºåˆ¶ï¼šRedisæä¾›äº†RDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œå¯ä»¥å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚åœ¨ä½¿ç”¨æŒä¹…åŒ–æœºåˆ¶çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦è€ƒè™‘ç£ç›˜ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼Œåˆ†é…Redisç©ºé—´çš„å…³é”®åœ¨äºé…ç½®Redisçš„æœ€å¤§å†…å­˜å¤§å°ï¼Œå¹¶ç»“åˆä½¿ç”¨è¿‡æœŸæœºåˆ¶ã€å†…å­˜å›æ”¶æœºåˆ¶å’ŒæŒä¹…åŒ–æœºåˆ¶ç­‰æŠ€æœ¯æ¥ç®¡ç†Redisçš„ç©ºé—´ã€‚</p><h4 id="redisæ˜¯å¦‚ä½•å‘½ä¸­çš„-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#redisæ˜¯å¦‚ä½•å‘½ä¸­çš„-2022é£ä¹¦" aria-hidden="true">#</a> redisæ˜¯å¦‚ä½•å‘½ä¸­çš„ï¼Ÿï¼ˆ2022é£ä¹¦ï¼‰</h4><p>Redisä¸­çš„é”®å€¼å¯¹æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚æŸä¸ªé”®çš„å€¼æ—¶ï¼ŒRedisä¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡ŒæŸ¥æ‰¾å’Œå‘½ä¸­æ“ä½œï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå‘½ä»¤è¯·æ±‚åˆ°RedisæœåŠ¡å™¨ã€‚</li><li>RedisæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚å‘½ä»¤ï¼Œè·å–è¯·æ±‚çš„é”®åã€‚</li><li>Redisä¼šæ ¹æ®é”®ååœ¨å†…éƒ¨æ•°æ®ç»“æ„ä¸­æŸ¥æ‰¾ç›¸åº”çš„é”®å€¼å¯¹ã€‚Redisä½¿ç”¨å“ˆå¸Œè¡¨æ¥å®ç°é”®å€¼å¯¹çš„å­˜å‚¨å’ŒæŸ¥æ‰¾ï¼Œå“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«äº†ä¸€ä¸ªé”®å’Œä¸€ä¸ªå€¼ã€‚</li><li>å¦‚æœRedisåœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°äº†è¯·æ±‚çš„é”®å€¼å¯¹ï¼Œé‚£ä¹ˆå‘½ä¸­æ“ä½œå°±æˆåŠŸäº†ï¼ŒRedisä¼šå°†é”®å¯¹åº”çš„å€¼è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å¦‚æœRedisåœ¨å“ˆå¸Œè¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„é”®å€¼å¯¹ï¼Œé‚£ä¹ˆå‘½ä¸­æ“ä½œå°±å¤±è´¥äº†ï¼ŒRedisä¼šè¿”å›ä¸€ä¸ªç‰¹å®šçš„å“åº”ï¼Œè¡¨ç¤ºè¯¥é”®ä¸å­˜åœ¨ã€‚</li></ol><h4 id="è„è¯»å¹»è¯»çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è„è¯»å¹»è¯»çš„é—®é¢˜" aria-hidden="true">#</a> è„è¯»å¹»è¯»çš„é—®é¢˜</h4><p>è„è¯»</p><hr><p>T1 ä¿®æ”¹ä¸€ä¸ªæ•°æ®ï¼ŒT2 éšåè¯»å–è¿™ä¸ªæ•°æ®ã€‚å¦‚æœ T1 æ’¤é”€äº†è¿™æ¬¡ä¿®æ”¹ï¼Œé‚£ä¹ˆ T2 è¯»å–çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚</p><figure><img src="'+is+'" alt="image-20220404205106515" tabindex="0" loading="lazy"><figcaption>image-20220404205106515</figcaption></figure><p>å¹»è¯»</p><hr><p>T1 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼ŒT2 åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼ŒT1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚</p><figure><img src="'+cs+'" alt="image-20220404205121978" tabindex="0" loading="lazy"><figcaption>image-20220404205121978</figcaption></figure><blockquote><p>ä¸ä»…ä» redis è§’åº¦ï¼ŒåŒæ—¶ä»æ•°æ®åº“å¹¶å‘å¯èƒ½äº§ç”Ÿé—®é¢˜è§’åº¦ç­”ç­”</p></blockquote><p>é™¤äº†ä¸Šè¿°é—®é¢˜çš„è„è¯»å’Œå¹»è¯»è¿˜æœ‰</p><p>ä¸¢å¤±ä¿®æ”¹</p><hr><p>T1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡éƒ½å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒT1 å…ˆä¿®æ”¹ï¼ŒT2 éšåä¿®æ”¹ï¼ŒT2 çš„ä¿®æ”¹è¦†ç›–äº† T1 çš„ä¿®æ”¹ã€‚</p><figure><img src="'+ls+'" alt="image-20220404205205248" tabindex="0" loading="lazy"><figcaption>image-20220404205205248</figcaption></figure><p>ä¸å¯é‡å¤è¯»</p><hr><p>T2 è¯»å–ä¸€ä¸ªæ•°æ®ï¼ŒT1 å¯¹è¯¥æ•°æ®åšäº†ä¿®æ”¹ã€‚å¦‚æœ T2 å†æ¬¡è¯»å–è¿™ä¸ªæ•°æ®ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚</p><figure><img src="'+rs+'" alt="image-20220404205224920" tabindex="0" loading="lazy"><figcaption>image-20220404205224920</figcaption></figure><p>äº§ç”Ÿå¹¶å‘ä¸ä¸€è‡´æ€§é—®é¢˜ä¸»è¦åŸå› æ˜¯ç ´åäº†äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡å¹¶å‘æ§åˆ¶æ¥ä¿è¯éš”ç¦»æ€§ã€‚å¹¶å‘æ§åˆ¶å¯ä»¥é€šè¿‡å°é”æ¥å®ç°ï¼Œä½†æ˜¯å°é”æ“ä½œéœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶ï¼Œç›¸å½“å¤æ‚ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œè®©ç”¨æˆ·ä»¥ä¸€ç§æ›´è½»æ¾çš„æ–¹å¼å¤„ç†å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</p><h4 id="redis-é«˜å¹¶å‘-é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#redis-é«˜å¹¶å‘-é«˜å¯ç”¨" aria-hidden="true">#</a> redis é«˜å¹¶å‘ &amp; é«˜å¯ç”¨</h4><p>ä¸€èˆ¬åƒ MySQL è¿™ç±»çš„æ•°æ®åº“çš„ QPS å¤§æ¦‚éƒ½åœ¨ 1w å·¦å³ï¼ˆ4 æ ¸ 8gï¼‰ ï¼Œä½†æ˜¯ä½¿ç”¨ Redis ç¼“å­˜ä¹‹åå¾ˆå®¹æ˜“è¾¾åˆ° 10w+ï¼Œç”šè‡³æœ€é«˜èƒ½è¾¾åˆ° 30w+ï¼ˆå°±å•æœº redis çš„æƒ…å†µï¼Œredis é›†ç¾¤çš„è¯ä¼šæ›´é«˜ï¼‰ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„æ•°æ®åº“è¯·æ±‚æ•°é‡æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚è¿›è€Œï¼Œæˆ‘ä»¬ä¹Ÿå°±æé«˜äº†ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘ã€‚</p>',59),Ep={href:"https://www.pdai.tech/md/db/nosql-redis/db-redis-x-copy.html",target:"_blank",rel:"noopener noreferrer"},Op={href:"https://www.pdai.tech/md/db/nosql-redis/db-redis-x-sentinel.html",target:"_blank",rel:"noopener noreferrer"},Bp=t('<h4 id="redis-ä¸»ä»æ˜¯æ€ä¹ˆåšçš„-é«˜å¯ç”¨èŒƒç•´" tabindex="-1"><a class="header-anchor" href="#redis-ä¸»ä»æ˜¯æ€ä¹ˆåšçš„-é«˜å¯ç”¨èŒƒç•´" aria-hidden="true">#</a> redis ä¸»ä»æ˜¯æ€ä¹ˆåšçš„ï¼ˆé«˜å¯ç”¨èŒƒç•´ï¼‰</h4><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><p><strong>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</strong>ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><p>ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯<strong>è¯»å†™åˆ†ç¦»</strong>çš„æ–¹å¼ã€‚</p><ul><li>è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼›</li><li>å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚</li></ul><figure><img src="'+us+'" alt="image-20220610203922954" tabindex="0" loading="lazy"><figcaption>image-20220610203922954</figcaption></figure>',7),Dp={href:"https://www.pdai.tech/md/db/nosql-redis/db-redis-x-copy.html#redis%E8%BF%9B%E9%98%B6---%E9%AB%98%E5%8F%AF%E7%94%A8%EF%BC%9A%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%AF%A6%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"},zp=t('<blockquote><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å° Redis æœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„ Redis æœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p></blockquote><p><strong>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</strong>ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™ Redis æ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯» Redis æ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜ Redis æœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯ Redis é«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><p>ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯<strong>è¯»å†™åˆ†ç¦»</strong>çš„æ–¹å¼ã€‚</p><ul><li>è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼›</li><li>å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚</li></ul><figure><img src="'+ds+`" alt="image-20220404205326561" tabindex="0" loading="lazy"><figcaption>image-20220404205326561</figcaption></figure><p>åŸç†</p><hr><blockquote><p>æ³¨æ„ï¼šåœ¨ 2.8 ç‰ˆæœ¬ä¹‹å‰åªæœ‰å…¨é‡å¤åˆ¶ï¼Œè€Œ 2.8 ç‰ˆæœ¬åæœ‰å…¨é‡å’Œå¢é‡å¤åˆ¶ï¼š</p></blockquote><ul><li><code>å…¨é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</code>ï¼šæ¯”å¦‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶</li><li><code>å¢é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</code>ï¼šåªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“</li></ul><p>å…¨é‡å¤åˆ¶</p><hr><p>å½“æˆ‘ä»¬å¯åŠ¨å¤šä¸ª Redis å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ç›¸äº’ä¹‹é—´å°±å¯ä»¥é€šè¿‡ replicaofï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»åº“å’Œä»åº“çš„å…³ç³»ï¼Œä¹‹åä¼šæŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µå®Œæˆæ•°æ®çš„ç¬¬ä¸€æ¬¡åŒæ­¥ã€‚</p><ul><li><strong>ç¡®ç«‹ä¸»ä»å…³ç³»</strong></li></ul><p>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰å®ä¾‹ 1ï¼ˆipï¼š172.16.19.3ï¼‰å’Œå®ä¾‹ 2ï¼ˆipï¼š172.16.19.5ï¼‰ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åï¼Œå®ä¾‹ 2 å°±å˜æˆäº†å®ä¾‹ 1 çš„ä»åº“ï¼Œå¹¶ä»å®ä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>replicaof <span class="token number">172.16</span>.19.3 <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µ</strong></li></ul><p>ä½ å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼Œæœ‰ä¸ªæ•´ä½“æ„ŸçŸ¥ï¼Œæ¥ä¸‹æ¥æˆ‘å†å…·ä½“ä»‹ç»</p><figure><img src="`+ks+'" alt="image-20220404205423809" tabindex="0" loading="lazy"><figcaption>image-20220404205423809</figcaption></figure><p><strong>ç¬¬ä¸€é˜¶æ®µæ˜¯ä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥çš„è¿‡ç¨‹</strong>ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°ã€‚runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚offsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒFULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“ã€‚</p><p><strong>ç¬¬äºŒé˜¶æ®µï¼Œä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“</strong>ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆ RDB æ–‡ä»¶ï¼Œæ¥ç€å°†æ–‡ä»¶å‘ç»™ä»åº“ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œä¸»åº“ä¼šæŠŠç¬¬äºŒé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­æ–°æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†å‘é€ç»™ä»åº“</strong>ã€‚å…·ä½“çš„æ“ä½œæ˜¯ï¼Œå½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“å°±å®ç°åŒæ­¥äº†</p><p>å¢é‡å¤åˆ¶</p><hr><blockquote><p>åœ¨ Redis 2.8 ç‰ˆæœ¬å¼•å…¥äº†å¢é‡å¤åˆ¶ã€‚</p></blockquote><ul><li><strong>ä¸ºä»€ä¹ˆä¼šè®¾è®¡å¢é‡å¤åˆ¶</strong>ï¼Ÿ</li></ul><p>å¦‚æœä¸»ä»åº“åœ¨å‘½ä»¤ä¼ æ’­æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œé‚£ä¹ˆï¼Œä»åº“å°±ä¼šå’Œä¸»åº“é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¼€é”€éå¸¸å¤§ã€‚ä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­äº†ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚</p><ul><li><strong>å¢é‡å¤åˆ¶çš„æµç¨‹</strong></li></ul><p>ä½ å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼Œæœ‰ä¸ªæ•´ä½“æ„ŸçŸ¥ï¼Œæ¥ä¸‹æ¥æˆ‘å†å…·ä½“ä»‹ç»ã€‚</p><figure><img src="'+ms+'" alt="image-20220404205503926" tabindex="0" loading="lazy"><figcaption>image-20220404205503926</figcaption></figure><p>å…ˆçœ‹ä¸¤ä¸ªæ¦‚å¿µï¼š <code>replication buffer</code> å’Œ <code>repl_backlog_buffer</code></p><p><code>repl_backlog_buffer</code>ï¼šå®ƒæ˜¯ä¸ºäº†ä»åº“æ–­å¼€ä¹‹åï¼Œå¦‚ä½•æ‰¾åˆ°ä¸»ä»å·®å¼‚æ•°æ®è€Œè®¾è®¡çš„ç¯å½¢ç¼“å†²åŒºï¼Œä»è€Œé¿å…å…¨é‡å¤åˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚å¦‚æœä»åº“æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_backlog_buffer ç¯å½¢ç¼“å†²åŒºè¢«ä¸»åº“çš„å†™å‘½ä»¤è¦†ç›–äº†ï¼Œé‚£ä¹ˆä»åº“è¿ä¸Šä¸»åº“ååªèƒ½ä¹–ä¹–åœ°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œæ‰€ä»¥<strong>repl_backlog_buffer é…ç½®å°½é‡å¤§ä¸€äº›ï¼Œå¯ä»¥é™ä½ä¸»ä»æ–­å¼€åå…¨é‡å¤åˆ¶çš„æ¦‚ç‡</strong>ã€‚è€Œåœ¨ repl_backlog_buffer ä¸­æ‰¾ä¸»ä»å·®å¼‚çš„æ•°æ®åï¼Œå¦‚ä½•å‘ç»™ä»åº“å‘¢ï¼Ÿè¿™å°±ç”¨åˆ°äº† replication bufferã€‚</p><p><code>replication buffer</code>ï¼šRedis å’Œå®¢æˆ·ç«¯é€šä¿¡ä¹Ÿå¥½ï¼Œå’Œä»åº“é€šä¿¡ä¹Ÿå¥½ï¼ŒRedis éƒ½éœ€è¦ç»™åˆ†é…ä¸€ä¸ª å†…å­˜ buffer è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ª clientï¼Œä»åº“ä¹Ÿæ˜¯ä¸€ä¸ª clientï¼Œæˆ‘ä»¬æ¯ä¸ª client è¿ä¸Š Redis åï¼ŒRedis éƒ½ä¼šåˆ†é…ä¸€ä¸ª client bufferï¼Œæ‰€æœ‰æ•°æ®äº¤äº’éƒ½æ˜¯é€šè¿‡è¿™ä¸ª buffer è¿›è¡Œçš„ï¼šRedis å…ˆæŠŠæ•°æ®å†™åˆ°è¿™ä¸ª buffer ä¸­ï¼Œç„¶åå†æŠŠ buffer ä¸­çš„æ•°æ®å‘åˆ° client socket ä¸­å†é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œè¿™æ ·å°±å®Œæˆäº†æ•°æ®äº¤äº’ã€‚æ‰€ä»¥ä¸»ä»åœ¨å¢é‡åŒæ­¥æ—¶ï¼Œä»åº“ä½œä¸ºä¸€ä¸ª clientï¼Œä¹Ÿä¼šåˆ†é…ä¸€ä¸ª bufferï¼Œåªä¸è¿‡è¿™ä¸ª buffer ä¸“é—¨ç”¨æ¥ä¼ æ’­ç”¨æˆ·çš„å†™å‘½ä»¤åˆ°ä»åº“ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åš replication bufferã€‚</p><ul><li><strong>å¦‚æœåœ¨ç½‘ç»œæ–­å¼€æœŸé—´ï¼Œrepl_backlog_size ç¯å½¢ç¼“å†²åŒºå†™æ»¡ä¹‹åï¼Œä»åº“æ˜¯ä¼šä¸¢å¤±æ‰é‚£éƒ¨åˆ†è¢«è¦†ç›–æ‰çš„æ•°æ®ï¼Œè¿˜æ˜¯ç›´æ¥è¿›è¡Œå…¨é‡å¤åˆ¶å‘¢</strong>ï¼Ÿ</li></ul><p>å¯¹äºè¿™ä¸ªé—®é¢˜æ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li>ä¸€ä¸ªä»åº“å¦‚æœå’Œä¸»åº“æ–­è¿æ—¶é—´è¿‡é•¿ï¼Œé€ æˆå®ƒåœ¨ä¸»åº“ repl_backlog_buffer çš„ slave_repl_offset ä½ç½®ä¸Šçš„æ•°æ®å·²ç»è¢«è¦†ç›–æ‰äº†ï¼Œæ­¤æ—¶ä»åº“å’Œä¸»åº“é—´å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚</li><li>æ¯ä¸ªä»åº“ä¼šè®°å½•è‡ªå·±çš„ slave_repl_offsetï¼Œæ¯ä¸ªä»åº“çš„å¤åˆ¶è¿›åº¦ä¹Ÿä¸ä¸€å®šç›¸åŒã€‚åœ¨å’Œä¸»åº“é‡è¿è¿›è¡Œæ¢å¤æ—¶ï¼Œä»åº“ä¼šé€šè¿‡ psync å‘½ä»¤æŠŠè‡ªå·±è®°å½•çš„ slave_repl_offset å‘ç»™ä¸»åº“ï¼Œä¸»åº“ä¼šæ ¹æ®ä»åº“å„è‡ªçš„å¤åˆ¶è¿›åº¦ï¼Œæ¥å†³å®šè¿™ä¸ªä»åº“å¯ä»¥è¿›è¡Œå¢é‡å¤åˆ¶ï¼Œè¿˜æ˜¯å…¨é‡å¤åˆ¶ã€‚</li></ol><p>æ€»ç»“ï¼š</p><p>åœ¨ä½¿ç”¨è¯»å†™åˆ†ç¦»ä¹‹å‰ï¼Œå¯ä»¥è€ƒè™‘å…¶ä»–æ–¹æ³•å¢åŠ  Redis çš„è¯»è´Ÿè½½èƒ½åŠ›ï¼šå¦‚å°½é‡ä¼˜åŒ–ä¸»èŠ‚ç‚¹ï¼ˆå‡å°‘æ…¢æŸ¥è¯¢ã€å‡å°‘æŒä¹…åŒ–ç­‰å…¶ä»–æƒ…å†µå¸¦æ¥çš„é˜»å¡ç­‰ï¼‰æé«˜è´Ÿè½½èƒ½åŠ›ï¼›ä½¿ç”¨ Redis é›†ç¾¤åŒæ—¶æé«˜è¯»è´Ÿè½½èƒ½åŠ›å’Œå†™è´Ÿè½½èƒ½åŠ›ç­‰ã€‚å¦‚æœä½¿ç”¨è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ä½¿ç”¨å“¨å…µï¼Œä½¿ä¸»ä»èŠ‚ç‚¹çš„æ•…éšœåˆ‡æ¢å°½å¯èƒ½è‡ªåŠ¨åŒ–ï¼Œå¹¶å‡å°‘å¯¹åº”ç”¨ç¨‹åºçš„ä¾µå…¥ã€‚</p><h4 id="ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿-ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©-ç¼“å­˜å‡»ç©¿-ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> ç¼“å­˜é›ªå´©ï¼Œç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜é›ªå´©</p><hr><p>å®é™…ä¸Šï¼Œç¼“å­˜é›ªå´©æè¿°çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚ã€‚ è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šç³»ç»Ÿçš„ç¼“å­˜æ¨¡å—å‡ºäº†é—®é¢˜æ¯”å¦‚å®•æœºå¯¼è‡´ä¸å¯ç”¨ã€‚é€ æˆç³»ç»Ÿçš„æ‰€æœ‰è®¿é—®ï¼Œéƒ½è¦èµ°æ•°æ®åº“ã€‚</p><p>è¿˜æœ‰ä¸€ç§ç¼“å­˜é›ªå´©çš„åœºæ™¯æ˜¯ï¼šæœ‰ä¸€äº›è¢«å¤§é‡è®¿é—®æ•°æ®ï¼ˆçƒ­ç‚¹ç¼“å­˜ï¼‰åœ¨æŸä¸€æ—¶åˆ»å¤§é¢ç§¯å¤±æ•ˆï¼Œå¯¼è‡´å¯¹åº”çš„è¯·æ±‚ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šã€‚ è¿™æ ·çš„æƒ…å†µï¼Œæœ‰ä¸‹é¢å‡ ç§è§£å†³åŠæ³•ï¼š</p><p>ä¸¾ä¸ªä¾‹å­ ï¼šç§’æ€å¼€å§‹ 12 ä¸ªå°æ—¶ä¹‹å‰ï¼Œæˆ‘ä»¬ç»Ÿä¸€å­˜æ”¾äº†ä¸€æ‰¹å•†å“åˆ° Redis ä¸­ï¼Œè®¾ç½®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯ 12 ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆç§’æ€å¼€å§‹çš„æ—¶å€™ï¼Œè¿™äº›ç§’æ€çš„å•†å“çš„è®¿é—®ç›´æ¥å°±å¤±æ•ˆäº†ã€‚å¯¼è‡´çš„æƒ…å†µå°±æ˜¯ï¼Œç›¸åº”çš„è¯·æ±‚ç›´æ¥å°±è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå°±åƒé›ªå´©ä¸€æ ·å¯æ€•ã€‚</p><ul><li><strong>é—®é¢˜æ¥æº</strong></li></ul><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­<strong>æ•°æ®å¤§æ‰¹é‡åˆ°è¿‡æœŸæ—¶é—´ï¼Œè€ŒæŸ¥è¯¢æ•°æ®é‡å·¨å¤§ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³ down æœº</strong>ã€‚å’Œç¼“å­˜å‡»ç©¿ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚</p><ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong></li></ul><ol><li>ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®éšæœºï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿã€‚</li><li>å¦‚æœç¼“å­˜æ•°æ®åº“æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå°†çƒ­ç‚¹æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ä¸åŒçš„ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</li><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸ</li></ol><p>ç¼“å­˜å‡»ç©¿</p><hr><ul><li><strong>é—®é¢˜æ¥æº</strong></li></ul><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡<strong>ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®</strong>ï¼ˆä¸€èˆ¬æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸï¼‰ï¼Œè¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œé€ æˆè¿‡å¤§å‹åŠ›ã€‚</p><ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong></li></ul><p>1ã€è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸã€‚</p><p>2ã€æ¥å£é™æµä¸ç†”æ–­ï¼Œé™çº§ã€‚é‡è¦çš„æ¥å£ä¸€å®šè¦åšå¥½é™æµç­–ç•¥ï¼Œé˜²æ­¢ç”¨æˆ·æ¶æ„åˆ·æ¥å£ï¼ŒåŒæ—¶è¦é™çº§å‡†å¤‡ï¼Œå½“æ¥å£ä¸­çš„æŸäº› æœåŠ¡ ä¸å¯ç”¨æ—¶å€™ï¼Œè¿›è¡Œç†”æ–­ï¼Œå¤±è´¥å¿«é€Ÿè¿”å›æœºåˆ¶ã€‚</p><p>3ã€åŠ äº’æ–¥é”</p><p>ç¼“å­˜ç©¿é€</p><hr><p>ç¼“å­˜ç©¿é€è¯´ç®€å•ç‚¹å°±æ˜¯å¤§é‡è¯·æ±‚çš„ key æ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ æˆ‘ä»¬ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ã€‚</p><ul><li><strong>é—®é¢˜æ¥æº</strong></li></ul><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡<strong>ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®</strong>ï¼Œè€Œç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚ã€‚ç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</p><p>åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½ DB å°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„ key é¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚</p><p>å¦‚å‘èµ·ä¸º id ä¸ºâ€œ-1â€çš„æ•°æ®æˆ– id ä¸ºç‰¹åˆ«å¤§ä¸å­˜åœ¨çš„æ•°æ®ã€‚è¿™æ—¶çš„ç”¨æˆ·å¾ˆå¯èƒ½æ˜¯æ”»å‡»è€…ï¼Œæ”»å‡»ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚</p><ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong></li></ul><ol><li>æ¥å£å±‚å¢åŠ æ ¡éªŒï¼Œå¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼Œid åšåŸºç¡€æ ¡éªŒï¼Œid&lt;=0 çš„ç›´æ¥æ‹¦æˆªï¼›</li><li>ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°† key-value å¯¹å†™ä¸º key-nullï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚ 30 ç§’ï¼ˆè®¾ç½®å¤ªé•¿ä¼šå¯¼è‡´æ­£å¸¸æƒ…å†µä¹Ÿæ²¡æ³•ä½¿ç”¨ï¼‰ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ª id æš´åŠ›æ”»å‡»</li><li>å¸ƒéš†è¿‡æ»¤å™¨ã€‚bloomfilter å°±ç±»ä¼¼äºä¸€ä¸ª hash setï¼Œç”¨äºå¿«é€Ÿåˆ¤æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå…¶å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ª key æ˜¯å¦å­˜åœ¨äºæŸå®¹å™¨ï¼Œä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ã€‚å¸ƒéš†è¿‡æ»¤å™¨çš„å…³é”®å°±åœ¨äº hash ç®—æ³•å’Œå®¹å™¨å¤§å°ï¼Œ</li></ol><h4 id="ç¼“å­˜æœ‰å“ªäº›-ehcache-å’Œ-redis-åŒºåˆ«-ehcache-ä¸ºä»€ä¹ˆæ•ˆç‡é«˜" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜æœ‰å“ªäº›-ehcache-å’Œ-redis-åŒºåˆ«-ehcache-ä¸ºä»€ä¹ˆæ•ˆç‡é«˜" aria-hidden="true">#</a> ç¼“å­˜æœ‰å“ªäº›ï¼ŒEhcache å’Œ Redis åŒºåˆ«ï¼ŒEhcache ä¸ºä»€ä¹ˆæ•ˆç‡é«˜</h4><p>ç¼“å­˜æœ‰å„ç±»ç‰¹å¾ï¼Œè€Œä¸”æœ‰ä¸åŒä»‹è´¨çš„åŒºåˆ«ï¼Œé‚£ä¹ˆå®é™…å·¥ç¨‹ä¸­æˆ‘ä»¬æ€ä¹ˆå»å¯¹ç¼“å­˜åˆ†ç±»å‘¢? åœ¨ç›®å‰çš„åº”ç”¨æœåŠ¡æ¡†æ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯æ ¹æ®ç¼“å­˜ä¸åº”ç”¨çš„è—•åˆåº¦ï¼Œåˆ†ä¸ºlocal cacheï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰å’Œremote cacheï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰ï¼š</p><ul><li><strong>æœ¬åœ°ç¼“å­˜</strong>ï¼šæŒ‡çš„æ˜¯åœ¨åº”ç”¨ä¸­çš„ç¼“å­˜ç»„ä»¶ï¼Œå…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åº”ç”¨å’Œcacheæ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œè¯·æ±‚ç¼“å­˜éå¸¸å¿«é€Ÿï¼Œæ²¡æœ‰è¿‡å¤šçš„ç½‘ç»œå¼€é”€ç­‰ï¼Œåœ¨å•åº”ç”¨ä¸éœ€è¦é›†ç¾¤æ”¯æŒæˆ–è€…é›†ç¾¤æƒ…å†µä¸‹å„èŠ‚ç‚¹æ— éœ€äº’ç›¸é€šçŸ¥çš„åœºæ™¯ä¸‹ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¾ƒåˆé€‚ï¼›åŒæ—¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯åº”ä¸ºç¼“å­˜è·Ÿåº”ç”¨ç¨‹åºè€¦åˆï¼Œå¤šä¸ªåº”ç”¨ç¨‹åºæ— æ³•ç›´æ¥çš„å…±äº«ç¼“å­˜ï¼Œå„åº”ç”¨æˆ–é›†ç¾¤çš„å„èŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤è‡ªå·±çš„å•ç‹¬ç¼“å­˜ï¼Œå¯¹å†…å­˜æ˜¯ä¸€ç§æµªè´¹ã€‚</li><li><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šæŒ‡çš„æ˜¯ä¸åº”ç”¨åˆ†ç¦»çš„ç¼“å­˜ç»„ä»¶æˆ–æœåŠ¡ï¼Œå…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯è‡ªèº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œä¸æœ¬åœ°åº”ç”¨éš”ç¦»ï¼Œå¤šä¸ªåº”ç”¨å¯ç›´æ¥çš„å…±äº«ç¼“å­˜ã€‚</li></ul><p>EhCacheç›´æ¥åœ¨JVMä¸­è¿›è¡Œç¼“å­˜ï¼Œé€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ã€‚ä¸Redisç›¸æ¯”ï¼Œæ“ä½œç®€å•ã€æ˜“ç”¨ã€é«˜æ•ˆï¼Œè™½ç„¶EhCacheä¹Ÿæä¾›æœ‰ç¼“å­˜å…±äº«çš„æ–¹æ¡ˆï¼Œä½†å¯¹åˆ†å¸ƒå¼é›†ç¾¤çš„æ”¯æŒä¸å¤ªå¥½ï¼Œç¼“å­˜å…±äº«å®ç°éº»çƒ¦ã€‚</p><p>Redisæ˜¯é€šè¿‡Socketè®¿é—®åˆ°ç¼“å­˜æœåŠ¡ï¼Œæ•ˆç‡æ¯”EhCacheä½ï¼Œæ¯”æ•°æ®åº“è¦å¿«å¾ˆå¤šï¼Œå¤„ç†é›†ç¾¤å’Œåˆ†å¸ƒå¼ç¼“å­˜æ–¹ä¾¿ï¼Œæœ‰æˆç†Ÿçš„æ–¹æ¡ˆã€‚</p><p><strong>æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å•ä½“åº”ç”¨ï¼Œæˆ–å¯¹ç¼“å­˜è®¿é—®è¦æ±‚å¾ˆé«˜ï¼Œå¯è€ƒè™‘é‡‡ç”¨EhCacheï¼›å¦‚æœæ˜¯å¤§å‹ç³»ç»Ÿï¼Œå­˜åœ¨ç¼“å­˜å…±äº«ã€åˆ†å¸ƒå¼éƒ¨ç½²ã€ç¼“å­˜å†…å®¹å¾ˆå¤§æ—¶ï¼Œåˆ™å»ºè®®é‡‡ç”¨Redis</strong>ã€‚</p><p>è¯¥æ¡†æ¶çš„ç‰¹ç‚¹ï¼š</p><ul><li>ç®€å•ã€å¿«é€Ÿï¼Œæ‹¥æœ‰å¤šç§ç¼“å­˜ç­–ç•¥ï¼›</li><li>ç¼“å­˜æ•°æ®æœ‰ä¸¤çº§ï¼šå†…å­˜å’Œç£ç›˜ï¼Œæ— éœ€æ‹…å¿ƒå®¹é‡é—®é¢˜ï¼›</li><li>ç¼“å­˜æ•°æ®ä¼šåœ¨è™šæ‹Ÿæœºé‡å¯çš„è¿‡ç¨‹ä¸­å†™å…¥ç£ç›˜ï¼›</li><li>å¯ä»¥é€šè¿‡RMIã€å¯æ’å…¥APIç­‰æ–¹å¼è¿›è¡Œåˆ†å¸ƒå¼ç¼“å­˜ï¼›</li><li>å…·æœ‰ç¼“å­˜å’Œç¼“å­˜ç®¡ç†å™¨çš„ä¾¦å¬æ¥å£ï¼›</li><li>æ”¯æŒå¤šç¼“å­˜ç®¡ç†å™¨å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªå®ä¾‹çš„å¤šä¸ªç¼“å­˜åŒºåŸŸï¼Œå¹¶æä¾›Hibernateçš„ç¼“å­˜å®ç°ï¼›</li></ul><h4 id="redis-åˆ†å¸ƒå¼é›†ç¾¤æ˜¯æ€ä¹ˆå®ç°çš„" tabindex="-1"><a class="header-anchor" href="#redis-åˆ†å¸ƒå¼é›†ç¾¤æ˜¯æ€ä¹ˆå®ç°çš„" aria-hidden="true">#</a> Redis åˆ†å¸ƒå¼é›†ç¾¤æ˜¯æ€ä¹ˆå®ç°çš„</h4><p>Redis åˆ†å¸ƒå¼é›†ç¾¤æ˜¯é€šè¿‡å°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šæ¥å®ç°é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§çš„ã€‚Redis åˆ†å¸ƒå¼é›†ç¾¤é‡‡ç”¨äº†ä¸€ç§åä¸ºâ€œå“ˆå¸Œæ§½ï¼ˆhash slotï¼‰â€çš„æŠ€æœ¯æ¥å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒRedis åˆ†å¸ƒå¼é›†ç¾¤å°†æ•°æ®åˆ†æˆå¤šä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªæ§½éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè´Ÿè´£ä¸€éƒ¨åˆ†æ§½ï¼Œå¯ä»¥è´Ÿè´£å¤šä¸ªæ§½ã€‚å½“å®¢æˆ·ç«¯éœ€è¦è®¿é—®ä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼ŒRedis é¦–å…ˆæ ¹æ®è¯¥é”®çš„å“ˆå¸Œå€¼ç¡®å®šå®ƒåº”è¯¥è¢«å­˜å‚¨åœ¨å“ªä¸ªæ§½ä¸­ï¼Œç„¶åé€šè¿‡é›†ç¾¤ä¸­çš„è·¯ç”±ç®—æ³•æ‰¾åˆ°è´Ÿè´£è¯¥æ§½çš„èŠ‚ç‚¹ï¼Œå¹¶å°†è¯·æ±‚å‘é€åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚</p><p>åœ¨ Redis åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‰§è¡Œè¯»å’Œå†™æ“ä½œã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒRedis é‡‡ç”¨äº†ä¸€ç§åä¸ºâ€œRedis å“¨å…µï¼ˆRedis Sentinelï¼‰â€çš„æœºåˆ¶æ¥ç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹å¤±æ•ˆæ—¶è‡ªåŠ¨å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚Redis å“¨å…µè¿˜è´Ÿè´£ç›‘æ§æ§½çš„åˆ†é…æƒ…å†µï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡æ–°åˆ†é…æ§½ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒRedis åˆ†å¸ƒå¼é›†ç¾¤é€šè¿‡å“ˆå¸Œæ§½å’Œ Redis å“¨å…µç­‰æŠ€æœ¯å®ç°äº†æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ã€è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ï¼Œä½¿å¾— Redis å¯ä»¥å¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œé«˜å¹¶å‘è¯·æ±‚ã€‚</p><h4 id="redisåº”ç”¨åœºæ™¯æœ‰å“ªäº›-2022å­—èŠ‚å®ä¹ " tabindex="-1"><a class="header-anchor" href="#redisåº”ç”¨åœºæ™¯æœ‰å“ªäº›-2022å­—èŠ‚å®ä¹ " aria-hidden="true">#</a> Redisåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼ˆ2022å­—èŠ‚å®ä¹ ï¼‰</h4><p>å¯ä»¥å‚è€ƒä¸Šæ–‡çš„Redisæ•°æ®ç»“æ„å¯¹åº”çš„åº”ç”¨åœºæ™¯</p><ul><li>redis å®¢æˆ·ç«¯æœ‰å“ªäº›</li></ul><p>Redissonã€Jedisã€lettuceç­‰ç­‰ï¼Œå®˜æ–¹æ¨èä½¿ç”¨Redissonã€‚</p><p>Redissonæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒRediså®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº›Javaçš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚</p><ul><li><p>Rediså¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</p><p>Redisåœ¨2.6ç‰ˆæœ¬å¼•å…¥äº†pipelineæ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥æ“ä½œã€‚Pipelineæ¨¡å¼æ˜¯ä¸€ç§å°†å¤šä¸ªå‘½ä»¤ä¸€æ¬¡æ€§å‘é€ç»™RedisæœåŠ¡å™¨å¹¶è¿”å›ç»“æœçš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯çš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ¬¡æ•°ï¼Œä»è€Œæé«˜æ•°æ®æ’å…¥çš„æ€§èƒ½ã€‚</p><p>åœ¨ä½¿ç”¨Redisçš„pipelineæ¨¡å¼æ—¶ï¼Œéœ€è¦å°†éœ€è¦æ’å…¥çš„æ•°æ®é¢„å…ˆå­˜å‚¨åœ¨å®¢æˆ·ç«¯å†…å­˜ä¸­ï¼Œç„¶åä¸€æ¬¡æ€§å°†è¿™äº›æ•°æ®å‘é€ç»™RedisæœåŠ¡å™¨ã€‚RedisæœåŠ¡å™¨å°†è¿™äº›æ•°æ®æ’å…¥åˆ°å†…å­˜ä¸­ï¼Œç„¶åè¿”å›æ’å…¥æ“ä½œçš„ç»“æœã€‚</p></li><li><p>rediså®ç°åˆ†å¸ƒå¼é”å®ç°? ä»€ä¹ˆæ˜¯ RedLock?</p><p>Rediså®ç°åˆ†å¸ƒå¼é”å¯ä»¥é€šè¿‡ä½¿ç”¨Redisçš„å•çº¿ç¨‹ç‰¹æ€§å’ŒåŸå­æ€§æ“ä½œæ¥ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„äº’æ–¥è®¿é—®ã€‚ä¸‹é¢æ˜¯ä¸€ç§åŸºäºRediså®ç°åˆ†å¸ƒå¼é”çš„å¸¸è§æ–¹å¼ï¼š</p><ol><li>è·å–é”ï¼šä½¿ç”¨Redisçš„SETå‘½ä»¤è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®è¡¨ç¤ºé”çš„åç§°ï¼Œå€¼ä¸ºä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ã€‚ä½¿ç”¨SETå‘½ä»¤æ—¶å¯ä»¥è®¾ç½®ä¸€ä¸ªNXï¼ˆNot eXistsï¼‰é€‰é¡¹ï¼Œè¡¨ç¤ºåªæœ‰å½“é”ä¸å­˜åœ¨æ—¶æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œé˜²æ­¢é”è¢«é‡å¤è·å–ã€‚</li><li>é‡Šæ”¾é”ï¼šä½¿ç”¨Redisçš„DELå‘½ä»¤åˆ é™¤é”å¯¹åº”çš„é”®å€¼å¯¹ï¼Œè¡¨ç¤ºé”å·²ç»é‡Šæ”¾ã€‚</li><li>é”è¿‡æœŸæ—¶é—´ï¼šä¸ºäº†é˜²æ­¢é”è¢«æŒæœ‰è€…æ„å¤–å®•æœºæˆ–è€…æ­»é”å¯¼è‡´å…¶ä»–è¿›ç¨‹æ— æ³•è·å–é”ï¼Œéœ€è¦ä¸ºé”è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚å¯ä»¥ä½¿ç”¨Redisçš„EXPIREå‘½ä»¤è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</li></ol><p>ä½†æ˜¯ï¼Œå•çº¯çš„Redisé”å­˜åœ¨è¢«è¯¯ç”¨æˆ–è€…ç«äº‰ç¯å¢ƒä¸‹é”å¤±æ•ˆç­‰é—®é¢˜ï¼Œé’ˆå¯¹è¿™äº›é—®é¢˜ï¼ŒRedLockè¢«æå‡ºã€‚</p><p>RedLockæ˜¯ä¸€ç§ç”¨äºå®ç°åˆ†å¸ƒå¼é”çš„ç®—æ³•ï¼Œå®ƒç”±å¤šä¸ªRediså®ä¾‹ç»„æˆï¼Œæä¾›äº†æ›´é«˜çº§åˆ«çš„åˆ†å¸ƒå¼é”ä¿è¯ã€‚å®ƒå¯ä»¥è§£å†³ç”±äºç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨æ•…éšœç­‰åŸå› å¯¼è‡´çš„åˆ†å¸ƒå¼é”å¤±æ•ˆé—®é¢˜ã€‚</p><p>RedLockç®—æ³•çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨å¤šä¸ªRediså®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªäº’æ–¥é”ï¼Œä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è·å¾—è¯¥é”ã€‚å…·ä½“å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><ol><li>é€‰æ‹©Nä¸ªRediså®ä¾‹ï¼Œå®ƒä»¬åº”è¯¥åœ¨ä¸åŒçš„ç‰©ç†ä½ç½®ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li><li>æ¯ä¸ªRediså®ä¾‹åœ¨åŒä¸€ä¸ªKeyä¸Šå°è¯•è·å–é”ï¼Œä½¿ç”¨SETå‘½ä»¤åŠ ä¸ŠNXï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰å’ŒPXï¼ˆè¿‡æœŸæ—¶é—´ï¼‰å‚æ•°ï¼Œä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è·å¾—è¯¥é”ã€‚</li><li>å¦‚æœå®¢æˆ·ç«¯åœ¨è‡³å°‘N/2+1ä¸ªRediså®ä¾‹ä¸ŠæˆåŠŸè·å–äº†é”ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±å¯ä»¥è·å¾—è¿™ä¸ªé”ã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯å¿…é¡»é‡Šæ”¾æ‰€æœ‰å·²ç»è·å–çš„é”ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨RedLockç®—æ³•ï¼Œå¯ä»¥è§£å†³å•ç‚¹æ•…éšœå’Œç½‘ç»œé—®é¢˜å¯¼è‡´çš„åˆ†å¸ƒå¼é”å¤±æ•ˆé—®é¢˜</p></li><li><p>redisç¼“å­˜æœ‰å“ªäº›é—®é¢˜ï¼Œå¦‚ä½•è§£å†³</p><p>ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿</p></li><li><p>rediså’Œå…¶å®ƒæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜å¦‚ä½•è§£å†³</p><ol><li>æ•°æ®åŒæ­¥ï¼šå°†æ•°æ®ä»å…¶ä»–æ•°æ®åº“åŒæ­¥åˆ°Redisä¸­ï¼Œæˆ–è€…å°†Redisä¸­çš„æ•°æ®åŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ã€‚è¿™ç§æ–¹å¼éœ€è¦ä½¿ç”¨é¢å¤–çš„å·¥å…·æ¥å®Œæˆæ•°æ®åŒæ­¥ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦å’Œå»¶è¿Ÿã€‚</li><li>åŒå†™æ¨¡å¼ï¼šåœ¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼ŒåŒæ—¶å°†æ•°æ®å†™å…¥Rediså’Œå…¶ä»–æ•°æ®åº“ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—æ›´å¤šçš„èµ„æºå’Œæ—¶é—´ã€‚</li><li>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æ¨¡å¼ï¼šåœ¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå°†æ•°æ®å†™å…¥Redisï¼Œç„¶åé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†å†™å…¥è¯·æ±‚å‘é€åˆ°å…¶ä»–æ•°æ®åº“ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”å¯ä»¥å‡å°‘å†™å…¥å»¶è¿Ÿï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—æ›´å¤šçš„èµ„æºå’Œæ—¶é—´ã€‚</li></ol></li><li><p>redisæ€§èƒ½é—®é¢˜æœ‰å“ªäº›ï¼Œå¦‚ä½•åˆ†æå®šä½è§£å†³</p><p>Redisçš„æ€§èƒ½é—®é¢˜é€šå¸¸å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>CPU è´Ÿè½½é«˜ï¼šRedisé€šå¸¸ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œå¦‚æœRediså®ä¾‹çš„CPUè´Ÿè½½è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚å“åº”æ—¶é—´å¢åŠ ï¼Œç”šè‡³å¯¼è‡´è¯·æ±‚è¶…æ—¶ç­‰é—®é¢˜ã€‚</li><li>å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼šRedisæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚æœRediså®ä¾‹çš„å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å’Œæ•°æ®è¢«é€å‡ºå†…å­˜ç­‰é—®é¢˜ã€‚</li><li>IO è´Ÿè½½è¿‡é«˜ï¼šRedisåœ¨è¿›è¡ŒæŒä¹…åŒ–æ“ä½œå’Œç½‘ç»œé€šä¿¡æ—¶ä¼šäº§ç”ŸIOæ“ä½œï¼Œå¦‚æœIOè´Ÿè½½è¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´Rediså®ä¾‹å“åº”æ—¶é—´å¢åŠ ã€‚</li><li>ç½‘ç»œå»¶è¿Ÿè¿‡é«˜ï¼šRedisé€šå¸¸ä½œä¸ºåº”ç”¨ç¨‹åºå’Œæ•°æ®å­˜å‚¨ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œå¦‚æœç½‘ç»œå»¶è¿Ÿè¿‡é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´Rediså®ä¾‹å“åº”æ—¶é—´å¢åŠ ã€‚</li></ol><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½è¿›è¡Œè§£å†³ï¼š</p><ol><li>å†…å­˜å ç”¨è¿‡é«˜ï¼šé€šè¿‡åˆ é™¤ä¸å¿…è¦çš„æ•°æ®æˆ–è€…ä½¿ç”¨Redisçš„è¿‡æœŸæœºåˆ¶æ¥é‡Šæ”¾å†…å­˜ï¼Œæˆ–è€…ä½¿ç”¨Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æ¥è‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚</li><li>Rediså“åº”å»¶è¿Ÿè¿‡é«˜ï¼šå¯ä»¥é€šè¿‡ä¼˜åŒ–Redisçš„é…ç½®ã€æ‰©å®¹Rediså®ä¾‹ã€ä½¿ç”¨Redisé›†ç¾¤ç­‰æ–¹å¼æ¥æé«˜Redisçš„æ€§èƒ½ã€‚</li><li>CPU è´Ÿè½½é«˜ï¼šå¯ä»¥é€šè¿‡å°†Redisçš„è´Ÿè½½åˆ†æ•£åˆ°å¤šä¸ªRediså®ä¾‹ä¸­ï¼Œæˆ–è€…ä½¿ç”¨å¤šçº¿ç¨‹çš„Rediså®ç°æ¥è§£å†³å•çº¿ç¨‹æ¨¡å‹å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</li><li>IO è´Ÿè½½è¿‡é«˜ï¼š å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©é€‚å½“çš„æŒä¹…åŒ–æ–¹å¼ï¼Œå¦‚ä½¿ç”¨RDBæˆ–è€…AOFï¼Œæˆ–è€…ä½¿ç”¨Redisçš„å¿«ç…§å¤‡ä»½åŠŸèƒ½æ¥è¿›è¡Œæ•°æ®å¤‡ä»½æˆ–è€…æ•°æ®æ¢å¤ã€‚</li></ol><p>åœ¨åˆ†æRedisæ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Redisè‡ªå¸¦çš„æ€§èƒ½ç›‘æ§å·¥å…·æˆ–è€…ç¬¬ä¸‰æ–¹çš„æ€§èƒ½ç›‘æ§å·¥å…·æ¥è¿›è¡Œå®šä½å’Œè§£å†³ã€‚å¸¸è§çš„å·¥å…·åŒ…æ‹¬ï¼š</p><ol><li>Redisè‡ªå¸¦çš„ç›‘æ§å·¥å…·redis-cliï¼Œå¯ä»¥ä½¿ç”¨redis-cliä¸­çš„monitorã€infoã€slowlogç­‰å‘½ä»¤è¿›è¡Œæ€§èƒ½ç›‘æ§å’Œé—®é¢˜æ’æŸ¥ã€‚</li><li>ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·ï¼Œå¦‚RedisInsightã€redis-statã€redis-topç­‰ï¼Œå¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢æˆ–è€…å‘½ä»¤è¡Œæ–¹å¼è¿›è¡ŒRedisæ€§èƒ½ç›‘æ§å’Œé—®é¢˜å®šä½ã€‚</li></ol><p>åœ¨ä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·æ—¶ï¼Œéœ€è¦å…³æ³¨Redisçš„CPUã€å†…å­˜ã€ç½‘ç»œç­‰æŒ‡æ ‡ï¼Œå°¤å…¶æ˜¯Redisçš„å‘½ä»¤å“åº”æ—¶é—´ã€å‘½ä»¤æ‰§è¡Œæ¬¡æ•°ç­‰æŒ‡æ ‡ï¼Œä»¥åŠRedisçš„æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯æ¥è¿›è¡Œé—®é¢˜æ’æŸ¥å’Œè§£å†³ã€‚</p></li></ul><h4 id="redissionæ€ä¹ˆå®ç°çš„-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#redissionæ€ä¹ˆå®ç°çš„-2022-è™¾çš®" aria-hidden="true">#</a> redissionæ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆ2022 è™¾çš®ï¼‰</h4><p>Redissionæ˜¯ä¸€ä¸ªåŸºäºRediså®ç°çš„åˆ†å¸ƒå¼é”å’Œå…¶ä»–åˆ†å¸ƒå¼æ•°æ®ç»“æ„çš„Javaåº“ï¼Œå…¶å®ç°ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>Redisè¿æ¥æ± ï¼šRedissioné€šè¿‡ä½¿ç”¨Redissonè¿æ¥æ± æ¥ç®¡ç†Redisè¿æ¥ï¼Œå®ç°å¯¹Redisçš„è®¿é—®å’Œæ“ä½œã€‚é€šè¿‡è¿æ¥æ± çš„æœºåˆ¶ï¼Œå¯ä»¥æé«˜å¯¹Redisçš„å¹¶å‘è®¿é—®æ€§èƒ½ï¼ŒåŒæ—¶é¿å…å¯¹Redisçš„è¿‡å¤šè¿æ¥è¯·æ±‚ï¼Œé€ æˆRedisçš„æ€§èƒ½é—®é¢˜ã€‚</li><li>åˆ†å¸ƒå¼é”ï¼šRedissioné€šè¿‡Redisçš„åŸå­æ“ä½œå®ç°äº†åˆ†å¸ƒå¼é”çš„æœºåˆ¶ï¼Œä¸»è¦æ˜¯ä½¿ç”¨Redisçš„setnxå‘½ä»¤å®ç°é”çš„å ç”¨å’Œé‡Šæ”¾ï¼Œä»¥åŠä½¿ç”¨Luaè„šæœ¬å®ç°äº†é”çš„è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼Œé¿å…äº†é”çš„è¿‡æœŸå’Œè¯¯é‡Šæ”¾é—®é¢˜ã€‚</li><li>åˆ†å¸ƒå¼é›†åˆï¼šRedissioné€šè¿‡Redisçš„Sorted Setå®ç°äº†åˆ†å¸ƒå¼é›†åˆçš„æœºåˆ¶ï¼Œå®ç°äº†ç±»ä¼¼äºJavaçš„TreeSetå’ŒTreeMapçš„æ•°æ®ç»“æ„ï¼ŒåŒæ—¶æ”¯æŒåˆ†å¸ƒå¼çš„å¹¶å‘è®¿é—®ã€‚</li><li>åˆ†å¸ƒå¼é˜Ÿåˆ—ï¼šRedissioné€šè¿‡Redisçš„Listå®ç°äº†åˆ†å¸ƒå¼é˜Ÿåˆ—çš„æœºåˆ¶ï¼Œæ”¯æŒå…ˆè¿›å…ˆå‡ºå’Œåè¿›å…ˆå‡ºä¸¤ç§æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒåˆ†å¸ƒå¼çš„å¹¶å‘è®¿é—®ã€‚</li><li>åˆ†å¸ƒå¼é™æµï¼šRedissioné€šè¿‡Redisçš„è®¡æ•°å™¨å’Œé™æµå™¨å®ç°äº†åˆ†å¸ƒå¼é™æµçš„æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼ŒåŒæ—¶æ”¯æŒåˆ†å¸ƒå¼çš„å¹¶å‘è®¿é—®ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒRedissionæ˜¯ä¸€ä¸ªåŸºäºRediså®ç°çš„é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€æ˜“ç”¨çš„Javaåˆ†å¸ƒå¼åº“ï¼Œæä¾›äº†å¤šç§åˆ†å¸ƒå¼æ•°æ®ç»“æ„å’Œæœºåˆ¶çš„å®ç°ï¼Œå¯ä»¥æ»¡è¶³å„ç§åˆ†å¸ƒå¼åœºæ™¯çš„éœ€æ±‚ã€‚</p><figure><img src="'+gs+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h5 id="åŠ é”æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åŠ é”æœºåˆ¶" aria-hidden="true">#</a> åŠ é”æœºåˆ¶</h5><p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸ: æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</p><p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: ä¸€ç›´é€šè¿‡whileå¾ªç¯å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</p><h5 id="watch-dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#watch-dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶" aria-hidden="true">#</a> watch dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶</h5><p>è¿™ä¸ªæ¯”è¾ƒéš¾ç†è§£ï¼Œæ‰¾äº†äº›è®¸èµ„æ–™æ„Ÿè§‰ä¹Ÿå¹¶æ²¡æœ‰è§£é‡Šçš„å¾ˆæ¸…æ¥šã€‚è¿™é‡Œæˆ‘è‡ªå·±çš„ç†è§£å°±æ˜¯:</p><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå‡å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œçªç„¶æœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™åœ¨ä¸€å®šæ—¶é—´åè¿™ä¸ªé”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®é”çš„æœ‰æ•ˆæ—¶é—´(ä¸è®¾ç½®é»˜è®¤30ç§’ï¼‰ï¼Œè¿™æ ·çš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚</p><p>ä½†åœ¨å®é™…å¼€å‘ä¸­ä¼šæœ‰ä¸‹é¢ä¸€ç§æƒ…å†µ:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>      <span class="token comment">//è®¾ç½®é”1ç§’è¿‡å»</span>
        redissonLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string">&quot;redisson&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * ä¸šåŠ¡é€»è¾‘éœ€è¦å’¨è¯¢2ç§’
         */</span>
        redissonLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token string">&quot;redisson&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token doc-comment comment">/**
       * çº¿ç¨‹1 è¿›æ¥è·å¾—é”åï¼Œçº¿ç¨‹ä¸€åˆ‡æ­£å¸¸å¹¶æ²¡æœ‰å®•æœºï¼Œä½†å®ƒçš„ä¸šåŠ¡é€»è¾‘éœ€è¦æ‰§è¡Œ2ç§’ï¼Œè¿™å°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨ çº¿ç¨‹1 æ‰§è¡Œ1ç§’åï¼Œè¿™ä¸ªé”å°±è‡ªåŠ¨è¿‡æœŸäº†ï¼Œ
       * é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ çº¿ç¨‹2 è¿›æ¥äº†ã€‚é‚£ä¹ˆå°±å­˜åœ¨ çº¿ç¨‹1å’Œçº¿ç¨‹2 åŒæ—¶åœ¨è¿™æ®µä¸šåŠ¡é€»è¾‘é‡Œæ‰§è¡Œä»£ç ï¼Œè¿™å½“ç„¶æ˜¯ä¸åˆç†çš„ã€‚
       * è€Œä¸”å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåœ¨è§£é”æ—¶ç³»ç»Ÿä¼šæŠ›å¼‚å¸¸ï¼Œå› ä¸ºè§£é”å’ŒåŠ é”å·²ç»ä¸æ˜¯åŒä¸€çº¿ç¨‹äº†ï¼Œå…·ä½“åé¢ä»£ç æ¼”ç¤ºã€‚
       */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redisçš„watch dogæœºåˆ¶æ˜¯ä¸€ç§è‡ªåŠ¨å»¶æœŸæœºåˆ¶ï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶å‡ºç°å¹¶å‘å†²çªçš„æƒ…å†µã€‚å½“å®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œå¦‚æœå¦ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æ‰§è¡Œwatchå‘½ä»¤å¯¹äº‹åŠ¡ä¸­çš„æŸä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡å°±ä¼šè¢«ä¸­æ–­ï¼ŒRedisä¼šè¿”å›WATCHè¢«ä¿®æ”¹çš„é”®ï¼Œäº‹åŠ¡å¤±è´¥ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§å¹¶å‘å†²çªçš„é—®é¢˜ï¼ŒRediså¼•å…¥äº†watch dogæœºåˆ¶ï¼Œè¯¥æœºåˆ¶å¯ä»¥è‡ªåŠ¨å»¶é•¿å®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´æ‰€ç›‘æ§çš„keyçš„è¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…å¹¶å‘å†²çªã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œwatchå‘½ä»¤æ—¶ï¼ŒRedisä¼šå°†å®¢æˆ·ç«¯æ‰€ç›‘æ§çš„keyçš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå½“å‰æ—¶é—´åŠ ä¸Šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´é•¿åº¦ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œäº‹åŠ¡åï¼ŒRedisä¼šè‡ªåŠ¨åˆ é™¤ç›‘æ§çš„keyï¼Œå¹¶å°†keyçš„è¿‡æœŸæ—¶é—´æ¢å¤ä¸ºåŸæ¥çš„å€¼ã€‚</p><p>å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹ç›‘æ§çš„keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆRedisä¼šå–æ¶ˆå¯¹è¯¥äº‹åŠ¡çš„ç›‘æ§ï¼Œå¹¶å°†keyçš„è¿‡æœŸæ—¶é—´æ¢å¤ä¸ºåŸæ¥çš„å€¼ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç„¶åï¼ŒRedisä¼šè¿”å›WATCHè¢«ä¿®æ”¹çš„é”®ï¼Œè®©å®¢æˆ·ç«¯è¿›è¡Œé‡è¯•æˆ–è€…å…¶ä»–å¤„ç†ã€‚</p><p>æ€»ä¹‹ï¼ŒRedisçš„watch dogæœºåˆ¶é€šè¿‡è‡ªåŠ¨å»¶é•¿keyçš„è¿‡æœŸæ—¶é—´æ¥è§£å†³å¹¶å‘å†²çªçš„é—®é¢˜ï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</p><h5 id="ä¸ºå•¥è¦ç”¨luaè„šæœ¬å‘¢" tabindex="-1"><a class="header-anchor" href="#ä¸ºå•¥è¦ç”¨luaè„šæœ¬å‘¢" aria-hidden="true">#</a> ä¸ºå•¥è¦ç”¨luaè„šæœ¬å‘¢ï¼Ÿ</h5><p>è¿™ä¸ªä¸ç”¨å¤šè¯´ï¼Œä¸»è¦æ˜¯å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å¤æ‚çš„è¯ï¼Œé€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œè€Œä¸”redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ ·å°±ä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„<strong>åŸå­æ€§</strong>ã€‚</p><h5 id="å¯é‡å…¥åŠ é”æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å¯é‡å…¥åŠ é”æœºåˆ¶" aria-hidden="true">#</a> å¯é‡å…¥åŠ é”æœºåˆ¶</h5><p>Redissonå¯ä»¥å®ç°å¯é‡å…¥åŠ é”æœºåˆ¶çš„åŸå› ï¼Œæˆ‘è§‰å¾—è·Ÿä¸¤ç‚¹æœ‰å…³ï¼š</p><ol><li>Rediså­˜å‚¨é”çš„æ•°æ®ç±»å‹æ˜¯ Hashç±»å‹</li><li>Hashæ•°æ®ç±»å‹çš„keyå€¼åŒ…å«äº†å½“å‰çº¿ç¨‹ä¿¡æ¯ã€‚</li></ol><p>ä¸‹é¢æ˜¯rediså­˜å‚¨çš„æ•°æ®</p><figure><img src="`+vs+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è¿™é‡Œè¡¨é¢æ•°æ®ç±»å‹æ˜¯Hashç±»å‹,Hashç±»å‹ç›¸å½“äºæˆ‘ä»¬javaçš„ <code>&lt;key,&lt;key1,value&gt;&gt;</code> ç±»å‹,è¿™é‡Œkeyæ˜¯æŒ‡ &#39;redisson&#39;</p><p>å®ƒçš„æœ‰æ•ˆæœŸè¿˜æœ‰9ç§’ï¼Œæˆ‘ä»¬å†æ¥çœ‹é‡Œä»¬çš„key1å€¼ä¸º<code>078e44a3-5f95-4e24-b6aa-80684655a15a:45</code>å®ƒçš„ç»„æˆæ˜¯:</p><p>guid + å½“å‰çº¿ç¨‹çš„IDã€‚åé¢çš„valueæ˜¯å°±å’Œå¯é‡å…¥åŠ é”æœ‰å…³ã€‚</p><p>Redissionçš„å¯é‡å…¥é”æœºåˆ¶æ˜¯ä¸€ç§å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€æŠŠé”çš„æœºåˆ¶ã€‚åœ¨Redissionä¸­ï¼Œå¯é‡å…¥é”é€šè¿‡ReentrantLockå¯¹è±¡å®ç°ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹å·²ç»è·å–äº†æŸä¸ªå¯é‡å…¥é”ï¼Œå¹¶ä¸”æ²¡æœ‰é‡Šæ”¾ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥å†æ¬¡è·å–åŒä¸€æŠŠé”ï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚</li><li>é”çš„æŒæœ‰è®¡æ•°å™¨ï¼šRedissionä¼šä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæŒæœ‰è®¡æ•°å™¨ï¼Œç”¨äºè®°å½•è¯¥çº¿ç¨‹å·²ç»è·å–æŸä¸ªå¯é‡å…¥é”çš„æ¬¡æ•°ã€‚åœ¨è¯¥çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œè®¡æ•°å™¨çš„å€¼ä¼šå‡å°‘ï¼Œç›´åˆ°ä¸ºé›¶æ—¶æ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚</li><li>å…¬å¹³æ€§å’Œéå…¬å¹³æ€§ï¼šRedissionçš„å¯é‡å…¥é”æ—¢æ”¯æŒå…¬å¹³æ€§ä¹Ÿæ”¯æŒéå…¬å¹³æ€§ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé…ç½®ã€‚å½“ä½¿ç”¨å…¬å¹³é”æ—¶ï¼Œçº¿ç¨‹ä¼šæŒ‰ç…§è·å–é”çš„é¡ºåºä¾æ¬¡è·å–é”ï¼›è€Œä½¿ç”¨éå…¬å¹³é”æ—¶ï¼Œçº¿ç¨‹å¯ä»¥æ’é˜Ÿè·å–é”ï¼Œè¿™æ ·å¯ä»¥æé«˜é”çš„å¹¶å‘æ€§èƒ½ã€‚</li></ol><p><strong>ä¸¾å›¾è¯´æ˜</strong></p><figure><img src="'+bs+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸Šé¢è¿™å›¾çš„æ„æ€å°±æ˜¯å¯é‡å…¥é”çš„æœºåˆ¶ï¼Œå®ƒæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ç›¸åŒçº¿ç¨‹ä¸éœ€è¦åœ¨ç­‰å¾…é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥è¿›è¡Œç›¸åº”æ“ä½œã€‚</p><h3 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql" aria-hidden="true">#</a> MySql</h3><h4 id="sqlserver-å’Œ-mysql-åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#sqlserver-å’Œ-mysql-åŒºåˆ«" aria-hidden="true">#</a> sqlserver å’Œ MySQL åŒºåˆ«</h4><ol><li>SQLé€‚åˆä½¿ç”¨â€œ.NETâ€ï¼Œè€ŒMySQLå¯ä»¥ä¸å‡ ä¹æ‰€æœ‰å…¶ä»–è¯­è¨€é…å¯¹ï¼Œå¦‚â€œPHPâ€</li><li>sqlserverå’Œmysqlçš„è¯­æ³•ä¸åŒ</li><li>SQLä½¿ç”¨å•ä¸ªå­˜å‚¨å¼•æ“ï¼Œè€Œä¸æ˜¯ä¸ºMySQLæä¾›çš„å¤šä¸ªå¼•æ“</li></ol><h4 id="mysql-sql-æ‰§è¡Œè¿‡ç¨‹-ç”¨-jdbc-æ—¶-sql-æ‰§è¡Œæµç¨‹-mysqlä¸€ä¸ªselectè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#mysql-sql-æ‰§è¡Œè¿‡ç¨‹-ç”¨-jdbc-æ—¶-sql-æ‰§è¡Œæµç¨‹-mysqlä¸€ä¸ªselectè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹" aria-hidden="true">#</a> Mysql sql æ‰§è¡Œè¿‡ç¨‹ï¼Œç”¨ JDBC æ—¶ sql æ‰§è¡Œæµç¨‹ / mysqlä¸€ä¸ªselectè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹</h4>',124),qp={href:"https://xiaolincoding.com/mysql/base/how_select.html",target:"_blank",rel:"noopener noreferrer"},jp=t('<h5 id="mysql-1" tabindex="-1"><a class="header-anchor" href="#mysql-1" aria-hidden="true">#</a> MySql</h5><p>ä¸‹å›¾æ˜¯ MySQL çš„ä¸€ä¸ªç®€è¦æ¶æ„å›¾ï¼Œä»ä¸‹å›¾ä½ å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ç”¨æˆ·çš„ SQL è¯­å¥åœ¨ MySQL å†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚</p><p>å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä¸‹å›¾æ¶‰åŠçš„ä¸€äº›ç»„ä»¶çš„åŸºæœ¬ä½œç”¨å¸®åŠ©å¤§å®¶ç†è§£è¿™å¹…å›¾ï¼Œåœ¨ 1.2 èŠ‚ä¸­ä¼šè¯¦ç»†ä»‹ç»åˆ°è¿™äº›ç»„ä»¶çš„ä½œç”¨ã€‚</p><ul><li><strong>è¿æ¥å™¨ï¼š</strong> èº«ä»½è®¤è¯å’Œæƒé™ç›¸å…³(ç™»å½• MySQL çš„æ—¶å€™)ã€‚</li><li><strong>æŸ¥è¯¢ç¼“å­˜ï¼š</strong> æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0 ç‰ˆæœ¬åç§»é™¤ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨ï¼‰ã€‚</li><li><strong>åˆ†æå™¨ï¼š</strong> æ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„è¯ï¼ŒSQL è¯­å¥å°±ä¼šç»è¿‡åˆ†æå™¨ï¼Œåˆ†æå™¨è¯´ç™½äº†å°±æ˜¯è¦å…ˆçœ‹ä½ çš„ SQL è¯­å¥è¦å¹²å˜›ï¼Œå†æ£€æŸ¥ä½ çš„ SQL è¯­å¥è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚</li><li><strong>ä¼˜åŒ–å™¨ï¼š</strong> æŒ‰ç…§ MySQL è®¤ä¸ºæœ€ä¼˜çš„æ–¹æ¡ˆå»æ‰§è¡Œã€‚</li><li><strong>æ‰§è¡Œå™¨ï¼š</strong> æ‰§è¡Œè¯­å¥ï¼Œç„¶åä»å­˜å‚¨å¼•æ“è¿”å›æ•°æ®ã€‚</li></ul><figure><img src="'+hs+'" alt="image-20220612134312190" tabindex="0" loading="lazy"><figcaption>image-20220612134312190</figcaption></figure><p>ç®€å•æ¥è¯´ MySQL ä¸»è¦åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ï¼š</p><ul><li><strong>Server å±‚</strong>ï¼šä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œå‡½æ•°ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šç”¨çš„æ—¥å¿—æ¨¡å— binlog æ—¥å¿—æ¨¡å—ã€‚</li><li><strong>å­˜å‚¨å¼•æ“</strong>ï¼š ä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨å¯ä»¥æ›¿æ¢çš„æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œå…¶ä¸­ InnoDB å¼•æ“æœ‰è‡ªæœ‰çš„æ—¥å¿—æ¨¡å— redolog æ¨¡å—ã€‚<strong>ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5 ç‰ˆæœ¬å¼€å§‹å°±è¢«å½“åšé»˜è®¤å­˜å‚¨å¼•æ“äº†ã€‚</strong></li></ul><h5 id="jdbc" tabindex="-1"><a class="header-anchor" href="#jdbc" aria-hidden="true">#</a> JDBC</h5><ol><li>æ³¨å†Œé©±åŠ¨</li><li>è·å¾—è¿æ¥</li><li>è·å–æ‰§è¡ŒSQLè¯­å¥çš„å¯¹è±¡</li><li>æ‰§è¡ŒSQLè¯­å¥</li><li>å¤„ç†ç»“æœ</li><li>é‡Šæ”¾èµ„æº</li></ol><h4 id="mysql-ç›‘å¬-binlog-binlog-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#mysql-ç›‘å¬-binlog-binlog-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> Mysql ç›‘å¬ binlogï¼Œbinlog æ˜¯ä»€ä¹ˆ</h4><p>é‚£ <code>binlog</code> åˆ°åº•æ˜¯ç”¨æ¥å¹²å˜›çš„ï¼Ÿ</p><p>å¯ä»¥è¯´ <code>MySQL</code>æ•°æ®åº“çš„<strong>æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»</strong>éƒ½ç¦»ä¸å¼€ <code>binlog</code>ï¼Œéœ€è¦ä¾é  <code>binlog</code>æ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><figure><img src="'+fs+'" alt="image-20220404124727498" tabindex="0" loading="lazy"><figcaption>image-20220404124727498</figcaption></figure><p><code>binlog</code>ä¼šè®°å½•æ‰€æœ‰æ¶‰åŠæ›´æ–°æ•°æ®çš„é€»è¾‘æ“ä½œï¼Œå¹¶ä¸”æ˜¯é¡ºåºå†™ã€‚</p><p>è®°å½•æ ¼å¼ï¼š</p><p><code>binlog</code> æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡ <code>binlog_format</code>å‚æ•°æŒ‡å®šã€‚</p><ul><li><strong>statement</strong></li><li><strong>row</strong></li><li><strong>mixed</strong></li></ul><p>æŒ‡å®š <code>statement</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯ <code>SQL</code>è¯­å¥åŸæ–‡ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡ <code>update T set update_time=now() where id=1</code>ï¼Œè®°å½•çš„å†…å®¹å¦‚ä¸‹ã€‚</p><figure><img src="'+ys+'" alt="image-20220404124818143" tabindex="0" loading="lazy"><figcaption>image-20220404124818143</figcaption></figure><p>åŒæ­¥æ•°æ®æ—¶ï¼Œä¼šæ‰§è¡Œè®°å½•çš„ <code>SQL</code>è¯­å¥ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œ<code>update_time=now()</code>è¿™é‡Œä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸º <code>row</code>ï¼Œè®°å½•çš„å†…å®¹ä¸å†æ˜¯ç®€å•çš„ <code>SQL</code>è¯­å¥äº†ï¼Œè¿˜åŒ…å«æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹ã€‚</p><figure><img src="'+ws+'" alt="image-20220404124827143" tabindex="0" loading="lazy"><figcaption>image-20220404124827143</figcaption></figure><p><code>row</code>æ ¼å¼è®°å½•çš„å†…å®¹çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œè¦é€šè¿‡ <code>mysqlbinlog</code>å·¥å…·è§£æå‡ºæ¥ã€‚</p><p><code>update_time=now()</code>å˜æˆäº†å…·ä½“çš„æ—¶é—´ <code>update_time=1627112756247</code>ï¼Œæ¡ä»¶åé¢çš„@1ã€@2ã€@3 éƒ½æ˜¯è¯¥è¡Œæ•°æ®ç¬¬ 1 ä¸ª~3 ä¸ªå­—æ®µçš„åŸå§‹å€¼ï¼ˆ<strong>å‡è®¾è¿™å¼ è¡¨åªæœ‰ 3 ä¸ªå­—æ®µ</strong>ï¼‰ã€‚</p><p>è¿™æ ·å°±èƒ½ä¿è¯åŒæ­¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯æŒ‡å®šä¸º <code>row</code>ï¼Œè¿™æ ·å¯ä»¥ä¸ºæ•°æ®åº“çš„æ¢å¤ä¸åŒæ­¥å¸¦æ¥æ›´å¥½çš„å¯é æ€§ã€‚</p><p>ä½†æ˜¯è¿™ç§æ ¼å¼ï¼Œéœ€è¦æ›´å¤§çš„å®¹é‡æ¥è®°å½•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼Œæ¢å¤ä¸åŒæ­¥æ—¶ä¼šæ›´æ¶ˆè€— <code>IO</code>èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>æ‰€ä»¥å°±æœ‰äº†ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼ŒæŒ‡å®šä¸º <code>mixed</code>ï¼Œè®°å½•çš„å†…å®¹æ˜¯å‰ä¸¤è€…çš„æ··åˆã€‚</p><p><code>MySQL</code>ä¼šåˆ¤æ–­è¿™æ¡ <code>SQL</code>è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç”¨ <code>row</code>æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨ <code>statement</code>æ ¼å¼ã€‚</p><p>å†™å…¥æœºåˆ¶ï¼š</p><p><code>binlog</code>çš„å†™å…¥æ—¶æœºä¹Ÿéå¸¸ç®€å•ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° <code>binlog cache</code>ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ <code>binlog cache</code>å†™åˆ° <code>binlog</code>æ–‡ä»¶ä¸­ã€‚</p><p>å› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„ <code>binlog</code>ä¸èƒ½è¢«æ‹†å¼€ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸º <code>binlog cache</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>binlog_cache_size</code>å‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹ binlog cache å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆ<code>Swap</code>ï¼‰ã€‚</p><p><code>binlog</code>æ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹</p><figure><img src="'+Cs+'" alt="image-20220404124853946" tabindex="0" loading="lazy"><figcaption>image-20220404124853946</figcaption></figure><ul><li><strong>ä¸Šå›¾çš„ writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«</strong></li><li><strong>ä¸Šå›¾çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ</strong></li></ul><p><code>write</code>å’Œ <code>fsync</code>çš„æ—¶æœºï¼Œå¯ä»¥ç”±å‚æ•° <code>sync_binlog</code>æ§åˆ¶ï¼Œé»˜è®¤æ˜¯ <code>0</code>ã€‚</p><p>ä¸º <code>0</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª <code>write</code>ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ <code>fsync</code>ã€‚</p><figure><img src="'+Ss+'" alt="image-20220404124910100" tabindex="0" loading="lazy"><figcaption>image-20220404124910100</figcaption></figure><p>è™½ç„¶æ€§èƒ½å¾—åˆ°æå‡ï¼Œä½†æ˜¯æœºå™¨å®•æœºï¼Œ<code>page cache</code>é‡Œé¢çš„ binlog ä¼šä¸¢å¤±ã€‚</p><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ <code>fsync</code>ï¼Œå°±å¦‚åŒ <strong>redo log æ—¥å¿—åˆ·ç›˜æµç¨‹</strong> ä¸€æ ·ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ç§æŠ˜ä¸­æ–¹å¼ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>N(N&gt;1)</code>ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ <code>write</code>ï¼Œä½†ç´¯ç§¯ <code>N</code>ä¸ªäº‹åŠ¡åæ‰ <code>fsync</code>ã€‚</p><figure><img src="'+xs+`" alt="image-20220404124922094" tabindex="0" loading="lazy"><figcaption>image-20220404124922094</figcaption></figure><p>åœ¨å‡ºç° <code>IO</code>ç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°† <code>sync_binlog</code>è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚</p><p>åŒæ ·çš„ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘ <code>N</code>ä¸ªäº‹åŠ¡çš„ <code>binlog</code>æ—¥å¿—ã€‚</p><h4 id="redo-log-undo-log-bin-log" tabindex="-1"><a class="header-anchor" href="#redo-log-undo-log-bin-log" aria-hidden="true">#</a> redo logï¼Œundo logï¼Œbin log</h4><ul><li>binlog ä¸»è¦ç”¨äºæ•°æ®åº“è¿˜åŸï¼Œå±äºæ•°æ®çº§åˆ«çš„æ•°æ®æ¢å¤ï¼Œä¸»ä»å¤åˆ¶æ˜¯ binlog æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ã€‚</li><li>redolog ä¸»è¦ç”¨äºä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œå±äºäº‹åŠ¡çº§åˆ«çš„æ•°æ®æ¢å¤ã€‚</li><li>å¦‚æœæƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œ<strong>å›æ»š</strong>ï¼Œåœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡ <strong>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</strong> å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶åå†æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚</li></ul><h4 id="redolog-å’Œ-binlog-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#redolog-å’Œ-binlog-çš„åŒºåˆ«" aria-hidden="true">#</a> redolog å’Œ binlog çš„åŒºåˆ«</h4><p><code>redo log</code> å®ƒæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äº <code>InnoDB</code> å­˜å‚¨å¼•æ“ã€‚</p><p>è€Œ <code>binlog</code> æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äºâ€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1â€ï¼Œå±äº <code>MySQL Server</code> å±‚ã€‚</p><p>ä¸ç®¡ç”¨ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œåªè¦å‘ç”Ÿäº†è¡¨æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šäº§ç”Ÿ <code>binlog</code> æ—¥å¿—ã€‚</p><h4 id="mysql-é‡Œé¢ä¸ºä»€ä¹ˆç”¨-b-æ ‘-é‚£èƒ½ä¸èƒ½ç”¨å“ˆå¸Œå‘¢" tabindex="-1"><a class="header-anchor" href="#mysql-é‡Œé¢ä¸ºä»€ä¹ˆç”¨-b-æ ‘-é‚£èƒ½ä¸èƒ½ç”¨å“ˆå¸Œå‘¢" aria-hidden="true">#</a> Mysql é‡Œé¢ä¸ºä»€ä¹ˆç”¨ B+æ ‘ï¼Ÿé‚£èƒ½ä¸èƒ½ç”¨å“ˆå¸Œå‘¢ï¼Ÿ</h4><p>ä½¿ç”¨ B+æ ‘è€Œä¸æ˜¯äºŒå‰æœç´¢æ ‘æˆ–è€…çº¢é»‘æ ‘çš„åŸå› æ˜¯ï¼Œç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œæ¯æ¬¡æœç´¢çš„ç£ç›˜ IO çš„å¼€é”€è¿‡å¤§ï¼Œè€Œ B+æ ‘å¯ä»¥ä½¿ç”¨è¾ƒå°‘æ¬¡çš„ç£ç›˜ IO æœç´¢åˆ°å¯¹è±¡ã€‚</p><ul><li>B-Tree ä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦ h-1 æ¬¡ I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸º O(h)=O(logdN)ã€‚</li><li>çº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œh æ˜æ˜¾è¦æ·±çš„å¤šã€‚æ•ˆç‡æ˜æ˜¾æ¯” B-Tree å·®å¾ˆå¤šã€‚</li></ul><p>å“ˆå¸Œè¡¨æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œé€šè¿‡é”®(key)å³å¯å¿«é€Ÿå–å‡ºå¯¹åº”çš„å€¼(value)ï¼Œå› æ­¤å“ˆå¸Œè¡¨å¯ä»¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼ˆæ¥è¿‘ Oï¼ˆ1ï¼‰ï¼‰ã€‚</p><p><strong>ä¸ºä½•èƒ½å¤Ÿé€šè¿‡ key å¿«é€Ÿå–å‡º value å‘¢ï¼Ÿ</strong> åŸå› åœ¨äº <strong>å“ˆå¸Œç®—æ³•</strong>ï¼ˆä¹Ÿå«æ•£åˆ—ç®—æ³•ï¼‰ã€‚é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰¾åˆ° key å¯¹åº”çš„ indexï¼Œæ‰¾åˆ°äº† index ä¹Ÿå°±æ‰¾åˆ°äº†å¯¹åº”çš„ valueã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>hash <span class="token operator">=</span> <span class="token function">hashfunc</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
index <span class="token operator">=</span> hash <span class="token operator">%</span> array_size
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+_s+'" alt="image-20220404131205113" tabindex="0" loading="lazy"><figcaption>image-20220404131205113</figcaption></figure><p>ä½†æ˜¯ï¼å“ˆå¸Œç®—æ³•æœ‰ä¸ª <strong>Hash å†²çª</strong> é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªä¸åŒçš„ key æœ€åå¾—åˆ°çš„ index ç›¸åŒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è§£å†³åŠæ³•æ˜¯ <strong>é“¾åœ°å€æ³•</strong>ã€‚é“¾åœ°å€æ³•å°±æ˜¯å°†å“ˆå¸Œå†²çªæ•°æ®å­˜æ”¾åœ¨é“¾è¡¨ä¸­ã€‚å°±æ¯”å¦‚ JDK1.8 ä¹‹å‰ <code>HashMap</code> å°±æ˜¯é€šè¿‡é“¾åœ°å€æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ã€‚ä¸è¿‡ï¼ŒJDK1.8 ä»¥å <code>HashMap</code>ä¸ºäº†å‡å°‘é“¾è¡¨è¿‡é•¿çš„æ—¶å€™æœç´¢æ—¶é—´è¿‡é•¿å¼•å…¥äº†çº¢é»‘æ ‘ã€‚</p><figure><img src="'+Ts+`" alt="image-20220404131213494" tabindex="0" loading="lazy"><figcaption>image-20220404131213494</figcaption></figure><p>ä¸ºäº†å‡å°‘ Hash å†²çªçš„å‘ç”Ÿï¼Œä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥â€œå‡åŒ€åœ°â€å°†æ•°æ®åˆ†å¸ƒåœ¨æ•´ä¸ªå¯èƒ½çš„å“ˆå¸Œå€¼é›†åˆä¸­ã€‚</p><p>æ—¢ç„¶å“ˆå¸Œè¡¨è¿™ä¹ˆå¿«ï¼Œ<strong>ä¸ºä»€ä¹ˆ MySQL æ²¡æœ‰ä½¿ç”¨å…¶ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ</strong></p><p><strong>1.Hash å†²çªé—®é¢˜</strong> ï¼šæˆ‘ä»¬ä¸Šé¢ä¹Ÿæåˆ°è¿‡ Hash å†²çªäº†ï¼Œä¸è¿‡å¯¹äºæ•°æ®åº“æ¥è¯´è¿™è¿˜ä¸ç®—æœ€å¤§çš„ç¼ºç‚¹ã€‚</p><p><strong>2.Hash ç´¢å¼•ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢(Hash ç´¢å¼•ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹ï¼š</strong> å‡å¦‚æˆ‘ä»¬è¦å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ’åºæˆ–è€…è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œé‚£ Hash ç´¢å¼•å¯å°±ä¸è¡Œäº†ã€‚</p><p>è¯•æƒ³ä¸€ç§æƒ…å†µ:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> tb1 <span class="token constant">WHERE</span> id <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨è¿™ç§èŒƒå›´æŸ¥è¯¢ä¸­ï¼Œä¼˜åŠ¿éå¸¸å¤§ï¼Œç›´æ¥éå†æ¯” 500 å°çš„å¶å­èŠ‚ç‚¹å°±å¤Ÿäº†ã€‚è€Œ Hash ç´¢å¼•æ˜¯æ ¹æ® hash ç®—æ³•æ¥å®šä½çš„ï¼Œéš¾ä¸æˆè¿˜è¦æŠŠ 1 - 499 çš„æ•°æ®ï¼Œæ¯ä¸ªéƒ½è¿›è¡Œä¸€æ¬¡ hash è®¡ç®—æ¥å®šä½å—?è¿™å°±æ˜¯ Hash æœ€å¤§çš„ç¼ºç‚¹äº†.</p><h4 id="b-æ ‘å’ŒäºŒå‰æ ‘åŒºåˆ«-2022é£ä¹¦" tabindex="-1"><a class="header-anchor" href="#b-æ ‘å’ŒäºŒå‰æ ‘åŒºåˆ«-2022é£ä¹¦" aria-hidden="true">#</a> B+æ ‘å’ŒäºŒå‰æ ‘åŒºåˆ«ï¼Ÿ(2022é£ä¹¦)</h4><ul><li>B æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾é”®(key) ä¹Ÿå­˜æ”¾ æ•°æ®(data)ï¼Œè€Œ B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾ key å’Œ dataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾ keyã€‚</li><li>B æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„;B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ã€‚</li><li>B æ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€Œ B+æ ‘çš„æ£€ç´¢æ•ˆç‡å°±å¾ˆç¨³å®šäº†ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­èŠ‚ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ã€‚</li></ul><h4 id="ã€é«˜é¢‘é—®é¢˜ã€‘ä»€ä¹ˆæ˜¯-mvcc" tabindex="-1"><a class="header-anchor" href="#ã€é«˜é¢‘é—®é¢˜ã€‘ä»€ä¹ˆæ˜¯-mvcc" aria-hidden="true">#</a> ã€é«˜é¢‘é—®é¢˜ã€‘ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ</h4><p>MVCCï¼Œå…¨ç§° Multi-Version Concurrency Controlï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCC æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚</p><p>åœ¨ Mysql çš„ InnoDB å¼•æ“ä¸­å°±æ˜¯æŒ‡åœ¨å·²æäº¤è¯»(READ COMMITTD)å’Œå¯é‡å¤è¯»(REPEATABLE READ)è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡å¯¹äº SELECT æ“ä½œä¼šè®¿é—®ç‰ˆæœ¬é“¾ä¸­çš„è®°å½•çš„è¿‡ç¨‹ã€‚</p><p>è¿™å°±ä½¿å¾—åˆ«çš„äº‹åŠ¡å¯ä»¥ä¿®æ”¹è¿™æ¡è®°å½•ï¼Œåæ­£æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåœ¨ç‰ˆæœ¬é“¾ä¸­è®°å½•ã€‚SELECT å¯ä»¥å»ç‰ˆæœ¬é“¾ä¸­æ‹¿è®°å½•ï¼Œè¿™å°±å®ç°äº†è¯»-å†™ï¼Œå†™-è¯»çš„å¹¶å‘æ‰§è¡Œï¼Œæå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p><strong>MySQL çš„ InnoDB å¼•æ“å®ç° MVCC çš„ 3 ä¸ªåŸºç¡€ç‚¹</strong></p><p>MVCC çš„ç›®çš„å°±æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œåœ¨æ•°æ®åº“ä¸­çš„å®ç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¯»å†™å†²çªï¼Œå®ƒçš„å®ç°åŸç†ä¸»è¦æ˜¯ä¾èµ–è®°å½•ä¸­çš„ 3 ä¸ªéšå¼å­—æ®µï¼Œundo æ—¥å¿— ï¼ŒRead View æ¥å®ç°çš„ã€‚</p><ol><li>éšå¼å­—æ®µï¼š</li></ol><p>æ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„ DB_TRX_ID,DB_ROLL_PTR,DB_ROW_ID ç­‰å­—æ®µ</p><ul><li><strong>DB_ROW_ID</strong> 6byte, éšå«çš„è‡ªå¢ IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDB ä¼šè‡ªåŠ¨ä»¥ DB_ROW_ID äº§ç”Ÿä¸€ä¸ªèšç°‡ç´¢å¼•</li><li><strong>DB_TRX_ID</strong> 6byte, æœ€è¿‘ä¿®æ”¹(ä¿®æ”¹/æ’å…¥)äº‹åŠ¡ IDï¼šè®°å½•åˆ›å»ºè¿™æ¡è®°å½•/æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ ID</li><li><strong>DB_ROLL_PTR</strong> 7byte, å›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆå­˜å‚¨äº rollback segment é‡Œï¼‰</li><li><strong>DELETED_BIT</strong> 1byte, è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤ flag å˜äº†</li></ul><figure><img src="`+Ps+'" alt="image-20220404132619617" tabindex="0" loading="lazy"><figcaption>image-20220404132619617</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼ŒDB_ROW_ID æ˜¯æ•°æ®åº“é»˜è®¤ä¸ºè¯¥è¡Œè®°å½•ç”Ÿæˆçš„å”¯ä¸€éšå¼ä¸»é”®ï¼›DB_TRX_ID æ˜¯å½“å‰æ“ä½œè¯¥è®°å½•çš„äº‹åŠ¡ IDï¼› è€Œ DB_ROLL_PTR æ˜¯ä¸€ä¸ªå›æ»šæŒ‡é’ˆï¼Œç”¨äºé…åˆ undo æ—¥å¿—ï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªæ—§ç‰ˆæœ¬ï¼›delete flag æ²¡æœ‰å±•ç¤ºå‡ºæ¥</p><ol start="2"><li>undo æ—¥å¿—</li></ol><p>InnoDB æŠŠè¿™äº›ä¸ºäº†å›æ»šè€Œè®°å½•çš„è¿™äº›ä¸œè¥¿ç§°ä¹‹ä¸º undo logã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç”±äºæŸ¥è¯¢æ“ä½œï¼ˆSELECTï¼‰å¹¶ä¸ä¼šä¿®æ”¹ä»»ä½•ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æ“ä½œæ‰§è¡Œæ—¶ï¼Œå¹¶ä¸éœ€è¦è®°å½•ç›¸åº”çš„ undo logã€‚undo log ä¸»è¦åˆ†ä¸º 3 ç§ï¼š</p><ul><li><p><strong>Insert undo log</strong> ï¼šæ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•çš„ä¸»é”®å€¼è®°ä¸‹æ¥ï¼Œä¹‹åå›æ»šçš„æ—¶å€™åªéœ€è¦æŠŠè¿™ä¸ªä¸»é”®å€¼å¯¹åº”çš„è®°å½•åˆ æ‰å°±å¥½äº†ã€‚</p></li><li><p><strong>Update undo log</strong>ï¼šä¿®æ”¹ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠä¿®æ”¹è¿™æ¡è®°å½•å‰çš„æ—§å€¼éƒ½è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠè¿™æ¡è®°å½•æ›´æ–°ä¸ºæ—§å€¼å°±å¥½äº†ã€‚</p></li><li><p>Delete undo log</p><p>ï¼šåˆ é™¤ä¸€æ¡è®°å½•æ—¶ï¼Œè‡³å°‘è¦æŠŠè¿™æ¡è®°å½•ä¸­çš„å†…å®¹éƒ½è®°ä¸‹æ¥ï¼Œè¿™æ ·ä¹‹åå›æ»šæ—¶å†æŠŠç”±è¿™äº›å†…å®¹ç»„æˆçš„è®°å½•æ’å…¥åˆ°è¡¨ä¸­å°±å¥½äº†ã€‚</p><ul><li>åˆ é™¤æ“ä½œéƒ½åªæ˜¯è®¾ç½®ä¸€ä¸‹è€è®°å½•çš„ DELETED_BITï¼Œå¹¶ä¸çœŸæ­£å°†è¿‡æ—¶çš„è®°å½•åˆ é™¤ã€‚</li><li>ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒInnoDB æœ‰ä¸“é—¨çš„ purge çº¿ç¨‹æ¥æ¸…ç† DELETED_BIT ä¸º true çš„è®°å½•ã€‚ä¸ºäº†ä¸å½±å“ MVCC çš„æ­£å¸¸å·¥ä½œï¼Œpurge çº¿ç¨‹è‡ªå·±ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ª read viewï¼ˆè¿™ä¸ª read view ç›¸å½“äºç³»ç»Ÿä¸­æœ€è€æ´»è·ƒäº‹åŠ¡çš„ read viewï¼‰;å¦‚æœæŸä¸ªè®°å½•çš„ DELETED_BIT ä¸º trueï¼Œå¹¶ä¸” DB_TRX_ID ç›¸å¯¹äº purge çº¿ç¨‹çš„ read view å¯è§ï¼Œé‚£ä¹ˆè¿™æ¡è®°å½•ä¸€å®šæ˜¯å¯ä»¥è¢«å®‰å…¨æ¸…é™¤çš„ã€‚</li></ul></li></ul><p>å¯¹ MVCC æœ‰å¸®åŠ©çš„å®è´¨æ˜¯<strong>update undo log</strong> ï¼Œundo log å®é™…ä¸Šå°±æ˜¯å­˜åœ¨ rollback segment ä¸­æ—§è®°å½•é“¾ï¼Œå®ƒçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>æ¯”å¦‚ä¸€ä¸ªæœ‰ä¸ªäº‹åŠ¡æ’å…¥ persion è¡¨æ’å…¥äº†ä¸€æ¡æ–°è®°å½•ï¼Œè®°å½•å¦‚ä¸‹ï¼Œname ä¸º Jerry, age ä¸º 24 å²ï¼Œéšå¼ä¸»é”®æ˜¯ 1ï¼Œäº‹åŠ¡ ID å’Œå›æ»šæŒ‡é’ˆï¼Œæˆ‘ä»¬å‡è®¾ä¸º NULL</strong></li></ol><figure><img src="'+Ls+'" alt="image-20220404132738181" tabindex="0" loading="lazy"><figcaption>image-20220404132738181</figcaption></figure><ol start="2"><li><strong>ç°åœ¨æ¥äº†ä¸€ä¸ªäº‹åŠ¡ 1 å¯¹è¯¥è®°å½•çš„ name åšå‡ºäº†ä¿®æ”¹ï¼Œæ”¹ä¸º Tom</strong><ol><li>åœ¨äº‹åŠ¡ 1 ä¿®æ”¹è¯¥è¡Œ(è®°å½•)æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆå¯¹è¯¥è¡ŒåŠ æ’ä»–é”</li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ° undo log ä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œæ—¢åœ¨ undo log ä¸­æœ‰å½“å‰è¡Œçš„æ‹·è´å‰¯æœ¬</li><li>æ‹·è´å®Œæ¯•åï¼Œä¿®æ”¹è¯¥è¡Œ name ä¸º Tomï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡ ID ä¸ºå½“å‰äº‹åŠ¡ 1 çš„ ID, æˆ‘ä»¬é»˜è®¤ä» 1 å¼€å§‹ï¼Œä¹‹åé€’å¢ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘æ‹·è´åˆ° undo log çš„å‰¯æœ¬è®°å½•ï¼Œæ—¢è¡¨ç¤ºæˆ‘çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯å®ƒ</li><li>äº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾é”</li></ol></li></ol><figure><img src="'+Rs+'" alt="image-20220404132804754" tabindex="0" loading="lazy"><figcaption>image-20220404132804754</figcaption></figure><ol start="3"><li><strong>åˆæ¥äº†ä¸ªäº‹åŠ¡ 2 ä¿®æ”¹ person è¡¨çš„åŒä¸€ä¸ªè®°å½•ï¼Œå°† age ä¿®æ”¹ä¸º 30 å²</strong><ol><li>åœ¨äº‹åŠ¡ 2 ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¹Ÿå…ˆä¸ºè¯¥è¡ŒåŠ é”</li><li>ç„¶åæŠŠè¯¥è¡Œæ•°æ®æ‹·è´åˆ° undo log ä¸­ï¼Œä½œä¸ºæ—§è®°å½•ï¼Œå‘ç°è¯¥è¡Œè®°å½•å·²ç»æœ‰ undo log äº†ï¼Œé‚£ä¹ˆæœ€æ–°çš„æ—§æ•°æ®ä½œä¸ºé“¾è¡¨çš„è¡¨å¤´ï¼Œæ’åœ¨è¯¥è¡Œè®°å½•çš„ undo log æœ€å‰é¢</li><li>ä¿®æ”¹è¯¥è¡Œ age ä¸º 30 å²ï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡ ID ä¸ºå½“å‰äº‹åŠ¡ 2 çš„ ID, é‚£å°±æ˜¯ 2ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘åˆšåˆšæ‹·è´åˆ° undo log çš„å‰¯æœ¬è®°å½•</li><li>äº‹åŠ¡æäº¤ï¼Œé‡Šæ”¾é”</li></ol></li></ol><figure><img src="'+Is+'" alt="image-20220404132833298" tabindex="0" loading="lazy"><figcaption>image-20220404132833298</figcaption></figure><p>ä»ä¸Šé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œä¸åŒäº‹åŠ¡æˆ–è€…ç›¸åŒäº‹åŠ¡çš„å¯¹åŒä¸€è®°å½•çš„ä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„ undo log æˆä¸ºä¸€æ¡è®°å½•ç‰ˆæœ¬çº¿æ€§è¡¨ï¼Œæ—¢é“¾è¡¨ï¼Œundo log çš„é“¾é¦–å°±æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œé“¾å°¾å°±æ˜¯æœ€æ—©çš„æ—§è®°å½•ï¼ˆå½“ç„¶å°±åƒä¹‹å‰è¯´çš„è¯¥ undo log çš„èŠ‚ç‚¹å¯èƒ½æ˜¯ä¼š purge çº¿ç¨‹æ¸…é™¤æ‰ï¼Œå‘å›¾ä¸­çš„ç¬¬ä¸€æ¡ insert undo logï¼Œå…¶å®åœ¨äº‹åŠ¡æäº¤ä¹‹åå¯èƒ½å°±è¢«åˆ é™¤ä¸¢å¤±äº†ï¼Œä¸è¿‡è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæ‰€ä»¥è¿˜æ”¾åœ¨è¿™é‡Œï¼‰</p><ol start="3"><li>Read View(è¯»è§†å›¾)</li></ol><p>ä»€ä¹ˆæ˜¯ Read Viewï¼Œè¯´ç™½äº† Read View å°±æ˜¯äº‹åŠ¡è¿›è¡Œå¿«ç…§è¯»æ“ä½œçš„æ—¶å€™ç”Ÿäº§çš„è¯»è§†å›¾(Read View)ï¼Œåœ¨è¯¥äº‹åŠ¡æ‰§è¡Œçš„å¿«ç…§è¯»çš„é‚£ä¸€åˆ»ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ ID(å½“æ¯ä¸ªäº‹åŠ¡å¼€å¯æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ª ID, è¿™ä¸ª ID æ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥æœ€æ–°çš„äº‹åŠ¡ï¼ŒID å€¼è¶Šå¤§)</p><p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ Read View ä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„, å³å½“æˆ‘ä»¬æŸä¸ªäº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼Œå¯¹è¯¥è®°å½•åˆ›å»ºä¸€ä¸ª Read View è¯»è§†å›¾ï¼ŒæŠŠå®ƒæ¯”ä½œæ¡ä»¶ç”¨æ¥åˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæ—¢å¯èƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥è¡Œè®°å½•çš„ undo log é‡Œé¢çš„æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚</p><p>Read View éµå¾ªä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œä¸»è¦æ˜¯å°†è¦è¢«ä¿®æ”¹çš„æ•°æ®çš„æœ€æ–°è®°å½•ä¸­çš„ DB_TRX_IDï¼ˆå³å½“å‰äº‹åŠ¡ IDï¼‰å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡çš„ ID å»å¯¹æ¯”ï¼ˆç”± Read View ç»´æŠ¤ï¼‰ï¼Œå¦‚æœ DB_TRX_ID è·Ÿ Read View çš„å±æ€§åšäº†æŸäº›æ¯”è¾ƒï¼Œä¸ç¬¦åˆå¯è§æ€§ï¼Œé‚£å°±é€šè¿‡ DB_ROLL_PTR å›æ»šæŒ‡é’ˆå»å–å‡º Undo Log ä¸­çš„ DB_TRX_ID å†æ¯”è¾ƒï¼Œå³éå†é“¾è¡¨çš„ DB_TRX_IDï¼ˆä»é“¾é¦–åˆ°é“¾å°¾ï¼Œå³ä»æœ€è¿‘çš„ä¸€æ¬¡ä¿®æ”¹æŸ¥èµ·ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ DB_TRX_ID, é‚£ä¹ˆè¿™ä¸ª DB_TRX_ID æ‰€åœ¨çš„æ—§è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°è€ç‰ˆæœ¬</p><p>é‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure><img src="'+As+'" alt="image-20220404132904142" tabindex="0" loading="lazy"><figcaption>image-20220404132904142</figcaption></figure><p>å¦‚ä¸Šï¼Œå®ƒæ˜¯ä¸€æ®µ MySQL åˆ¤æ–­å¯è§æ€§çš„ä¸€æ®µæºç ï¼Œå³ changes_visible æ–¹æ³•ï¼ˆä¸å®Œå…¨å“ˆï¼Œä½†èƒ½çœ‹å‡ºå¤§è‡´é€»è¾‘ï¼‰ï¼Œè¯¥æ–¹æ³•å±•ç¤ºäº†æˆ‘ä»¬æ‹¿ DB_TRX_ID å»è·Ÿ Read View æŸäº›å±æ€§è¿›è¡Œæ€ä¹ˆæ ·çš„æ¯”è¾ƒ</p><p>åœ¨å±•ç¤ºä¹‹å‰ï¼Œæˆ‘å…ˆç®€åŒ–ä¸€ä¸‹ Read Viewï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Read View ç®€å•çš„ç†è§£æˆæœ‰ä¸‰ä¸ªå…¨å±€å±æ€§</p><blockquote><ul><li><strong>trx_list</strong> æœªæäº¤äº‹åŠ¡ ID åˆ—è¡¨ï¼Œç”¨æ¥ç»´æŠ¤ Read View ç”Ÿæˆæ—¶åˆ»ç³»ç»Ÿæ­£æ´»è·ƒçš„äº‹åŠ¡ ID</li><li><strong>up_limit_id</strong> è®°å½• trx_list åˆ—è¡¨ä¸­äº‹åŠ¡ ID æœ€å°çš„ ID</li><li><strong>low_limit_id</strong> ReadView ç”Ÿæˆæ—¶åˆ»ç³»ç»Ÿå°šæœªåˆ†é…çš„ä¸‹ä¸€ä¸ªäº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼+1</li></ul></blockquote><ul><li>é¦–å…ˆæ¯”è¾ƒ DB_TRX_ID &lt; up_limit_id, å¦‚æœå°äºï¼Œåˆ™å½“å‰äº‹åŠ¡èƒ½çœ‹åˆ° DB_TRX_ID æ‰€åœ¨çš„è®°å½•ï¼Œå¦‚æœå¤§äºç­‰äºè¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­</li><li>æ¥ä¸‹æ¥åˆ¤æ–­ DB_TRX_ID å¤§äºç­‰äº low_limit_id , å¦‚æœå¤§äºç­‰äºåˆ™ä»£è¡¨ DB_TRX_ID æ‰€åœ¨çš„è®°å½•åœ¨ Read View ç”Ÿæˆåæ‰å‡ºç°çš„ï¼Œé‚£å¯¹å½“å‰äº‹åŠ¡è‚¯å®šä¸å¯è§ï¼Œå¦‚æœå°äºåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­</li><li>åˆ¤æ–­ DB_TRX_ID æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡ä¹‹ä¸­ï¼Œtrx_list.contains(DB_TRX_ID)ï¼Œå¦‚æœåœ¨ï¼Œåˆ™ä»£è¡¨æˆ‘ Read View ç”Ÿæˆæ—¶åˆ»ï¼Œä½ è¿™ä¸ªäº‹åŠ¡è¿˜åœ¨æ´»è·ƒï¼Œè¿˜æ²¡æœ‰ Commitï¼Œä½ ä¿®æ”¹çš„æ•°æ®ï¼Œæˆ‘å½“å‰äº‹åŠ¡ä¹Ÿæ˜¯çœ‹ä¸è§çš„ï¼›å¦‚æœä¸åœ¨ï¼Œåˆ™è¯´æ˜ï¼Œä½ è¿™ä¸ªäº‹åŠ¡åœ¨ Read View ç”Ÿæˆä¹‹å‰å°±å·²ç» Commit äº†ï¼Œä½ ä¿®æ”¹çš„ç»“æœï¼Œæˆ‘å½“å‰äº‹åŠ¡æ˜¯èƒ½çœ‹è§çš„</li></ul><p>æ•´ä½“æµç¨‹ï¼š</p><p>æˆ‘ä»¬åœ¨äº†è§£äº†éšå¼å­—æ®µï¼Œundo logï¼Œ ä»¥åŠ Read View çš„æ¦‚å¿µä¹‹åï¼Œå°±å¯ä»¥æ¥çœ‹çœ‹ MVCC å®ç°çš„æ•´ä½“æµç¨‹æ˜¯æ€ä¹ˆæ ·äº†</p><p>æ•´ä½“çš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹</p><p>å½“äº‹åŠ¡ 2 å¯¹æŸè¡Œæ•°æ®æ‰§è¡Œäº†å¿«ç…§è¯»ï¼Œæ•°æ®åº“ä¸ºè¯¥è¡Œæ•°æ®ç”Ÿæˆä¸€ä¸ª Read View è¯»è§†å›¾ï¼Œå‡è®¾å½“å‰äº‹åŠ¡ ID ä¸º 2ï¼Œæ­¤æ—¶è¿˜æœ‰äº‹åŠ¡ 1 å’Œäº‹åŠ¡ 3 åœ¨æ´»è·ƒä¸­ï¼Œäº‹åŠ¡ 4 åœ¨äº‹åŠ¡ 2 å¿«ç…§è¯»å‰ä¸€åˆ»æäº¤æ›´æ–°äº†ï¼Œæ‰€ä»¥ Read View è®°å½•äº†ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡ 1ï¼Œ3 çš„ IDï¼Œç»´æŠ¤åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸Šï¼Œå‡è®¾æˆ‘ä»¬ç§°ä¸º trx_list</p><table><thead><tr><th>äº‹åŠ¡ 1</th><th>äº‹åŠ¡ 2</th><th>äº‹åŠ¡ 3</th><th>äº‹åŠ¡ 4</th></tr></thead><tbody><tr><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td><td>äº‹åŠ¡å¼€å§‹</td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td><td>ä¿®æ”¹ä¸”å·²æäº¤</td></tr><tr><td>è¿›è¡Œä¸­</td><td>å¿«ç…§è¯»</td><td>è¿›è¡Œä¸­</td><td></td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td><td></td></tr></tbody></table><p>Read View ä¸ä»…ä»…ä¼šé€šè¿‡ä¸€ä¸ªåˆ—è¡¨ trx_list æ¥ç»´æŠ¤äº‹åŠ¡ 2 æ‰§è¡Œå¿«ç…§è¯»é‚£åˆ»ç³»ç»Ÿæ­£æ´»è·ƒçš„äº‹åŠ¡ IDï¼Œè¿˜ä¼šæœ‰ä¸¤ä¸ªå±æ€§ up_limit_idï¼ˆè®°å½• trx_list åˆ—è¡¨ä¸­äº‹åŠ¡ ID æœ€å°çš„ IDï¼‰ï¼Œlow_limit_id(è®°å½• trx_list åˆ—è¡¨ä¸­ä¸‹ä¸€ä¸ªäº‹åŠ¡ IDï¼Œä¹Ÿå°±æ˜¯ç›®å‰å·²å‡ºç°è¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼+1)ï¼›æ‰€ä»¥åœ¨è¿™é‡Œä¾‹å­ä¸­ up_limit_id å°±æ˜¯ 1ï¼Œlow_limit_id å°±æ˜¯ 4 + 1 = 5ï¼Œtrx_list é›†åˆçš„å€¼æ˜¯ 1,3ï¼ŒRead View å¦‚ä¸‹å›¾</p><figure><img src="'+Ns+'" alt="image-20220404132944906" tabindex="0" loading="lazy"><figcaption>image-20220404132944906</figcaption></figure><p>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåªæœ‰äº‹åŠ¡ 4 ä¿®æ”¹è¿‡è¯¥è¡Œè®°å½•ï¼Œå¹¶åœ¨äº‹åŠ¡ 2 æ‰§è¡Œå¿«ç…§è¯»å‰ï¼Œå°±æäº¤äº†äº‹åŠ¡ï¼Œæ‰€ä»¥å½“å‰è¯¥è¡Œå½“å‰æ•°æ®çš„ undo log å¦‚ä¸‹å›¾æ‰€ç¤ºï¼›æˆ‘ä»¬çš„äº‹åŠ¡ 2 åœ¨å¿«ç…§è¯»è¯¥è¡Œè®°å½•çš„æ—¶å€™ï¼Œå°±ä¼šæ‹¿è¯¥è¡Œè®°å½•çš„ DB_TRX_ID å»è·Ÿ up_limit_id,low_limit_id å’Œæ´»è·ƒäº‹åŠ¡ ID åˆ—è¡¨(trx_list)è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­å½“å‰äº‹åŠ¡ 2 èƒ½çœ‹åˆ°è¯¥è®°å½•çš„ç‰ˆæœ¬æ˜¯å“ªä¸ªã€‚</p><figure><img src="'+Ms+'" alt="image-20220404132956262" tabindex="0" loading="lazy"><figcaption>image-20220404132956262</figcaption></figure><p>æ‰€ä»¥å…ˆæ‹¿è¯¥è®°å½• DB_TRX_ID å­—æ®µè®°å½•çš„äº‹åŠ¡ ID 4 å»è·Ÿ Read View çš„çš„ up_limit_id æ¯”è¾ƒï¼Œçœ‹ 4 æ˜¯å¦å°äº up_limit_id(1)ï¼Œæ‰€ä»¥ä¸ç¬¦åˆæ¡ä»¶ï¼Œç»§ç»­åˆ¤æ–­ 4 æ˜¯å¦å¤§äºç­‰äº low_limit_id(5)ï¼Œä¹Ÿä¸ç¬¦åˆæ¡ä»¶ï¼Œæœ€ååˆ¤æ–­ 4 æ˜¯å¦å¤„äº trx_list ä¸­çš„æ´»è·ƒäº‹åŠ¡, æœ€åå‘ç°äº‹åŠ¡ ID ä¸º 4 çš„äº‹åŠ¡ä¸åœ¨å½“å‰æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­, ç¬¦åˆå¯è§æ€§æ¡ä»¶ï¼Œæ‰€ä»¥äº‹åŠ¡ 4 ä¿®æ”¹åæäº¤çš„æœ€æ–°ç»“æœå¯¹äº‹åŠ¡ 2 å¿«ç…§è¯»æ—¶æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥äº‹åŠ¡ 2 èƒ½è¯»åˆ°çš„æœ€æ–°æ•°æ®è®°å½•æ˜¯äº‹åŠ¡ 4 æ‰€æäº¤çš„ç‰ˆæœ¬ï¼Œè€Œäº‹åŠ¡ 4 æäº¤çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å…¨å±€è§’åº¦ä¸Šæœ€æ–°çš„ç‰ˆæœ¬</p><figure><img src="'+Es+'" alt="image-20220404133007326" tabindex="0" loading="lazy"><figcaption>image-20220404133007326</figcaption></figure><p>ä¹Ÿæ­£æ˜¯ Read View ç”Ÿæˆæ—¶æœºçš„ä¸åŒï¼Œä»è€Œé€ æˆ RC,RR çº§åˆ«ä¸‹å¿«ç…§è¯»çš„ç»“æœçš„ä¸åŒ</p><h4 id="mvcc-ç‰ˆæœ¬æŸ¥çœ‹-ä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç°å¹»è¯»" tabindex="-1"><a class="header-anchor" href="#mvcc-ç‰ˆæœ¬æŸ¥çœ‹-ä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç°å¹»è¯»" aria-hidden="true">#</a> MVCC ç‰ˆæœ¬æŸ¥çœ‹ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç°å¹»è¯»?</h4><p>å…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ï¼Œå¹»è¯»(é—´éš™é”)</p><p>å¯¹â€œå¹»è¯»â€åšä¸€ä¸ªè¯´æ˜ï¼š</p><ol><li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚</li><li>session B çš„ä¿®æ”¹ç»“æœï¼Œè¢« session A ä¹‹åçš„ select è¯­å¥ç”¨â€œå½“å‰è¯»â€çœ‹åˆ°ï¼Œä¸èƒ½ç§°ä¸ºå¹»è¯»ã€‚ <strong>å¹»è¯»ä»…ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œ</strong>â€ã€‚</li></ol><figure><img src="'+Os+'" alt="image-20220404131943705" tabindex="0" loading="lazy"><figcaption>image-20220404131943705</figcaption></figure><p>session A é‡Œæ‰§è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢ï¼Œåˆ†åˆ«æ˜¯ Q1ã€ Q2 å’Œ Q3ã€‚ å®ƒä»¬çš„ SQL è¯­å¥ç›¸åŒï¼Œéƒ½æ˜¯ select * from t where d=5 for updateã€‚ è¡¨ç¤ºæŸ¥æ‰€æœ‰ d=5 çš„è¡Œï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯å½“å‰è¯»ï¼Œå¹¶ä¸”åŠ ä¸Šå†™é”ã€‚ å…¶ä¸­ï¼ŒQ3 è¯»åˆ° id=1 è¿™ä¸€è¡Œçš„ç°è±¡ï¼Œè¢«ç§°ä¸ºâ€œå¹»è¯»â€ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œ</p><p>å¹»è¯»ä¼šå¯¼è‡´æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ é”çš„è®¾è®¡æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ è€Œè¿™ä¸ªä¸€è‡´æ€§ï¼Œä¸æ­¢æ˜¯æ•°æ®åº“å†…éƒ¨æ•°æ®çŠ¶æ€åœ¨æ­¤åˆ»çš„ä¸€è‡´æ€§ï¼Œè¿˜åŒ…å«äº†æ•°æ®å’Œæ—¥å¿—åœ¨é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§ã€‚</p><ol><li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚ å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚</li><li>ä¸Šé¢ session B çš„ä¿®æ”¹ç»“æœï¼Œè¢« session A ä¹‹åçš„ select è¯­å¥ç”¨â€œå½“å‰è¯»â€çœ‹åˆ°ï¼Œä¸èƒ½ç§°ä¸ºå¹»è¯»ã€‚å¹»è¯»ä»…ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œâ€</li></ol><figure><img src="'+Bs+`" alt="image-20220404131957890" tabindex="0" loading="lazy"><figcaption>image-20220404131957890</figcaption></figure><p>å°è¯•è§£å†³å¹»è¯»ï¼ŒæŠŠæ‰€æœ‰è¯­å¥éƒ½ä¸Šé”ï¼ŒæŸ¥è¯¢è¯­å¥æ”¹æˆ <code>select * from t for update</code>ã€‚ä½†æ˜¯ä»ç„¶æ— æ³•è§£å†³æ’å…¥æ–°è¯­å¥å‡ºç°çš„å¹»è¯»ç°è±¡ã€‚</p><p>å¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿ</p><p>InnoDB å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é”(Gap Lock)ã€‚åœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…å°†ç»™è¡ŒåŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œä¸¤è¾¹çš„ç©ºéš™ï¼Œä¹ŸåŠ ä¸Šäº†é—´éš™é”ã€‚</p><p>é—´éš™é”ä¹‹é—´çš„å†²çªï¼šè·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚ é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚</p><p>é—´éš™é”å’Œè¡Œé”åˆç§° next-key lockï¼Œæ¯ä¸ª next-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚</p><ul><li>å¦‚æœç”¨ <code>select * from t for update</code>è¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥ï¼Œå°±å½¢æˆäº† 7 ä¸ª next-key lockï¼Œåˆ†åˆ«æ˜¯ (-âˆ,0]ã€ (0,5]ã€ (5,10]ã€ (10,15]ã€ (15,20]ã€ (20, 25]ã€ (25, +supremum]ã€‚</li><li>InnoDB ç»™æ¯ä¸ªç´¢å¼•åŠ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æœ€å¤§å€¼ supremumã€‚</li></ul><p>é—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„ã€‚</p><h4 id="sql-æ…¢æŸ¥è¯¢-ä¼˜åŒ–-å¦‚æœæ²¡æœ‰ç´¢å¼•æ€ä¹ˆåŠ-åŠ äº†ç´¢å¼•ä¹Ÿæ¯”è¾ƒæ…¢æ€ä¹ˆåŠ-2022è™¾çš®" tabindex="-1"><a class="header-anchor" href="#sql-æ…¢æŸ¥è¯¢-ä¼˜åŒ–-å¦‚æœæ²¡æœ‰ç´¢å¼•æ€ä¹ˆåŠ-åŠ äº†ç´¢å¼•ä¹Ÿæ¯”è¾ƒæ…¢æ€ä¹ˆåŠ-2022è™¾çš®" aria-hidden="true">#</a> sql æ…¢æŸ¥è¯¢ï¼ˆä¼˜åŒ–ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•æ€ä¹ˆåŠï¼ŸåŠ äº†ç´¢å¼•ä¹Ÿæ¯”è¾ƒæ…¢æ€ä¹ˆåŠï¼Ÿï¼ˆ2022è™¾çš®ï¼‰</h4><p>æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å°†å…¶å¼€å¯ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>SET GLOBAL <span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span>ON
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,131),Hp={href:"https://mp.weixin.qq.com/s/pJQwnNOwRKw1MvcDTOrjqQ",target:"_blank",rel:"noopener noreferrer"},Fp={href:"https://mp.weixin.qq.com/s/WnO_4SoEL6jugkxPHW4KCg",target:"_blank",rel:"noopener noreferrer"},Jp=t('<h4 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡-äº‹åŠ¡-acid-ç‰¹æ€§-éš”ç¦»çº§åˆ«-éš”ç¦»çº§åˆ«å¯¹åº”é—®é¢˜å¯¹å…¶æè¿°" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡-äº‹åŠ¡-acid-ç‰¹æ€§-éš”ç¦»çº§åˆ«-éš”ç¦»çº§åˆ«å¯¹åº”é—®é¢˜å¯¹å…¶æè¿°" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿäº‹åŠ¡ ACID ç‰¹æ€§ï¼Œéš”ç¦»çº§åˆ«ï¼Œéš”ç¦»çº§åˆ«å¯¹åº”é—®é¢˜å¯¹å…¶æè¿°</h4><p>äº‹åŠ¡æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ Commit æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Rollback è¿›è¡Œå›æ»šã€‚</p><figure><img src="'+Ds+'" alt="image-20220404125754531" tabindex="0" loading="lazy"><figcaption>image-20220404125754531</figcaption></figure><p><strong>äº‹åŠ¡åŸºæœ¬ç‰¹æ€§ ACID</strong>?ï¼š</p><ul><li><strong>A åŸå­æ€§(atomicity)</strong> æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li><strong>C ä¸€è‡´æ€§(consistency)</strong> æŒ‡çš„æ˜¯æ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ã€‚æ¯”å¦‚ A è½¬è´¦ç»™ B100 å—é’±ï¼Œå‡è®¾ä¸­é—´ sql æ‰§è¡Œè¿‡ç¨‹ä¸­ç³»ç»Ÿå´©æºƒ A ä¹Ÿä¸ä¼šæŸå¤± 100 å—ï¼Œå› ä¸ºäº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œä¿®æ”¹ä¹Ÿå°±ä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“ã€‚</li><li><strong>I éš”ç¦»æ€§(isolation)</strong> æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤å‰ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li><li><strong>D æŒä¹…æ€§(durability)</strong> æŒ‡çš„æ˜¯ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œæ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</li></ul><p>å››å¤§æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œåˆ†åˆ«æ˜¯ <code>è¯»æœªæäº¤ï¼Œè¯»å·²æäº¤ï¼Œå¯é‡å¤è¯»ï¼Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰</code>ã€‚</p><ul><li><strong>æœªæäº¤è¯»(READ UNCOMMITTED)</strong> äº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚</li><li><strong>æäº¤è¯»(READ COMMITTED)</strong> ä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æäº¤ä¹‹å‰å¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li><li><strong>å¯é‡å¤è¯»(REPEATABLE READ)</strong> ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·æ•°æ®çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</li><li><strong>å¯ä¸²è¡ŒåŒ–(SERIALIZABLE)</strong> å¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚</li></ul><table><thead><tr><th style="text-align:center;">éš”ç¦»çº§åˆ«</th><th style="text-align:center;">è„è¯»</th><th style="text-align:center;">ä¸å¯é‡å¤è¯»</th><th style="text-align:center;">å¹»å½±è¯»</th></tr></thead><tbody><tr><td style="text-align:center;">æœªæäº¤è¯»</td><td style="text-align:center;">âˆš</td><td style="text-align:center;">âˆš</td><td style="text-align:center;">âˆš</td></tr><tr><td style="text-align:center;">æäº¤è¯»</td><td style="text-align:center;">Ã—</td><td style="text-align:center;">âˆš</td><td style="text-align:center;">âˆš</td></tr><tr><td style="text-align:center;">å¯é‡å¤è¯»</td><td style="text-align:center;">Ã—</td><td style="text-align:center;">Ã—</td><td style="text-align:center;">âˆš</td></tr><tr><td style="text-align:center;">å¯ä¸²è¡ŒåŒ–</td><td style="text-align:center;">Ã—</td><td style="text-align:center;">Ã—</td><td style="text-align:center;">Ã—</td></tr></tbody></table><h4 id="èƒ½è¯´ä¸‹-myisam-å’Œ-innodb-çš„åŒºåˆ«å—-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#èƒ½è¯´ä¸‹-myisam-å’Œ-innodb-çš„åŒºåˆ«å—-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> èƒ½è¯´ä¸‹ myisam å’Œ innodb çš„åŒºåˆ«å—ï¼Ÿ(2022ç•ªèŒ„å°è¯´)</h4><p>myisam å¼•æ“æ˜¯ 5.1 ç‰ˆæœ¬ä¹‹å‰çš„é»˜è®¤å¼•æ“ï¼Œæ”¯æŒå…¨æ–‡æ£€ç´¢ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨äºæœ‰å¤§é‡æŸ¥è¯¢å°‘é‡æ’å…¥çš„åœºæ™¯æ¥ä½¿ç”¨ï¼Œè€Œä¸” myisam ä¸æ”¯æŒå¤–é”®ï¼Œå¹¶ä¸”ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚</p><p>innodb æ˜¯åŸºäº B+Tree ç´¢å¼•å»ºç«‹çš„ï¼Œå’Œ myisam ç›¸åå®ƒæ”¯æŒäº‹åŠ¡ã€å¤–é”®ï¼Œå¹¶ä¸”é€šè¿‡ MVCC æ¥æ”¯æŒé«˜å¹¶å‘ï¼Œç´¢å¼•å’Œæ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ã€‚</p><h4 id="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«" aria-hidden="true">#</a> èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«</h4><p>ä»ç‰©ç†å­˜å‚¨çš„è§’åº¦æ¥çœ‹ï¼Œç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ã€äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•ï¼‰ã€‚</p><p>è¿™ä¸¤ä¸ªåŒºåˆ«åœ¨å‰é¢ä¹Ÿæåˆ°äº†ï¼š</p><ul><li>ä¸»é”®ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨ä¸»é”®ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹é‡Œï¼›</li><li>äºŒçº§ç´¢å¼•çš„ B+Tree çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚</li></ul><p>æ‰€ä»¥ï¼Œåœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨äº†äºŒçº§ç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®èƒ½åœ¨äºŒçº§ç´¢å¼•é‡ŒæŸ¥è¯¢çš„åˆ°ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å›è¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è¦†ç›–ç´¢å¼•ã€‚å¦‚æœæŸ¥è¯¢çš„æ•°æ®ä¸åœ¨äºŒçº§ç´¢å¼•é‡Œï¼Œå°±ä¼šå…ˆæ£€ç´¢äºŒçº§ç´¢å¼•ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œè·å–åˆ°ä¸»é”®å€¼åï¼Œç„¶åå†æ£€ç´¢ä¸»é”®ç´¢å¼•ï¼Œå°±èƒ½æŸ¥è¯¢åˆ°æ•°æ®äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å›è¡¨ã€‚</p><h4 id="äº†è§£-mysql-çš„ç´¢å¼•å—" tabindex="-1"><a class="header-anchor" href="#äº†è§£-mysql-çš„ç´¢å¼•å—" aria-hidden="true">#</a> äº†è§£ mysql çš„ç´¢å¼•å—ï¼Ÿ</h4><p>é¦–å…ˆï¼Œç´¢å¼•æ˜¯åœ¨<strong>å­˜å‚¨å¼•æ“å±‚å®ç°</strong>çš„ï¼Œè€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„ï¼Œæ‰€ä»¥ä¸åŒå­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„ç´¢å¼•ç±»å‹å’Œå®ç°ã€‚</p><p>æœ‰å“ªäº›ï¼Ÿ</p><ul><li><strong>B+Tree ç´¢å¼•</strong><ul><li>æ˜¯å¤§å¤šæ•° MySQL å­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚</li></ul></li><li><strong>å“ˆå¸Œç´¢å¼•</strong><ul><li>å“ˆå¸Œç´¢å¼•èƒ½ä»¥ O(1) æ—¶é—´è¿›è¡ŒæŸ¥æ‰¾ï¼Œä½†æ˜¯å¤±å»äº†æœ‰åºæ€§ï¼›</li><li>InnoDB å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åŠŸèƒ½å«â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€ï¼Œå½“æŸä¸ªç´¢å¼•å€¼è¢«ä½¿ç”¨çš„éå¸¸é¢‘ç¹æ—¶ï¼Œä¼šåœ¨ B+Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·å°±è®© B+Tree ç´¢å¼•å…·æœ‰å“ˆå¸Œç´¢å¼•çš„ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¿«é€Ÿçš„å“ˆå¸ŒæŸ¥æ‰¾ã€‚</li></ul></li><li><strong>å…¨æ–‡ç´¢å¼•</strong><ul><li>MyISAM å­˜å‚¨å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œç”¨äºæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚æŸ¥æ‰¾æ¡ä»¶ä½¿ç”¨ MATCH AGAINSTï¼Œè€Œä¸æ˜¯æ™®é€šçš„ WHEREã€‚</li><li>å…¨æ–‡ç´¢å¼•ä¸€èˆ¬ä½¿ç”¨å€’æ’ç´¢å¼•å®ç°ï¼Œå®ƒè®°å½•ç€å…³é”®è¯åˆ°å…¶æ‰€åœ¨æ–‡æ¡£çš„æ˜ å°„ã€‚</li><li>InnoDB å­˜å‚¨å¼•æ“åœ¨ MySQL 5.6.4 ç‰ˆæœ¬ä¸­ä¹Ÿå¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</li></ul></li><li><strong>ç©ºé—´æ•°æ®ç´¢å¼•</strong><ul><li>MyISAM å­˜å‚¨å¼•æ“æ”¯æŒç©ºé—´æ•°æ®ç´¢å¼•(R-Tree)ï¼Œå¯ä»¥ç”¨äºåœ°ç†æ•°æ®å­˜å‚¨ã€‚ç©ºé—´æ•°æ®ç´¢å¼•ä¼šä»æ‰€æœ‰ç»´åº¦æ¥ç´¢å¼•æ•°æ®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ä»»æ„ç»´åº¦æ¥è¿›è¡Œç»„åˆæŸ¥è¯¢ã€‚</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨-b-æ ‘ç´¢å¼•-æ ‘çš„é«˜åº¦æ˜¯å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨-b-æ ‘ç´¢å¼•-æ ‘çš„é«˜åº¦æ˜¯å¤šå°‘" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ç”¨ b+æ ‘ç´¢å¼•ï¼Ÿæ ‘çš„é«˜åº¦æ˜¯å¤šå°‘ï¼Ÿ</h4><p><strong>ä»€ä¹ˆæ˜¯ B+Tree?</strong></p><p>B+ Tree æ˜¯åŸºäº B Tree å’Œå¶å­èŠ‚ç‚¹é¡ºåºè®¿é—®æŒ‡é’ˆè¿›è¡Œå®ç°ï¼Œå®ƒå…·æœ‰ B Tree çš„å¹³è¡¡æ€§ï¼Œå¹¶ä¸”é€šè¿‡é¡ºåºè®¿é—®æŒ‡é’ˆæ¥æé«˜åŒºé—´æŸ¥è¯¢çš„æ€§èƒ½ã€‚åœ¨ B+ Tree ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ key ä»å·¦åˆ°å³éé€’å‡æ’åˆ—ï¼Œå¦‚æœæŸä¸ªæŒ‡é’ˆçš„å·¦å³ç›¸é‚» key åˆ†åˆ«æ˜¯ keyi å’Œ keyi+1ï¼Œä¸”ä¸ä¸º nullï¼Œåˆ™è¯¥æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰ key å¤§äºç­‰äº keyi ä¸”å°äºç­‰äº keyi+1ã€‚</p><figure><img src="'+zs+`" alt="image-20220404131009734" tabindex="0" loading="lazy"><figcaption>image-20220404131009734</figcaption></figure><p><strong>ä¸ºä»€ä¹ˆæ˜¯ B+Tree</strong>?</p><ul><li>ä¸ºäº†å‡å°‘ç£ç›˜è¯»å–æ¬¡æ•°ï¼Œå†³å®šäº†æ ‘çš„é«˜åº¦ä¸èƒ½é«˜ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å…ˆ B-Treeï¼›</li><li>ä»¥é¡µä¸ºå•ä½è¯»å–ä½¿å¾—ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”ç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ï¼›æ‰€ä»¥æ•°æ®æ”¾åœ¨å¶å­èŠ‚ç‚¹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Page é¡µï¼›</li><li>ä¸ºäº†æ”¯æŒèŒƒå›´æŸ¥è¯¢ä»¥åŠå…³è”å…³ç³»ï¼Œ é¡µä¸­æ•°æ®éœ€è¦æœ‰åºï¼Œä¸”é¡µçš„å°¾éƒ¨èŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸ªé¡µçš„å¤´éƒ¨ï¼›</li></ul><h4 id="ä»€ä¹ˆæ˜¯è¡¨é”-myisam" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯è¡¨é”-myisam" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯è¡¨é”ï¼ˆMyISAMï¼‰</h4><p>MySQL 5.5 ä¹‹å‰ï¼ŒMyISAM å¼•æ“æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå¯è°“æ˜¯é£å…‰ä¸€æ—¶ã€‚</p><p>è™½ç„¶ï¼ŒMyISAM çš„æ€§èƒ½è¿˜è¡Œï¼Œå„ç§ç‰¹æ€§ä¹Ÿè¿˜ä¸é”™ï¼ˆæ¯”å¦‚å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”æœ€å¤§çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚</p><p>MySQL 5.5.5 ä¹‹å‰ï¼ŒMyISAM æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚5.5.5 ç‰ˆæœ¬ä¹‹åï¼ŒInnoDB æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œåœ¨æŸäº›è¯»å¯†é›†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ MyISAM ä¹Ÿæ˜¯åˆé€‚çš„ã€‚ä¸è¿‡ï¼Œå‰ææ˜¯ä½ çš„é¡¹ç›®ä¸ä»‹æ„ MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€å´©æºƒæ¢å¤ç­‰ç¼ºç‚¹</p><p>ã€ŠMySQL é«˜æ€§èƒ½ã€‹ä¸Šé¢æœ‰ä¸€å¥è¯è¿™æ ·å†™åˆ°:</p><p><code>ä¸è¦è½»æ˜“ç›¸ä¿¡â€œMyISAM æ¯” InnoDB å¿«â€ä¹‹ç±»çš„ç»éªŒä¹‹è°ˆï¼Œè¿™ä¸ªç»“è®ºå¾€å¾€ä¸æ˜¯ç»å¯¹çš„ã€‚åœ¨å¾ˆå¤šæˆ‘ä»¬å·²çŸ¥åœºæ™¯ä¸­ï¼ŒInnoDB çš„é€Ÿåº¦éƒ½å¯ä»¥è®© MyISAM æœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚</code></p><h4 id="mysqlçš„è¡Œé”æ€ä¹ˆå®ç°çš„-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#mysqlçš„è¡Œé”æ€ä¹ˆå®ç°çš„-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> MySQLçš„è¡Œé”æ€ä¹ˆå®ç°çš„ï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h4><p>InnoDBè¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ <code>ç´¢å¼•é¡¹åŠ é”</code>æ¥å®ç°çš„ã€‚æ‰€ä»¥ï¼Œåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ŒInnoDBæ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨è¡¨é”ã€‚</p><h4 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜" aria-hidden="true">#</a> å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜?</h4><p>åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚</p><ul><li><strong>è„è¯»ï¼ˆDirty readï¼‰:</strong> å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚</li><li><strong>ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰:</strong> æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 ä¹Ÿä¿®æ”¹ A=A-1ï¼Œæœ€ç»ˆç»“æœ A=19ï¼Œäº‹åŠ¡ 1 çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable readï¼‰:</strong> æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</li><li><strong>å¹»è¯»ï¼ˆPhantom readï¼‰:</strong> å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚</li></ul><p><strong>ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åŒºåˆ«</strong> ï¼šä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›åˆ—çš„å€¼è¢«ä¿®æ”¹ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤æ¯”å¦‚å¤šæ¬¡æŸ¥è¯¢åŒä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼ˆDQLï¼‰æ—¶ï¼Œè®°å½•å‘ç°è®°å½•å¢å¤šæˆ–å‡å°‘äº†ã€‚</p><h4 id="é—®ä¸€ä¸‹-mysql-é»˜è®¤éš”ç¦»çº§åˆ«-å¯ä»¥è§£å†³å¹»è¯»å—" tabindex="-1"><a class="header-anchor" href="#é—®ä¸€ä¸‹-mysql-é»˜è®¤éš”ç¦»çº§åˆ«-å¯ä»¥è§£å†³å¹»è¯»å—" aria-hidden="true">#</a> é—®ä¸€ä¸‹ MySQL é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥è§£å†³å¹»è¯»å—ï¼Ÿ</h4><p>MySQLé€‰æ‹©<strong>Repeatable Readï¼ˆå¯é‡å¤è¯»ï¼‰ä½œä¸ºé»˜è®¤éš”ç¦»çº§åˆ«</strong>ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“éš”ç¦»çº§åˆ«é€‰çš„æ˜¯è¯»å·²æäº¤ã€‚</p><p>åœ¨è¿™ä¹‹å‰è¦å…ˆäº†è§£æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼š</p><p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>SELECT @@tx_isolation;</code>å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º <code>SELECT @@transaction_isolation;</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span> @<span class="token variable">@tx_isolation</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
<span class="token operator">|</span> <span class="token keyword">REPEATABLE</span><span class="token operator">-</span><span class="token keyword">READ</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,44),Up={href:"https://javaguide.cn/database/mysql/transaction-isolation-level.html",target:"_blank",rel:"noopener noreferrer"},Kp=t(`<p>å¾ˆæ˜¾ç„¶ï¼Œå›é¡¾ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œå¹»è¯»å’Œä¸å¯é‡å¤è¯»æ˜¯å·®ä¸å¤šçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªé»˜è®¤çš„å¯é‡å¤è¯»å°±å¯¹ç«‹ã€‚</p><p>æ‹“å±•ï¼šä¸ºä»€ä¹ˆé€‰æ‹©RRä¸ºé»˜è®¤éš”ç¦»çº§åˆ«ï¼Ÿ</p><p>binlogçš„æ ¼å¼ä¹Ÿæœ‰ä¸‰ç§ï¼šstatementï¼Œrowï¼Œmixedã€‚è®¾ç½®ä¸º <code>statement</code>æ ¼å¼ï¼Œbinlogè®°å½•çš„æ˜¯SQLçš„åŸæ–‡ã€‚åˆå› ä¸ºMySQLåœ¨ä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹æ˜¯é€šè¿‡ <code>binlog</code>è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå¦‚æœè®¾ç½®ä¸ºè¯»å·²æäº¤ï¼ˆRCï¼‰éš”ç¦»çº§åˆ«ï¼Œå½“å‡ºç°äº‹åŠ¡ä¹±åºçš„æ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´å¤‡åº“åœ¨ SQL å›æ”¾ä¹‹åï¼Œç»“æœå’Œä¸»åº“å†…å®¹ä¸ä¸€è‡´ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªè¡¨tï¼Œè¡¨ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CREATE TABLE t (  
     a int(11) DEFAULT NULL,  
     b int(11) DEFAULT NULL,  
     PRIMARY KEY a (a),
     KEY b(b)
   ) ENGINE=InnoDB DEFAULT CHARSET=latin1;  
   insert into t1 values(10,666),(20,233); 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ä¸ªäº‹åŠ¡å¹¶å‘å†™æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="`+qs+'" alt="image-20220613101500219" tabindex="0" loading="lazy"><figcaption>image-20220613101500219</figcaption></figure><p>åœ¨ <code>è¯»å·²æäº¤ï¼ˆRCï¼‰</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸¤ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œåï¼Œæ•°æ®åº“çš„ä¸¤æ¡è®°å½•å°±å˜æˆäº† <code>ï¼ˆ30,666ï¼‰ã€(20,666)</code>ã€‚è¿™ä¸¤ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œåï¼Œbinlogä¹Ÿå°±æœ‰ä¸¤æ¡è®°å½•ï¼Œå› ä¸ºäº‹åŠ¡binlogç”¨çš„æ˜¯ <code>statement</code>æ ¼å¼ï¼Œäº‹åŠ¡2å…ˆæäº¤ï¼Œå› æ­¤ <code>update t set b=666 where b=233</code>ä¼˜å…ˆè®°å½•ï¼Œè€Œ <code>update t set a=30 where b=666</code>è®°å½•åœ¨åé¢ã€‚</p><p>å½“ <code>bin log</code>åŒæ­¥åˆ°ä»åº“åï¼Œæ‰§è¡Œ <code>update t set b=666 where b=233</code>å’Œ <code>update t set a=30 where b=666</code>è®°å½•ï¼Œæ•°æ®åº“çš„è®°å½•å°±å˜æˆ <code>ï¼ˆ30,666ï¼‰ã€(30,666)</code>ï¼Œè¿™æ—¶å€™ä¸»ä»æ•°æ®ä¸ä¸€è‡´å•¦ã€‚</p><p>å› æ­¤MySQLçš„<strong>é»˜è®¤éš”ç¦»ç¦»åˆ«</strong>é€‰æ‹©äº† <code>RR</code>è€Œä¸æ˜¯ <code>RC</code>ã€‚<code>RR</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ›´æ–°æ•°æ®çš„æ—¶å€™ä¸ä»…å¯¹æ›´æ–°çš„è¡ŒåŠ è¡Œçº§é”ï¼Œè¿˜ä¼šåŠ é—´éš™é” <code>ï¼ˆgap lockï¼‰</code>ã€‚äº‹åŠ¡2è¦æ‰§è¡Œæ—¶ï¼Œå› ä¸ºäº‹åŠ¡1å¢åŠ äº†é—´éš™é”ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡2æ‰§è¡Œè¢«å¡ä½ï¼Œåªæœ‰ç­‰äº‹åŠ¡1æäº¤æˆ–è€…å›æ»šåæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p>å¹¶ä¸”ï¼ŒMySQLè¿˜ç¦æ­¢åœ¨ä½¿ç”¨ <code>statement</code>æ ¼å¼çš„ <code>binlog</code>çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>READ COMMITTED</code>ä½œä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><p><strong>å†æ‹“å±•</strong>ï¼šé€‰æ‹©RCï¼ˆè¯»å·²æäº¤ï¼‰ä½œä¸ºé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼š</p><p>é‚£ä¸ºä»€ä¹ˆMySQLå®˜æ–¹é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯RRï¼Œè€Œæœ‰äº›å¤§å‚é€‰æ‹©äº†RCä½œä¸ºé»˜è®¤çš„éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ</p><ul><li>æå‡å¹¶å‘</li></ul><p>RC åœ¨åŠ é”çš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦æ·»åŠ  <code>Gap Lock</code>å’Œ <code>Next-Key Lock </code>çš„ï¼Œåªå¯¹è¦ä¿®æ”¹çš„è®°å½•æ·»åŠ è¡Œçº§é”å°±è¡Œäº†ã€‚å› æ­¤RCçš„æ”¯æŒçš„å¹¶å‘åº¦æ¯”RRé«˜å¾—å¤šï¼Œ</p><ul><li>å‡å°‘æ­»é”</li></ul><p>æ­£æ˜¯å› ä¸ºRRéš”ç¦»çº§åˆ«å¢åŠ äº† <code>Gap Lock</code>å’Œ <code>Next-Key Lock </code>é”ï¼Œå› æ­¤å®ƒç›¸å¯¹äºRCï¼Œæ›´å®¹æ˜“äº§ç”Ÿæ­»é”ã€‚</p><h4 id="rréš”ç¦»çº§åˆ«å®ç°åŸç†-å®ƒæ˜¯å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»çš„-oppo" tabindex="-1"><a class="header-anchor" href="#rréš”ç¦»çº§åˆ«å®ç°åŸç†-å®ƒæ˜¯å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»çš„-oppo" aria-hidden="true">#</a> RRéš”ç¦»çº§åˆ«å®ç°åŸç†ï¼Œå®ƒæ˜¯å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»çš„ï¼Ÿï¼ˆOPPOï¼‰</h4><p>ä»€ä¹ˆæ˜¯ä¸å¯é‡å¤è¯»</p><hr><p>å…ˆå›å¿†ä¸‹ä»€ä¹ˆæ˜¯<strong>ä¸å¯é‡å¤è¯»</strong>ã€‚å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªäº‹åŠ¡Aå’ŒBï¼š</p><ul><li>äº‹åŠ¡Aå…ˆæŸ¥è¯¢Jayçš„ä½™é¢ï¼ŒæŸ¥åˆ°ç»“æœæ˜¯100</li><li>è¿™æ—¶å€™äº‹åŠ¡B å¯¹Jayçš„è´¦æˆ·ä½™é¢è¿›è¡Œæ‰£å‡ï¼Œæ‰£å»10åï¼Œæäº¤äº‹åŠ¡</li><li>äº‹åŠ¡Aå†å»æŸ¥è¯¢Jayçš„è´¦æˆ·ä½™é¢å‘ç°å˜æˆäº†90</li></ul><figure><img src="'+js+'" alt="image-20220613101750929" tabindex="0" loading="lazy"><figcaption>image-20220613101750929</figcaption></figure><p>äº‹åŠ¡Aè¢«äº‹åŠ¡Bå¹²æ‰°åˆ°äº†ï¼åœ¨äº‹åŠ¡AèŒƒå›´å†…ï¼Œä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢ï¼Œ<strong>è¯»å–åŒä¸€æ¡è®°å½•ï¼Œå´è¿”å›äº†ä¸åŒçš„æ•°æ®ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯»</strong>ã€‚</p><p>undo logç‰ˆæœ¬é“¾ + Read Viewå¯è§æ€§è§„åˆ™</p><hr><p>RRéš”ç¦»çº§åˆ«å®ç°åŸç†ï¼Œå°±æ˜¯MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œè€ŒMVCCæ˜¯æ˜¯é€šè¿‡ <code>Read View+ Undo Log</code>å®ç°çš„ï¼ŒUndo Log ä¿å­˜äº†å†å²å¿«ç…§ï¼ŒRead Viewå¯è§æ€§è§„åˆ™å¸®åŠ©åˆ¤æ–­å½“å‰ç‰ˆæœ¬çš„æ•°æ®æ˜¯å¦å¯è§ã€‚</p><p><code>Undo Log</code>ç‰ˆæœ¬é“¾é•¿è¿™æ ·ï¼š</p><figure><img src="'+Hs+'" alt="image-20220613101819752" tabindex="0" loading="lazy"><figcaption>image-20220613101819752</figcaption></figure><p>Read view çš„å‡ ä¸ªé‡è¦å±æ€§</p><ul><li><code>m_ids</code>:å½“å‰ç³»ç»Ÿä¸­é‚£äº›æ´»è·ƒ(æœªæäº¤)çš„è¯»å†™äº‹åŠ¡ID, å®ƒæ•°æ®ç»“æ„ä¸ºä¸€ä¸ªListã€‚</li><li><code>min_limit_id</code>:è¡¨ç¤ºåœ¨ç”ŸæˆRead Viewæ—¶ï¼Œå½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„è¯»å†™äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡idï¼Œå³m_idsä¸­çš„æœ€å°å€¼ã€‚</li><li><code>max_limit_id</code>:è¡¨ç¤ºç”ŸæˆRead Viewæ—¶ï¼Œç³»ç»Ÿä¸­åº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„idå€¼ã€‚</li><li><code>creator_trx_id</code>: åˆ›å»ºå½“å‰Read Viewçš„äº‹åŠ¡ID</li></ul><p>Read view å¯è§æ€§è§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœæ•°æ®äº‹åŠ¡ID <code>trx_id &lt; min_limit_id</code>ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”ŸæˆRead Viewå‰ï¼Œå·²ç»æäº¤(å› ä¸ºäº‹åŠ¡IDæ˜¯é€’å¢çš„)ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœ <code>trx_id&gt;= max_limit_id</code>ï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”ŸæˆRead Viewåæ‰ç”Ÿæˆï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚</li><li>å¦‚æœ <code>min_limit_id =&lt;trx_id&lt; max_limit_id</code>,éœ€è¦åˆ†3ç§æƒ…å†µè®¨è®º</li></ol><ul><li>3.1 å¦‚æœ <code>m_ids</code>åŒ…å« <code>trx_id</code>,åˆ™ä»£è¡¨Read Viewç”Ÿæˆæ—¶åˆ»ï¼Œè¿™ä¸ªäº‹åŠ¡è¿˜æœªæäº¤ï¼Œä½†æ˜¯å¦‚æœæ•°æ®çš„ <code>trx_id</code>ç­‰äº <code>creator_trx_id</code>çš„è¯ï¼Œè¡¨æ˜æ•°æ®æ˜¯è‡ªå·±ç”Ÿæˆçš„ï¼Œå› æ­¤æ˜¯å¯è§çš„ã€‚</li><li>3.2 å¦‚æœ <code>m_ids</code>åŒ…å« <code>trx_id</code>ï¼Œå¹¶ä¸” <code>trx_id</code>ä¸ç­‰äº <code>creator_trx_id</code>ï¼Œåˆ™Read Viewç”Ÿæˆæ—¶ï¼Œäº‹åŠ¡æœªæäº¤ï¼Œå¹¶ä¸”ä¸æ˜¯è‡ªå·±ç”Ÿäº§çš„ï¼Œæ‰€ä»¥å½“å‰äº‹åŠ¡ä¹Ÿæ˜¯çœ‹ä¸è§çš„ï¼›</li><li>3.3 å¦‚æœ <code>m_ids</code>ä¸åŒ…å« <code>trx_id</code>ï¼Œåˆ™è¯´æ˜ä½ è¿™ä¸ªäº‹åŠ¡åœ¨Read Viewç”Ÿæˆä¹‹å‰å°±å·²ç»æäº¤äº†ï¼Œä¿®æ”¹çš„ç»“æœï¼Œå½“å‰äº‹åŠ¡æ˜¯èƒ½çœ‹è§çš„ã€‚</li></ul><p>RR å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»</p><hr><p>æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼ŒåŸºäºMVCCï¼Œæ˜¯æ€æ ·çš„æµç¨‹</p><ol><li>è·å–äº‹åŠ¡è‡ªå·±çš„ç‰ˆæœ¬å·ï¼Œå³äº‹åŠ¡ID</li><li>è·å–Read View</li><li>æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®ï¼Œç„¶åRead Viewä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦‚æœä¸ç¬¦åˆRead Viewçš„å¯è§æ€§è§„åˆ™ï¼Œ å³å°±éœ€è¦Undo logä¸­å†å²å¿«ç…§;</li><li>æœ€åè¿”å›ç¬¦åˆè§„åˆ™çš„æ•°æ®</li></ol><p>å‡è®¾å­˜åœ¨äº‹åŠ¡Aå’ŒBï¼ŒSQLæ‰§è¡Œæµç¨‹å¦‚ä¸‹</p><figure><img src="'+Fs+'" alt="image-20220613101934371" tabindex="0" loading="lazy"><figcaption>image-20220613101934371</figcaption></figure><p>åœ¨å¯é‡å¤è¯»ï¼ˆRRï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œ<strong>ä¸€ä¸ªäº‹åŠ¡é‡Œåªä¼šè·å–ä¸€æ¬¡Read View</strong>ï¼Œéƒ½æ˜¯å‰¯æœ¬å…±ç”¨çš„ï¼Œä»è€Œä¿è¯æ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>å‡è®¾å½“å‰æœ‰ä¸€å¼ core_userè¡¨ï¼Œæ’å…¥ä¸€æ¡åˆå§‹åŒ–æ•°æ®,å¦‚ä¸‹ï¼š</p><figure><img src="'+Js+'" alt="image-20220613101941132" tabindex="0" loading="lazy"><figcaption>image-20220613101941132</figcaption></figure><p>åŸºäºMVCCï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ‰§è¡Œæµç¨‹</p><ol><li>Aå¼€å¯äº‹åŠ¡ï¼Œé¦–å…ˆå¾—åˆ°ä¸€ä¸ªäº‹åŠ¡IDä¸º100</li><li>Bå¼€å¯äº‹åŠ¡ï¼Œå¾—åˆ°äº‹åŠ¡IDä¸º101</li><li>äº‹åŠ¡Aç”Ÿæˆä¸€ä¸ªRead Viewï¼Œread viewå¯¹åº”çš„å€¼å¦‚ä¸‹</li></ol><table><thead><tr><th style="text-align:left;">å˜é‡</th><th style="text-align:left;">å€¼</th></tr></thead><tbody><tr><td style="text-align:left;">m_ids</td><td style="text-align:left;">100ï¼Œ101</td></tr><tr><td style="text-align:left;">max_limit_id</td><td style="text-align:left;">102</td></tr><tr><td style="text-align:left;">min_limit_id</td><td style="text-align:left;">100</td></tr><tr><td style="text-align:left;">creator_trx_id</td><td style="text-align:left;">100</td></tr></tbody></table><p>ç„¶åå›åˆ°ç‰ˆæœ¬é“¾ï¼šå¼€å§‹ä»ç‰ˆæœ¬é“¾ä¸­æŒ‘é€‰å¯è§çš„è®°å½•ï¼š</p><figure><img src="'+Us+`" alt="image-20220613101950349" tabindex="0" loading="lazy"><figcaption>image-20220613101950349</figcaption></figure><p>ç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°ç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯å­™æƒï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º100ã€‚å¼€å§‹æ‰§è¡Œ<strong>read viewå¯è§æ€§è§„åˆ™</strong>æ ¡éªŒï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>min_limit_id(100)=&lt;trx_idï¼ˆ100ï¼‰&lt;102;
creator_trx_id = trx_id =100;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±æ­¤å¯å¾—ï¼Œtrx_id=100çš„è¿™ä¸ªè®°å½•ï¼Œå½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ã€‚æ‰€ä»¥æŸ¥åˆ°æ˜¯<strong>nameä¸ºå­™æƒ</strong>çš„è®°å½•ã€‚</p><ol start="4"><li>äº‹åŠ¡Bè¿›è¡Œä¿®æ”¹æ“ä½œï¼ŒæŠŠåå­—æ”¹ä¸ºæ›¹æ“ã€‚æŠŠåŸæ•°æ®æ‹·è´åˆ°undo log,ç„¶åå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ ‡è®°äº‹åŠ¡IDå’Œä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬åœ¨undo logçš„åœ°å€ã€‚</li></ol><figure><img src="`+Ks+'" alt="image-20220613102027079" tabindex="0" loading="lazy"><figcaption>image-20220613102027079</figcaption></figure><ol start="5"><li>äº‹åŠ¡Bæäº¤äº‹åŠ¡</li><li>äº‹åŠ¡Aå†æ¬¡æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå› ä¸ºæ˜¯RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ï¼Œå› æ­¤<strong>ä¼šå¤ç”¨è€çš„Read Viewå‰¯æœ¬</strong>ï¼ŒRead Viewå¯¹åº”çš„å€¼å¦‚ä¸‹</li></ol><table><thead><tr><th style="text-align:left;">å˜é‡</th><th style="text-align:left;">å€¼</th></tr></thead><tbody><tr><td style="text-align:left;">m_ids</td><td style="text-align:left;">100ï¼Œ101</td></tr><tr><td style="text-align:left;">max_limit_id</td><td style="text-align:left;">102</td></tr><tr><td style="text-align:left;">min_limit_id</td><td style="text-align:left;">100</td></tr><tr><td style="text-align:left;">creator_trx_id</td><td style="text-align:left;">100</td></tr></tbody></table><p>ç„¶åå†æ¬¡å›åˆ°ç‰ˆæœ¬é“¾ï¼šä»ç‰ˆæœ¬é“¾ä¸­æŒ‘é€‰å¯è§çš„è®°å½•ï¼š</p><figure><img src="'+Qs+`" alt="image-20220613102052264" tabindex="0" loading="lazy"><figcaption>image-20220613102052264</figcaption></figure><p>ä»å›¾å¯å¾—ï¼Œæœ€æ–°ç‰ˆæœ¬çš„åˆ—nameçš„å†…å®¹æ˜¯æ›¹æ“ï¼Œè¯¥ç‰ˆæœ¬çš„trx_idå€¼ä¸º101ã€‚å¼€å§‹æ‰§è¡Œread viewå¯è§æ€§è§„åˆ™æ ¡éªŒï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>min_limit_id(100)=&lt;trx_idï¼ˆ101ï¼‰&lt;max_limit_idï¼ˆ102);
å› ä¸ºm_ids{100,101}åŒ…å«trx_idï¼ˆ101ï¼‰ï¼Œ
å¹¶ä¸”creator_trx_id (100) ä¸ç­‰äºtrx_idï¼ˆ101ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œ<code>trx_id=101</code>è¿™ä¸ªè®°å½•ï¼Œå¯¹äºå½“å‰äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚è¿™æ—¶å€™å‘¢ï¼Œç‰ˆæœ¬é“¾ <code>roll_pointer</code>è·³åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼Œ<code>trx_id=100</code>è¿™ä¸ªè®°å½•ï¼Œå†æ¬¡æ ¡éªŒæ˜¯å¦å¯è§ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>min_limit_id(100)=&lt;trx_idï¼ˆ100ï¼‰&lt; max_limit_idï¼ˆ102);
å› ä¸ºm_ids{100,101}åŒ…å«trx_idï¼ˆ100ï¼‰ï¼Œ
å¹¶ä¸”creator_trx_id (100) ç­‰äºtrx_idï¼ˆ100ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œtrx_id=100è¿™ä¸ªè®°å½•ï¼Œå¯¹äºå½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ï¼Œæ‰€ä»¥ä¸¤æ¬¡æŸ¥è¯¢ç»“æœï¼Œéƒ½æ˜¯name=å­™æƒçš„é‚£ä¸ªè®°å½•ã€‚å³åœ¨å¯é‡å¤è¯»ï¼ˆRRï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¤ç”¨è€çš„Read Viewå‰¯æœ¬ï¼Œè§£å†³äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚</p><h4 id="mysql-çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—" tabindex="-1"><a class="header-anchor" href="#mysql-çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—" aria-hidden="true">#</a> MySQL çš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å—ï¼Ÿ</h4><p>MySQL çš„éš”ç¦»çº§åˆ«åŸºäºé”å’Œ MVCC æœºåˆ¶å…±åŒå®ç°çš„ã€‚</p><p>SERIALIZABLE éš”ç¦»çº§åˆ«ï¼Œæ˜¯é€šè¿‡é”æ¥å®ç°çš„ã€‚é™¤äº† SERIALIZABLE éš”ç¦»çº§åˆ«ï¼Œå…¶ä»–çš„éš”ç¦»çº§åˆ«éƒ½æ˜¯åŸºäº MVCC å®ç°ã€‚</p><p>ä¸è¿‡ï¼Œ SERIALIZABLE ä¹‹å¤–çš„å…¶ä»–éš”ç¦»çº§åˆ«å¯èƒ½ä¹Ÿéœ€è¦ç”¨åˆ°é”æœºåˆ¶ï¼Œå°±æ¯”å¦‚ REPEATABLE-READ åœ¨å½“å‰è¯»æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åŠ é”è¯»æ¥ä¿è¯ä¸ä¼šå‡ºç°å¹»è¯»ã€‚</p><h4 id="mysqlå­˜å‚¨å¼•æ“æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#mysqlå­˜å‚¨å¼•æ“æœ‰å“ªäº›" aria-hidden="true">#</a> mysqlå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿ</h4><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>æè¿°</th></tr></thead><tbody><tr><td>ARCHIVE</td><td>ç”¨äºæ•°æ®å­˜æ¡£çš„å¼•æ“ï¼Œæ•°æ®è¢«æ’å…¥åå°±ä¸èƒ½åœ¨ä¿®æ”¹äº†ï¼Œä¸”ä¸æ”¯æŒç´¢å¼•ã€‚</td></tr><tr><td>CSV</td><td>åœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šä»¥é€—å·ä½œä¸ºæ•°æ®é¡¹ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚</td></tr><tr><td>BLACKHOLE</td><td>ä¼šä¸¢å¼ƒå†™æ“ä½œï¼Œè¯¥æ“ä½œä¼šè¿”å›ç©ºå†…å®¹ã€‚</td></tr><tr><td>FEDERATED</td><td>å°†æ•°æ®å­˜å‚¨åœ¨è¿œç¨‹æ•°æ®åº“ä¸­ï¼Œç”¨æ¥è®¿é—®è¿œç¨‹è¡¨çš„å­˜å‚¨å¼•æ“ã€‚</td></tr><tr><td>InnoDB</td><td>å…·å¤‡å¤–é”®æ”¯æŒåŠŸèƒ½çš„äº‹åŠ¡å¤„ç†å¼•æ“</td></tr><tr><td>MEMORY</td><td>ç½®äºå†…å­˜çš„è¡¨</td></tr><tr><td>MERGE</td><td>ç”¨æ¥ç®¡ç†ç”±å¤šä¸ª MyISAM è¡¨æ„æˆçš„è¡¨é›†åˆ</td></tr><tr><td>MyISAM</td><td>ä¸»è¦çš„éäº‹åŠ¡å¤„ç†å­˜å‚¨å¼•æ“</td></tr><tr><td>NDB</td><td>MySQL é›†ç¾¤ä¸“ç”¨å­˜å‚¨å¼•æ“</td></tr></tbody></table><p>MySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œä½ å¯ä»¥é€šè¿‡ show engines å‘½ä»¤æ¥æŸ¥çœ‹ MySQL æ”¯æŒçš„æ‰€æœ‰å­˜å‚¨å¼•æ“ã€‚</p><figure><img src="`+Vs+`" alt="image-20220717151007781" tabindex="0" loading="lazy"><figcaption>image-20220717151007781</figcaption></figure><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å‡ºï¼Œ MySQL å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBã€‚å¹¶ä¸”ï¼Œæ‰€æœ‰çš„å­˜å‚¨å¼•æ“ä¸­åªæœ‰ InnoDB æ˜¯äº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ InnoDB æ”¯æŒäº‹åŠ¡ã€‚</p><p>æˆ‘è¿™é‡Œä½¿ç”¨çš„ MySQL ç‰ˆæœ¬æ˜¯ 8.xï¼Œä¸åŒçš„ MySQL ç‰ˆæœ¬ä¹‹é—´å¯èƒ½ä¼šæœ‰å·®åˆ«ã€‚</p><p>MySQL 5.5.5 ä¹‹å‰ï¼ŒMyISAM æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚5.5.5 ç‰ˆæœ¬ä¹‹åï¼ŒInnoDB æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ <code>select version()</code> å‘½ä»¤æŸ¥çœ‹ä½ çš„ MySQL ç‰ˆæœ¬ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+-----------+
<span class="token operator">|</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span>
+-----------+
<span class="token operator">|</span> <span class="token number">8.0</span>.27    <span class="token operator">|</span>
+-----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>show variables like &#39;%storage_engine%&#39;</code> å‘½ä»¤ç›´æ¥æŸ¥çœ‹ MySQL å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚</p><figure><img src="`+Gs+'" alt="image-20220717151014970" tabindex="0" loading="lazy"><figcaption>image-20220717151014970</figcaption></figure><p>å¦‚æœä½ åªæƒ³æŸ¥çœ‹æ•°æ®åº“ä¸­æŸä¸ªè¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>show table status from db_name where name=&#39;table_name&#39;</code>å‘½ä»¤ã€‚</p><figure><img src="'+Xs+'" alt="image-20220717151021020" tabindex="0" loading="lazy"><figcaption>image-20220717151021020</figcaption></figure><p>å¦‚æœä½ æƒ³è¦æ·±å…¥äº†è§£æ¯ä¸ªå­˜å‚¨å¼•æ“ä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œæ¨èä½ å»é˜…è¯»ä»¥ä¸‹ MySQL å®˜æ–¹æ–‡æ¡£å¯¹åº”çš„ä»‹ç»(é¢è¯•ä¸ä¼šé—®è¿™ä¹ˆç»†ï¼Œäº†è§£å³å¯)ï¼š</p>',80),Qp={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},Vp={href:"https://dev.mysql.com/doc/refman/8.0/en/storage-engines.html",target:"_blank",rel:"noopener noreferrer"},Gp=t('<figure><img src="'+Ws+'" alt="image-20220717151028612" tabindex="0" loading="lazy"><figcaption>image-20220717151028612</figcaption></figure><h4 id="è¯´ä¸‹myisam-å’Œ-innodbçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#è¯´ä¸‹myisam-å’Œ-innodbçš„åŒºåˆ«" aria-hidden="true">#</a> è¯´ä¸‹myisam å’Œ innodbçš„åŒºåˆ«</h4><p>myisamå¼•æ“æ˜¯5.1ç‰ˆæœ¬ä¹‹å‰çš„é»˜è®¤å¼•æ“ï¼Œæ”¯æŒå…¨æ–‡æ£€ç´¢ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨äºæœ‰å¤§é‡æŸ¥è¯¢å°‘é‡æ’å…¥çš„åœºæ™¯æ¥ä½¿ç”¨ï¼Œè€Œä¸”myisamä¸æ”¯æŒå¤–é”®ï¼Œå¹¶ä¸”ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚</p><p>innodbæ˜¯åŸºäºB+Treeç´¢å¼•å»ºç«‹çš„ï¼Œå’Œmyisamç›¸åå®ƒæ”¯æŒäº‹åŠ¡ã€å¤–é”®ï¼Œå¹¶ä¸”é€šè¿‡MVCCæ¥æ”¯æŒé«˜å¹¶å‘ï¼Œç´¢å¼•å’Œæ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ã€‚</p><hr><p><strong>æ˜¯å¦æ”¯æŒè¡Œçº§é”</strong> MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”</p><p><strong>æ˜¯å¦æ”¯æŒäº‹åŠ¡</strong> MyISAM ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚InnoDB æä¾›äº‹åŠ¡æ”¯æŒ</p><p><strong>æ˜¯å¦æ”¯æŒå¤–é”®</strong> MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚</p><h4 id="mysqlæ¶æ„æ˜¯æ€æ ·çš„" tabindex="-1"><a class="header-anchor" href="#mysqlæ¶æ„æ˜¯æ€æ ·çš„" aria-hidden="true">#</a> mySQLæ¶æ„æ˜¯æ€æ ·çš„ï¼Ÿ</h4><p>æ•°æ®çš„åº“é«˜å¯ç”¨æ–¹æ¡ˆ</p><ul><li>åŒæœºä¸»å¤‡</li><li>ä¸€ä¸»ä¸€ä»</li><li>ä¸€ä¸»å¤šä»</li><li>MariaDBåŒæ­¥å¤šä¸»æœº</li><li>æ•°æ®åº“ä¸­é—´ä»¶</li></ul><p>åŒæœºä¸»å¤‡</p><hr><figure><img src="'+Ys+'" alt="image-20220613100825505" tabindex="0" loading="lazy"><figcaption>image-20220613100825505</figcaption></figure><ul><li>ä¼˜ç‚¹ï¼šä¸€ä¸ªæœºå™¨æ•…éšœäº†å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œæ“ä½œæ¯”è¾ƒç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šåªæœ‰ä¸€ä¸ªåº“åœ¨å·¥ä½œï¼Œè¯»å†™å‹åŠ›å¤§ï¼Œæœªèƒ½å®ç°è¯»å†™åˆ†ç¦»ï¼Œå¹¶å‘ä¹Ÿæœ‰ä¸€å®šé™åˆ¶</li></ul><p>ä¸€ä¸»ä¸€ä»</p><hr><figure><img src="'+Zs+'" alt="image-20220613100842261" tabindex="0" loading="lazy"><figcaption>image-20220613100842261</figcaption></figure><ul><li>ä¼˜ç‚¹ï¼šä»åº“æ”¯æŒè¯»ï¼Œåˆ†æ‹…äº†ä¸»åº“çš„å‹åŠ›ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚ä¸€ä¸ªæœºå™¨æ•…éšœäº†å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œæ“ä½œæ¯”è¾ƒç®€å•ã€‚</li><li>ç¼ºç‚¹ï¼šä¸€å°ä»åº“ï¼Œå¹¶å‘æ”¯æŒè¿˜æ˜¯ä¸å¤Ÿï¼Œå¹¶ä¸”ä¸€å…±ä¸¤å°æœºå™¨ï¼Œè¿˜æ˜¯å­˜åœ¨åŒæ—¶æ•…éšœçš„æœºç‡ï¼Œä¸å¤Ÿé«˜å¯ç”¨ã€‚</li></ul><p>ä¸€ä¸»å¤šä»</p><hr><figure><img src="'+$s+'" alt="image-20220613100912699" tabindex="0" loading="lazy"><figcaption>image-20220613100912699</figcaption></figure><ul><li>ä¼˜ç‚¹ï¼šå¤šä¸ªä»åº“æ”¯æŒè¯»ï¼Œåˆ†æ‹…äº†ä¸»åº“çš„å‹åŠ›ï¼Œæ˜æ˜¾æå‡äº†è¯»çš„å¹¶å‘åº¦ã€‚</li><li>ç¼ºç‚¹ï¼šåªæœ‰ä¸€å°ä¸»æœºå†™ï¼Œå› æ­¤å†™çš„å¹¶å‘åº¦ä¸é«˜</li></ul><p>æ•°æ®åº“ä¸­é—´ä»¶</p><hr><figure><img src="'+na+'" alt="image-20220613100927156" tabindex="0" loading="lazy"><figcaption>image-20220613100927156</figcaption></figure><ul><li>mycatåˆ†ç‰‡å­˜å‚¨ï¼Œæ¯ä¸ªåˆ†ç‰‡é…ç½®ä¸€ä¸»å¤šä»çš„é›†ç¾¤ã€‚</li><li>ä¼˜ç‚¹ï¼šè§£å†³é«˜å¹¶å‘é«˜æ•°æ®é‡çš„é«˜å¯ç”¨æ–¹æ¡ˆ</li><li>ç¼ºç‚¹ï¼šç»´æŠ¤æˆæœ¬æ¯”è¾ƒå¤§ã€‚</li></ul><h4 id="æ€ä¹ˆåŒæ­¥mysqlæ•°æ®åº“åˆ°es-æ»´æ»´" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆåŒæ­¥mysqlæ•°æ®åº“åˆ°es-æ»´æ»´" aria-hidden="true">#</a> æ€ä¹ˆåŒæ­¥mysqlæ•°æ®åº“åˆ°ESï¼Ÿï¼ˆæ»´æ»´ï¼‰</h4>',28),Xp={href:"https://developer.aliyun.com/article/761356",target:"_blank",rel:"noopener noreferrer"},Wp=t(`<ul><li>æ–¹æ¡ˆ1ï¼šé˜¿é‡Œäº‘æ•°æ®ä¼ è¾“DTS</li><li>æ–¹æ¡ˆ2ï¼šLogstashå°†MySQLæ•°æ®åŒæ­¥åˆ°ElasticSearch</li><li>æ–¹æ¡ˆ3ï¼šä½¿ç”¨é˜¿é‡Œäº‘å¼€æºå·¥å…·Canal</li></ul><h4 id="mysqlçš„é”-è¡Œé”-é—´éš™é”-ä¸´é”®é”-å…±äº«é”-æ’ä»–é”ç­‰" tabindex="-1"><a class="header-anchor" href="#mysqlçš„é”-è¡Œé”-é—´éš™é”-ä¸´é”®é”-å…±äº«é”-æ’ä»–é”ç­‰" aria-hidden="true">#</a> Mysqlçš„é”ï¼ˆè¡Œé”ï¼Œé—´éš™é”ï¼Œä¸´é”®é”ï¼Œå…±äº«é”/æ’ä»–é”ç­‰ï¼‰</h4><p>å…±äº«é”(ç®€ç§°Sé”)å’Œæ’ä»–é”(ç®€ç§°Xé”)</p><ul><li><strong>è¯»é”</strong>æ˜¯å…±äº«çš„ï¼Œå¯ä»¥é€šè¿‡lock in share modeå®ç°ï¼Œè¿™æ—¶å€™åªèƒ½è¯»ä¸èƒ½å†™ã€‚</li><li><strong>å†™é”</strong>æ˜¯æ’ä»–çš„ï¼Œå®ƒä¼šé˜»å¡å…¶ä»–çš„å†™é”å’Œè¯»é”ã€‚ä»é¢—ç²’åº¦æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸ºè¡¨é”å’Œè¡Œé”ä¸¤ç§ã€‚</li></ul><p>è¡¨é”å’Œè¡Œé”</p><ul><li><p><strong>è¡¨é”</strong>ä¼šé”å®šæ•´å¼ è¡¨å¹¶ä¸”é˜»å¡å…¶ä»–ç”¨æˆ·å¯¹è¯¥è¡¨çš„æ‰€æœ‰è¯»å†™æ“ä½œï¼Œæ¯”å¦‚alterä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™ä¼šé”è¡¨ã€‚</p></li><li><p>è¡Œé”</p><p>åˆå¯ä»¥åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é”</p><ul><li>æ‚²è§‚é”å¯ä»¥é€šè¿‡for updateå®ç°</li><li>ä¹è§‚é”åˆ™é€šè¿‡ç‰ˆæœ¬å·å®ç°ã€‚</li></ul></li></ul><h4 id="èŠèŠç´¢å¼•åœ¨å“ªäº›åœºæ™¯ä¸‹ä¼šå¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#èŠèŠç´¢å¼•åœ¨å“ªäº›åœºæ™¯ä¸‹ä¼šå¤±æ•ˆ" aria-hidden="true">#</a> èŠèŠç´¢å¼•åœ¨å“ªäº›åœºæ™¯ä¸‹ä¼šå¤±æ•ˆï¼Ÿ</h4><ul><li>æŸ¥è¯¢æ¡ä»¶åŒ…å«orï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li><li>å¦‚ä½•å­—æ®µç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œwhereæ—¶ä¸€å®šç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ</li><li>likeé€šé…ç¬¦å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>è”åˆç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶çš„æ¡ä»¶åˆ—ä¸æ˜¯è”åˆç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œç´¢å¼•å¤±æ•ˆã€‚</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨mysqlçš„å†…ç½®å‡½æ•°ï¼Œç´¢å¼•å¤±æ•ˆã€‚</li><li>å¯¹ç´¢å¼•åˆ—è¿ç®—ï¼ˆå¦‚ï¼Œ+ã€-ã€*ã€/ï¼‰ï¼Œç´¢å¼•å¤±æ•ˆã€‚</li><li>ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨ï¼ˆï¼= æˆ–è€… &lt; &gt;ï¼Œnot inï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨is nullï¼Œ is not nullï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>å·¦è¿æ¥æŸ¥è¯¢æˆ–è€…å³è¿æ¥æŸ¥è¯¢æŸ¥è¯¢å…³è”çš„å­—æ®µç¼–ç æ ¼å¼ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>mysqlä¼°è®¡ä½¿ç”¨å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•å¿«,åˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><h4 id="mysqlæ€ä¹ˆè§£å†³æ­»é”çš„-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#mysqlæ€ä¹ˆè§£å†³æ­»é”çš„-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> MySQLæ€ä¹ˆè§£å†³æ­»é”çš„ï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h4><h5 id="ä¸ºä»€ä¹ˆä¼šå½¢æˆæ­»é”" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¼šå½¢æˆæ­»é”" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆä¼šå½¢æˆæ­»é”ï¼Ÿ</h5><p>çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿè®¸ä½ ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œäº‹åŠ¡å’Œè°ˆåˆ¤ä¸ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆäº‹åŠ¡ä¸èƒ½ä½¿ç”¨å®Œé”ä¹‹åç«‹é©¬é‡Šæ”¾å‘¢ï¼Ÿå±…ç„¶è¿˜è¦æ“ä½œå®Œäº†ä¹‹åä¸€ç›´æŒæœ‰é”ï¼Ÿè¿™å°±æ¶‰åŠåˆ° MySQL çš„å¹¶å‘æ§åˆ¶äº†ã€‚</p><p>MySQLçš„å¹¶å‘æ§åˆ¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯ MVCCï¼Œä¸€ä¸ªæ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å¹¶å‘æ§åˆ¶å‘¢ï¼Ÿæ˜¯å› ä¸ºå¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œ MySQL çš„æ—¶å€™ï¼Œä¸ºäº†æé«˜å¹¶å‘æ€§èƒ½å¹¶ä¸”è¦æ±‚å¦‚åŒå¤šä¸ªç”¨æˆ·çš„è¯·æ±‚è¿‡æ¥ä¹‹åå¦‚åŒä¸²è¡Œæ‰§è¡Œçš„ä¸€æ ·ï¼ˆ<code>å¯ä¸²è¡ŒåŒ–è°ƒåº¦</code>ï¼‰ã€‚å…·ä½“çš„å¹¶å‘æ§åˆ¶è¿™é‡Œä¸å†å±•å¼€ã€‚å’±ä»¬ç»§ç»­æ·±å…¥è®¨è®ºä¸¤é˜¶æ®µé”åè®®ã€‚</p><p>ä¸¤é˜¶æ®µé”åè®®ï¼ˆ2PLï¼‰</p><p>å®˜æ–¹å®šä¹‰ï¼š</p><blockquote><p>ä¸¤é˜¶æ®µé”åè®®æ˜¯æŒ‡æ‰€æœ‰äº‹åŠ¡å¿…é¡»åˆ†ä¸¤ä¸ªé˜¶æ®µå¯¹æ•°æ®åŠ é”å’Œè§£é”ï¼Œåœ¨å¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»ã€å†™æ“ä½œä¹‹å‰ï¼Œäº‹åŠ¡é¦–å…ˆè¦è·å¾—å¯¹è¯¥æ•°æ®çš„å°é”ï¼›åœ¨é‡Šæ”¾ä¸€ä¸ªå°é”ä¹‹åï¼Œäº‹åŠ¡ä¸å†ç”³è¯·å’Œè·å¾—ä»»ä½•å…¶ä»–å°é”ã€‚</p></blockquote><p>å¯¹åº”åˆ° MySQL ä¸Šåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li>æ‰©å±•é˜¶æ®µï¼ˆäº‹åŠ¡å¼€å§‹åï¼Œcommit ä¹‹å‰ï¼‰ï¼šè·å–é”</li><li>æ”¶ç¼©é˜¶æ®µï¼ˆcommit ä¹‹åï¼‰ï¼šé‡Šæ”¾é”</li></ol><p>å°±æ˜¯è¯´å‘¢ï¼Œåªæœ‰éµå¾ªä¸¤æ®µé”åè®®ï¼Œæ‰èƒ½å®ç° <code>å¯ä¸²è¡ŒåŒ–è°ƒåº¦</code>ã€‚</p><p>ä½†æ˜¯ä¸¤é˜¶æ®µé”åè®®ä¸è¦æ±‚äº‹åŠ¡å¿…é¡»ä¸€æ¬¡å°†æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ•°æ®åŠ é”ï¼Œå¹¶ä¸”åœ¨åŠ é”é˜¶æ®µæ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œæ‰€ä»¥è¿™ç§å¹¶å‘æ§åˆ¶æ–¹å¼ä¼šå½¢æˆæ­»é”ã€‚</p><h5 id="mysql-å¦‚ä½•å¤„ç†æ­»é”" tabindex="-1"><a class="header-anchor" href="#mysql-å¦‚ä½•å¤„ç†æ­»é”" aria-hidden="true">#</a> MySQL å¦‚ä½•å¤„ç†æ­»é”ï¼Ÿ</h5><p>MySQLæœ‰ä¸¤ç§æ­»é”å¤„ç†æ–¹å¼ï¼š</p><pre><code>ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆinnodb_lock_wait_timeout=50sï¼‰ã€‚
å‘èµ·æ­»é”æ£€æµ‹ï¼Œä¸»åŠ¨å›æ»šä¸€æ¡äº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼ˆinnodb_deadlock_detect=onï¼‰ã€‚
</code></pre><p>ç”±äºæ€§èƒ½åŸå› ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨æ­»é”æ£€æµ‹æ¥è¿›è¡Œå¤„ç†æ­»é”ã€‚</p><h6 id="æ­»é”æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#æ­»é”æ£€æµ‹" aria-hidden="true">#</a> æ­»é”æ£€æµ‹</h6><p>æ­»é”æ£€æµ‹çš„åŸç†æ˜¯æ„å»ºä¸€ä¸ªä»¥äº‹åŠ¡ä¸ºé¡¶ç‚¹ã€é”ä¸ºè¾¹çš„æœ‰å‘å›¾ï¼Œåˆ¤æ–­æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼Œå­˜åœ¨å³æœ‰æ­»é”ã€‚</p><h6 id="å›æ»š" tabindex="-1"><a class="header-anchor" href="#å›æ»š" aria-hidden="true">#</a> å›æ»š</h6><p>æ£€æµ‹åˆ°æ­»é”ä¹‹åï¼Œé€‰æ‹©æ’å…¥æ›´æ–°æˆ–è€…åˆ é™¤çš„è¡Œæ•°æœ€å°‘çš„äº‹åŠ¡å›æ»šï¼ŒåŸºäº INFORMATION_SCHEMA.INNODB_TRX è¡¨ä¸­çš„ trx_weight å­—æ®µæ¥åˆ¤æ–­ã€‚</p><h4 id="è”åˆç´¢å¼•ä¸­é—´å¯ä»¥æœ‰nullå€¼å—-ä¸ºä»€ä¹ˆ-æµ‹è¯•è¿‡å—-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#è”åˆç´¢å¼•ä¸­é—´å¯ä»¥æœ‰nullå€¼å—-ä¸ºä»€ä¹ˆ-æµ‹è¯•è¿‡å—-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> è”åˆç´¢å¼•ä¸­é—´å¯ä»¥æœ‰nullå€¼å—ï¼Œä¸ºä»€ä¹ˆï¼Œæµ‹è¯•è¿‡å—ï¼Ÿï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h4><p>Mysqlå®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™æ ·çš„è§£é‡Š</p><blockquote><p>A UNIQUE index creates a constraint such that all values in the index must be distinct. An error occurs if you try to add a new row with a key value that matches an existing row. This constraint does not apply to NULL values except for the BDB storage engine. For other engines, a UNIQUE index allows multiple NULL values for columns that can contain NULL.</p></blockquote><p>å”¯ä¸€çº¦æŸå¯¹NULLå€¼ä¸é€‚ç”¨ã€‚åŸå› å¯ä»¥è¿™æ ·è§£é‡Šï¼š æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå•åˆ—çš„å”¯ä¸€ç´¢å¼•ï¼Œæ—¢ç„¶å®é™…ä¼šæœ‰ç©ºç½®çš„æƒ…å†µï¼Œé‚£ä¹ˆè¿™åˆ—ä¸€å®šä¸æ˜¯NOT NULLçš„ï¼Œå¦‚æœå”¯ä¸€çº¦æŸå¯¹ç©ºå€¼ä¹Ÿæœ‰èµ·ä½œç”¨ï¼Œå°±ä¼šå¯¼è‡´ä»…æœ‰ä¸€è¡Œæ•°æ®å¯ä»¥ä¸ºç©ºï¼Œè¿™å¯èƒ½ä¼šå’Œå®é™…çš„ä¸šåŠ¡éœ€æ±‚æƒ³å†²çªçš„ï¼Œæ‰€ä»¥é€šå¸¸Mysqlçš„å­˜å‚¨å¼•æ“çš„å”¯ä¸€ç´¢å¼•å¯¹NULLå€¼æ˜¯ä¸é€‚ç”¨çš„ã€‚ è¿™ä¹Ÿå°±å€’æ˜¯è”åˆå”¯ä¸€ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œåªè¦æŸä¸€åˆ—ä¸ºç©ºï¼Œå°±ä¸ä¼šæŠ¥å”¯ä¸€ç´¢å¼•å†²çªã€‚</p><blockquote><p>è§£å†³æ–¹æ¡ˆï¼šç»™ä¼šä¸ºç©ºçš„åˆ—å®šä¹‰ä¸€ä¸ªä¸ºç©ºçš„ç‰¹æ®Šå€¼æ¥è¡¨ç¤ºNULLï¼Œæ¯”å¦‚æ•°å­—ç±»å‹ä½¿ç”¨0å€¼ï¼Œå­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ã€‚</p></blockquote><h4 id="æœ‰æ²¡æœ‰åšè¿‡sqlä¼˜åŒ–å—-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#æœ‰æ²¡æœ‰åšè¿‡sqlä¼˜åŒ–å—-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> æœ‰æ²¡æœ‰åšè¿‡SQLä¼˜åŒ–å—ï¼Ÿ ï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h4>`,33),Yp={href:"https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html#_12-%E7%A6%81%E6%AD%A2%E4%BD%BF%E7%94%A8-order-by-rand-%E8%BF%9B%E8%A1%8C%E9%9A%8F%E6%9C%BA%E6%8E%92%E5%BA%8F",target:"_blank",rel:"noopener noreferrer"},Zp=t('<h4 id="è”åˆç´¢å¼•-æœ€å·¦åŒ¹é…åŸåˆ™-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#è”åˆç´¢å¼•-æœ€å·¦åŒ¹é…åŸåˆ™-2022è”šæ¥" aria-hidden="true">#</a> è”åˆç´¢å¼•ï¼Œæœ€å·¦åŒ¹é…åŸåˆ™ï¼ˆ2022è”šæ¥ï¼‰</h4><p>å¯¹ä¸»é”®å­—æ®µå»ºç«‹çš„ç´¢å¼•å«åšèšç°‡ç´¢å¼•ï¼Œå¯¹æ™®é€šå­—æ®µå»ºç«‹çš„ç´¢å¼•å«åšäºŒçº§ç´¢å¼•ã€‚</p><p>é‚£ä¹ˆ<strong>å¤šä¸ªæ™®é€šå­—æ®µç»„åˆåœ¨ä¸€èµ·åˆ›å»ºçš„ç´¢å¼•å°±å«åšè”åˆç´¢å¼•</strong>ï¼Œä¹Ÿå«ç»„åˆç´¢å¼•ã€‚</p><p>åˆ›å»ºè”åˆç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„åˆ›å»ºæ—¶çš„é¡ºåºé—®é¢˜ï¼Œå› ä¸ºè”åˆç´¢å¼• (a, b, c) å’Œ (c, b, a) åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šå­˜åœ¨å·®åˆ«ã€‚</p><p>è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ª<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ã€‚</p><p>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œ<strong>MySQL</strong> ä¼šæ ¹æ®è”åˆç´¢å¼•ä¸­çš„å­—æ®µé¡ºåºï¼Œä»å·¦åˆ°å³ä¾æ¬¡åˆ°æŸ¥è¯¢æ¡ä»¶ä¸­å»åŒ¹é…ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­å­˜åœ¨ä¸è”åˆç´¢å¼•ä¸­æœ€å·¦ä¾§å­—æ®µç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™å°±ä¼šä½¿ç”¨è¯¥å­—æ®µè¿‡æ»¤ä¸€æ‰¹æ•°æ®ï¼Œç›´è‡³è”åˆç´¢å¼•ä¸­å…¨éƒ¨å­—æ®µåŒ¹é…å®Œæˆï¼Œæˆ–è€…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼Œå¦‚ <strong><code>&gt;</code></strong>ã€<strong><code>&lt;</code></strong>ã€<strong><code>between</code></strong> å’Œ <strong><code>ä»¥%å¼€å¤´çš„likeæŸ¥è¯¢</code></strong> ç­‰æ¡ä»¶ï¼Œæ‰ä¼šåœæ­¢åŒ¹é…ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¯ä»¥å°†åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨æœ€å·¦è¾¹ï¼Œè¿™ä¹Ÿå¯ä»¥è¿‡æ»¤æ›´å¤šæ•°æ®ã€‚</p><h2 id="ğŸ¦¸â€â™€ï¸ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#ğŸ¦¸â€â™€ï¸ä¸­é—´ä»¶" aria-hidden="true">#</a> ğŸ¦¸â€â™€ï¸ä¸­é—´ä»¶</h2><h3 id="æ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> æ¶ˆæ¯é˜Ÿåˆ—</h3><h4 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—</h4><p>æˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯é˜Ÿåˆ—çœ‹ä½œæ˜¯ä¸€ä¸ªå­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¶ˆæ¯çš„æ—¶å€™ï¼Œç›´æ¥ä»å®¹å™¨ä¸­å–å‡ºæ¶ˆæ¯ä¾›è‡ªå·±ä½¿ç”¨å³å¯ã€‚</p><figure><img src="'+sa+'" alt="image-20220405202743331" tabindex="0" loading="lazy"><figcaption>image-20220405202743331</figcaption></figure><p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½å’Œå‰Šå³°ã€é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚</p><p>æˆ‘ä»¬çŸ¥é“é˜Ÿåˆ— Queue æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ¶ˆè´¹æ¶ˆæ¯æ—¶ä¹Ÿæ˜¯æŒ‰ç…§é¡ºåºæ¥æ¶ˆè´¹çš„ã€‚</p><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h4><p>é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½ä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿå¸¦æ¥ä¸‹é¢ä¸‰ç‚¹å¥½å¤„ï¼š</p><ol><li><strong>é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰ã€‚</strong></li><li><strong>å‰Šå³°/é™æµ</strong></li><li><strong>é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚</strong></li></ol><p>å¦‚æœåœ¨é¢è¯•çš„æ—¶å€™ä½ è¢«é¢è¯•å®˜é—®åˆ°è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯ä½ åœ¨ä½ çš„ç®€å†ä¸Šæ¶‰åŠåˆ°æ¶ˆæ¯é˜Ÿåˆ—è¿™æ–¹é¢çš„å†…å®¹ï¼Œè¿™ä¸ªæ—¶å€™æ¨èä½ ç»“åˆä½ è‡ªå·±çš„é¡¹ç›®æ¥å›ç­”ã€‚</p><p>é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰</p><figure><img src="'+aa+'" alt="image-20220405202828582" tabindex="0" loading="lazy"><figcaption>image-20220405202828582</figcaption></figure><p>å°†ç”¨æˆ·çš„è¯·æ±‚æ•°æ®å­˜å‚¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åå°±ç«‹å³è¿”å›ç»“æœã€‚éšåï¼Œç³»ç»Ÿå†å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚</p><p>å› ä¸ºç”¨æˆ·è¯·æ±‚æ•°æ®å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åå°±ç«‹å³è¿”å›ç»™ç”¨æˆ·äº†ï¼Œä½†æ˜¯è¯·æ±‚æ•°æ®åœ¨åç»­çš„ä¸šåŠ¡æ ¡éªŒã€å†™æ•°æ®åº“ç­‰æ“ä½œä¸­å¯èƒ½å¤±è´¥ã€‚å› æ­¤ï¼Œ<strong>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥å¤„ç†ä¹‹åï¼Œéœ€è¦é€‚å½“ä¿®æ”¹ä¸šåŠ¡æµç¨‹è¿›è¡Œé…åˆ</strong>ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æäº¤è®¢å•ä¹‹åï¼Œè®¢å•æ•°æ®å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸èƒ½ç«‹å³è¿”å›ç”¨æˆ·è®¢å•æäº¤æˆåŠŸï¼Œéœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„è®¢å•æ¶ˆè´¹è€…è¿›ç¨‹çœŸæ­£å¤„ç†å®Œè¯¥è®¢å•ä¹‹åï¼Œç”šè‡³å‡ºåº“åï¼Œå†é€šè¿‡ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·è®¢å•æˆåŠŸï¼Œä»¥å…äº¤æ˜“çº çº·ã€‚è¿™å°±ç±»ä¼¼æˆ‘ä»¬å¹³æ—¶æ‰‹æœºè®¢ç«è½¦ç¥¨å’Œç”µå½±ç¥¨</p><p>å‰Šå³°/é™æµ</p><p><strong>å…ˆå°†çŸ­æ—¶é—´é«˜å¹¶å‘äº§ç”Ÿçš„äº‹åŠ¡æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶ååç«¯æœåŠ¡å†æ…¢æ…¢æ ¹æ®è‡ªå·±çš„èƒ½åŠ›å»æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œè¿™æ ·å°±é¿å…ç›´æ¥æŠŠåç«¯æœåŠ¡æ‰“å®æ‰ã€‚</strong></p><p>ä¸¾ä¾‹ï¼šåœ¨ç”µå­å•†åŠ¡ä¸€äº›ç§’æ€ã€ä¿ƒé”€æ´»åŠ¨ä¸­ï¼Œåˆç†ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥æœ‰æ•ˆæŠµå¾¡ä¿ƒé”€æ´»åŠ¨åˆšå¼€å§‹å¤§é‡è®¢å•æ¶Œå…¥å¯¹ç³»ç»Ÿçš„å†²å‡»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="'+ea+'" alt="image-20220405202846995" tabindex="0" loading="lazy"><figcaption>image-20220405202846995</figcaption></figure><p>é™ä½ç³»ç»Ÿè€¦åˆæ€§</p><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿˜å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚æˆ‘ä»¬çŸ¥é“å¦‚æœæ¨¡å—ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ–°å¢æ¨¡å—æˆ–è€…ä¿®æ”¹æ¨¡å—å°±å¯¹å…¶ä»–æ¨¡å—å½±å“è¾ƒå°ï¼Œè¿™æ ·ç³»ç»Ÿçš„å¯æ‰©å±•æ€§æ— ç–‘æ›´å¥½ä¸€äº›ã€‚è¿˜æ˜¯ç›´æ¥ä¸Šå›¾å§ï¼š</p><figure><img src="'+ta+'" alt="image-20220405202857835" tabindex="0" loading="lazy"><figcaption>image-20220405202857835</figcaption></figure><p>ç”Ÿäº§è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»ï¼Œæ¥å—è€…ï¼ˆæœåŠ¡ç«¯ï¼‰å¤„ç†æ¶ˆæ¯ï¼Œéœ€è¦æ¶ˆè´¹çš„ç³»ç»Ÿç›´æ¥å»æ¶ˆæ¯é˜Ÿåˆ—å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å³å¯è€Œä¸éœ€è¦å’Œå…¶ä»–ç³»ç»Ÿæœ‰è€¦åˆï¼Œè¿™æ˜¾ç„¶ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚</p><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼å·¥ä½œï¼Œæ¶ˆæ¯å‘é€è€…ï¼ˆç”Ÿäº§è€…ï¼‰å‘å¸ƒæ¶ˆæ¯ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯æ¥å—è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰è®¢é˜…æ¶ˆæ¯ã€‚</strong> ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°<strong>æ¶ˆæ¯å‘é€è€…ï¼ˆç”Ÿäº§è€…ï¼‰å’Œæ¶ˆæ¯æ¥å—è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ä¹‹é—´æ²¡æœ‰ç›´æ¥è€¦åˆ</strong>ï¼Œæ¶ˆæ¯å‘é€è€…å°†æ¶ˆæ¯å‘é€è‡³åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å³ç»“æŸå¯¹æ¶ˆæ¯çš„å¤„ç†ï¼Œæ¶ˆæ¯æ¥å—è€…ä»åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—è·å–è¯¥æ¶ˆæ¯åè¿›è¡Œåç»­å¤„ç†ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¯¥æ¶ˆæ¯ä»ä½•è€Œæ¥ã€‚<strong>å¯¹æ–°å¢ä¸šåŠ¡ï¼Œåªè¦å¯¹è¯¥ç±»æ¶ˆæ¯æ„Ÿå…´è¶£ï¼Œå³å¯è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œå¯¹åŸæœ‰ç³»ç»Ÿå’Œä¸šåŠ¡æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä»è€Œå®ç°ç½‘ç«™ä¸šåŠ¡çš„å¯æ‰©å±•æ€§è®¾è®¡</strong>ã€‚</p><p>æ¶ˆæ¯æ¥å—è€…å¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€å¤„ç†ã€åŒ…è£…åï¼Œæ„é€ æˆä¸€ä¸ªæ–°çš„æ¶ˆæ¯ç±»å‹ï¼Œå°†æ¶ˆæ¯ç»§ç»­å‘é€å‡ºå»ï¼Œç­‰å¾…å…¶ä»–æ¶ˆæ¯æ¥å—è€…è®¢é˜…è¯¥æ¶ˆæ¯ã€‚å› æ­¤åŸºäºäº‹ä»¶ï¼ˆæ¶ˆæ¯å¯¹è±¡ï¼‰é©±åŠ¨çš„ä¸šåŠ¡æ¶æ„å¯ä»¥æ˜¯ä¸€ç³»åˆ—æµç¨‹ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†é¿å…æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®•æœºé€ æˆæ¶ˆæ¯ä¸¢å¤±ï¼Œä¼šå°†æˆåŠŸå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯ç”Ÿäº§è€…æœåŠ¡å™¨ä¸Šï¼Œç­‰æ¶ˆæ¯çœŸæ­£è¢«æ¶ˆè´¹è€…æœåŠ¡å™¨å¤„ç†åæ‰åˆ é™¤æ¶ˆæ¯ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®•æœºåï¼Œç”Ÿäº§è€…æœåŠ¡å™¨ä¼šé€‰æ‹©åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨å‘å¸ƒæ¶ˆæ¯ã€‚</p><p><strong>å¤‡æ³¨ï¼š</strong> ä¸è¦è®¤ä¸ºæ¶ˆæ¯é˜Ÿåˆ—åªèƒ½åˆ©ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼å·¥ä½œï¼Œåªä¸è¿‡åœ¨è§£è€¦è¿™ä¸ªç‰¹å®šä¸šåŠ¡ç¯å¢ƒä¸‹æ˜¯ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„ã€‚é™¤äº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œè¿˜æœ‰ç‚¹å¯¹ç‚¹è®¢é˜…æ¨¡å¼ï¼ˆä¸€ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚å¦å¤–ï¼Œè¿™ä¸¤ç§æ¶ˆæ¯æ¨¡å‹æ˜¯ JMS æä¾›çš„ï¼ŒAMQP åè®®è¿˜æä¾›äº† 5 ç§æ¶ˆæ¯æ¨¡å‹ã€‚</p><h4 id="rabbitmq-è®²è®²å¯¹-rabbitmq-çš„äº†è§£" tabindex="-1"><a class="header-anchor" href="#rabbitmq-è®²è®²å¯¹-rabbitmq-çš„äº†è§£" aria-hidden="true">#</a> RabbitMQ è®²è®²å¯¹ RabbitMQ çš„äº†è§£</h4><p>RabbitMQ æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸»è¦è´Ÿè´£æ¥æ”¶ã€å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ã€‚å¯ä»¥æŠŠæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹æƒ³è±¡æˆï¼šå½“ä½ å°†ä¸€ä¸ªåŒ…è£¹é€åˆ°é‚®å±€ï¼Œé‚®å±€ä¼šæš‚å­˜å¹¶æœ€ç»ˆå°†é‚®ä»¶é€šè¿‡é‚®é€’å‘˜é€åˆ°æ”¶ä»¶äººçš„æ‰‹ä¸Šï¼ŒRabbitMQ å°±å¥½æ¯”ç”±é‚®å±€ã€é‚®ç®±å’Œé‚®é€’å‘˜ç»„æˆçš„ä¸€ä¸ªç³»ç»Ÿã€‚ä»è®¡ç®—æœºæœ¯è¯­å±‚é¢æ¥è¯´ï¼ŒRabbitMQ æ¨¡å‹æ›´åƒæ˜¯ä¸€ç§äº¤æ¢æœºæ¨¡å‹ã€‚</p><p>RabbitMQ çš„æ•´ä½“æ¨¡å‹æ¶æ„ï¼š</p><figure><img src="'+pa+'" alt="image-20220405202647832" tabindex="0" loading="lazy"><figcaption>image-20220405202647832</figcaption></figure><h4 id="rabbitmq-çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—æ˜¯æ€æ ·ä¸€ä¸ªè”ç³»" tabindex="-1"><a class="header-anchor" href="#rabbitmq-çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—æ˜¯æ€æ ·ä¸€ä¸ªè”ç³»" aria-hidden="true">#</a> RabbitMQ çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—æ˜¯æ€æ ·ä¸€ä¸ªè”ç³»</h4><p>åœ¨ RabbitMQ ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸æ˜¯ç›´æ¥è¢«æŠ•é€’åˆ° <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> ä¸­çš„ï¼Œä¸­é—´è¿˜å¿…é¡»ç»è¿‡ <strong>Exchange(äº¤æ¢å™¨)</strong> è¿™ä¸€å±‚ï¼Œ<strong>Exchange(äº¤æ¢å™¨)</strong> ä¼šæŠŠæˆ‘ä»¬çš„æ¶ˆæ¯åˆ†é…åˆ°å¯¹åº”çš„ <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> ä¸­ã€‚</p><p><strong>Exchange(äº¤æ¢å™¨)</strong> ç”¨æ¥æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¹¶å°†è¿™äº›æ¶ˆæ¯è·¯ç”±ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè·¯ç”±ä¸åˆ°ï¼Œæˆ–è®¸ä¼šè¿”å›ç»™ <strong>Producer(ç”Ÿäº§è€…)</strong> ï¼Œæˆ–è®¸ä¼šè¢«ç›´æ¥ä¸¢å¼ƒæ‰ ã€‚è¿™é‡Œå¯ä»¥å°† RabbitMQ ä¸­çš„äº¤æ¢å™¨çœ‹ä½œä¸€ä¸ªç®€å•çš„å®ä½“ã€‚</p><p><strong>RabbitMQ çš„ Exchange(äº¤æ¢å™¨) æœ‰ 4 ç§ç±»å‹ï¼Œä¸åŒçš„ç±»å‹å¯¹åº”ç€ä¸åŒçš„è·¯ç”±ç­–ç•¥</strong>ï¼š<strong>direct(é»˜è®¤)</strong>ï¼Œ<strong>fanout</strong>, <strong>topic</strong>, å’Œ <strong>headers</strong>ï¼Œä¸åŒç±»å‹çš„ Exchange è½¬å‘æ¶ˆæ¯çš„ç­–ç•¥æœ‰æ‰€åŒºåˆ«ã€‚è¿™ä¸ªä¼šåœ¨ä»‹ç» <strong>Exchange Types(äº¤æ¢å™¨ç±»å‹)</strong> çš„æ—¶å€™ä»‹ç»åˆ°ã€‚</p><p>Exchange(äº¤æ¢å™¨) ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+oa+'" alt="image-20220405202602054" tabindex="0" loading="lazy"><figcaption>image-20220405202602054</figcaption></figure><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢å™¨çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ª <strong>RoutingKey(è·¯ç”±é”®)</strong>ï¼Œç”¨æ¥æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œè€Œè¿™ä¸ª <strong>RoutingKey éœ€è¦ä¸äº¤æ¢å™¨ç±»å‹å’Œç»‘å®šé”®(BindingKey)è”åˆä½¿ç”¨æ‰èƒ½æœ€ç»ˆç”Ÿæ•ˆ</strong>ã€‚</p><p>RabbitMQ ä¸­é€šè¿‡ <strong>Binding(ç»‘å®š)</strong> å°† <strong>Exchange(äº¤æ¢å™¨)</strong> ä¸ <strong>Queue(æ¶ˆæ¯é˜Ÿåˆ—)</strong> å…³è”èµ·æ¥ï¼Œåœ¨ç»‘å®šçš„æ—¶å€™ä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ª <strong>BindingKey(ç»‘å®šå»º)</strong> ,è¿™æ · RabbitMQ å°±çŸ¥é“å¦‚ä½•æ­£ç¡®å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—äº†,å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä¸€ä¸ªç»‘å®šå°±æ˜¯åŸºäºè·¯ç”±é”®å°†äº¤æ¢å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥èµ·æ¥çš„è·¯ç”±è§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥å°†äº¤æ¢å™¨ç†è§£æˆä¸€ä¸ªç”±ç»‘å®šæ„æˆçš„è·¯ç”±è¡¨ã€‚Exchange å’Œ Queue çš„ç»‘å®šå¯ä»¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p><p>Binding(ç»‘å®š) ç¤ºæ„å›¾ï¼š</p><figure><img src="'+ia+'" alt="image-20220405202610223" tabindex="0" loading="lazy"><figcaption>image-20220405202610223</figcaption></figure><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨æ—¶ï¼Œéœ€è¦ä¸€ä¸ª RoutingKey,å½“ BindingKey å’Œ RoutingKey ç›¸åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚åœ¨ç»‘å®šå¤šä¸ªé˜Ÿåˆ—åˆ°åŒä¸€ä¸ªäº¤æ¢å™¨çš„æ—¶å€™ï¼Œè¿™äº›ç»‘å®šå…è®¸ä½¿ç”¨ç›¸åŒçš„ BindingKeyã€‚BindingKey å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹éƒ½ç”Ÿæ•ˆï¼Œå®ƒä¾èµ–äºäº¤æ¢å™¨ç±»å‹ï¼Œæ¯”å¦‚ fanout ç±»å‹çš„äº¤æ¢å™¨å°±ä¼šæ— è§†ï¼Œè€Œæ˜¯å°†æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢å™¨çš„é˜Ÿåˆ—ä¸­ã€‚</p><h4 id="ä¿è¯kafkaæ¶ˆæ¯é¡ºåºæ€§" tabindex="-1"><a class="header-anchor" href="#ä¿è¯kafkaæ¶ˆæ¯é¡ºåºæ€§" aria-hidden="true">#</a> ä¿è¯kafkaæ¶ˆæ¯é¡ºåºæ€§</h4><p>æˆ‘ä»¬åœ¨ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ç»å¸¸æœ‰ä¸šåŠ¡åœºæ™¯éœ€è¦ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºï¼Œæ¯”å¦‚æˆ‘ä»¬åŒæ—¶å‘äº† 2 ä¸ªæ¶ˆæ¯ï¼Œè¿™ 2 ä¸ªæ¶ˆæ¯å¯¹åº”çš„æ“ä½œåˆ†åˆ«å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ˜¯ï¼š</p><ol><li>æ›´æ”¹ç”¨æˆ·ä¼šå‘˜ç­‰çº§ã€‚</li><li>æ ¹æ®ä¼šå‘˜ç­‰çº§è®¡ç®—è®¢å•ä»·æ ¼ã€‚</li></ol><p>å‡å¦‚è¿™ä¸¤æ¡æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºä¸ä¸€æ ·é€ æˆçš„æœ€ç»ˆç»“æœå°±ä¼šæˆªç„¶ä¸åŒã€‚</p><p>æˆ‘ä»¬çŸ¥é“ Kafka ä¸­ Partition(åˆ†åŒº)æ˜¯çœŸæ­£ä¿å­˜æ¶ˆæ¯çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å‘é€çš„æ¶ˆæ¯éƒ½è¢«æ”¾åœ¨äº†è¿™é‡Œã€‚è€Œæˆ‘ä»¬çš„ Partition(åˆ†åŒº) åˆå­˜åœ¨äº Topic(ä¸»é¢˜) è¿™ä¸ªæ¦‚å¿µä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç»™ç‰¹å®š Topic æŒ‡å®šå¤šä¸ª Partitionã€‚</p><figure><img src="'+ca+'" alt="image-20220717151708558" tabindex="0" loading="lazy"><figcaption>image-20220717151708558</figcaption></figure><p>æ¯æ¬¡æ·»åŠ æ¶ˆæ¯åˆ° Partition(åˆ†åŒº) çš„æ—¶å€™éƒ½ä¼šé‡‡ç”¨å°¾åŠ æ³•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ <strong>Kafka åªèƒ½ä¸ºæˆ‘ä»¬ä¿è¯ Partition(åˆ†åŒº) ä¸­çš„æ¶ˆæ¯æœ‰åºã€‚</strong></p><blockquote><p>æ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ° Partition(åˆ†åŒº)çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚Kafka é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰æ¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ã€‚</p></blockquote><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±æœ‰ä¸€ç§å¾ˆç®€å•çš„ä¿è¯æ¶ˆæ¯æ¶ˆè´¹é¡ºåºçš„æ–¹æ³•ï¼š<strong>1 ä¸ª Topic åªå¯¹åº”ä¸€ä¸ª Partition</strong>ã€‚è¿™æ ·å½“ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ç ´åäº† Kafka çš„è®¾è®¡åˆè¡·ã€‚</p><p>Kafka ä¸­å‘é€ 1 æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®š topic, partition, key,dataï¼ˆæ•°æ®ï¼‰ 4 ä¸ªå‚æ•°ã€‚å¦‚æœä½ å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®šäº† Partition çš„è¯ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«å‘é€åˆ°æŒ‡å®šçš„ Partitionã€‚å¹¶ä¸”ï¼ŒåŒä¸€ä¸ª key çš„æ¶ˆæ¯å¯ä»¥ä¿è¯åªå‘é€åˆ°åŒä¸€ä¸ª partitionï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¡¨/å¯¹è±¡çš„ id æ¥ä½œä¸º key ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºå¦‚ä½•ä¿è¯ Kafka ä¸­æ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºï¼Œæœ‰äº†ä¸‹é¢ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>1 ä¸ª Topic åªå¯¹åº”ä¸€ä¸ª Partitionã€‚</li><li>ï¼ˆæ¨èï¼‰å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®š key/Partitionã€‚</li></ol><p>å½“ç„¶ä¸ä»…ä»…åªæœ‰ä¸Šé¢ä¸¤ç§æ–¹æ³•ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ³•æ˜¯æˆ‘è§‰å¾—æ¯”è¾ƒå¥½ç†è§£çš„</p><h4 id="kafkaæ€ä¹ˆä¿è¯æ¶ˆæ¯å¯é æ€§çš„" tabindex="-1"><a class="header-anchor" href="#kafkaæ€ä¹ˆä¿è¯æ¶ˆæ¯å¯é æ€§çš„" aria-hidden="true">#</a> kafkaæ€ä¹ˆä¿è¯æ¶ˆæ¯å¯é æ€§çš„ï¼Ÿ</h4><p>ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µï¼š</p><p>ç”Ÿäº§è€…(Producer) è°ƒç”¨ <code>send</code>æ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜å¹¶æ²¡æœ‰å‘é€è¿‡å»ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸èƒ½é»˜è®¤åœ¨è°ƒç”¨ <code>send</code>æ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åæ¶ˆæ¯å‘é€æˆåŠŸäº†ã€‚ä¸ºäº†ç¡®å®šæ¶ˆæ¯æ˜¯å‘é€æˆåŠŸï¼Œæˆ‘ä»¬è¦åˆ¤æ–­æ¶ˆæ¯å‘é€çš„ç»“æœã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ Kafka ç”Ÿäº§è€…(Producer) ä½¿ç”¨ <code>send</code> æ–¹æ³•å‘é€æ¶ˆæ¯å®é™…ä¸Šæ˜¯å¼‚æ­¥çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>get()</code>æ–¹æ³•è·å–è°ƒç”¨ç»“æœï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿè®©å®ƒå˜ä¸ºäº†åŒæ­¥æ“ä½œï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>',66),$p={href:"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486269&idx=2&sn=ec00417ad641dd8c3d145d74cafa09ce&chksm=cea244f6f9d5cde0c8eb233fcc4cf82e11acd06446719a7af55230649863a3ddd95f78d111de&token=1633957262&lang=zh_CN#rd",target:"_blank",rel:"noopener noreferrer"},no=t(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SendResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sendResult <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>sendResult<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…æˆåŠŸå‘é€æ¶ˆæ¯åˆ°&quot;</span> <span class="token operator">+</span> sendResult<span class="token punctuation">.</span><span class="token function">getProducerRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt; &quot;</span> <span class="token operator">+</span> sendRe
              sult<span class="token punctuation">.</span><span class="token function">getProducerRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšï¼å¯ä»¥é‡‡ç”¨ä¸ºå…¶æ·»åŠ å›è°ƒå‡½æ•°çš„å½¢å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>        <span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        future<span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…æˆåŠŸå‘é€æ¶ˆæ¯åˆ°topic:{} partition:{}çš„æ¶ˆæ¯&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ex <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆå¤±è´¥ï¼ŒåŸå› ï¼š{}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬æ£€æŸ¥å¤±è´¥çš„åŸå› ä¹‹åé‡æ–°å‘é€å³å¯ï¼</p><p><strong>å¦å¤–è¿™é‡Œæ¨èä¸º Producer çš„ <code>retries </code>ï¼ˆé‡è¯•æ¬¡æ•°ï¼‰è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„å€¼ï¼Œä¸€èˆ¬æ˜¯ 3 ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„è¯ä¸€èˆ¬ä¼šè®¾ç½®æ¯”è¾ƒå¤§ä¸€ç‚¹ã€‚è®¾ç½®å®Œæˆä¹‹åï¼Œå½“å‡ºç°ç½‘ç»œé—®é¢˜ä¹‹åèƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚å¦å¤–ï¼Œå»ºè®®è¿˜è¦è®¾ç½®é‡è¯•é—´éš”ï¼Œå› ä¸ºé—´éš”å¤ªå°çš„è¯é‡è¯•çš„æ•ˆæœå°±ä¸æ˜æ˜¾äº†ï¼Œç½‘ç»œæ³¢åŠ¨ä¸€æ¬¡ä½ 3æ¬¡ä¸€ä¸‹å­å°±é‡è¯•å®Œäº†</strong></p><p>æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯çš„æƒ…å†µï¼š</p><p>æˆ‘ä»¬çŸ¥é“æ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ° Partition(åˆ†åŒº)çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚åç§»é‡ï¼ˆoffset)è¡¨ç¤º Consumer å½“å‰æ¶ˆè´¹åˆ°çš„ Partition(åˆ†åŒº)çš„æ‰€åœ¨çš„ä½ç½®ã€‚Kafka é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ã€‚</p><figure><img src="`+la+'" alt="image-20220517212306882" tabindex="0" loading="lazy"><figcaption>image-20220517212306882</figcaption></figure><p>å½“æ¶ˆè´¹è€…æ‹‰å–åˆ°äº†åˆ†åŒºçš„æŸä¸ªæ¶ˆæ¯ä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æäº¤äº† offsetã€‚è‡ªåŠ¨æäº¤çš„è¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå½“æ¶ˆè´¹è€…åˆšæ‹¿åˆ°è¿™ä¸ªæ¶ˆæ¯å‡†å¤‡è¿›è¡ŒçœŸæ­£æ¶ˆè´¹çš„æ—¶å€™ï¼Œçªç„¶æŒ‚æ‰äº†ï¼Œæ¶ˆæ¯å®é™…ä¸Šå¹¶æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯ offset å´è¢«è‡ªåŠ¨æäº¤äº†ã€‚</p><p><strong>è§£å†³åŠæ³•ä¹Ÿæ¯”è¾ƒç²—æš´ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å…³é—­è‡ªåŠ¨æäº¤ offsetï¼Œæ¯æ¬¡åœ¨çœŸæ­£æ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åå†è‡ªå·±æ‰‹åŠ¨æäº¤ offset ã€‚</strong> ä½†æ˜¯ï¼Œç»†å¿ƒçš„æœ‹å‹ä¸€å®šä¼šå‘ç°ï¼Œè¿™æ ·ä¼šå¸¦æ¥æ¶ˆæ¯è¢«é‡æ–°æ¶ˆè´¹çš„é—®é¢˜ã€‚æ¯”å¦‚ä½ åˆšåˆšæ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åï¼Œè¿˜æ²¡æäº¤ offsetï¼Œç»“æœè‡ªå·±æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯ç†è®ºä¸Šå°±ä¼šè¢«æ¶ˆè´¹ä¸¤æ¬¡ã€‚</p><ol start="3"><li>ä¿è¯æ¶ˆæ¯ä¸é‡å¤</li></ol><p><strong>kafkaå‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„åŸå› ï¼š</strong></p><ul><li>æœåŠ¡ç«¯ä¾§å·²ç»æ¶ˆè´¹çš„æ•°æ®æ²¡æœ‰æˆåŠŸæäº¤ offsetï¼ˆæ ¹æœ¬åŸå› ï¼‰ã€‚</li><li>Kafka ä¾§ ç”±äºæœåŠ¡ç«¯å¤„ç†ä¸šåŠ¡æ—¶é—´é•¿æˆ–è€…ç½‘ç»œé“¾æ¥ç­‰ç­‰åŸå› è®© Kafka è®¤ä¸ºæœåŠ¡å‡æ­»ï¼Œè§¦å‘äº†åˆ†åŒº rebalanceã€‚</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ul><li><p>æ¶ˆè´¹æ¶ˆæ¯æœåŠ¡åšå¹‚ç­‰æ ¡éªŒï¼Œæ¯”å¦‚ Redis çš„setã€MySQL çš„ä¸»é”®ç­‰å¤©ç„¶çš„å¹‚ç­‰åŠŸèƒ½ã€‚è¿™ç§æ–¹æ³•æœ€æœ‰æ•ˆã€‚</p></li><li><p>å°†</p><p><code>enable.auto.commit</code></p><p>å‚æ•°è®¾ç½®ä¸º falseï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¼€å‘è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨æäº¤ offsetã€‚é‚£ä¹ˆè¿™é‡Œä¼šæœ‰ä¸ªé—®é¢˜ï¼š</p><p>ä»€ä¹ˆæ—¶å€™æäº¤offsetåˆé€‚ï¼Ÿ</p><ul><li>å¤„ç†å®Œæ¶ˆæ¯å†æäº¤ï¼šä¾æ—§æœ‰æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é£é™©ï¼Œå’Œè‡ªåŠ¨æäº¤ä¸€æ ·</li><li>æ‹‰å–åˆ°æ¶ˆæ¯å³æäº¤ï¼šä¼šæœ‰æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚å…è®¸æ¶ˆæ¯å»¶æ—¶çš„åœºæ™¯ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚ç„¶åï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡åœ¨ä¸šåŠ¡ä¸ç¹å¿™ï¼ˆæ¯”å¦‚å‡Œæ™¨ï¼‰çš„æ—¶å€™åšæ•°æ®å…œåº•ã€‚</li></ul></li></ul><h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" aria-hidden="true">#</a> å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h4><p>RocketMQ ç¯‡</p><hr><p>ä¸€ä¸ªæ¶ˆæ¯ä»ç”Ÿäº§è€…äº§ç”Ÿï¼Œåˆ°è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¸»è¦ç»è¿‡è¿™3ä¸ªè¿‡ç¨‹ï¼š</p><figure><img src="'+ra+'" alt="image-20220613102319669" tabindex="0" loading="lazy"><figcaption>image-20220613102319669</figcaption></figure><ol><li>ç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯</li><li>æ¶ˆæ¯å‘é€åˆ°å­˜å‚¨ç«¯ï¼Œä¿å­˜ä¸‹æ¥</li><li>æ¶ˆæ¯æ¨é€åˆ°æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹å®Œï¼Œackåº”ç­”ã€‚</li></ol><p>å› æ­¤å¦‚ä½•ä¿è¯MQä¸ä¸¢å¤±æ¶ˆæ¯ï¼Œå¯ä»¥ä»è¿™ä¸‰ä¸ªé˜¶æ®µé˜è¿°ï¼š</p><ul><li>ç”Ÿäº§è€…ä¿è¯ä¸ä¸¢æ¶ˆæ¯</li><li>å­˜å‚¨ç«¯ä¸ä¸¢æ¶ˆæ¯</li><li>æ¶ˆè´¹è€…ä¸ä¸¢æ¶ˆæ¯</li></ul><p>ç”Ÿäº§è€…ä¿è¯ä¸ä¸¢æ¶ˆæ¯</p><p>ç”Ÿäº§ç«¯å¦‚ä½•ä¿è¯ä¸ä¸¢æ¶ˆæ¯å‘¢ï¼Ÿç¡®ä¿ç”Ÿäº§çš„æ¶ˆæ¯èƒ½é¡ºåˆ©åˆ°è¾¾å­˜å‚¨ç«¯ã€‚</p><p>å¦‚æœæ˜¯ <code>RocketMQ</code>æ¶ˆæ¯ä¸­é—´ä»¶çš„è¯ï¼Œ<code>Producer</code>ç”Ÿäº§è€…æä¾›äº†ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>åŒæ­¥å‘é€</li><li>å¼‚æ­¥å‘é€</li><li>å•å‘å‘é€</li></ul><p>ç”Ÿäº§è€…è¦æƒ³å‘æ¶ˆæ¯æ—¶ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œå¯ä»¥ï¼š</p><ul><li>é‡‡ç”¨åŒæ­¥æ–¹å¼å‘é€ï¼Œsendæ¶ˆæ¯æ–¹æ³•è¿”å›æˆåŠŸçŠ¶æ€ï¼Œå³æ¶ˆæ¯æ­£å¸¸åˆ°è¾¾äº†å­˜å‚¨ç«¯ <code>Broker</code>ã€‚</li><li>å¦‚æœ <code>send</code>æ¶ˆæ¯å¼‚å¸¸æˆ–è€…è¿”å›éæˆåŠŸçŠ¶æ€ï¼Œå¯ä»¥å‘èµ·é‡è¯•ã€‚</li><li>å¯ä»¥ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯ï¼Œ<code>RocketMQ</code>çš„äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶å°±æ˜¯ä¸ºäº†ä¿è¯é›¶ä¸¢å¤±æ¥è®¾è®¡çš„</li></ul><p>å­˜å‚¨ç«¯ä¸ä¸¢æ¶ˆæ¯</p><p>å¦‚ä½•ä¿è¯å­˜å‚¨ç«¯çš„æ¶ˆæ¯ä¸ä¸¢å¤±å‘¢ï¼Ÿç¡®ä¿æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé‚£å°±æ˜¯åˆ·ç›˜æœºåˆ¶å˜›ã€‚</p><p>åˆ·ç›˜æœºåˆ¶åˆ†<strong>åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜</strong>ï¼š</p><ul><li>åŒæ­¥åˆ·ç›˜ï¼šç”Ÿäº§è€…æ¶ˆæ¯å‘è¿‡æ¥æ—¶ï¼Œåªæœ‰æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œ<code>RocketMQ</code>çš„å­˜å‚¨ç«¯ <code>Broker</code>æ‰è¿”å›ä¸€ä¸ªæˆåŠŸçš„ACKå“åº”ã€‚å®ƒä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ˜¯å½±å“äº†æ€§èƒ½ã€‚</li><li>å¼‚æ­¥åˆ·ç›˜ï¼šåªè¦æ¶ˆæ¯å†™å…¥ <code>PageCache</code>ç¼“å­˜ï¼Œå°±è¿”å›ä¸€ä¸ªæˆåŠŸçš„ACKå“åº”ã€‚è¿™æ ·æé«˜äº†MQçš„æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœè¿™æ—¶å€™æœºå™¨æ–­ç”µäº†ï¼Œå°±ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚</li></ul><p>é™¤äº†åŒæ­¥åˆ·ç›˜æœºåˆ¶ï¼Œè¿˜æœ‰ä¸€ä¸ªç»´åº¦éœ€è¦è€ƒè™‘ã€‚<code>Broker</code>ä¸€èˆ¬æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œæœ‰ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ã€‚æ¶ˆæ¯åˆ° <code>Broker</code>å­˜å‚¨ç«¯ï¼Œåªæœ‰ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸï¼Œæ‰åé¦ˆæˆåŠŸçš„ <code>ack</code>ç»™ç”Ÿäº§è€…ã€‚è¿™å°±æ˜¯<strong>åŒæ­¥å¤åˆ¶</strong>ï¼Œå®ƒä¿è¯äº†æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ˜¯é™ä½äº†ç³»ç»Ÿçš„ååé‡ã€‚ä¸ä¹‹å¯¹åº”å³æ˜¯<strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼Œåªè¦æ¶ˆæ¯å†™å…¥ä¸»èŠ‚ç‚¹æˆåŠŸï¼Œå°±è¿”å›æˆåŠŸçš„ <code>ack</code>ï¼Œå®ƒé€Ÿåº¦å¿«ï¼Œä½†æ˜¯ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p><p>æ¶ˆè´¹é˜¶æ®µä¸ä¸¢æ¶ˆæ¯</p><p>è´¹è€…<strong>æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘</strong>ï¼Œå†åé¦ˆä¼š <code>Broker</code>è¯´æ¶ˆè´¹æˆåŠŸï¼Œè¿™æ ·æ‰å¯ä»¥ä¿è¯æ¶ˆè´¹é˜¶æ®µä¸ä¸¢æ¶ˆæ¯ã€‚</p><h4 id="äº‹åŠ¡æ¶ˆæ¯æ˜¯å¦äº†è§£" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æ¶ˆæ¯æ˜¯å¦äº†è§£" aria-hidden="true">#</a> äº‹åŠ¡æ¶ˆæ¯æ˜¯å¦äº†è§£ï¼Ÿ</h4><p>äº‹åŠ¡æ¶ˆæ¯ä¸»è¦ç”¨æ¥è§£å†³æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆæ¯æ¶ˆè´¹è€…çš„<strong>æ•°æ®ä¸€è‡´æ€§</strong>é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥å›å¿†ä¸€ä¸‹ï¼šä¸€æ¡æ™®é€šçš„æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯ï¼Œä»äº§ç”Ÿåˆ°è¢«æ¶ˆè´¹ï¼Œç»å†çš„æµç¨‹ï¼š</p><figure><img src="'+ua+'" alt="image-20220613102612771" tabindex="0" loading="lazy"><figcaption>image-20220613102612771</figcaption></figure><ol><li>ç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯ï¼Œå‘é€åˆ°MQæœåŠ¡å™¨</li><li>MQæ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°å­˜å‚¨ç³»ç»Ÿã€‚</li><li>MQæœåŠ¡å™¨è¿”å›ACkåˆ°ç”Ÿäº§è€…ã€‚</li><li>MQæœåŠ¡å™¨æŠŠæ¶ˆæ¯pushç»™æ¶ˆè´¹è€…</li><li>æ¶ˆè´¹è€…æ¶ˆè´¹å®Œæ¶ˆæ¯ï¼Œå“åº”ACK</li><li>MQæœåŠ¡å™¨æ”¶åˆ°ACKï¼Œè®¤ä¸ºæ¶ˆæ¯æ¶ˆè´¹æˆåŠŸï¼Œå³åœ¨å­˜å‚¨ä¸­åˆ é™¤æ¶ˆæ¯ã€‚</li></ol><p><strong>æ¶ˆæ¯é˜Ÿåˆ—çš„äº‹åŠ¡æ¶ˆæ¯æµç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</strong></p><figure><img src="'+da+'" alt="image-20220613102619845" tabindex="0" loading="lazy"><figcaption>image-20220613102619845</figcaption></figure><ol><li>ç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯ï¼Œå‘é€ä¸€æ¡åŠäº‹åŠ¡æ¶ˆæ¯åˆ°MQæœåŠ¡å™¨</li><li>MQæ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°å­˜å‚¨ç³»ç»Ÿï¼Œè¿™æ¡æ¶ˆæ¯çš„çŠ¶æ€æ˜¯å¾…å‘é€çŠ¶æ€ã€‚</li><li>MQæœåŠ¡å™¨è¿”å›ACKç¡®è®¤åˆ°ç”Ÿäº§è€…ï¼Œæ­¤æ—¶MQä¸ä¼šè§¦å‘æ¶ˆæ¯æ¨é€äº‹ä»¶</li><li>ç”Ÿäº§è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li><li>å¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå³commitæ‰§è¡Œç»“æœåˆ°MQæœåŠ¡å™¨ï¼›å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå‘é€rollbackã€‚</li><li>å¦‚æœæ˜¯æ­£å¸¸çš„commitï¼ŒMQæœåŠ¡å™¨æ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸ºå¯å‘é€ï¼›å¦‚æœæ˜¯rollbackï¼Œå³åˆ é™¤æ¶ˆæ¯ã€‚</li><li>å¦‚æœæ¶ˆæ¯çŠ¶æ€æ›´æ–°ä¸ºå¯å‘é€ï¼Œåˆ™MQæœåŠ¡å™¨ä¼špushæ¶ˆæ¯ç»™æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹è€…æ¶ˆè´¹å®Œå°±å›ACKã€‚</li><li>å¦‚æœMQæœåŠ¡å™¨é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°ç”Ÿäº§è€…çš„commitæˆ–è€…rollbackï¼Œå®ƒä¼šåæŸ¥ç”Ÿäº§è€…ï¼Œç„¶åæ ¹æ®æŸ¥è¯¢åˆ°çš„ç»“æœæ‰§è¡Œæœ€ç»ˆçŠ¶æ€ã€‚</li></ol><h4 id="kafkaæ‰¹é‡æ¶ˆè´¹-å¦‚æœæ¶ˆè´¹è¿‡é•¿-ä¼šå¯¼è‡´æ¶ˆè´¹è¶…æ—¶-è§¦å‘rebalance-2022è™¾çš®" tabindex="-1"><a class="header-anchor" href="#kafkaæ‰¹é‡æ¶ˆè´¹-å¦‚æœæ¶ˆè´¹è¿‡é•¿-ä¼šå¯¼è‡´æ¶ˆè´¹è¶…æ—¶-è§¦å‘rebalance-2022è™¾çš®" aria-hidden="true">#</a> kafkaæ‰¹é‡æ¶ˆè´¹ï¼Œå¦‚æœæ¶ˆè´¹è¿‡é•¿ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è¶…æ—¶ï¼Œè§¦å‘rebalanceï¼Ÿï¼ˆ2022è™¾çš®ï¼‰</h4><h2 id="ğŸ§©æ•°æ®ç»“æ„å’Œç®—æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ§©æ•°æ®ç»“æ„å’Œç®—æ³•" aria-hidden="true">#</a> ğŸ§©æ•°æ®ç»“æ„å’Œç®—æ³•</h2><h3 id="lru-ä»‹ç»-åº•å±‚æ•°æ®ç»“æ„-é«˜å¹¶å‘æƒ…å†µä¸‹å¦‚ä½•è®¾è®¡-lru-or-lruç¼“å­˜åŸç†-æ‰‹å†™-è¦æ”¯æŒæ³›å‹" tabindex="-1"><a class="header-anchor" href="#lru-ä»‹ç»-åº•å±‚æ•°æ®ç»“æ„-é«˜å¹¶å‘æƒ…å†µä¸‹å¦‚ä½•è®¾è®¡-lru-or-lruç¼“å­˜åŸç†-æ‰‹å†™-è¦æ”¯æŒæ³›å‹" aria-hidden="true">#</a> LRU ä»‹ç»ï¼Œåº•å±‚æ•°æ®ç»“æ„ï¼Œé«˜å¹¶å‘æƒ…å†µä¸‹å¦‚ä½•è®¾è®¡ LRU or LRUç¼“å­˜åŸç†ï¼Ÿæ‰‹å†™ï¼Œè¦æ”¯æŒæ³›å‹</h3>',46),so={href:"https://leetcode-cn.com/problems/lru-cache/",target:"_blank",rel:"noopener noreferrer"},ao={href:"https://www.nowcoder.com/practice/5dfded165916435d9defb053c63f1e84?tpId=295&tqId=2427094&ru=/exam/oj&qru=/ta/format-top101/question-ranking&sourceUrl=%2Fexam%2Foj%3Ftab%3D%E7%AE%97%E6%B3%95%E7%AF%87%26topicId%3D295",target:"_blank",rel:"noopener noreferrer"},eo=t(`<p>åŒå‘é“¾è¡¨ï¼ˆ<code>LinkedHashMap</code>ï¼Œä¸è¿‡é¢è¯•çš„æ—¶å€™æœ€å¥½è‡ªå·±å®ç°ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼‰ + å“ˆå¸Œ</p><p>æœ€å¸¸ä½¿ç”¨çš„èŠ‚ç‚¹éƒ½ç›´æ¥æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿™æ ·ï¼Œé“¾è¡¨çš„å°¾éƒ¨å°±æ˜¯æœ€ä¸å¸¸è®¿é—®çš„</p><p><strong>è§£æ³•ä¸€ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>
  
    <span class="token comment">// å®šä¹‰åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ç»“æ„</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> key<span class="token punctuation">,</span> value<span class="token punctuation">;</span>
        <span class="token class-name">Node</span> pre<span class="token punctuation">,</span> next<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// é“¾è¡¨å¤´(å¤´èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨ä»»ä½•æ•°æ®)</span>
    <span class="token keyword">private</span> <span class="token class-name">Node</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é“¾è¡¨å°¾(å°¾èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨ä»»ä½•æ•°æ®)</span>
    <span class="token keyword">private</span> <span class="token class-name">Node</span> tail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å“ˆå¸Œè¡¨ï¼Œä»¥è¾¾åˆ° O(1) çº§åˆ«çš„ set å’Œ get</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        head<span class="token punctuation">.</span>next <span class="token operator">=</span> tail<span class="token punctuation">;</span>
        tail<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span> node <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 1. ä»é“¾è¡¨ä¸­åˆ é™¤è¿™ä¸ªå…ƒç´ </span>
            node<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            node<span class="token punctuation">.</span>next<span class="token punctuation">.</span>pre <span class="token operator">=</span> node<span class="token punctuation">.</span>pre<span class="token punctuation">;</span>
            <span class="token comment">// 2. node æ·»åŠ åˆ°é“¾è¡¨å¤´</span>
            <span class="token function">addHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
          
            <span class="token keyword">return</span> node<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      
        <span class="token comment">// ä¸å­˜åœ¨åˆ™è¿”å› -1</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–° value</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ³¨æ„å¦‚æœ get(key) != -1 çš„è¯ï¼Œé‚£ä¹ˆå°±å·²ç»æŠŠ key å¯¹åº”çš„ node æ·»åŠ åˆ°æœ€å‰é¢äº†ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦æ”¹ä¸‹ value çš„å€¼å°±è¡Œ</span>
            map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥æ–°èŠ‚ç‚¹ key-value</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœèŠ‚ç‚¹çš„æ•°é‡å·²ç»è¶…è¿‡ capacityï¼Œåˆ™å¼¹å‡ºæœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹(æœ€åé¢é‚£ä¸ªèŠ‚ç‚¹ï¼Œæ³¨æ„ä¸æ˜¯å°¾èŠ‚ç‚¹)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> removeKey <span class="token operator">=</span> tail<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
                tail<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>next <span class="token operator">=</span> tail<span class="token punctuation">;</span>
                tail<span class="token punctuation">.</span>pre <span class="token operator">=</span> tail<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>pre<span class="token punctuation">;</span>
                map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>removeKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// æ’å…¥æ–°èŠ‚ç‚¹ key-value</span>
            <span class="token class-name">Node</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">addHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      
    <span class="token punctuation">}</span>
  
    <span class="token comment">// å°† node èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨(head èŠ‚ç‚¹ä¹‹å)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addHead</span><span class="token punctuation">(</span><span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>next <span class="token operator">=</span> head<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        head<span class="token punctuation">.</span>next<span class="token punctuation">.</span>pre <span class="token operator">=</span> node<span class="token punctuation">;</span>
      
        head<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>
        node<span class="token punctuation">.</span>pre <span class="token operator">=</span> head<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Your Solution object will be instantiated and called as such:
 * Solution solution = new Solution(capacity);
 * int output = solution.get(key);
 * solution.set(key,value);
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£æ³•äºŒï¼šLinkedHashMap</strong></p><p>LinkedHashMap çš„ç‰¹æ€§ï¼Œ æ¯ä¸ªèŠ‚ç‚¹é—´ç”±ä¸€ä¸ª before å¼•ç”¨ å’Œ after å¼•ç”¨ä¸²è”èµ·æ¥æˆä¸ºä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚é“¾è¡¨èŠ‚ç‚¹æŒ‰ç…§è®¿é—®æ—¶é—´è¿›è¡Œæ’åºï¼Œ<strong>æœ€è¿‘è®¿é—®è¿‡çš„é“¾è¡¨æ”¾åœ¨é“¾è¡¨å°¾</strong>ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 10 æ˜¯åˆå§‹å¤§å°ï¼Œ0.75 æ˜¯è£…è½½å› å­ï¼Œtrue æ˜¯è¡¨ç¤ºæŒ‰ç…§è®¿é—®æ—¶é—´æ’åº</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0.75f</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

m<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> e <span class="token operator">:</span> m<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¾“å‡ºçš„ç»“æœæ˜¯ 1ï¼Œ2ï¼Œ3ï¼Œ5</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»€ä¹ˆæ˜¯å›æº¯-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å›æº¯-2022è”šæ¥" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯å›æº¯ï¼ˆ2022è”šæ¥ï¼‰</h3><p>å›æº¯ç®—æ³•æ˜¯å¯¹æ ‘å½¢æˆ–è€…å›¾å½¢ç»“æ„æ‰§è¡Œä¸€æ¬¡æ·±åº¦ä¼˜å…ˆéå†ï¼Œå®é™…ä¸Šç±»ä¼¼æšä¸¾çš„æœç´¢å°è¯•è¿‡ç¨‹ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å¯»æ‰¾é—®é¢˜çš„è§£ã€‚</p><p>æ·±åº¦ä¼˜å…ˆéå†æœ‰ä¸ªç‰¹ç‚¹ï¼šå½“å‘ç°å·²ä¸æ»¡è¶³æ±‚è§£æ¡ä»¶æ—¶ï¼Œå°±è¿”å›ï¼Œå°è¯•åˆ«çš„è·¯å¾„ã€‚æ­¤æ—¶å¯¹è±¡ç±»å‹å˜é‡å°±éœ€è¦é‡ç½®æˆä¸ºå’Œä¹‹å‰ä¸€æ ·ï¼Œç§°ä¸ºã€ŒçŠ¶æ€é‡ç½®ã€ã€‚</p><p>è®¸å¤šå¤æ‚çš„ï¼Œè§„æ¨¡è¾ƒå¤§çš„é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨å›æº¯æ³•ï¼Œæœ‰ã€Œé€šç”¨è§£é¢˜æ–¹æ³•ã€çš„ç¾ç§°ã€‚å®é™…ä¸Šï¼Œå›æº¯ç®—æ³•å°±æ˜¯æš´åŠ›æœç´¢ç®—æ³•ï¼Œå®ƒæ˜¯æ—©æœŸçš„äººå·¥æ™ºèƒ½é‡Œä½¿ç”¨çš„ç®—æ³•ï¼Œå€ŸåŠ©è®¡ç®—æœºå¼ºå¤§çš„è®¡ç®—èƒ½åŠ›å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°é—®é¢˜çš„è§£ã€‚</p><h3 id="æœ‰å“ªäº›æœç´¢ç®—æ³•-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#æœ‰å“ªäº›æœç´¢ç®—æ³•-2022è”šæ¥" aria-hidden="true">#</a> æœ‰å“ªäº›æœç´¢ç®—æ³•ï¼ˆ2022è”šæ¥ï¼‰</h3><p>å¸¸è§çš„æœ‰</p><ul><li><p>æ·±åº¦ä¼˜å…ˆæœç´¢</p></li><li><p>å¹¿åº¦ä¼˜å…ˆæœç´¢</p></li><li><p>å›æº¯</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯å‰ªæ-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å‰ªæ-2022è”šæ¥" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯å‰ªæï¼ˆ2022è”šæ¥ï¼‰</h3><p>å‰ªæé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ å»ä¸€äº›ä¸é‡è¦çš„èŠ‚ç‚¹ï¼Œæ¥å‡å°è®¡ç®—æˆ–æœç´¢çš„å¤æ‚åº¦ã€‚å‰ªæåœ¨å¾ˆå¤šç®—æ³•ä¸­éƒ½æœ‰å¾ˆå¥½çš„åº”ç”¨ï¼Œå¦‚ï¼šå†³ç­–æ ‘ï¼Œç¥ç»ç½‘ç»œï¼Œæœç´¢ç®—æ³•,æ•°æ®åº“çš„è®¾è®¡ç­‰ã€‚åœ¨å†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œä¸­ï¼Œå‰ªæå¯ä»¥æœ‰æ•ˆç¼“è§£è¿‡æ‹Ÿåˆé—®é¢˜å¹¶å‡å°è®¡ç®—å¤æ‚åº¦ï¼›åœ¨æœç´¢ç®—æ³•ä¸­ï¼Œå¯ä»¥å‡å°æœç´¢èŒƒå›´ï¼Œæé«˜æœç´¢æ•ˆç‡ã€‚</p><h3 id="ä»€ä¹ˆæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸‹é™å¯ä»¥çªç ´o-nlogn-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸‹é™å¯ä»¥çªç ´o-nlogn-2022è”šæ¥" aria-hidden="true">#</a> ä»€ä¹ˆæ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸‹é™å¯ä»¥çªç ´O(nlogn)ï¼ˆ2022è”šæ¥ï¼‰</h3><h3 id="æ’åºçš„æ—¶é—´å¤æ‚åº¦-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#æ’åºçš„æ—¶é—´å¤æ‚åº¦-2022è”šæ¥" aria-hidden="true">#</a> æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼ˆ2022è”šæ¥ï¼‰</h3><table><thead><tr><th>æ’åºæ³•</th><th>å¹³å‡æ—¶é—´</th><th>æœ€å·®æƒ…å½¢</th><th>ç¨³å®šåº¦</th><th>é¢å¤–ç©ºé—´</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å†’æ³¡</td><td>O(n2)</td><td>O(n2)</td><td>ç¨³å®š</td><td>O(1)</td><td>nå°æ—¶è¾ƒå¥½</td></tr><tr><td>é€‰æ‹©</td><td>O(n2)</td><td>O(n2)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå°æ—¶è¾ƒå¥½</td></tr><tr><td>æ’å…¥</td><td>O(n2)</td><td>O(n2)</td><td>ç¨³å®š</td><td>O(1)</td><td>å¤§éƒ¨åˆ†å·²æ’åºæ—¶è¾ƒå¥½</td></tr><tr><td>åŸºæ•°</td><td>O(logRB)</td><td>O(logRB)</td><td>ç¨³å®š</td><td>O(n)</td><td>Bæ˜¯çœŸæ•°(0-9)ï¼ŒRæ˜¯åŸºæ•°(ä¸ªåç™¾)</td></tr><tr><td>Shell</td><td>O(nlogn)</td><td>O(ns) 1&lt;s&lt;2</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>sæ˜¯æ‰€é€‰åˆ†ç»„</td></tr><tr><td>å¿«é€Ÿ</td><td>O(nlogn)</td><td>O(n2)</td><td>ä¸ç¨³å®š</td><td>O(nlogn)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å½’å¹¶</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å †</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr></tbody></table><h3 id="åŸºæ•°æ’åºçš„åœºæ™¯-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#åŸºæ•°æ’åºçš„åœºæ™¯-2022è”šæ¥" aria-hidden="true">#</a> åŸºæ•°æ’åºçš„åœºæ™¯ï¼ˆ2022è”šæ¥ï¼‰</h3><p>æŠŠä¸€ç³»åˆ—å•è¯ï¼ŒæŒ‰ç…§è‹±æ–‡å­—å…¸çš„é¡ºåºæ’åº</p><p>è¾“å…¥ï¼š [&quot;banana&quot;,&quot;apple&quot;,&quot;orange&quot;,&quot;ape&quot;,&quot;he&quot;]</p><p>è¾“å‡ºï¼š [&quot;ape&quot;,&quot;apple&quot;,&quot;banana&quot;,&quot;he&quot;,&quot;orange&quot;]</p><h2 id="ğŸ–¥ï¸æ“ä½œç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#ğŸ–¥ï¸æ“ä½œç³»ç»Ÿ" aria-hidden="true">#</a> ğŸ–¥ï¸æ“ä½œç³»ç»Ÿ</h2><h3 id="é‡ç‚¹ä¸­çš„æˆ˜æ–—æœº-ioå¤šè·¯å¤ç”¨-é‡ç‚¹ä»‹ç»epoll" tabindex="-1"><a class="header-anchor" href="#é‡ç‚¹ä¸­çš„æˆ˜æ–—æœº-ioå¤šè·¯å¤ç”¨-é‡ç‚¹ä»‹ç»epoll" aria-hidden="true">#</a> ï¼ˆé‡ç‚¹ä¸­çš„æˆ˜æ–—æœºï¼‰IOå¤šè·¯å¤ç”¨ï¼Œé‡ç‚¹ä»‹ç»epoll</h3><p>I/Oå¤šè·¯å¤ç”¨çš„æœ¬è´¨æ˜¯ä½¿ç”¨select,pollæˆ–è€…epollå‡½æ•°ï¼ŒæŒ‚èµ·è¿›ç¨‹ï¼Œå½“ä¸€ä¸ªæˆ–è€…å¤šä¸ªI/Oäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œå°†æ§åˆ¶è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ã€‚ä»¥æœåŠ¡å™¨ç¼–ç¨‹ä¸ºä¾‹ï¼Œä¼ ç»Ÿçš„å¤šè¿›ç¨‹(å¤šçº¿ç¨‹)å¹¶å‘æ¨¡å‹ï¼Œåœ¨å¤„ç†ç”¨æˆ·è¿æ¥æ—¶éƒ½æ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹æˆ–è€…è¿›ç¨‹å»å¤„ç†ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè€ŒI/Oå¤šè·¯å¤ç”¨åˆ™å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹(çº¿ç¨‹)å½“ä¸­åŒæ—¶ç›‘å¬å¤šä¸ªç½‘ç»œI/Oäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚selectã€poll å’Œ epoll éƒ½æ˜¯ Linux API æä¾›çš„ IO å¤ç”¨æ–¹å¼ã€‚</p><p>æ“ä½œç³»ç»Ÿçº§åˆ«æä¾›äº†ä¸€äº›æ¥å£æ¥æ”¯æŒIOå¤šè·¯å¤ç”¨ï¼Œæœ€æ—©çš„æ˜¯selectã€pollï¼Œå…¶åepollæ˜¯Linuxä¸‹çš„IOå¤šè·¯å¤ç”¨çš„å®ç°ã€‚</p><ul><li>selectæ¥å£æœ€æ—©å®ç°å­˜åœ¨éœ€è¦è°ƒç”¨å¤šæ¬¡ã€çº¿ç¨‹ä¸å®‰å…¨ä»¥åŠé™åˆ¶åªèƒ½ç›‘è§†1024ä¸ªé“¾æ¥çš„é—®é¢˜</li><li>pollæ¥å£ä¿®å¤äº†selectå‡½æ•°çš„ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>epollæ¥å£ä¿®å¤äº†ä¸Šè¿°çš„é—®é¢˜ï¼Œå¹¶ä¸”çº¿ç¨‹å®‰å…¨ï¼Œä¼šé€šçŸ¥å…·ä½“å“ªä¸ªè¿æ¥æœ‰æ–°æ•°æ®ã€‚ <ul><li>epollé€šè¿‡epoll_ctl()æ¥æ³¨å†Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦,ä¸€æ—¦åŸºäºæŸä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶,å†…æ ¸ä¼šé‡‡ç”¨ç±»ä¼¼<strong>callbackçš„å›è°ƒæœºåˆ¶</strong>,è¿…é€Ÿæ¿€æ´»è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦,å½“è¿›ç¨‹è°ƒç”¨epoll_wait()æ—¶ä¾¿å¾—åˆ°é€šçŸ¥(ä¸å†éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦,é€šè¿‡ç›‘å¬å›è°ƒçš„æœºåˆ¶,ä¹Ÿæ˜¯epollçš„é­…åŠ›)</li></ul></li></ul><blockquote><p>æ¨èyue&#39;du</p></blockquote>`,29),to={href:"https://xiaolincoding.com/os/8_network_system/selete_poll_epoll.html",target:"_blank",rel:"noopener noreferrer"},po=t('<p>æœ€åŸºç¡€çš„ TCP çš„ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯é˜»å¡ I/O æ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šåªèƒ½ä¸€å¯¹ä¸€é€šä¿¡ï¼Œé‚£ä¸ºäº†æœåŠ¡æ›´å¤šçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›ç½‘ç»œ I/O æ¨¡å‹ã€‚</p><p>æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ï¼Œæ¯æ¥ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ†é…ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹ï¼Œç„¶ååç»­çš„è¯»å†™éƒ½åœ¨å¯¹åº”çš„è¿›ç¨‹/çº¿ç¨‹ï¼Œè¿™ç§æ–¹å¼å¤„ç† 100 ä¸ªå®¢æˆ·ç«¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯å¢å¤§åˆ° 10000 ä¸ªæ—¶ï¼Œ10000 ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„è°ƒåº¦ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠå®ƒä»¬å ç”¨çš„å†…å­˜ï¼Œéƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå°±å‡ºç°äº† I/O çš„å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åªåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¤„ç†å¤šä¸ªæ–‡ä»¶çš„ I/Oï¼ŒLinux ä¸‹æœ‰ä¸‰ç§æä¾› I/O å¤šè·¯å¤ç”¨çš„ APIï¼Œåˆ†åˆ«æ˜¯ï¼šselectã€pollã€epollã€‚</p><p>select å’Œ poll å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå®ƒä»¬å†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€æ¥å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆã€‚</p><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æŠŠå…³æ³¨çš„ Socket é›†åˆé€šè¿‡ select/poll ç³»ç»Ÿè°ƒç”¨ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œç„¶åç”±å†…æ ¸æ£€æµ‹äº‹ä»¶ï¼Œå½“æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿæ—¶ï¼Œå†…æ ¸éœ€è¦éå†è¿›ç¨‹å…³æ³¨ Socket é›†åˆï¼Œæ‰¾åˆ°å¯¹åº”çš„ Socketï¼Œå¹¶è®¾ç½®å…¶çŠ¶æ€ä¸ºå¯è¯»/å¯å†™ï¼Œç„¶åæŠŠæ•´ä¸ª Socket é›†åˆä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€è¿˜è¦ç»§ç»­éå†æ•´ä¸ª Socket é›†åˆæ‰¾åˆ°å¯è¯»/å¯å†™çš„ Socketï¼Œç„¶åå¯¹å…¶å¤„ç†ã€‚</p><p>å¾ˆæ˜æ˜¾å‘ç°ï¼Œselect å’Œ poll çš„ç¼ºé™·åœ¨äºï¼Œå½“å®¢æˆ·ç«¯è¶Šå¤šï¼Œä¹Ÿå°±æ˜¯ Socket é›†åˆè¶Šå¤§ï¼ŒSocket é›†åˆçš„éå†å’Œæ‹·è´ä¼šå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ï¼Œå› æ­¤ä¹Ÿå¾ˆéš¾åº”å¯¹ C10Kã€‚</p><p>epoll æ˜¯è§£å†³ C10K é—®é¢˜çš„åˆ©å™¨ï¼Œé€šè¿‡ä¸¤ä¸ªæ–¹é¢è§£å†³äº† select/poll çš„é—®é¢˜ã€‚</p><ul><li>epoll åœ¨å†…æ ¸é‡Œä½¿ç”¨ã€Œçº¢é»‘æ ‘ã€æ¥å…³æ³¨è¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„ Socketï¼Œçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œé€šè¿‡å¯¹è¿™æ£µé»‘çº¢æ ‘çš„ç®¡ç†ï¼Œä¸éœ€è¦åƒ select/poll åœ¨æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥æ•´ä¸ª Socket é›†åˆï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¤§é‡çš„æ•°æ®æ‹·è´å’Œå†…å­˜åˆ†é…ã€‚</li><li>epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªã€Œé“¾è¡¨ã€æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œåªå°†æœ‰äº‹ä»¶å‘ç”Ÿçš„ Socket é›†åˆä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ªé›†åˆï¼ˆåŒ…å«æœ‰å’Œæ— äº‹ä»¶çš„ Socket ï¼‰ï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚</li></ul><p>è€Œä¸”ï¼Œepoll æ”¯æŒè¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘çš„æ–¹å¼ï¼Œè€Œ select/poll åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¹ç¼˜è§¦å‘çš„æ–¹å¼ä¼šæ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡é«˜</p><h3 id="èŠèŠé›¶æ‹·è´-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#èŠèŠé›¶æ‹·è´-2022è”šæ¥" aria-hidden="true">#</a> èŠèŠé›¶æ‹·è´ï¼ˆ2022è”šæ¥ï¼‰</h3><p>é›¶æ‹·è´å°±æ˜¯ä¸éœ€è¦å°†æ•°æ®ä»ä¸€ä¸ªå­˜å‚¨åŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€ä¸ªå­˜å‚¨åŒºåŸŸã€‚å®ƒæ˜¯æŒ‡åœ¨ä¼ ç»ŸIOæ¨¡å‹ä¸­ï¼ŒæŒ‡CPUæ‹·è´çš„æ¬¡æ•°ä¸º0ã€‚å®ƒæ˜¯IOçš„ä¼˜åŒ–æ–¹æ¡ˆ</p><ul><li>DMAæŠ€æœ¯</li><li>ä¼ ç»ŸIOæµç¨‹</li><li>é›¶æ‹·è´å®ç°ä¹‹mmap+write</li><li>é›¶æ‹·è´å®ç°ä¹‹sendfile</li><li>é›¶æ‹·è´å®ç°ä¹‹å¸¦æœ‰DMAæ”¶é›†æ‹·è´åŠŸèƒ½çš„sendfile</li></ul><p><strong>DMAæŠ€æœ¯æ¦‚è¿°</strong></p><p>åœ¨æ²¡æœ‰ DMA æŠ€æœ¯å‰ï¼ŒI/O çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>CPU å‘å‡ºå¯¹åº”çš„æŒ‡ä»¤ç»™ç£ç›˜æ§åˆ¶å™¨ï¼Œç„¶åè¿”å›ï¼›</li><li>ç£ç›˜æ§åˆ¶å™¨æ”¶åˆ°æŒ‡ä»¤åï¼Œäºæ˜¯å°±å¼€å§‹å‡†å¤‡æ•°æ®ï¼Œä¼šæŠŠæ•°æ®æ”¾å…¥åˆ°ç£ç›˜æ§åˆ¶å™¨çš„å†…éƒ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ª<strong>ä¸­æ–­</strong>ï¼›</li><li>CPU æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œåœä¸‹æ‰‹å¤´çš„å·¥ä½œï¼Œæ¥ç€æŠŠç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°è¯»è¿›è‡ªå·±çš„å¯„å­˜å™¨ï¼Œç„¶åå†æŠŠå¯„å­˜å™¨é‡Œçš„æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œè€Œåœ¨æ•°æ®ä¼ è¾“çš„æœŸé—´ CPU æ˜¯æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡çš„ã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å‰¯å›¾ï¼š</p><figure><img src="'+ka+'" alt="image-20220627104731025" tabindex="0" loading="lazy"><figcaption>image-20220627104731025</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ï¼Œéƒ½è¦éœ€è¦ CPU äº²è‡ªå‚ä¸æ¬è¿æ•°æ®çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ï¼ŒCPU æ˜¯ä¸èƒ½åšå…¶ä»–äº‹æƒ…çš„ã€‚</p><p>ç®€å•çš„æ¬è¿å‡ ä¸ªå­—ç¬¦æ•°æ®é‚£æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨åƒå…†ç½‘å¡æˆ–è€…ç¡¬ç›˜ä¼ è¾“å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ç”¨ CPU æ¥æ¬è¿çš„è¯ï¼Œè‚¯å®šå¿™ä¸è¿‡æ¥ã€‚</p><p>è®¡ç®—æœºç§‘å­¦å®¶ä»¬å‘ç°äº†äº‹æƒ…çš„ä¸¥é‡æ€§åï¼Œäºæ˜¯å°±å‘æ˜äº† DMA æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯<strong>ç›´æ¥å†…å­˜è®¿é—®ï¼ˆ*Direct Memory Access*ï¼‰</strong> æŠ€æœ¯ã€‚</p><p>ä»€ä¹ˆæ˜¯ DMA æŠ€æœ¯ï¼Ÿç®€å•ç†è§£å°±æ˜¯ï¼Œ<strong>åœ¨è¿›è¡Œ I/O è®¾å¤‡å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡</strong>ã€‚</p><p>é‚£ä½¿ç”¨ DMA æ§åˆ¶å™¨è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ã€‚</p><figure><img src="'+ma+'" alt="image-20220627104743508" tabindex="0" loading="lazy"><figcaption>image-20220627104743508</figcaption></figure><p>å…·ä½“è¿‡ç¨‹ï¼š</p><ul><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›</li><li>æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼›</li><li>DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼›</li><li>ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼›</li><li><strong>DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡</strong>ï¼›</li><li>å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼›</li><li>CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼›</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ æ•´ä¸ªæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ï¼ŒCPU ä¸å†å‚ä¸æ•°æ®æ¬è¿çš„å·¥ä½œï¼Œè€Œæ˜¯å…¨ç¨‹ç”± DMA å®Œæˆï¼Œä½†æ˜¯ CPU åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œä¼ è¾“åˆ°å“ªé‡Œï¼Œéƒ½éœ€è¦ CPU æ¥å‘Šè¯‰ DMA æ§åˆ¶å™¨ã€‚</p><p>æ—©æœŸ DMA åªå­˜åœ¨åœ¨ä¸»æ¿ä¸Šï¼Œå¦‚ä»Šç”±äº I/O è®¾å¤‡è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®ä¼ è¾“çš„éœ€æ±‚ä¹Ÿä¸å°½ç›¸åŒï¼Œæ‰€ä»¥æ¯ä¸ª I/O è®¾å¤‡é‡Œé¢éƒ½æœ‰è‡ªå·±çš„ DMA æ§åˆ¶å™¨ã€‚</p><p><strong>ä¼ ç»ŸIOæµç¨‹</strong></p><p><strong>æµç¨‹å›¾å¦‚ä¸‹ï¼š</strong></p><figure><img src="'+ga+`" alt="image-20220618222110248" tabindex="0" loading="lazy"><figcaption>image-20220618222110248</figcaption></figure><ul><li>ç”¨æˆ·åº”ç”¨è¿›ç¨‹è°ƒç”¨readå‡½æ•°ï¼Œå‘æ“ä½œç³»ç»Ÿå‘èµ·IOè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼ˆåˆ‡æ¢1ï¼‰</strong></li><li>DMAæ§åˆ¶å™¨æŠŠæ•°æ®ä»ç£ç›˜ä¸­ï¼Œè¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</li><li>CPUæŠŠå†…æ ¸ç¼“å†²åŒºæ•°æ®ï¼Œæ‹·è´åˆ°ç”¨æˆ·åº”ç”¨ç¼“å†²åŒºï¼Œ<strong>ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€è½¬ä¸ºç”¨æˆ·æ€ï¼ˆåˆ‡æ¢2ï¼‰</strong>ï¼Œreadå‡½æ•°è¿”å›</li><li>ç”¨æˆ·åº”ç”¨è¿›ç¨‹é€šè¿‡writeå‡½æ•°ï¼Œå‘èµ·IOè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼ˆåˆ‡æ¢3ï¼‰</strong></li><li>CPUå°†åº”ç”¨ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œæ‹·è´åˆ°socketç¼“å†²åŒº</li><li>DMAæ§åˆ¶å™¨æŠŠæ•°æ®ä»socketç¼“å†²åŒºï¼Œæ‹·è´åˆ°ç½‘å¡è®¾å¤‡ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼ˆåˆ‡æ¢4ï¼‰</strong>ï¼Œwriteå‡½æ•°è¿”å›</li></ul><p>ä»æµç¨‹å›¾å¯ä»¥çœ‹å‡ºï¼Œä¼ ç»ŸIOçš„è¯»å†™æµç¨‹ï¼ŒåŒ…æ‹¬äº†4æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆ4æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼‰ï¼Œ4æ¬¡æ•°æ®æ‹·è´ï¼ˆ<strong>ä¸¤æ¬¡CPUæ‹·è´ä»¥åŠä¸¤æ¬¡çš„DMAæ‹·è´</strong>)ã€‚</p><p><strong>mmap+writeå®ç°çš„é›¶æ‹·è´</strong></p><p>mmap çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>addrï¼šæŒ‡å®šæ˜ å°„çš„è™šæ‹Ÿå†…å­˜åœ°å€</li><li>lengthï¼šæ˜ å°„çš„é•¿åº¦</li><li>protï¼šæ˜ å°„å†…å­˜çš„ä¿æŠ¤æ¨¡å¼</li><li>flagsï¼šæŒ‡å®šæ˜ å°„çš„ç±»å‹</li><li>fd:è¿›è¡Œæ˜ å°„çš„æ–‡ä»¶å¥æŸ„</li><li>offset:æ–‡ä»¶åç§»é‡</li></ul><p>mmapä½¿ç”¨äº†<strong>è™šæ‹Ÿå†…å­˜</strong>ï¼Œå¯ä»¥æŠŠå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†åœ°å€ï¼Œä»è€Œå‡å°‘æ•°æ®æ‹·è´æ¬¡æ•°ï¼</p><p><code>mmap+write</code>å®ç°çš„é›¶æ‹·è´æµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="`+va+`" alt="image-20220618222136120" tabindex="0" loading="lazy"><figcaption>image-20220618222136120</figcaption></figure><ul><li>ç”¨æˆ·è¿›ç¨‹é€šè¿‡ <code>mmapæ–¹æ³•</code>å‘æ“ä½œç³»ç»Ÿå†…æ ¸å‘èµ·IOè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€</strong>ã€‚</li><li>CPUåˆ©ç”¨DMAæ§åˆ¶å™¨ï¼ŒæŠŠæ•°æ®ä»ç¡¬ç›˜ä¸­æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</li><li><strong>ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€</strong>ï¼Œmmapæ–¹æ³•è¿”å›ã€‚</li><li>ç”¨æˆ·è¿›ç¨‹é€šè¿‡ <code>write</code>æ–¹æ³•å‘æ“ä½œç³»ç»Ÿå†…æ ¸å‘èµ·IOè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€</strong>ã€‚</li><li>CPUå°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°çš„socketç¼“å†²åŒºã€‚</li><li>CPUåˆ©ç”¨DMAæ§åˆ¶å™¨ï¼ŒæŠŠæ•°æ®ä»socketç¼“å†²åŒºæ‹·è´åˆ°ç½‘å¡ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€</strong>ï¼Œwriteè°ƒç”¨è¿”å›ã€‚</li></ul><p>å¯ä»¥å‘ç°ï¼Œ<code>mmap+write</code>å®ç°çš„é›¶æ‹·è´ï¼ŒI/Oå‘ç”Ÿäº†<strong>4</strong>æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ3æ¬¡æ•°æ®æ‹·è´ã€‚å…¶ä¸­3æ¬¡æ•°æ®æ‹·è´ä¸­ï¼ŒåŒ…æ‹¬äº†<strong>2æ¬¡DMAæ‹·è´å’Œ1æ¬¡CPUæ‹·è´</strong>ã€‚</p><p><code>mmap</code>æ˜¯å°†è¯»ç¼“å†²åŒºçš„åœ°å€å’Œç”¨æˆ·ç¼“å†²åŒºçš„åœ°å€è¿›è¡Œæ˜ å°„ï¼Œå†…æ ¸ç¼“å†²åŒºå’Œåº”ç”¨ç¼“å†²åŒºå…±äº«ï¼Œæ‰€ä»¥èŠ‚çœäº†ä¸€æ¬¡CPUæ‹·è´â€˜â€™å¹¶ä¸”ç”¨æˆ·è¿›ç¨‹å†…å­˜æ˜¯<strong>è™šæ‹Ÿçš„</strong>ï¼Œåªæ˜¯<strong>æ˜ å°„</strong>åˆ°å†…æ ¸çš„è¯»ç¼“å†²åŒºï¼Œå¯ä»¥èŠ‚çœä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚</p><p><strong>sendfileå®ç°çš„é›¶æ‹·è´</strong></p><p><code>sendfile</code>æ˜¯Linux2.1å†…æ ¸ç‰ˆæœ¬åå¼•å…¥çš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼ŒAPIå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>out_fd:ä¸ºå¾…å†™å…¥å†…å®¹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€ä¸ªsocketæè¿°ç¬¦ã€‚ï¼Œ</li><li>in_fd:ä¸ºå¾…è¯»å‡ºå†…å®¹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¿…é¡»æ˜¯çœŸå®çš„æ–‡ä»¶ï¼Œä¸èƒ½æ˜¯socketå’Œç®¡é“ã€‚</li><li>offsetï¼šæŒ‡å®šä»è¯»å…¥æ–‡ä»¶çš„å“ªä¸ªä½ç½®å¼€å§‹è¯»ï¼Œå¦‚æœä¸ºNULLï¼Œè¡¨ç¤ºæ–‡ä»¶çš„é»˜è®¤èµ·å§‹ä½ç½®ã€‚</li><li>countï¼šæŒ‡å®šåœ¨fdoutå’Œfdinä¹‹é—´ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚</li></ul><p>sendfileè¡¨ç¤ºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œå®ƒæ˜¯åœ¨<strong>æ“ä½œç³»ç»Ÿå†…æ ¸</strong>ä¸­æ“ä½œçš„ï¼Œ<strong>é¿å…äº†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„æ‹·è´æ“ä½œ</strong>ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å®ƒæ¥å®ç°é›¶æ‹·è´ã€‚</p><p>sendfileå®ç°çš„é›¶æ‹·è´æµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="`+ba+'" alt="image-20220618222201604" tabindex="0" loading="lazy"><figcaption>image-20220618222201604</figcaption></figure><p>sendfileå®ç°çš„é›¶æ‹·è´</p><ol><li>ç”¨æˆ·è¿›ç¨‹å‘èµ·sendfileç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ï¼ˆåˆ‡æ¢1ï¼‰ä»ç”¨æˆ·æ€è½¬å‘å†…æ ¸æ€</strong></li><li>DMAæ§åˆ¶å™¨ï¼ŒæŠŠæ•°æ®ä»ç¡¬ç›˜ä¸­æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</li><li>CPUå°†è¯»ç¼“å†²åŒºä¸­æ•°æ®æ‹·è´åˆ°socketç¼“å†²åŒº</li><li>DMAæ§åˆ¶å™¨ï¼Œå¼‚æ­¥æŠŠæ•°æ®ä»socketç¼“å†²åŒºæ‹·è´åˆ°ç½‘å¡ï¼Œ</li><li><strong>ä¸Šä¸‹æ–‡ï¼ˆåˆ‡æ¢2ï¼‰ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€</strong>ï¼Œsendfileè°ƒç”¨è¿”å›ã€‚</li></ol><p>å¯ä»¥å‘ç°ï¼Œ<code>sendfile</code>å®ç°çš„é›¶æ‹·è´ï¼ŒI/Oå‘ç”Ÿäº†<strong>2</strong>æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ3æ¬¡æ•°æ®æ‹·è´ã€‚å…¶ä¸­3æ¬¡æ•°æ®æ‹·è´ä¸­ï¼ŒåŒ…æ‹¬äº†<strong>2æ¬¡DMAæ‹·è´å’Œ1æ¬¡CPUæ‹·è´</strong>ã€‚é‚£èƒ½ä¸èƒ½æŠŠCPUæ‹·è´çš„æ¬¡æ•°å‡å°‘åˆ°0æ¬¡å‘¢ï¼Ÿæœ‰çš„ï¼Œå³ <code>å¸¦æœ‰DMAæ”¶é›†æ‹·è´åŠŸèƒ½çš„sendfile</code>ï¼</p><p><strong>sendfile+DMA scatter/gatherå®ç°çš„é›¶æ‹·è´</strong></p><p>linux 2.4ç‰ˆæœ¬ä¹‹åï¼Œå¯¹ <code>sendfile</code>åšäº†ä¼˜åŒ–å‡çº§ï¼Œå¼•å…¥SG-DMAæŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯å¯¹DMAæ‹·è´åŠ å…¥äº† <code>scatter/gather</code>æ“ä½œï¼Œå®ƒå¯ä»¥ç›´æ¥ä»å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­å°†æ•°æ®è¯»å–åˆ°ç½‘å¡ã€‚ä½¿ç”¨è¿™ä¸ªç‰¹ç‚¹æé›¶æ‹·è´ï¼Œå³è¿˜å¯ä»¥å¤šçœå»<strong>ä¸€æ¬¡CPUæ‹·è´</strong>ã€‚</p><p>sendfile+DMA scatter/gatherå®ç°çš„é›¶æ‹·è´æµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="'+ha+'" alt="image-20220618222223377" tabindex="0" loading="lazy"><figcaption>image-20220618222223377</figcaption></figure><ol><li>ç”¨æˆ·è¿›ç¨‹å‘èµ·sendfileç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>ä¸Šä¸‹æ–‡ï¼ˆåˆ‡æ¢1ï¼‰ä»ç”¨æˆ·æ€è½¬å‘å†…æ ¸æ€</strong></li><li>DMAæ§åˆ¶å™¨ï¼ŒæŠŠæ•°æ®ä»ç¡¬ç›˜ä¸­æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºã€‚</li><li>CPUæŠŠå†…æ ¸ç¼“å†²åŒºä¸­çš„<strong>æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯</strong>ï¼ˆåŒ…æ‹¬å†…æ ¸ç¼“å†²åŒºçš„å†…å­˜åœ°å€å’Œåç§»é‡ï¼‰å‘é€åˆ°socketç¼“å†²åŒº</li><li>DMAæ§åˆ¶å™¨æ ¹æ®æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ï¼Œç›´æ¥æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç½‘å¡</li><li><strong>ä¸Šä¸‹æ–‡ï¼ˆåˆ‡æ¢2ï¼‰ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€</strong>ï¼Œsendfileè°ƒç”¨è¿”å›ã€‚</li></ol><p>å¯ä»¥å‘ç°ï¼Œ<code>sendfile+DMA scatter/gather</code>å®ç°çš„é›¶æ‹·è´ï¼ŒI/Oå‘ç”Ÿäº†<strong>2</strong>æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ2æ¬¡æ•°æ®æ‹·è´ã€‚å…¶ä¸­2æ¬¡æ•°æ®æ‹·è´éƒ½æ˜¯åŒ…<strong>DMAæ‹·è´</strong>ã€‚è¿™å°±æ˜¯çœŸæ­£çš„ <strong>é›¶æ‹·è´ï¼ˆZero-copy)</strong> æŠ€æœ¯ï¼Œå…¨ç¨‹éƒ½æ²¡æœ‰é€šè¿‡CPUæ¥æ¬è¿æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é€šè¿‡DMAæ¥è¿›è¡Œä¼ è¾“çš„ã€‚</p><p><strong>Java NIOé›¶æ‹·è´</strong></p><p>åœ¨ Java NIO ä¸­çš„<strong>é€šé“ï¼ˆChannelï¼‰*<em>å°±ç›¸å½“äºæ“ä½œç³»ç»Ÿçš„*<em>å†…æ ¸ç©ºé—´</em></em>ï¼ˆkernel spaceï¼‰çš„ç¼“å†²åŒºï¼Œè€Œ</strong>ç¼“å†²åŒº**ï¼ˆBufferï¼‰å¯¹åº”çš„ç›¸å½“äºæ“ä½œç³»ç»Ÿçš„<strong>ç”¨æˆ·ç©ºé—´</strong>ï¼ˆuser spaceï¼‰ä¸­çš„<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆuser bufferï¼‰ã€‚</p><ul><li><strong>é€šé“</strong>ï¼ˆChannelï¼‰æ˜¯å…¨åŒå·¥çš„ï¼ˆåŒå‘ä¼ è¾“ï¼‰ï¼Œå®ƒæ—¢å¯èƒ½æ˜¯è¯»ç¼“å†²åŒºï¼ˆread bufferï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯ç½‘ç»œç¼“å†²åŒºï¼ˆsocket bufferï¼‰ã€‚</li><li><strong>ç¼“å†²åŒº</strong>ï¼ˆBufferï¼‰åˆ†ä¸ºå †å†…å­˜ï¼ˆHeapBufferï¼‰å’Œå †å¤–å†…å­˜ï¼ˆDirectBufferï¼‰ï¼Œè¿™æ˜¯é€šè¿‡ malloc() åˆ†é…å‡ºæ¥çš„ç”¨æˆ·æ€å†…å­˜ã€‚</li></ul><p>å †å¤–å†…å­˜ï¼ˆDirectBufferï¼‰åœ¨ä½¿ç”¨åéœ€è¦åº”ç”¨ç¨‹åºæ‰‹åŠ¨å›æ”¶ï¼Œè€Œå †å†…å­˜ï¼ˆHeapBufferï¼‰çš„æ•°æ®åœ¨ GC æ—¶å¯èƒ½ä¼šè¢«è‡ªåŠ¨å›æ”¶ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ HeapBuffer è¯»å†™æ•°æ®æ—¶ï¼Œä¸ºäº†é¿å…ç¼“å†²åŒºæ•°æ®å› ä¸º GC è€Œä¸¢å¤±ï¼ŒNIO ä¼šå…ˆæŠŠ HeapBuffer å†…éƒ¨çš„æ•°æ®æ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶çš„ DirectBuffer ä¸­çš„æœ¬åœ°å†…å­˜ï¼ˆnative memoryï¼‰ï¼Œè¿™ä¸ªæ‹·è´æ¶‰åŠåˆ° <code>sun.misc.Unsafe.copyMemory()</code> çš„è°ƒç”¨ï¼ŒèƒŒåçš„å®ç°åŸç†ä¸ <code>memcpy()</code> ç±»ä¼¼ã€‚ æœ€åï¼Œå°†ä¸´æ—¶ç”Ÿæˆçš„ DirectBuffer å†…éƒ¨çš„æ•°æ®çš„å†…å­˜åœ°å€ä¼ ç»™ I/O è°ƒç”¨å‡½æ•°ï¼Œè¿™æ ·å°±é¿å…äº†å†å»è®¿é—® Java å¯¹è±¡å¤„ç† I/O è¯»å†™ã€‚</p><p>1ï¸âƒ£ <strong>MappedByteBuffer</strong> æ˜¯ NIO åŸºäº**å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰**è¿™ç§é›¶æ‹·è´æ–¹å¼çš„æä¾›çš„ä¸€ç§å®ç°ï¼Œå®ƒç»§æ‰¿è‡ª ByteBufferã€‚FileChannel å®šä¹‰äº†ä¸€ä¸ª map() æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶ä» position ä½ç½®å¼€å§‹çš„ size å¤§å°çš„åŒºåŸŸæ˜ å°„ä¸ºå†…å­˜æ˜ åƒæ–‡ä»¶ã€‚</p><p>2ï¸âƒ£ <strong>DirectByteBuffer</strong> çš„å¯¹è±¡å¼•ç”¨ä½äº Java å†…å­˜æ¨¡å‹çš„å †é‡Œé¢ï¼ŒJVM å¯ä»¥å¯¹ DirectByteBuffer çš„å¯¹è±¡è¿›è¡Œå†…å­˜åˆ†é…å’Œå›æ”¶ç®¡ç†ï¼Œä¸€èˆ¬ä½¿ç”¨ DirectByteBuffer çš„é™æ€æ–¹æ³• allocateDirect() åˆ›å»º DirectByteBuffer å®ä¾‹å¹¶åˆ†é…å†…å­˜ã€‚</p><p>3ï¸âƒ£ <strong>FileChannel</strong> æ˜¯ä¸€ä¸ªç”¨äºæ–‡ä»¶è¯»å†™ã€æ˜ å°„å’Œæ“ä½œçš„é€šé“ï¼ŒåŒæ—¶å®ƒåœ¨å¹¶å‘ç¯å¢ƒä¸‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŸºäº FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile çš„ getChannel() æ–¹æ³•å¯ä»¥åˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶é€šé“ã€‚FileChannel å®šä¹‰äº† transferFrom() å’Œ transferTo() ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒé€šè¿‡åœ¨é€šé“å’Œé€šé“ä¹‹é—´å»ºç«‹è¿æ¥å®ç°æ•°æ®ä¼ è¾“çš„ã€‚</p><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" aria-hidden="true">#</a> è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong>: å¥½çš„ï¼æˆ‘æ˜ç™½äº†ï¼é‚£ä½ å†è¯´ä¸€ä¸‹ï¼š <strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</strong>ã€‚</p><p>ğŸ™‹ <strong>æˆ‘ï¼š</strong> å¥½çš„ï¼ ä¸‹å›¾æ˜¯ Java å†…å­˜åŒºåŸŸï¼Œæˆ‘ä»¬ä» JVM çš„è§’åº¦æ¥è¯´ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„å…³ç³»å§ï¼</p><figure><img src="'+fa+'" alt="image-20220404173153591" tabindex="0" loading="lazy"><figcaption>image-20220404173153591</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº (JDK1.8 ä¹‹åçš„å…ƒç©ºé—´)**èµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„**ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong> å’Œ <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ã€‚</p><p><strong>æ€»ç»“ï¼š</strong> çº¿ç¨‹æ˜¯è¿›ç¨‹åˆ’åˆ†æˆçš„æ›´å°çš„è¿è¡Œå•ä½,ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºåŸºæœ¬ä¸Šå„è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œå„çº¿ç¨‹åˆ™ä¸ä¸€å®šï¼Œå› ä¸ºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ææœ‰å¯èƒ½ä¼šç›¸äº’å½±å“ã€‚çº¿ç¨‹æ‰§è¡Œå¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºçš„ç®¡ç†å’Œä¿æŠ¤ï¼›è€Œè¿›ç¨‹æ­£ç›¸å</p><blockquote><p>å“ªäº›èµ„æºæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå“ªäº›æ˜¯çº¿ç¨‹ç‹¬å çš„ï¼Ÿ(2022å­—èŠ‚æå‰æ‰¹)</p></blockquote><p>çº¿ç¨‹å…±äº«å…¨å±€å˜é‡ï¼Œç‹¬å å±€éƒ¨å˜é‡</p><blockquote><p>ä½¿ç”¨çº¿ç¨‹æœ‰å“ªäº›å¥½å¤„ï¼Ÿ</p></blockquote><p>ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·å°ï¼Œé€šä¿¡æ–¹ä¾¿</p><blockquote><p>ä½¿ç”¨çº¿ç¨‹æœ‰å“ªäº›åå¤„ï¼Ÿ</p></blockquote><p>èµ„æºåŒæ­¥éº»çƒ¦ï¼Œå®¹æ˜“å‡ºé”™</p><blockquote><p>è¿›ç¨‹æœ‰å“ªäº›åŒæ­¥çš„æœºåˆ¶ï¼Ÿ</p></blockquote><p>ä¸´ç•ŒåŒºã€äº’æ–¥ã€ä¿¡å·é‡ã€äº‹ä»¶</p><h3 id="åç¨‹çš„å®ç°åŸç†-æ— æ ˆåç¨‹å’Œæœ‰æ ˆåç¨‹-ç‹¬ç«‹æ ˆå’Œå…±äº«æ ˆ" tabindex="-1"><a class="header-anchor" href="#åç¨‹çš„å®ç°åŸç†-æ— æ ˆåç¨‹å’Œæœ‰æ ˆåç¨‹-ç‹¬ç«‹æ ˆå’Œå…±äº«æ ˆ" aria-hidden="true">#</a> åç¨‹çš„å®ç°åŸç†ï¼Ÿæ— æ ˆåç¨‹å’Œæœ‰æ ˆåç¨‹ï¼Ÿç‹¬ç«‹æ ˆå’Œå…±äº«æ ˆï¼Ÿ</h3><p>åç¨‹æœ¬è´¨æ˜¯ä¸€ä¸ªç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œé€šè¿‡è·³è½¬æ¥å®ç°</p><p>æœ‰æ ˆåç¨‹æŠŠå±€éƒ¨å˜é‡æ”¾åœ¨æ–°å¼€çš„ç©ºé—´ä¸Šï¼Œæ— æ ˆåç¨‹ç›´æ¥ä½¿ç”¨ç³»ç»Ÿæ ˆä½¿å¾—CPU cacheå±€éƒ¨æ€§æ›´å¥½ï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—æ— æ ˆåç¨‹çš„ä¸­æ–­å’Œå‡½æ•°è¿”å›å‡ ä¹æ²¡æœ‰åŒºåˆ«</p><p>é€šè¿‡ç‹¬ç«‹æ ˆå®ç°çš„åç¨‹åº“ä¸­çš„æ¯ä¸€ä¸ªåç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œåç¨‹æ ˆå¤§å°å›ºå®šä¸”äº’ä¸å¹²æ‰°ã€‚</p><p>é€šè¿‡å…±äº«æ ˆå®ç°çš„åç¨‹åº“ä¸­çš„æ¯ä¸€ä¸ªåç¨‹åœ¨è¿è¡Œæ—¶éƒ½ä½¿ç”¨ä¸€ä¸ªå…¬å…±çš„æ ˆç©ºé—´ï¼Œå½“åç¨‹æŒ‚èµ·æ—¶å°†è‡ªå·±çš„æ•°æ®ä»å…±äº«æ ˆæ‹·è´åˆ°è‡ªå·±çš„ç‹¬ç«‹æ ˆï¼Œåç¨‹è¿è¡Œæ—¶åˆå°†æ•°æ®ä»ç‹¬ç«‹æ ˆæ‹·è´åˆ°å…±äº«æ ˆè¿è¡Œ</p><h3 id="ã€é«˜é¢‘ã€‘è¿›ç¨‹çº¿ç¨‹éƒ½æ€ä¹ˆé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ã€é«˜é¢‘ã€‘è¿›ç¨‹çº¿ç¨‹éƒ½æ€ä¹ˆé€šä¿¡" aria-hidden="true">#</a> ã€é«˜é¢‘ã€‘è¿›ç¨‹çº¿ç¨‹éƒ½æ€ä¹ˆé€šä¿¡</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>è¿›ç¨‹é—´çš„é€šä¿¡å¸¸è§çš„çš„æœ‰å“ªå‡ ç§æ–¹å¼å‘¢?</strong></p><p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå¤§æ¦‚æœ‰ 7 ç§å¸¸è§çš„è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ã€‚</p>',87),oo={href:"https://www.jianshu.com/p/c1015f5ffa74",target:"_blank",rel:"noopener noreferrer"},io=t('<ol><li><strong>ç®¡é“/åŒ¿åç®¡é“(Pipes)</strong> ï¼šç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„çˆ¶å­è¿›ç¨‹é—´æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li><li><strong>æœ‰åç®¡é“(Names Pipes)</strong> : åŒ¿åç®¡é“ç”±äºæ²¡æœ‰åå­—ï¼Œåªèƒ½ç”¨äºäº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œæå‡ºäº†æœ‰åç®¡é“ã€‚æœ‰åç®¡é“ä¸¥æ ¼éµå¾ª<strong>å…ˆè¿›å…ˆå‡º(first in first out)</strong>ã€‚æœ‰åç®¡é“ä»¥ç£ç›˜æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼Œå¯ä»¥å®ç°æœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ã€‚</li><li><strong>ä¿¡å·(Signal)</strong> ï¼šä¿¡å·æ˜¯ä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿï¼›</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—(Message Queuing)</strong> ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾è¡¨,å…·æœ‰ç‰¹å®šçš„æ ¼å¼,å­˜æ”¾åœ¨å†…å­˜ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„é€šä¿¡æ•°æ®éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ã€‚ä¸ç®¡é“ï¼ˆæ— åç®¡é“ï¼šåªå­˜åœ¨äºå†…å­˜ä¸­çš„æ–‡ä»¶ï¼›å‘½åç®¡é“ï¼šå­˜åœ¨äºå®é™…çš„ç£ç›˜ä»‹è´¨æˆ–è€…æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸åŒçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œåªæœ‰åœ¨å†…æ ¸é‡å¯(å³ï¼Œæ“ä½œç³»ç»Ÿé‡å¯)æˆ–è€…æ˜¾å¼åœ°åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œè¯¥æ¶ˆæ¯é˜Ÿåˆ—æ‰ä¼šè¢«çœŸæ­£çš„åˆ é™¤ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢,æ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–,ä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–.æ¯” FIFO æ›´æœ‰ä¼˜åŠ¿ã€‚<strong>æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­— èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ã€‚</strong></li><li><strong>ä¿¡å·é‡(Semaphores)</strong> ï¼šä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œä¿¡å·é‡çš„æ„å›¾åœ¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä¸»è¦ç”¨äºè§£å†³ä¸åŒæ­¥ç›¸å…³çš„é—®é¢˜å¹¶é¿å…ç«äº‰æ¡ä»¶ã€‚</li><li><strong>å…±äº«å†…å­˜(Shared memory)</strong> ï¼šä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œä¸åŒè¿›ç¨‹å¯ä»¥åŠæ—¶çœ‹åˆ°å¯¹æ–¹è¿›ç¨‹ä¸­å¯¹å…±äº«å†…å­˜ä¸­æ•°æ®çš„æ›´æ–°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä¾é æŸç§åŒæ­¥æ“ä½œï¼Œå¦‚äº’æ–¥é”å’Œä¿¡å·é‡ç­‰ã€‚å¯ä»¥è¯´è¿™æ˜¯æœ€æœ‰ç”¨çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</li><li><strong>å¥—æ¥å­—(Sockets)</strong> : æ­¤æ–¹æ³•ä¸»è¦ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å¥—æ¥å­—æ˜¯æ”¯æŒ TCP/IP çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸åŒä¸»æœºä¹‹é—´çš„è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹ï¼Œç®€å•çš„è¯´å°±æ˜¯é€šä¿¡çš„ä¸¤æ–¹çš„ä¸€ç§çº¦å®šï¼Œç”¨å¥—æ¥å­—ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆé€šä¿¡è¿‡ç¨‹ã€‚</li></ol><h3 id="çº¿ç¨‹ä¹‹é—´å¦‚ä½•å®ç°é€šä¿¡-æœ‰æ²¡æœ‰ç”¨åˆ°è¿‡-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹ä¹‹é—´å¦‚ä½•å®ç°é€šä¿¡-æœ‰æ²¡æœ‰ç”¨åˆ°è¿‡-2022å­—èŠ‚" aria-hidden="true">#</a> çº¿ç¨‹ä¹‹é—´å¦‚ä½•å®ç°é€šä¿¡ï¼Œæœ‰æ²¡æœ‰ç”¨åˆ°è¿‡ï¼Ÿ ï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>ç®¡é“ï¼Œä¿¡å·é‡ï¼Œå…±äº«å†…å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¥—æ¥å­—é€šä¿¡</p><h3 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åšäº†å“ªäº›äº‹-æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åšäº†å“ªäº›äº‹-æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„-2022å­—èŠ‚" aria-hidden="true">#</a> è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åšäº†å“ªäº›äº‹ï¼Ÿæµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>ä¿å­˜è™šæ‹Ÿå†…å­˜ï¼Œæ ˆï¼Œå¯„å­˜å™¨ï¼Œç¨‹åºè®¡æ•°å™¨ç­‰</p><p>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡æ“ä½œç³»ç»Ÿä»ä¸€ä¸ªè¿›ç¨‹è½¬æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œéœ€è¦å°†å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿç§°è¿›ç¨‹æ§åˆ¶å—ï¼‰ä¿å­˜èµ·æ¥ï¼Œå¹¶æ¢å¤ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¿è¯ç¨‹åºèƒ½å¤Ÿæ­£ç¡®è¿è¡Œã€‚</p><p>è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åŒ…æ‹¬äº†è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ã€å†…å­˜æ˜ åƒã€æ–‡ä»¶æ‰“å¼€è¡¨ã€å†…æ ¸æ ˆã€è¿›ç¨‹IDç­‰ç­‰ã€‚åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡</li></ol><p>å½“æ“ä½œç³»ç»Ÿéœ€è¦åˆ‡æ¢è¿›ç¨‹æ—¶ï¼Œä¼šå…ˆå°†å½“å‰è¿›ç¨‹çš„æ‰€æœ‰å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€å†…å­˜æ˜ åƒç­‰çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°è¯¥è¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ä¸­ã€‚è¿™æ ·ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œè¯¥è¿›ç¨‹æ—¶ï¼Œå°±å¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚</p><ol start="2"><li>æ‰§è¡Œè¿›ç¨‹è°ƒåº¦</li></ol><p>æ“ä½œç³»ç»Ÿä¼šä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå°†å…¶è®¾ç½®ä¸ºå½“å‰è¿›ç¨‹ï¼Œå¹¶å°†è¯¥è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä»è¿›ç¨‹æ§åˆ¶å—ä¸­æ¢å¤ã€‚</p><ol start="3"><li>æ¢å¤æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡</li></ol><p>æ“ä½œç³»ç»Ÿä¼šå°†æ–°è¿›ç¨‹çš„æ‰€æœ‰å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€å†…å­˜æ˜ åƒç­‰çŠ¶æ€ä¿¡æ¯ä»è¿›ç¨‹æ§åˆ¶å—ä¸­æ¢å¤ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºå½“å‰è¿›ç¨‹ã€‚è¿™æ ·ï¼Œæ–°è¿›ç¨‹å°±å¯ä»¥ä»ä¸Šæ¬¡æ‰§è¡Œçš„çŠ¶æ€ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p><ol start="4"><li>åˆ‡æ¢å†…æ ¸æ ˆ</li></ol><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…æ ¸æ ˆï¼Œç”¨äºä¿å­˜å†…æ ¸æ€çš„å‡½æ•°è°ƒç”¨æ ˆã€‚åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿè¿˜éœ€è¦åˆ‡æ¢å†…æ ¸æ ˆï¼Œä»¥ä¿è¯å½“å‰è¿›ç¨‹å’Œæ–°è¿›ç¨‹éƒ½èƒ½æ­£å¸¸ä½¿ç”¨è‡ªå·±çš„å†…æ ¸æ ˆã€‚</p><ol start="5"><li>æ¢å¤ç”¨æˆ·æ€æ‰§è¡Œ</li></ol><p>è¿›ç¨‹åˆ‡æ¢å®Œæˆåï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ§åˆ¶æƒäº¤è¿˜ç»™ç”¨æˆ·æ€ï¼Œè®©æ–°è¿›ç¨‹å¼€å§‹æ‰§è¡Œç”¨æˆ·æ€çš„ç¨‹åºã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œå¤šä»»åŠ¡è°ƒåº¦å’Œèµ„æºç®¡ç†çš„é‡è¦æ‰‹æ®µã€‚å®ƒçš„æµç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¿å­˜å’Œæ¢å¤å¤§é‡çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œèµ„æºã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œéœ€è¦å°½å¯èƒ½åœ°å‡å°‘è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</p><blockquote><p>è¿›ç¨‹åœ¨å“ªäº›åœºæ™¯ä¼šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</p></blockquote><p>æ—¶é—´ç‰‡åˆ°äº†ï¼ŒIO å µå¡</p><p>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡ä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œéœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œæ¢å¤å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ã€‚è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li>æ—¶é—´ç‰‡è½®è½¬</li></ol><p>åœ¨æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°†æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‰‡ï¼Œåœ¨æ—¶é—´ç‰‡ç”¨å®Œåï¼Œæ“ä½œç³»ç»Ÿå°†è¯¥è¿›ç¨‹æŒ‚èµ·å¹¶ä¿å­˜å…¶ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‰§è¡Œä¸‹ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°è¿›ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p><ol start="2"><li>I/Oæ“ä½œ</li></ol><p>å½“ä¸€ä¸ªè¿›ç¨‹æ‰§è¡ŒI/Oæ“ä½œæ—¶ï¼ŒI/Oè®¾å¤‡çš„å¤„ç†é€Ÿåº¦æ¯”CPUå¿«ï¼Œæ‰€ä»¥è¿›ç¨‹ä¼šç­‰å¾…I/Oæ“ä½œå®Œæˆï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šæŒ‚èµ·è¯¥è¿›ç¨‹å¹¶æ‰§è¡Œå…¶ä»–è¿›ç¨‹ã€‚å½“I/Oæ“ä½œå®Œæˆåï¼Œæ“ä½œç³»ç»Ÿå°†è¯¥è¿›ç¨‹æ¢å¤å¹¶ç»§ç»­æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ¶‰åŠåˆ°è¿›ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p><ol start="3"><li>å¤šè¿›ç¨‹åä½œ</li></ol><p>åœ¨å¤šè¿›ç¨‹åä½œçš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´éœ€è¦è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ã€‚å½“ä¸€ä¸ªè¿›ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¿¡å·æˆ–æ¶ˆæ¯æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŒ‚èµ·è¯¥è¿›ç¨‹å¹¶æ‰§è¡Œå…¶ä»–è¿›ç¨‹ã€‚å½“ç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿåï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¯¥è¿›ç¨‹æ¢å¤å¹¶ç»§ç»­æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿéœ€è¦è¿›ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p><ol start="4"><li>ç³»ç»Ÿè°ƒç”¨</li></ol><p>å½“ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¿›ç¨‹ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå¹¶å°†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¿å­˜åœ¨å†…æ ¸æ ˆä¸­ã€‚åœ¨ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œå®Œæ¯•åï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¿›ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œå¹¶æ¢å¤è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿéœ€è¦è¿›ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚</p><blockquote><p>ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ºä»€ä¹ˆèµ„æºæ¶ˆè€—ä¼šæ¯”è¾ƒé«˜ï¼Ÿæ¶ˆè€—åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</p></blockquote><p>è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚</p><p>ä¸Šé¢å“ªä¸ªèµ„æºçš„åˆ‡æ¢æ•ˆç‡æ›´ä½ï¼Ÿ</p><p>è™šæ‹Ÿå†…å­˜</p><p>ä¸ºä»€ä¹ˆè™šæ‹Ÿå†…å­˜çš„åˆ‡æ¢æ•ˆç‡æ›´ä½ï¼Ÿ</p><p>å› ä¸ºåˆ‡æ¢å TLB æ— æ³•è¢«å‘½ä¸­</p><h3 id="è¿›ç¨‹çš„çŠ¶æ€-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹çš„çŠ¶æ€-2022å­—èŠ‚" aria-hidden="true">#</a> è¿›ç¨‹çš„çŠ¶æ€ï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š é‚£ä½ å†è¯´è¯´<strong>è¿›ç¨‹æœ‰å“ªå‡ ç§çŠ¶æ€?</strong></p>',37),co=n("strong",null,"æˆ‘",-1),lo={href:"https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/Multithread/JavaConcurrencyBasicsCommonInterviewQuestionsSummary.md#6-%E8%AF%B4%E8%AF%B4%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E7%8A%B6%E6%80%81",target:"_blank",rel:"noopener noreferrer"},ro=t('<p>å¾ˆåƒï¼</p><ul><li><strong>åˆ›å»ºçŠ¶æ€(new)</strong> ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œå°šæœªåˆ°å°±ç»ªçŠ¶æ€ã€‚</li><li><strong>å°±ç»ªçŠ¶æ€(ready)</strong> ï¼šè¿›ç¨‹å·²å¤„äºå‡†å¤‡è¿è¡ŒçŠ¶æ€ï¼Œå³è¿›ç¨‹è·å¾—äº†é™¤äº†å¤„ç†å™¨ä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†å™¨èµ„æº(å¤„ç†å™¨åˆ†é…çš„æ—¶é—´ç‰‡)å³å¯è¿è¡Œã€‚</li><li><strong>è¿è¡ŒçŠ¶æ€(running)</strong> ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šä¸Šè¿è¡Œ(å•æ ¸ CPU ä¸‹ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€)ã€‚</li><li><strong>é˜»å¡çŠ¶æ€(waiting)</strong> ï¼šåˆç§°ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œå¦‚ç­‰å¾…æŸèµ„æºä¸ºå¯ç”¨æˆ–ç­‰å¾… IO æ“ä½œå®Œæˆã€‚å³ä½¿å¤„ç†å™¨ç©ºé—²ï¼Œè¯¥è¿›ç¨‹ä¹Ÿä¸èƒ½è¿è¡Œã€‚</li><li><strong>ç»“æŸçŠ¶æ€(terminated)</strong> ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±ã€‚å¯èƒ½æ˜¯è¿›ç¨‹æ­£å¸¸ç»“æŸæˆ–å…¶ä»–åŸå› ä¸­æ–­é€€å‡ºè¿è¡Œã€‚</li></ul><blockquote><p>è®¢æ­£ï¼šä¸‹å›¾ä¸­ running çŠ¶æ€è¢« interrupt å‘ ready çŠ¶æ€è½¬æ¢çš„ç®­å¤´æ–¹å‘åäº†ã€‚</p></blockquote><figure><img src="'+ya+'" alt="image-20220404173240800" tabindex="0" loading="lazy"><figcaption>image-20220404173240800</figcaption></figure><h3 id="äº†è§£æ“ä½œç³»ç»Ÿçš„é”å—-è®²è®²æ“ä½œç³»ç»Ÿå®ç°é”çš„åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#äº†è§£æ“ä½œç³»ç»Ÿçš„é”å—-è®²è®²æ“ä½œç³»ç»Ÿå®ç°é”çš„åº•å±‚åŸç†" aria-hidden="true">#</a> äº†è§£æ“ä½œç³»ç»Ÿçš„é”å—ï¼Ÿè®²è®²æ“ä½œç³»ç»Ÿå®ç°é”çš„åº•å±‚åŸç†</h3><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œé”æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºé˜²æ­¢å¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºè€Œå¯¼è‡´çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚åœ¨å®ç°é”çš„åº•å±‚åŸç†ä¸­ï¼Œæœ€å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨åŸå­æ“ä½œå’Œç¡¬ä»¶æŒ‡ä»¤ã€‚</p><p>åŸå­æ“ä½œæ˜¯æŒ‡ä¸€ç»„æ“ä½œè¢«çœ‹ä½œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ“ä½œå•å…ƒï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¸èƒ½åªæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨ä½¿ç”¨é”æ—¶ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸¤ç§æ–¹å¼ï¼šè‡ªæ—‹é”å’Œäº’æ–¥é”ã€‚è‡ªæ—‹é”æ˜¯ä¸€ç§å¿™ç­‰å¾…çš„é”ï¼Œå³å½“çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™çº¿ç¨‹ä¼šä¸æ–­åœ°è¿›è¡Œè‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚è€Œäº’æ–¥é”åˆ™æ˜¯ä¸€ç§é˜»å¡å¼çš„é”ï¼Œå³å½“çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p><p>åœ¨åº•å±‚å®ç°ä¸­ï¼Œè‡ªæ—‹é”å’Œäº’æ–¥é”çš„å®ç°æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒã€‚è‡ªæ—‹é”é€šå¸¸ä½¿ç”¨åŸå­æ“ä½œå®ç°ï¼Œè€Œäº’æ–¥é”é€šå¸¸ä½¿ç”¨ä¿¡å·é‡æˆ–è€…äº’æ–¥é‡æ¥å®ç°ï¼Œä¿¡å·é‡æˆ–äº’æ–¥é‡æ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯åœ¨ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œé”çš„å®ç°åº•å±‚åŸç†æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„åŸå­æ“ä½œã€ç¡¬ä»¶æŒ‡ä»¤ã€ä¿¡å·é‡å’Œäº’æ–¥é‡ç­‰å¤šæ–¹é¢çš„çŸ¥è¯†ã€‚</p><h3 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼æ€ä¹ˆç†è§£-ä¸¾ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼æ€ä¹ˆç†è§£-ä¸¾ä¸ªä¾‹å­" aria-hidden="true">#</a> ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼æ€ä¹ˆç†è§£ï¼Œä¸¾ä¸ªä¾‹å­</h3><p>ä¸‹é¢æˆ‘ä»¬åˆ©ç”¨ä¿¡å·é‡å’Œ PV æ“ä½œæ¥è§£å†³ç»å…¸çš„è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥é—®é¢˜ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ã€‚</p><p>ã€é—®é¢˜æè¿°ã€‘ï¼šç³»ç»Ÿä¸­æœ‰ä¸€ç»„ç”Ÿäº§è€…è¿›ç¨‹å’Œä¸€ç»„æ¶ˆè´¹è€…è¿›ç¨‹ï¼Œç”Ÿäº§è€…è¿›ç¨‹æ¯æ¬¡ç”Ÿäº§ä¸€ä¸ªäº§å“æ”¾å…¥ç¼“å†²åŒºï¼Œæ¶ˆè´¹è€…è¿›ç¨‹æ¯æ¬¡ä»ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªäº§å“å¹¶ä½¿ç”¨ã€‚ä»»ä½•æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…å¯ä»¥è®¿é—®ç¼“å†²åŒºã€‚</p><figure><img src="'+wa+'" alt="image-20220607144016086" tabindex="0" loading="lazy"><figcaption>image-20220607144016086</figcaption></figure><p>ç”±é¢˜å¯çŸ¥ï¼Œç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å…±äº«ä¸€ä¸ªåˆå§‹ä¸ºç©ºã€å¤§å°ä¸º n çš„ç¼“å†²åŒºï¼Œæˆ‘ä»¬ä»é¢˜ç›®ä¸­æç‚¼å‡ºåŒæ­¥ä¸äº’æ–¥å…³ç³»ï¼š</p><ul><li>åŒæ­¥å…³ç³» 1ï¼šåªæœ‰ç¼“å†²åŒºæ²¡æ»¡æ—¶ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œç”Ÿäº§è€…æ‰èƒ½æŠŠäº§å“æ”¾å…¥ç¼“å†²åŒºï¼ˆä¼˜å…ˆçº§ä½ï¼‰ï¼Œå¦åˆ™å¿…é¡»ç­‰å¾…</li><li>åŒæ­¥å…³ç³» 2ï¼šåªæœ‰ç¼“å†²åŒºä¸ç©ºæ—¶ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œæ¶ˆè´¹è€…æ‰èƒ½ä»ä¸­å–å‡ºäº§å“ï¼ˆä¼˜å…ˆçº§ä½ï¼‰ï¼Œå¦åˆ™å¿…é¡»ç­‰å¾…</li><li>äº’æ–¥å…³ç³»ï¼šç¼“å†²åŒºæ˜¯ä¸´ç•Œèµ„æºï¼Œå„è¿›ç¨‹å¿…é¡»äº’æ–¥åœ°è®¿é—®ã€‚</li></ul><p>æ—¢ç„¶è¿™ä¸ªé¢˜ç›®æœ‰ä¸¤ä¸ªåŒæ­¥å…³ç³»å’Œä¸€ä¸ªäº’æ–¥å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸¤ä¸ªåŒæ­¥ä¿¡å·é‡å’Œä¸€ä¸ªäº’æ–¥ä¿¡å·é‡ï¼š</p><ul><li>emptyï¼šåŒæ­¥ä¿¡å·é‡ï¼ˆå¯¹åº”åŒæ­¥å…³ç³» 1ï¼‰ï¼Œè¡¨ç¤ºç”Ÿäº§è€…è¿˜èƒ½ç”Ÿäº§å¤šå°‘ï¼Œå³è¿˜èƒ½æ”¾å…¥ç¼“å†²åŒºå¤šå°‘äº§å“ï¼Œè¯¥æ•°é‡å°äºç­‰äº 0ï¼Œåˆ™ç”Ÿäº§è€…ä¸èƒ½è¿›è¡Œç”Ÿäº§ã€‚ åˆå§‹åŒ–ä¸º nã€‚</li><li>fullï¼šåŒæ­¥ä¿¡å·é‡ï¼ˆå¯¹åº”åŒæ­¥å…³ç³» 2ï¼‰ï¼Œè¡¨ç¤ºæ¶ˆè´¹è€…è¿˜èƒ½ä»ç¼“å†²åŒºå–å‡ºå¤šå°‘ï¼Œå³å½“å‰ç¼“å†²åŒºå·²æœ‰äº§å“çš„æ•°é‡ï¼Œè¯¥æ•°é‡å°äºç­‰äº 0ï¼Œåˆ™æ¶ˆè´¹è€…ä¸èƒ½è¿›è¡Œè¯»å–ã€‚åˆå§‹åŒ–ä¸º 0ã€‚</li><li>mutexï¼šäº’æ–¥ä¿¡å·é‡ï¼Œå®ç°å¯¹ç¼“å†²åŒºçš„äº’æ–¥è®¿é—®ã€‚åˆå§‹åŒ–ä¸º 1ã€‚</li></ul><p>ä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„å„ä¸ª PV æ“ä½œçš„é…å¯¹ï¼š</p><figure><img src="'+Ca+'" alt="image-20220607144024751" tabindex="0" loading="lazy"><figcaption>image-20220607144024751</figcaption></figure><h3 id="è¿›ç¨‹è°ƒåº¦æœ‰å“ªäº›ç®—æ³•-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹è°ƒåº¦æœ‰å“ªäº›ç®—æ³•-2022å­—èŠ‚" aria-hidden="true">#</a> è¿›ç¨‹è°ƒåº¦æœ‰å“ªäº›ç®—æ³•ï¼Ÿï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>ä½ çŸ¥é“æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•æœ‰å“ªäº›å—?</strong></p><p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå—¯å—¯ï¼è¿™ä¸ªæˆ‘ä»¬å¤§å­¦çš„æ—¶å€™å­¦è¿‡ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ï¼</p><p>ä¸ºäº†ç¡®å®šé¦–å…ˆæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥åŠæœ€åæ‰§è¡Œå“ªä¸ªè¿›ç¨‹ä»¥å®ç°æœ€å¤§ CPU åˆ©ç”¨ç‡ï¼Œè®¡ç®—æœºç§‘å­¦å®¶å·²ç»å®šä¹‰äº†ä¸€äº›ç®—æ³•ï¼Œå®ƒä»¬æ˜¯ï¼š</p><ul><li><strong>å…ˆåˆ°å…ˆæœåŠ¡(FCFS)è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li><li><strong>çŸ­ä½œä¸šä¼˜å…ˆ(SJF)çš„è°ƒåº¦ç®—æ³•</strong> : ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ä¸ºä¹‹åˆ†é…èµ„æºï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå ç”¨ CPU æ—¶å†é‡æ–°è°ƒåº¦ã€‚</li><li><strong>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</strong> : æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦æ˜¯ä¸€ç§æœ€å¤è€ï¼Œæœ€ç®€å•ï¼Œæœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•ï¼Œåˆç§° RR(Round robin)è°ƒåº¦ã€‚æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ï¼Œå³è¯¥è¿›ç¨‹å…è®¸è¿è¡Œçš„æ—¶é—´ã€‚</li><li><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong> ï¼šå‰é¢ä»‹ç»çš„å‡ ç§è¿›ç¨‹è°ƒåº¦çš„ç®—æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚å¦‚<strong>çŸ­è¿›ç¨‹ä¼˜å…ˆçš„è°ƒåº¦ç®—æ³•ï¼Œä»…ç…§é¡¾äº†çŸ­è¿›ç¨‹è€Œå¿½ç•¥äº†é•¿è¿›ç¨‹</strong> ã€‚å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•æ—¢èƒ½ä½¿é«˜ä¼˜å…ˆçº§çš„ä½œä¸šå¾—åˆ°å“åº”åˆèƒ½ä½¿çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰è¿…é€Ÿå®Œæˆã€‚ï¼Œå› è€Œå®ƒæ˜¯ç›®å‰<strong>è¢«å…¬è®¤çš„ä¸€ç§è¾ƒå¥½çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•</strong>ï¼ŒUNIX æ“ä½œç³»ç»Ÿé‡‡å–çš„ä¾¿æ˜¯è¿™ç§è°ƒåº¦ç®—æ³•ã€‚</li><li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong> ï¼š ä¸ºæ¯ä¸ªæµç¨‹åˆ†é…ä¼˜å…ˆçº§ï¼Œé¦–å…ˆæ‰§è¡Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œä¾æ­¤ç±»æ¨ã€‚å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹ä»¥ FCFS æ–¹å¼æ‰§è¡Œã€‚å¯ä»¥æ ¹æ®å†…å­˜è¦æ±‚ï¼Œæ—¶é—´è¦æ±‚æˆ–ä»»ä½•å…¶ä»–èµ„æºè¦æ±‚æ¥ç¡®å®šä¼˜å…ˆçº§ã€‚</li></ul><p>ç»†åˆ†</p><hr><p><strong>æ‰¹å¤„ç†ç³»ç»Ÿ</strong></p><details open=""><summary>å…ˆæ¥å…ˆæœåŠ¡ first-come first-serverdï¼ˆFCFSï¼‰</summary><p dir="auto">æŒ‰ç…§è¯·æ±‚çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚éæŠ¢å å¼ï¼Œå¼€é”€å°ï¼Œæ— é¥¥é¥¿é—®é¢˜ï¼Œå“åº”æ—¶é—´ä¸ç¡®å®šï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰ï¼›</p><p dir="auto">å¯¹çŸ­è¿›ç¨‹ä¸åˆ©ï¼Œå¯¹IOå¯†é›†å‹è¿›ç¨‹ä¸åˆ©ã€‚</p></details><details open=""><summary>æœ€çŸ­ä½œä¸šä¼˜å…ˆ shortest job firstï¼ˆSJFï¼‰</summary><p dir="auto">æŒ‰ä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚éæŠ¢å å¼ï¼Œååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´é¥¥é¥¿é—®é¢˜ï¼›</p><p dir="auto">å¯¹çŸ­è¿›ç¨‹æä¾›å¥½çš„å“åº”æ—¶é—´ï¼Œå¯¹é•¿è¿›ç¨‹ä¸åˆ©ã€‚</p></details><details open=""><summary>æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ shortest remaining time nextï¼ˆSRTNï¼‰</summary><p dir="auto">æŒ‰å‰©ä½™è¿è¡Œæ—¶é—´çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚(æœ€çŸ­ä½œä¸šä¼˜å…ˆçš„æŠ¢å å¼ç‰ˆæœ¬)ã€‚ååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œæä¾›å¥½çš„å“åº”æ—¶é—´ï¼›</p><p dir="auto">å¯èƒ½å¯¼è‡´é¥¥é¥¿é—®é¢˜ï¼Œå¯¹é•¿è¿›ç¨‹ä¸åˆ©ã€‚</p></details><details open=""><summary>æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ Highest Response Ratio Nextï¼ˆHRRNï¼‰</summary><p dir="auto">å“åº”æ¯” = 1+ ç­‰å¾…æ—¶é—´/å¤„ç†æ—¶é—´ã€‚åŒæ—¶è€ƒè™‘äº†ç­‰å¾…æ—¶é—´çš„é•¿çŸ­å’Œä¼°è®¡éœ€è¦çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­ï¼Œå¾ˆå¥½çš„å¹³è¡¡äº†é•¿çŸ­è¿›ç¨‹ã€‚éæŠ¢å ï¼Œååé‡é«˜ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œæä¾›å¥½çš„å“åº”æ—¶é—´ï¼Œæ— é¥¥é¥¿é—®é¢˜ã€‚</p></details><p><strong>äº¤äº’å¼ç³»ç»Ÿ</strong> äº¤äº’å¼ç³»ç»Ÿæœ‰å¤§é‡çš„ç”¨æˆ·äº¤äº’æ“ä½œï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­è°ƒåº¦ç®—æ³•çš„ç›®æ ‡æ˜¯å¿«é€Ÿåœ°è¿›è¡Œå“åº”ã€‚</p><details open=""><summary>æ—¶é—´ç‰‡è½®è½¬ Round Robin</summary><p dir="auto">å°†æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ FCFS çš„åŸåˆ™æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨å®Œæ—¶é—´ç‰‡çš„è¿›ç¨‹æ’åˆ°é˜Ÿåˆ—æœ€åã€‚æŠ¢å å¼ï¼ˆæ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼‰ï¼Œå¼€é”€å°ï¼Œæ— é¥¥é¥¿é—®é¢˜ï¼Œä¸ºçŸ­è¿›ç¨‹æä¾›å¥½çš„å“åº”æ—¶é—´ï¼›</p><p dir="auto">è‹¥æ—¶é—´ç‰‡å°ï¼Œè¿›ç¨‹åˆ‡æ¢é¢‘ç¹ï¼Œååé‡ä½ï¼›è‹¥æ—¶é—´ç‰‡å¤ªé•¿ï¼Œå®æ—¶æ€§å¾—ä¸åˆ°ä¿è¯ã€‚</p></details><details open=""><summary>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</summary><p dir="auto">ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªä¼˜å…ˆçº§ï¼ŒæŒ‰ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ã€‚ä¸ºäº†é˜²æ­¢ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œç­‰ä¸åˆ°è°ƒåº¦ï¼Œå¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ç­‰å¾…è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p></details><details open=""><summary>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³• Multilevel Feedback Queue</summary><p dir="auto">è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—1ã€2ã€3...ï¼Œä¼˜å…ˆçº§é€’å‡ï¼Œæ—¶é—´ç‰‡é€’å¢ã€‚åªæœ‰ç­‰åˆ°ä¼˜å…ˆçº§æ›´é«˜çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶æ‰ä¼šè°ƒåº¦å½“å‰é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹ç”¨å®Œäº†å½“å‰é˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¿˜æœªæ‰§è¡Œå®Œï¼Œåˆ™ä¼šè¢«ç§»åˆ°ä¸‹ä¸€é˜Ÿåˆ—ã€‚</p><p dir="auto">æŠ¢å å¼ï¼ˆæ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼‰ï¼Œå¼€é”€å¯èƒ½è¾ƒå¤§ï¼Œå¯¹IOå‹è¿›ç¨‹æœ‰åˆ©ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿é—®é¢˜ã€‚</p></details>',36),uo=t('<p>åˆ†ä¸ºæ¶ˆæ¯ä¼ é€’æ¨¡å‹å’Œå…±äº«å†…å­˜æ¨¡å‹</p><p>ä¸Šæ–‡</p><h3 id="è¿›ç¨‹åŒæ­¥æœ‰å‡ ç§æ–¹å¼-æ»´æ»´-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#è¿›ç¨‹åŒæ­¥æœ‰å‡ ç§æ–¹å¼-æ»´æ»´-2022å­—èŠ‚" aria-hidden="true">#</a> è¿›ç¨‹åŒæ­¥æœ‰å‡ ç§æ–¹å¼ï¼Ÿï¼ˆæ»´æ»´ï¼Œ2022å­—èŠ‚ï¼‰</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼š<strong>é‚£çº¿ç¨‹é—´çš„åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›å‘¢?</strong></p><p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šçº¿ç¨‹åŒæ­¥æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªå…±äº«å…³é”®èµ„æºçš„çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œã€‚åº”è¯¥åŒæ­¥çº¿ç¨‹ä»¥é¿å…å…³é”®çš„èµ„æºä½¿ç”¨å†²çªã€‚æ“ä½œç³»ç»Ÿä¸€èˆ¬æœ‰ä¸‹é¢ä¸‰ç§çº¿ç¨‹åŒæ­¥çš„æ–¹å¼ï¼š</p><ol><li><strong>äº’æ–¥é‡(Mutex)</strong>ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚æ¯”å¦‚ Java ä¸­çš„ synchronized å…³é”®è¯å’Œå„ç§ Lock éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚</li><li><strong>ä¿¡å·é‡(Semaphore)</strong> ï¼šå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚</li><li><strong>äº‹ä»¶(Event)</strong> :Wait/Notifyï¼šé€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿çš„å®ç°å¤šçº¿ç¨‹ä¼˜å…ˆçº§çš„æ¯”è¾ƒæ“ä½œã€‚</li></ol><h3 id="å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹çš„åŒºåˆ«" aria-hidden="true">#</a> å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</h3><p><strong>å­¤å„¿è¿›ç¨‹</strong>ï¼šä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p><p><strong>åƒµå°¸è¿›ç¨‹</strong>ï¼šä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜-è™¾çš®" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼ˆè™¾çš®ï¼‰</h3><p><code>è™šæ‹Ÿå†…å­˜ï¼Œæ˜¯è™šæ‹Ÿå‡ºæ¥çš„å†…å­˜ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç¡®ä¿æ¯ä¸ªç¨‹åºæ‹¥æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œåœ°å€ç©ºé—´è¢«åˆ†æˆå¤šä¸ªå—ï¼Œæ¯ä¸€å—éƒ½æœ‰è¿ç»­çš„åœ°å€ç©ºé—´ã€‚åŒæ—¶ç‰©ç†ç©ºé—´ä¹Ÿåˆ†æˆå¤šä¸ªå—ï¼Œå—å¤§å°å’Œè™šæ‹Ÿåœ°å€ç©ºé—´çš„å—å¤§å°ä¸€è‡´ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°ç‰©ç†åœ°å€ç©ºé—´ï¼Œç¨‹åºåªéœ€å…³æ³¨è™šæ‹Ÿå†…å­˜ï¼Œè¯·æ±‚çš„ä¹Ÿæ˜¯è™šæ‹Ÿå†…å­˜ï¼ŒçœŸæ­£ä½¿ç”¨å´æ˜¯ç‰©ç†å†…å­˜ã€‚</code></p><p>ç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨<strong>è™šæ‹Ÿå†…å­˜</strong>ï¼Œå³è™šæ‹Ÿåœ°å€å–ä»£ç‰©ç†åœ°å€ï¼Œä½¿ç”¨è™šæ‹Ÿå†…å­˜å¯ä»¥æœ‰2ä¸ªå¥½å¤„ï¼š</p><ul><li>è™šæ‹Ÿå†…å­˜ç©ºé—´å¯ä»¥è¿œè¿œå¤§äºç‰©ç†å†…å­˜ç©ºé—´</li><li>å¤šä¸ªè™šæ‹Ÿå†…å­˜å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†åœ°å€</li></ul><p>é›¶æ‹·è´å®ç°æ€æƒ³ï¼Œå°±åˆ©ç”¨äº†<strong>è™šæ‹Ÿå†…å­˜</strong>è¿™ä¸ªç‚¹ï¼šå¤šä¸ªè™šæ‹Ÿå†…å­˜å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†åœ°å€ï¼Œå¯ä»¥æŠŠå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†åœ°å€ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å‡å°‘IOçš„æ•°æ®æ‹·è´æ¬¡æ•°å•¦ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="'+Sa+'" alt="image-20220618221642375" tabindex="0" loading="lazy"><figcaption>image-20220618221642375</figcaption></figure><h3 id="äº†è§£æ­»é”å—-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#äº†è§£æ­»é”å—-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> äº†è§£æ­»é”å—ï¼Ÿï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h3><p>å¦‚æœç³»ç»Ÿä¸­ä»¥ä¸‹å››ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹ï¼Œé‚£ä¹ˆå°±èƒ½å¼•èµ·æ­»é”ï¼š</p><ul><li><strong>äº’æ–¥</strong>ï¼šèµ„æºå¿…é¡»å¤„äºéå…±äº«æ¨¡å¼ï¼Œå³ä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨ã€‚å¦‚æœå¦ä¸€è¿›ç¨‹ç”³è¯·è¯¥èµ„æºï¼Œé‚£ä¹ˆå¿…é¡»ç­‰å¾…ç›´åˆ°è¯¥èµ„æºè¢«é‡Šæ”¾ä¸ºæ­¢ã€‚</li><li><strong>å æœ‰å¹¶ç­‰å¾…</strong>ï¼šä¸€ä¸ªè¿›ç¨‹è‡³å°‘åº”è¯¥å æœ‰ä¸€ä¸ªèµ„æºï¼Œå¹¶ç­‰å¾…å¦ä¸€èµ„æºï¼Œè€Œè¯¥èµ„æºè¢«å…¶ä»–è¿›ç¨‹æ‰€å æœ‰ã€‚</li><li><strong>éæŠ¢å </strong>ï¼šèµ„æºä¸èƒ½è¢«æŠ¢å ã€‚åªèƒ½åœ¨æŒæœ‰èµ„æºçš„è¿›ç¨‹å®Œæˆä»»åŠ¡åï¼Œè¯¥èµ„æºæ‰ä¼šè¢«é‡Šæ”¾ã€‚</li><li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šæœ‰ä¸€ç»„ç­‰å¾…è¿›ç¨‹ <code>{P0, P1,..., Pn}</code>ï¼Œ <code>P0</code> ç­‰å¾…çš„èµ„æºè¢« <code>P1</code> å æœ‰ï¼Œ<code>P1</code> ç­‰å¾…çš„èµ„æºè¢« <code>P2</code> å æœ‰ï¼Œ......ï¼Œ<code>Pn-1</code> ç­‰å¾…çš„èµ„æºè¢« <code>Pn</code> å æœ‰ï¼Œ<code>Pn</code> ç­‰å¾…çš„èµ„æºè¢« <code>P0</code> å æœ‰ã€‚</li></ul><p>æ³¨æ„ï¼Œåªæœ‰å››ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹æ—¶ï¼Œæ­»é”æ‰ä¼šå‡ºç°ã€‚</p><blockquote><p>å¹³æ—¶é‡åˆ°è¿‡æ­»é”å—ï¼Œæ€ä¹ˆè§£å†³çš„</p></blockquote><ul><li>æ”¶é›†æ­»é”ä¿¡æ¯ï¼š <ol><li>åˆ©ç”¨å‘½ä»¤ <code>SHOW ENGINE INNODB STATUS</code>æŸ¥çœ‹æ­»é”åŸå› ã€‚</li><li>è°ƒè¯•é˜¶æ®µå¼€å¯ innodb_print_all_deadlocksï¼Œæ”¶é›†æ‰€æœ‰æ­»é”æ—¥å¿—ã€‚</li></ol></li><li>å‡å°‘æ­»é”ï¼š <ol><li>ä½¿ç”¨äº‹åŠ¡ï¼Œä¸ä½¿ç”¨ <code>lock tables</code> ã€‚</li><li>ä¿è¯æ²¡æœ‰é•¿äº‹åŠ¡ã€‚</li><li>æ“ä½œå®Œä¹‹åç«‹å³æäº¤äº‹åŠ¡ï¼Œç‰¹åˆ«æ˜¯åœ¨äº¤äº’å¼å‘½ä»¤è¡Œä¸­ã€‚</li><li>å¦‚æœåœ¨ç”¨ <code>(SELECT ... FOR UPDATE or SELECT ... LOCK IN SHARE MODE)</code>ï¼Œå°è¯•é™ä½éš”ç¦»çº§åˆ«ã€‚</li><li>ä¿®æ”¹å¤šä¸ªè¡¨æˆ–è€…å¤šä¸ªè¡Œçš„æ—¶å€™ï¼Œ<code>å°†ä¿®æ”¹çš„é¡ºåºä¿æŒä¸€è‡´</code>ã€‚</li><li>åˆ›å»ºç´¢å¼•ï¼Œå¯ä»¥ä½¿åˆ›å»ºçš„é”æ›´å°‘ã€‚</li><li>æœ€å¥½ä¸è¦ç”¨ <code>(SELECT ... FOR UPDATE or SELECT ... LOCK IN SHARE MODE)</code>ã€‚</li><li>å¦‚æœä¸Šè¿°éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°è¯•ä½¿ç”¨ <code>lock tables t1, t2, t3</code> é”å¤šå¼ è¡¨</li></ol></li></ul><h3 id="selectã€pollã€epoll-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#selectã€pollã€epoll-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> selectã€pollã€epollï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><figure><img src="'+xa+'" alt="image-20220727205646242" tabindex="0" loading="lazy"><figcaption>image-20220727205646242</figcaption></figure><h3 id="epollçš„ä¸¤ç§è§¦å‘æ¨¡å¼-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#epollçš„ä¸¤ç§è§¦å‘æ¨¡å¼-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> epollçš„ä¸¤ç§è§¦å‘æ¨¡å¼ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>level æ¨¡å¼ï¼šè¯¥æ¨¡å¼å°±æ˜¯åªè¦è¿˜æœ‰æ²¡æœ‰å¤„ç†çš„äº‹ä»¶å°±ä¼šä¸€ç›´é€šçŸ¥ edge æ¨¡å¼ï¼šè¯¥æ¨¡å¼æ˜¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé€šçŸ¥</p><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨è™šæ‹Ÿå†…å­˜-2022å­—èŠ‚æå‰æ‰¹ã€2022è”šæ¥æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨è™šæ‹Ÿå†…å­˜-2022å­—èŠ‚æå‰æ‰¹ã€2022è”šæ¥æå‰æ‰¹" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ç”¨è™šæ‹Ÿå†…å­˜ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ã€2022è”šæ¥æå‰æ‰¹ï¼‰</h3><ol><li>å°†ä¸»å­˜å½“ä½œè¾…å­˜çš„é«˜é€Ÿç¼“å­˜ï¼Œç»å¸¸æ´»åŠ¨çš„ä¸œè¥¿æ”¾åœ¨ä¸»å­˜ä¸­ï¼Œå°±åƒ GTA5 å‡ å GB å¤§çš„ä¸œè¥¿éƒ½æ”¾ä¸»å­˜ä¸­æ˜¯æ”¾ä¸ä¸‹çš„ï¼Œå› æ­¤å¯ä»¥é«˜æ•ˆåˆ©ç”¨ä¸»å­˜</li><li>æ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´éƒ½ä¸€æ ·ï¼Œæ–¹ä¾¿ç®¡ç†</li><li>é¿å…è¿›ç¨‹ç ´åå…¶ä»–è¿›ç¨‹çš„åœ°å€ç©ºé—´</li></ol><ul><li>è™šæ‹Ÿå†…å­˜ç©ºé—´å¯ä»¥è¿œè¿œå¤§äºç‰©ç†å†…å­˜ç©ºé—´</li><li>å¤šä¸ªè™šæ‹Ÿå†…å­˜å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç‰©ç†åœ°å€</li></ul><p>psï¼šæ€è€ƒè™šæ‹Ÿå†…å­˜å’Œäº¤æ¢ç©ºé—´çš„åŒºåˆ«ï¼Ÿ</p><h3 id="è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†åœ°å€çš„è¿‡ç¨‹-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†åœ°å€çš„è¿‡ç¨‹-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†åœ°å€çš„è¿‡ç¨‹ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>â¶ ç›´æ¥æ˜ å°„</p><figure><img src="'+_a+'" alt="image-20220727224105269" tabindex="0" loading="lazy"><figcaption>image-20220727224105269</figcaption></figure><p>ç›´æ¥æ˜ å°„æ˜¯é¡µè¡¨ç¼“å­˜æ˜ å°„ï¼ˆTLBï¼‰çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªç®€å•çš„å“ˆå¸Œå‡½æ•°å°†è™šæ‹Ÿé¡µå·æ˜ å°„åˆ° TLB ä¸­çš„ä¸€ä¸ªæ¡ç›®ã€‚</p><p>ä¸‹é¢æ˜¯ç›´æ¥æ˜ å°„çš„è¿‡ç¨‹ï¼š</p><ol><li>CPU å‘å‡ºä¸€ä¸ªè™šæ‹Ÿåœ°å€è¯·æ±‚ã€‚</li><li>MMU ä¸­çš„åœ°å€è½¬æ¢éƒ¨åˆ†ä»è™šæ‹Ÿåœ°å€ä¸­è·å–é¡µå·ã€‚</li><li>MMU ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†é¡µå·æ˜ å°„åˆ° TLB ä¸­çš„ä¸€ä¸ªæ¡ç›®ã€‚</li><li>å¦‚æœ TLB ä¸­å­˜åœ¨è¯¥æ¡ç›®ï¼Œåˆ™ MMU ç›´æ¥ä»è¯¥æ¡ç›®ä¸­è·å–ç‰©ç†åœ°å€ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å­˜å‚¨å™¨ç³»ç»Ÿè¿›è¡Œè®¿é—®ã€‚</li><li>å¦‚æœ TLB ä¸­ä¸å­˜åœ¨è¯¥æ¡ç›®ï¼Œåˆ™ MMU å‘é€ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼ˆPage Fault Exceptionï¼‰ç»™æ“ä½œç³»ç»Ÿã€‚</li><li>æ“ä½œç³»ç»Ÿä»ç£ç›˜ä¸­è¯»å–ç¼ºå¤±çš„é¡µé¢å¹¶å°†å…¶åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚</li><li>æ“ä½œç³»ç»Ÿæ›´æ–°é¡µè¡¨å¹¶å°†ç¼ºå¤±çš„é¡µè¡¨é¡¹å†™å…¥åˆ° TLB ä¸­ã€‚</li><li>MMU é‡æ–°æ‰§è¡Œåœ°å€è½¬æ¢ï¼Œå¹¶ä»æ›´æ–°åçš„ TLB æ¡ç›®ä¸­è·å–ç‰©ç†åœ°å€ã€‚</li><li>MMU å°†ç‰©ç†åœ°å€ä¼ é€’ç»™å­˜å‚¨å™¨ç³»ç»Ÿè¿›è¡Œè®¿é—®ï¼Œå¹¶å°†è®¿é—®ç»“æœè¿”å›ç»™ CPUã€‚</li></ol><p>ç›´æ¥æ˜ å°„çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ç¼ºç‚¹æ˜¯å®¹æ˜“å‡ºç°å†²çªï¼Œå› ä¸ºå¤šä¸ªè™šæ‹Ÿé¡µå·å¯èƒ½ä¼šè¢«æ˜ å°„åˆ°åŒä¸€ä¸ª TLB æ¡ç›®ä¸­ã€‚è¿™ä¼šå¯¼è‡´ TLB ä¸­çš„æŸäº›æ¡ç›®è¢«é¢‘ç¹æ›¿æ¢ï¼Œä»è€Œé™ä½ç¼“å­˜å‘½ä¸­ç‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„é¡µè¡¨ç¼“å­˜æ˜ å°„æ–¹æ¡ˆï¼Œå¦‚å…¨ç›¸è”æ˜ å°„æˆ–ç»„ç›¸è”æ˜ å°„ã€‚</p><p>â· ä½¿ç”¨é¡µè¡¨ç¼“å­˜æ˜ å°„</p><figure><img src="'+Ta+'" alt="image-20220727224111385" tabindex="0" loading="lazy"><figcaption>image-20220727224111385</figcaption></figure><ol><li>åº”ç”¨ç¨‹åºç”Ÿæˆè™šæ‹Ÿåœ°å€ã€‚</li><li>è™šæ‹Ÿåœ°å€è¢«ä¼ é€’ç»™ CPU ä¸­çš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€‚</li><li>MMU ä¸­çš„åœ°å€è½¬æ¢éƒ¨åˆ†å°†è™šæ‹Ÿåœ°å€çš„é¡µå·ä¸é¡µè¡¨ä¸­çš„é¡µè¡¨é¡¹è¿›è¡ŒåŒ¹é…ã€‚</li><li>å¦‚æœé¡µè¡¨é¡¹ä¸­å­˜åœ¨ç‰©ç†åœ°å€ï¼Œåˆ™å°†é¡µè¡¨é¡¹ä¸­çš„ç‰©ç†åœ°å€ä¸è™šæ‹Ÿåœ°å€ä¸­çš„é¡µå†…åç§»é‡ç»„åˆæˆæœ€ç»ˆçš„ç‰©ç†åœ°å€ã€‚</li><li>å¦‚æœé¡µè¡¨é¡¹ä¸å­˜åœ¨ï¼Œåˆ™å¼•å‘é¡µé”™è¯¯ï¼ˆPage Faultï¼‰ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä»ç£ç›˜ä¸­å°†è¯¥é¡µè°ƒå…¥ç‰©ç†å†…å­˜ï¼Œæ›´æ–°é¡µè¡¨ï¼Œç„¶åå†æ¬¡å°è¯•è®¿é—®è¯¥åœ°å€ã€‚</li><li>æœ€ç»ˆçš„ç‰©ç†åœ°å€è¢«ä¼ é€’ç»™å­˜å‚¨å™¨ç³»ç»Ÿï¼Œä»è€Œè®¿é—®æ‰€éœ€çš„æ•°æ®æˆ–æŒ‡ä»¤ã€‚</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒCPU é€šè¿‡ MMU æ¥è¿›è¡Œåœ°å€è½¬æ¢ï¼ŒæŠŠåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°å€ã€‚MMU å®ç°åœ°å€è½¬æ¢çš„æ–¹å¼æ˜¯é€šè¿‡é¡µè¡¨æ¥è¿›è¡Œçš„ï¼Œé¡µè¡¨æ˜¯ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤çš„æ•°æ®ç»“æ„ï¼Œå®ƒè®°å½•äº†è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€çš„å¯¹åº”å…³ç³»ã€‚</p><p>â¸ ä½¿ç”¨ TLB æ˜ å°„</p><figure><img src="'+Pa+'" alt="image-20220727224117545" tabindex="0" loading="lazy"><figcaption>image-20220727224117545</figcaption></figure><figure><img src="'+La+'" alt="image-20220727224120760" tabindex="0" loading="lazy"><figcaption>image-20220727224120760</figcaption></figure><p>ä½¿ç”¨ TLB æ˜ å°„çš„è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>CPU å‘å‡ºä¸€ä¸ªè™šæ‹Ÿåœ°å€è¯·æ±‚ã€‚</li><li>MMU ä¸­çš„åœ°å€è½¬æ¢éƒ¨åˆ†ä»è™šæ‹Ÿåœ°å€ä¸­è·å–é¡µå·ã€‚</li><li>MMU åœ¨ TLB ä¸­æŸ¥æ‰¾ä¸è¯¥è™šæ‹Ÿé¡µå·å¯¹åº”çš„ç‰©ç†é¡µå·ï¼Œå¹¶æ£€æŸ¥ TLB æ˜¯å¦å‘½ä¸­ã€‚</li><li>å¦‚æœ TLB å‘½ä¸­ï¼Œåˆ™ MMU ç›´æ¥ä» TLB ä¸­è·å–è¯¥è™šæ‹Ÿåœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å­˜å‚¨å™¨ç³»ç»Ÿè¿›è¡Œè®¿é—®ã€‚</li><li>å¦‚æœ TLB æœªå‘½ä¸­ï¼Œåˆ™ MMU å‘é€ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼ˆPage Fault Exceptionï¼‰ç»™æ“ä½œç³»ç»Ÿã€‚</li><li>æ“ä½œç³»ç»Ÿä»ç£ç›˜ä¸­è¯»å–ç¼ºå¤±çš„é¡µé¢å¹¶å°†å…¶åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚</li><li>æ“ä½œç³»ç»Ÿæ›´æ–°é¡µè¡¨å¹¶å°†ç¼ºå¤±çš„é¡µè¡¨é¡¹å†™å…¥åˆ° TLB ä¸­ã€‚</li><li>MMU é‡æ–°æ‰§è¡Œåœ°å€è½¬æ¢ï¼Œå¹¶ä»æ›´æ–°åçš„ TLB æ¡ç›®ä¸­è·å–ç‰©ç†åœ°å€ã€‚</li><li>MMU å°†ç‰©ç†åœ°å€ä¼ é€’ç»™å­˜å‚¨å™¨ç³»ç»Ÿè¿›è¡Œè®¿é—®ï¼Œå¹¶å°†è®¿é—®ç»“æœè¿”å›ç»™ CPUã€‚</li></ol><p>ä½¿ç”¨ TLB æ˜ å°„çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¯ä»¥åŠ å¿«è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢é€Ÿåº¦ï¼Œå› ä¸º TLB ä¸­å­˜å‚¨çš„æ˜¯æœ€è¿‘è®¿é—®è¿‡çš„é¡µè¡¨é¡¹ï¼Œå¯ä»¥ç›´æ¥è·å–ç‰©ç†åœ°å€ï¼Œè€Œä¸éœ€è¦å†å»è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ã€‚è¿™å¯ä»¥æ˜¾è‘—é™ä½è½¬æ¢çš„å»¶è¿Ÿï¼Œæé«˜è®¡ç®—æœºç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚æ­¤å¤–ï¼Œç”±äº TLB å¯ä»¥ç¼“å­˜æœ€è¿‘è®¿é—®è¿‡çš„é¡µè¡¨é¡¹ï¼Œå› æ­¤å®ƒè¿˜å¯ä»¥å‡å°‘å†…å­˜å¸¦å®½çš„å ç”¨ï¼Œä»è€Œä½¿è®¡ç®—æœºç³»ç»Ÿæ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨èµ„æºã€‚</p><h3 id="ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢éƒ½åšäº†ä»€ä¹ˆ-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢éƒ½åšäº†ä»€ä¹ˆ-2022è”šæ¥" aria-hidden="true">#</a> ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢éƒ½åšäº†ä»€ä¹ˆï¼Ÿï¼ˆ2022è”šæ¥ï¼‰</h3><p>åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ€å’Œå†…æ ¸æ€æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¸¤ç§è¿è¡Œæ¨¡å¼ã€‚å½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä»¬è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œè€Œå½“æ“ä½œç³»ç»Ÿå†…æ ¸æ‰§è¡Œæ—¶ï¼Œå®ƒä»¬è¿è¡Œåœ¨å†…æ ¸æ€ã€‚åœ¨è¿™ä¸¤ç§æ¨¡å¼ä¹‹é—´è¿›è¡Œåˆ‡æ¢æ—¶ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>ç”¨æˆ·æ€åˆ°å†…æ ¸æ€åˆ‡æ¢</li></ol><p>å½“åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œéœ€è¦ç‰¹æƒçº§åˆ«çš„æ“ä½œæ—¶ï¼Œä¾‹å¦‚ç³»ç»Ÿè°ƒç”¨ã€ä¸­æ–­å¤„ç†ã€å¼‚å¸¸å¤„ç†ç­‰ï¼Œéœ€è¦ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚åˆ‡æ¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ï¼Œå°†æ§åˆ¶æƒè½¬ç§»åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸ä¿å­˜åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ CPU å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆç­‰ç­‰ã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸æ‰§è¡Œéœ€è¦ç‰¹æƒçº§åˆ«çš„æ“ä½œï¼Œä¾‹å¦‚å¤„ç†ç³»ç»Ÿè°ƒç”¨è¯·æ±‚ã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸å°†ç»“æœè¿”å›ç»™åº”ç”¨ç¨‹åºã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸æ¢å¤åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬ç§»å›åº”ç”¨ç¨‹åºã€‚</li></ul><ol start="2"><li>å†…æ ¸æ€åˆ°ç”¨æˆ·æ€åˆ‡æ¢</li></ol><p>å½“æ“ä½œç³»ç»Ÿå†…æ ¸æ‰§è¡Œå®Œæˆï¼Œå¹¶éœ€è¦å°†æ§åˆ¶æƒè¿”å›ç»™åº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚åˆ‡æ¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿå†…æ ¸ä¿å­˜å½“å‰çš„å†…æ ¸ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ CPU å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆç­‰ç­‰ã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸å°†åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡æ¢å¤å›æ¥ã€‚</li><li>æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›åˆ°åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤çš„ä½ç½®ã€‚</li><li>åº”ç”¨ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li></ul><p>åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œç”±äºéœ€è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€ã€‚ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå°½å¯èƒ½åœ°ä¿æŒåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·æ€è¿è¡Œï¼Œåªåœ¨å¿…è¦æ—¶æ‰åˆ‡æ¢åˆ°å†…æ ¸æ€æ‰§è¡Œéœ€è¦ç‰¹æƒçº§åˆ«çš„æ“ä½œã€‚</p><h3 id="ä¸ºä»€ä¹ˆæœ‰ç”¨æˆ·æ€å’Œå†…æ ¸æ€-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæœ‰ç”¨æˆ·æ€å’Œå†…æ ¸æ€-2022è”šæ¥" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆæœ‰ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼ˆ2022è”šæ¥ï¼‰</h3><p>åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæœ‰ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><p>ç”¨æˆ·æ€æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€å¤„çš„ä¸€ç§çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€ä¸‹åº”ç”¨ç¨‹åºåªèƒ½è®¿é—®è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ— æ³•è®¿é—®æ“ä½œç³»ç»Ÿå†…æ ¸æˆ–å…¶ä»–è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚è¿™ç§é™åˆ¶æœ‰åŠ©äºé˜²æ­¢åº”ç”¨ç¨‹åºè¶Šæƒè®¿é—®ç³»ç»Ÿèµ„æºï¼Œä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><p>å†…æ ¸æ€æ˜¯æŒ‡æ“ä½œç³»ç»Ÿå†…æ ¸åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€å¤„çš„ä¸€ç§çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€ä¸‹æ“ä½œç³»ç»Ÿå†…æ ¸å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡ã€ç³»ç»Ÿå†…å­˜ã€è¿›ç¨‹ä¿¡æ¯ç­‰ç­‰ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç‰¹æƒçº§åˆ«é«˜äºåº”ç”¨ç¨‹åºï¼Œè¿™ä½¿å¾—æ“ä½œç³»ç»Ÿå†…æ ¸å¯ä»¥æ‰§è¡Œä¸€äº›éœ€è¦ç‰¹æ®Šæƒé™çš„æ“ä½œï¼Œä¾‹å¦‚ç®¡ç†ç³»ç»Ÿèµ„æºã€è°ƒåº¦è¿›ç¨‹ã€å¤„ç†ä¸­æ–­ç­‰ç­‰ã€‚è¿™ç§ç‰¹æƒçº§åˆ«çš„é™åˆ¶å¯ä»¥ä¿è¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¨³å®šæ€§ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå¯¹æ“ä½œç³»ç»Ÿçš„å½±å“ã€‚</p><p>é€šè¿‡å°†ç³»ç»Ÿåˆ†ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œå¯ä»¥å®ç°å¯¹ç³»ç»Ÿèµ„æºçš„ä¸¥æ ¼ç®¡ç†å’Œæ§åˆ¶ï¼Œä»è€Œä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œè¿™ç§é™åˆ¶ä¹Ÿèƒ½å¤Ÿä¿ƒè¿›æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„åˆ†ç¦»ï¼Œä½¿å¾—æ“ä½œç³»ç»Ÿçš„è®¾è®¡æ›´åŠ æ¸…æ™°å’Œæ¨¡å—åŒ–ï¼Œæœ‰åˆ©äºç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><h3 id="ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´åŒºåˆ«-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´åŒºåˆ«-2022è”šæ¥" aria-hidden="true">#</a> ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´åŒºåˆ«ï¼ˆ2022è”šæ¥ï¼‰</h3><p>ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´é€šå¸¸æ˜¯åˆ†å¼€çš„ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚ä¸‹é¢æ˜¯å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ï¼š</p><ol><li>ç”¨æˆ·æ€åœ°å€ç©ºé—´</li></ol><p>ç”¨æˆ·æ€åœ°å€ç©ºé—´æ˜¯æŒ‡åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€èƒ½è®¿é—®çš„å†…å­˜ç©ºé—´ã€‚å®ƒé€šå¸¸è¢«åˆ†ä¸ºå‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ä»£ç æ®µï¼šç”¨äºå­˜æ”¾åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œä»£ç ã€‚</li><li>æ•°æ®æ®µï¼šç”¨äºå­˜æ”¾åº”ç”¨ç¨‹åºçš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li><li>å †åŒºï¼šç”¨äºå­˜æ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œç”±åº”ç”¨ç¨‹åºè‡ªå·±ç®¡ç†ã€‚</li><li>æ ˆåŒºï¼šç”¨äºå­˜æ”¾å‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚</li></ul><p>ç”¨æˆ·æ€åœ°å€ç©ºé—´é€šå¸¸æ˜¯è¢«é™åˆ¶åœ¨åº”ç”¨ç¨‹åºè‡ªèº«çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ— æ³•è®¿é—®æ“ä½œç³»ç»Ÿå†…æ ¸æˆ–å…¶ä»–è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚è¿™ç§é™åˆ¶æœ‰åŠ©äºé˜²æ­¢åº”ç”¨ç¨‹åºè¶Šæƒè®¿é—®ç³»ç»Ÿèµ„æºï¼Œä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><ol><li>å†…æ ¸æ€åœ°å€ç©ºé—´</li></ol><p>å†…æ ¸æ€åœ°å€ç©ºé—´æ˜¯æŒ‡æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€èƒ½è®¿é—®çš„å†…å­˜ç©ºé—´ã€‚å®ƒé€šå¸¸åŒ…æ‹¬ï¼š</p><ul><li>å†…æ ¸ä»£ç æ®µï¼šç”¨äºå­˜æ”¾æ“ä½œç³»ç»Ÿå†…æ ¸çš„å¯æ‰§è¡Œä»£ç ã€‚</li><li>å†…æ ¸æ•°æ®æ®µï¼šç”¨äºå­˜æ”¾æ“ä½œç³»ç»Ÿå†…æ ¸çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</li><li>å†…æ ¸å †åŒºï¼šç”¨äºå­˜æ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸è‡ªå·±ç®¡ç†ã€‚</li><li>å†…æ ¸æ ˆåŒºï¼šç”¨äºå­˜æ”¾å†…æ ¸å‡½æ•°çš„å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚</li></ul><p>å†…æ ¸æ€åœ°å€ç©ºé—´é€šå¸¸åŒ…æ‹¬æ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰å†…å­˜ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¯ä»¥è®¿é—®ä»»ä½•è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œå…¶ä»–è¿›ç¨‹ã€‚ç”±äºæ“ä½œç³»ç»Ÿå†…æ ¸æœ‰ç‰¹æƒçº§åˆ«æ›´é«˜çš„æƒé™ï¼Œå› æ­¤å®ƒå¯ä»¥æ‰§è¡Œä¸€äº›éœ€è¦ç‰¹æ®Šæƒé™çš„æ“ä½œï¼Œä¾‹å¦‚ç®¡ç†ç³»ç»Ÿèµ„æºã€è°ƒåº¦è¿›ç¨‹ã€å¤„ç†ä¸­æ–­ç­‰ç­‰ã€‚è¿™ç§ç‰¹æƒçº§åˆ«çš„é™åˆ¶å¯ä»¥ä¿è¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¨³å®šæ€§ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå¯¹æ“ä½œç³»ç»Ÿçš„å½±å“ã€‚</p><h3 id="å†…å­˜4ä¸ªg-è™šæ‹Ÿå†…å­˜8ä¸ªg-æ•°æ®å­˜åœ¨å“ª-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#å†…å­˜4ä¸ªg-è™šæ‹Ÿå†…å­˜8ä¸ªg-æ•°æ®å­˜åœ¨å“ª-2022è”šæ¥" aria-hidden="true">#</a> å†…å­˜4ä¸ªGï¼Œè™šæ‹Ÿå†…å­˜8ä¸ªGï¼Œæ•°æ®å­˜åœ¨å“ªï¼ˆ2022è”šæ¥ï¼‰</h3><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å¯ä»¥åŒæ—¶å­˜åœ¨äºç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜ä¸­ï¼Œå…·ä½“å–å†³äºè¿›ç¨‹çš„éœ€æ±‚å’Œæ“ä½œç³»ç»Ÿçš„ç®¡ç†æ–¹å¼ã€‚</p><p>æ“ä½œç³»ç»Ÿé€šè¿‡è™šæ‹Ÿå†…å­˜æŠ€æœ¯å°†è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜æˆ–ç£ç›˜äº¤æ¢æ–‡ä»¶ä¸­ï¼Œä»¥æä¾›æ›´å¤§çš„å¯ç”¨åœ°å€ç©ºé—´ã€‚å½“è¿›ç¨‹éœ€è¦è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæŸ¥æ‰¾è¯¥åœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€æ˜¯å¦å·²ç»åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™å°†å…¶ä»ç£ç›˜äº¤æ¢æ–‡ä»¶ä¸­è¯»å…¥å†…å­˜ã€‚å¦‚æœç‰©ç†å†…å­˜å·²ç»è¢«å ç”¨ï¼Œåˆ™æ“ä½œç³»ç»Ÿä¼šä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•å°†æŸäº›ä¸å¸¸ç”¨çš„é¡µç½®æ¢åˆ°ç£ç›˜äº¤æ¢æ–‡ä»¶ä¸­ï¼Œä»¥è…¾å‡ºç‰©ç†å†…å­˜ç©ºé—´æ¥å­˜å‚¨æ–°çš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå½“è¿›ç¨‹è®¿é—®çš„æ•°æ®ä½äºå·²ç»è¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­çš„é¡µé¢æ—¶ï¼Œæ•°æ®å­˜åœ¨äºç‰©ç†å†…å­˜ä¸­ã€‚å½“è¿›ç¨‹è®¿é—®çš„æ•°æ®ä½äºå°šæœªè¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­çš„é¡µé¢æ—¶ï¼Œæ•°æ®å­˜åœ¨äºç£ç›˜äº¤æ¢æ–‡ä»¶ä¸­ã€‚æ— è®ºæ•°æ®å­˜åœ¨äºç‰©ç†å†…å­˜è¿˜æ˜¯ç£ç›˜äº¤æ¢æ–‡ä»¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šè´Ÿè´£å°†å…¶æ­£ç¡®åœ°æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ã€‚</p><h3 id="ä»€ä¹ˆæ ·çš„å†…å­˜è®¿é—®æ˜¯æ•ˆç‡æœ€é«˜çš„-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ ·çš„å†…å­˜è®¿é—®æ˜¯æ•ˆç‡æœ€é«˜çš„-2022è”šæ¥" aria-hidden="true">#</a> ä»€ä¹ˆæ ·çš„å†…å­˜è®¿é—®æ˜¯æ•ˆç‡æœ€é«˜çš„ï¼ˆ2022è”šæ¥ï¼‰</h3><p>åœ¨ç°ä»£è®¡ç®—æœºä¸­ï¼Œç¼“å­˜æ˜¯æé«˜å†…å­˜è®¿é—®æ•ˆç‡çš„å…³é”®ã€‚å› æ­¤ï¼Œå¯¹äºè®¿é—®æ•ˆç‡æœ€é«˜çš„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œåº”è¯¥æ˜¯èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åˆ©ç”¨ CPU ç¼“å­˜çš„è®¿é—®æ¨¡å¼ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œä»¥ä¸‹å‡ ç§å†…å­˜è®¿é—®æ¨¡å¼é€šå¸¸å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼š</p><ol><li>é¡ºåºè®¿é—®ï¼šé¡ºåºè®¿é—®æ˜¯æŒ‡ç¨‹åºæŒ‰é¡ºåºè®¿é—®å†…å­˜ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚éå†æ•°ç»„ã€å¾ªç¯è®¿é—®è¿ç»­å†…å­˜å—ç­‰ã€‚ç”±äºé¡ºåºè®¿é—®çš„å†…å­˜è®¿é—®æ¨¡å¼å…·æœ‰è‰¯å¥½çš„ç©ºé—´å±€éƒ¨æ€§å’Œæ—¶é—´å±€éƒ¨æ€§ï¼Œèƒ½å¤Ÿåˆ©ç”¨ CPU ç¼“å­˜çš„é¢„å–å’Œç¼“å­˜è¡Œå¡«å……æœºåˆ¶ï¼Œå› æ­¤è®¿é—®æ•ˆç‡è¾ƒé«˜ã€‚</li><li>å‘é‡åŒ–è®¿é—®ï¼šå‘é‡åŒ–è®¿é—®æ˜¯æŒ‡ç¨‹åºä»¥å‘é‡çš„å½¢å¼åŒæ—¶è®¿é—®å¤šä¸ªå†…å­˜ä½ç½®çš„æ•°æ®ï¼Œä¾‹å¦‚ä½¿ç”¨ SSEã€AVX ç­‰ SIMD æŒ‡ä»¤é›†è¿›è¡Œè®¡ç®—ã€‚ç”±äºå‘é‡åŒ–è®¿é—®èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ CPU çš„ SIMD å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œä»¥åŠ CPU ç¼“å­˜çš„é«˜é€Ÿé¢„å–å’Œå¡«å……æœºåˆ¶ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„è®¿é—®æ•ˆç‡ã€‚</li></ol><h3 id="é¡µé¢ç½®æ¢ç®—æ³•æœ‰å“ªäº›-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#é¡µé¢ç½®æ¢ç®—æ³•æœ‰å“ªäº›-2022è”šæ¥" aria-hidden="true">#</a> é¡µé¢ç½®æ¢ç®—æ³•æœ‰å“ªäº›ï¼ˆ2022è”šæ¥ï¼‰</h3><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šè™šæ‹Ÿå†…å­˜ç®¡ç†å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯é¡µé¢ç½®æ¢ç®—æ³•ã€‚é‚£ä½ è¯´ä¸€ä¸‹ <strong>é¡µé¢ç½®æ¢ç®—æ³•çš„ä½œç”¨?å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•æœ‰å“ªäº›?</strong></p><p>ğŸ™‹ <strong>æˆ‘</strong> ï¼š</p><blockquote><p>è¿™ä¸ªé¢˜ç›®ç»å¸¸ä½œä¸ºç¬”è¯•é¢˜å‡ºç°ï¼Œç½‘ä¸Šå·²ç»ç»™å‡ºäº†å¾ˆä¸é”™çš„å›ç­”ï¼Œæˆ‘è¿™é‡Œåªæ˜¯æ€»ç»“æ•´ç†äº†ä¸€ä¸‹ã€‚</p></blockquote><p>åœ°å€æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œè‹¥åœ¨é¡µé¢ä¸­å‘ç°æ‰€è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œåˆ™å‘ç”Ÿç¼ºé¡µä¸­æ–­ ã€‚</p><blockquote><p><strong>ç¼ºé¡µä¸­æ–­</strong> å°±æ˜¯è¦è®¿é—®çš„<strong>é¡µ</strong>ä¸åœ¨ä¸»å­˜ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿå°†å…¶è°ƒå…¥ä¸»å­˜åå†è¿›è¡Œè®¿é—®ã€‚ åœ¨è¿™ä¸ªæ—¶å€™ï¼Œè¢«å†…å­˜æ˜ å°„çš„æ–‡ä»¶å®é™…ä¸Šæˆäº†ä¸€ä¸ªåˆ†é¡µäº¤æ¢æ–‡ä»¶ã€‚</p></blockquote><p>å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œå¦‚æœå½“å‰å†…å­˜ä¸­å¹¶æ²¡æœ‰ç©ºé—²çš„é¡µé¢ï¼Œæ“ä½œç³»ç»Ÿå°±å¿…é¡»åœ¨å†…å­˜é€‰æ‹©ä¸€ä¸ªé¡µé¢å°†å…¶ç§»å‡ºå†…å­˜ï¼Œä»¥ä¾¿ä¸ºå³å°†è°ƒå…¥çš„é¡µé¢è®©å‡ºç©ºé—´ã€‚ç”¨æ¥é€‰æ‹©æ·˜æ±°å“ªä¸€é¡µçš„è§„åˆ™å«åšé¡µé¢ç½®æ¢ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¡µé¢ç½®æ¢ç®—æ³•çœ‹æˆæ˜¯æ·˜æ±°é¡µé¢çš„è§„åˆ™ã€‚</p><ul><li><strong>OPT é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> ï¼šæœ€ä½³(Optimal, OPT)ç½®æ¢ç®—æ³•æ‰€é€‰æ‹©çš„è¢«æ·˜æ±°é¡µé¢å°†æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨çš„ï¼Œæˆ–è€…æ˜¯åœ¨æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢,è¿™æ ·å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚ä½†ç”±äºäººä»¬ç›®å‰æ— æ³•é¢„çŸ¥è¿›ç¨‹åœ¨å†…å­˜ä¸‹çš„è‹¥åƒé¡µé¢ä¸­å“ªä¸ªæ˜¯æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„ï¼Œå› è€Œè¯¥ç®—æ³•æ— æ³•å®ç°ã€‚ä¸€èˆ¬ä½œä¸ºè¡¡é‡å…¶ä»–ç½®æ¢ç®—æ³•çš„æ–¹æ³•ã€‚</li><li><strong>FIFOï¼ˆFirst In First Outï¼‰ é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆå…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> : æ€»æ˜¯æ·˜æ±°æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚</li><li><strong>LRU ï¼ˆLeast Recently Usedï¼‰é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> ï¼šLRU ç®—æ³•èµ‹äºˆæ¯ä¸ªé¡µé¢ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªé¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´ Tï¼Œå½“é¡»æ·˜æ±°ä¸€ä¸ªé¡µé¢æ—¶ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­å…¶ T å€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚</li><li><strong>LFU ï¼ˆLeast Frequently Usedï¼‰é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆæœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong> : è¯¥ç½®æ¢ç®—æ³•é€‰æ‹©åœ¨ä¹‹å‰æ—¶æœŸä½¿ç”¨æœ€å°‘çš„é¡µé¢ä½œä¸ºæ·˜æ±°é¡µã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆé¡µè¡¨ä¸€èˆ¬æ˜¯4kb-16kb-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé¡µè¡¨ä¸€èˆ¬æ˜¯4kb-16kb-2022è”šæ¥" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆé¡µè¡¨ä¸€èˆ¬æ˜¯4KB - 16KBï¼ˆ2022è”šæ¥ï¼‰</h3><h4 id="å¯¼è¯­" tabindex="-1"><a class="header-anchor" href="#å¯¼è¯­" aria-hidden="true">#</a> å¯¼è¯­</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ Linux ä¼šä»¥é¡µä¸ºå•ä½ç®¡ç†å†…å­˜ï¼Œæ— è®ºæ˜¯å°†ç£ç›˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿˜æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å›ç£ç›˜ï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šä»¥é¡µé¢ä¸ºå•ä½è¿›è¡Œæ“ä½œï¼Œå“ªæ€•æˆ‘ä»¬åªå‘ç£ç›˜ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†æ•´ä¸ªé¡µé¢ä¸­çš„å…¨éƒ¨æ•°æ®åˆ·å…¥ç£ç›˜ä¸­ã€‚</p>',89),ko={href:"https://draveness.me/whys-the-design-linux-default-page/#fn:1",target:"_blank",rel:"noopener noreferrer"},mo=t('<p>4KB çš„å†…å­˜é¡µå…¶å®æ˜¯ä¸€ä¸ªå†å²é—ç•™é—®é¢˜ï¼Œåœ¨ä¸Šä¸ªä¸–çºª 80 å¹´ä»£ç¡®å®šçš„ 4KB ä¸€ç›´ä¿ç•™åˆ°äº†ä»Šå¤©ã€‚è™½ç„¶ä»Šå¤©çš„ç¡¬ä»¶æ¯”è¿‡å»ä¸°å¯Œäº†å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ²¿ç”¨äº†è¿‡å»ä¸»æµçš„å†…å­˜é¡µå¤§å°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè£…è¿‡æœºçš„äººåº”è¯¥å¯¹è¿™é‡Œçš„å†…å­˜æ¡éå¸¸ç†Ÿæ‚‰ï¼š</p><figure><img src="'+Ra+'" alt="random-access-memory" tabindex="0" loading="lazy"><figcaption>random-access-memory</figcaption></figure><p>åœ¨ä»Šå¤©ï¼Œ4KB çš„å†…å­˜é¡µå¤§å°å¯èƒ½ä¸æ˜¯æœ€ä½³çš„é€‰æ‹©ï¼Œ8KB æˆ–è€… 16KB è¯´ä¸å®šæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯è¿™æ˜¯è¿‡å»åœ¨ç‰¹å®šåœºæ™¯ä¸‹åšå‡ºçš„æƒè¡¡ã€‚æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¸è¦è¿‡äºçº ç»“äº 4KB è¿™ä¸ªæ•°å­—ï¼Œåº”è¯¥æ›´é‡è§†å†³å®šè¿™ä¸ªç»“æœçš„å‡ ä¸ªå› ç´ ï¼Œè¿™æ ·å½“æˆ‘ä»¬åœ¨é‡åˆ°ç±»ä¼¼åœºæ™¯æ—¶æ‰å¯ä»¥ä»è¿™äº›æ–¹é¢è€ƒè™‘å½“ä¸‹æœ€ä½³çš„é€‰æ‹©ï¼Œæˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¼šä»‹ç»ä»¥ä¸‹ä¸¤ä¸ªå½±å“å†…å­˜é¡µå¤§å°çš„å› ç´ ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li>è¿‡å°çš„é¡µé¢å¤§å°ä¼šå¸¦æ¥è¾ƒå¤§çš„é¡µè¡¨é¡¹å¢åŠ å¯»å€æ—¶ TLBï¼ˆTranslation lookaside bufferï¼‰çš„æŸ¥æ‰¾é€Ÿåº¦å’Œé¢å¤–å¼€é”€ï¼›</li><li>è¿‡å¤§çš„é¡µé¢å¤§å°ä¼šæµªè´¹å†…å­˜ç©ºé—´ï¼Œé€ æˆå†…å­˜ç¢ç‰‡ï¼Œé™ä½å†…å­˜çš„åˆ©ç”¨ç‡ï¼›</li></ul><p>ä¸Šä¸ªä¸–çºªåœ¨è®¾è®¡å†…å­˜é¡µå¤§å°æ—¶å……åˆ†è€ƒè™‘äº†ä¸Šè¿°çš„ä¸¤ä¸ªå› ç´ ï¼Œæœ€ç»ˆé€‰æ‹©äº† 4KB çš„å†…å­˜é¡µä½œä¸ºæ“ä½œç³»ç»Ÿæœ€å¸¸è§çš„é¡µå¤§å°ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†è¯¦ç»†ä»‹ç»ä»¥ä¸Šå®ƒä»¬å¯¹æ“ä½œç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚</p><h4 id="é¡µè¡¨é¡¹" tabindex="-1"><a class="header-anchor" href="#é¡µè¡¨é¡¹" aria-hidden="true">#</a> é¡µè¡¨é¡¹</h4><p>Linux ä¸­çš„è™šæ‹Ÿå†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹èƒ½å¤Ÿçœ‹åˆ°çš„éƒ½æ˜¯ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œè™šæ‹Ÿå†…å­˜ç©ºé—´åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè¿›ç¨‹ä»ç„¶éœ€è¦è®¿é—®è™šæ‹Ÿå†…å­˜å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œä»è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„è½¬æ¢å°±éœ€è¦ä½¿ç”¨æ¯ä¸ªè¿›ç¨‹æŒæœ‰é¡µè¡¨ã€‚</p><p>ä¸ºäº†å­˜å‚¨ 64 ä½æ“ä½œç³»ç»Ÿä¸­ 128 TiB è™šæ‹Ÿå†…å­˜çš„æ˜ å°„æ•°æ®ï¼ŒLinux åœ¨ 2.6.10 ä¸­å¼•å…¥äº†å››å±‚çš„é¡µè¡¨è¾…åŠ©è™šæ‹Ÿåœ°å€çš„è½¬æ¢ï¼Œå¼•å…¥äº†äº”å±‚çš„é¡µè¡¨ç»“æ„ï¼Œåœ¨æœªæ¥è¿˜å¯èƒ½ä¼šå¼•å…¥æ›´å¤šå±‚çš„é¡µè¡¨ç»“æ„ä»¥æ”¯æŒ 64 ä½çš„è™šæ‹Ÿåœ°å€ã€‚</p><figure><img src="'+Ia+'" alt="four-level-page-tables" tabindex="0" loading="lazy"><figcaption>four-level-page-tables</figcaption></figure><p>åœ¨å¦‚ä¸Šå›¾æ‰€ç¤ºçš„å››å±‚é¡µè¡¨ç»“æ„ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šä½¿ç”¨æœ€ä½çš„ 12 ä½ä½œä¸ºé¡µé¢çš„åç§»é‡ï¼Œå‰©ä¸‹çš„ 36 ä½ä¼šåˆ†å››ç»„åˆ†åˆ«è¡¨ç¤ºå½“å‰å±‚çº§åœ¨ä¸Šä¸€å±‚ä¸­çš„ç´¢å¼•ï¼Œæ‰€æœ‰çš„è™šæ‹Ÿåœ°å€éƒ½å¯ä»¥ç”¨ä¸Šè¿°çš„å¤šå±‚é¡µè¡¨æŸ¥æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚</p><p>å› ä¸ºæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿåœ°å€ç©ºé—´å¤§å°éƒ½æ˜¯ä¸€å®šçš„ï¼Œæ•´ç‰‡è™šæ‹Ÿåœ°å€ç©ºé—´è¢«å‡åŒ€åˆ†æˆäº† N ä¸ªå¤§å°ç›¸åŒçš„å†…å­˜é¡µï¼Œæ‰€ä»¥å†…å­˜é¡µçš„å¤§å°æœ€ç»ˆä¼šå†³å®šæ¯ä¸ªè¿›ç¨‹ä¸­é¡µè¡¨é¡¹çš„å±‚çº§ç»“æ„å’Œå…·ä½“æ•°é‡ï¼Œè™šæ‹Ÿé¡µçš„å¤§å°è¶Šå°ï¼Œå•ä¸ªè¿›ç¨‹ä¸­çš„é¡µè¡¨é¡¹å’Œè™šæ‹Ÿé¡µä¹Ÿå°±è¶Šå¤šã€‚</p>',11),go=n("p",{class:"katex-block"},[n("span",{class:"katex-display"},[n("span",{class:"katex"},[n("span",{class:"katex-mathml"},[n("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[n("semantics",null,[n("mrow",null,[n("mi",null,"P"),n("mi",null,"a"),n("mi",null,"g"),n("mi",null,"e"),n("mi",null,"s"),n("mi",null,"C"),n("mi",null,"o"),n("mi",null,"u"),n("mi",null,"n"),n("mi",null,"t"),n("mo",null,"="),n("mfrac",null,[n("mrow",null,[n("mi",null,"V"),n("mi",null,"i"),n("mi",null,"r"),n("mi",null,"t"),n("mi",null,"u"),n("mi",null,"a"),n("mi",null,"l"),n("mi",null,"M"),n("mi",null,"e"),n("mi",null,"m"),n("mi",null,"o"),n("mi",null,"r"),n("mi",null,"y")]),n("mrow",null,[n("mi",null,"P"),n("mi",null,"a"),n("mi",null,"g"),n("mi",null,"e"),n("mi",null,"S"),n("mi",null,"i"),n("mi",null,"z"),n("mi",null,"e")])])]),n("annotation",{encoding:"application/x-tex"}," PagesCount=\\frac{VirtualMemory}{PageSize} ")])])]),n("span",{class:"katex-html","aria-hidden":"true"},[n("span",{class:"base"},[n("span",{class:"strut",style:{height:"0.8778em","vertical-align":"-0.1944em"}}),n("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"P"),n("span",{class:"mord mathnormal"},"a"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"g"),n("span",{class:"mord mathnormal"},"es"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.07153em"}},"C"),n("span",{class:"mord mathnormal"},"o"),n("span",{class:"mord mathnormal"},"u"),n("span",{class:"mord mathnormal"},"n"),n("span",{class:"mord mathnormal"},"t"),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}}),n("span",{class:"mrel"},"="),n("span",{class:"mspace",style:{"margin-right":"0.2778em"}})]),n("span",{class:"base"},[n("span",{class:"strut",style:{height:"2.2519em","vertical-align":"-0.8804em"}}),n("span",{class:"mord"},[n("span",{class:"mopen nulldelimiter"}),n("span",{class:"mfrac"},[n("span",{class:"vlist-t vlist-t2"},[n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"1.3714em"}},[n("span",{style:{top:"-2.314em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord"},[n("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"P"),n("span",{class:"mord mathnormal"},"a"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"g"),n("span",{class:"mord mathnormal"},"e"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"S"),n("span",{class:"mord mathnormal"},"i"),n("span",{class:"mord mathnormal"},"ze")])]),n("span",{style:{top:"-3.23em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),n("span",{style:{top:"-3.677em"}},[n("span",{class:"pstrut",style:{height:"3em"}}),n("span",{class:"mord"},[n("span",{class:"mord mathnormal"},"Vi"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"r"),n("span",{class:"mord mathnormal"},"t"),n("span",{class:"mord mathnormal"},"u"),n("span",{class:"mord mathnormal"},"a"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.10903em"}},"lM"),n("span",{class:"mord mathnormal"},"e"),n("span",{class:"mord mathnormal"},"m"),n("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"ory")])])]),n("span",{class:"vlist-s"},"â€‹")]),n("span",{class:"vlist-r"},[n("span",{class:"vlist",style:{height:"0.8804em"}},[n("span")])])])]),n("span",{class:"mclose nulldelimiter"})])])])])])],-1),vo=t('<p>å› ä¸ºç›®å‰çš„è™šæ‹Ÿé¡µå¤§å°ä¸º 4096 å­—èŠ‚ï¼Œæ‰€ä»¥è™šæ‹Ÿåœ°å€æœ«å°¾çš„ 12 ä½å¯ä»¥è¡¨ç¤ºè™šæ‹Ÿé¡µä¸­çš„åœ°å€ï¼Œå¦‚æœè™šæ‹Ÿé¡µçš„å¤§å°é™åˆ°äº† 512 å­—èŠ‚ï¼Œé‚£ä¹ˆåŸæœ¬çš„å››å±‚é¡µè¡¨ç»“æ„æˆ–è€…äº”å±‚é¡µè¡¨ç»“æ„ä¼šå˜æˆäº”å±‚æˆ–è€…å…­å±‚ï¼Œè¿™ä¸ä»…ä¼šå¢åŠ å†…å­˜è®¿é—®çš„é¢å¤–å¼€é”€ï¼Œè¿˜ä¼šå¢åŠ æ¯ä¸ªè¿›ç¨‹ä¸­é¡µè¡¨é¡¹å ç”¨çš„å†…å­˜å¤§å°ã€‚</p><h4 id="ç¢ç‰‡åŒ–" tabindex="-1"><a class="header-anchor" href="#ç¢ç‰‡åŒ–" aria-hidden="true">#</a> ç¢ç‰‡åŒ–</h4><p>å› ä¸ºå†…å­˜æ˜ å°„è®¾å¤‡ä¼šåœ¨å†…å­˜é¡µçš„å±‚é¢å·¥ä½œï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿè®¤ä¸ºå†…å­˜åˆ†é…çš„æœ€å°å•å…ƒå°±æ˜¯è™šæ‹Ÿé¡µã€‚å“ªæ€•ç”¨æˆ·ç¨‹åºåªæ˜¯ç”³è¯·äº† 1 å­—èŠ‚çš„å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šä¸ºå®ƒç”³è¯·ä¸€ä¸ªè™šæ‹Ÿé¡µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¦‚æœå†…å­˜é¡µçš„å¤§å°ä¸º 24KBï¼Œé‚£ä¹ˆç”³è¯· 1 å­—èŠ‚çš„å†…å­˜ä¼šæµªè´¹ ~99.9939% çš„ç©ºé—´ã€‚</p><figure><img src="'+Aa+'" alt="memory-utilization" tabindex="0" loading="lazy"><figcaption>memory-utilization</figcaption></figure><p>éšç€å†…å­˜é¡µå¤§å°çš„å¢åŠ ï¼Œå†…å­˜çš„ç¢ç‰‡åŒ–ä¸¥æƒ…å†µä¼šè¶Šæ¥è¶Šä¸¥é‡ï¼Œå°çš„å†…å­˜é¡µä¼šå‡å°‘å†…å­˜ç©ºé—´ä¸­çš„å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ã€‚ä¸Šä¸ªä¸–çºªçš„å†…å­˜èµ„æºè¿˜æ²¡æœ‰åƒä»Šå¤©è¿™ä¹ˆä¸°å¯Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå†…å­˜éƒ½ä¸æ˜¯é™åˆ¶ç¨‹åºè¿è¡Œçš„èµ„æºï¼Œå¤šæ•°çš„åœ¨çº¿æœåŠ¡éƒ½éœ€è¦æ›´å¤šçš„CPUï¼Œè€Œä¸æ˜¯æ›´å¤šçš„å†…å­˜ã€‚ä¸è¿‡åœ¨ä¸Šä¸ªä¸–çºªå†…å­˜å…¶å®ä¹Ÿæ˜¯ç¨€ç¼ºèµ„æºï¼Œæ‰€ä»¥æé«˜ç¨€ç¼ºèµ„æºçš„åˆ©ç”¨ç‡æ˜¯æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘çš„äº‹æƒ…ï¼š</p><p>ä¸Šä¸ªä¸–çºªå…«ä¹åå¹´ä»£çš„å†…å­˜æ¡åªæœ‰ 512KB æˆ–è€… 2MBï¼Œä»·æ ¼ä¹Ÿè´µå¾—ç¦»è°±ï¼Œä½†æ˜¯å‡  GB çš„å†…å­˜åœ¨ä»Šå¤©å´éå¸¸å¸¸è§ï¼Œæ‰€ä»¥è™½ç„¶å†…å­˜çš„åˆ©ç”¨ç‡ä»ç„¶ååˆ†é‡è¦ï¼Œä½†æ˜¯åœ¨å†…å­˜çš„ä»·æ ¼å¤§å¹…é™ä½çš„ä»Šå¤©ï¼Œç¢ç‰‡åŒ–çš„å†…å­˜ä¸å†æ˜¯éœ€è¦è§£å†³çš„å…³é”®é—®é¢˜äº†ã€‚</p><p>é™¤äº†å†…å­˜çš„åˆ©ç”¨ç‡ä¹‹å¤–ï¼Œè¾ƒå¤§çš„å†…å­˜é¡µä¹Ÿä¼šå¢åŠ å†…å­˜æ‹·è´æ—¶çš„é¢å¤–å¼€é”€ï¼Œå› ä¸º Linux ä¸Šçš„å†™æ—¶æ‹·è´æœºåˆ¶ï¼Œåœ¨å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—å†…å­˜æ—¶ï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹äº†å…±äº«çš„è™šæ‹Ÿå†…å­˜ä¼šè§¦å‘å†…å­˜é¡µçš„æ‹·è´ï¼Œè¿™æ—¶æ“ä½œç³»ç»Ÿçš„å†…å­˜é¡µè¶Šå°ï¼Œå†™æ—¶æ‹·è´å¸¦æ¥çš„é¢å¤–å¼€é”€ä¹Ÿå°±è¶Šå°ã€‚</p><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><p>å°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„ï¼Œ4KB çš„å†…å­˜é¡µæ˜¯ä¸Šä¸ªä¸–çºªå†³å®šçš„é»˜è®¤è®¾ç½®ï¼Œä»ä»Šå¤©çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å¾ˆå¯èƒ½å·²ç»æ˜¯é”™è¯¯çš„é€‰æ‹©äº†ï¼Œarm64ã€ia64 ç­‰æ¶æ„å·²ç»å¯ä»¥æ”¯æŒ 8KBã€16KB ç­‰å¤§å°çš„å†…å­˜é¡µï¼Œéšç€å†…å­˜çš„ä»·æ ¼å˜å¾—è¶Šæ¥è¶Šä½ã€ç³»ç»Ÿçš„å†…å­˜å˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œæ›´å¤§çš„å†…å­˜å¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿæ›´å¥½çš„é€‰æ‹©ï¼Œæˆ‘ä»¬é‡æ–°å›é¡¾ä¸€ä¸‹ä¸¤ä¸ªå†³å®šå†…å­˜é¡µå¤§å°çš„è¦ç´ ï¼š</p><ul><li>è¿‡å°çš„é¡µé¢å¤§å°ä¼šå¸¦æ¥è¾ƒå¤§çš„é¡µè¡¨é¡¹å¢åŠ å¯»å€æ—¶ TLBï¼ˆTranslation lookaside bufferï¼‰çš„æŸ¥æ‰¾æ—¶é—´å’Œé¢å¤–å¼€é”€ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡å°‘ç¨‹åºä¸­çš„å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ï¼›</li><li>è¿‡å¤§çš„é¡µé¢å¤§å°ä¼šæµªè´¹å†…å­˜ç©ºé—´ï¼Œé€ æˆå†…å­˜ç¢ç‰‡ï¼Œé™ä½å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œä½†æ˜¯å¯ä»¥å‡å°‘è¿›ç¨‹ä¸­çš„é¡µè¡¨é¡¹ä»¥åŠ TLB çš„å¯»å€æ—¶é—´ï¼›</li></ul><p>è¿™ç§ç±»ä¼¼çš„åœºæ™¯åœ¨æˆ‘ä»¬åšç³»ç»Ÿè®¾è®¡æ—¶ä¹Ÿæ¯”è¾ƒå¸¸è§ï¼Œä¸¾ä¸€ä¸ªä¸æ˜¯ç‰¹åˆ«æ°å½“çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬æƒ³è¦åœ¨é›†ç¾¤ä¸Šéƒ¨ç½²æœåŠ¡æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œå•ä¸ªæœåŠ¡å ç”¨çš„èµ„æºå¯èƒ½ä¼šå½±å“é›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡æˆ–è€…ç³»ç»Ÿçš„é¢å¤–å¼€é”€ã€‚å¦‚æœæˆ‘ä»¬åœ¨é›†ç¾¤ä¸­éƒ¨ç½² 32 ä¸ªå ç”¨ 1 CPU çš„æœåŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥å……åˆ†åˆ©ç”¨é›†ç¾¤ä¸­çš„èµ„æºï¼Œä½†æ˜¯å¦‚æ­¤å¤šçš„å®ä¾‹æ•°ä¼šå¸¦æ¥è¾ƒå¤§çš„é¢å¤–å¼€é”€ï¼›å¦‚æœæˆ‘ä»¬åœ¨é›†ç¾¤ä¸­éƒ¨ç½² 4 ä¸ªå ç”¨ 8 CPU çš„æœåŠ¡ï¼Œé‚£ä¹ˆè¿™äº›æœåŠ¡çš„é¢å¤–å¼€é”€è™½ç„¶å¾ˆå°ï¼Œä½†æ˜¯å¯èƒ½ä¼šåœ¨èŠ‚ç‚¹ä¸­ç•™ä¸‹å¾ˆå¤šç©ºéš™ã€‚åˆ°æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€äº›æ¯”è¾ƒå¼€æ”¾çš„ç›¸å…³é—®é¢˜ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ä»”ç»†æ€è€ƒä¸€ä¸‹ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>Linux ä¸­çš„æ‰‡åŒºã€å—å’Œé¡µéƒ½æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ</li><li>Linux ä¸­çš„å—å¤§å°æ˜¯å¦‚ä½•å†³å®šçš„ï¼Ÿå¸¸è§çš„å¤§å°æœ‰å“ªäº›ï¼Ÿ</li></ul><h2 id="ğŸŒè®¡ç®—æœºç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#ğŸŒè®¡ç®—æœºç½‘ç»œ" aria-hidden="true">#</a> ğŸŒè®¡ç®—æœºç½‘ç»œ</h2><h3 id="è®¡ç®—æœºç½‘ç»œè¾“å…¥-url-åˆ°çœ‹åˆ°ç½‘é¡µ" tabindex="-1"><a class="header-anchor" href="#è®¡ç®—æœºç½‘ç»œè¾“å…¥-url-åˆ°çœ‹åˆ°ç½‘é¡µ" aria-hidden="true">#</a> è®¡ç®—æœºç½‘ç»œè¾“å…¥ URL åˆ°çœ‹åˆ°ç½‘é¡µ</h3><p>ç™¾åº¦å¥½åƒæœ€å–œæ¬¢é—®è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šä½¿ç”¨å“ªäº›åè®®ï¼Ÿ</p><p>å›¾è§£ï¼ˆå›¾ç‰‡æ¥æºï¼šã€Šå›¾è§£ HTTPã€‹ï¼‰ï¼š</p><figure><img src="'+Na+'" alt="image-20220404171544021" tabindex="0" loading="lazy"><figcaption>image-20220404171544021</figcaption></figure><blockquote><p>ä¸Šå›¾æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æ³¨æ„ï¼Œæ˜¯ OSPF ä¸æ˜¯ OPSFã€‚ OSPFï¼ˆOpen Shortest Path Firstï¼Œospfï¼‰å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®, æ˜¯ç”± Internet å·¥ç¨‹ä»»åŠ¡ç»„å¼€å‘çš„è·¯ç”±é€‰æ‹©åè®®</p></blockquote><p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p><ol><li>DNS è§£æ</li><li>TCP è¿æ¥</li><li>å‘é€ HTTP è¯·æ±‚</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å› HTTP æŠ¥æ–‡</li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li><li>è¿æ¥ç»“æŸ</li></ol>',21),bo={href:"https://segmentfault.com/a/1190000006879700",target:"_blank",rel:"noopener noreferrer"},ho=t('<h3 id="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹" tabindex="-1"><a class="header-anchor" href="#ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹" aria-hidden="true">#</a> ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸‹é¢çš„ä¸¤ä¸ªæœºå™¨äººé€šè¿‡ 3 æ¬¡æ¡æ‰‹ç¡®å®šäº†å¯¹æ–¹èƒ½æ­£ç¡®æ¥æ”¶å’Œå‘é€æ¶ˆæ¯(å›¾ç‰‡æ¥æºï¼šã€Šå›¾è§£ HTTPã€‹)ã€‚</p><figure><img src="'+Ma+'" alt="image-20220404171424811" tabindex="0" loading="lazy"><figcaption>image-20220404171424811</figcaption></figure><p><strong>ç®€å•ç¤ºæ„å›¾ï¼š</strong></p><figure><img src="'+Ea+'" alt="image-20220404171434074" tabindex="0" loading="lazy"><figcaption>image-20220404171434074</figcaption></figure><ul><li>å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸€æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯â€“å‘é€å¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“äºŒæ¬¡æ¡æ‰‹â€“å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸‰æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯</li></ul><p><strong>è¯¦ç»†ç¤ºæ„å›¾ï¼ˆå›¾ç‰‡æ¥æºä¸è¯¦ï¼‰</strong></p><figure><img src="'+Oa+'" alt="image-20220404171446235" tabindex="0" loading="lazy"><figcaption>image-20220404171446235</figcaption></figure><h3 id="tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹çš„è¯¦ç»†è¿‡ç¨‹-æŠ–éŸ³" tabindex="-1"><a class="header-anchor" href="#tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹çš„è¯¦ç»†è¿‡ç¨‹-æŠ–éŸ³" aria-hidden="true">#</a> tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹çš„è¯¦ç»†è¿‡ç¨‹ï¼ˆæŠ–éŸ³ï¼‰</h3><p>å»ºç«‹ä¸€ä¸ª TCP è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œç»ˆæ­¢ä¸€ä¸ª TCP è¿æ¥è¦ç»è¿‡å››æ¬¡æŒ¥æ‰‹ï¼ˆä¹Ÿæœ‰å°†å››æ¬¡æŒ¥æ‰‹å«åšå››æ¬¡æ¡æ‰‹çš„ï¼‰ã€‚è¿™æ˜¯ç”±äº TCP çš„<strong>åŠå…³é—­</strong>ï¼ˆhalf-closeï¼‰ç‰¹æ€§é€ æˆçš„ï¼ŒTCP æä¾›äº†è¿æ¥çš„ä¸€ç«¯åœ¨ç»“æŸå®ƒçš„å‘é€åè¿˜èƒ½æ¥æ”¶æ¥è‡ªå¦ä¸€ç«¯æ•°æ®çš„èƒ½åŠ›ã€‚</p><p>TCP è¿æ¥çš„é‡Šæ”¾éœ€è¦å‘é€å››ä¸ªåŒ…ï¼ˆæ‰§è¡Œå››ä¸ªæ­¥éª¤ï¼‰ï¼Œå› æ­¤ç§°ä¸ºå››æ¬¡æŒ¥æ‰‹(<code>Four-way handshake</code>)ï¼Œ<strong>å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯å‡å¯ä¸»åŠ¨å‘èµ·æŒ¥æ‰‹åŠ¨ä½œ</strong>ã€‚</p><figure><img src="'+Ba+'" alt="image-20220606202244867" tabindex="0" loading="lazy"><figcaption>image-20220606202244867</figcaption></figure><p>å›é¡¾ä¸€ä¸‹ä¸Šå›¾ä¸­ç¬¦å·çš„æ„æ€ï¼š</p><ul><li><code>FIN</code> ï¼šè¿æ¥ç»ˆæ­¢ä½</li><li><code>seq</code>ï¼šå‘é€çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·</li><li><code>ACK</code>ï¼šç¡®è®¤æŠ¥æ–‡æ®µ</li><li><code>ack</code>ï¼šç¡®è®¤å·ã€‚å¸Œæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·</li></ul><p>åˆšå¼€å§‹åŒæ–¹éƒ½å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œå‡è®¾æ˜¯å®¢æˆ·ç«¯å…ˆå‘èµ·å…³é—­è¯·æ±‚ã€‚å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><strong>1ï¼‰ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡ï¼ˆè¯·æ±‚è¿æ¥ç»ˆæ­¢ï¼šFIN = 1ï¼‰ï¼ŒæŠ¥æ–‡ä¸­ä¼šæŒ‡å®šä¸€ä¸ªåºåˆ—å· seq = uã€‚å¹¶<strong>åœæ­¢å†å‘é€æ•°æ®ï¼Œä¸»åŠ¨å…³é—­ TCP è¿æ¥</strong>ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <code>FIN_WAIT1</code> çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯çš„ç¡®è®¤ã€‚</p><p><code>FIN-WAIT-1</code> - ç­‰å¾…è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚ï¼Œæˆ–å…ˆå‰çš„è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼›</p><p><strong>2ï¼‰ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡ç«¯æ”¶åˆ° FIN ä¹‹åï¼Œä¼šå‘é€ ACK æŠ¥æ–‡ï¼Œä¸”æŠŠå®¢æˆ·ç«¯çš„åºå·å€¼ +1 ä½œä¸º ACK æŠ¥æ–‡çš„åºåˆ—å·å€¼ï¼Œè¡¨æ˜å·²ç»æ”¶åˆ°å®¢æˆ·ç«¯çš„æŠ¥æ–‡äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>CLOSE_WAIT</code> çŠ¶æ€ã€‚</p><p><code>CLOSE-WAIT</code> - ç­‰å¾…ä»æœ¬åœ°ç”¨æˆ·å‘æ¥çš„è¿æ¥ä¸­æ–­è¯·æ±‚ï¼›</p><p><strong>æ­¤æ—¶çš„ TCP å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥é‡Šæ”¾</strong>ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç¡®è®¤åï¼Œè¿›å…¥ <code>FIN_WAIT2</code>ï¼ˆç»ˆæ­¢ç­‰å¾… 2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯å‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µã€‚</p><p><code>FIN-WAIT-2</code> - ä»è¿œç¨‹TCPç­‰å¾…è¿æ¥ä¸­æ–­è¯·æ±‚ï¼›</p><p><strong>3ï¼‰ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šå¦‚æœæœåŠ¡ç«¯ä¹Ÿæƒ³æ–­å¼€è¿æ¥äº†ï¼ˆæ²¡æœ‰è¦å‘å®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®ï¼‰ï¼Œå’Œå®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸€æ ·ï¼Œå‘é€ FIN æŠ¥æ–‡ï¼Œä¸”æŒ‡å®šä¸€ä¸ªåºåˆ—å·ã€‚æ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>LAST_ACK</code> çš„çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</p><p><code>LAST-ACK</code> - ç­‰å¾…åŸæ¥å‘å‘è¿œç¨‹TCPçš„è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼›</p><p><strong>4ï¼‰ç¬¬å››æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ° FIN ä¹‹åï¼Œä¸€æ ·å‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œä¸”æŠŠæœåŠ¡ç«¯çš„åºåˆ—å€¼ +1 ä½œä¸ºè‡ªå·± ACK æŠ¥æ–‡çš„åºå·å€¼ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <strong><code>TIME_WAIT</code> ï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€</strong>ã€‚</p><p><code>TIME-WAIT</code> - ç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿è¿œç¨‹TCPæ¥æ”¶åˆ°è¿æ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼›</p><p>ğŸš¨ æ³¨æ„ ï¼ï¼ï¼è¿™ä¸ªæ—¶å€™ç”±æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„ TCP è¿æ¥å¹¶æœªé‡Šæ”¾æ‰ï¼Œ<strong>éœ€è¦ç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLï¼ˆä¸€ä¸ªæŠ¥æ–‡çš„æ¥å›æ—¶é—´ï¼‰ åæ‰ä¼šè¿›å…¥ <code>CLOSED</code> çŠ¶æ€</strong>ï¼ˆè¿™æ ·åšçš„ç›®çš„æ˜¯ç¡®ä¿æœåŠ¡ç«¯æ”¶åˆ°è‡ªå·±çš„ ACK æŠ¥æ–‡ã€‚å¦‚æœæœåŠ¡ç«¯åœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„ ACK æŠ¥æ–‡çš„è¯ï¼ŒæœåŠ¡ç«¯ä¼šé‡æ–°å‘é€ FIN æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡æ”¶åˆ° FIN æŠ¥æ–‡ä¹‹åï¼Œå°±çŸ¥é“ä¹‹å‰çš„ ACK æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œç„¶åå†æ¬¡å‘é€ ACK æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼‰ã€‚æœåŠ¡ç«¯æ”¶åˆ° ACK æŠ¥æ–‡ä¹‹åï¼Œå°±å…³é—­è¿æ¥äº†ï¼Œå¤„äº <code>CLOSED</code> çŠ¶æ€ã€‚</p><h3 id="tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹å½“ä¸­ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥èƒ½å¦åˆå¹¶æˆä¸€æ­¥" tabindex="-1"><a class="header-anchor" href="#tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹å½“ä¸­ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥èƒ½å¦åˆå¹¶æˆä¸€æ­¥" aria-hidden="true">#</a> tcpåè®®çš„å››æ¬¡æŒ¥æ‰‹å½“ä¸­ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥èƒ½å¦åˆå¹¶æˆä¸€æ­¥</h3><p><code>å‚è€ƒï¼šhttps://www.zhihu.com/question/50646354</code></p><p>å¾ˆå¤šäººæœ‰ä¸€ä¸ªè¯¯åŒºï¼Œå³è®¤ä¸ºTCPè¿æ¥æ˜¯é€šä¿¡çš„å…¨éƒ¨ï¼Œå…¶å®å¹¶ä¸æ˜¯è¿™æ ·ï¼Œè®©æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹TCPè¿æ¥æ–­å¼€çš„è¿‡ç¨‹ã€‚</p><p>å‡å®šTCP clientç«¯ä¸»åŠ¨å‘èµ·æ–­å¼€è¿æ¥</p><ol><li>clientç«¯çš„application æ¥å—ç”¨æˆ·æ–­å¼€TCPè¿æ¥è¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯ç”±ç”¨æˆ·è§¦å‘çš„è¯·æ±‚ï¼Œä»¥æ¶ˆæ¯çš„æ–¹å¼åˆ°è¾¾client TCP</li><li>client TCP å‘é€ FIN=1 ç»™ server ç«¯ TCP</li><li>server ç«¯TCP æ¥æ”¶åˆ°FIN=1 æ–­å¼€è¿æ¥è¯·æ±‚ï¼Œéœ€è¦å’¨è¯¢ applicationçš„æ„è§ï¼Œéœ€è¦å‘æ¶ˆæ¯ç»™applicationï¼Œæ¶ˆæ¯å†…å®¹ï¼šå¯¹æ–¹è¦æ–­å¼€è¿æ¥ï¼Œè¯·é—®æ‚¨è€äººå®¶è¿˜æœ‰æ•°æ®è¦å‘é€å—ï¼Ÿå¦‚æœæœ‰æ•°æ®è¯·å‘ŠçŸ¥ï¼Œæ²¡æœ‰æ•°æ®ä¹Ÿè¯·å‘ŠçŸ¥ï¼ç„¶åå°±æ˜¯ç­‰å¾…application çš„å›åº”ã€‚æ—¢ç„¶éœ€è¦ç­‰å¾…applicationçš„å›å¤ï¼Œä¸ºä½•ä¸æ—©ç‚¹æŠŠå¯¹client FIN çš„ACKå‘å‡ºå»å‘¢ï¼Ÿ äº‹å®ä¸ŠTCPä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œæ”¶åˆ°å¯¹æ–¹çš„æ–­å¼€è¿æ¥è¯·æ±‚ï¼Œç«‹é©¬å‘ACKäºˆä»¥ç¡®è®¤ï¼Œclient --&gt; server æ–¹å‘è¿æ¥æ–­å¼€ã€‚</li><li>å¦‚æœ serverç«¯æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œåˆ™ç»§ç»­å‘é€ä¸€ç›´åˆ°æ•°æ®å‘é€å®Œæ¯•ï¼Œç„¶åapplication å‘closeæ¶ˆæ¯ç»™TCPï¼Œç°åœ¨å¯ä»¥å…³é—­è¿æ¥ï¼Œç„¶åServer TCP å‘FIN=1 æ–­å¼€ server --&gt;clientæ–¹å‘çš„è¿æ¥ã€‚ <ol><li>Â·å¦‚æœ serverç«¯æ²¡æœ‰æ•°æ®å‘é€ï¼Œapplicationå›åº”closeæ¶ˆæ¯ç»™TCPï¼Œç°åœ¨å¯ä»¥å…³é—­è¿æ¥ï¼Œç„¶åServer TCP å‘FIN=1 æ–­å¼€ server --&gt;clientæ–¹å‘çš„è¿æ¥ã€‚</li></ol></li></ol><h3 id="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹-ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡æ¡æ‰‹" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹-ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡æ¡æ‰‹" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ / ä¸ºä»€ä¹ˆä¸èƒ½ä¸¤æ¬¡æ¡æ‰‹</h3><p><strong>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯å»ºç«‹å¯é çš„é€šä¿¡ä¿¡é“ï¼Œè¯´åˆ°é€šè®¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ•°æ®çš„å‘é€ä¸æ¥æ”¶ï¼Œè€Œä¸‰æ¬¡æ¡æ‰‹æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯åŒæ–¹ç¡®è®¤è‡ªå·±ä¸å¯¹æ–¹çš„å‘é€ä¸æ¥æ”¶æ˜¯æ­£å¸¸çš„ã€‚</strong></p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClient ä»€ä¹ˆéƒ½ä¸èƒ½ç¡®è®¤ï¼›Server ç¡®è®¤äº†å¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šå¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸</p><p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹å°±èƒ½ç¡®è®¤åŒæ–¹æ”¶å‘åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œç¼ºä¸€ä¸å¯</p><h3 id="tcp-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" tabindex="-1"><a class="header-anchor" href="#tcp-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" aria-hidden="true">#</a> TCP ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p>ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›éƒ½æ²¡æœ‰é—®é¢˜ï¼Œå››æ¬¡æŒ¥æ‰‹æ˜¯ç¡®ä¿æ•°æ®éƒ½å‘é€å®Œäº†æ‰ç»“æŸ</p><h3 id="ä¸ºä»€ä¹ˆ-tcp-ç¬¬äºŒæ¬¡æ¡æ‰‹çš„-syn-å’Œ-ack-è¦åˆå¹¶æˆä¸€æ¬¡-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-tcp-ç¬¬äºŒæ¬¡æ¡æ‰‹çš„-syn-å’Œ-ack-è¦åˆå¹¶æˆä¸€æ¬¡-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆ TCP ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ SYN å’Œ ACK è¦åˆå¹¶æˆä¸€æ¬¡ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>åˆ†å¼€ä¸¤æ¬¡å‘é€ï¼Œæµªè´¹èµ„æº</p><h3 id="tcpæ¡æ‰‹çš„ç›®çš„æœ‰å“ªäº›-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#tcpæ¡æ‰‹çš„ç›®çš„æœ‰å“ªäº›-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> TCPæ¡æ‰‹çš„ç›®çš„æœ‰å“ªäº›ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>ç¡®è®¤åŒæ–¹çš„æ”¶å‘èƒ½åŠ›éƒ½æ²¡æœ‰é—®é¢˜ï¼Œåˆå§‹åŒ–åºåˆ—å·ï¼Œç¡®è®¤çª—å£å¤§å°å³ MSS ç­‰ä¿¡æ¯</p><h3 id="syn-flood-çš„åŸç†-æœ‰å“ªäº›é˜²èŒƒçš„æ–¹æ³•-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#syn-flood-çš„åŸç†-æœ‰å“ªäº›é˜²èŒƒçš„æ–¹æ³•-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> SYN Flood çš„åŸç†ï¼Ÿæœ‰å“ªäº›é˜²èŒƒçš„æ–¹æ³•ï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>å®¢æˆ·ç«¯å‘é€ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€ä¸ª SYN æŠ¥æ–‡åæ”¶åˆ°æœåŠ¡å™¨çš„æŠ¥æ–‡å´ä¸å›åº”ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨çš„åŠå¼€èµ„æºæµªè´¹ç›´åˆ°è¶…æ—¶é‡Šæ”¾</p><p>å¯ä»¥ä½¿ç”¨ SYN Cookieï¼Œå³é€šè¿‡å°†æºç›®åœ°å€åŠ IP åœ°å€å’Œç«¯å£å·å“ˆå¸Œä¸ºåºåˆ—å·ï¼Œå°†è¿”å›çš„ ACK-1 å¾—åˆ°åŸæ¥çš„åºåˆ—å·åˆ¤æ–­æ˜¯å¦æ­£ç¡®ï¼Œç›´åˆ°è¿æ¥å»ºç«‹æ‰åˆ†é…èµ„æº</p><h3 id="url-è§£æè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#url-è§£æè¿‡ç¨‹" aria-hidden="true">#</a> url è§£æè¿‡ç¨‹</h3><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰åŒå­¦ä¼šæ··æ·†åŸŸåå’Œ URL çš„æ¦‚å¿µï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼ŒURL å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„ç½‘å€ï¼Œè€Œç½‘å€é‡Œé¢å«æœ‰åŸŸåã€‚ä¸¾ä¸ªä¾‹å­ï¼š<code>www.baidu.com/veal98</code> æ˜¯ä¸€ä¸ªç½‘å€ï¼Œè€Œ <code>www.baidu.com</code> å°±æ˜¯æœåŠ¡å™¨çš„åŸŸåã€‚</p><p>URL å„å…ƒç´ çš„ç»„æˆå¦‚ä¸‹ï¼ˆå½“ç„¶ï¼Œä¸‹è¿°è¯·æ±‚æ–‡ä»¶çš„è·¯å¾„åå¯ä»¥çœç•¥ï¼‰ï¼š</p><figure><img src="'+Da+'" alt="image-20220606203824170" tabindex="0" loading="lazy"><figcaption>image-20220606203824170</figcaption></figure><p>è¿™ä¸ª URL è¯·æ±‚çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è·¯å¾„å°±æ˜¯ï¼š</p><figure><img src="'+za+'" alt="image-20220606203831080" tabindex="0" loading="lazy"><figcaption>image-20220606203831080</figcaption></figure><p>é‚£ä¹ˆé¦–å…ˆï¼Œæµè§ˆå™¨åšçš„ç¬¬ä¸€æ­¥å°±æ˜¯è§£æ URL å¾—åˆ°é‡Œé¢çš„å‚æ•°ï¼Œå°†åŸŸåå’Œéœ€è¦è¯·æ±‚çš„èµ„æºåˆ†ç¦»å¼€æ¥ï¼Œä»è€Œäº†è§£éœ€è¦è¯·æ±‚çš„æ˜¯å“ªä¸ªæœåŠ¡å™¨ï¼Œè¯·æ±‚çš„æ˜¯æœåŠ¡å™¨ä¸Šä»€ä¹ˆèµ„æºç­‰ç­‰ã€‚</p><h3 id="ä¸ƒå±‚åè®®" tabindex="-1"><a class="header-anchor" href="#ä¸ƒå±‚åè®®" aria-hidden="true">#</a> ä¸ƒå±‚åè®®</h3><p><strong>OSI ä¸ƒå±‚æ¨¡å‹</strong> æ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡æå‡ºä¸€ä¸ªç½‘ç»œåˆ†å±‚æ¨¡å‹ï¼Œå…¶å¤§ä½“ç»“æ„ä»¥åŠæ¯ä¸€å±‚æä¾›çš„åŠŸèƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="'+qa+'" alt="image-20220404172009498" tabindex="0" loading="lazy"><figcaption>image-20220404172009498</figcaption></figure><p>æ¯ä¸€å±‚éƒ½ä¸“æ³¨åšä¸€ä»¶äº‹æƒ…ï¼Œå¹¶ä¸”æ¯ä¸€å±‚éƒ½éœ€è¦ä½¿ç”¨ä¸‹ä¸€å±‚æä¾›çš„åŠŸèƒ½æ¯”å¦‚ä¼ è¾“å±‚éœ€è¦ä½¿ç”¨ç½‘ç»œå±‚æä¾›çš„è·¯ç”±å’Œå¯»å€åŠŸèƒ½ï¼Œè¿™æ ·ä¼ è¾“å±‚æ‰çŸ¥é“æŠŠæ•°æ®ä¼ è¾“åˆ°å“ªé‡Œå»ã€‚</p><p><strong>OSI çš„ä¸ƒå±‚ä½“ç³»ç»“æ„æ¦‚å¿µæ¸…æ¥šï¼Œç†è®ºä¹Ÿå¾ˆå®Œæ•´ï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒå¤æ‚è€Œä¸”ä¸å®ç”¨ï¼Œè€Œä¸”æœ‰äº›åŠŸèƒ½åœ¨å¤šä¸ªå±‚ä¸­é‡å¤å‡ºç°ã€‚</strong></p><p>ä¸Šé¢è¿™ç§å›¾å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œå†æ¥ä¸€ä¸ªæ¯”è¾ƒç”ŸåŠ¨çš„å›¾ç‰‡ã€‚ä¸‹é¢è¿™ä¸ªå›¾ç‰‡æ˜¯æˆ‘åœ¨å›½å¤–çš„ä¸€ä¸ªç½‘ç«™ä¸Šçœ‹åˆ°çš„ï¼Œéå¸¸èµï¼</p><figure><img src="'+ja+'" alt="image-20220404172035072" tabindex="0" loading="lazy"><figcaption>image-20220404172035072</figcaption></figure><p><strong>æ—¢ç„¶ OSI ä¸ƒå±‚æ¨¡å‹è¿™ä¹ˆå‰å®³ï¼Œä¸ºä»€ä¹ˆå¹²ä¸è¿‡ TCP/IP å›› å±‚æ¨¡å‹å‘¢ï¼Ÿ</strong></p><p>çš„ç¡®ï¼ŒOSI ä¸ƒå±‚æ¨¡å‹å½“æ—¶ä¸€ç›´è¢«ä¸€äº›å¤§å…¬å¸ç”šè‡³ä¸€äº›å›½å®¶æ”¿åºœæ”¯æŒã€‚è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šå¤±è´¥å‘¢ï¼Ÿæˆ‘è§‰å¾—ä¸»è¦æœ‰ä¸‹é¢å‡ æ–¹é¢åŸå› ï¼š</p><ol><li>OSI çš„ä¸“å®¶ç¼ºä¹å®é™…ç»éªŒï¼Œä»–ä»¬åœ¨å®Œæˆ OSI æ ‡å‡†æ—¶ç¼ºä¹å•†ä¸šé©±åŠ¨åŠ›</li><li>OSI çš„åè®®å®ç°èµ·æ¥è¿‡åˆ†å¤æ‚ï¼Œè€Œä¸”è¿è¡Œæ•ˆç‡å¾ˆä½</li><li>OSI åˆ¶å®šæ ‡å‡†çš„å‘¨æœŸå¤ªé•¿ï¼Œå› è€Œä½¿å¾—æŒ‰ OSI æ ‡å‡†ç”Ÿäº§çš„è®¾å¤‡æ— æ³•åŠæ—¶è¿›å…¥å¸‚åœºï¼ˆ20 ä¸–çºª 90 å¹´ä»£åˆæœŸï¼Œè™½ç„¶æ•´å¥—çš„ OSI å›½é™…æ ‡å‡†éƒ½å·²ç»åˆ¶å®šå‡ºæ¥ï¼Œä½†åŸºäº TCP/IP çš„äº’è”ç½‘å·²ç»æŠ¢å…ˆåœ¨å…¨çƒç›¸å½“å¤§çš„èŒƒå›´æˆåŠŸè¿è¡Œäº†ï¼‰</li><li>OSI çš„å±‚æ¬¡åˆ’åˆ†ä¸å¤ªåˆç†ï¼Œæœ‰äº›åŠŸèƒ½åœ¨å¤šä¸ªå±‚æ¬¡ä¸­é‡å¤å‡ºç°ã€‚</li></ol><p>OSI ä¸ƒå±‚æ¨¡å‹è™½ç„¶å¤±è´¥äº†ï¼Œä½†æ˜¯å´æä¾›äº†å¾ˆå¤šä¸é”™çš„ç†è®ºåŸºç¡€ã€‚ä¸ºäº†æ›´å¥½åœ°å»äº†è§£ç½‘ç»œåˆ†å±‚ï¼ŒOSI ä¸ƒå±‚æ¨¡å‹è¿˜æ˜¯éå¸¸æœ‰å¿…è¦å­¦ä¹ çš„ã€‚</p><p>æœ€åå†åˆ†äº«ä¸€ä¸ªå…³äº OSI ä¸ƒå±‚æ¨¡å‹éå¸¸ä¸é”™çš„æ€»ç»“å›¾ç‰‡ï¼</p><figure><img src="'+p+'" alt="image-20220404172044696" tabindex="0" loading="lazy"><figcaption>image-20220404172044696</figcaption></figure><ul><li>Physical, Data Link, Network, Transport, Application</li><li>åº”ç”¨å±‚ï¼šå¸¸è§åè®®ï¼š <ul><li>FTP(21 ç«¯å£)ï¼šæ–‡ä»¶ä¼ è¾“åè®®</li><li>SSH(22 ç«¯å£)ï¼šè¿œç¨‹ç™»é™†</li><li>TELNET(23 ç«¯å£)ï¼šè¿œç¨‹ç™»å½•</li><li>SMTP(25 ç«¯å£)ï¼šå‘é€é‚®ä»¶</li><li>POP3(110 ç«¯å£)ï¼šæ¥æ”¶é‚®ä»¶</li><li>HTTP(80 ç«¯å£)ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®</li><li>DNS(53 ç«¯å£)ï¼šè¿è¡Œåœ¨ UDP ä¸Šï¼ŒåŸŸåè§£ææœåŠ¡</li></ul></li><li>ä¼ è¾“å±‚ï¼šTCP/UDP</li><li>ç½‘ç»œå±‚ï¼šIPã€ARPã€NATã€RIP...</li></ul><h3 id="tcp-çš„åº•å±‚åŸç†çŸ¥é“å—-tcp-æ˜¯æ€ä¹ˆå®ç°é€šä¿¡çš„" tabindex="-1"><a class="header-anchor" href="#tcp-çš„åº•å±‚åŸç†çŸ¥é“å—-tcp-æ˜¯æ€ä¹ˆå®ç°é€šä¿¡çš„" aria-hidden="true">#</a> TCP çš„åº•å±‚åŸç†çŸ¥é“å—ï¼ŸTCP æ˜¯æ€ä¹ˆå®ç°é€šä¿¡çš„ï¼Ÿ</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ TCP å¤´çš„æ ¼å¼ï¼Œæ ‡æ³¨é¢œè‰²çš„è¡¨ç¤ºä¸æœ¬æ–‡å…³è”æ¯”è¾ƒå¤§çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µä¸åšè¯¦ç»†é˜è¿°ã€‚</p><figure><img src="'+Ha+'" alt="image-20220622170005400" tabindex="0" loading="lazy"><figcaption>image-20220622170005400</figcaption></figure><p><strong>åºåˆ—å·</strong>ï¼šåœ¨å»ºç«‹è¿æ¥æ—¶ç”±è®¡ç®—æœºç”Ÿæˆçš„éšæœºæ•°ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œé€šè¿‡ SYN åŒ…ä¼ ç»™æ¥æ”¶ç«¯ä¸»æœºï¼Œæ¯å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå°±ã€Œç´¯åŠ ã€ä¸€æ¬¡è¯¥ã€Œæ•°æ®å­—èŠ‚æ•°ã€çš„å¤§å°ã€‚<strong>ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºé—®é¢˜ã€‚</strong></p><p><strong>ç¡®è®¤åº”ç­”å·</strong>ï¼šæŒ‡ä¸‹ä¸€æ¬¡ã€ŒæœŸæœ›ã€æ”¶åˆ°çš„æ•°æ®çš„åºåˆ—å·ï¼Œå‘é€ç«¯æ”¶åˆ°è¿™ä¸ªç¡®è®¤åº”ç­”ä»¥åå¯ä»¥è®¤ä¸ºåœ¨è¿™ä¸ªåºå·ä»¥å‰çš„æ•°æ®éƒ½å·²ç»è¢«æ­£å¸¸æ¥æ”¶ã€‚<strong>ç”¨æ¥è§£å†³ä¸¢åŒ…çš„é—®é¢˜ã€‚</strong></p><p><strong>æ§åˆ¶ä½ï¼š</strong></p><ul><li><em>ACK</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œã€Œç¡®è®¤åº”ç­”ã€çš„å­—æ®µå˜ä¸ºæœ‰æ•ˆï¼ŒTCP è§„å®šé™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶çš„ <code>SYN</code> åŒ…ä¹‹å¤–è¯¥ä½å¿…é¡»è®¾ç½®ä¸º <code>1</code> ã€‚</li><li><em>RST</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿æ¥ã€‚</li><li><em>SYN</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤ºå¸Œæœ›å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨å…¶ã€Œåºåˆ—å·ã€çš„å­—æ®µè¿›è¡Œåºåˆ—å·åˆå§‹å€¼çš„è®¾å®šã€‚</li><li><em>FIN</em>ï¼šè¯¥ä½ä¸º <code>1</code> æ—¶ï¼Œè¡¨ç¤ºä»Šåä¸ä¼šå†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥ã€‚å½“é€šä¿¡ç»“æŸå¸Œæœ›æ–­å¼€è¿æ¥æ—¶ï¼Œé€šä¿¡åŒæ–¹çš„ä¸»æœºä¹‹é—´å°±å¯ä»¥ç›¸äº’äº¤æ¢ <code>FIN</code> ä½ä¸º 1 çš„ TCP æ®µã€‚</li></ul><p>TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ä¼ è¾“å±‚åè®®ï¼Œå®ƒä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚TCPçš„åº•å±‚åŸç†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><p>1.ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼š</p><p>å½“å®¢æˆ·ç«¯è¦ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œé¦–å…ˆå‘é€ä¸€ä¸ª SYNï¼ˆåŒæ­¥ï¼‰åˆ†èŠ‚ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯¥åˆ†èŠ‚åï¼Œå›å¤ä¸€ä¸ª SYN-ACKï¼ˆåŒæ­¥-ç¡®è®¤ï¼‰åˆ†èŠ‚ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å†å›å¤ä¸€ä¸ª ACKï¼ˆç¡®è®¤ï¼‰åˆ†èŠ‚ç»™æœåŠ¡å™¨ï¼Œä»è€Œå®Œæˆè¿æ¥çš„å»ºç«‹ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯TCPè¿æ¥çš„â€œä¸‰æ¬¡æ¡æ‰‹â€ã€‚</p><p>2.æ•°æ®ä¼ è¾“ï¼š</p><p>TCPå°†æ•°æ®åˆ†å‰²æˆä»¥æŠ¥æ–‡æ®µä¸ºå•ä½çš„æ•°æ®å—ï¼Œå¹¶ä½¿ç”¨åºåˆ—å·å’Œç¡®è®¤å·æ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚å‘é€æ–¹å‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå°†è¯¥æŠ¥æ–‡æ®µçš„åºåˆ—å·å’Œæ•°æ®ä¸€èµ·å‘é€ç»™æ¥æ”¶æ–¹ï¼Œå¹¶ç­‰å¾…æ¥æ”¶æ–¹çš„ç¡®è®¤ã€‚å¦‚æœå‘é€æ–¹æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå®ƒä¼šé‡æ–°å‘é€è¯¥æŠ¥æ–‡æ®µï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤ä¸ºæ­¢ã€‚æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µåï¼Œä¼šå›å¤ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µï¼Œç¡®è®¤æ”¶åˆ°è¯¥æŠ¥æ–‡æ®µï¼Œå¹¶å°†ä¸‹ä¸€ä¸ªæœŸæœ›æ¥æ”¶çš„æŠ¥æ–‡æ®µçš„åºåˆ—å·å‘Šè¯‰å‘é€æ–¹ã€‚</p><p>3.æµé‡æ§åˆ¶ï¼š</p><p>TCPä½¿ç”¨æ»‘åŠ¨çª—å£åè®®æ¥æ§åˆ¶æ•°æ®ä¼ è¾“çš„é€Ÿç‡ã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„ç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œå‘é€æ–¹çš„çª—å£å¤§å°è¡¨ç¤ºå¯ä»¥å‘é€çš„æ•°æ®é‡ï¼Œæ¥æ”¶æ–¹çš„çª—å£å¤§å°è¡¨ç¤ºå¯ä»¥æ¥æ”¶çš„æ•°æ®é‡ã€‚å‘é€æ–¹åªèƒ½å‘é€æ¥æ”¶æ–¹çª—å£å¤§å°ä»¥å†…çš„æ•°æ®ï¼Œä»¥é¿å…æ¥æ”¶æ–¹æ¥æ”¶ä¸äº†å¤ªå¤šæ•°æ®è€Œå¯¼è‡´çš„ä¸¢åŒ…ã€‚</p><p>4.æ‹¥å¡æ§åˆ¶ï¼š</p><p>TCPä½¿ç”¨æ‹¥å¡æ§åˆ¶ç®—æ³•æ¥é¿å…ç½‘ç»œæ‹¥å¡ã€‚å½“ç½‘ç»œä¸­çš„æ•°æ®åŒ…è¿‡å¤šæ—¶ï¼ŒTCPä¼šé‡‡å–æªæ–½å‡å°‘å‘é€çš„æ•°æ®é‡ï¼Œä»¥é¿å…æ‹¥å¡çš„å‘ç”Ÿã€‚å¸¸è§çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…å’Œæ‹¥å¡æ¢å¤ç­‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒTCPåè®®åœ¨ä¼ è¾“æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨äº†å¤šç§æŠ€æœ¯æ¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€ä¼ è¾“é€Ÿåº¦å’Œç½‘ç»œæ‹¥å¡çš„é¿å…ã€‚</p><p>é€šä¿¡å¯ä»¥å‚è€ƒï¼šTCPå¦‚ä½•ä¿è¯å¯é ä¼ è¾“</p><p>TCPå®ç°é€šä¿¡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>å»ºç«‹è¿æ¥ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªSYNæŠ¥æ–‡æ®µï¼ŒæœåŠ¡å™¨æ”¶åˆ°åå›å¤ä¸€ä¸ªSYN+ACKæŠ¥æ–‡æ®µï¼Œå®¢æˆ·ç«¯å†å›å¤ä¸€ä¸ªACKæŠ¥æ–‡æ®µï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹TCPè¿æ¥ã€‚</li><li>æ•°æ®ä¼ è¾“ï¼šTCPä½¿ç”¨åºåˆ—å·å’Œç¡®è®¤å·æ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚å‘é€æ–¹å°†æ•°æ®åˆ†å‰²æˆä»¥æŠ¥æ–‡æ®µä¸ºå•ä½çš„æ•°æ®å—ï¼ŒåŠ ä¸Šä¸€ä¸ªåºåˆ—å·ï¼Œå‘é€ç»™æ¥æ”¶æ–¹ã€‚æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µåï¼Œå›å¤ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒ…å«æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ï¼Œå‘é€æ–¹æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œå°†ä¸‹ä¸€ä¸ªéœ€è¦å‘é€çš„åºåˆ—å·æ›´æ–°ä¸ºæœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ã€‚</li><li>æ‹¥å¡æ§åˆ¶ï¼šTCPä½¿ç”¨æ‹¥å¡æ§åˆ¶ç®—æ³•æ¥é¿å…ç½‘ç»œæ‹¥å¡ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§å’Œç½‘ç»œçš„ç¨³å®šæ€§ã€‚å¸¸è§çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…å’Œå¿«é€Ÿé‡ä¼ ç­‰ã€‚</li><li>æµé‡æ§åˆ¶ï¼šTCPä½¿ç”¨æ»‘åŠ¨çª—å£åè®®æ¥æ§åˆ¶æ•°æ®ä¼ è¾“çš„é€Ÿç‡ã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„ç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œå‘é€æ–¹çš„çª—å£å¤§å°è¡¨ç¤ºå¯ä»¥å‘é€çš„æ•°æ®é‡ï¼Œæ¥æ”¶æ–¹çš„çª—å£å¤§å°è¡¨ç¤ºå¯ä»¥æ¥æ”¶çš„æ•°æ®é‡ã€‚å‘é€æ–¹åªèƒ½å‘é€æ¥æ”¶æ–¹çª—å£å¤§å°ä»¥å†…çš„æ•°æ®ï¼Œä»¥é¿å…æ¥æ”¶æ–¹æ¥æ”¶ä¸äº†å¤ªå¤šæ•°æ®è€Œå¯¼è‡´çš„ä¸¢åŒ…ã€‚</li><li>æ–­å¼€è¿æ¥ï¼šTCPä½¿ç”¨å››æ¬¡æŒ¥æ‰‹æ¥æ–­å¼€è¿æ¥ã€‚å½“å®¢æˆ·ç«¯è¦å…³é—­è¿æ¥æ—¶ï¼Œå‘é€ä¸€ä¸ªFINæŠ¥æ–‡æ®µç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å›å¤ä¸€ä¸ªACKæŠ¥æ–‡æ®µï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINæŠ¥æ–‡æ®µï¼Œå®¢æˆ·ç«¯å›å¤ä¸€ä¸ªACKæŠ¥æ–‡æ®µï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ï¼Œæ–­å¼€TCPè¿æ¥ã€‚</li></ol><h3 id="tcp-udp-åè®®çš„åŒºåˆ«ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘" tabindex="-1"><a class="header-anchor" href="#tcp-udp-åè®®çš„åŒºåˆ«ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘" aria-hidden="true">#</a> TCP, UDP åè®®çš„åŒºåˆ«ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘</h3><table><thead><tr><th></th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td>è¿æ¥</td><td>é¢å‘è¿æ¥</td><td>æ— è¿æ¥</td></tr><tr><td>å¯é æ€§</td><td>å¯é </td><td>ä¸å¯é </td></tr><tr><td>æ•°æ®æµæ–¹å¼</td><td>å­—èŠ‚æµ</td><td>æŠ¥æ–‡æµ</td></tr><tr><td>é€Ÿåº¦</td><td>æ…¢</td><td>å—</td></tr></tbody></table><p>UDP åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºåœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP å´æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ï¼ˆä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰ï¼Œæ¯”å¦‚ï¼š QQ è¯­éŸ³ã€ QQ è§†é¢‘ ã€ç›´æ’­ç­‰ç­‰</p><p>TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ã€‚ç”±äº TCP è¦æä¾›å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼ˆTCP çš„å¯é ä½“ç°åœ¨ TCP åœ¨ä¼ é€’æ•°æ®ä¹‹å‰ï¼Œä¼šæœ‰ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸”åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ å®Œåï¼Œè¿˜ä¼šæ–­å¼€è¿æ¥ç”¨æ¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼‰ï¼Œè¿™éš¾ä»¥é¿å…å¢åŠ äº†è®¸å¤šå¼€é”€ï¼Œå¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ï¼Œè®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚è¿™ä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„é¦–éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šå¤„ç†æœºèµ„æºã€‚TCP ä¸€èˆ¬ç”¨äºæ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯</p><figure><img src="'+Fa+'" alt="image-20220405203700321" tabindex="0" loading="lazy"><figcaption>image-20220405203700321</figcaption></figure><h3 id="tcp-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘" tabindex="-1"><a class="header-anchor" href="#tcp-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘" aria-hidden="true">#</a> TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ã€è…¾è®¯å…‰å­å·¥ä½œå®¤ã€‘</h3><p><code>çŸ­æ–‡å›ç­”å‚è€ƒï¼šhttps://www.iamshuaidi.com/1298.html or https://github.com/wolverinn/Waking-Up/blob/master/Computer%20Network.md#TCP%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E4%BC%A0%E8%BE%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7</code></p><p>ä¸‹é¢æ˜¯ç†è§£ï¼š</p><p>é¦–å…ˆè§£é‡Šä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯å¯é ä¼ è¾“ï¼š<strong>å¯é ä¼ è¾“å°±æ˜¯ä¿è¯æ¥æ”¶æ–¹æ”¶åˆ°çš„å­—èŠ‚æµå’Œå‘é€æ–¹å‘å‡ºçš„å­—èŠ‚æµæ˜¯å®Œå…¨ä¸€æ ·çš„</strong>ã€‚</p><p>ç½‘ç»œå±‚æ˜¯æ²¡æœ‰å¯é ä¼ è¾“æœºåˆ¶çš„ï¼Œå°½è‡ªå·±æœ€å¤§çš„åŠªåŠ›è¿›è¡Œäº¤ä»˜ã€‚è€Œä¼ è¾“å±‚ä½¿ç”¨ TCP å®ç°å¯é ä¼ è¾“ï¼ŒTCP ä¿è¯å¯é ä¼ è¾“çš„æœºåˆ¶æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>1ï¼‰æ ¡éªŒå’Œ Checksumï¼ˆç¨ä½œäº†è§£å³å¯ï¼‰</li><li>2ï¼‰åºåˆ—å·å’Œç¡®è®¤åº”ç­”æœºåˆ¶ï¼ˆé‡è¦ï¼‰</li><li>3ï¼‰é‡ä¼ æœºåˆ¶ï¼ˆé‡è¦ï¼‰</li><li>4ï¼‰æµé‡æ§åˆ¶ï¼ˆæ»‘åŠ¨çª—å£åè®®ï¼‰ï¼ˆéå¸¸é‡è¦ï¼‰</li><li>5ï¼‰æ‹¥å¡æ§åˆ¶ï¼ˆé‡è¦ï¼‰</li></ul><p>ä»¥ä¸Šé™¤äº†æ ¡éªŒå’Œå¤§å®¶å¯ä»¥åªç¨ä½œäº†è§£ä¹‹å¤–ï¼Œå…¶ä»–éƒ½æ˜¯éå¸¸é‡è¦çš„ï¼ŒåŠ¡å¿…çƒ‚ç†Ÿäºå¿ƒ</p><p>æ ¡éªŒå’Œ</p><hr><p>æ‰€è°“ TCP çš„æ ¡éªŒå’Œï¼ˆChecksumï¼‰å°±æ˜¯è¯´ï¼šç”±å‘é€ç«¯è®¡ç®—å¾…å‘é€ TCP æŠ¥æ–‡æ®µçš„æ ¡éªŒå’Œï¼Œç„¶åæ¥æ”¶ç«¯å¯¹æ¥æ”¶åˆ°çš„ TCP æŠ¥æ–‡æ®µéªŒè¯å…¶æ ¡éªŒå’Œï¼ˆTCP çš„æ ¡éªŒå’Œæ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ ¡éªŒå’Œï¼‰ã€‚<strong>å…¶ç›®çš„æ˜¯ä¸ºäº†å‘ç° TCP çš„é¦–éƒ¨å’Œæ•°æ®åœ¨å‘é€ç«¯åˆ°æ¥æ”¶ç«¯ä¹‹é—´æ˜¯å¦å‘ç”Ÿäº†å˜åŠ¨ã€‚å¦‚æœæ¥æ”¶æ–¹æ£€æµ‹åˆ°æ ¡éªŒå’Œæœ‰å·®é”™ï¼Œåˆ™è¯¥ TCP æŠ¥æ–‡æ®µä¼šè¢«ç›´æ¥ä¸¢å¼ƒ</strong>ã€‚</p><p>å…³äºæ ¡éªŒå’Œæ˜¯å¦‚ä½•è®¡ç®—å’ŒéªŒè¯çš„ï¼Œå¹¶éé«˜é¢‘é‡ç‚¹çŸ¥è¯†ï¼Œæœ¬æ–‡å°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯è‡ªè¡Œç™¾åº¦</p><p>TCP åœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œéœ€è¦åŠ ä¸Šä¸€ä¸ª 12 å­—èŠ‚çš„<strong>ä¼ªé¦–éƒ¨</strong>ã€‚</p><p>å…¶å® UDP ä¹Ÿæœ‰æ ¡éªŒå’Œæœºåˆ¶ï¼Œåªä¸è¿‡æ˜¯å¯é€‰çš„ï¼Œè€Œ TCP çš„æ ¡éªŒå’Œæ˜¯å¿…é¡»çš„ï¼ŒTCP å’Œ UDP åœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶éƒ½éœ€è¦åŠ ä¸Šä¸€ä¸ª 12 å­—èŠ‚çš„ä¼ªé¦–éƒ¨ã€‚</p><p>è§£é‡Šä¸‹ä¼ªé¦–éƒ¨çš„æ¦‚å¿µï¼Œä¼ªé¦–éƒ¨çš„æ•°æ®æ˜¯ä» IP æ•°æ®æŠ¥å¤´è·å–çš„ï¼Œå…±æœ‰ 12 å­—èŠ‚ï¼ŒåŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼šæº IP åœ°å€ã€ç›®çš„ IP åœ°å€ã€ä¿ç•™å­—èŠ‚ (ç½® 0)ã€ä¼ è¾“å±‚åè®®å· (TCP æ˜¯ 6)ã€TCP æŠ¥æ–‡é•¿åº¦ (é¦–éƒ¨ + æ•°æ®)ï¼š</p><figure><img src="'+Ja+'" alt="image-20220606204018346" tabindex="0" loading="lazy"><figcaption>image-20220606204018346</figcaption></figure><p><strong>ä¼ªé¦–éƒ¨æ˜¯ä¸ºäº†å¢åŠ  TCP æ ¡éªŒå’Œçš„æ£€é”™èƒ½åŠ›ï¼šå¦‚æ ¹æ®ç›®çš„ IP åœ°å€æ£€æŸ¥è¿™ä¸ª TCP æŠ¥æ–‡æ˜¯ä¸æ˜¯ä¼ ç»™æˆ‘çš„ã€æ ¹æ®ä¼ è¾“å±‚åè®®å·æ£€æŸ¥ä¼ è¾“å±‚åè®®æ˜¯å¦é€‰å¯¹äº†...... ä¼ªé¦–éƒ¨åªåœ¨æ ¡éªŒçš„æ—¶å€™ä½¿ç”¨</strong>ã€‚</p><p>åºåˆ—å·å’Œç¡®è®¤åº”ç­”æœºåˆ¶</p><hr><p>TCP æŠ¥æ–‡æ®µçš„é¦–éƒ¨ä¸­æœ‰ä¸€ä¸ªåºå·å­—æ®µï¼šæŒ‡çš„æ˜¯è¯¥æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼ˆä¸€ä¸ªå­—èŠ‚å ä¸€ä¸ªåºå·ï¼‰</p><figure><img src="'+Ua+'" alt="image-20220606204134384" tabindex="0" loading="lazy"><figcaption>image-20220606204134384</figcaption></figure><p>ç¡®è®¤åº”ç­”æœºåˆ¶å°±æ˜¯<strong>æ¥æ”¶æ–¹æ”¶åˆ° TCP æŠ¥æ–‡æ®µåå°±ä¼šè¿”å›ä¸€ä¸ªç¡®è®¤åº”ç­”æ¶ˆæ¯</strong>ï¼š</p><figure><img src="'+Ka+'" alt="image-20220606204140948" tabindex="0" loading="lazy"><figcaption>image-20220606204140948</figcaption></figure><p>ç¡®è®¤åº”ç­”æœºåˆ¶å’Œé‡ä¼ æœºåˆ¶ä¸åˆ†å®¶ï¼Œä¸¤è€…ç´§å¯†ç›¸è¿ã€‚</p><p>é‡ä¼ æœºåˆ¶</p><hr><p>åœ¨é”™ç»¼å¤æ‚çš„ç½‘ç»œï¼Œå¹¶ä¸ä¸€å®šèƒ½å¦‚ä¸Šå›¾é‚£ä¹ˆé¡ºåˆ©çš„ä¼ è¾“æŠ¥æ–‡ï¼ŒæŠ¥æ–‡å­˜åœ¨ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚æŠ¥æ–‡ä¸¢å¤±çš„å¯èƒ½å› ç´ æœ‰å¾ˆå¤šç§ï¼ŒåŒ…æ‹¬åº”ç”¨æ•…éšœï¼Œè·¯ç”±è®¾å¤‡è¿‡è½½ï¼Œæˆ–æš‚æ—¶çš„æœåŠ¡å®•æœºã€‚æŠ¥æ–‡çº§åˆ«é€Ÿåº¦æ˜¯å¾ˆé«˜çš„ï¼Œ<strong>é€šå¸¸æ¥è¯´æŠ¥æ–‡çš„ä¸¢å¤±æ˜¯æš‚æ—¶çš„ï¼Œå› æ­¤ TCP èƒ½å¤Ÿå‘ç°å’Œæ¢å¤æŠ¥æ–‡ä¸¢å¤±æ˜¾å¾—å°¤ä¸ºé‡è¦</strong>ã€‚</p><p><strong>é‡ä¼ æœºåˆ¶</strong>æ˜¯ TCP æœ€åŸºæœ¬çš„é”™è¯¯æ¢å¤åŠŸèƒ½ï¼Œå¸¸è§çš„é‡ä¼ æœºåˆ¶æœ‰å¦‚ä¸‹ï¼š</p><ul><li>è¶…æ—¶é‡ä¼ </li><li>å¿«é€Ÿé‡ä¼ </li></ul><p>â‘  è¶…æ—¶é‡ä¼ </p><p>å¤§æ¦‚ä¸€è¯´åˆ°é‡ä¼ å¤§å®¶ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯è¶…æ—¶é‡ä¼ å§ã€‚è¶…æ—¶é‡ä¼ å°±æ˜¯ TCP å‘é€æ–¹åœ¨å‘é€æŠ¥æ–‡çš„æ—¶å€™ï¼Œè®¾å®šä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœåœ¨è§„å®šçš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼Œå‘é€æ–¹å°±ä¼šé‡ä¼ è¿™ä¸ªå·²å‘é€çš„æŠ¥æ–‡æ®µã€‚</p><p>å¯¹äºå‘é€æ–¹æ²¡æœ‰æ­£ç¡®æ¥æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ ACK ç¡®è®¤æŠ¥æ–‡çš„æƒ…å†µï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§ï¼ˆä¹Ÿå°±æ˜¯åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼‰ï¼š</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µï¼š<strong>æŠ¥æ–‡æ®µä¸¢å¤±</strong></li></ul><figure><img src="'+Qa+'" alt="image-20220606204212582" tabindex="0" loading="lazy"><figcaption>image-20220606204212582</figcaption></figure><p>ç¬¬äºŒç§æƒ…å†µï¼š<strong>æ¥æ”¶æ–¹çš„ ACK ç¡®è®¤æŠ¥æ–‡ä¸¢å¤±</strong></p><figure><img src="'+Va+'" alt="image-20220606204221063" tabindex="0" loading="lazy"><figcaption>image-20220606204221063</figcaption></figure><p>è¶…æ—¶é‡ä¼ æ—¶é—´æˆ‘ä»¬ä¸€èˆ¬ç”¨ <strong>RTO</strong>ï¼ˆRetransmission Timeoutï¼‰ æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ª RTO è®¾ç½®ä¸ºå¤šå°‘æœ€åˆé€‚å‘¢ï¼Œä¹Ÿå°±æ˜¯è¯´ç»è¿‡å¤šé•¿æ—¶é—´è¿›è¡Œé‡ä¼ æœ€å¥½ï¼Ÿ</p><p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®²è§£ä¸€ä¸‹ <strong>RTTï¼ˆRound-Trip Time å¾€è¿”æ—¶å»¶ï¼‰</strong> çš„æ¦‚å¿µï¼šRTT å°±æ˜¯<strong>æ•°æ®ä»ç½‘ç»œä¸€ç«¯ä¼ é€åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´</strong>ï¼Œä¹Ÿå°±æ˜¯æŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶é—´ã€‚</p><figure><img src="'+Ga+'" alt="image-20220606204229061" tabindex="0" loading="lazy"><figcaption>image-20220606204229061</figcaption></figure><p>æ˜¾ç„¶ï¼Œâ­ <strong>è¶…æ—¶é‡ä¼ æ—¶é—´ RTO çš„å€¼åº”è¯¥ç•¥å¤§äºæŠ¥æ–‡å¾€è¿” RTT çš„å€¼</strong>ï¼š</p><figure><img src="'+Xa+'" alt="image-20220606204236323" tabindex="0" loading="lazy"><figcaption>image-20220606204236323</figcaption></figure><p>å¯ä»¥å‡æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¶…æ—¶é‡ä¼ æ—¶é—´ RTO è¿œå¤§äºæˆ–å°äº RTTï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼š</p><ul><li><strong>RTO è¿œå¤§äº RTT</strong>ï¼šç½‘ç»œçš„ç©ºé—²æ—¶é—´å¢å¤§ï¼Œé™ä½äº†ç½‘ç»œä¼ è¾“æ•ˆç‡</li></ul><figure><img src="'+Wa+'" alt="image-20220606204247237" tabindex="0" loading="lazy"><figcaption>image-20220606204247237</figcaption></figure><p><strong>RTO å°äº RTT</strong>ï¼šä¸å¿…è¦çš„é‡ä¼ ï¼Œå¯¼è‡´ç½‘ç»œè´Ÿè·å¢å¤§</p><figure><img src="'+Ya+'" alt="image-20220606204255302" tabindex="0" loading="lazy"><figcaption>image-20220606204255302</figcaption></figure><p>å¦‚æœè¶…æ—¶é‡ä¼ çš„æ•°æ®åˆè¶…æ—¶äº†è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸTCP çš„ç­–ç•¥æ˜¯<strong>é‡ä¼ çš„è¶…æ—¶é—´éš”åŠ å€</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æ¯è¿›è¡Œä¸€æ¬¡è¶…æ—¶é‡ä¼ ï¼Œéƒ½ä¼šå°†ä¸‹ä¸€æ¬¡é‡ä¼ çš„è¶…æ—¶æ—¶é—´é—´éš”è®¾ä¸ºå…ˆå‰å€¼çš„ä¸¤å€</strong>ã€‚</p><p>è¶…æ—¶è§¦å‘é‡ä¼ å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œè¶…æ—¶å‘¨æœŸå¯èƒ½ç›¸å¯¹è¾ƒé•¿ã€‚<strong>æœ‰æ²¡æœ‰ä¸€ç§æœºåˆ¶å¯ä»¥å‡å°‘è¶…æ—¶é‡ä¼ çš„ç­‰å¾…æ—¶é—´å‘¢</strong>ï¼Ÿäºæ˜¯ ã€Œå¿«é€Ÿé‡ä¼ ã€ æœºåˆ¶åº”è¿è€Œç”Ÿ</p><p>â‘¡ å¿«é€Ÿé‡ä¼ </p><p><strong>å¿«é€Ÿé‡ä¼ ï¼ˆFast Retransmitï¼‰æœºåˆ¶ä¸ä»¥æ—¶é—´ä¸ºé©±åŠ¨ï¼Œè€Œæ˜¯ä»¥æ•°æ®é©±åŠ¨é‡ä¼ </strong>ã€‚</p><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶çš„åŸç†ï¼šæ¯å½“æ¥æ”¶æ–¹æ”¶åˆ°æ¯”æœŸæœ›åºå·å¤§çš„å¤±åºæŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œå°±å‘å‘é€æ–¹å‘é€ä¸€ä¸ª<strong>å†—ä½™ ACK</strong>ï¼ŒæŒ‡æ˜ä¸‹ä¸€ä¸ªæœŸå¾…å­—èŠ‚çš„åºå·ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå‘é€æ–¹å·²ç»å‘é€ 1ã€2ã€3ã€4ã€5æŠ¥æ–‡æ®µ</p><ul><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 1ï¼Œè¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 3ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 4ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 5ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li><strong>æ¥æ”¶æ–¹æ”¶åˆ° 3 ä¸ªå¯¹äºæŠ¥æ–‡æ®µ 1 çš„å†—ä½™ ACKï¼Œè®¤ä¸ºæŠ¥æ–‡æ®µ 2 ä¸¢å¤±ï¼Œäºæ˜¯é‡ä¼ æŠ¥æ–‡æ®µ 2</strong></li><li>æœ€åï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†æŠ¥æ–‡æ®µ 2ï¼Œæ­¤æ—¶å› ä¸ºæŠ¥æ–‡æ®µ 3ã€4ã€5 éƒ½æ”¶åˆ°äº†ï¼Œæ‰€ä»¥è¿”å› 5 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 6 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li></ul><p>ä¸€å›¾èƒœåƒè¨€ï¼š</p><figure><img src="'+Za+'" alt="image-20220606204316378" tabindex="0" loading="lazy"><figcaption>image-20220606204316378</figcaption></figure><p>æ»‘åŠ¨çª—å£åè®®</p><hr><p>å¯ä»¥è¯´ä¸çŸ¥é“æ»‘åŠ¨çª—å£åè®® = ä¸çŸ¥é“ TCPã€‚è¯¥çŸ¥è¯†ç‚¹çš„åˆ†é‡ä¹‹é‡ï¼Œå¤§å®¶ä¸€å®šå¥½å¥½æŠŠæ¡ã€‚</p><p>â‘  ç´¯ç§¯ç¡®è®¤</p><p>ä¸Šæ–‡è®²å¿«é€Ÿé‡ä¼ çš„æ—¶å€™ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„åˆ°è¿™å¥è¯ â€œæœ€åï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†æŠ¥æ–‡æ®µ 2ï¼Œæ­¤æ—¶å› ä¸ºæŠ¥æ–‡æ®µ 3ã€4ã€5 éƒ½æ”¶åˆ°äº†ï¼Œæ‰€ä»¥è¿”å› 6 çš„ ACK ç¡®è®¤æŠ¥æ–‡ â€ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¿™é‡Œä¼šç›´æ¥è¿”å›æŠ¥æ–‡æ®µ 6 çš„ç¡®è®¤åº”ç­”å‘¢</strong>ï¼Œä¹‹å‰æˆ‘ä»¬ä¸æ˜¯è¯´æ¯å‘é€ä¸€ä¸ª TCP æŠ¥æ–‡æ®µï¼Œå°±è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”å—ï¼ˆåªæœ‰æ”¶åˆ°äº†ä¸Šä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¡®è®¤åº”ç­”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ï¼‰ï¼ŸæŒ‰ç…§è¿™ä¸ªæ¨¡å¼ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆè¿”å›æŠ¥æ–‡æ®µ 3 çš„ç¡®è®¤åº”ç­”å•Šã€‚</p><p>å…¶å®åªæœ‰æ”¶åˆ°äº†ä¸Šä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¡®è®¤åº”ç­”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„è¿™ç§æ¨¡å¼æ•ˆç‡éå¸¸ä½ä¸‹ã€‚æ¯ä¸ªæŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶é—´è¶Šé•¿ï¼Œç½‘ç»œçš„ååé‡å°±è¶Šä½ï¼Œé€šä¿¡çš„æ•ˆç‡å°±è¶Šä½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ è¯´å®Œä¸€å¥è¯ï¼Œæˆ‘åœ¨å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæ²¡æœ‰åŠæ—¶å›å¤ä½ ï¼Œä½ å°±ç­‰ç€æˆ‘åšå®Œå…¶ä»–äº‹æƒ…åå›å¤ä½ ï¼Œä½ æ‰èƒ½è¯´ä¸‹ä¸€å¥è¯ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ç°å®ã€‚</p><p>ä¸ºæ­¤ï¼ŒTCP å¼•å…¥äº† <strong>çª—å£</strong> çš„æ¦‚å¿µã€‚å¯¹äºå‘é€æ–¹æ¥è¯´ï¼Œçª—å£å¤§å°å°±æ˜¯æŒ‡<strong>æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œå¯ä»¥è¿ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼</strong>ã€‚</p><p>â­ çª—å£çš„å®ç°å®é™…ä¸Šæ˜¯æ“ä½œç³»ç»Ÿå¼€è¾Ÿçš„ä¸€ä¸ª<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œå‘é€æ–¹åœ¨ç­‰å¾…ç¡®è®¤åº”ç­”æŠ¥æ–‡è¿”å›ä¹‹å‰ï¼Œå¿…é¡»åœ¨ç¼“å†²åŒºä¸­ä¿ç•™å·²å‘é€çš„æ•°æ®ã€‚å¦‚æœåœ¨è§„å®šæ—¶é—´é—´éš”å†…æ”¶åˆ°ç¡®è®¤åº”ç­”æŠ¥æ–‡ï¼Œå°±å¯ä»¥å°†æ•°æ®ä»ç¼“å†²åŒºä¸­æ¸…é™¤ã€‚</p><p>å‡è®¾çª—å£å¤§å°ä¸º <code>5</code> ä¸ª TCP æ®µï¼Œé‚£ä¹ˆå‘é€æ–¹å°±å¯ä»¥ã€Œè¿ç»­å‘é€ã€ <code>5</code> ä¸ª TCP æ®µ</p><p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼šå‘é€æ–¹å·²ç»å‘é€ 1ã€2ã€3ã€4ã€5æŠ¥æ–‡æ®µ</p><ul><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 1ï¼Œè¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 3ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 4ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li>æ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡æ®µ 5ï¼Œä»ç„¶è¿”å› 1 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 2 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li><li><strong>å‘é€æ–¹æ”¶åˆ° 3 ä¸ªå¯¹äºæŠ¥æ–‡æ®µ 1 çš„å†—ä½™ ACKï¼ˆor ç­‰å¾…è¶…æ—¶ï¼‰ï¼Œè®¤ä¸ºæŠ¥æ–‡æ®µ 2 ä¸¢å¤±ï¼Œäºæ˜¯é‡ä¼ æŠ¥æ–‡æ®µ 2</strong></li><li>æœ€åï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†æŠ¥æ–‡æ®µ 2ï¼Œæ­¤æ—¶å› ä¸ºæŠ¥æ–‡æ®µ 3ã€4ã€5 éƒ½æ”¶åˆ°äº†ï¼Œæ‰€ä»¥è¿”å› 6 çš„ ACK ç¡®è®¤æŠ¥æ–‡ï¼ˆç¡®è®¤å·ä¸ºæŠ¥æ–‡æ®µ 6 çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰</li></ul><p>ç®€å•è¯´ï¼Œ<strong>åªè¦å‘é€æ–¹æ”¶åˆ°äº† ACK 600 çš„ç¡®è®¤åº”ç­”ï¼Œå°±æ„å‘³ç€ç¬¬ 600 å­—èŠ‚ä¹‹å‰çš„æ‰€æœ‰æ•°æ®ã€Œæ¥æ”¶æ–¹ã€éƒ½æ”¶åˆ°äº†</strong>ã€‚è¿™ä¸ªæ¨¡å¼å°±å«<strong>ç´¯ç§¯ç¡®è®¤</strong>æˆ–è€…<strong>ç´¯ç§¯åº”ç­”</strong>ã€‚</p><p>â‘¡ å‘é€æ–¹çš„æ»‘åŠ¨çª—å£</p><p>å…ˆæ¥çœ‹çœ‹å‘é€æ–¹çš„çª—å£ï¼Œä¸‹å›¾å°±æ˜¯å‘é€æ–¹çš„æ•°æ®ï¼Œæ ¹æ®å¤„ç†çš„æƒ…å†µåˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å·²å‘é€å¹¶æ”¶åˆ° ACK ç¡®è®¤åº”ç­”çš„æ•°æ®</li><li>å·²å‘é€ä½†æœªæ”¶åˆ° ACK ç¡®è®¤åº”ç­”çš„æ•°æ®</li><li>æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…çš„æ•°æ®</li><li>æœªå‘é€ä½†æ€»å¤§å°è¶…è¿‡æ¥æ”¶æ–¹å¤„ç†èŒƒå›´çš„æ•°æ®</li></ul><figure><img src="'+$a+'" alt="image-20220606204411787" tabindex="0" loading="lazy"><figcaption>image-20220606204411787</figcaption></figure><p>å½“å‘é€æ–¹æŠŠæ•°æ®å…¨éƒ¨å‘é€å‡ºå»åï¼Œå¯ç”¨çª—å£çš„å¤§å°å°±ä¸º 0 äº†ï¼Œè¡¨æ˜å¯ç”¨çª—å£è€—å°½ï¼Œåœ¨æ²¡æ”¶åˆ° ACK ç¡®è®¤ä¹‹å‰æ— æ³•ç»§ç»­å‘é€æ•°æ®ï¼š</p><figure><img src="'+ne+'" alt="image-20220606204418891" tabindex="0" loading="lazy"><figcaption>image-20220606204418891</figcaption></figure><p>å½“æ”¶åˆ°ä¹‹å‰å‘é€çš„æ•°æ® <code>32~36</code> å­—èŠ‚çš„ ACK ç¡®è®¤åº”ç­”åï¼Œå¦‚æœå‘é€çª—å£çš„å¤§å°æ²¡æœ‰å˜åŒ–ï¼Œåˆ™<strong>æ»‘åŠ¨çª—å£å¾€å³è¾¹ç§»åŠ¨ 5 ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæœ‰ 5 ä¸ªå­—èŠ‚çš„æ•°æ®è¢«ç¡®è®¤åº”ç­”</strong>ï¼Œæ¥ä¸‹æ¥ <code>52~56</code> å­—èŠ‚åˆå˜æˆäº†å¯ç”¨çª—å£ï¼Œé‚£ä¹ˆåç»­ä¹Ÿå°±å¯ä»¥å‘é€ <code>52~56</code> è¿™ 5 ä¸ªå­—èŠ‚çš„æ•°æ®äº†ï¼š</p><figure><img src="'+se+'" alt="image-20220606204425586" tabindex="0" loading="lazy"><figcaption>image-20220606204425586</figcaption></figure><p>â‘¢ æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£</p><p>æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£å¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å·²æˆåŠŸæ¥æ”¶å¹¶ç¡®è®¤çš„æ•°æ®</li><li>æœªæ”¶åˆ°æ•°æ®ä½†å¯ä»¥æ¥æ”¶çš„æ•°æ®</li><li>æœªæ”¶åˆ°æ•°æ®ä¸”ä¸å¯ä»¥æ¥æ”¶çš„æ•°æ®ï¼ˆè¶…å‡ºæ¥æ”¶æ–¹çª—å£å¤§å°ï¼‰</li></ul><figure><img src="'+ae+'" alt="image-20220606204437905" tabindex="0" loading="lazy"><figcaption>image-20220606204437905</figcaption></figure><p>åŒæ ·çš„ï¼Œæ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£åœ¨æˆåŠŸæ¥æ”¶å¹¶ç¡®è®¤çš„æ•°æ®åï¼Œçª—å£å³ç§»ã€‚</p><p>æµé‡æ§åˆ¶</p><hr><p>æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä¸»æœº A ä¸€ç›´å‘ä¸»æœº B å‘é€æ•°æ®ï¼Œä¸è€ƒè™‘ä¸»æœº B çš„æ¥æ”¶èƒ½åŠ›ï¼Œåˆ™å¯èƒ½å¯¼è‡´ä¸»æœº B çš„æ¥æ”¶ç¼“å†²åŒºæ»¡äº†è€Œæ— æ³•å†æ¥æ”¶æ•°æ®ï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„æ•°æ®ä¸¢åŒ…ï¼Œå¼•å‘é‡ä¼ æœºåˆ¶ã€‚è€Œåœ¨é‡ä¼ çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¸»æœº B çš„æ¥æ”¶ç¼“å†²åŒºæƒ…å†µä»æœªå¥½è½¬ï¼Œåˆ™ä¼šå°†å¤§é‡çš„æ—¶é—´æµªè´¹åœ¨é‡ä¼ æ•°æ®ä¸Šï¼Œé™ä½ä¼ é€æ•°æ®çš„æ•ˆç‡ã€‚</p><p>æ‰€ä»¥å¼•å…¥äº†æµé‡æ§åˆ¶æœºåˆ¶ï¼Œä¸»æœº B é€šè¿‡å‘Šè¯‰ä¸»æœº A è‡ªå·±æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ï¼Œæ¥ä½¿ä¸»æœº A æ§åˆ¶å‘é€çš„æ•°æ®é‡ã€‚<strong>æ€»ç»“æ¥è¯´ï¼šæ‰€è°“æµé‡æ§åˆ¶å°±æ˜¯æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶</strong>ã€‚</p><p>â­ <strong>TCP å®ç°æµé‡æ§åˆ¶ä¸»è¦å°±æ˜¯é€šè¿‡ æ»‘åŠ¨çª—å£åè®®</strong>ã€‚</p><p>ä¸Šæ–‡æˆ‘ä»¬æåˆ°äº†æ»‘åŠ¨çª—å£å¤§å°ï¼Œä½†æ˜¯æ²¡è¯´çª—å£å¤§å°åœ¨å“ªé‡Œè®¾ç½®ï¼Œå…¶å®è¿™ä¸ªå’Œ TCP æŠ¥æ–‡é¦–éƒ¨ä¸­çš„ <strong>çª—å£å¤§å° Window</strong> å­—æ®µæœ‰å…³ã€‚TCP æŠ¥æ–‡çš„é¦–éƒ¨æ ¼å¼ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ª 16 ä½çš„ <strong>çª—å£å¤§å° Window</strong> å­—æ®µï¼š</p><figure><img src="'+ee+'" alt="image-20220606204518089" tabindex="0" loading="lazy"><figcaption>image-20220606204518089</figcaption></figure><p>è¯¥å­—æ®µçš„å«ä¹‰æ˜¯<strong>æŒ‡è‡ªå·±æ¥æ”¶ç¼“å†²åŒºçš„å‰©ä½™å¤§å°</strong>ï¼Œäºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥ã€‚</p><p>æ‰€ä»¥ï¼Œé€šå¸¸æ¥è¯´<strong>çª—å£å¤§å°æ˜¯ç”±æ¥æ”¶æ–¹æ¥å†³å®šçš„</strong>ã€‚</p><p>ğŸ’¡ è¿™æ®µè¯å¤§å®¶ä¸€å®šè¦ç†è§£å“¦ï¼šæ¥æ”¶ç«¯ä¼šåœ¨å‘é€ ACK ç¡®è®¤åº”ç­”æŠ¥æ–‡æ—¶ï¼Œå°†è‡ªå·±çš„å³æ—¶çª—å£å¤§å°ï¼ˆæ¥æ”¶çª—å£ <code>rwnd</code>ï¼‰å¡«å…¥ï¼Œå¹¶è·Ÿéš ACK æŠ¥æ–‡ä¸€èµ·å‘é€å‡ºå»ã€‚è€Œå‘é€æ–¹æ ¹æ®æ¥æ”¶åˆ°çš„ ACK æŠ¥æ–‡ä¸­çš„çª—å£å¤§å°çš„å€¼æ”¹å˜è‡ªå·±çš„å‘é€é€Ÿåº¦ã€‚å¦‚æœæ¥æ”¶åˆ°çª—å£å¤§å°çš„å€¼ä¸º 0ï¼Œé‚£ä¹ˆå‘é€æ–¹å°†åœæ­¢å‘é€æ•°æ®ã€‚å¹¶å®šæœŸçš„å‘æ¥æ”¶ç«¯å‘é€çª—å£æ¢æµ‹æ•°æ®æ®µï¼Œæé†’æ¥æ”¶ç«¯æŠŠçª—å£å¤§å°å‘Šè¯‰å‘é€ç«¯ã€‚</p><p>ä¸€å›¾èƒœå‰è¨€ï¼š</p><figure><img src="'+te+'" alt="image-20220606204530377" tabindex="0" loading="lazy"><figcaption>image-20220606204530377</figcaption></figure><p>æ‹¥å¡æ§åˆ¶</p><hr><p>æ‰€è°“æ‹¥å¡å°±æ˜¯è¯´ï¼šåœ¨æŸæ®µæ—¶é—´ï¼Œå¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼ˆ<strong>å³ éœ€å¤§äºä¾›</strong>)ï¼Œç½‘ç»œçš„æ€§èƒ½å˜å·®ã€‚</p><p>å¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡ï¼ŒTCP æŠ¥æ–‡å¯èƒ½ä¼šå¤§é‡ä¸¢å¤±ï¼Œæ­¤æ—¶å°±ä¼šå¤§é‡è§¦å‘é‡ä¼ æœºåˆ¶ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ‹¥å¡ç¨‹åº¦æ›´é«˜ï¼Œä¸¥é‡å½±å“ä¼ è¾“ã€‚</p><p>å…¶å®åªè¦ã€Œå‘é€æ–¹ã€æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…æ¥æ”¶åˆ° ACK åº”ç­”æŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯<strong>è§¦å‘äº†é‡ä¼ æœºåˆ¶ï¼Œå°±ä¼šè®¤ä¸ºç½‘ç»œå‡ºç°äº†æ‹¥å¡ã€‚</strong></p><p>å› æ­¤å½“å‡ºç°æ‹¥å¡æ—¶ï¼Œåº”å½“æ§åˆ¶å‘é€æ–¹çš„é€Ÿç‡ã€‚è¿™ä¸€ç‚¹å’Œæµé‡æ§åˆ¶å¾ˆåƒï¼Œä½†æ˜¯<strong>å‡ºå‘ç‚¹ä¸åŒ</strong>ã€‚</p><p>æµé‡æ§åˆ¶æ˜¯ä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½æ¥å¾—åŠæ¥æ”¶ï¼Œè€Œæ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é™ä½æ•´ä¸ªç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œ<strong>é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ã€‚</strong></p><p>ä¸ºäº†è°ƒèŠ‚å‘é€æ–¹æ‰€è¦å‘é€æ•°æ®çš„é‡ï¼Œå®šä¹‰äº†ã€Œ<strong>æ‹¥å¡çª—å£</strong> <code>cwnd</code>ã€çš„æ¦‚å¿µã€‚æ‹¥å¡çª—å£æ˜¯å‘é€æ–¹ç»´æŠ¤çš„ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå®ƒä¼šæ ¹æ®<strong>ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–</strong>ï¼š</p><ul><li>åªè¦ç½‘ç»œä¸­å‡ºç°äº†æ‹¥å¡ï¼Œ<code>cwnd</code> å°±ä¼šå‡å°‘</li><li>è‹¥ç½‘ç»œä¸­æ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œ<code>cwnd</code> å°±ä¼šå¢å¤§</li></ul><p>åœ¨å¼•å…¥æ‹¥å¡çª—å£æ¦‚å¿µä¹‹å‰ï¼Œå‘é€çª—å£å¤§å°å’Œæ¥æ”¶çª—å£å¤§å°åŸºæœ¬æ˜¯ç›¸ç­‰çš„å…³ç³»ï¼ˆå–å†³äºæ¥æ”¶çª—å£å¤§å°ï¼‰ã€‚<strong>å¼•å…¥æ‹¥å¡çª—å£åï¼Œå‘é€çª—å£çš„å¤§å°å°±ç­‰äºæ‹¥å¡çª—å£å’Œæ¥æ”¶çª—å£çš„æœ€å°å€¼</strong>ã€‚</p><p>TCP çš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼š</p><ul><li>æ…¢å¼€å§‹</li><li>æ‹¥å¡é¿å…</li><li>å¿«é‡ä¼ </li><li>å¿«æ¢å¤</li></ul><p>ä¸‹é¢è¯¦ç»†è®²è§£è¿™å››ç§ç®—æ³• ğŸ‘‡</p><p>â‘  æ…¢å¼€å§‹</p><p><strong>æ…¢å¼€å§‹</strong>çš„æ€è·¯å°±æ˜¯ï¼šTCP åœ¨åˆšå»ºç«‹è¿æ¥å®Œæˆåï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å¼•èµ·ç½‘ç»œé˜»å¡ã€‚å¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œä¸€ç‚¹ä¸€ç‚¹çš„æé«˜å‘é€æ•°æ®åŒ…çš„æ•°é‡ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚<strong>cwnd åˆå§‹å€¼ä¸º 1ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼Œcwnd åŠ å€</strong>ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰ã€‚</p><figure><img src="'+pe+'" alt="image-20220606204629174" tabindex="0" loading="lazy"><figcaption>image-20220606204629174</figcaption></figure><p>å½“ç„¶ä¸èƒ½ä¸€ç›´æ‰§è¡Œæ…¢å¯åŠ¨ï¼Œè¿™é‡Œä¼šè®¾ç½®ä¸€ä¸ª<strong>æ…¢å¯åŠ¨è½®é™ ssthresh</strong> çŠ¶æ€å˜é‡ï¼š</p><ul><li>å½“ <code>cwnd &lt; ssthresh</code> æ—¶ï¼Œç»§ç»­ä½¿ç”¨æ…¢å¯åŠ¨ç®—æ³•</li><li>å½“ <code>cwnd &gt;= ssthresh</code> æ—¶ï¼Œå¼€å§‹ä½¿ç”¨ã€Œæ‹¥å¡é¿å…ç®—æ³•ã€</li></ul><p>â‘¡ æ‹¥å¡é¿å…</p><p>æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£ cwnd ç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´ cwnd åŠ  1</p><figure><img src="'+oe+'" alt="image-20220606204646339" tabindex="0" loading="lazy"><figcaption>image-20220606204646339</figcaption></figure><p>ğŸš¨ æ³¨æ„ï¼Œæ— è®ºæ˜¯æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯æ‹¥å¡é¿å…ï¼Œåªè¦å‡ºç°äº†ç½‘ç»œæ‹¥å¡ï¼ˆ<strong>è§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶</strong>ï¼‰ï¼Œæ…¢å¼€å§‹è½®é™ <code>sshresh</code> å’Œ æ‹¥å¡çª—å£å¤§å° <code>cwnd</code> çš„å€¼ä¼šå‘ç”Ÿå˜åŒ–ï¼ˆä¹˜æ³•å‡å°ï¼‰ï¼š</p><ul><li><code>ssthresh</code> è®¾ä¸º <code>cwnd/2</code></li><li><code>cwnd</code> é‡ç½®ä¸º <code>1</code></li></ul><p>ç”±äºæ‹¥å¡çª—å£å¤§å°é‡ç½®ä¸º 1 äº†ï¼Œæ‰€ä»¥å°±ä¼šé‡æ–°å¼€å§‹æ‰§è¡Œæ…¢å¯åŠ¨ç®—æ³•ã€‚</p><figure><img src="'+ie+'" alt="image-20220606204654767" tabindex="0" loading="lazy"><figcaption>image-20220606204654767</figcaption></figure><p>â‘¢ å¿«é‡ä¼ å’Œå¿«æ¢å¤</p><p>å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ç®—æ³•ä¸€èˆ¬åŒæ—¶ä½¿ç”¨ã€‚</p><p>å½“è§¦å‘å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œå³æ¥æ”¶æ–¹æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ ACK ç¡®è®¤çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œå¿«é‡ä¼ ç®—æ³•ï¼ˆè§¦å‘å¿«é€Ÿé‡ä¼ æœºåˆ¶å’Œè¶…æ—¶é‡ä¼ æœºåˆ¶çš„æƒ…å†µä¸åŒï¼ŒTCP è®¤ä¸ºè§¦å‘å¿«é€Ÿé‡ä¼ çš„æƒ…å†µå¹¶ä¸ä¸¥é‡ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ²¡ä¸¢ï¼Œåªä¸¢äº†ä¸€å°éƒ¨åˆ†ï¼‰ï¼Œå¿«é€Ÿé‡ä¼ åšçš„äº‹æƒ…æœ‰ï¼š</p><ul><li><code>cwnd = cwnd/2</code></li><li><code>ssthresh = cwnd</code></li><li>é‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µ</li></ul><p>åæ¥çš„ â€œå¿«é€Ÿæ¢å¤â€ ç®—æ³•æ˜¯åœ¨ä¸Šè¿°çš„â€œå¿«é€Ÿé‡ä¼ â€ç®—æ³•åæ·»åŠ çš„ï¼Œå½“æ”¶åˆ° 3 ä¸ªé‡å¤ACKæ—¶ï¼ŒTCP æœ€åè¿›å…¥çš„ä¸æ˜¯æ‹¥å¡é¿å…é˜¶æ®µï¼Œè€Œæ˜¯å¿«é€Ÿæ¢å¤é˜¶æ®µã€‚</p><p>å¿«é€Ÿæ¢å¤çš„æ€æƒ³æ˜¯â€œ<strong>æ•°æ®åŒ…å®ˆæ’</strong>â€åŸåˆ™ï¼Œå³åŒä¸€ä¸ªæ—¶åˆ»åœ¨ç½‘ç»œä¸­çš„æ•°æ®åŒ…æ•°é‡æ˜¯æ’å®šçš„ï¼Œåªæœ‰å½“â€œè€â€æ•°æ®åŒ…ç¦»å¼€äº†ç½‘ç»œåï¼Œæ‰èƒ½å‘ç½‘ç»œä¸­å‘é€ä¸€ ä¸ªâ€œæ–°â€çš„æ•°æ®åŒ…ï¼Œå¦‚æœå‘é€æ–¹æ”¶åˆ°ä¸€ä¸ªé‡å¤çš„ ACKï¼Œé‚£ä¹ˆæ ¹æ® TCP çš„ ACK æœºåˆ¶å°±è¡¨æ˜æœ‰ä¸€ä¸ªæ•°æ®åŒ…ç¦»å¼€äº†ç½‘ç»œï¼Œäºæ˜¯ <code>cwnd</code> åŠ  1ã€‚å¦‚æœèƒ½å¤Ÿä¸¥æ ¼æŒ‰ç…§è¯¥åŸåˆ™é‚£ä¹ˆç½‘ç»œä¸­å¾ˆå°‘ä¼šå‘ç”Ÿæ‹¥å¡ï¼Œäº‹å®ä¸Šæ‹¥å¡æ§åˆ¶çš„ç›®çš„ä¹Ÿå°±åœ¨ä¿®æ­£è¿åè¯¥åŸåˆ™çš„åœ°æ–¹ã€‚</p><p>å…·ä½“æ¥è¯´å¿«é€Ÿæ¢å¤çš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š</p><ul><li>æŠŠ <code>cwnd</code> è®¾ç½®ä¸º <code>ssthresh</code> çš„å€¼åŠ  3ï¼Œç„¶åé‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µï¼ŒåŠ  3 çš„åŸå› æ˜¯å› ä¸ºæ”¶åˆ° 3 ä¸ªé‡å¤çš„ ACKï¼Œè¡¨æ˜æœ‰ 3 ä¸ªâ€œè€â€çš„æ•°æ®åŒ…ç¦»å¼€äº†ç½‘ç»œã€‚</li><li>å†æ”¶åˆ°é‡å¤çš„ ACK æ—¶ï¼Œæ‹¥å¡çª—å£ <code>cwnd</code> å¢åŠ  1</li><li>å½“æ”¶åˆ°æ–°çš„æ•°æ®åŒ…çš„ ACK æ—¶ï¼ŒæŠŠ <code>cwnd</code> è®¾ç½®ä¸ºç¬¬ä¸€æ­¥ä¸­çš„ <code>ssthresh</code> çš„å€¼ã€‚åŸå› æ˜¯å› ä¸ºè¯¥ ACK ç¡®è®¤äº†æ–°çš„æ•°æ®ï¼Œè¯´æ˜ä»é‡å¤ ACK æ—¶çš„æ•°æ®éƒ½å·²æ”¶åˆ°ï¼Œè¯¥æ¢å¤è¿‡ç¨‹å·²ç»ç»“æŸï¼Œå¯ä»¥å›åˆ°æ¢å¤ä¹‹å‰çš„çŠ¶æ€äº†ï¼Œä¹Ÿå³å†æ¬¡è¿›å…¥æ‹¥å¡é¿å…çŠ¶æ€ã€‚</li></ul><figure><img src="'+ce+'" alt="image-20220606204710119" tabindex="0" loading="lazy"><figcaption>image-20220606204710119</figcaption></figure><h3 id="tcp-å’Œ-http-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#tcp-å’Œ-http-æœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> TCP å’Œ HTTP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li>HTTP é€šå¸¸ä½¿ç”¨ 80 ç«¯å£ â€” è¿™æ˜¯æœåŠ¡å™¨â€œç›‘å¬â€æˆ–æ˜¯ä» Web å®¢æˆ·ç«¯æ¥æ”¶çš„ç«¯å£ã€‚ è€Œ TCP ä¸éœ€è¦ç›‘å¬ç«¯å£æ¥å·¥ä½œã€‚</li><li>ä¸ TCP ç›¸æ¯”ï¼ŒHTTP æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¥æ›´é«˜çš„é€Ÿåº¦è¿è¡Œå¹¶ç«‹å³æ‰§è¡Œè¯¥è¿‡ç¨‹ã€‚ TCP ç›¸å¯¹è¾ƒæ…¢ã€‚</li><li>TCP å‘Šè¯‰ç›®æ ‡è®¡ç®—æœºå“ªä¸ªåº”ç”¨ç¨‹åºåº”è¯¥æ¥æ”¶æ•°æ®å¹¶ç¡®ä¿æ­£ç¡®ä¼ é€’æ‰€è¿°æ•°æ®ï¼Œè€Œ HTTP é€šå¸¸ ç”¨äºåœ¨ Internet ä¸Šæœç´¢å’ŒæŸ¥æ‰¾æ‰€éœ€çš„æ–‡æ¡£ã€‚</li><li>TCP åŒ…å«æœ‰å…³å·²æ”¶åˆ°æˆ–å°šæœªæ”¶åˆ°å“ªäº›æ•°æ®çš„ä¿¡æ¯ï¼Œè€Œ HTTP åŒ…å«æœ‰å…³åœ¨æ”¶åˆ°æ•°æ®åå¦‚ä½•è¯»å–å’Œå¤„ç†æ•°æ®çš„å…·ä½“è¯´æ˜ã€‚</li><li>TCP ç®¡ç†æ•°æ®æµï¼Œè€Œ HTTP æè¿°æµä¸­çš„æ•°æ®åŒ…å«ä»€ä¹ˆã€‚</li><li>TCP ä½œä¸ºä¸‰å‘é€šä¿¡åè®®è¿è¡Œï¼Œè€Œ HTTP æ˜¯å•å‘åè®®ã€‚</li></ul><h3 id="tcp-çš„-accept-å‡½æ•°å‘ç”Ÿåœ¨ç¬¬å‡ æ¬¡æ¡æ‰‹-è…¾è®¯" tabindex="-1"><a class="header-anchor" href="#tcp-çš„-accept-å‡½æ•°å‘ç”Ÿåœ¨ç¬¬å‡ æ¬¡æ¡æ‰‹-è…¾è®¯" aria-hidden="true">#</a> TCP çš„ accept()å‡½æ•°å‘ç”Ÿåœ¨ç¬¬å‡ æ¬¡æ¡æ‰‹ï¼ˆè…¾è®¯ï¼‰</h3><p>å‘ç”Ÿåœ¨ä¸‰æ¬¡æ¡æ‰‹ä¹‹å</p><h3 id="è®²ä¸€ä¸‹-http-ç»“æ„-å’Œ-tcp-å…³ç³»ç­‰-çŠ¶æ€ç æœ‰ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è®²ä¸€ä¸‹-http-ç»“æ„-å’Œ-tcp-å…³ç³»ç­‰-çŠ¶æ€ç æœ‰ä»€ä¹ˆ" aria-hidden="true">#</a> è®²ä¸€ä¸‹ httpï¼šç»“æ„ï¼Œå’Œ tcp å…³ç³»ç­‰ï¼ŒçŠ¶æ€ç æœ‰ä»€ä¹ˆ</h3><p>ç»“æ„</p><hr><p>HTTPçš„åå­—ã€Œè¶…æ–‡æœ¬åè®®ä¼ è¾“ã€ï¼Œå®ƒå¯ä»¥æ‹†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>è¶…æ–‡æœ¬</li><li>ä¼ è¾“</li><li>åè®®</li></ul><figure><img src="'+le+`" alt="image-20220607142829952" tabindex="0" loading="lazy"><figcaption>image-20220607142829952</figcaption></figure><p>å…³ç³»</p><hr><pre><code>**TPC/IPåè®®æ˜¯ä¼ è¾“å±‚åè®®ï¼Œä¸»è¦è§£å†³æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè€ŒHTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®ã€‚**å…³äºTCP/IPå’ŒHTTPåè®®çš„å…³ç³»ï¼Œç½‘ç»œæœ‰ä¸€æ®µæ¯”è¾ƒå®¹æ˜“ç†è§£çš„ä»‹ç»ï¼šâ€œæˆ‘ä»¬åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œå¯ä»¥åªä½¿ç”¨ï¼ˆä¼ è¾“å±‚ï¼‰TCP/IPåè®®ï¼Œä½†æ˜¯é‚£æ ·çš„è¯ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨å±‚ï¼Œä¾¿æ— æ³•è¯†åˆ«æ•°æ®å†…å®¹ï¼Œå¦‚æœæƒ³è¦ä½¿ä¼ è¾“çš„æ•°æ®æœ‰æ„ä¹‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨åˆ°åº”ç”¨å±‚åè®®ï¼Œåº”ç”¨å±‚åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚HTTPã€FTPã€TELNETç­‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰åº”ç”¨å±‚åè®®ã€‚WEBä½¿ç”¨HTTPåè®®ä½œåº”ç”¨å±‚åè®®ï¼Œä»¥å°è£…HTTP æ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨TCP/IPåšä¼ è¾“å±‚åè®®å°†å®ƒå‘åˆ°ç½‘ç»œä¸Šã€‚â€

æŠŠ**IPæƒ³åƒæˆä¸€ç§é«˜é€Ÿå…¬è·¯**ï¼Œå®ƒå…è®¸å…¶å®ƒåè®®åœ¨ä¸Šé¢è¡Œé©¶å¹¶æ‰¾åˆ°åˆ°å…¶å®ƒç”µè„‘çš„å‡ºå£ã€‚**TCPå’ŒUDPæ˜¯é«˜é€Ÿå…¬è·¯ä¸Šçš„â€œå¡è½¦â€ï¼Œå®ƒä»¬æºå¸¦çš„è´§ç‰©å°±æ˜¯åƒHTTP**ï¼Œæ–‡ä»¶ä¼ è¾“åè®®FTPè¿™æ ·çš„åè®®ç­‰ã€‚
</code></pre><figure><img src="`+re+'" alt="image-20220607143304815" tabindex="0" loading="lazy"><figcaption>image-20220607143304815</figcaption></figure><p>çŠ¶æ€ç </p><hr><figure><img src="'+ue+'" alt="image-20220607142735506" tabindex="0" loading="lazy"><figcaption>image-20220607142735506</figcaption></figure><p><code>1xx</code> ç±»çŠ¶æ€ç å±äº<strong>æç¤ºä¿¡æ¯</strong>ï¼Œæ˜¯åè®®å¤„ç†ä¸­çš„ä¸€ç§ä¸­é—´çŠ¶æ€ï¼Œå®é™…ç”¨åˆ°çš„æ¯”è¾ƒå°‘ã€‚</p><p><code>2xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨<strong>æˆåŠŸ</strong>å¤„ç†äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€æ„¿æ„çœ‹åˆ°çš„çŠ¶æ€ã€‚</p><ul><li>ã€Œ<strong>200 OK</strong>ã€æ˜¯æœ€å¸¸è§çš„æˆåŠŸçŠ¶æ€ç ï¼Œè¡¨ç¤ºä¸€åˆ‡æ­£å¸¸ã€‚å¦‚æœæ˜¯é <code>HEAD</code> è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”å¤´éƒ½ä¼šæœ‰ body æ•°æ®ã€‚</li><li>ã€Œ<strong>204 No Content</strong>ã€ä¹Ÿæ˜¯å¸¸è§çš„æˆåŠŸçŠ¶æ€ç ï¼Œä¸ 200 OK åŸºæœ¬ç›¸åŒï¼Œä½†å“åº”å¤´æ²¡æœ‰ body æ•°æ®ã€‚</li><li>ã€Œ<strong>206 Partial Content</strong>ã€æ˜¯åº”ç”¨äº HTTP åˆ†å—ä¸‹è½½æˆ–æ–­ç‚¹ç»­ä¼ ï¼Œè¡¨ç¤ºå“åº”è¿”å›çš„ body æ•°æ®å¹¶ä¸æ˜¯èµ„æºçš„å…¨éƒ¨ï¼Œè€Œæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœåŠ¡å™¨å¤„ç†æˆåŠŸçš„çŠ¶æ€ã€‚</li></ul><p><code>3xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå‘ç”Ÿäº†å˜åŠ¨ï¼Œéœ€è¦å®¢æˆ·ç«¯ç”¨æ–°çš„ URL é‡æ–°å‘é€è¯·æ±‚è·å–èµ„æºï¼Œä¹Ÿå°±æ˜¯<strong>é‡å®šå‘</strong>ã€‚</p><ul><li>ã€Œ<strong>301 Moved Permanently</strong>ã€è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨äº†ï¼Œéœ€æ”¹ç”¨æ–°çš„ URL å†æ¬¡è®¿é—®ã€‚</li><li>ã€Œ<strong>302 Found</strong>ã€è¡¨ç¤ºä¸´æ—¶é‡å®šå‘ï¼Œè¯´æ˜è¯·æ±‚çš„èµ„æºè¿˜åœ¨ï¼Œä½†æš‚æ—¶éœ€è¦ç”¨å¦ä¸€ä¸ª URL æ¥è®¿é—®ã€‚</li></ul><p>301 å’Œ 302 éƒ½ä¼šåœ¨å“åº”å¤´é‡Œä½¿ç”¨å­—æ®µ <code>Location</code>ï¼ŒæŒ‡æ˜åç»­è¦è·³è½¬çš„ URLï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡å®šå‘æ–°çš„ URLã€‚</p><ul><li>ã€Œ<strong>304 Not Modified</strong>ã€ä¸å…·æœ‰è·³è½¬çš„å«ä¹‰ï¼Œè¡¨ç¤ºèµ„æºæœªä¿®æ”¹ï¼Œé‡å®šå‘å·²å­˜åœ¨çš„ç¼“å†²æ–‡ä»¶ï¼Œä¹Ÿç§°ç¼“å­˜é‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç¼“å­˜èµ„æºï¼Œç”¨äºç¼“å­˜æ§åˆ¶ã€‚</li></ul><p><code>4xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„<strong>æŠ¥æ–‡æœ‰è¯¯</strong>ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯ç çš„å«ä¹‰ã€‚</p><ul><li>ã€Œ<strong>400 Bad Request</strong>ã€è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„æŠ¥æ–‡æœ‰é”™è¯¯ï¼Œä½†åªæ˜¯ä¸ªç¬¼ç»Ÿçš„é”™è¯¯ã€‚</li><li>ã€Œ<strong>403 Forbidden</strong>ã€è¡¨ç¤ºæœåŠ¡å™¨ç¦æ­¢è®¿é—®èµ„æºï¼Œå¹¶ä¸æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚å‡ºé”™ã€‚</li><li>ã€Œ<strong>404 Not Found</strong>ã€è¡¨ç¤ºè¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šä¸å­˜åœ¨æˆ–æœªæ‰¾åˆ°ï¼Œæ‰€ä»¥æ— æ³•æä¾›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p><code>5xx</code> ç±»çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡æ­£ç¡®ï¼Œä½†æ˜¯<strong>æœåŠ¡å™¨å¤„ç†æ—¶å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯</strong>ï¼Œå±äºæœåŠ¡å™¨ç«¯çš„é”™è¯¯ç ã€‚</p><ul><li>ã€Œ<strong>500 Internal Server Error</strong>ã€ä¸ 400 ç±»å‹ï¼Œæ˜¯ä¸ªç¬¼ç»Ÿé€šç”¨çš„é”™è¯¯ç ï¼ŒæœåŠ¡å™¨å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ã€‚</li><li>ã€Œ<strong>501 Not Implemented</strong>ã€è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½è¿˜ä¸æ”¯æŒï¼Œç±»ä¼¼â€œå³å°†å¼€ä¸šï¼Œæ•¬è¯·æœŸå¾…â€çš„æ„æ€ã€‚</li><li>ã€Œ<strong>502 Bad Gateway</strong>ã€é€šå¸¸æ˜¯æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶è¿”å›çš„é”™è¯¯ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è‡ªèº«å·¥ä½œæ­£å¸¸ï¼Œè®¿é—®åç«¯æœåŠ¡å™¨å‘ç”Ÿäº†é”™è¯¯ã€‚</li><li>ã€Œ<strong>503 Service Unavailable</strong>ã€è¡¨ç¤ºæœåŠ¡å™¨å½“å‰å¾ˆå¿™ï¼Œæš‚æ—¶æ— æ³•å“åº”å®¢æˆ·ç«¯ï¼Œç±»ä¼¼â€œç½‘ç»œæœåŠ¡æ­£å¿™ï¼Œè¯·ç¨åé‡è¯•â€çš„æ„æ€</li></ul><h3 id="http-å’Œ-https-çš„åŒºåˆ«-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#http-å’Œ-https-çš„åŒºåˆ«-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> HTTP å’Œ HTTPs çš„åŒºåˆ«ï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h3><ul><li><strong>ç«¯å£å·</strong> ï¼šHTTP é»˜è®¤æ˜¯ 80ï¼ŒHTTPS é»˜è®¤æ˜¯ 443ã€‚</li><li><strong>URL å‰ç¼€</strong> ï¼šHTTP çš„ URL å‰ç¼€æ˜¯ <code>http://</code>ï¼ŒHTTPS çš„ URL å‰ç¼€æ˜¯ <code>https://</code>ã€‚</li><li><strong>å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—</strong> ï¼š HTTP åè®®è¿è¡Œåœ¨ TCP ä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ã€‚HTTPS æ˜¯è¿è¡Œåœ¨ SSL/TLS ä¹‹ä¸Šçš„ HTTP åè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨ TCP ä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPS é«˜ï¼Œä½†æ˜¯ HTTPS æ¯” HTTP è€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚</li></ul><h3 id="https-åŠ å¯†è¿‡ç¨‹-2022ç•ªèŒ„å°è¯´" tabindex="-1"><a class="header-anchor" href="#https-åŠ å¯†è¿‡ç¨‹-2022ç•ªèŒ„å°è¯´" aria-hidden="true">#</a> HTTPS åŠ å¯†è¿‡ç¨‹ï¼ˆ2022ç•ªèŒ„å°è¯´ï¼‰</h3><p>HTTP æœ‰ä»¥ä¸‹å®‰å…¨æ€§é—®é¢˜:</p><ul><li>ä½¿ç”¨æ˜æ–‡è¿›è¡Œé€šä¿¡ï¼Œå†…å®¹å¯èƒ½ä¼šè¢«çªƒå¬ï¼›</li><li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œé€šä¿¡æ–¹çš„èº«ä»½æœ‰å¯èƒ½é­é‡ä¼ªè£…ï¼›</li><li>æ— æ³•è¯æ˜æŠ¥æ–‡çš„å®Œæ•´æ€§ï¼ŒæŠ¥æ–‡æœ‰å¯èƒ½é­ç¯¡æ”¹ã€‚</li></ul><p>HTTPs å¹¶ä¸æ˜¯æ–°åè®®ï¼Œè€Œæ˜¯è®© HTTP å…ˆå’Œ SSL(Secure Sockets Layer)é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´ HTTPs ä½¿ç”¨äº†éš§é“è¿›è¡Œé€šä¿¡ã€‚</p><p>é€šè¿‡ä½¿ç”¨ SSLï¼ŒHTTPs å…·æœ‰äº†åŠ å¯†(é˜²çªƒå¬)ã€è®¤è¯(é˜²ä¼ªè£…)å’Œå®Œæ•´æ€§ä¿æŠ¤(é˜²ç¯¡æ”¹)ã€‚</p><figure><img src="'+de+'" alt="image-20220405200858423" tabindex="0" loading="lazy"><figcaption>image-20220405200858423</figcaption></figure><p>åŠ å¯†</p><hr><ol><li>å¯¹ç§°å¯†é’¥åŠ å¯†</li></ol><p>å¯¹ç§°å¯†é’¥åŠ å¯†(Symmetric-Key Encryption)ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€å¯†é’¥ã€‚</p><ul><li>ä¼˜ç‚¹: è¿ç®—é€Ÿåº¦å¿«ï¼›</li><li>ç¼ºç‚¹: æ— æ³•å®‰å…¨åœ°å°†å¯†é’¥ä¼ è¾“ç»™é€šä¿¡æ–¹ã€‚</li></ul><figure><img src="'+ke+'" alt="image-20220405200926547" tabindex="0" loading="lazy"><figcaption>image-20220405200926547</figcaption></figure><ol start="2"><li>éå¯¹ç§°å¯†é’¥åŠ å¯†</li></ol><p>éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†(Public-Key Encryption)ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚</p><p>å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œé€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†ã€‚</p><p>éå¯¹ç§°å¯†é’¥é™¤äº†ç”¨æ¥åŠ å¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œç­¾åã€‚å› ä¸ºç§æœ‰å¯†é’¥æ— æ³•è¢«å…¶ä»–äººè·å–ï¼Œå› æ­¤é€šä¿¡å‘é€æ–¹ä½¿ç”¨å…¶ç§æœ‰å¯†é’¥è¿›è¡Œç­¾åï¼Œé€šä¿¡æ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå°±èƒ½åˆ¤æ–­è¿™ä¸ªç­¾åæ˜¯å¦æ­£ç¡®ã€‚</p><ul><li>ä¼˜ç‚¹: å¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼›</li><li>ç¼ºç‚¹: è¿ç®—é€Ÿåº¦æ…¢ã€‚</li></ul><figure><img src="'+me+'" alt="image-20220405200945067" tabindex="0" loading="lazy"><figcaption>image-20220405200945067</figcaption></figure><ol start="3"><li>ã€ç­”æ¡ˆã€‘HTTPs é‡‡ç”¨çš„åŠ å¯†æ–¹å¼</li></ol><p>HTTPs é‡‡ç”¨æ··åˆçš„åŠ å¯†æœºåˆ¶ï¼Œä½¿ç”¨éå¯¹ç§°å¯†é’¥åŠ å¯†ç”¨äºä¼ è¾“å¯¹ç§°å¯†é’¥æ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¿›è¡Œé€šä¿¡æ¥ä¿è¯é€šä¿¡è¿‡ç¨‹çš„æ•ˆç‡ã€‚(ä¸‹å›¾ä¸­çš„ Session Key å°±æ˜¯å¯¹ç§°å¯†é’¥)</p><figure><img src="'+ge+'" alt="image-20220405201020933" tabindex="0" loading="lazy"><figcaption>image-20220405201020933</figcaption></figure><p>ç®€åŒ–ç‰ˆæœ¬</p><figure><img src="'+ve+'" alt="image-20220405202121578" tabindex="0" loading="lazy"><figcaption>image-20220405202121578</figcaption></figure><p>HTTPSï¼ˆHypertext Transfer Protocol Secureï¼‰æ˜¯ä¸€ç§åŠ å¯†ä¼ è¾“åè®®ï¼Œå®ƒåœ¨ HTTP åè®®çš„åŸºç¡€ä¸Šæ·»åŠ äº†å®‰å…¨å¥—æ¥å±‚ï¼ˆSSL/TLSï¼‰çš„æ”¯æŒã€‚ä¸‹é¢æ˜¯ HTTPS åŠ å¯†è¿‡ç¨‹çš„ç®€è¦æè¿°ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ HTTPS è¿æ¥è¯·æ±‚ã€‚è¯·æ±‚ä¸­åŒ…æ‹¬è¿æ¥è¯·æ±‚å¤´å’Œè¿æ¥è¯·æ±‚ä½“ã€‚</li><li>æœåŠ¡å™¨å“åº”ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯è¿”å› SSL è¯ä¹¦ï¼Œè¯¥è¯ä¹¦åŒ…å«äº†æœåŠ¡å™¨å…¬é’¥ã€è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„ä¿¡æ¯ç­‰ã€‚</li><li>å®¢æˆ·ç«¯éªŒè¯ SSL è¯ä¹¦ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SSL è¯ä¹¦åï¼Œä¼šå¯¹å…¶è¿›è¡ŒéªŒè¯ï¼ŒåŒ…æ‹¬è¯ä¹¦æ˜¯å¦è¿‡æœŸã€è¯ä¹¦é¢å‘æœºæ„æ˜¯å¦å¯ä¿¡ç­‰ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œå®¢æˆ·ç«¯ä¼šæç¤ºç”¨æˆ·å­˜åœ¨å®‰å…¨é£é™©ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li><li>å®¢æˆ·ç«¯ç”Ÿæˆå¯¹ç§°å¯†é’¥ï¼šå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥ï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå°†åŠ å¯†åçš„å¯†é’¥å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨è§£å¯†å¯¹ç§°å¯†é’¥ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„åŠ å¯†åçš„å¯¹ç§°å¯†é’¥åï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°å¯¹ç§°å¯†é’¥ã€‚</li><li>å»ºç«‹å®‰å…¨é€šé“ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°å¯†é’¥è¿›è¡Œé€šä¿¡ï¼Œå®ç°æ•°æ®çš„åŠ å¯†å’Œè§£å¯†ã€‚</li><li>æ•°æ®ä¼ è¾“ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæ•°æ®ä¼šç»è¿‡ SSL/TLS åè®®çš„åŠ å¯†å’Œè§£å¯†å¤„ç†ã€‚</li></ol><p>ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼ŒSSL/TLS åè®®çš„ä½œç”¨æ˜¯ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ï¼š</p><ul><li>è®¤è¯æœåŠ¡å™¨èº«ä»½ï¼šå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨ SSL è¯ä¹¦ï¼Œç¡®ä¿è¿æ¥çš„æœåŠ¡å™¨æ˜¯åˆæ³•çš„ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»ã€‚</li><li>åŠ å¯†æ•°æ®ä¼ è¾“ï¼šä½¿ç”¨å¯¹ç§°å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¿è¯æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå¬ã€‚</li><li>æ•°æ®å®Œæ•´æ€§éªŒè¯ï¼šä½¿ç”¨æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼ˆå¦‚ SHA256ï¼‰å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œä¿è¯æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«ç¯¡æ”¹ã€‚</li></ul><h3 id="https-æ•°å­—è¯ä¹¦äº¤æ¢çš„è¿‡ç¨‹è¯¦ç»†è¯´ä¸€ä¸‹" tabindex="-1"><a class="header-anchor" href="#https-æ•°å­—è¯ä¹¦äº¤æ¢çš„è¿‡ç¨‹è¯¦ç»†è¯´ä¸€ä¸‹" aria-hidden="true">#</a> https æ•°å­—è¯ä¹¦äº¤æ¢çš„è¿‡ç¨‹è¯¦ç»†è¯´ä¸€ä¸‹ï¼Ÿ</h3><p>æ•°å­—è¯ä¹¦è®¤è¯æœºæ„(CAï¼ŒCertificate Authority)æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚</p><p>æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚</p><p>è¿›è¡Œ HTTPs é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚</p><p>é€šä¿¡å¼€å§‹æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨æœåŠ¡å™¨çš„å…¬å¼€å¯†é’¥å°†è‡ªå·±çš„ç§æœ‰å¯†é’¥ä¼ è¾“ç»™æœåŠ¡å™¨ï¼Œä¹‹åå†è¿›è¡Œå¯¹ç§°å¯†é’¥åŠ å¯†ã€‚</p><figure><img src="'+be+'" alt="image-20220411180808761" tabindex="0" loading="lazy"><figcaption>image-20220411180808761</figcaption></figure><h3 id="dns-è§£æè¿‡ç¨‹-ç»™ä¸ª-url-ä¸€å±‚ä¸€å±‚å…·ä½“åˆ†æ" tabindex="-1"><a class="header-anchor" href="#dns-è§£æè¿‡ç¨‹-ç»™ä¸ª-url-ä¸€å±‚ä¸€å±‚å…·ä½“åˆ†æ" aria-hidden="true">#</a> DNS è§£æè¿‡ç¨‹ï¼Œç»™ä¸ª URL ä¸€å±‚ä¸€å±‚å…·ä½“åˆ†æ</h3><p>.com.fi å›½é™…é‡‘èåŸŸå DNS è§£æçš„æ­¥éª¤ä¸€å…±åˆ†ä¸º 9 æ­¥ï¼Œå¦‚æœæ¯æ¬¡è§£æéƒ½è¦èµ°å®Œ 9 ä¸ªæ­¥éª¤ï¼Œå¤§å®¶æµè§ˆç½‘ç«™çš„é€Ÿåº¦ä¹Ÿä¸ä¼šé‚£ä¹ˆå¿«ï¼Œç°åœ¨ä¹‹æ‰€ä»¥èƒ½ä¿æŒè¿™ä¹ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œå…¶å®ä¸€èˆ¬çš„è§£æéƒ½æ˜¯è·‘å®Œç¬¬ 4 æ­¥å°±å¯ä»¥äº†ã€‚é™¤éä¸€ä¸ªåœ°åŒºå®Œå…¨æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼ˆåœ¨éƒ½æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼‰æ‰ä¼šèµ°å®Œ 9 ä¸ªæ­¥éª¤ï¼Œè¿™ä¸ªæƒ…å†µå¾ˆå°‘ã€‚</p><ul><li>1ã€æœ¬åœ°å®¢æˆ·æœºæå‡ºåŸŸåè§£æè¯·æ±‚ï¼ŒæŸ¥æ‰¾æœ¬åœ° HOST æ–‡ä»¶åå°†è¯¥è¯·æ±‚å‘é€ç»™æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨ã€‚</li><li>2ã€å°†è¯·æ±‚å‘é€ç»™æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨ã€‚</li><li>3ã€å½“æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±å…ˆæŸ¥è¯¢æœ¬åœ°çš„ç¼“å­˜ã€‚</li><li>4ã€å¦‚æœæœ‰è¯¥çºªå½•é¡¹ï¼Œåˆ™æœ¬åœ°çš„åŸŸåæœåŠ¡å™¨å°±ç›´æ¥æŠŠæŸ¥è¯¢çš„ç»“æœè¿”å›æµè§ˆå™¨ã€‚</li><li>5ã€å¦‚æœæœ¬åœ° DNS ç¼“å­˜ä¸­æ²¡æœ‰è¯¥çºªå½•ï¼Œåˆ™æœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ç›´æ¥æŠŠè¯·æ±‚å‘ç»™æ ¹åŸŸåæœåŠ¡å™¨ã€‚</li><li>6ã€ç„¶åæ ¹åŸŸåæœåŠ¡å™¨å†è¿”å›ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸€ä¸ªæ‰€æŸ¥è¯¢åŸŸï¼ˆæ ¹çš„å­åŸŸï¼‰çš„ä¸»åŸŸåæœåŠ¡å™¨çš„åœ°å€ã€‚</li><li>7ã€æœ¬åœ°æœåŠ¡å™¨å†å‘ä¸Šä¸€æ­¥è¿”å›çš„åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç„¶åæ¥å—è¯·æ±‚çš„æœåŠ¡å™¨æŸ¥è¯¢è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰è¯¥çºªå½•ï¼Œåˆ™è¿”å›ç›¸å…³çš„ä¸‹çº§çš„åŸŸåæœåŠ¡å™¨çš„åœ°å€ã€‚</li><li>8ã€é‡å¤ç¬¬ 7 æ­¥ï¼Œç›´åˆ°æ‰¾åˆ°æ­£ç¡®çš„çºªå½•ã€‚</li><li>9ã€æœ¬åœ°åŸŸåæœåŠ¡å™¨æŠŠè¿”å›çš„ç»“æœä¿å­˜åˆ°ç¼“å­˜ï¼Œä»¥å¤‡ä¸‹ä¸€æ¬¡ä½¿ç”¨ï¼ŒåŒæ—¶è¿˜å°†ç»“æœè¿”å›ç»™å®¢æˆ·æœºã€‚</li></ul><figure><img src="'+he+'" alt="image-20220405203101620" tabindex="0" loading="lazy"><figcaption>image-20220405203101620</figcaption></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><p><strong>é€’å½’æŸ¥è¯¢</strong>ï¼šåœ¨è¯¥æ¨¡å¼ä¸‹ DNS æœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·æœºè¯·æ±‚ï¼Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªå‡†ç¡®çš„æŸ¥è¯¢ç»“æœå›å¤å®¢æˆ·æœºã€‚å¦‚æœ DNS æœåŠ¡å™¨æœ¬åœ°æ²¡æœ‰å­˜å‚¨æŸ¥è¯¢ DNS ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨ä¼šè¯¢é—®å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶å°†è¿”å›çš„æŸ¥è¯¢ç»“æœæäº¤ç»™å®¢æˆ·æœºã€‚</p><p><strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼šDNS æ‰€åœ¨æœåŠ¡å™¨è‹¥æ²¡æœ‰å¯ä»¥å“åº”çš„ç»“æœï¼Œä¼šå‘å®¢æˆ·æœºæä¾›å…¶ä»–èƒ½å¤Ÿè§£ææŸ¥è¯¢è¯·æ±‚çš„ DNS æœåŠ¡å™¨åœ°å€ï¼Œå½“å®¢æˆ·æœºå‘é€æŸ¥è¯¢è¯·æ±‚æ—¶ï¼ŒDNS æœåŠ¡å™¨å¹¶ä¸ç›´æ¥å›å¤æŸ¥è¯¢ç»“æœï¼Œè€Œæ˜¯å‘Šè¯‰å®¢æˆ·æœºå¦ä¸€å° DNS æœåŠ¡å™¨åœ°å€ï¼Œå®¢æˆ·æœºå†å‘è¿™å° DNS æœåŠ¡å™¨æäº¤è¯·æ±‚ï¼Œä¾æ¬¡å¾ªç¯ç›´åˆ°è¿”å›æŸ¥è¯¢çš„ç»“æœä¸ºæ­¢ã€‚</p><h3 id="_7-å±‚ç½‘ç»œ-4-å±‚ç½‘ç»œ-5-å±‚ç½‘ç»œ-å„å±‚æœ‰å“ªäº›åè®®" tabindex="-1"><a class="header-anchor" href="#_7-å±‚ç½‘ç»œ-4-å±‚ç½‘ç»œ-5-å±‚ç½‘ç»œ-å„å±‚æœ‰å“ªäº›åè®®" aria-hidden="true">#</a> 7 å±‚ç½‘ç»œï¼Œ4 å±‚ç½‘ç»œï¼Œ5 å±‚ç½‘ç»œï¼Œå„å±‚æœ‰å“ªäº›åè®®</h3><p>OSI7 å±‚ï¼šåº”ç”¨å±‚ï¼ˆApplicationï¼‰ã€è¡¨ç¤ºå±‚ï¼ˆPresentationï¼‰ã€ä¼šè¯å±‚ï¼ˆSessionï¼‰ã€ä¼ è¾“å±‚ï¼ˆTransportï¼‰ã€ç½‘ç»œå±‚ï¼ˆNetworkï¼‰ã€æ•°æ®é“¾è·¯å±‚ï¼ˆData Linkï¼‰ã€ç‰©ç†å±‚ï¼ˆPhysicalï¼‰</p><p>4 å±‚æ˜¯æŒ‡ TCP/IP å››å±‚æ¨¡å‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼šåº”ç”¨å±‚ã€è¿è¾“å±‚ã€ç½‘é™…å±‚å’Œç½‘ç»œæ¥å£å±‚ã€‚</p><p>5 å±‚ï¼ˆäº”å±‚åè®®åªæ˜¯ OSI å’Œ TCP/IP çš„ç»¼åˆï¼Œå®é™…åº”ç”¨è¿˜æ˜¯ TCP/IP çš„å››å±‚ç»“æ„ï¼‰ï¼šåº”ç”¨å±‚ã€è¿è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ã€‚</p><p>åè®®å‚è€ƒå›¾ï¼š</p><figure><img src="'+p+'" alt="image-20220404172044696" tabindex="0" loading="lazy"><figcaption>image-20220404172044696</figcaption></figure><h3 id="å·²ç»å°è£…å¥½çš„æ¶ˆæ¯-ä¸è€ƒè™‘-dns-ç­‰-æ€ä¹ˆå¯»å€" tabindex="-1"><a class="header-anchor" href="#å·²ç»å°è£…å¥½çš„æ¶ˆæ¯-ä¸è€ƒè™‘-dns-ç­‰-æ€ä¹ˆå¯»å€" aria-hidden="true">#</a> å·²ç»å°è£…å¥½çš„æ¶ˆæ¯ï¼Œä¸è€ƒè™‘ DNS ç­‰ï¼Œæ€ä¹ˆå¯»å€</h3><p>å¯¹äºå·²ç»å°è£…å¥½çš„æ¶ˆæ¯ï¼Œå¦‚ä½•å¯»å€å–å†³äºå®ƒæ‰€ä½¿ç”¨çš„åè®®ã€‚ä¸‹é¢ä»¥å¸¸ç”¨çš„ TCP/IP åè®®ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å¯¹å·²å°è£…æ¶ˆæ¯è¿›è¡Œå¯»å€ï¼š</p><p>åœ¨ TCP/IP åè®®ä¸­ï¼Œå·²ç»å°è£…å¥½çš„æ¶ˆæ¯é€šå¸¸åŒ…å«äº†ç›®æ ‡ä¸»æœºçš„ IP åœ°å€ã€‚å› æ­¤ï¼Œå¯»å€çš„è¿‡ç¨‹å°±æ˜¯å°†æ¶ˆæ¯ä¸­çš„ IP åœ°å€ä¸å½“å‰ä¸»æœºçš„ IP åœ°å€è¿›è¡Œæ¯”è¾ƒï¼Œç¡®å®šæ¶ˆæ¯æ˜¯å¦è¦ä¼ é€’åˆ°å½“å‰ä¸»æœºä¸Šã€‚å¦‚æœç›®æ ‡ä¸»æœºä¸å½“å‰ä¸»æœºä¸åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œåˆ™éœ€è¦é€šè¿‡è·¯ç”±å™¨è¿›è¡Œè½¬å‘ã€‚è·¯ç”±å™¨å°†æ ¹æ®æ¶ˆæ¯ä¸­çš„ç›®æ ‡ IP åœ°å€å’Œè·¯ç”±è¡¨ä¿¡æ¯ï¼Œé€‰æ‹©ä¸€æ¡æœ€ä½³çš„è·¯å¾„å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸‹ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚</p><p>åœ¨å±€åŸŸç½‘ä¸­ï¼Œå¯ä»¥é€šè¿‡ ARP åè®®å°† IP åœ°å€è§£æä¸º MAC åœ°å€ï¼Œä»¥ä¾¿åœ¨é“¾è·¯å±‚ä¸Šä¼ è¾“æ•°æ®ã€‚</p><p>æ€»ä¹‹ï¼Œä¸åŒçš„åè®®ä¼šé‡‡ç”¨ä¸åŒçš„å¯»å€æ–¹å¼å’Œåè®®ï¼Œä½†å®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½éœ€è¦æŸç§å½¢å¼çš„åœ°å€ä¿¡æ¯æ¥ç¡®å®šæ•°æ®ä¼ è¾“çš„ç›®çš„åœ°ã€‚</p><h3 id="å±€åŸŸç½‘å†…æ€ä¹ˆå¯»å€-ç½‘å…³æ€ä¹ˆæ‰¾åˆ°" tabindex="-1"><a class="header-anchor" href="#å±€åŸŸç½‘å†…æ€ä¹ˆå¯»å€-ç½‘å…³æ€ä¹ˆæ‰¾åˆ°" aria-hidden="true">#</a> å±€åŸŸç½‘å†…æ€ä¹ˆå¯»å€ï¼Œç½‘å…³æ€ä¹ˆæ‰¾åˆ°</h3><p>åœ¨å±€åŸŸç½‘å†…éƒ¨ï¼Œè®¾å¤‡ä¹‹é—´é€šå¸¸ä½¿ç”¨ MAC åœ°å€è¿›è¡Œé€šä¿¡ã€‚MAC åœ°å€æ˜¯ç¡¬ä»¶åœ°å€ï¼Œæ˜¯ç”±ç½‘å¡å‚å•†é¢„è®¾åœ¨ç½‘å¡ä¸­çš„ï¼Œæ¯ä¸ªç½‘å¡éƒ½æœ‰å”¯ä¸€çš„ MAC åœ°å€ã€‚å› æ­¤ï¼Œå½“ä¸€å°è®¾å¤‡è¦å‘é€æ•°æ®åˆ°å¦ä¸€å°è®¾å¤‡æ—¶ï¼Œå®ƒéœ€è¦çŸ¥é“ç›®æ ‡è®¾å¤‡çš„ MAC åœ°å€ã€‚</p><p>ä¸ºäº†å®ç° IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„ï¼Œå±€åŸŸç½‘å†…éƒ¨é€šå¸¸ä½¿ç”¨ ARPï¼ˆAddress Resolution Protocolï¼‰åè®®ã€‚å½“ä¸€å°è®¾å¤‡éœ€è¦ä¸å¦ä¸€å°è®¾å¤‡é€šä¿¡æ—¶ï¼Œå®ƒä¼šåœ¨ ARP ç¼“å­˜ä¸­æŸ¥æ‰¾ç›®æ ‡è®¾å¤‡çš„ IP åœ°å€å¯¹åº”çš„ MAC åœ°å€ã€‚å¦‚æœ ARP ç¼“å­˜ä¸­æ²¡æœ‰è¿™æ¡è®°å½•ï¼Œå®ƒå°±ä¼šå¹¿æ’­ä¸€ä¸ª ARP è¯·æ±‚æ¶ˆæ¯åˆ°å±€åŸŸç½‘ä¸Šï¼Œè¯·æ±‚ä¸ç›®æ ‡ IP åœ°å€å¯¹åº”çš„è®¾å¤‡å›å¤è‡ªå·±çš„ MAC åœ°å€ã€‚ç›®æ ‡è®¾å¤‡æ”¶åˆ° ARP è¯·æ±‚æ¶ˆæ¯åï¼Œä¼šå°†è‡ªå·±çš„ MAC åœ°å€æ‰“åŒ…æˆ ARP å“åº”æ¶ˆæ¯è¿”å›ç»™è¯·æ±‚è®¾å¤‡ã€‚è¯·æ±‚è®¾å¤‡æ”¶åˆ° ARP å“åº”æ¶ˆæ¯åï¼Œå°±å¯ä»¥å°†ç›®æ ‡è®¾å¤‡çš„ MAC åœ°å€å­˜å‚¨åˆ° ARP ç¼“å­˜ä¸­ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ª MAC åœ°å€å‘é€æ•°æ®åŒ…ã€‚</p><p>å¯¹äºç½‘å…³ï¼Œå®ƒé€šå¸¸æ˜¯å±€åŸŸç½‘ä¸­ä¸å¤–éƒ¨ç½‘ç»œç›¸è¿çš„è®¾å¤‡ï¼Œå®ƒå…·æœ‰ä¸¤ä¸ª IP åœ°å€ï¼Œä¸€ä¸ªæ˜¯åœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨çš„ IP åœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨å¤–éƒ¨ç½‘ç»œä¸­ä½¿ç”¨çš„ IP åœ°å€ã€‚å½“å±€åŸŸç½‘å†…çš„è®¾å¤‡éœ€è¦ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡æ—¶ï¼Œå®ƒä»¬ä¼šå°†æ•°æ®åŒ…å‘é€åˆ°ç½‘å…³çš„å±€åŸŸç½‘ IP åœ°å€ï¼Œç½‘å…³ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°å¤–éƒ¨ç½‘ç»œä¸­ã€‚å½“å¤–éƒ¨ç½‘ç»œä¸­çš„è®¾å¤‡è¿”å›å“åº”æ•°æ®åŒ…æ—¶ï¼Œç½‘å…³ä¼šå°†å“åº”æ•°æ®åŒ…è½¬å‘å›å±€åŸŸç½‘ï¼Œå¹¶å°†å…¶å‘é€åˆ°ç›¸åº”çš„ç›®æ ‡è®¾å¤‡ã€‚</p><p>åœ¨ TCP/IP åè®®ä¸­ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½éœ€è¦é…ç½®ä¸€ä¸ªé»˜è®¤ç½‘å…³çš„ IP åœ°å€ã€‚å½“è®¾å¤‡éœ€è¦ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡æ—¶ï¼Œå®ƒä¼šå°†æ•°æ®åŒ…å‘é€åˆ°é»˜è®¤ç½‘å…³çš„ IP åœ°å€ï¼Œç½‘å…³ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°å¤–éƒ¨ç½‘ç»œä¸­ã€‚å› æ­¤ï¼Œæ‰¾åˆ°ç½‘å…³çš„è¿‡ç¨‹æ˜¯åœ¨è®¾å¤‡é…ç½®ä¸­æŒ‡å®šå…¶é»˜è®¤ç½‘å…³çš„ IP åœ°å€ã€‚</p><h3 id="ç½‘é™…è·¯ç”±åè®®-æ€ä¹ˆç¡®å®šæœ€çŸ­è·¯ç”±" tabindex="-1"><a class="header-anchor" href="#ç½‘é™…è·¯ç”±åè®®-æ€ä¹ˆç¡®å®šæœ€çŸ­è·¯ç”±" aria-hidden="true">#</a> ç½‘é™…è·¯ç”±åè®®ï¼Œæ€ä¹ˆç¡®å®šæœ€çŸ­è·¯ç”±</h3><p>ç½‘é™…è·¯ç”±åè®®ä½¿ç”¨äº†ä¸€ç§å«åš&quot;è·ç¦»å‘é‡ç®—æ³•&quot;ï¼ˆdistance vector algorithmï¼‰çš„ç®—æ³•æ¥ç¡®å®šæœ€çŸ­è·¯ç”±ã€‚è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œæ¯ä¸ªè·¯ç”±å™¨å°†è‡ªå·±åˆ°ç›®æ ‡åœ°å€çš„è·ç¦»ï¼ˆé€šå¸¸ç”¨è·³æ•°æˆ–è€…å®é™…è·ç¦»ç­‰é‡æ¥åº¦é‡ï¼‰å‘Šè¯‰ç›¸é‚»çš„è·¯ç”±å™¨ï¼Œç›¸é‚»çš„è·¯ç”±å™¨å†å°†è¿™äº›ä¿¡æ¯ä¼ é€’ç»™å®ƒä»¬çš„ç›¸é‚»è·¯ç”±å™¨ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€ç»ˆæ‰€æœ‰çš„è·¯ç”±å™¨éƒ½ä¼šçŸ¥é“åˆ°è¾¾ç›®æ ‡åœ°å€çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªè·¯ç”±å™¨ä¼šå‘¨æœŸæ€§åœ°å‘å®ƒçš„ç›¸é‚»è·¯ç”±å™¨å‘é€ä¸€ä¸ª&quot;è·¯ç”±æ›´æ–°æ¶ˆæ¯&quot;ï¼ˆrouting update messageï¼‰ï¼Œè¿™ä¸ªæ¶ˆæ¯åŒ…å«äº†è¯¥è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬äº†åˆ°ç›®æ ‡åœ°å€çš„è·ç¦»ä»¥åŠä¸‹ä¸€è·³è·¯ç”±å™¨çš„ä¿¡æ¯ã€‚å½“ä¸€ä¸ªè·¯ç”±å™¨æ”¶åˆ°äº†ç›¸é‚»è·¯ç”±å™¨çš„è·¯ç”±æ›´æ–°æ¶ˆæ¯åï¼Œä¼šæ ¹æ®è¿™ä¸ªæ¶ˆæ¯æ›´æ–°è‡ªå·±çš„è·¯ç”±è¡¨ã€‚å¦‚æœæ›´æ–°åçš„è·¯ç”±è¡¨å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±å™¨å°±ä¼šå‘å®ƒçš„ç›¸é‚»è·¯ç”±å™¨å‘é€è‡ªå·±çš„è·¯ç”±æ›´æ–°æ¶ˆæ¯ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰çš„è·¯ç”±å™¨çš„è·¯ç”±è¡¨éƒ½æ”¶æ•›åˆ°æœ€çŸ­è·¯å¾„ä¸ºæ­¢ã€‚</p><p>è·ç¦»å‘é‡ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“å®ç°ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå½“è·¯ç”±å™¨ä¹‹é—´çš„é“¾è·¯å‡ºç°æ•…éšœæ—¶ï¼Œè·¯ç”±å™¨çš„è·¯ç”±è¡¨å¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´è·¯ç”±ç¯è·¯ã€è·¯ç”±éœ‡è¡ç­‰é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç½‘é™…è·¯ç”±åè®®è¿˜å¼•å…¥äº†ä¸€äº›æœºåˆ¶ï¼Œä¾‹å¦‚è·¯ç”±èšåˆã€è·¯ç”±æ±‡æ€»ã€è·¯ç”±é‡åˆ†å‘ç­‰ã€‚</p><h3 id="dns-dns-è¿‡ç¨‹-dns-è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#dns-dns-è¿‡ç¨‹-dns-è´Ÿè½½å‡è¡¡" aria-hidden="true">#</a> DNSï¼ˆDNS è¿‡ç¨‹ï¼ŒDNS è´Ÿè½½å‡è¡¡ï¼‰</h3><p>è§£æè¿‡ç¨‹ï¼ˆå‚ç…§ä¸Šé¢é—®é¢˜ï¼šDNS è§£æè¿‡ç¨‹ï¼Œç»™ä¸ª URL ä¸€å±‚ä¸€å±‚å…·ä½“åˆ†æï¼‰</p><p><strong>DNS è´Ÿè½½å‡è¡¡</strong></p><p>æœ€æ—©çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œåˆ©ç”¨åŸŸåè§£æå®ç°è´Ÿè½½å‡è¡¡ï¼Œåœ¨ DNS æœåŠ¡å™¨ï¼Œé…ç½®å¤šä¸ª A è®°å½•ï¼Œè¿™äº› A è®°å½•å¯¹åº”çš„æœåŠ¡å™¨æ„æˆé›†ç¾¤ã€‚å¤§å‹ç½‘ç«™æ€»æ˜¯éƒ¨åˆ†ä½¿ç”¨ DNS è§£æï¼Œä½œä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+fe+'" alt="image-20220413195638289" tabindex="0" loading="lazy"><figcaption>image-20220413195638289</figcaption></figure><p><strong>å®è·µå»ºè®®</strong></p><p>å°† DNS ä½œä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡ï¼ŒA è®°å½•å¯¹åº”ç€å†…éƒ¨è´Ÿè½½å‡è¡¡çš„ IP åœ°å€ï¼Œé€šè¿‡å†…éƒ¨è´Ÿè½½å‡è¡¡å°†è¯·æ±‚åˆ†å‘åˆ°çœŸå®çš„ Web æœåŠ¡å™¨ä¸Šã€‚ä¸€èˆ¬ç”¨äºäº’è”ç½‘å…¬å¸ï¼Œå¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿä¸åˆé€‚ä½¿ç”¨ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="'+ye+`" alt="image-20220413195646340" tabindex="0" loading="lazy"><figcaption>image-20220413195646340</figcaption></figure><h3 id="ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆ" aria-hidden="true">#</a> ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆ</h3><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥åï¼š</p><ol><li>åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯å‘é€SYN+ACKæŠ¥æ–‡åï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿”å›çš„ACKæŠ¥æ–‡ã€‚</li><li>å¦‚æœç¬¬ä¸‰æ¬¡æ¡æ‰‹å¤±è´¥çš„è¯ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯è¿”å›äº†ACKæŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯å¹¶ä¸èƒ½æ”¶åˆ°è¿™ä¸ªACKæŠ¥æ–‡ã€‚é‚£ä¹ˆæœåŠ¡ç«¯å°±ä¼šå¯åŠ¨è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œè¶…è¿‡è§„å®šæ—¶é—´åé‡æ–°å‘èµ·ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œå‘å®¢æˆ·ç«¯å‘é€SYN+ACKã€‚é‡ä¼ æ¬¡æ•°æ ¹æ®/proc/sys/net/ipv4/tcp_synack_retriesæ¥æŒ‡å®šï¼Œé»˜è®¤æ˜¯5æ¬¡ã€‚</li><li>å¦‚æœé‡ä¼ æŒ‡å®šæ¬¡æ•°åˆ°äº†åï¼Œä»ç„¶æœªæ”¶åˆ°ACKåº”ç­”ï¼Œé‚£ä¹ˆä¸€æ®µæ—¶é—´åï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨å…³é—­è¿™ä¸ªè¿æ¥ã€‚ä½†å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªè¿æ¥å·²ç»å»ºç«‹ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å†™æ•°æ®ï¼ŒæœåŠ¡ç«¯å°†å›åº”RSTåŒ…ã€å¼ºåˆ¶å…³é—­TCPè¿æ¥ï¼Œä»¥é˜²æ­¢SYNæ”»å‡»ã€‚</li></ol><p>æ‰©å±•ï¼šTCPä¸ºä»€ä¹ˆéœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p><p><code>https://www.iamshuaidi.com/675.html</code></p><p>åŸå› ï¼š</p><p>1ï¼‰ä¸¤æ¬¡æ¡æ‰‹æ˜¯æœ€åŸºæœ¬çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹èƒ½ä¿è¯tcpè¿æ¥æ­£å¸¸è¿›è¡Œã€‚</p><p>2ï¼‰éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯è€Œäº§ç”Ÿè¿æ¥çš„è¯¯åˆ¤ ã€‚</p><pre><code>å‡å¦‚æ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¤±æ•ˆçš„è¯·æ±‚æŠ¥æ–‡æ®µå°±ä¼šè®¤ä¸ºè¿æ¥å·²å»ºç«‹ï¼Œä»è€Œè¿›å…¥ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®çš„çŠ¶æ€ã€‚ä½†å®¢æˆ·ç«¯å¹¶æ²¡æœ‰å‘å‡ºè¯·æ±‚ï¼Œæ‰€ä»¥ä¸ä¼šå‘é€æ•°æ®ã€‚äºæ˜¯æœåŠ¡ç«¯å°±ä¼šä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä»è€Œæµªè´¹èµ„æºã€‚
</code></pre><h3 id="æ•°æ®é“¾è·¯å±‚æ€ä¹ˆä¼ è¾“æ•°æ®çš„-å±•å¼€è¯´è¯´-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#æ•°æ®é“¾è·¯å±‚æ€ä¹ˆä¼ è¾“æ•°æ®çš„-å±•å¼€è¯´è¯´-2022å­—èŠ‚" aria-hidden="true">#</a> æ•°æ®é“¾è·¯å±‚æ€ä¹ˆä¼ è¾“æ•°æ®çš„ï¼Œå±•å¼€è¯´è¯´ï¼ˆ2022å­—èŠ‚ï¼‰</h3><p><strong>æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŠ å¼ºç‰©ç†å±‚ä¼ è¾“åŸå§‹æ¯”ç‰¹æµçš„åŠŸèƒ½ã€‚å…¶è´Ÿè´£å°†ç‰©ç†å±‚æä¾›çš„å¯èƒ½å‡ºé”™çš„ç‰©ç†è¿æ¥ï¼Œæ”¹é€ æˆé€»è¾‘ä¸Šæ— å·®é”™çš„æ•°æ®é“¾è·¯ï¼Œä½¿ä¹‹å¯¹ç½‘ç»œå±‚è¡¨ç°ä¸ºä¸€æ¡æ— å·®é”™çš„é“¾è·¯</strong>ã€‚</p><p>æ•°æ®é“¾è·¯å±‚åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼š<strong>å°è£…æˆå¸§ã€é€æ˜ä¼ è¾“ã€å·®é”™æ§åˆ¶</strong>ã€‚</p><h4 id="å°è£…æˆå¸§" tabindex="-1"><a class="header-anchor" href="#å°è£…æˆå¸§" aria-hidden="true">#</a> å°è£…æˆå¸§</h4><p>åœ¨ç‰©ç†å±‚å‘é€çš„ä¿¡å·æœ¬èº«æ˜¯æ²¡æœ‰èµ·å§‹ä¸ç»“æŸæ ‡å¿—çš„ï¼ŒåŒæ—¶æ•°æ®é“¾è·¯å±‚åˆéœ€è¦å°†IPæ•°æ®æŠ¥ä¹Ÿæ·»åŠ åˆ°å¸§ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ç»¼åˆè€Œè¨€å°±æ˜¯å°è£…æˆå¸§çš„é—®é¢˜ã€‚</p><p>å°†IPæ•°æ®æŠ¥å°è£…æˆå¸§å¾ˆç®€å•ï¼Œåªéœ€åœ¨æ•°æ®éƒ¨åˆ†çš„å‰é¢æ·»åŠ ä¸€ä¸ªå¸§å¼€å§‹ç¬¦SOHï¼Œå¹¶åœ¨æ•°æ®éƒ¨åˆ†çš„åé¢æ·»åŠ ä¸€ä¸ªå¸§ç»“å°¾ç¬¦EOTã€‚åœ¨æ¥æ”¶æ•°æ®æ—¶å¦‚æœé‡åˆ°äº†å¸§å¼€å§‹ç¬¦å°±è¡¨ç¤ºéœ€è¦å¼€å§‹æ¥æ”¶æ•°æ®äº†ï¼Œå¦‚æœæ²¡æœ‰é‡åˆ°å°±è¯´æ˜å‰é¢æ”¶åˆ°çš„å¯èƒ½éƒ½æ˜¯å™ªå£°ä¸ç”¨åšå¤„ç†ã€‚ç„¶ååœ¨æ­¤é‡åˆ°å¸§ç»“æŸç¬¦å°±è¯´æ˜æ•°æ®ä¼ è¾“ç»“æŸï¼Œåé¢çš„éƒ¨åˆ†æ•°æ®ä¸åŒåœ¨å¤„ç†ï¼Œæ•°æ®å°è£…ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="`+we+'" alt="image-20220717144735430" tabindex="0" loading="lazy"><figcaption>image-20220717144735430</figcaption></figure><h4 id="é€æ˜ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#é€æ˜ä¼ è¾“" aria-hidden="true">#</a> é€æ˜ä¼ è¾“</h4><p>é€æ˜ä¼ è¾“æ˜¯æŒ‡ä¸ç®¡æ‰€ä¼ æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„æ¯”ç‰¹ç»„åˆï¼Œéƒ½åº”å½“èƒ½å¤Ÿåœ¨é“¾è·¯ä¸Šä¼ é€ã€‚åœ¨æ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚åè®®å°è£…æˆå¸§æ—¶ï¼Œä¼šåœ¨é¦–éƒ¨å’Œå°¾éƒ¨åˆ†åˆ«æ·»åŠ SOHä»¥åŠEOTè¿™ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œæ¥æ”¶æ–¹æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªå­—ç¬¦æ¥ç¡®å®šå¸§é¦–å’Œå¸§å°¾çš„ï¼ˆäº§ç”Ÿäº†äºŒä¹‰æ€§ï¼‰ï¼Œå¦‚æœä¸Šå±‚åè®®å‘é€è¿‡æ¥çš„æ•°æ®(å³é“¾è·¯å±‚çš„æ•°æ®éƒ¨åˆ†)åŒ…å«EOTï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹åœ¨è§£æè¿™ä¸ªå¸§çš„æ—¶å€™å°±ä¼šè¯¯ä»¥ä¸ºæ•°æ®å·²ç»ç»“æŸï¼Œè¿™ç§æƒ…å†µä¸‹ä¼ è¾“æ•°æ®å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœé“¾è·¯å±‚å¯¹è¿™ç§æƒ…å†µæ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç†è§£é“¾è·¯å±‚ä¸ºéé€æ˜ä¼ è¾“(å› ä¸ºæ— æ³•ä¼ è¾“EOTè¿™ä¸ªå­—ç¬¦)ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥åœ¨æ•°æ®éƒ¨åˆ†çš„SOHã€EOTå­—ç¬¦å‰æ·»åŠ ä¸€è½¬ä¹‰å­—ç¬¦ESC,åœ¨ä¼ è¾“æ—¶å¦‚æœç›´æ¥æ¥æ”¶åˆ°SOHã€EOTå­—ç¬¦è¿˜æ˜¯è¡¨ç¤ºä¸ºå¸§çš„å¼€å§‹ä¸ç»“æŸæ ‡å¿—ï¼Œä½†æ˜¯å¦‚æœæ¥æ”¶æ—¶æ¥æ”¶åˆ°äº†ESCç„¶åæ¥æ”¶åˆ°SOHã€EOTï¼Œå°±è¯´æ˜è¿™ä¸¤ä¸ªå­—ç¬¦ä¸æ˜¯å¸§çš„å¼€å§‹ä¸ç»“æŸæ ‡å¿—ï¼Œæ˜¯å¸§æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·å°±å®Œæˆäº†é€æ˜ä¼ è¾“çš„é—®é¢˜ã€‚</p><h4 id="å·®é”™æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#å·®é”™æ§åˆ¶" aria-hidden="true">#</a> å·®é”™æ§åˆ¶</h4><p>ç°å®çš„é€šä¿¡é“¾è·¯éƒ½ä¸ä¼šæ˜¯ç†æƒ³çš„ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¯”ç‰¹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šäº§ç”Ÿå·®é”™:1å¯èƒ½ä¼šå˜æˆ0ï¼Œè€Œ0ä¹Ÿå¯èƒ½å˜æˆ1ã€‚</p><p>ä¸ºäº†æ£€æµ‹è¿™ç§å·®é”™ï¼Œæ•°æ®é“¾è·¯å±‚é‡‡ç”¨äº†æ ¡éªŒç ã€‚æ•°æ®é“¾è·¯å±‚åœ¨ä¼ è¾“å‰ç”Ÿæˆæ ¡éªŒç åŒæ•°æ®ä¸€èµ·å‘é€ï¼Œæ¥å—åé€šè¿‡æ ¡éªŒç æ ¡éªŒæ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ ¡éªŒå‡ºé”™å°±ç›´æ¥ä¸¢å¼ƒè¯¥å¸§ï¼Œå¦‚æœæ²¡æœ‰å‡ºé”™å°±ç›´æ¥ä¿å­˜ï¼Œè§£æï¼Œå¹¶å°†æ•°æ®éƒ¨åˆ†ä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚åœ¨ä½¿ç”¨ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„å°±æ˜¯CRCå¾ªç¯å†—ä½™æ ¡éªŒã€‚</p><h3 id="arpåè®®ä¸­ç½‘å…³æ€ä¹ˆå»è½¬æ¢ipåœ°å€åˆ°å¯¹åº”macåœ°å€çš„-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#arpåè®®ä¸­ç½‘å…³æ€ä¹ˆå»è½¬æ¢ipåœ°å€åˆ°å¯¹åº”macåœ°å€çš„-2022å­—èŠ‚" aria-hidden="true">#</a> Arpåè®®ä¸­ç½‘å…³æ€ä¹ˆå»è½¬æ¢ipåœ°å€åˆ°å¯¹åº”MACåœ°å€çš„ï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>åœ¨ä¼ è¾“ä¸€ä¸ª IP æ•°æ®æŠ¥çš„æ—¶å€™ï¼Œç¡®å®šäº†æº IP åœ°å€å’Œç›®æ ‡ IP åœ°å€åï¼Œå°±ä¼šé€šè¿‡ä¸»æœºã€Œè·¯ç”±è¡¨ã€ç¡®å®š IP æ•°æ®åŒ…ä¸‹ä¸€è·³ã€‚ç„¶è€Œï¼Œç½‘ç»œå±‚çš„ä¸‹ä¸€å±‚æ˜¯æ•°æ®é“¾è·¯å±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦çŸ¥é“ã€Œä¸‹ä¸€è·³ã€çš„ MAC åœ°å€ã€‚</p><p>ç”±äºä¸»æœºçš„è·¯ç”±è¡¨ä¸­å¯ä»¥æ‰¾åˆ°ä¸‹ä¸€è·³çš„ IP åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ <strong>ARP åè®®</strong>ï¼Œæ±‚å¾—ä¸‹ä¸€è·³çš„ MAC åœ°å€ã€‚</p><blockquote><p>é‚£ä¹ˆ ARP åˆæ˜¯å¦‚ä½•çŸ¥é“å¯¹æ–¹ MAC åœ°å€çš„å‘¢ï¼Ÿ</p></blockquote><p>ç®€å•åœ°è¯´ï¼ŒARP æ˜¯å€ŸåŠ© <strong>ARP è¯·æ±‚ä¸ ARP å“åº”</strong>ä¸¤ç§ç±»å‹çš„åŒ…ç¡®å®š MAC åœ°å€çš„ã€‚</p><figure><img src="'+Ce+'" alt="image-20220717150335032" tabindex="0" loading="lazy"><figcaption>image-20220717150335032</figcaption></figure><ul><li>ä¸»æœºä¼šé€šè¿‡<strong>å¹¿æ’­å‘é€ ARP è¯·æ±‚</strong>ï¼Œè¿™ä¸ªåŒ…ä¸­åŒ…å«äº†æƒ³è¦çŸ¥é“çš„ MAC åœ°å€çš„ä¸»æœº IP åœ°å€ã€‚</li><li>å½“åŒä¸ªé“¾è·¯ä¸­çš„æ‰€æœ‰è®¾å¤‡æ”¶åˆ° ARP è¯·æ±‚æ—¶ï¼Œä¼šå»æ‹†å¼€ ARP è¯·æ±‚åŒ…é‡Œçš„å†…å®¹ï¼Œå¦‚æœ ARP è¯·æ±‚åŒ…ä¸­çš„ç›®æ ‡ IP åœ°å€ä¸è‡ªå·±çš„ IP åœ°å€ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªè®¾å¤‡å°±å°†è‡ªå·±çš„ MAC åœ°å€å¡å…¥ <strong>ARP å“åº”åŒ…</strong>è¿”å›ç»™ä¸»æœºã€‚</li></ul><p>æ“ä½œç³»ç»Ÿé€šå¸¸ä¼šæŠŠç¬¬ä¸€æ¬¡é€šè¿‡ ARP è·å–çš„ MAC åœ°å€ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡ç›´æ¥ä»ç¼“å­˜ä¸­æ‰¾åˆ°å¯¹åº” IP åœ°å€çš„ MAC åœ°å€ã€‚</p><p>ä¸è¿‡ï¼ŒMAC åœ°å€çš„ç¼“å­˜æ˜¯æœ‰ä¸€å®šæœŸé™çš„ï¼Œè¶…è¿‡è¿™ä¸ªæœŸé™ï¼Œç¼“å­˜çš„å†…å®¹å°†è¢«æ¸…é™¤ã€‚</p><blockquote><p>RARP åè®®ä½ çŸ¥é“æ˜¯ä»€ä¹ˆå—ï¼Ÿ</p></blockquote><p>ARP åè®®æ˜¯å·²çŸ¥ IP åœ°å€æ±‚ MAC åœ°å€ï¼Œé‚£ RARP åè®®æ­£å¥½ç›¸åï¼Œå®ƒæ˜¯<strong>å·²çŸ¥ MAC åœ°å€æ±‚ IP åœ°å€</strong>ã€‚ä¾‹å¦‚å°†æ‰“å°æœºæœåŠ¡å™¨ç­‰å°å‹åµŒå…¥å¼è®¾å¤‡æ¥å…¥åˆ°ç½‘ç»œæ—¶å°±ç»å¸¸ä¼šç”¨å¾—åˆ°ã€‚</p><p>é€šå¸¸è¿™éœ€è¦æ¶è®¾ä¸€å° <code>RARP</code> æœåŠ¡å™¨ï¼Œåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ³¨å†Œè®¾å¤‡çš„ MAC åœ°å€åŠå…¶ IP åœ°å€ã€‚ç„¶åå†å°†è¿™ä¸ªè®¾å¤‡æ¥å…¥åˆ°ç½‘ç»œï¼Œæ¥ç€ï¼š</p><ul><li>è¯¥è®¾å¤‡ä¼šå‘é€ä¸€æ¡ã€Œæˆ‘çš„ MAC åœ°å€æ˜¯XXXXï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘çš„IPåœ°å€åº”è¯¥æ˜¯ä»€ä¹ˆã€çš„è¯·æ±‚ä¿¡æ¯ã€‚</li><li>RARP æœåŠ¡å™¨æ¥åˆ°è¿™ä¸ªæ¶ˆæ¯åè¿”å›ã€ŒMACåœ°å€ä¸º XXXX çš„è®¾å¤‡ï¼ŒIPåœ°å€ä¸º XXXXã€çš„ä¿¡æ¯ç»™è¿™ä¸ªè®¾å¤‡ã€‚</li></ul><p>æœ€åï¼Œè®¾å¤‡å°±æ ¹æ®ä» RARP æœåŠ¡å™¨æ‰€æ”¶åˆ°çš„åº”ç­”ä¿¡æ¯è®¾ç½®è‡ªå·±çš„ IP åœ°å€ã€‚</p><figure><img src="'+Se+'" alt="image-20220717150345746" tabindex="0" loading="lazy"><figcaption>image-20220717150345746</figcaption></figure><h3 id="pop3å±äºå“ªä¸ªå±‚çš„åè®®-2022å­—èŠ‚" tabindex="-1"><a class="header-anchor" href="#pop3å±äºå“ªä¸ªå±‚çš„åè®®-2022å­—èŠ‚" aria-hidden="true">#</a> pop3å±äºå“ªä¸ªå±‚çš„åè®®ï¼ˆ2022å­—èŠ‚ï¼‰</h3><p>å¾ˆæ˜æ˜¾å±äºï¼šåº”ç”¨å±‚</p><table><thead><tr><th>åº”ç”¨å±‚</th><th>DHCP Â· DNS Â· FTP Â· Gopher Â· HTTP Â· IMAP4 Â· IRC Â· NNTP Â· XMPP Â· POP3 Â· SIP Â· SMTP Â· SNMP Â· SSH Â· TELNET Â· RPC Â· RTCP Â· RTP Â·RTSP Â· SDP Â· SOAP Â· GTP Â· STUN Â· NTP Â· SSDP</th></tr></thead><tbody><tr><td>è¡¨ç¤ºå±‚</td><td>HTTP/HTML Â· FTP Â· Telnet Â· ASN.1ï¼ˆå…·æœ‰è¡¨ç¤ºå±‚åŠŸèƒ½ï¼‰</td></tr><tr><td>ä¼šè¯å±‚</td><td>ADSPÂ·ASPÂ·H.245Â·ISO-SPÂ·iSNSÂ·NetBIOSÂ·PAPÂ·RPCÂ· RTCPÂ·SMPPÂ·SCPÂ·SSHÂ·ZIPÂ·SDPï¼ˆå…·æœ‰ä¼šè¯å±‚åŠŸèƒ½ï¼‰</td></tr><tr><td>ä¼ è¾“å±‚</td><td>TCP Â· UDP Â· TLS Â· DCCP Â· SCTP Â·RSVP Â· PPTP</td></tr><tr><td>ç½‘ç»œå±‚</td><td>IP (IPv4 Â· IPv6) Â· ICMP Â· ICMPv6 Â· IGMP Â·IS-IS Â· IPsec Â· BGP Â· RIP Â· OSPF Â·ARP Â· RARP</td></tr><tr><td>æ•°æ®é“¾è·¯å±‚</td><td>Wi-Fi(IEEE 802.11) Â· WiMAX(IEEE 802.16) Â·ATM Â· DTM Â· ä»¤ç‰Œç¯ Â· ä»¥å¤ªç½‘è·¯ Â· FDDI Â· å¸§ä¸­ç»§ Â· GPRS Â· EVDO Â· HSPA Â· HDLC Â· PPP Â· L2TP Â· ISDN Â·STP</td></tr><tr><td>ç‰©ç†å±‚</td><td>ä»¥å¤ªç½‘è·¯å¡ Â· è°ƒåˆ¶è§£è°ƒå™¨ Â· ç”µåŠ›çº¿é€šä¿¡(PLC) Â· SONET/SDHï¼ˆå…‰åŒæ­¥æ•°å­—ä¼ è¾“ç½‘ï¼‰ Â· G.709ï¼ˆå…‰ä¼ è¾“ç½‘ç»œï¼‰ Â· å…‰å¯¼çº¤ç»´ Â· åŒè½´ç”µç¼† Â· åŒç»çº¿</td></tr></tbody></table><h3 id="tcp-æ‹¥å¡æ§åˆ¶-æ…¢å¯åŠ¨çš„æ—¶å€™çª—å£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¢é•¿-ä¸ºä»€ä¹ˆä¼šå‘ˆæŒ‡æ•°å¢é•¿" tabindex="-1"><a class="header-anchor" href="#tcp-æ‹¥å¡æ§åˆ¶-æ…¢å¯åŠ¨çš„æ—¶å€™çª—å£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¢é•¿-ä¸ºä»€ä¹ˆä¼šå‘ˆæŒ‡æ•°å¢é•¿" aria-hidden="true">#</a> TCP æ‹¥å¡æ§åˆ¶ï¼Ÿæ…¢å¯åŠ¨çš„æ—¶å€™çª—å£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¢é•¿ï¼Ÿä¸ºä»€ä¹ˆä¼šå‘ˆæŒ‡æ•°å¢é•¿ï¼Ÿ</h3><p>æ…¢å¯åŠ¨ï¼šæ¯æ¬¡æ”¶åˆ°ä¸€ä¸ª ACK æŠ¥æ–‡å°†æ‹¥å¡çª—å£ï¼ˆcwndï¼‰åŠ ä¸Šä¸€ä¸ª MSSï¼Œä» 1 å¼€å§‹æˆæŒ‡æ•°çº§å¢é•¿</p><p>æ‹¥å¡é¿å…ï¼šå½“ cwnd â‰¥ æ…¢å¯åŠ¨é˜ˆå€¼ï¼ˆsstreshï¼‰æ—¶ï¼Œçª—å£æŒ‰çº¿æ€§å¢é•¿ï¼Œå½“æ”¶åˆ°ä¸‰ä¸ªè¿ç»­çš„å†—ä½™ ACK åï¼Œè¿›å…¥å¿«é‡å¯</p><p>å¿«é‡å¯ï¼šsstresh=cwnd, cwnd = sstresh + 3*MSSï¼ˆä¸‰æ¬¡å†—ä½™çš„ï¼‰å¹¶å‘é€ä¸¢å¤±çš„æŠ¥æ–‡ï¼Œæ¯æ¬¡æ”¶åˆ°å†—ä½™çš„å°±æŒ‡æ•°çº§å¢é•¿ç›´åˆ°æ”¶åˆ°æ–°çš„ ACKï¼Œè¿›å…¥æ‹¥å¡é¿å…æˆ–è€…è¶…æ—¶è¿›å…¥æ…¢é‡å¯</p><p>TCPæ‹¥å¡æ§åˆ¶æ˜¯ä¸€ç§æµé‡æ§åˆ¶æœºåˆ¶ï¼Œå®ƒç”¨äºç¡®ä¿ç½‘ç»œä¸ä¼šå› ä¸ºå‘é€çš„æ•°æ®é‡è¿‡å¤§è€Œå‘ç”Ÿæ‹¥å¡ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ€§èƒ½ä¸‹é™æˆ–å´©æºƒã€‚TCPæ‹¥å¡æ§åˆ¶é€šè¿‡åŠ¨æ€è°ƒæ•´å‘é€æ–¹çš„æ‹¥å¡çª—å£å¤§å°æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚</p><p>åœ¨TCPè¿æ¥å»ºç«‹ä¹‹åˆï¼Œå‘é€æ–¹ä¼šé€šè¿‡æ…¢å¯åŠ¨ï¼ˆSlow Startï¼‰ç®—æ³•æ¥é€æ¸å¢åŠ å…¶å‘é€çª—å£å¤§å°ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œå‡ºç°æ‹¥å¡ä¹‹å‰ï¼Œå°½å¯èƒ½å……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½ã€‚åœ¨æ…¢å¯åŠ¨é˜¶æ®µï¼Œæ¯ä¸ªå›åˆï¼ˆRound Trip Timeï¼ŒRTTï¼‰ç»“æŸæ—¶ï¼Œå‘é€çª—å£å¤§å°å°†åŠ å€ï¼Œä»è€Œå‘ˆæŒ‡æ•°å¢é•¿ï¼Œç›´åˆ°ç½‘ç»œå‡ºç°æ‹¥å¡æˆ–è€…å‘é€çª—å£å¤§å°è¾¾åˆ°æŸä¸ªé™åˆ¶ï¼ˆå¦‚æ¥æ”¶æ–¹çš„æ¥æ”¶çª—å£å¤§å°ï¼‰ã€‚</p><p>çª—å£å¤§å°å¢é•¿çš„æŒ‡æ•°æ€§å¢é•¿æ˜¯å› ä¸ºTCPå‘é€æ–¹å¸Œæœ›å°½å¿«æ¢æµ‹å‡ºç½‘ç»œçš„å¸¦å®½å®¹é‡ï¼Œå¹¶ä¸”åœ¨ä¸è¶…è¿‡ç½‘ç»œå®¹é‡çš„æƒ…å†µä¸‹å°½å¯èƒ½å¿«åœ°å°†æ•°æ®å‘é€å‡ºå»ã€‚å› æ­¤ï¼Œåœ¨æ…¢å¯åŠ¨æœŸé—´ï¼Œå‘é€æ–¹ä¼šé€šè¿‡å‘ˆæŒ‡æ•°å¢é•¿çš„æ–¹å¼å¢åŠ çª—å£å¤§å°ï¼Œä»¥å°½å¯èƒ½å¿«åœ°å ç”¨ç½‘ç»œå¸¦å®½ã€‚</p><figure><img src="'+xe+'" alt="image-20220727220128549" tabindex="0" loading="lazy"><figcaption>image-20220727220128549</figcaption></figure><figure><img src="'+_e+'" alt="image-20220727220131425" tabindex="0" loading="lazy"><figcaption>image-20220727220131425</figcaption></figure><h3 id="ä»€ä¹ˆæ˜¯-time-wait-çŠ¶æ€-ä¸ºä»€ä¹ˆéœ€è¦-time-wait-çŠ¶æ€-æ—¶é—´æ˜¯å¤šä¹…-ä¸ºä»€ä¹ˆ-2022å­—èŠ‚æå‰æ‰¹" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-time-wait-çŠ¶æ€-ä¸ºä»€ä¹ˆéœ€è¦-time-wait-çŠ¶æ€-æ—¶é—´æ˜¯å¤šä¹…-ä¸ºä»€ä¹ˆ-2022å­—èŠ‚æå‰æ‰¹" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ TIME_WAIT çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆéœ€è¦ TIME_WAIT çŠ¶æ€ï¼Ÿæ—¶é—´æ˜¯å¤šä¹…ï¼Œä¸ºä»€ä¹ˆï¼Ÿï¼ˆ2022å­—èŠ‚æå‰æ‰¹ï¼‰</h3><p>å››æ¬¡æŒ¥æ‰‹å®¢æˆ·ç«¯æ¥å—åˆ°æœåŠ¡ç«¯ FIN æŠ¥æ–‡åè¿”å› ACK æŠ¥æ–‡çš„çŠ¶æ€ å¯ä»¥é˜²æ­¢ ACK æŠ¥æ–‡ä¸¢å¤±ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ä¼šé‡å¤å‘ FIN æŠ¥æ–‡ è€Œ TIME_WAIT çš„é•¿åº¦ä¸º 2*MSL è¿™æ · ACK ä¸¢å¤±äº†ï¼ŒFIN å†æ¬¡å‘é€ï¼Œåœ¨è¿™æ—¶é—´é‡Œå®¢æˆ·ç«¯è¿˜èƒ½æ”¶åˆ° FIN æŠ¥æ–‡</p><figure><img src="'+Te+'" alt="image-20220727213947423" tabindex="0" loading="lazy"><figcaption>image-20220727213947423</figcaption></figure><h3 id="httpå„ä¸ªç‰ˆæœ¬-1-0-1-1-2-0-3-0-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#httpå„ä¸ªç‰ˆæœ¬-1-0-1-1-2-0-3-0-2022è”šæ¥" aria-hidden="true">#</a> HTTPå„ä¸ªç‰ˆæœ¬ (1.0ï¼Œ1.1ï¼Œ2.0ï¼Œ3.0) ï¼ˆ2022è”šæ¥ï¼‰</h3><h4 id="http-1-0" tabindex="-1"><a class="header-anchor" href="#http-1-0" aria-hidden="true">#</a> HTTP/1.0</h4><p>1996å¹´5æœˆï¼ŒHTTP/1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„æ•ˆç‡ï¼ŒHTTP/1.0è§„å®šæµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œæµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼ŒæœåŠ¡å™¨å®Œæˆè¯·æ±‚å¤„ç†åç«‹å³æ–­å¼€TCPè¿æ¥ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚ã€‚</p><p>è¿™ç§æ–¹å¼å°±å¥½åƒæˆ‘ä»¬æ‰“ç”µè¯çš„æ—¶å€™ï¼Œåªèƒ½è¯´ä¸€ä»¶äº‹å„¿ä¸€æ ·ï¼Œè¯´å®Œä¹‹åå°±è¦æŒ‚æ–­ï¼Œæƒ³è¦è¯´å¦å¤–ä¸€ä»¶äº‹å„¿çš„æ—¶å€™å°±è¦é‡æ–°æ‹¨æ‰“ç”µè¯ã€‚</p><p>HTTP/1.0ä¸­æµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œè¿æ¥æ— æ³•å¤ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªTCPè¿æ¥åªèƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å‘é€æ•°æ®å®Œæ¯•ï¼Œè¿æ¥å°±å…³é—­ï¼Œå¦‚æœè¿˜è¦è¯·æ±‚å…¶ä»–èµ„æºï¼Œå°±å¿…é¡»å†æ–°å»ºä¸€ä¸ªè¿æ¥ã€‚</p><p>æˆ‘ä»¬çŸ¥é“TCPè¿æ¥çš„å»ºç«‹éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ˜¯å¾ˆè€—è´¹æ—¶é—´çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚æ‰€ä»¥ï¼ŒHTTP/1.0ç‰ˆæœ¬çš„æ€§èƒ½æ¯”è¾ƒå·®ã€‚</p><blockquote><p>HTTP1.0 å…¶å®ä¹Ÿå¯ä»¥å¼ºåˆ¶å¼€å¯é•¿é“¾æ¥ï¼Œä¾‹å¦‚æ¥å—Connection: keep-alive è¿™ä¸ªå­—æ®µï¼Œä½†æ˜¯ï¼Œè¿™ä¸æ˜¯æ ‡å‡†å­—æ®µï¼Œä¸åŒå®ç°çš„è¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´ï¼Œå› æ­¤ä¸æ˜¯æ ¹æœ¬çš„è§£å†³åŠæ³•ã€‚</p></blockquote><h4 id="http-1-1" tabindex="-1"><a class="header-anchor" href="#http-1-1" aria-hidden="true">#</a> HTTP/1.1</h4><p>ä¸ºäº†è§£å†³HTTP/1.0å­˜åœ¨çš„ç¼ºé™·ï¼ŒHTTP/1.1äº1999å¹´è¯ç”Ÿã€‚ç›¸æ¯”è¾ƒäºHTTP/1.0æ¥è¯´ï¼Œæœ€ä¸»è¦çš„æ”¹è¿›å°±æ˜¯å¼•å…¥äº†æŒä¹…è¿æ¥ã€‚æ‰€è°“çš„æŒä¹…è¿æ¥å³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ã€‚</p><p>ç”±äºä¹‹å‰æ‰“ä¸€æ¬¡ç”µè¯åªèƒ½è¯´ä¸€ä»¶äº‹å„¿ï¼Œæ•ˆç‡å¾ˆä½ã€‚åæ¥äººä»¬æå‡ºä¸€ç§æƒ³æ³•ï¼Œå°±æ˜¯ç”µè¯æ‰“å®Œä¹‹åï¼Œå…ˆä¸ç›´æ¥æŒ‚æ–­ï¼Œè€Œæ˜¯æŒç»­ä¸€å°æ®µæ—¶é—´ï¼Œè¿™ä¸€å°æ®µæ—¶é—´å†…ï¼Œå¦‚æœè¿˜æœ‰äº‹æƒ…æ²Ÿé€šå¯ä»¥å†æ¬¡è¿›è¡Œæ²Ÿé€šã€‚</p><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘ç°å¯¹æ–¹ä¸€æ®µæ—¶é—´æ²¡æœ‰æ´»åŠ¨ï¼Œå°±å¯ä»¥ä¸»åŠ¨å…³é—­è¿æ¥ã€‚æˆ–è€…å®¢æˆ·ç«¯åœ¨æœ€åä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä¸»åŠ¨å‘Šè¯‰æœåŠ¡ç«¯è¦å…³é—­è¿æ¥ã€‚</p><p>HTTP/1.1ç‰ˆè¿˜å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ˆpipeliningï¼‰ï¼Œå³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·å°±è¿›ä¸€æ­¥æ”¹è¿›äº†HTTPåè®®çš„æ•ˆç‡ã€‚</p><figure><img src="'+Pe+'" alt="image-20220827111050845" tabindex="0" loading="lazy"><figcaption>image-20220827111050845</figcaption></figure><p>æœ‰äº†æŒä¹…è¿æ¥å’Œç®¡é“ï¼Œå¤§å¤§çš„æå‡äº†HTTPçš„æ•ˆç‡ã€‚ä½†æ˜¯æœåŠ¡ç«¯è¿˜æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œæ•ˆç‡è¿˜æœ‰æå‡çš„ç©ºé—´ã€‚</p><h4 id="http-2" tabindex="-1"><a class="header-anchor" href="#http-2" aria-hidden="true">#</a> HTTP/2</h4><p>HTTP/2 æ˜¯ HTTP åè®®è‡ª 1999 å¹´ HTTP 1.1 å‘å¸ƒåçš„é¦–ä¸ªæ›´æ–°ï¼Œä¸»è¦åŸºäº SPDY åè®®ã€‚</p><p>HTTP/2 ä¸ºäº†è§£å†³HTTP/1.1ä¸­ä»ç„¶å­˜åœ¨çš„æ•ˆç‡é—®é¢˜ï¼ŒHTTP/2 é‡‡ç”¨äº†å¤šè·¯å¤ç”¨ã€‚å³åœ¨ä¸€ä¸ªè¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ã€‚èƒ½è¿™æ ·åšæœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯HTTP/2è¿›è¡Œäº†äºŒè¿›åˆ¶åˆ†å¸§ï¼Œå³ HTTP/2 ä¼šå°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼ˆframeï¼‰,å¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè€æ¿å¯ä»¥åŒæ—¶ä¸‹è¾¾å¤šä¸ªå‘½ä»¤ï¼Œå‘˜å·¥ä¹Ÿå¯ä»¥æ”¶åˆ°äº†Aè¯·æ±‚å’ŒBè¯·æ±‚ï¼Œäºæ˜¯å…ˆå›åº”Aè¯·æ±‚ï¼Œç»“æœå‘ç°å¤„ç†è¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œäºæ˜¯å°±å‘é€Aè¯·æ±‚å·²ç»å¤„ç†å¥½çš„éƒ¨åˆ†ï¼Œ æ¥ç€å›åº”Bè¯·æ±‚ï¼Œå®Œæˆåï¼Œå†å‘é€Aè¯·æ±‚å‰©ä¸‹çš„éƒ¨åˆ†ã€‚Aè¯·æ±‚çš„ä¸¤éƒ¨åˆ†å“åº”åœ¨ç»„åˆåˆ°ä¸€èµ·å‘ç»™è€æ¿ã€‚</p><figure><img src="'+Le+'" alt="image-20220827111109255" tabindex="0" loading="lazy"><figcaption>image-20220827111109255</figcaption></figure><p>è€Œè¿™ä¸ªè´Ÿè´£æ‹†åˆ†ã€ç»„è£…è¯·æ±‚å’ŒäºŒè¿›åˆ¶å¸§çš„ä¸€å±‚å°±å«åšäºŒè¿›åˆ¶åˆ†å¸§å±‚ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚åšHeaderå‹ç¼©ã€æœåŠ¡ç«¯æ¨é€ç­‰ã€‚</p><p>Headerå‹ç¼©å°±æ˜¯å‹ç¼©è€æ¿å’Œå‘˜å·¥ä¹‹é—´çš„å¯¹è¯ã€‚</p><p>æœåŠ¡ç«¯æ¨é€å°±æ˜¯å‘˜å·¥äº‹å…ˆæŠŠä¸€äº›è€æ¿å¯èƒ½è¯¢é—®çš„äº‹æƒ…æç°å‘é€åˆ°è€æ¿çš„æ‰‹æœºï¼ˆç¼“å­˜ï¼‰ä¸Šã€‚è¿™æ ·è€æ¿æƒ³è¦çŸ¥é“çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥è¯»å–çŸ­ä¿¡ï¼ˆç¼“å­˜ï¼‰äº†ã€‚</p><p>ç›®å‰ï¼Œä¸»æµçš„HTTPåè®®è¿˜æ˜¯HTTP/1.1 å’Œ HTTP/2ã€‚å¹¶ä¸”å„å¤§ç½‘ç«™çš„HTTP/2çš„ä½¿ç”¨ç‡ä¹Ÿåœ¨é€å¹´å¢åŠ ã€‚</p>',394),fo={href:"https://xiaolincoding.com/network/2_http/http3.html",target:"_blank",rel:"noopener noreferrer"},yo=t('<h3 id="http2-0ä¹‹å‰æ€ä¹ˆå®ç°æœåŠ¡å™¨æ¨é€æœºåˆ¶-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#http2-0ä¹‹å‰æ€ä¹ˆå®ç°æœåŠ¡å™¨æ¨é€æœºåˆ¶-2022è”šæ¥" aria-hidden="true">#</a> HTTP2.0ä¹‹å‰æ€ä¹ˆå®ç°æœåŠ¡å™¨æ¨é€æœºåˆ¶ï¼ˆ2022è”šæ¥ï¼‰</h3><p>HTTP/1.1 ä¸æ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€èµ„æºç»™å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚åï¼Œæ‰èƒ½è·å–åˆ°æœåŠ¡å™¨å“åº”çš„èµ„æºã€‚</p><p>æ¯”å¦‚ï¼Œå®¢æˆ·ç«¯é€šè¿‡ HTTP/1.1 è¯·æ±‚ä»æœåŠ¡å™¨é‚£è·å–åˆ°äº† HTML æ–‡ä»¶ï¼Œè€Œ HTML å¯èƒ½è¿˜éœ€è¦ä¾èµ– CSS æ¥æ¸²æŸ“é¡µé¢ï¼Œè¿™æ—¶å®¢æˆ·ç«¯è¿˜è¦å†å‘èµ·è·å– CSS æ–‡ä»¶çš„è¯·æ±‚ï¼Œéœ€è¦ä¸¤æ¬¡æ¶ˆæ¯å¾€è¿”ï¼Œå¦‚ä¸‹å›¾å·¦è¾¹éƒ¨åˆ†ï¼š</p><figure><img src="'+Re+`" alt="image-20220827110512850" tabindex="0" loading="lazy"><figcaption>image-20220827110512850</figcaption></figure><p>å¦‚ä¸Šå›¾å³è¾¹éƒ¨åˆ†ï¼Œåœ¨ HTTP/2 ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨è®¿é—® HTML æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç›´æ¥ä¸»åŠ¨æ¨é€ CSS æ–‡ä»¶ï¼Œå‡å°‘äº†æ¶ˆæ¯ä¼ é€’çš„æ¬¡æ•°ã€‚</p><p>åœ¨ Nginx ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›å®¢æˆ·ç«¯è®¿é—® /test.html æ—¶ï¼ŒæœåŠ¡å™¨ç›´æ¥æ¨é€ /test.cssï¼Œé‚£ä¹ˆå¯ä»¥è¿™ä¹ˆé…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>location /test.html { 
  http2_push /test.css; 
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ HTTP/2 çš„æ¨é€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¿…é¡»ä½¿ç”¨çš„æ˜¯å¥‡æ•°å· Streamï¼ŒæœåŠ¡å™¨ä¸»åŠ¨çš„æ¨é€ï¼Œä½¿ç”¨çš„æ˜¯å¶æ•°å· Streamã€‚æœåŠ¡å™¨åœ¨æ¨é€èµ„æºæ—¶ï¼Œä¼šé€šè¿‡ <code>PUSH_PROMISE</code> å¸§ä¼ è¾“ HTTP å¤´éƒ¨ï¼Œå¹¶é€šè¿‡å¸§ä¸­çš„ <code>Promised Stream ID</code> å­—æ®µå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œæ¥ä¸‹æ¥ä¼šåœ¨å“ªä¸ªå¶æ•°å· Stream ä¸­å‘é€åŒ…ä½“ã€‚</p><figure><img src="`+Ie+'" alt="image-20220827110523321" tabindex="0" loading="lazy"><figcaption>image-20220827110523321</figcaption></figure><p>å¦‚ä¸Šå›¾ï¼Œåœ¨ Stream 1 ä¸­é€šçŸ¥å®¢æˆ·ç«¯ CSS èµ„æºå³å°†åˆ°æ¥ï¼Œç„¶ååœ¨ Stream 2 ä¸­å‘é€ CSS èµ„æºï¼Œæ³¨æ„ Stream 1 å’Œ 2 æ˜¯å¯ä»¥<strong>å¹¶å‘</strong>çš„ã€‚</p><h3 id="tcpç²˜åŒ…æ˜¯ä»€ä¹ˆåŸå› -å¦‚ä½•è§£å†³-2022è™¾çš®" tabindex="-1"><a class="header-anchor" href="#tcpç²˜åŒ…æ˜¯ä»€ä¹ˆåŸå› -å¦‚ä½•è§£å†³-2022è™¾çš®" aria-hidden="true">#</a> tcpç²˜åŒ…æ˜¯ä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•è§£å†³ï¼Ÿï¼ˆ2022è™¾çš®ï¼‰</h3><h4 id="ä»€ä¹ˆæ˜¯ç²˜åŒ…" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç²˜åŒ…" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ç²˜åŒ…</h4><p>åœ¨è¿›è¡Œ Java NIO å­¦ä¹ æ—¶ï¼Œå¯èƒ½ä¼šå‘ç°ï¼šå¦‚æœå®¢æˆ·ç«¯è¿ç»­ä¸æ–­çš„å‘æœåŠ¡ç«¯å‘é€æ•°æ®åŒ…æ—¶ï¼ŒæœåŠ¡ç«¯æ¥æ”¶çš„æ•°æ®ä¼šå‡ºç°ä¸¤ä¸ªæ•°æ®åŒ…ç²˜åœ¨ä¸€èµ·çš„æƒ…å†µã€‚ TCP æ˜¯åŸºäºå­—èŠ‚æµçš„ï¼Œè™½ç„¶åº”ç”¨å±‚å’Œ TCP ä¼ è¾“å±‚ä¹‹é—´çš„æ•°æ®äº¤äº’æ˜¯å¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼Œä½†æ˜¯ TCP æŠŠè¿™äº›æ•°æ®å—ä»…ä»…çœ‹æˆä¸€è¿ä¸²æ— ç»“æ„çš„å­—èŠ‚æµï¼Œæ²¡æœ‰è¾¹ç•Œï¼› ä» TCP çš„å¸§ç»“æ„ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåœ¨ TCP çš„é¦–éƒ¨æ²¡æœ‰è¡¨ç¤ºæ•°æ®é•¿åº¦çš„å­—æ®µã€‚ åŸºäºä¸Šé¢ä¸¤ç‚¹ï¼Œåœ¨ä½¿ç”¨ TCP ä¼ è¾“æ•°æ®æ—¶ï¼Œæ‰æœ‰ç²˜åŒ…æˆ–è€…æ‹†åŒ…ç°è±¡å‘ç”Ÿçš„å¯èƒ½ã€‚ä¸€ä¸ªæ•°æ®åŒ…ä¸­åŒ…å«äº†å‘é€ç«¯å‘é€çš„ä¸¤ä¸ªæ•°æ®åŒ…çš„ä¿¡æ¯ï¼Œè¿™ç§ç°è±¡å³ä¸ºç²˜åŒ…ã€‚ æ¥æ”¶ç«¯æ”¶åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ•°æ®åŒ…è¦ä¹ˆæ˜¯ä¸å®Œæ•´çš„ï¼Œè¦ä¹ˆå°±æ˜¯å¤šå‡ºæ¥ä¸€å—ï¼Œè¿™ç§æƒ…å†µå³å‘ç”Ÿäº†æ‹†åŒ…å’Œç²˜åŒ…ã€‚æ‹†åŒ…å’Œç²˜åŒ…çš„é—®é¢˜å¯¼è‡´æ¥æ”¶ç«¯åœ¨å¤„ç†çš„æ—¶å€™ä¼šéå¸¸å›°éš¾ï¼Œå› ä¸ºæ— æ³•åŒºåˆ†ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚</p><h4 id="é»åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„" tabindex="-1"><a class="header-anchor" href="#é»åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„" aria-hidden="true">#</a> é»åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿ</h4><ul><li>å‘é€æ–¹äº§ç”Ÿç²˜åŒ… é‡‡ç”¨ TCP åè®®ä¼ è¾“æ•°æ®çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç»å¸¸æ˜¯ä¿æŒä¸€ä¸ªé•¿è¿æ¥çš„çŠ¶æ€ï¼ˆä¸€æ¬¡è¿æ¥å‘ä¸€æ¬¡æ•°æ®ä¸å­˜åœ¨ç²˜åŒ…ï¼‰ï¼ŒåŒæ–¹åœ¨è¿æ¥ä¸æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¸€ç›´ä¼ è¾“æ•°æ®ã€‚ä½†å½“å‘é€çš„æ•°æ®åŒ…è¿‡äºçš„å°æ—¶ï¼Œé‚£ä¹ˆ TCP åè®®é»˜è®¤çš„ä¼šå¯ç”¨ Nagle ç®—æ³•ï¼Œå°†è¿™äº›è¾ƒå°çš„æ•°æ®åŒ…è¿›è¡Œåˆå¹¶å‘é€ï¼ˆç¼“å†²åŒºæ•°æ®å‘é€æ˜¯ä¸€ä¸ªå †å‹çš„è¿‡ç¨‹ï¼‰ï¼›è¿™ä¸ªåˆå¹¶è¿‡ç¨‹å°±æ˜¯åœ¨å‘é€ç¼“å†²åŒºä¸­è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®å‘é€å‡ºæ¥å®ƒå·²ç»æ˜¯ç²˜åŒ…çš„çŠ¶æ€äº†ã€‚</li><li>æ¥æ”¶æ–¹äº§ç”Ÿç²˜åŒ… æ¥æ”¶æ–¹é‡‡ç”¨ TCP åè®®æ¥æ”¶æ•°æ®æ—¶çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šæ•°æ®åˆ°æ¥æ”¶æ–¹ï¼Œä»ç½‘ç»œæ¨¡å‹çš„ä¸‹æ–¹ä¼ é€’è‡³ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚çš„ TCP åè®®å¤„ç†æ˜¯å°†å…¶æ”¾ç½®æ¥æ”¶ç¼“å†²åŒºï¼Œç„¶åç”±åº”ç”¨å±‚æ¥ä¸»åŠ¨è·å–ï¼ˆC è¯­è¨€ç”¨ recvã€read ç­‰å‡½æ•°ï¼‰ï¼›è¿™æ—¶ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ç¨‹åºä¸­è°ƒç”¨çš„è¯»å–æ•°æ®å‡½æ•°ä¸èƒ½åŠæ—¶çš„æŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æ‹¿å‡ºæ¥ï¼Œè€Œä¸‹ä¸€ä¸ªæ•°æ®åˆåˆ°æ¥å¹¶æœ‰ä¸€éƒ¨åˆ†æ”¾å…¥çš„ç¼“å†²åŒºæœ«å°¾ï¼Œç­‰æˆ‘ä»¬è¯»å–æ•°æ®æ—¶å°±æ˜¯ä¸€ä¸ªç²˜åŒ…ã€‚ï¼ˆæ”¾æ•°æ®çš„é€Ÿåº¦ &gt; åº”ç”¨å±‚æ‹¿æ•°æ®é€Ÿåº¦ï¼‰</li></ul><h4 id="å¦‚ä½•è§£å†³" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³" aria-hidden="true">#</a> å¦‚ä½•è§£å†³</h4><p>ç²˜åŒ…çš„é—®é¢˜å‡ºç°æ˜¯å› ä¸ºä¸çŸ¥é“ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯çš„è¾¹ç•Œåœ¨å“ªï¼Œå¦‚æœçŸ¥é“äº†è¾¹ç•Œåœ¨å“ªï¼Œæ¥æ”¶æ–¹å°±å¯ä»¥é€šè¿‡è¾¹ç•Œæ¥åˆ’åˆ†å‡ºæœ‰æ•ˆçš„ç”¨æˆ·æ¶ˆæ¯ã€‚</p><p>ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼åˆ†åŒ…çš„æ–¹å¼ï¼š</p><ul><li>å›ºå®šé•¿åº¦çš„æ¶ˆæ¯ï¼›</li><li>ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œï¼›</li><li>è‡ªå®šä¹‰æ¶ˆæ¯ç»“æ„ã€‚</li></ul><h5 id="å›ºå®šé•¿åº¦çš„æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#å›ºå®šé•¿åº¦çš„æ¶ˆæ¯" aria-hidden="true">#</a> å›ºå®šé•¿åº¦çš„æ¶ˆæ¯</h5><p>è¿™ç§æ˜¯æœ€ç®€å•æ–¹æ³•ï¼Œå³æ¯ä¸ªç”¨æˆ·æ¶ˆæ¯éƒ½æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œæ¯”å¦‚è§„å®šä¸€ä¸ªæ¶ˆæ¯çš„é•¿åº¦æ˜¯ 64 ä¸ªå­—èŠ‚ï¼Œå½“æ¥æ”¶æ–¹æ¥æ»¡ 64 ä¸ªå­—èŠ‚ï¼Œå°±è®¤ä¸ºè¿™ä¸ªå†…å®¹æ˜¯ä¸€ä¸ªå®Œæ•´ä¸”æœ‰æ•ˆçš„æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯è¿™ç§æ–¹å¼çµæ´»æ€§ä¸é«˜ï¼Œå®é™…ä¸­å¾ˆå°‘ç”¨ã€‚</p><h5 id="ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ" aria-hidden="true">#</a> ç‰¹æ®Šå­—ç¬¦ä½œä¸ºè¾¹ç•Œ</h5><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç”¨æˆ·æ¶ˆæ¯ä¹‹é—´æ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·æ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œè¯»åˆ°äº†è¿™ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå°±æŠŠè®¤ä¸ºå·²ç»è¯»å®Œä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ã€‚</p><p>HTTP æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ã€‚</p><figure><img src="'+Ae+'" alt="å›¾ç‰‡" tabindex="0" loading="lazy"><figcaption>å›¾ç‰‡</figcaption></figure><p>HTTP é€šè¿‡è®¾ç½®å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ä½œä¸º HTTP æŠ¥æ–‡åè®®çš„è¾¹ç•Œã€‚</p><p>æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œè¿™ä¸ªä½œä¸ºè¾¹ç•Œç‚¹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœåˆšå¥½æ¶ˆæ¯å†…å®¹é‡Œæœ‰è¿™ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬è¦å¯¹è¿™ä¸ªå­—ç¬¦è½¬ä¹‰ï¼Œé¿å…è¢«æ¥æ”¶æ–¹å½“ä½œæ¶ˆæ¯çš„è¾¹ç•Œç‚¹è€Œè§£æåˆ°æ— æ•ˆçš„æ•°æ®ã€‚</p><h2 id="ğŸ–¼ï¸åœºæ™¯é¢˜" tabindex="-1"><a class="header-anchor" href="#ğŸ–¼ï¸åœºæ™¯é¢˜" aria-hidden="true">#</a> ğŸ–¼ï¸åœºæ™¯é¢˜</h2><h3 id="å¾ˆå¤šçŸ­ä»»åŠ¡çº¿ç¨‹-é€‰æ‹©-synchronized-è¿˜æ˜¯-lock-2022-04-11-æºç¨‹" tabindex="-1"><a class="header-anchor" href="#å¾ˆå¤šçŸ­ä»»åŠ¡çº¿ç¨‹-é€‰æ‹©-synchronized-è¿˜æ˜¯-lock-2022-04-11-æºç¨‹" aria-hidden="true">#</a> å¾ˆå¤šçŸ­ä»»åŠ¡çº¿ç¨‹ï¼Œé€‰æ‹© synchronized è¿˜æ˜¯ lockï¼ˆ2022-04-11 æºç¨‹ï¼‰</h3>',31),wo={href:"https://stackoverflow.com/questions/4201713/synchronization-vs-lock%E3%80%81https://www.geeksforgeeks.org/lock-framework-vs-thread-synchronization-in-java/%E3%80%81https://www.baeldung.com/java-concurrent-locks",target:"_blank",rel:"noopener noreferrer"},Co=t(`<p>synchronized å’Œ lock æ˜¯ä¸¤ç§ä¸åŒçš„ Java çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚synchronized æ˜¯åŸºäºéšå¼çš„ç›‘è§†å™¨é”ï¼Œè€Œ lock æ˜¯åŸºäºæ˜¾å¼çš„é”æ¥å£ã€‚ synchronized å’Œ lock ä¹‹é—´çš„é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œåœºæ™¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œlock æ¯” synchronized æ›´çµæ´»å’Œå¤æ‚ï¼Œå¯ä»¥æ”¯æŒæ›´ç»†ç²’åº¦çš„é”æ§åˆ¶å’Œæ›´å¤šçš„åŠŸèƒ½ã€‚</p><p>å¦‚æœä½ æœ‰å¾ˆå¤šçŸ­ä»»åŠ¡çº¿ç¨‹ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>æ€§èƒ½ï¼šlock é€šå¸¸æ¯” synchronized æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒå¯ä»¥é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé˜»å¡ã€‚</li><li>å¯é‡å…¥æ€§ï¼šsynchronized å’Œ lock éƒ½æ”¯æŒå¯é‡å…¥æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ã€‚</li><li>å…¬å¹³æ€§ï¼šsynchronized æ˜¯éå…¬å¹³çš„ï¼Œå³æ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹æŒ‰ç…§è¯·æ±‚é¡ºåºè·å–é”ã€‚lock å¯ä»¥æ˜¯å…¬å¹³çš„æˆ–éå…¬å¹³çš„ï¼Œå–å†³äºä½ ä½¿ç”¨å“ªç§å®ç°ç±»ã€‚</li><li>ä¸­æ–­æ€§ï¼šsynchronized æ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è·å–é”æ—¶æ— æ³•å“åº”ä¸­æ–­ã€‚lock æ˜¯å¯ä¸­æ–­çš„ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ç­‰å¾…è·å–é”æ—¶è¢«ä¸­æ–­å¹¶é‡Šæ”¾é”ã€‚</li><li>è¶…æ—¶æ€§ï¼šsynchronized æ˜¯æ— è¶…æ—¶çš„ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è·å–é”æ—¶æ— æ³•è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚lock æ˜¯æœ‰è¶…æ—¶çš„ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ç­‰å¾…è·å–é”æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶åœ¨è¶…æ—¶åæ”¾å¼ƒè·å–é”ã€‚</li><li>æ¡ä»¶å˜é‡ï¼šsynchronized åªèƒ½é…åˆ Object ç±»çš„ wait() å’Œ notify() æ–¹æ³•ä½¿ç”¨æ¡ä»¶å˜é‡ã€‚lock å¯ä»¥é…åˆ Condition æ¥å£ä½¿ç”¨å¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¹¶æ”¯æŒæ›´å¤šçš„æ“ä½œã€‚</li></ul><p>æ ¹æ®ä»¥ä¸Šæ¯”è¾ƒï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œåœºæ™¯é€‰æ‹© synchronized æˆ– lockã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦æ›´ç®€å•å’Œå¿«é€Ÿçš„åŒæ­¥æœºåˆ¶ï¼Œä½ å¯ä»¥é€‰æ‹© synchronizedï¼›å¦‚æœä½ éœ€è¦æ›´çµæ´»å’Œå¤æ‚çš„åŒæ­¥æœºåˆ¶ï¼Œä½ å¯ä»¥é€‰æ‹© lockã€‚</p><h3 id="å¤šä¸ªäººç»™ä¸€ä¸ªä¸»æ’­æ‰“èµæ€ä¹ˆè®¾è®¡-æˆ‘è¯´æ˜¯ä¸€ä¸ªé«˜å¹¶å‘å†™çš„æ“ä½œ-å¯¹ä¸€ä¸ªè®°å½•é¢‘ç¹å†™-åˆ†æ‰¹æ“ä½œ-æ¯”å¦‚-10-ä¸ªè®°å½•-æ“ä½œä¸€æ¬¡ã€‚ä»–è¯´è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥-ä½†æ˜¯æœ‰-100-ä¸ªè®°å½•-æ€ä¹ˆå»åšä¸€ä¸ªä¸€ä¸ªæ“ä½œå‘¢-æˆ‘è¯´å¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹å¯ä»¥-åˆ†å¤šä¸ªçº¿ç¨‹åˆ†æ‰¹ã€‚ä»–è¯´è¿˜æ˜¯ä¸å¤Ÿå¿«-æˆ‘ä»¬æ˜¯ç”¨çš„-mq-å¤šä¸ªæ¶ˆè´¹è€…-ä¸€ä¸ªæ‰“èµå°±å‘ä¸€ä¸ªæ¶ˆæ¯-2022-6-3-58åŒåŸ" tabindex="-1"><a class="header-anchor" href="#å¤šä¸ªäººç»™ä¸€ä¸ªä¸»æ’­æ‰“èµæ€ä¹ˆè®¾è®¡-æˆ‘è¯´æ˜¯ä¸€ä¸ªé«˜å¹¶å‘å†™çš„æ“ä½œ-å¯¹ä¸€ä¸ªè®°å½•é¢‘ç¹å†™-åˆ†æ‰¹æ“ä½œ-æ¯”å¦‚-10-ä¸ªè®°å½•-æ“ä½œä¸€æ¬¡ã€‚ä»–è¯´è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥-ä½†æ˜¯æœ‰-100-ä¸ªè®°å½•-æ€ä¹ˆå»åšä¸€ä¸ªä¸€ä¸ªæ“ä½œå‘¢-æˆ‘è¯´å¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹å¯ä»¥-åˆ†å¤šä¸ªçº¿ç¨‹åˆ†æ‰¹ã€‚ä»–è¯´è¿˜æ˜¯ä¸å¤Ÿå¿«-æˆ‘ä»¬æ˜¯ç”¨çš„-mq-å¤šä¸ªæ¶ˆè´¹è€…-ä¸€ä¸ªæ‰“èµå°±å‘ä¸€ä¸ªæ¶ˆæ¯-2022-6-3-58åŒåŸ" aria-hidden="true">#</a> å¤šä¸ªäººç»™ä¸€ä¸ªä¸»æ’­æ‰“èµæ€ä¹ˆè®¾è®¡ï¼Ÿæˆ‘è¯´æ˜¯ä¸€ä¸ªé«˜å¹¶å‘å†™çš„æ“ä½œï¼Œå¯¹ä¸€ä¸ªè®°å½•é¢‘ç¹å†™ï¼Œåˆ†æ‰¹æ“ä½œï¼Œæ¯”å¦‚ 10 ä¸ªè®°å½• æ“ä½œä¸€æ¬¡ã€‚ä»–è¯´è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥ ä½†æ˜¯æœ‰ 100 ä¸ªè®°å½• æ€ä¹ˆå»åšä¸€ä¸ªä¸€ä¸ªæ“ä½œå‘¢ï¼Ÿæˆ‘è¯´å¦‚æœåœ¨ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ åˆ†å¤šä¸ªçº¿ç¨‹åˆ†æ‰¹ã€‚ä»–è¯´è¿˜æ˜¯ä¸å¤Ÿå¿« æˆ‘ä»¬æ˜¯ç”¨çš„ MQ å¤šä¸ªæ¶ˆè´¹è€… ä¸€ä¸ªæ‰“èµå°±å‘ä¸€ä¸ªæ¶ˆæ¯ ï¼ˆ2022-6-3 58åŒåŸï¼‰</h3><h3 id="æ€ä¹ˆå®ç°ä¸€ä¸ªç‚¹èµåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆå®ç°ä¸€ä¸ªç‚¹èµåŠŸèƒ½" aria-hidden="true">#</a> æ€ä¹ˆå®ç°ä¸€ä¸ªç‚¹èµåŠŸèƒ½ï¼Ÿ</h3><p>é¡¹ç›®æ˜¯æ˜¯ SpringCloud + Dubboçš„ç»“æ„è¿™æ˜¯Controllerå±‚ä»£ç </p><p>ä¸»è¦çš„æµç¨‹è§£é‡Šä¸‹ï¼šå…ˆæŸ¥è¯¢æ•°æ®åº“æ”¹ç”¨æˆ·æ˜¯å¦è¿›è¡Œç‚¹èµï¼Œå¦‚æœå·²ç»ç‚¹èµåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ²¡æœ‰åˆ™newä¸€ä¸ªå¯¹è±¡æ¥ä¸€ä¸ªä¸€ä¸ªSetï¼Œç„¶åå°†å·²ç‚¹èµçš„ä¿¡æ¯å­˜å…¥redisä¸­ï¼Œç›¸åï¼Œå–æ¶ˆç‚¹èµçš„æ“ä½œå°±æ˜¯åˆ é™¤redisä¸­çš„æ•°æ®å³å¯ï¼Œç„¶åé€šè¿‡Dubboè°ƒç”¨APIæ¥å®Œæˆä¿å­˜æ“ä½œï¼Œå› ä¸ºæˆ‘è¿™é‡Œæ˜¯è¿˜è¦è·å–ç‚¹èµæ•°å’Œè¯„è®ºæ•°å•¥çš„ï¼Œæ‰€ä»¥ä¼šå¯¹åŠ¨æ€è¡¨è¿›è¡Œæ›´æ–°æ“ä½œã€‚</p><h3 id="æ¯”å¦‚ä¸‹å•æ¸…ç©ºè´­ç‰©è½¦-ä½ æ˜¯å¦‚ä½•è®¾è®¡çš„" tabindex="-1"><a class="header-anchor" href="#æ¯”å¦‚ä¸‹å•æ¸…ç©ºè´­ç‰©è½¦-ä½ æ˜¯å¦‚ä½•è®¾è®¡çš„" aria-hidden="true">#</a> æ¯”å¦‚ä¸‹å•æ¸…ç©ºè´­ç‰©è½¦ï¼Œä½ æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</h3><ol><li>ç”Ÿäº§è€…ï¼ˆè®¢å•ç³»ç»Ÿï¼‰äº§ç”Ÿæ¶ˆæ¯ï¼Œå‘é€ä¸€æ¡åŠäº‹åŠ¡æ¶ˆæ¯åˆ°MQæœåŠ¡å™¨</li><li>MQæ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°å­˜å‚¨ç³»ç»Ÿï¼Œè¿™æ¡æ¶ˆæ¯çš„çŠ¶æ€æ˜¯å¾…å‘é€çŠ¶æ€ã€‚</li><li>MQæœåŠ¡å™¨è¿”å›ACKç¡®è®¤åˆ°ç”Ÿäº§è€…ï¼Œæ­¤æ—¶MQä¸ä¼šè§¦å‘æ¶ˆæ¯æ¨é€äº‹ä»¶</li><li>ç”Ÿäº§è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆè®¢å•åˆ›å»ºæˆåŠŸï¼Œæäº¤äº‹åŠ¡æ¶ˆæ¯ï¼‰</li><li>å¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå³commitæ‰§è¡Œç»“æœåˆ°MQæœåŠ¡å™¨ï¼›å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå‘é€rollbackã€‚</li><li>å¦‚æœæ˜¯commitæ­£å¸¸æäº¤ï¼ŒMQæœåŠ¡å™¨æ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸º<strong>å¯å‘é€</strong>ï¼›å¦‚æœæ˜¯rollbackï¼Œå³<strong>åˆ é™¤æ¶ˆæ¯</strong>ã€‚</li><li>å¦‚æœæ¶ˆæ¯çŠ¶æ€æ›´æ–°ä¸ºå¯å‘é€ï¼Œåˆ™MQæœåŠ¡å™¨ä¼špushæ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼ˆè´­ç‰©è½¦ç³»ç»Ÿï¼‰ã€‚æ¶ˆè´¹è€…æ¶ˆè´¹å®Œï¼ˆå³æ‹¿åˆ°è®¢å•æ¶ˆæ¯ï¼Œæ¸…ç©ºè´­ç‰©è½¦æˆåŠŸï¼‰å°±åº”ç­”ACKã€‚</li><li>å¦‚æœMQæœåŠ¡å™¨é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°ç”Ÿäº§è€…çš„commitæˆ–è€…rollbackï¼Œå®ƒä¼šåæŸ¥ç”Ÿäº§è€…ï¼Œç„¶åæ ¹æ®æŸ¥è¯¢åˆ°çš„ç»“æœï¼ˆå›æ»šæ“ä½œæˆ–è€…é‡æ–°å‘é€æ¶ˆæ¯ï¼‰æ‰§è¡Œæœ€ç»ˆçŠ¶æ€ã€‚</li></ol><p>æœ‰äº›ä¼™ä¼´å¯èƒ½æœ‰ç–‘æƒ‘ï¼Œå¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹å¤±è´¥æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£æ•°æ®æ˜¯ä¸æ˜¯ä¸ä¸€è‡´å•¦ï¼Ÿæ‰€ä»¥å°±éœ€è¦æ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘æˆåŠŸï¼Œå†åé¦ˆackå˜›ã€‚å¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹å¤±è´¥ï¼Œé‚£å°±è‡ªåŠ¨é‡è¯•å˜›ï¼Œæ¥å£æ”¯æŒå¹‚ç­‰å³å¯ã€‚</p><h3 id="æ’è¡Œæ¦œçš„å®ç°-æ¯”å¦‚é«˜è€ƒæˆç»©æ’åº-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#æ’è¡Œæ¦œçš„å®ç°-æ¯”å¦‚é«˜è€ƒæˆç»©æ’åº-2022-è™¾çš®" aria-hidden="true">#</a> æ’è¡Œæ¦œçš„å®ç°ï¼Œæ¯”å¦‚é«˜è€ƒæˆç»©æ’åºï¼ˆ2022 è™¾çš®ï¼‰</h3><p>æ’è¡Œç‰ˆçš„å®ç°ï¼Œä¸€èˆ¬ä½¿ç”¨redisçš„<strong>zset</strong>æ•°æ®ç±»å‹ã€‚</p><ul><li>ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>zadd key score member [score member ...]ï¼Œzrank key member
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>å±‚å†…éƒ¨ç¼–ç ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ã€skiplistï¼ˆè·³è·ƒè¡¨ï¼‰</li><li>ä½¿ç”¨åœºæ™¯å¦‚æ’è¡Œæ¦œï¼Œç¤¾äº¤éœ€æ±‚ï¼ˆå¦‚ç”¨æˆ·ç‚¹èµï¼‰</li></ul><p>å®ç°demoå¦‚ä¸‹ï¼š</p><figure><img src="`+Ne+'" alt="image-20220618221719773" tabindex="0" loading="lazy"><figcaption>image-20220618221719773</figcaption></figure><h3 id="æœ‰ä¸€æ‰¹å¸–å­-ä¼šæ ¹æ®ç±»åˆ«æœç´¢-ä½†æ˜¯ç°åœ¨æ˜¯å•ç‹¬ä¸€ä¸ªè¡¨-ç°åœ¨æŸ¥è¯¢éå¸¸æ…¢-å¦‚ä½•æé«˜æœç´¢æ€§èƒ½-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#æœ‰ä¸€æ‰¹å¸–å­-ä¼šæ ¹æ®ç±»åˆ«æœç´¢-ä½†æ˜¯ç°åœ¨æ˜¯å•ç‹¬ä¸€ä¸ªè¡¨-ç°åœ¨æŸ¥è¯¢éå¸¸æ…¢-å¦‚ä½•æé«˜æœç´¢æ€§èƒ½-2022-è™¾çš®" aria-hidden="true">#</a> æœ‰ä¸€æ‰¹å¸–å­ï¼Œä¼šæ ¹æ®ç±»åˆ«æœç´¢ï¼Œä½†æ˜¯ç°åœ¨æ˜¯å•ç‹¬ä¸€ä¸ªè¡¨ï¼Œç°åœ¨æŸ¥è¯¢éå¸¸æ…¢ï¼Œå¦‚ä½•æé«˜æœç´¢æ€§èƒ½ï¼Ÿï¼ˆ2022 è™¾çš®ï¼‰</h3><p>æ ¹æ®ç±»åˆ«åˆ†åº“åˆ†è¡¨ï¼Œåº“å¯ä»¥æ”¾åˆ°ä¸åŒçš„å®ä¾‹ä¸Šï¼Œç»å¸¸æŸ¥è¯¢çš„ä¸å˜çš„æ•°æ®]å¯ä»¥æ”¾åˆ°ç¼“å­˜é‡Œã€‚ æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œéœ€è¦åˆ·æ–°ä¸‹ç¼“å­˜ å› ä¸ºåˆ†è¡¨åï¼Œåªèƒ½æ˜¯å›ºå®šç±»åˆ«ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®ç±»åˆ«å»åˆ†å¼€æŸ¥æ‰¾ã€‚ å¦‚æœè¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„å­—æ®µä¹Ÿéœ€è¦æŸ¥ï¼Œå¯ä»¥å†å»ºä¸€ä¸ªåˆ†è¡¨ï¼Œuser-ses/ses-userå°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä½†æ˜¯å†—ä½™å°±æ¯”è¾ƒå¤§</p><h3 id="å¦‚æœæœ‰å¤šä¸ªè¡¨-è¿›è¡ŒèšåˆæŸ¥è¯¢-å¦‚ä½•è§£å†³æ·±åˆ†é¡µçš„é—®é¢˜-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#å¦‚æœæœ‰å¤šä¸ªè¡¨-è¿›è¡ŒèšåˆæŸ¥è¯¢-å¦‚ä½•è§£å†³æ·±åˆ†é¡µçš„é—®é¢˜-2022-è™¾çš®" aria-hidden="true">#</a> å¦‚æœæœ‰å¤šä¸ªè¡¨ï¼Œè¿›è¡ŒèšåˆæŸ¥è¯¢ï¼Œå¦‚ä½•è§£å†³æ·±åˆ†é¡µçš„é—®é¢˜ï¼ˆ2022 è™¾çš®ï¼‰</h3><p>å°±æ˜¯ä¿å­˜æ¯ä¸ªèŠ‚ç‚¹çš„è¡¨idç»™å‰ç«¯ï¼Œå‰ç«¯æŸ¥è¯¢æ—¶æŠŠidè¿”å›è¿‡æ¥äº†ï¼Œç„¶ååŠ åˆ°SQLé‡Œï¼Œä½†æ˜¯ä¸ä¸€å®šå‡†ã€‚è¿™é‡Œå›ç­”çš„æ˜¯å•ä¸ªè¡¨å§</p><h3 id="åˆ†è¡¨çš„æ•°æ®-åŠ¨æ€å¢åŠ ä¸€å¼ è¡¨-ä¸åœæœå¦‚ä½•å®ç°-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#åˆ†è¡¨çš„æ•°æ®-åŠ¨æ€å¢åŠ ä¸€å¼ è¡¨-ä¸åœæœå¦‚ä½•å®ç°-2022-è™¾çš®" aria-hidden="true">#</a> åˆ†è¡¨çš„æ•°æ®ï¼ŒåŠ¨æ€å¢åŠ ä¸€å¼ è¡¨ï¼Œä¸åœæœå¦‚ä½•å®ç°ï¼Ÿï¼ˆ2022 è™¾çš®ï¼‰</h3><p>åˆ†åŒºç­–ç•¥ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œ ç„¶åæ–°è¡¨çš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆæŸ¥è€çš„ï¼Œå†æ’å…¥æ–°çš„ã€‚å¦‚æœè€æ•°æ®æ²¡æœ‰åŠ¨ï¼Œéœ€è¦æœ‰å¯¹åº”çš„è¿ç§»æœåŠ¡è¿›è¡Œå®šæ—¶è¿ç§»ã€‚æ’å…¥çš„æ—¶å€™ä¼˜å…ˆæ’å…¥åˆ°æ–°çš„è¡¨ã€‚</p><h3 id="è¿ç§»çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œ-ä¼šæœ‰æ•°æ®åº“ä¸ä¸€è‡´çš„é—®é¢˜-æ€ä¹ˆè§£å†³-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#è¿ç§»çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œ-ä¼šæœ‰æ•°æ®åº“ä¸ä¸€è‡´çš„é—®é¢˜-æ€ä¹ˆè§£å†³-2022-è™¾çš®" aria-hidden="true">#</a> è¿ç§»çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä¼šæœ‰æ•°æ®åº“ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿï¼ˆ2022 è™¾çš®ï¼‰</h3><p>åŠ åˆ†å¸ƒå¼é”</p><h3 id="ä¸¤ä¸ªæœºæˆ¿-æŸä¸ªæœºæˆ¿å¯èƒ½æ–­ç”µ-å¦‚ä½•åšå¤šæœºæˆ¿å®¹ç¾-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#ä¸¤ä¸ªæœºæˆ¿-æŸä¸ªæœºæˆ¿å¯èƒ½æ–­ç”µ-å¦‚ä½•åšå¤šæœºæˆ¿å®¹ç¾-2022-è™¾çš®" aria-hidden="true">#</a> ä¸¤ä¸ªæœºæˆ¿ï¼ŒæŸä¸ªæœºæˆ¿å¯èƒ½æ–­ç”µï¼Œå¦‚ä½•åšå¤šæœºæˆ¿å®¹ç¾ï¼ˆ2022 è™¾çš®ï¼‰</h3>',27),So={href:"https://cloud.tencent.com/developer/article/1358933",target:"_blank",rel:"noopener noreferrer"},xo=n("h3",{id:"ä¸»ä»æœºæˆ¿åŒæ­¥æœ‰ä»€ä¹ˆé—®é¢˜å‘¢-2022-è™¾çš®",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¸»ä»æœºæˆ¿åŒæ­¥æœ‰ä»€ä¹ˆé—®é¢˜å‘¢-2022-è™¾çš®","aria-hidden":"true"},"#"),s(" ä¸»ä»æœºæˆ¿åŒæ­¥æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ ï¼ˆ2022 è™¾çš®ï¼‰")],-1),_o=n("blockquote",null,[n("p",null,"ä¼šæœ‰æ¯”è¾ƒå¤§çš„å»¶è¿Ÿã€‚ ä¸€äº›åˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œä¾‹å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¯èƒ½å°±æ‰§è¡Œäº†å‡ æ­¥ï¼Œç„¶åå°±æŒ‚äº†ï¼Œéœ€è¦æœ‰ä¸€å®šçš„ç­–ç•¥ï¼Œè¿›è¡Œå›æ»šæˆ–è€…æäº¤ã€‚ åˆ‡æ¢æœºæˆ¿çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±ï¼Œé‡å¤æ•°æ®ç­‰")],-1),To=n("ul",null,[n("li",null,"åŒå‘åŒæ­¥ï¼Œä¸¤ä¸ªæœºæˆ¿éƒ½èƒ½å†™å…¥ï¼Œå¦‚æœæ“ä½œçš„æ˜¯å„è‡ªçš„æ•°æ®çš„è¯ï¼Œé—®é¢˜ä¸å¤§ã€‚å¦‚æœæ“ä½œçš„æ˜¯ç›¸åŒæ•°æ®ï¼Œå¿…ç„¶ä¼šæœ‰å†²çªï¼Œéœ€è¦è§£å†³ã€‚æ‰€ä»¥ä¸Šå±‚ä¿è¯ç›¸åŒæ•°æ®åˆ°åŒä¸€ä¸ªæœºæˆ¿å³å¯ï¼Œç„¶ååŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªæœºæˆ¿ï¼Œä¿è¯æ¯ä¸ªæœºæˆ¿éƒ½æœ‰å…¨é‡çš„æ•°æ®ã€‚å„ç§ä¸­é—´ä»¶éƒ½è¦åšæ”¹é€ ã€‚"),n("li",null,"æ€»ä¹‹ï¼Œåˆ†ç‰‡çš„æ ¸å¿ƒæ€è·¯åœ¨äºï¼Œè®©åŒä¸€ä¸ªç”¨æˆ·çš„ç›¸å…³è¯·æ±‚ï¼Œåªåœ¨ä¸€ä¸ªæœºæˆ¿å†…å®Œæˆæ‰€æœ‰ä¸šåŠ¡ã€Œé—­ç¯ã€ï¼Œä¸å†å‡ºç°ã€Œè·¨æœºæˆ¿ã€è®¿é—®ã€‚"),n("li",null,"é˜¿é‡Œåœ¨å®æ–½è¿™ç§æ–¹æ¡ˆæ—¶ï¼Œç»™å®ƒèµ·äº†ä¸ªåå­—ï¼Œå«åšã€Œå•å…ƒåŒ–ã€ã€‚"),n("li",null,"è¿™é‡Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œæ˜¯æ— æ³•åšæ•°æ®åˆ†ç‰‡çš„ï¼šå…¨å±€æ•°æ®ã€‚ä¾‹å¦‚ç³»ç»Ÿé…ç½®ã€å•†å“åº“å­˜è¿™ç±»éœ€è¦å¼ºä¸€è‡´çš„æ•°æ®ï¼Œè¿™ç±»æœåŠ¡ä¾æ—§åªèƒ½é‡‡ç”¨å†™ä¸»æœºæˆ¿ï¼Œè¯»ä»æœºæˆ¿çš„æ–¹æ¡ˆï¼Œä¸åšåŒæ´»ã€‚"),n("li",null,"åŒæ´»çš„é‡ç‚¹ï¼Œæ˜¯è¦ä¼˜å…ˆä¿è¯ã€Œæ ¸å¿ƒã€ä¸šåŠ¡å…ˆå®ç°åŒæ´»ï¼Œå¹¶ä¸æ˜¯ã€Œå…¨éƒ¨ã€ä¸šåŠ¡å®ç°åŒæ´»ã€‚")],-1),Po={href:"https://mp.weixin.qq.com/s/hWCmnsa3rdtMFTE_BSyg2w",target:"_blank",rel:"noopener noreferrer"},Lo=t(`<h3 id="å†·æœºæˆ¿æ–°è¯·æ±‚è¿‡æ¥-å‘ç°ç¼“å­˜æ²¡æœ‰-ä¼šæŠŠæ•°æ®åº“æ‰“æŒ‚-è¿™ä¸ªæ€ä¹ˆè§£å†³-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#å†·æœºæˆ¿æ–°è¯·æ±‚è¿‡æ¥-å‘ç°ç¼“å­˜æ²¡æœ‰-ä¼šæŠŠæ•°æ®åº“æ‰“æŒ‚-è¿™ä¸ªæ€ä¹ˆè§£å†³-2022-è™¾çš®" aria-hidden="true">#</a> å†·æœºæˆ¿æ–°è¯·æ±‚è¿‡æ¥ï¼Œå‘ç°ç¼“å­˜æ²¡æœ‰ï¼Œä¼šæŠŠæ•°æ®åº“æ‰“æŒ‚ï¼Œè¿™ä¸ªæ€ä¹ˆè§£å†³ï¼Ÿï¼ˆ2022 è™¾çš®ï¼‰</h3><p>é¢„çƒ­ï¼Œæå‰åŠ è½½åˆ°ç¼“å­˜ã€‚ æˆ–è€…å¹³æ—¶ä¿æŒä¸€å®šçš„æµé‡ã€‚ ç”¨äº†ç¼“å­˜çš„ï¼Œä¸€èˆ¬éœ€è¦é¢„çƒ­ä¸‹ï¼Œé˜²æ­¢é›ªå´©ã€‚</p><h3 id="å®šæ—¶ä»»åŠ¡è¿™ç§-æ€ä¹ˆæ”¹å˜æ‰§è¡Œçš„æœºæˆ¿-2022-è™¾çš®" tabindex="-1"><a class="header-anchor" href="#å®šæ—¶ä»»åŠ¡è¿™ç§-æ€ä¹ˆæ”¹å˜æ‰§è¡Œçš„æœºæˆ¿-2022-è™¾çš®" aria-hidden="true">#</a> å®šæ—¶ä»»åŠ¡è¿™ç§ï¼Œæ€ä¹ˆæ”¹å˜æ‰§è¡Œçš„æœºæˆ¿ï¼ˆ2022 è™¾çš®ï¼‰</h3><p>åŠ å¼€å…³ï¼Œä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåœ¨ç©ºè·‘ã€‚</p><h2 id="ğŸ§linux" tabindex="-1"><a class="header-anchor" href="#ğŸ§linux" aria-hidden="true">#</a> ğŸ§Linux</h2><h3 id="è‡ªç”±å‘æŒ¥é¢˜ç›®" tabindex="-1"><a class="header-anchor" href="#è‡ªç”±å‘æŒ¥é¢˜ç›®" aria-hidden="true">#</a> è‡ªç”±å‘æŒ¥é¢˜ç›®</h3><ul><li>æ€ä¹ˆå­¦ä¹ çš„linux (2022è”šæ¥)</li><li>LinuxçŸ¥é“å“ªäº›å‘½ä»¤?ï¼ˆ2022ç¾å›¢ï¼‰</li></ul><h3 id="æŸ¥çœ‹ç³»ç»Ÿé‡Œcpuå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ-ç”¨å“ªäº›å‘½ä»¤æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹ç³»ç»Ÿé‡Œcpuå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ-ç”¨å“ªäº›å‘½ä»¤æ‰§è¡Œ" aria-hidden="true">#</a> æŸ¥çœ‹ç³»ç»Ÿé‡ŒCPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç”¨å“ªäº›å‘½ä»¤æ‰§è¡Œï¼Ÿ</h3><h4 id="top" tabindex="-1"><a class="header-anchor" href="#top" aria-hidden="true">#</a> top</h4><p><strong>topå‘½ä»¤</strong> å¯ä»¥å®æ—¶åŠ¨æ€åœ°æŸ¥çœ‹ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œæƒ…å†µï¼Œæ˜¯ä¸€ä¸ªç»¼åˆäº†å¤šæ–¹ä¿¡æ¯ç›‘æµ‹ç³»ç»Ÿæ€§èƒ½å’Œè¿è¡Œä¿¡æ¯çš„å®ç”¨å·¥å…·ã€‚é€šè¿‡topå‘½ä»¤æ‰€æä¾›çš„äº’åŠ¨å¼ç•Œé¢ï¼Œç”¨çƒ­é”®å¯ä»¥ç®¡ç†ã€‚</p><p><strong>å®ä¾‹</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">top</span> - 09:44:56 up <span class="token number">16</span> days, <span class="token number">21</span>:23,  <span class="token number">1</span> user,  load average: <span class="token number">9.59</span>, <span class="token number">4.75</span>, <span class="token number">1.92</span>
Tasks: <span class="token number">145</span> total,   <span class="token number">2</span> running, <span class="token number">143</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie
Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: <span class="token number">99.8</span>%us,  <span class="token number">0.1</span>%sy,  <span class="token number">0.0</span>%ni,  <span class="token number">0.2</span>%id,  <span class="token number">0.0</span>%wa,  <span class="token number">0.0</span>%hi,  <span class="token number">0.0</span>%si,  <span class="token number">0.0</span>%st
Mem:   4147888k total,  2493092k used,  1654796k free,   158188k buffers
Swap:  5144568k total,       56k used,  5144512k free,  2013180k cached
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>top - 09:44:56[å½“å‰ç³»ç»Ÿæ—¶é—´],</li><li>16 days[ç³»ç»Ÿå·²ç»è¿è¡Œäº†16å¤©],</li><li>1 user[ä¸ªç”¨æˆ·å½“å‰ç™»å½•],</li><li>load average: 9.59, 4.75, 1.92[ç³»ç»Ÿè´Ÿè½½ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦]</li><li>Tasks: 145 total[æ€»è¿›ç¨‹æ•°],</li><li>2 running[æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°],</li><li>143 sleeping[ç¡çœ çš„è¿›ç¨‹æ•°],</li><li>0 stopped[åœæ­¢çš„è¿›ç¨‹æ•°],</li><li>0 zombie[å†»ç»“è¿›ç¨‹æ•°],</li><li>Cpu(s): 99.8%us[ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”],</li><li>0.1%sy[å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”],</li><li>0.0%ni[ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”],</li><li>0.2%id[ç©ºé—²CPUç™¾åˆ†æ¯”], 0.0%wa[ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”],</li><li>0.0%hi[],</li><li>0.0%st[],</li><li>Mem: 4147888k total[ç‰©ç†å†…å­˜æ€»é‡],</li><li>2493092k used[ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡],</li><li>1654796k free[ç©ºé—²å†…å­˜æ€»é‡],</li><li>158188k buffers[ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡]</li><li>Swap: 5144568k total[äº¤æ¢åŒºæ€»é‡],</li><li>56k used[ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡],</li><li>5144512k free[ç©ºé—²äº¤æ¢åŒºæ€»é‡],</li><li>2013180k cached[ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡]</li></ul><h4 id="ps" tabindex="-1"><a class="header-anchor" href="#ps" aria-hidden="true">#</a> ps</h4><p><strong>pså‘½ä»¤</strong> ç”¨äºæŠ¥å‘Šå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€ã€‚å¯ä»¥æ­é…killæŒ‡ä»¤éšæ—¶ä¸­æ–­ã€åˆ é™¤ä¸å¿…è¦çš„ç¨‹åºã€‚pså‘½ä»¤æ˜¯æœ€åŸºæœ¬åŒæ—¶ä¹Ÿæ˜¯éå¸¸å¼ºå¤§çš„è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ç¡®å®šæœ‰å“ªäº›è¿›ç¨‹æ­£åœ¨è¿è¡Œå’Œè¿è¡Œçš„çŠ¶æ€ã€è¿›ç¨‹æ˜¯å¦ç»“æŸã€è¿›ç¨‹æœ‰æ²¡æœ‰åƒµæ­»ã€å“ªäº›è¿›ç¨‹å ç”¨äº†è¿‡å¤šçš„èµ„æºç­‰ç­‰ï¼Œæ€»ä¹‹å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯å¯ä»¥é€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤å¾—åˆ°çš„ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> axo pid,comm,pcpu <span class="token comment"># æŸ¥çœ‹è¿›ç¨‹çš„PIDã€åç§°ä»¥åŠCPU å ç”¨ç‡</span>
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rnk</span> <span class="token number">4</span> <span class="token comment"># æŒ‰å†…å­˜èµ„æºçš„ä½¿ç”¨é‡å¯¹è¿›ç¨‹è¿›è¡Œæ’åº</span>
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nk</span> <span class="token number">3</span>  <span class="token comment"># æŒ‰ CPU èµ„æºçš„ä½¿ç”¨é‡å¯¹è¿›ç¨‹è¿›è¡Œæ’åº</span>
<span class="token function">ps</span> <span class="token parameter variable">-A</span> <span class="token comment"># æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯</span>
<span class="token function">ps</span> <span class="token parameter variable">-u</span> root <span class="token comment"># æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯</span>
<span class="token function">ps</span> <span class="token parameter variable">-efL</span> <span class="token comment"># æŸ¥çœ‹çº¿ç¨‹æ•°</span>
<span class="token function">ps</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-o</span> <span class="token string">&quot;%C : %p :%z : %a&quot;</span><span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-k5</span> <span class="token parameter variable">-nr</span> <span class="token comment"># æŸ¥çœ‹è¿›ç¨‹å¹¶æŒ‰å†…å­˜ä½¿ç”¨å¤§å°æ’åˆ—</span>
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token comment"># æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ</span>
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">ssh</span> <span class="token comment"># ps ä¸grep å¸¸ç”¨ç»„åˆç”¨æ³•ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹</span>
<span class="token function">ps</span> <span class="token parameter variable">-C</span> nginx <span class="token comment"># é€šè¿‡åå­—æˆ–å‘½ä»¤æœç´¢è¿›ç¨‹</span>
<span class="token function">ps</span> aux <span class="token parameter variable">--sort</span><span class="token operator">=</span>-pcpu,+pmem <span class="token comment"># CPUæˆ–è€…å†…å­˜è¿›è¡Œæ’åº,-é™åºï¼Œ+å‡åº</span>
<span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">--forest</span> <span class="token parameter variable">-C</span> nginx <span class="token comment"># ç”¨æ ‘çš„é£æ ¼æ˜¾ç¤ºè¿›ç¨‹çš„å±‚æ¬¡å…³ç³»</span>
<span class="token function">ps</span> <span class="token parameter variable">-o</span> pid,uname,comm <span class="token parameter variable">-C</span> nginx <span class="token comment"># æ˜¾ç¤ºä¸€ä¸ªçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹</span>
<span class="token function">ps</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-o</span> pid,uname<span class="token operator">=</span>USERNAME,pcpu<span class="token operator">=</span>CPU_USAGE,pmem,comm <span class="token comment"># é‡å®šä¹‰æ ‡ç­¾</span>
<span class="token function">ps</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-o</span> pid,comm,etime <span class="token comment"># æ˜¾ç¤ºè¿›ç¨‹è¿è¡Œçš„æ—¶é—´</span>
<span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> named <span class="token comment"># æŸ¥çœ‹namedè¿›ç¨‹è¯¦ç»†ä¿¡æ¯</span>
<span class="token function">ps</span> <span class="token parameter variable">-o</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-p</span> <span class="token number">91730</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-n</span> 2p <span class="token comment"># é€šè¿‡è¿›ç¨‹idè·å–æœåŠ¡åç§°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="pmap" tabindex="-1"><a class="header-anchor" href="#pmap" aria-hidden="true">#</a> pmap</h4><p>æŠ¥å‘Šè¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ã€‚<strong>pmapå‘½ä»¤</strong> ç”¨äºæŠ¥å‘Šè¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œæ˜¯Linuxè°ƒè¯•åŠè¿ç»´ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ã€‚</p><h4 id="free" tabindex="-1"><a class="header-anchor" href="#free" aria-hidden="true">#</a> free</h4><p>æ˜¾ç¤ºå†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚<strong>freeå‘½ä»¤</strong> å¯ä»¥æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæœªä½¿ç”¨çš„å’Œå·²ä½¿ç”¨çš„å†…å­˜æ•°ç›®ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºè¢«å†…æ ¸ä½¿ç”¨çš„å†…å­˜ç¼“å†²åŒºã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">free</span> <span class="token parameter variable">-t</span>    <span class="token comment"># ä»¥æ€»å’Œçš„å½¢å¼æ˜¾ç¤ºå†…å­˜çš„ä½¿ç”¨ä¿¡æ¯</span>
<span class="token function">free</span> <span class="token parameter variable">-s</span> <span class="token number">10</span> <span class="token comment"># å‘¨æœŸæ€§çš„æŸ¥è¯¢å†…å­˜ä½¿ç”¨ä¿¡æ¯ï¼Œæ¯10s æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¦‚æœæƒ³ç»Ÿè®¡ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚æ–‡ä»¶-ç»Ÿè®¡æ¯ä¸ªæ¥å£çš„qpsçš„è¯-ç”¨ä»€ä¹ˆå‘½ä»¤èƒ½å®ç°" tabindex="-1"><a class="header-anchor" href="#å¦‚æœæƒ³ç»Ÿè®¡ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚æ–‡ä»¶-ç»Ÿè®¡æ¯ä¸ªæ¥å£çš„qpsçš„è¯-ç”¨ä»€ä¹ˆå‘½ä»¤èƒ½å®ç°" aria-hidden="true">#</a> å¦‚æœæƒ³ç»Ÿè®¡ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚æ–‡ä»¶ï¼Œç»Ÿè®¡æ¯ä¸ªæ¥å£çš„QPSçš„è¯ï¼Œç”¨ä»€ä¹ˆå‘½ä»¤èƒ½å®ç°ï¼Ÿ</h3><p>ä¸¾ä¸ªğŸŒ°å‘½ä»¤æ˜¯ <code>tail -f info.log | grep RecommendServiceImpl | cut -f1 -d&#39;.&#39; | uniq -c</code> æ¯ä¸ªæ‰“çš„æ—¥å¿—æ ¼å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦ç†è§£ä¸€ä¸‹é‡Œé¢çš„æ„æ€</p><ul><li><code>grep RecommendServiceImpl</code>æ˜¯è¿‡æ»¤å‡ºè¦æµ‹çš„æ¥å£</li><li><code>cut</code>æ˜¯æˆªå–ä¸€ä¸‹æ—¶é—´ï¼Œå…¶ä¸­ <code>-dâ€˜.â€™</code>è¡¨ç¤ºå­—ç¬¦ä¸²é£æ ¼è¡¨ç¤ºç¬¦å·ï¼Œå•å¼•å·é‡Œé¢çš„å°±æ˜¯åˆ†å‰²ç¬¦ï¼Œä¾‹å¦‚å› ä¸ºæˆ‘æ—¥å¿—æ˜¯æœ‰æ‰“æ¯«ç§’å€¼çš„ï¼Œæ‰€ä»¥æˆ‘æ ¹æ® <code>.</code>æ¥åˆ†æ®µï¼Œ<code>-f1</code>è¡¨ç¤ºæˆ‘è¦å–åˆ†æ®µä»¥åçš„ç¬¬ä¸€æ®µ(ä»1å¼€å§‹æ•°)ï¼ŒåŒç† <code>-f2</code>å°±æ˜¯ç¬¬äºŒæ®µä¹Ÿå°±æ˜¯ <code>.</code>åé¢è¿™éƒ¨åˆ†ï¼Œ</li><li><code>uniq</code>æ˜¾ç¤ºæˆ–è€…å¿½ç•¥é‡å¤çš„è¡Œï¼Œä½†æ˜¯åŠ ä¸Š-cå°±å¯ä»¥ç´¯è®¡ç›¸åŒè¡Œæ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹ç´¯åŠ èµ·æ¥</li></ul><figure><img src="`+Me+'" alt="image-20220718141022014" tabindex="0" loading="lazy"><figcaption>image-20220718141022014</figcaption></figure><h3 id="linux-ä¸­ä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·-å†…æ ¸ç©ºé—´-ç”¨æˆ·ç©ºé—´-6-ç§ä¸åŒçš„å†…å­˜æ®µ" tabindex="-1"><a class="header-anchor" href="#linux-ä¸­ä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·-å†…æ ¸ç©ºé—´-ç”¨æˆ·ç©ºé—´-6-ç§ä¸åŒçš„å†…å­˜æ®µ" aria-hidden="true">#</a> Linux ä¸­ä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ†å¸ƒé•¿ä»€ä¹ˆæ ·ï¼Ÿå†…æ ¸ç©ºé—´+ç”¨æˆ·ç©ºé—´ï¼ˆ6 ç§ä¸åŒçš„å†…å­˜æ®µï¼‰</h3><p>.initï¼šç¨‹åºåˆå§‹åŒ–çš„å¼•å¯¼ .textï¼šå·²ç¼–è¯‘çš„æœºå™¨ä»£ç  .rodataï¼šåªè¯»æ•°æ®ï¼Œå­˜æ”¾å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå…¨å±€å¸¸é‡ä»¥åŠ switch è·³è½¬è¡¨ä¹‹ç±» .dataï¼šå­˜æ”¾å·²ç»åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡ .bssï¼šå­˜æ”¾æœªåˆå§‹åŒ–æˆ–åˆå§‹åŒ–ä¸º 0 çš„å…¨å±€å’Œé™æ€å˜é‡ï¼Œä»…ä»…æ˜¯å ä½ç¬¦ï¼Œä¸å ç©ºé—´ï¼Œåç§°å¯ä»¥ç†è§£ä¸º Better Save Spaceï¼ˆå®é™…èµ·æºå¹¶ä¸æ˜¯è¿™ä¸ªï¼‰</p><figure><img src="'+Ee+'" alt="image-20220727223840133" tabindex="0" loading="lazy"><figcaption>image-20220727223840133</figcaption></figure><h3 id="linux-å‘½ä»¤-å¦‚ä½•æŸ¥çœ‹ä¸»æœº-cpu-æ ¸æ•°-å¦‚ä½•æŸ¥çœ‹å†…å­˜è¿˜å‰©å¤šå°‘" tabindex="-1"><a class="header-anchor" href="#linux-å‘½ä»¤-å¦‚ä½•æŸ¥çœ‹ä¸»æœº-cpu-æ ¸æ•°-å¦‚ä½•æŸ¥çœ‹å†…å­˜è¿˜å‰©å¤šå°‘" aria-hidden="true">#</a> linux å‘½ä»¤ï¼Œå¦‚ä½•æŸ¥çœ‹ä¸»æœº CPU æ ¸æ•°ï¼Ÿå¦‚ä½•æŸ¥çœ‹å†…å­˜è¿˜å‰©å¤šå°‘ï¼Ÿ</h3><p>cat /proc/cpuinfo</p><p>cat /proc/meminfo</p><h3 id="å¦‚ä½•æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹æ­£åœ¨ç›‘å¬-80-ç«¯å£" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹æ­£åœ¨ç›‘å¬-80-ç«¯å£" aria-hidden="true">#</a> å¦‚ä½•æŸ¥çœ‹å“ªä¸ªè¿›ç¨‹æ­£åœ¨ç›‘å¬ 80 ç«¯å£ï¼Ÿ</h3><p>lsof -i:80</p><p>netstat -tunlp | grep 80</p><h3 id="netstat-n-æ˜¯ä»€ä¹ˆæ„æ€-a-æ˜¯ä»€ä¹ˆæ„æ€-p-æ˜¯ä»€ä¹ˆæ„æ€" tabindex="-1"><a class="header-anchor" href="#netstat-n-æ˜¯ä»€ä¹ˆæ„æ€-a-æ˜¯ä»€ä¹ˆæ„æ€-p-æ˜¯ä»€ä¹ˆæ„æ€" aria-hidden="true">#</a> netstat -n æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ-a æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ-p æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><ul><li>a (all)æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºLISTENç›¸å…³</li><li>p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå</li><li>n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–æˆæ•°å­—ã€‚</li></ul><h3 id="linuxä¸­å†™æ–‡ä»¶writeçš„æµç¨‹-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#linuxä¸­å†™æ–‡ä»¶writeçš„æµç¨‹-2022è”šæ¥" aria-hidden="true">#</a> linuxä¸­å†™æ–‡ä»¶writeçš„æµç¨‹ï¼ˆ2022è”šæ¥ï¼‰</h3><ol><li>åº”ç”¨ç¨‹åºå‘èµ·å†™è¯·æ±‚ï¼Œè§¦å‘ç³»ç»Ÿè°ƒç”¨write()å‡½æ•°ï¼Œç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼›</li><li>æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ç›®å½•é¡¹â†’inodeâ†’address_spaceâ†’é¡µç¼“å­˜æ ‘ï¼ŒæŸ¥è¯¢Page Cacheæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™éœ€è¦åˆ›å»ºï¼›</li><li>Page Cacheå­˜åœ¨åï¼ŒCPUå°†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºæ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒPage Cacheå˜ä¸ºè„é¡µï¼ˆDirty Pageï¼‰ï¼Œå†™æµç¨‹è¿”å›ï¼›</li><li>ç”¨æˆ·ä¸»åŠ¨è§¦å‘åˆ·ç›˜æˆ–è€…è¾¾åˆ°ç‰¹å®šæ¡ä»¶å†…æ ¸è§¦å‘åˆ·ç›˜ï¼Œå”¤é†’pdflushçº¿ç¨‹å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®åˆ·å…¥ç£ç›˜ï¼›</li></ol><figure><img src="'+Oe+'" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p>ã€æ‹“å±•ã€‘è¯»æµç¨‹</p><ol><li>åº”ç”¨ç¨‹åºå‘èµ·è¯»è¯·æ±‚ï¼Œè§¦å‘ç³»ç»Ÿè°ƒç”¨read()å‡½æ•°ï¼Œç”¨æˆ·æ€åˆ‡æ¢ä¸ºå†…æ ¸æ€ï¼›</li><li>æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ç›®å½•é¡¹â†’inodeâ†’address_spaceâ†’é¡µç¼“å­˜æ ‘ï¼ŒæŸ¥è¯¢Page Cacheæ˜¯å¦å­˜åœ¨ï¼›</li><li>Page Cacheä¸å­˜åœ¨äº§ç”Ÿç¼ºé¡µä¸­æ–­ï¼ŒCPUå‘DMAå‘å‡ºæ§åˆ¶æŒ‡ä»¤ï¼›</li><li>DMA æ§åˆ¶å™¨å°†æ•°æ®ä»ä¸»å­˜æˆ–ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼ˆkernel spaceï¼‰çš„ç¼“å†²åŒºï¼ˆread bufferï¼‰ï¼›</li><li>DMA ç£ç›˜æ§åˆ¶å™¨å‘ CPU å‘å‡ºæ•°æ®è¯»å®Œçš„ä¿¡å·ï¼Œç”± CPU è´Ÿè´£å°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼›</li><li>ç”¨æˆ·è¿›ç¨‹ç”±å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œè·å¾—æ–‡ä»¶æ•°æ®ï¼›</li></ol><figure><img src="'+Be+'" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><h2 id="ğŸ›¡ï¸å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#ğŸ›¡ï¸å®‰å…¨" aria-hidden="true">#</a> ğŸ›¡ï¸å®‰å…¨</h2><h3 id="è®²è®²-jwt" tabindex="-1"><a class="header-anchor" href="#è®²è®²-jwt" aria-hidden="true">#</a> è®²è®² JWT</h3><p>JWTï¼ˆJson Web Tokenï¼‰, æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäº JSON çš„å¼€æ”¾æ ‡å‡†ã€‚JWT ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥ token ä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚</p><figure><img src="'+De+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ä¸€èˆ¬ç”¨å®ƒæ¥æ›¿æ¢æ‰ Session å®ç°æ•°æ®å…±äº«ã€‚</p><p>ä½¿ç”¨åŸºäº Token çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ç”¨æˆ·çš„ç™»å½•è®°å½•ã€‚å¤§æ¦‚çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>1ã€å®¢æˆ·ç«¯é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•æœåŠ¡å™¨ï¼›</li><li>2ã€æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯èº«ä»½è¿›è¡ŒéªŒè¯ï¼›</li><li>3ã€æœåŠ¡ç«¯å¯¹è¯¥ç”¨æˆ·ç”Ÿæˆ Tokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li><li>4ã€å®¢æˆ·ç«¯å°† Token ä¿å­˜åˆ°æœ¬åœ°æµè§ˆå™¨ï¼Œä¸€èˆ¬ä¿å­˜åˆ° cookie ä¸­ï¼›</li><li>5ã€å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œéœ€è¦æºå¸¦è¯¥ Tokenï¼›</li><li>6ã€æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œé¦–å…ˆéªŒè¯ Tokenï¼Œä¹‹åè¿”å›æ•°æ®ã€‚</li></ul><figure><img src="'+ze+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚ä¸Šå›¾ä¸º Token å®ç°æ–¹å¼ï¼Œæµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œæ ¹æ®ä¼ è¿‡æ¥çš„å”¯ä¸€æ ‡è¯† userIdï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡ä¸€äº›ç®—æ³•ï¼Œå¦‚å¸¸ç”¨çš„ HMAC-SHA256 ç®—æ³•ï¼Œç„¶ååŠ ä¸€ä¸ªå¯†é’¥ï¼Œç”Ÿæˆä¸€ä¸ª tokenï¼Œç„¶åé€šè¿‡ BASE64 ç¼–ç ä¸€ä¸‹ä¹‹åå°†è¿™ä¸ª token å‘é€ç»™å®¢æˆ·ç«¯ï¼›å®¢æˆ·ç«¯å°† token ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ï¼Œå¸¦ç€ tokenï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œç„¶åä¼šç”¨ç›¸åŒçš„ç®—æ³•å’Œå¯†é’¥å»éªŒè¯ tokenï¼Œå¦‚æœé€šè¿‡ï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œä¸é€šè¿‡ï¼Œè¿”å›ä¸é€šè¿‡ä¿¡æ¯ã€‚</p><p>å¯ä»¥å¯¹æ¯”ä¸‹å›¾ session å®ç°æ–¹å¼ï¼Œæµç¨‹å¤§è‡´ä¸€è‡´ã€‚</p><figure><img src="'+qe+'" alt="image-20220405113843485" tabindex="0" loading="lazy"><figcaption>image-20220405113843485</figcaption></figure><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ— çŠ¶æ€ã€å¯æ‰©å±• ï¼šåœ¨å®¢æˆ·ç«¯å­˜å‚¨çš„ Token æ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«æ‰©å±•ã€‚åŸºäºè¿™ç§æ— çŠ¶æ€å’Œä¸å­˜å‚¨ Session ä¿¡æ¯ï¼Œè´Ÿè½½å‡è¡¡å™¨èƒ½å¤Ÿå°†ç”¨æˆ·ä¿¡æ¯ä»ä¸€ä¸ªæœåŠ¡ä¼ åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚</li><li>å®‰å…¨ï¼šè¯·æ±‚ä¸­å‘é€ token è€Œä¸å†æ˜¯å‘é€ cookie èƒ½å¤Ÿé˜²æ­¢ CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )ã€‚</li><li>å¯æä¾›æ¥å£ç»™ç¬¬ä¸‰æ–¹æœåŠ¡ï¼šä½¿ç”¨ token æ—¶ï¼Œå¯ä»¥æä¾›å¯é€‰çš„æƒé™ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚</li><li>å¤šå¹³å°è·¨åŸŸ</li></ul><p>JWT å¯ä»¥ç”¨åœ¨å•ç‚¹ç™»å½•çš„ç³»ç»Ÿä¸­</p><p>ä¼ ç»Ÿçš„ JavaWeb é¡¹ç›®ï¼Œåˆ©ç”¨ HttpSession ä¿å­˜ç”¨æˆ·çš„ç™»é™†å‡­è¯ã€‚å¦‚æœåç«¯ç³»ç»Ÿé‡‡ç”¨äº†è´Ÿè½½å‡è¡¡è®¾è®¡ï¼Œå½“ç”¨æˆ·åœ¨ A èŠ‚ç‚¹æˆåŠŸç™»é™†ï¼Œé‚£ä¹ˆç™»é™†å‡­è¯ä¿å­˜åœ¨ A èŠ‚ç‚¹çš„ HttpSession ä¸­ã€‚å¦‚æœç”¨æˆ·ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«è´Ÿè½½å‡è¡¡åˆ°äº† B èŠ‚ç‚¹ï¼Œå› ä¸º B èŠ‚ç‚¹ä¸Šé¢æ²¡æœ‰ç”¨æˆ·çš„ç™»é™†å‡­è¯ï¼Œæ‰€ä»¥éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ï¼Œè¿™ä¸ªä½“éªŒå¤ªç³Ÿç³•äº†ã€‚</p><figure><img src="'+je+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚æœç”¨æˆ·çš„ç™»é™†å‡­è¯ç»è¿‡åŠ å¯†ï¼ˆ<code>Token</code>ï¼‰ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡æäº¤è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠŠ <code>Token</code>ä¸Šä¼ ç»™åç«¯æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å³ä¾¿åç«¯é¡¹ç›®ä½¿ç”¨äº†è´Ÿè½½å‡è¡¡ï¼Œæ¯ä¸ªåç«¯èŠ‚ç‚¹æ¥æ”¶åˆ°å®¢æˆ·ç«¯ä¸Šä¼ çš„ Token ä¹‹åï¼Œç»è¿‡æ£€æµ‹ï¼Œæ˜¯æœ‰æ•ˆçš„ <code>Token</code>ï¼Œäºæ˜¯å°±æ–­å®šç”¨æˆ·å·²ç»æˆåŠŸç™»é™†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æä¾›åç«¯æœåŠ¡äº†ã€‚</p><figure><img src="'+He+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>JWT å…¼å®¹æ›´å¤šçš„å®¢æˆ·ç«¯</p><p>ä¼ ç»Ÿçš„ <code>HttpSession</code>ä¾é æµè§ˆå™¨çš„ <code>Cookie</code>å­˜æ”¾ <code>SessionId</code>ï¼Œæ‰€ä»¥è¦æ±‚å®¢æˆ·ç«¯å¿…é¡»æ˜¯æµè§ˆå™¨ã€‚ç°åœ¨çš„ JavaWeb ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¯ä»¥æ˜¯æµè§ˆå™¨ã€APPã€å°ç¨‹åºï¼Œä»¥åŠç‰©è”ç½‘è®¾å¤‡ã€‚ä¸ºäº†è®©è¿™äº›è®¾å¤‡éƒ½èƒ½è®¿é—®åˆ° JavaWeb é¡¹ç›®ï¼Œå°±å¿…é¡»è¦å¼•å…¥ JWT æŠ€æœ¯ã€‚JWT çš„ <code>Token</code>æ˜¯çº¯å­—ç¬¦ä¸²ï¼Œè‡³äºå®¢æˆ·ç«¯æ€ä¹ˆä¿å­˜ï¼Œæ²¡æœ‰å…·ä½“è¦æ±‚ã€‚åªè¦å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œé™„å¸¦ä¸Š <code>Token</code>å³å¯ã€‚æ‰€ä»¥åƒç‰©è”ç½‘è®¾å¤‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>SQLite</code>å­˜å‚¨ <code>Token</code>æ•°æ®ã€‚</p><h3 id="rbac-æ˜¯ä»€ä¹ˆ-æ€ä¹ˆå®ç°çš„" tabindex="-1"><a class="header-anchor" href="#rbac-æ˜¯ä»€ä¹ˆ-æ€ä¹ˆå®ç°çš„" aria-hidden="true">#</a> RBAC æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>RBAC çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¯¹ç³»ç»Ÿæ“ä½œçš„å„ç§æƒé™ä¸æ˜¯ç›´æ¥æˆäºˆå…·ä½“çš„ç”¨æˆ·ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·é›†åˆä¸æƒé™é›†åˆä¹‹é—´å»ºç«‹ä¸€ä¸ªè§’è‰²é›†åˆã€‚æ¯ä¸€ç§è§’è‰²å¯¹åº”ä¸€ç»„ç›¸åº”çš„æƒé™ã€‚ä¸€æ—¦ç”¨æˆ·è¢«åˆ†é…äº†é€‚å½“çš„è§’è‰²åï¼Œè¯¥ç”¨æˆ·å°±æ‹¥æœ‰æ­¤è§’è‰²çš„æ‰€æœ‰æ“ä½œæƒé™ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸å¿…åœ¨æ¯æ¬¡åˆ›å»ºç”¨æˆ·æ—¶éƒ½è¿›è¡Œåˆ†é…æƒé™çš„æ“ä½œï¼Œåªè¦åˆ†é…ç”¨æˆ·ç›¸åº”çš„è§’è‰²å³å¯ï¼Œè€Œä¸”è§’è‰²çš„æƒé™å˜æ›´æ¯”ç”¨æˆ·çš„æƒé™å˜æ›´è¦å°‘å¾—å¤šï¼Œè¿™æ ·å°†ç®€åŒ–ç”¨æˆ·çš„æƒé™ç®¡ç†ï¼Œå‡å°‘ç³»ç»Ÿçš„å¼€é”€ã€‚</p><figure><img src="'+Fe+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>RBAC æ¨¡å‹ä¸­çš„æƒé™æ˜¯ç”±æ¨¡å—å’Œè¡Œä¸ºåˆå¹¶åœ¨ä¸€èµ·è€Œäº§ç”Ÿçš„ï¼Œåœ¨ MySQL ä¸­ï¼Œæœ‰ <code>æ¨¡å—è¡¨ï¼ˆtb_moduleï¼‰</code>å’Œ <code>è¡Œä¸ºè¡¨ï¼ˆtb_actionï¼‰</code>ï¼Œè¿™ä¸¤å¼ è¡¨çš„è®°å½•åˆå¹¶åœ¨ä¸€èµ·å°±è¡Œç¨‹äº†æƒé™è®°å½•ï¼Œä¿å­˜åœ¨ <code>æƒé™è¡¨ï¼ˆtb_permissionï¼‰</code>ä¸­ã€‚</p><figure><img src="'+Je+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ç°åœ¨çŸ¥é“äº†æƒé™è®°å½•æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆæŠŠæƒé™å…³è”åˆ°è§’è‰²ä¸­ã€‚ä¼ ç»Ÿä¸€ç‚¹çš„åšæ³•æ˜¯åˆ›å»ºä¸€ä¸ªäº¤å‰è¡¨ï¼Œè®°å½•è§’è‰²æ‹¥æœ‰ä»€ä¹ˆæƒé™ã€‚ä½†æ˜¯ç°åœ¨ <code>MySQL5.7</code>ä¹‹åå¼•å…¥äº† <code>JSON</code>æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æˆ‘åœ¨ <code>è§’è‰²è¡¨ï¼ˆtb_roleï¼‰</code>ä¸­è®¾ç½®çš„ permissions å­—æ®µï¼Œç±»å‹æ˜¯ JSON æ ¼å¼çš„ã€‚</p><figure><img src="'+Ue+'" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒJSON ç±»å‹å·²ç»æ”¯æŒç´¢å¼•æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå­˜æ”¾åœ¨ JSON å­—æ®µä¸­çš„æ•°æ®æ£€ç´¢é€Ÿåº¦æ…¢äº†ã€‚MySQL ä¸º JSON ç±»å‹é…å¤‡äº†å¾ˆå¤šå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¯»å†™ JSON å­—æ®µä¸­çš„æ•°æ®ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è§’è‰²æ˜¯æ€ä¹ˆå…³è”åˆ°ç”¨æˆ·çš„ï¼Œå…¶å®æˆ‘åœ¨ <code>ç”¨æˆ·è¡¨ï¼ˆtb_userï¼‰</code>ä¸Šé¢è®¾ç½® role å­—æ®µï¼Œç±»å‹ä¾æ—§æ˜¯ JSON çš„ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥æŠŠå¤šä¸ªè§’è‰²å…³è”åˆ°æŸä¸ªç”¨æˆ·èº«ä¸Šäº†ã€‚</p><figure><img src="'+Ke+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å¦‚ä½•æŸ¥è¯¢ç”¨æˆ·çš„æƒé™åˆ—è¡¨ï¼Ÿ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;searchUserPermissions&quot;</span> parameterType<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;String&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>permission_name
    <span class="token keyword">FROM</span> tb_user u
    <span class="token keyword">JOIN</span> tb_role r <span class="token keyword">ON</span> JSON_CONTAINS<span class="token punctuation">(</span>u<span class="token punctuation">.</span>role<span class="token punctuation">,</span> CAST<span class="token punctuation">(</span>r<span class="token punctuation">.</span>id <span class="token keyword">AS</span> <span class="token keyword">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">JOIN</span> tb_permission p <span class="token keyword">ON</span> JSON_CONTAINS<span class="token punctuation">(</span>r<span class="token punctuation">.</span>permissions<span class="token punctuation">,</span> CAST<span class="token punctuation">(</span>p<span class="token punctuation">.</span>id <span class="token keyword">AS</span> <span class="token keyword">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">WHERE</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#{userId} AND u.status = 1;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ¨è®¾è®¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ğŸ¨è®¾è®¡æ¨¡å¼" aria-hidden="true">#</a> ğŸ¨è®¾è®¡æ¨¡å¼</h2><h3 id="ä½ èƒ½è¯´è¯´è®¾è®¡æ¨¡å¼å—" tabindex="-1"><a class="header-anchor" href="#ä½ èƒ½è¯´è¯´è®¾è®¡æ¨¡å¼å—" aria-hidden="true">#</a> ä½ èƒ½è¯´è¯´è®¾è®¡æ¨¡å¼å—</h3><p>24 å¤§è®¾è®¡æ¨¡å¼å’Œ 7 ä¸ªåŸåˆ™</p><p>7 ä¸ªåŸåˆ™</p><p>å•ä¸€èŒè´£åŸåˆ™ã€SINGLE RESPONSIBILITY PRINCIPLEã€‘: ä¸€ä¸ªç±»è´Ÿè´£ä¸€é¡¹èŒè´£ã€‚</p><p>é‡Œæ°æ›¿æ¢åŸåˆ™ã€LISKOV SUBSTITUTION PRINCIPLEã€‘: ç»§æ‰¿ä¸æ´¾ç”Ÿçš„è§„åˆ™ã€‚</p><p>ä¾èµ–å€’ç½®åŸåˆ™ã€DEPENDENCE INVERSION PRINCIPLEã€‘: é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼›ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚å³é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p><p>æ¥å£éš”ç¦»åŸåˆ™ã€INTERFACE SEGREGATION PRINCIPLEã€‘: å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£ï¼Œå°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ã€‚</p><p>è¿ªç±³ç‰¹æ³•åˆ™ã€LOW OF DEMETERã€‘: ä½è€¦åˆï¼Œé«˜å†…èšã€‚</p><p>å¼€é—­åŸåˆ™ã€OPEN CLOSE PRINCIPLEã€‘: ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p><p>ç»„åˆ/èšåˆå¤ç”¨åŸåˆ™ã€Composition/Aggregation Reuse Principle(CARP) ã€‘: å°½é‡ä½¿ç”¨ç»„åˆå’Œèšåˆå°‘ä½¿ç”¨ç»§æ‰¿çš„å…³ç³»æ¥è¾¾åˆ°å¤ç”¨çš„åŸåˆ™</p><p>24 å¤§è®¾è®¡æ¨¡å¼</p><figure><img src="`+Qe+'" alt="image-20220405151704557" tabindex="0" loading="lazy"><figcaption>image-20220405151704557</figcaption></figure><h3 id="ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼æ›´å¥½-ä½ èƒ½è¯´è¯´ç”¨å’Œä¸ç”¨çš„åŒºåˆ«å—" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼æ›´å¥½-ä½ èƒ½è¯´è¯´ç”¨å’Œä¸ç”¨çš„åŒºåˆ«å—" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼æ›´å¥½ï¼Œä½ èƒ½è¯´è¯´ç”¨å’Œä¸ç”¨çš„åŒºåˆ«å—</h3><p>è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘ä¸­ç»å¸¸å‡ºç°çš„é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆã€‚ å®ƒä»¬å¯ä»¥å¸®åŠ©æ‚¨ç¼–å†™æ›´å¹²å‡€ã€æ›´å¯é‡ç”¨ã€æ›´æ˜“ç»´æŠ¤çš„ä»£ç 2ã€‚ ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ä¸€äº›å¥½å¤„æ˜¯ï¼š</p><ul><li>ä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªå…±äº«çš„è¯æ±‡è¡¨ï¼Œä»¥ä¾¿æ›´æœ‰æ•ˆåœ°è¿›è¡Œäº¤æµã€‚</li><li>åŒ…å«äº†æœ€ä½³å®è·µï¼Œé¿å…é‡æ–°å‘æ˜è½¦è½®ã€‚</li><li>å®ƒä»¬é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚å¹¶ä¿ƒè¿›ä»£ç é‡ç”¨ã€‚</li></ul><p>ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ä¸€äº›ç¼ºç‚¹æ˜¯ï¼š</p><ul><li>å¯èƒ½åœ¨ä¸éœ€è¦æˆ–åº”ç”¨ä¸æ­£ç¡®æ—¶è¢«è¿‡åº¦ä½¿ç”¨æˆ–è¯¯ç”¨ã€‚</li><li>å¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„å¤æ‚æ€§å’ŒæŠ½è±¡ï¼Œè€Œè¿™å¯èƒ½æ˜¯ä¸å¿…è¦çš„ã€‚</li><li>å¯¹äºåˆå­¦è€…æˆ–ä¸ç†Ÿæ‚‰çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œå®ƒä»¬å¯èƒ½å¾ˆéš¾å­¦ä¹ å’Œç†è§£ã€‚</li></ul><p>ä½¿ç”¨å’Œä¸ä½¿ç”¨è®¾è®¡æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«å–å†³äºä¸Šä¸‹æ–‡å’Œæ‚¨è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´åŠ ä¼˜é›…å’Œå¥å£®ã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´ç®€å•ï¼Œæ›´ç›´æ¥ã€‚ å…³é”®æ˜¯æ˜æ™ºè€Œæ°å½“åœ°ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œè€Œä¸æ˜¯ç›²ç›®åœ°å°†å…¶ä½œä¸ºè§„åˆ™ã€‚</p>',94),Ro={href:"https://www.javatpoint.com/design-patterns-in-java%E3%80%81https://java-design-patterns.com/",target:"_blank",rel:"noopener noreferrer"},Io=t(`<h3 id="ä¼šä»€ä¹ˆè®¾è®¡æ¨¡å¼-è®²ä¸€ä¸‹æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼-åº”ç”¨-å¯¹äºæ¨¡ç‰ˆæ¨¡å¼çš„ç†è§£-åº”ç”¨åœºæ™¯-ä½ åœ¨é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„-2022ç¾å›¢" tabindex="-1"><a class="header-anchor" href="#ä¼šä»€ä¹ˆè®¾è®¡æ¨¡å¼-è®²ä¸€ä¸‹æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼-åº”ç”¨-å¯¹äºæ¨¡ç‰ˆæ¨¡å¼çš„ç†è§£-åº”ç”¨åœºæ™¯-ä½ åœ¨é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„-2022ç¾å›¢" aria-hidden="true">#</a> ä¼šä»€ä¹ˆè®¾è®¡æ¨¡å¼ï¼Œè®²ä¸€ä¸‹æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œåº”ç”¨ | å¯¹äºæ¨¡ç‰ˆæ¨¡å¼çš„ç†è§£ï¼Œåº”ç”¨åœºæ™¯ï¼Œä½ åœ¨é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼ˆ2022ç¾å›¢ï¼‰</h3><h4 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¨¡æ¿æ¨¡å¼" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯æ¨¡æ¿æ¨¡å¼ï¼Ÿ</h4><p><strong>æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰</strong> åˆå«æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå…¶å®šä¹‰äº†æ“ä½œçš„æµç¨‹ï¼Œå¹¶å°†æµç¨‹ä¸­çš„æŸäº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œå®ç°ï¼Œä½¿å¾—å­ç±»åœ¨ä¸æ”¹å˜æ“ä½œæµç¨‹çš„å‰æä¸‹ï¼Œå³å¯é‡æ–°å®šä¹‰è¯¥æ“ä½œçš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ä¾‹å¦‚åšèœï¼Œæ“ä½œæµç¨‹ä¸€èˆ¬ä¸º â€œå‡†å¤‡èœâ€-&gt;â€œæ”¾æ²¹â€-&gt;â€œç‚’èœâ€-&gt;â€œè°ƒå‘³â€-&gt;â€œè£…ç›˜â€ï¼Œä½†å¯èƒ½å¯¹äºä¸åŒçš„èœè¦æ”¾ä¸åŒç±»å‹çš„æ²¹ï¼Œä¸åŒçš„èœè°ƒå‘³æ–¹å¼ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚</p><h4 id="ä½•æ—¶ä½¿ç”¨æ¨¡æ¿æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä½•æ—¶ä½¿ç”¨æ¨¡æ¿æ¨¡å¼" aria-hidden="true">#</a> ä½•æ—¶ä½¿ç”¨æ¨¡æ¿æ¨¡å¼ï¼Ÿ</h4><p>å½“ä¸€ä¸ªæ“ä½œçš„æµç¨‹è¾ƒä¸ºå¤æ‚ï¼Œå¯åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œä¸”å¯¹äºä¸åŒçš„æ“ä½œå®ç°ç±»ï¼Œæµç¨‹æ­¥éª¤ç›¸åŒï¼Œåªæœ‰éƒ¨åˆ†ç‰¹å®šæ­¥éª¤æ‰éœ€è¦è‡ªå®šä¹‰ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¨¡æ¿æ¨¡å¼ã€‚å¦‚æœä¸€ä¸ªæ“ä½œä¸å¤æ‚ï¼ˆå³åªæœ‰ä¸€ä¸ªæ­¥éª¤ï¼‰ï¼Œæˆ–è€…ä¸å­˜åœ¨ç›¸åŒçš„æµç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚ä»è¿™ä¹Ÿå¯çœ‹å‡ºæ¨¡æ¿æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„åŒºåˆ«ï¼šç­–ç•¥æ¨¡å¼å…³æ³¨çš„æ˜¯å¤šç§ç­–ç•¥ï¼ˆå¹¿åº¦ï¼‰ï¼Œè€Œæ¨¡æ¿æ¨¡å¼åªå…³æ³¨åŒç§ç­–ç•¥ï¼ˆç›¸åŒæµç¨‹ï¼‰ï¼Œä½†æ˜¯å…·å¤‡å¤šä¸ªæ­¥éª¤ï¼Œä¸”ç‰¹å®šæ­¥éª¤å¯è‡ªå®šä¹‰ï¼ˆæ·±åº¦ï¼‰ã€‚</p><h4 id="èƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯" aria-hidden="true">#</a> èƒŒæ™¯</h4><p>æˆ‘ä»¬å¹³å°çš„åŠ¨æ€è¡¨å•åœ¨é…ç½®è¡¨å•é¡¹çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ–°å¢ä¸€ä¸ªè¡¨å•é¡¹ï¼Œéƒ½è¦æ ¹æ®è¡¨å•é¡¹çš„ç»„ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ å•è¡Œæ–‡æœ¬æ¡†ã€ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼‰å’Œå½“å‰è¾“å…¥çš„å„ç§é…ç½®æ¥è½¬æ¢å¥½å¯¹åº”çš„ Schema å¹¶ä¿å­˜åœ¨ DB ä¸­ã€‚ä¸€å¼€å§‹ï¼Œè½¬æ¢çš„ä»£ç é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å°†è¾“å…¥çš„é…ç½®è½¬å˜ä¸ºè¡¨å•é¡¹
     *
     * <span class="token keyword">@param</span> <span class="token parameter">config</span> å‰ç«¯è¾“å…¥çš„é…ç½®
     * <span class="token keyword">@return</span> è¡¨å•é¡¹
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItem</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FormItem</span> formItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å…¬å…±çš„è¡¨å•é¡¹å±æ€§</span>
        formItem<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºè¡¨å•ç»„ä»¶çš„å±æ€§</span>
        <span class="token class-name">FormComponentProps</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormComponentProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setComponentProps</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
        <span class="token comment">// å…¬å…±çš„ç»„ä»¶å±æ€§</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">setReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">FormItemTypeEnum</span> type <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä¸‹æ‹‰é€‰æ‹©æ¡†çš„ç‰¹æ®Šå±æ€§å¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token class-name">ComponentTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DROPDOWN_SELECT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">setAutoWidth</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isMultiple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                props<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token string">&quot;multiple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ¨¡ç³Šæœç´¢æ¡†çš„ç‰¹æ®Šå±æ€§å¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token class-name">ComponentTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FUZZY_SEARCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            formItem<span class="token punctuation">.</span><span class="token function">setFuzzySearch</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            props<span class="token punctuation">.</span><span class="token function">setAutoWidth</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ...  å…¶ä»–ç»„ä»¶çš„ç‰¹æ®Šå¤„ç†</span>

        <span class="token comment">// åˆ›å»ºçº¦æŸè§„åˆ™</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ¯ä¸ªè¡¨å•é¡¹éƒ½å¯æœ‰çš„çº¦æŸè§„åˆ™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> requiredRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            requiredRule<span class="token punctuation">.</span><span class="token function">setRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            requiredRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¾“å…¥&quot;</span> <span class="token operator">+</span> config<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>requiredRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ–‡æœ¬è¾“å…¥æ¡†æ‰æœ‰çš„è§„åˆ™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token class-name">ComponentTypeEnum</span><span class="token punctuation">.</span><span class="token constant">TEXT_INPUT</span> <span class="token operator">||</span> type <span class="token operator">==</span> <span class="token class-name">ComponentTypeEnum</span><span class="token punctuation">.</span><span class="token constant">TEXT_AREA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Integer</span> minLength <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMinLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>minLength <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> minLength <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">FormItemRule</span> minRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                minRule<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>minLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
                minRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è‡³å°‘è¾“å…¥ &quot;</span> <span class="token operator">+</span> minLength <span class="token operator">+</span> <span class="token string">&quot; ä¸ªå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>minRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">Integer</span> maxLength <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMaxLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>maxLength <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> maxLength <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">FormItemRule</span> maxRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                maxRule<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>maxLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
                maxRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·æœ€å¤šè¾“å…¥ &quot;</span> <span class="token operator">+</span> maxLength <span class="token operator">+</span> <span class="token string">&quot; ä¸ªå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>maxRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ... å…¶ä»–çº¦æŸè§„åˆ™</span>

        <span class="token keyword">return</span> formItem<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä»½ä»£ç è¿åäº† å¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰ï¼šå¦‚æœæ­¤æ—¶éœ€è¦æ·»åŠ ä¸€ç§æ–°çš„è¡¨å•é¡¹ï¼ˆåŒ…å«ç‰¹æ®Šçš„ç»„ä»¶å±æ€§ï¼‰ï¼Œé‚£ä¹ˆä¸å¯é¿å…çš„è¦ä¿®æ”¹ convert æ–¹æ³•æ¥è¿›è¡Œæ–°è¡¨å•é¡¹çš„ç‰¹æ®Šå¤„ç†ã€‚è§‚å¯Ÿä¸Šé¢çš„ä»£ç ï¼Œå°†é…ç½®è½¬å˜ä¸ºè¡¨å•é¡¹ è¿™ä¸ªæ“ä½œï¼Œæ»¡è¶³ä»¥ä¸‹æµç¨‹ï¼š</p><ol><li>åˆ›å»ºè¡¨å•é¡¹ï¼Œå¹¶è®¾ç½®é€šç”¨çš„è¡¨å•é¡¹å±æ€§ï¼Œç„¶åå†å¯¹ä¸åŒè¡¨å•é¡¹çš„ç‰¹æ®Šå±æ€§è¿›è¡Œå¤„ç†</li><li>åˆ›å»ºç»„ä»¶å±æ€§ï¼Œå¤„ç†é€šç”¨çš„ç»„ä»¶å±æ€§ï¼Œç„¶åå†å¯¹ä¸åŒç»„ä»¶çš„ç‰¹æ®Šå±æ€§è¿›è¡Œå¤„ç†</li><li>åˆ›å»ºçº¦æŸè§„åˆ™ï¼Œå¤„ç†é€šç”¨çš„çº¦æŸè§„åˆ™ï¼Œç„¶åå†å¯¹ä¸åŒè¡¨å•é¡¹çš„ç‰¹æ€§çº¦æŸè§„åˆ™è¿›è¡Œå¤„ç†</li></ol><p>è¿™ä¸æ­£æ˜¯ç¬¦åˆæ¨¡æ¿æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼ˆæ“ä½œæµç¨‹å›ºå®šï¼Œç‰¹æ®Šæ­¥éª¤å¯è‡ªå®šä¹‰å¤„ç†ï¼‰å—ï¼ŸåŸºäºä¸Šé¢è¿™ä¸ªåœºæ™¯ï¼Œä¸‹é¢æˆ‘å°±åˆ†äº«ä¸€ä¸‹æˆ‘ç›®å‰åŸºäº Spring å®ç°æ¨¡æ¿æ¨¡å¼çš„ â€œæœ€ä½³å¥—è·¯â€ï¼ˆå¦‚æœä½ æœ‰æ›´å¥½çš„å¥—è·¯ï¼Œæ¬¢è¿èµæ•™å’Œè®¨è®ºå“¦ï¼‰~</p><h4 id="æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆ" aria-hidden="true">#</a> æ–¹æ¡ˆ</h4><ul><li><strong>å®šä¹‰å‡ºæ¨¡æ¿</strong></li></ul><p>å³é¦–å…ˆå®šä¹‰å‡ºè¡¨å•é¡¹è½¬æ¢çš„æ“ä½œæµç¨‹ï¼Œå³å¦‚ä¸‹çš„ convert æ–¹æ³•ï¼ˆä½¿ç”¨ final ä¿®é¥°ï¼Œç¡®ä¿å­ç±»ä¸å¯ä¿®æ”¹æ“ä½œæµç¨‹ï¼‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å­ç±»å¯å¤„ç†çš„è¡¨å•é¡¹ç±»å‹
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å°†è¾“å…¥çš„é…ç½®è½¬å˜ä¸ºè¡¨å•é¡¹çš„æ“ä½œæµç¨‹
     *
     * <span class="token keyword">@param</span> <span class="token parameter">config</span> å‰ç«¯è¾“å…¥çš„é…ç½®
     * <span class="token keyword">@return</span> è¡¨å•é¡¹
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">FormItem</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FormItem</span> item <span class="token operator">=</span> <span class="token function">createItem</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¡¨å•é¡¹åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•</span>
        <span class="token function">afterItemCreate</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">FormComponentProps</span> props <span class="token operator">=</span> <span class="token function">createComponentProps</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setComponentProps</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»„ä»¶å±æ€§åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•</span>
        <span class="token function">afterPropsCreate</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token function">createRules</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// çº¦æŸè§„åˆ™åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•</span>
        <span class="token function">afterRulesCreate</span><span class="token punctuation">(</span>rules<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å…±ç”¨é€»è¾‘ï¼šåˆ›å»ºè¡¨å•é¡¹ã€è®¾ç½®é€šç”¨çš„è¡¨å•é¡¹å±æ€§
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">FormItem</span> <span class="token function">createItem</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FormItem</span> formItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        formItem<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        formItem<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> formItem<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¡¨å•é¡¹åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterItemCreate</span><span class="token punctuation">(</span><span class="token class-name">FormItem</span> item<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å…±ç”¨é€»è¾‘ï¼šåˆ›å»ºç»„ä»¶å±æ€§ã€è®¾ç½®é€šç”¨çš„ç»„ä»¶å±æ€§
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">FormComponentProps</span> <span class="token function">createComponentProps</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FormComponentProps</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormComponentProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">setReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getPlaceholder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">setPlaceholder</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getPlaceholder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> props<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç»„ä»¶å±æ€§åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterPropsCreate</span><span class="token punctuation">(</span><span class="token class-name">FormComponentProps</span> props<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å…±ç”¨é€»è¾‘ï¼šåˆ›å»ºçº¦æŸè§„åˆ™ã€è®¾ç½®é€šç”¨çš„çº¦æŸè§„åˆ™
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> <span class="token function">createRules</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> requiredRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            requiredRule<span class="token punctuation">.</span><span class="token function">setRequired</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            requiredRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¾“å…¥&quot;</span> <span class="token operator">+</span> config<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>requiredRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> rules<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * çº¦æŸè§„åˆ™åˆ›å»ºå®Œæˆä¹‹åï¼Œå­ç±»å¦‚æœéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯è¦†å†™è¯¥æ–¹æ³•
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterRulesCreate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

    æ¨¡æ¿çš„å®ç°

é’ˆå¯¹ä¸åŒçš„è¡¨å•é¡¹ï¼Œå¯¹ç‰¹æ®Šæ­¥éª¤è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼š

<span class="token doc-comment comment">/**
 * ä¸‹æ‹‰é€‰æ‹©æ¡†çš„è½¬æ¢å™¨
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DropdownSelectConverter</span> <span class="token keyword">extends</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DROPDOWN_SELECT</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterPropsCreate</span><span class="token punctuation">(</span><span class="token class-name">FormComponentProps</span> props<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">setAutoWidth</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isMultiple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token string">&quot;multiple&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * æ¨¡ç³Šæœç´¢æ¡†çš„è½¬æ¢å™¨
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FuzzySearchConverter</span> <span class="token keyword">extends</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token constant">FUZZY_SEARCH</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterItemCreate</span><span class="token punctuation">(</span><span class="token class-name">FormItem</span> item<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span><span class="token function">setFuzzySearch</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterPropsCreate</span><span class="token punctuation">(</span><span class="token class-name">FormComponentProps</span> props<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span><span class="token function">setAutoWidth</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * é€šç”¨æ–‡æœ¬ç±»è½¬æ¢å™¨
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CommonTextConverter</span> <span class="token keyword">extends</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterRulesCreate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> minLength <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMinLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>minLength <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> minLength <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> minRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minRule<span class="token punctuation">.</span><span class="token function">setMin</span><span class="token punctuation">(</span>minLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            minRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è‡³å°‘è¾“å…¥ &quot;</span> <span class="token operator">+</span> minLength <span class="token operator">+</span> <span class="token string">&quot; ä¸ªå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>minRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Integer</span> maxLength <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMaxLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxLength <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> maxLength <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> maxRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            maxRule<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>maxLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            maxRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·æœ€å¤šè¾“å…¥ &quot;</span> <span class="token operator">+</span> maxLength <span class="token operator">+</span> <span class="token string">&quot; ä¸ªå­—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>maxRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * å•è¡Œæ–‡æœ¬æ¡†çš„è½¬æ¢å™¨
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextInputConverter</span> <span class="token keyword">extends</span> <span class="token class-name">CommonTextConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token constant">TEXT_INPUT</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * å¤šè¡Œæ–‡æœ¬æ¡†çš„è½¬æ¢å™¨
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextAreaConvertor</span> <span class="token keyword">extends</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token constant">TEXT_AREA</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åˆ¶ä½œç®€å•å·¥å‚</strong></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FormItemConverterFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> 
    <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">,</span> <span class="token class-name">FormItemConverter</span><span class="token punctuation">&gt;</span></span> <span class="token constant">CONVERTER_MAP</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ ¹æ®è¡¨å•é¡¹ç±»å‹è·å¾—å¯¹åº”çš„è½¬æ¢å™¨
     *
     * <span class="token keyword">@param</span> <span class="token parameter">type</span> è¡¨å•é¡¹ç±»å‹
     * <span class="token keyword">@return</span> è¡¨å•é¡¹è½¬æ¢å™¨
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemConverter</span> <span class="token function">getConverter</span><span class="token punctuation">(</span><span class="token class-name">FormItemTypeEnum</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">CONVERTER_MAP</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConverters</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemConverter</span><span class="token punctuation">&gt;</span></span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">FormItemConverter</span> converter <span class="token operator">:</span> converters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">CONVERTER_MAP</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>converter<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> converter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æŠ•å…¥ä½¿ç”¨</strong></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FormItemManagerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">FormItemManager</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FormItemConverterFactory</span> converterFactory<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItem</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertFormItems</span><span class="token punctuation">(</span><span class="token class-name">JSONArray</span> inputConfigs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inputConfigs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>inputConfigs<span class="token operator">::</span><span class="token function">getJSONObject</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">convertFormItem</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">FormItem</span> <span class="token function">convertFormItem</span><span class="token punctuation">(</span><span class="token class-name">JSONObject</span> inputConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">FormItemConfig</span> itemConfig <span class="token operator">=</span> inputConfig<span class="token punctuation">.</span><span class="token function">toJavaObject</span><span class="token punctuation">(</span><span class="token class-name">FormItemConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FormItemConverter</span> converter <span class="token operator">=</span> converterFactory<span class="token punctuation">.</span><span class="token function">getConverter</span><span class="token punctuation">(</span>itemConfig<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>converter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸å­˜åœ¨è½¬æ¢å™¨ï¼š&quot;</span> <span class="token operator">+</span> itemConfig<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>itemConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Factory åªè´Ÿè´£è·å– Converterï¼Œæ¯ä¸ª Converter åªè´Ÿè´£å¯¹åº”è¡¨å•é¡¹çš„è½¬æ¢åŠŸèƒ½ï¼ŒManager åªè´Ÿè´£é€»è¾‘ç¼–æ’ï¼Œä»è€Œè¾¾åˆ°åŠŸèƒ½ä¸Šçš„ â€œä½è€¦åˆé«˜å†…èšâ€ã€‚</strong></p><ul><li><strong>è®¾æƒ³ä¸€æ¬¡æ‰©å±•</strong></li></ul><p>æ­¤æ—¶è¦åŠ å…¥ä¸€ç§æ–°çš„è¡¨å•é¡¹ â€”â€” æ•°å­—é€‰æ‹©å™¨ï¼ˆNUMBER_PICKERï¼‰ï¼Œå®ƒæœ‰ç€ç‰¹æ®Šçš„çº¦æŸæ¡ä»¶ï¼šæœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œè¾“å…¥åˆ° FormItemConfig æ—¶åˆ†åˆ«ä¸º minNumer å’Œ maxNumberã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NumberPickerConverter</span> <span class="token keyword">extends</span> <span class="token class-name">FormItemConverter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FormItemTypeEnum</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">FormItemTypeEnum</span><span class="token punctuation">.</span><span class="token constant">NUMBER_PICKER</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterRulesCreate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormItemRule</span><span class="token punctuation">&gt;</span></span> rules<span class="token punctuation">,</span> <span class="token class-name">FormItemConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> minNumber <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMinNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¤„ç†æœ€å°å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>minNumber <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> minNumRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            minNumRule<span class="token punctuation">.</span><span class="token function">setMinimum</span><span class="token punctuation">(</span>minNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            minNumRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¾“å…¥æ•°å­—ä¸èƒ½å°äº &quot;</span> <span class="token operator">+</span> minNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>minNumRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Integer</span> maxNumber <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getMaxNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¤„ç†æœ€å¤§å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxNumber <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FormItemRule</span> maxNumRule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormItemRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            maxNumRule<span class="token punctuation">.</span><span class="token function">setMaximum</span><span class="token punctuation">(</span>maxNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            maxNumRule<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;è¾“å…¥æ•°å­—ä¸èƒ½å¤§äº &quot;</span> <span class="token operator">+</span> maxNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

            rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>maxNumRule<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ å¯¹åº”çš„æšä¸¾å’Œå®ç°å¯¹åº”çš„ FormItemConverterï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹ä»»ä½•é€»è¾‘ä»£ç ï¼Œå› ä¸º Spring å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†å¥½ NUMBER_PICKER å’Œ NumberPickerConverter çš„å…³è”å…³ç³» â€”â€” å®Œç¾ç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚</p><h3 id="è®²ä¸€ä¸‹å•ä¾‹æ¨¡å¼-è¯¦ç»†è¯´é¥¿æ±‰å¼çš„å†™æ³•å’ŒåŸå› -2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#è®²ä¸€ä¸‹å•ä¾‹æ¨¡å¼-è¯¦ç»†è¯´é¥¿æ±‰å¼çš„å†™æ³•å’ŒåŸå› -2022è”šæ¥" aria-hidden="true">#</a> è®²ä¸€ä¸‹å•ä¾‹æ¨¡å¼ï¼Œè¯¦ç»†è¯´é¥¿æ±‰å¼çš„å†™æ³•å’ŒåŸå› ï¼ˆ2022è”šæ¥ï¼‰</h3><p>åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›å¯¹è±¡å…¶å®æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ï¼šçº¿ç¨‹æ± ã€ç¼“å­˜ã€å¯¹è¯æ¡†ã€æ³¨å†Œè¡¨ã€æ—¥å¿—å¯¹è±¡ã€å……å½“æ‰“å°æœºã€æ˜¾å¡ç­‰è®¾å¤‡é©±åŠ¨ç¨‹åºçš„å¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸€ç±»å¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœåˆ¶é€ å‡ºå¤šä¸ªå®ä¾‹å°±å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜çš„äº§ç”Ÿï¼Œæ¯”å¦‚ï¼šç¨‹åºçš„è¡Œä¸ºå¼‚å¸¸ã€èµ„æºä½¿ç”¨è¿‡é‡ã€æˆ–è€…ä¸ä¸€è‡´æ€§çš„ç»“æœã€‚</p><p><strong>ä½¿ç”¨å•ä¾‹æ¨¡å¼çš„å¥½å¤„:</strong></p><ul><li>å¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‚£äº›é‡é‡çº§å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ï¼›</li><li>ç”±äº new æ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½» GC å‹åŠ›ï¼Œç¼©çŸ­ GC åœé¡¿æ—¶é—´ã€‚</li></ul><p><strong>Spring ä¸­ bean çš„é»˜è®¤ä½œç”¨åŸŸå°±æ˜¯ singleton(å•ä¾‹)çš„ã€‚</strong> é™¤äº† singleton ä½œç”¨åŸŸï¼ŒSpring ä¸­ bean è¿˜æœ‰ä¸‹é¢å‡ ç§ä½œç”¨åŸŸï¼š</p><ul><li>prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚</li><li>request : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼Œè¯¥beanä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚</li><li>session : æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥beanä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚</li><li>global-sessionï¼š å…¨å±€sessionä½œç”¨åŸŸï¼Œä»…ä»…åœ¨åŸºäºportletçš„webåº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ï¼ŒSpring5å·²ç»æ²¡æœ‰äº†ã€‚Portletæ˜¯èƒ½å¤Ÿç”Ÿæˆè¯­ä¹‰ä»£ç (ä¾‹å¦‚ï¼šHTML)ç‰‡æ®µçš„å°å‹Java Webæ’ä»¶ã€‚å®ƒä»¬åŸºäºportletå®¹å™¨ï¼Œå¯ä»¥åƒservletä¸€æ ·å¤„ç†HTTPè¯·æ±‚ã€‚ä½†æ˜¯ï¼Œä¸ servlet ä¸åŒï¼Œæ¯ä¸ª portlet éƒ½æœ‰ä¸åŒçš„ä¼šè¯</li></ul><p><strong>Spring å®ç°å•ä¾‹çš„æ–¹å¼ï¼š</strong></p><ul><li>xml : <code>&lt;bean id=&quot;userService&quot; class=&quot;top.snailclimb.UserService&quot; scope=&quot;singleton&quot;/&gt;</code></li><li>æ³¨è§£ï¼š<code>@Scope(value = &quot;singleton&quot;)</code></li></ul><p><strong>Spring é€šè¿‡ <code>ConcurrentHashMap</code> å®ç°å•ä¾‹æ³¨å†Œè¡¨çš„ç‰¹æ®Šæ–¹å¼å®ç°å•ä¾‹æ¨¡å¼ã€‚Spring å®ç°å•ä¾‹çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// é€šè¿‡ ConcurrentHashMapï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ å®ç°å•ä¾‹æ³¨å†Œè¡¨</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">ObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> singletonFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token string">&quot;&#39;beanName&#39; must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®ä¾‹  </span>
            <span class="token class-name">Object</span> singletonObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//...çœç•¥äº†å¾ˆå¤šä»£ç </span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    singletonObject <span class="token operator">=</span> singletonFactory<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//...çœç•¥äº†å¾ˆå¤šä»£ç </span>
                <span class="token comment">// å¦‚æœå®ä¾‹å¯¹è±¡åœ¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ³¨å†Œåˆ°å•ä¾‹æ³¨å†Œè¡¨ä¸­ã€‚</span>
                <span class="token function">addSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token constant">NULL_OBJECT</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å°†å¯¹è±¡æ·»åŠ åˆ°å•ä¾‹æ³¨å†Œè¡¨</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token punctuation">(</span>singletonObject <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> singletonObject <span class="token operator">:</span> <span class="token constant">NULL_OBJECT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é¥¿æ±‰å¼å†™æ³•" tabindex="-1"><a class="header-anchor" href="#é¥¿æ±‰å¼å†™æ³•" aria-hidden="true">#</a> é¥¿æ±‰å¼å†™æ³•</h4><p>â€œé¥¿æ±‰æ¨¡å¼â€ï¼ˆeager initializationï¼‰ï¼Œå³åœ¨åˆå§‹é˜¶æ®µå°±ä¸»åŠ¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¹¶æ—¶åˆ»ä¿æŒä¸€ç§æ¸´æ±‚çš„çŠ¶æ€ï¼Œæ— è®ºæ­¤å•ä¾‹æ˜¯å¦æœ‰äººä½¿ç”¨</p><p>ä»¥åç¾¿å°„æ—¥ä¸ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sun</span> <span class="token punctuation">{</span>
    <span class="token comment">// â€œprivateâ€å…³é”®å­—ç¡®ä¿å¤ªé˜³å®ä¾‹çš„ç§æœ‰æ€§ã€ä¸å¯è§æ€§å’Œä¸å¯è®¿é—®æ€§</span>
    <span class="token comment">// â€œstaticâ€å…³é”®å­—ç¡®ä¿å¤ªé˜³çš„é™æ€æ€§ï¼Œå°†å¤ªé˜³æ”¾å…¥å†…å­˜é‡Œçš„é™æ€åŒºï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–äº†ï¼Œå®ƒä¸ç±»åŒåœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸ç±»åŒæ—¶æœŸä¸”æ—©äºå†…å­˜å †ä¸­çš„å¯¹è±¡å®ä¾‹åŒ–çš„ï¼Œè¯¥å®ä¾‹åœ¨å†…å­˜ä¸­æ°¸ç”Ÿï¼Œå†…å­˜åƒåœ¾æ”¶é›†å™¨ä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œå›æ”¶</span>
    <span class="token comment">// â€œfinalâ€å…³é”®å­—åˆ™ç¡®ä¿è¿™ä¸ªå¤ªé˜³æ˜¯å¸¸é‡ã€æ’é‡ï¼Œå®ƒæ˜¯ä¸€é¢—ç»ˆæçš„æ’æ˜Ÿï¼Œå¼•ç”¨ä¸€æ—¦è¢«èµ‹å€¼å°±ä¸èƒ½å†ä¿®æ”¹</span>
    <span class="token comment">// â€œnewâ€å…³é”®å­—åˆå§‹åŒ–å¤ªé˜³ç±»çš„é™æ€å®ä¾‹ï¼Œå¹¶èµ‹äºˆé™æ€å¸¸é‡sun</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Sun</span> sun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Sun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œå®ä¾‹åŒ–å·¥ä½œå®Œå…¨å½’å±äºå†…éƒ¨äº‹åŠ¡ï¼Œä»»ä½•å¤–éƒ¨ç±»éƒ½æ— æƒå¹²é¢„</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Sun</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sun<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ‡’æ±‰å¼å†™æ³•" tabindex="-1"><a class="header-anchor" href="#æ‡’æ±‰å¼å†™æ³•" aria-hidden="true">#</a> æ‡’æ±‰å¼å†™æ³•</h4><p>å¦‚æœå§‹ç»ˆæ²¡äººè·å–æ—¥å…‰ï¼Œé‚£å²‚ä¸æ˜¯ç™½é€ äº†å¤ªé˜³ï¼Œä¸€å—å†…å­˜åŒºåŸŸè¢«ç™½ç™½åœ°æµªè´¹äº†ï¼Ÿ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sun</span> <span class="token punctuation">{</span>
    <span class="token comment">// volatileå¯¹é™æ€å˜é‡çš„ä¿®é¥°åˆ™èƒ½ä¿è¯å˜é‡å€¼åœ¨å„çº¿ç¨‹è®¿é—®æ—¶çš„åŒæ­¥æ€§ã€å”¯ä¸€æ€§</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Sun</span> sun<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Sun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ„é€ æ–¹æ³•ç§æœ‰åŒ–</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Sun</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sun <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä»¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹è¿›å…¥</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Sun</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sun <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    sun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sun<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°±æ˜¯æ‡’åŠ è½½æ¨¡å¼çš„â€œåŒæ£€é”â€ï¼šå¤–å±‚æ”¾å®½å…¥å£ï¼Œä¿è¯çº¿ç¨‹å¹¶å‘çš„é«˜æ•ˆæ€§ï¼›å†…å±‚åŠ é”åŒæ­¥ï¼Œä¿è¯å®ä¾‹åŒ–çš„å•æ¬¡è¿è¡Œã€‚</p><h3 id="gitä¸­mergeå’ŒrebaseåŒºåˆ«-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#gitä¸­mergeå’ŒrebaseåŒºåˆ«-2022è”šæ¥" aria-hidden="true">#</a> gitä¸­mergeå’ŒrebaseåŒºåˆ«ï¼ˆ2022è”šæ¥ï¼‰</h3><figure><img src="`+Ve+`" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨-2022è”šæ¥" tabindex="-1"><a class="header-anchor" href="#å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨-2022è”šæ¥" aria-hidden="true">#</a> å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨ï¼ˆ2022è”šæ¥ï¼‰</h3><h4 id="å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸€-ä¸ä½¿ç”¨åŒæ­¥é”" tabindex="-1"><a class="header-anchor" href="#å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸€-ä¸ä½¿ç”¨åŒæ­¥é”" aria-hidden="true">#</a> å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸€(ä¸ä½¿ç”¨åŒæ­¥é”)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> sin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">///ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹å¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">///privateç±»å‹çš„æ„é€ å‡½æ•°ï¼Œä¿è¯å…¶ä»–ç±»å¯¹è±¡ä¸èƒ½ç›´æ¥newä¸€ä¸ªè¯¥å¯¹è±¡çš„å®ä¾‹</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getSin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">///è¯¥ç±»å”¯ä¸€çš„ä¸€ä¸ªpublicæ–¹æ³•    </span>
        <span class="token keyword">return</span> sin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯è¯¥ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šç›´æ¥new ä¸€ä¸ªé™æ€å¯¹è±¡å‡ºæ¥ï¼Œå½“ç³»ç»Ÿä¸­è¿™æ ·çš„ç±»è¾ƒå¤šæ—¶ï¼Œä¼šä½¿å¾—å¯åŠ¨é€Ÿåº¦å˜æ…¢ ã€‚ç°åœ¨æµè¡Œçš„è®¾è®¡éƒ½æ˜¯è®²**â€œå»¶è¿ŸåŠ è½½â€**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–ç¬¬ä¸€ä¸ªè¯¥ç±»å¯¹è±¡ã€‚æ‰€ä»¥è¿™ç§é€‚åˆåœ¨å°ç³»ç»Ÿã€‚</p><h4 id="å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹äºŒ-ä½¿ç”¨åŒæ­¥æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹äºŒ-ä½¿ç”¨åŒæ­¥æ–¹æ³•" aria-hidden="true">#</a> å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹äºŒ(ä½¿ç”¨åŒæ­¥æ–¹æ³•)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">//å¯¹è·å–å®ä¾‹çš„æ–¹æ³•è¿›è¡ŒåŒæ­¥</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­çš„ä¸€æ¬¡é”ä½äº†ä¸€ä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªç²’åº¦æœ‰ç‚¹å¤§ ï¼Œæ”¹è¿›å°±æ˜¯åªé”ä½å…¶ä¸­çš„newè¯­å¥å°±OKã€‚å°±æ˜¯æ‰€è°“çš„â€œåŒé‡é”â€æœºåˆ¶ã€‚</p><h4 id="å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸‰-ä½¿ç”¨åŒé‡åŒæ­¥é”" tabindex="-1"><a class="header-anchor" href="#å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸‰-ä½¿ç”¨åŒé‡åŒæ­¥é”" aria-hidden="true">#</a> å¤šçº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼å®ä¾‹ä¸‰(ä½¿ç”¨åŒé‡åŒæ­¥é”)</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">//å¯¹è·å–å®ä¾‹çš„æ–¹æ³•è¿›è¡ŒåŒæ­¥</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é—®é¢˜è§£ç­”é€‰å–çš„-github-ä»“åº“" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜è§£ç­”é€‰å–çš„-github-ä»“åº“" aria-hidden="true">#</a> é—®é¢˜è§£ç­”é€‰å–çš„ github ä»“åº“</h2><p>å¦‚æœä¸æ˜¯åœ¨ github ä¸ŠæŸ¥æ‰¾åˆ°çš„ç­”æ¡ˆä¼šç»™äºˆæ ‡æ³¨</p>`,55),Ao={href:"https://github.com/Snailclimb/JavaGuide",target:"_blank",rel:"noopener noreferrer"},No={href:"https://www.pdai.tech/",target:"_blank",rel:"noopener noreferrer"},Mo={href:"https://github.com/rbmonster/learning-note",target:"_blank",rel:"noopener noreferrer"},Eo={href:"https://github.com/CoderLeixiaoshuai/java-eight-part",target:"_blank",rel:"noopener noreferrer"},Oo={href:"https://github.com/doocs/advanced-java",target:"_blank",rel:"noopener noreferrer"},Bo={href:"https://www.iamshuaidi.com/",target:"_blank",rel:"noopener noreferrer"},Do={href:"https://github.com/xiaolincoder/CS-Base",target:"_blank",rel:"noopener noreferrer"},zo={href:"https://www.mianshiya.com/",target:"_blank",rel:"noopener noreferrer"},qo=n("li",null,"å›½å¤–ç½‘ç«™",-1);function jo(Ho,Fo){const a=l("ExternalLinkIcon");return i(),c("div",null,[Xe,n("ul",null,[n("li",null,[n("a",We,[s("å…«è‚¡æ–‡å­¦ä¹ è·¯çº¿åŠæ”»ç•¥"),e(a)])]),n("li",null,[n("a",Ye,[s("è®ºå¦‚ä½• 4 ä¸ªæœˆé«˜æ•ˆåˆ·æ»¡ 500 é¢˜å¹¶å½¢æˆé•¿æœŸè®°å¿†"),e(a)])]),n("li",null,[n("a",Ze,[s("ã€Œåˆ·é¢˜ç»éªŒã€1000 é¢˜ç•™å¿µï¼Œé™„å¸¦æˆ‘çš„åˆ·é¢˜æ”»ç•¥"),e(a)])]),n("li",null,[n("a",$e,[s("åç«¯é¢ç»æ±‡æ€»"),e(a)])]),n("li",null,[n("a",nt,[s("æ€æ ·åˆ·åŠ›æ‰£åˆé€‚ï¼Ÿ"),e(a)])])]),st,n("p",null,[n("a",at,[s("Mysqlç³»åˆ—-è”åˆç´¢å¼• - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦"),e(a)])]),et,n("p",null,[s("ä¸ªäººè§‰å¾—è¿™ä¸ªé—®é¢˜åº”è¯¥ä»"),n("a",tt,[s("starterå‡ºå‘"),e(a)]),s(" -ã€‹ "),n("a",pt,[s("è‡ªåŠ¨è£…é…åŸç†"),e(a)])]),ot,n("p",null,[s("é•¿å­—ç‰ˆæœ¬å¯åŠ¨æµç¨‹ï¼š"),n("a",it,[s("https://mp.weixin.qq.com/s/ut3mRwhfqXNjrBtTmI0oWg"),e(a)])]),ct,n("p",null,[s("å…·ä½“å¯ä»¥å‚è€ƒï¼š"),n("a",lt,[s("é¢è¯•å®˜:â€œè°ˆè°ˆSpringä¸­éƒ½ç”¨åˆ°äº†é‚£äº›è®¾è®¡æ¨¡å¼?â€"),e(a)])]),rt,n("p",null,[s("å…·ä½“ç†è§£å¯ä»¥çœ‹ï¼š"),n("a",ut,[s("https://www.pdai.tech/md/arch/arch-z-transection.html#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"),e(a)])]),dt,n("ul",null,[n("li",null,[n("a",kt,[s("https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/"),e(a)])])]),mt,n("p",null,[s("æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”ï¼ŒZuul ç”Ÿæ€æœ¬èº«å°±æœ‰å¾ˆå¤šç°æˆçš„è¿‡æ»¤å™¨ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚å°±æ¯”å¦‚é™æµå¯ä»¥ç›´æ¥ç”¨å›½å¤–æœ‹å‹å†™çš„ "),n("a",gt,[s("spring-cloud-zuul-ratelimit"),e(a)])]),vt,n("ul",null,[n("li",null,[s("Github åœ°å€ ï¼š "),n("a",bt,[s("https://github.com/Netflix/zuul"),e(a)])]),n("li",null,[s("å®˜æ–¹ Wiki ï¼š "),n("a",ht,[s("https://github.com/Netflix/zuul/wiki"),e(a)])])]),ft,yt,wt,Ct,St,xt,n("ul",null,[n("li",null,[s("Github åœ°å€ ï¼š "),n("a",_t,[s("https://github.com/spring-cloud/spring-cloud-gateway"),e(a)])]),n("li",null,[s("å®˜ç½‘ ï¼š "),n("a",Tt,[s("https://spring.io/projects/spring-cloud-gateway"),e(a)])])]),Pt,Lt,n("p",null,[s("Kong æ˜¯ä¸€æ¬¾åŸºäº "),n("a",Rt,[s("OpenResty"),e(a)])]),It,n("ul",null,[n("li",null,[s("Github åœ°å€ï¼š "),n("a",At,[s("https://github.com/Kong/kong"),e(a)])]),n("li",null,[s("å®˜ç½‘åœ°å€ ï¼š "),n("a",Nt,[s("https://konghq.com/kong"),e(a)])])]),Mt,n("ul",null,[n("li",null,[s("Github åœ°å€ ï¼š"),n("a",Et,[s("https://github.com/apache/apisix"),e(a)])]),n("li",null,[s("å®˜ç½‘åœ°å€ï¼š "),n("a",Ot,[s("https://apisix.apache.org/zh/"),e(a)])])]),Bt,Dt,zt,qt,n("ul",null,[n("li",null,[s("Github åœ°å€ï¼š "),n("a",jt,[s("https://github.com/apache/incubator-shenyu"),e(a)])]),n("li",null,[s("å®˜ç½‘åœ°å€ ï¼š "),n("a",Ht,[s("https://shenyu.apache.org/"),e(a)])])]),Ft,Jt,Ut,Kt,n("p",null,[n("a",Qt,[s("Apache Dubbo"),e(a)]),s(" æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ã€‚")]),n("p",null,[s("æ ¹æ® "),n("a",Vt,[s("Dubbo å®˜æ–¹æ–‡æ¡£"),e(a)])]),Gt,n("p",null,[n("a",Xt,[s("CAP ç†è®º/å®šç†"),e(a)])]),Wt,n("p",null,[s("ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•ï¼š"),n("a",Yt,[s("https://zhuanlan.zhihu.com/p/66037342"),e(a)])]),n("p",null,[s("æ€ä¹ˆå®ç°å•ç‚¹ç™»å½•ï¼š"),n("a",Zt,[s("https://mp.weixin.qq.com/s?__biz=MzI4MTY5NTk4Ng==&mid=2247489168&idx=1&sn=194ade3bfe3ae19436fd80853c135f54&source=41#wechat_redirect"),e(a)])]),$t,n("p",null,[n("a",np,[s("https://blog.csdn.net/alionsss/article/details/107451485"),e(a)])]),sp,n("p",null,[n("a",ap,[s("https://thrift.apache.org/"),e(a)])]),ep,n("p",null,[s("ç­”æ¡ˆé€‰è‡ªï¼š"),n("a",tp,[s("https://developer.aliyun.com/article/785050"),e(a)])]),pp,n("blockquote",null,[n("p",null,[s("è¿™æ˜¯Redisä½œè€…æ¨èçš„åˆ†å¸ƒå¼é›†ç¾¤æƒ…å†µä¸‹çš„æ–¹å¼ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« "),n("a",op,[s("Is Redlock safe? (opens new window)"),e(a)])])]),ip,n("ol",null,[cp,n("li",null,[s("RedLockç®—æ³•æœ¬èº«æœ‰äº‰è®®ï¼Œå…·ä½“çœ‹è¿™ç¯‡æ–‡ç« "),n("a",lp,[s("How to do distributed locking (opens new window)"),e(a)]),s(" ä»¥åŠä½œè€…çš„å›å¤"),n("a",rp,[s("Is Redlock safe?"),e(a)])])]),up,n("p",null,[n("a",dp,[s("åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°XXL-JOB (xuxueli.com)"),e(a)])]),kp,n("p",null,[n("a",mp,[s("ç³»ç»Ÿç¨³å®šæ€§â€”â€”OutOfMemoryError å¸¸è§åŸå› åŠè§£å†³æ–¹æ³•"),e(a)])]),gp,n("p",null,[s("è¯¦æƒ…å¯ä»¥çœ‹ ï¼š "),n("a",vp,[s("ã€Šæ–°ä¸€ä»£åƒåœ¾å›æ”¶å™¨ ZGC çš„æ¢ç´¢ä¸å®è·µã€‹"),e(a)])]),bp,n("p",null,[s("è¯¦æƒ…è¯·æŸ¥çœ‹ï¼š"),n("a",hp,[s("https://coolshell.cn/articles/9606.html"),e(a)])]),fp,n("p",null,[n("a",yp,[s("https://blog.csdn.net/it_lihongmin/article/details/109230696"),e(a)])]),wp,n("p",null,[n("a",Cp,[s("https://www.pdai.tech/md/db/nosql-redis/db-redis-x-redis-ds.html"),e(a)])]),Sp,n("p",null,[s("ä»ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´ï¼ŒRedisæœåŠ¡æä¾›å››ç§æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆï¼šRDBã€AOFã€è™šæ‹Ÿå†…å­˜ï¼ˆVMï¼‰å’Œã€€DISKSTOREã€‚è™šæ‹Ÿå†…å­˜ï¼ˆVMï¼‰æ–¹å¼ï¼Œä»Redis Version 2.4å¼€å§‹å°±è¢«å®˜æ–¹æ˜ç¡®è¡¨ç¤ºä¸å†å»ºè®®ä½¿ç”¨ï¼ŒVersion 3.2ç‰ˆæœ¬ä¸­æ›´æ‰¾ä¸åˆ°å…³äºè™šæ‹Ÿå†…å­˜ï¼ˆVMï¼‰çš„ä»»ä½•é…ç½®èŒƒä¾‹ï¼ŒRedisçš„ä¸»è¦ä½œè€…Salvatore Sanfilippoè¿˜ä¸“é—¨å†™äº†ä¸€ç¯‡è®ºæ–‡ï¼Œæ¥åæ€Rediså¯¹è™šæ‹Ÿå†…å­˜ï¼ˆVMï¼‰å­˜å‚¨æŠ€æœ¯çš„æ”¯æŒé—®é¢˜ã€‚ è‡³äºDISKSTOREæ–¹å¼ï¼Œæ˜¯ä»Redis Version 2.8ç‰ˆæœ¬å¼€å§‹æå‡ºçš„ä¸€ä¸ªå­˜å‚¨è®¾æƒ³ï¼Œåˆ°ç›®å‰ä¸ºæ­¢Rediså®˜æ–¹ä¹Ÿæ²¡æœ‰åœ¨ä»»ä½•stableç‰ˆæœ¬ä¸­æ˜ç¡®å»ºè®®ä½¿ç”¨è¿™ç”¨æ–¹å¼ã€‚åœ¨Version 3.2ç‰ˆæœ¬ä¸­åŒæ ·æ‰¾ä¸åˆ°å¯¹äºè¿™ç§å­˜å‚¨æ–¹å¼çš„æ˜ç¡®æ”¯æŒã€‚ä»ç½‘ç»œä¸Šèƒ½å¤Ÿæ”¶é›†åˆ°çš„å„ç§èµ„æ–™æ¥çœ‹ï¼ŒDISKSTOREæ–¹å¼å’ŒRDBæ–¹å¼è¿˜æœ‰ç€ä¸€äº›åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼Œä¸è¿‡å„ä½è¯»è€…ä¹ŸçŸ¥é“ï¼Œé™¤äº†å®˜æ–¹æ–‡æ¡£ä»¥å¤–ç½‘ç»œèµ„æ–™å¾ˆå¤šå°±æ˜¯å¤§æŠ„ã€‚ æœ€å…³é”®çš„æ˜¯ç›®å‰å®˜æ–¹æ–‡æ¡£ä¸Šèƒ½å¤Ÿçœ‹åˆ°çš„Rediså¯¹æŒä¹…åŒ–å­˜å‚¨çš„æ”¯æŒæ˜ç¡®çš„å°±åªæœ‰ä¸¤ç§æ–¹æ¡ˆï¼ˆ"),n("a",xp,[s("https://redis.io/topics/persistenceï¼‰ï¼šRDBå’ŒAOFã€‚"),e(a)])]),n("p",null,[s("å…·ä½“ä»‹ç»è§ï¼š"),n("a",_p,[s("https://www.pdai.tech/md/db/nosql-redis/db-redis-x-rdb-aof.html#redisæŒä¹…åŒ–ç®€ä»‹"),e(a)])]),Tp,n("p",null,[s("ç›¸å…³æ–‡ç« æ¨èï¼š"),n("a",Pp,[s("ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† - æ°´æ»´ä¸é“¶å¼¹"),e(a)])]),Lp,n("p",null,[s("æ›´æ–°ç¼“å­˜çš„çš„Design Patternæœ‰å››ç§ï¼šCache aside, Read through, Write through, Write behind caching; æˆ‘å¼ºçƒˆå»ºè®®ä½ çœ‹çœ‹è¿™ç¯‡ï¼Œå·¦è€³æœµè€—å­çš„æ–‡ç« ï¼š"),n("a",Rp,[s("ç¼“å­˜æ›´æ–°çš„å¥—è·¯"),e(a)])]),Ip,n("p",null,[s("è¿™æ˜¯æ ‡å‡†çš„design patternï¼ŒåŒ…æ‹¬Facebookçš„è®ºæ–‡ã€Š"),n("a",Ap,[s("Scaling Memcache at Facebook"),e(a)]),s("ã€‹ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªç­–ç•¥ã€‚ä¸ºä»€ä¹ˆä¸æ˜¯å†™å®Œæ•°æ®åº“åæ›´æ–°ç¼“å­˜ï¼Ÿä½ å¯ä»¥çœ‹ä¸€ä¸‹Quoraä¸Šçš„è¿™ä¸ªé—®ç­”ã€Š"),n("a",Np,[s("Why does Facebook use delete to remove the key-value pair in Memcached instead of updating the Memcached during write request to the backend?"),e(a)]),s("ã€‹ï¼Œä¸»è¦æ˜¯æ€•ä¸¤ä¸ªå¹¶å‘çš„å†™æ“ä½œå¯¼è‡´è„æ•°æ®ã€‚")]),Mp,n("p",null,[n("a",Ep,[s("é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£"),e(a)])]),n("p",null,[n("a",Op,[s("é«˜å¯ç”¨ï¼šå“¨å…µæœºåˆ¶ï¼ˆRedis Sentinelï¼‰è¯¦è§£"),e(a)])]),Bp,n("p",null,[s("å…·ä½“å¯ä»¥çœ‹ï¼š"),n("a",Dp,[s("https://www.pdai.tech/md/db/nosql-redis/db-redis-x-copy.html#redisè¿›é˜¶---é«˜å¯ç”¨ï¼šä¸»ä»å¤åˆ¶è¯¦è§£"),e(a)])]),zp,n("blockquote",null,[n("p",null,[s("æ¨èé˜…è¯»ï¼š"),n("a",qp,[s("æ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"),e(a)])])]),jp,n("p",null,[s("åŠ äº†ç´¢å¼•é¡µå¾ˆæ…¢ï¼Œå‚è€ƒï¼š"),n("a",Hp,[s("https://mp.weixin.qq.com/s/pJQwnNOwRKw1MvcDTOrjqQ"),e(a)])]),n("p",null,[s("æ²¡æœ‰ç´¢å¼•æ€ä¹ˆåŠï¼š"),n("a",Fp,[s("https://mp.weixin.qq.com/s/WnO_4SoEL6jugkxPHW4KCg"),e(a)])]),Jp,n("p",null,[s("å…³äº MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹guideå†™çš„è¿™ç¯‡æ–‡ç« ï¼š"),n("a",Up,[s("MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£"),e(a)]),s("ã€‚")]),Kp,n("ul",null,[n("li",null,[s("InnoDB å­˜å‚¨å¼•æ“è¯¦ç»†ä»‹ç»ï¼š"),n("a",Qp,[s("https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html"),e(a)]),s(" ã€‚")]),n("li",null,[s("å…¶ä»–å­˜å‚¨å¼•æ“è¯¦ç»†ä»‹ç»ï¼š"),n("a",Vp,[s("https://dev.mysql.com/doc/refman/8.0/en/storage-engines.html"),e(a)]),s(" ã€‚")])]),Gp,n("p",null,[s("å…·ä½“å‚è€ƒï¼š"),n("a",Xp,[s("https://developer.aliyun.com/article/761356"),e(a)])]),Wp,n("p",null,[n("a",Yp,[s("MySQLé«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®"),e(a)])]),Zp,n("blockquote",null,[n("p",null,[n("strong",null,[s("è¯¦ç»†ä»£ç è§æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š"),n("a",$p,[s("Kafkaç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼10 åˆ†é’Ÿå­¦ä¼šå¦‚ä½•åœ¨ Spring Boot ç¨‹åºä¸­ä½¿ç”¨ Kafka ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—?"),e(a)])])])]),no,n("p",null,[n("a",so,[s("146. LRU ç¼“å­˜"),e(a)])]),n("p",null,[n("a",ao,[s("BM100 è®¾è®¡LRUç¼“å­˜ç»“æ„"),e(a)])]),eo,n("p",null,[n("a",to,[s(" I/O å¤šè·¯å¤ç”¨ï¼šselect/poll/epoll"),e(a)])]),po,n("blockquote",null,[n("p",null,[s("ä¸‹é¢è¿™éƒ¨åˆ†æ€»ç»“å‚è€ƒäº†:"),n("a",oo,[s("ã€Šè¿›ç¨‹é—´é€šä¿¡ IPC (InterProcess Communication)ã€‹"),e(a)])])]),io,n("p",null,[s("ğŸ™‹ "),co,s(" ï¼šæˆ‘ä»¬ä¸€èˆ¬æŠŠè¿›ç¨‹å¤§è‡´åˆ†ä¸º 5 ç§çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹å’Œ"),n("a",lo,[s("çº¿ç¨‹"),e(a)])]),ro,s(" ### Linux é‡Œè¿›ç¨‹é€šä¿¡æœ‰å‡ ç§æ–¹å¼ï¼Ÿ "),uo,n("p",null,[s("Linux åŒæ—¶æ”¯æŒæ­£å¸¸å¤§å°çš„å†…å­˜é¡µå’Œå¤§å†…å­˜é¡µï¼ˆHuge Pageï¼‰"),n("a",ko,[s("1"),e(a)]),s("ï¼Œç»å¤§å¤šæ•°å¤„ç†å™¨ä¸Šçš„å†…å­˜é¡µçš„é»˜è®¤å¤§å°éƒ½æ˜¯ 4KBï¼Œè™½ç„¶éƒ¨åˆ†å¤„ç†å™¨ä¼šä½¿ç”¨ 8KBã€16KB æˆ–è€… 64KB ä½œä¸ºé»˜è®¤çš„é¡µé¢å¤§å°ï¼Œä½†æ˜¯ 4KB çš„é¡µé¢ä»ç„¶æ˜¯æ“ä½œç³»ç»Ÿé»˜è®¤å†…å­˜é¡µé…ç½®çš„ä¸»æµï¼›é™¤äº†æ­£å¸¸çš„å†…å­˜é¡µå¤§å°ä¹‹å¤–ï¼Œä¸åŒçš„å¤„ç†å™¨ä¸Šä¹ŸåŒ…å«ä¸åŒå¤§å°çš„å¤§é¡µé¢ï¼Œæˆ‘ä»¬åœ¨ x86 å¤„ç†å™¨ä¸Šå°±å¯ä»¥ä½¿ç”¨ 2MB çš„å†…å­˜é¡µã€‚")]),mo,go,vo,n("p",null,[s("è¯¦ç»†ï¼š"),n("a",bo,[s("https://segmentfault.com/a/1190000006879700"),e(a)])]),ho,n("ul",null,[n("li",null,[n("a",fo,[s("HTTP3"),e(a)])])]),yo,n("blockquote",null,[n("p",null,[s("å‚è€ƒèµ„æ–™ï¼š"),n("a",wo,[s("https://stackoverflow.com/questions/4201713/synchronization-vs-lockã€https://www.geeksforgeeks.org/lock-framework-vs-thread-synchronization-in-java/ã€https://www.baeldung.com/java-concurrent-locks"),e(a)])])]),Co,n("p",null,[s("è´Ÿè½½å‡è¡¡å±‚ï¼Œæ”¯æŒåˆ‡æ¢æœºæˆ¿ å†™æ•°æ®çš„æ—¶å€™ï¼Œä¸­é—´ä»¶ï¼ˆdb/redis/esï¼‰éƒ½è¦è¿›è¡ŒåŒå†™ã€‚ kafkaå®¹ç¾ï¼Œmirror maker: "),n("a",So,[s("https://cloud.tencent.com/developer/article/1358933"),e(a)])]),xo,_o,To,n("p",null,[n("a",Po,[s("https://mp.weixin.qq.com/s/hWCmnsa3rdtMFTE_BSyg2w"),e(a)])]),Lo,n("blockquote",null,[n("p",null,[s("å…¶ä½™å‚è€ƒï¼š"),n("a",Ro,[s("https://www.javatpoint.com/design-patterns-in-javaã€https://java-design-patterns.com/"),e(a)])])]),Io,n("ol",null,[n("li",null,[n("a",Ao,[s("https://github.com/Snailclimb/JavaGuide"),e(a)]),s(" ã€ŒJava å­¦ä¹ +é¢è¯•æŒ‡å—ã€ä¸€ä»½æ¶µç›–å¤§éƒ¨åˆ† Java ç¨‹åºå‘˜æ‰€éœ€è¦æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†ã€‚å‡†å¤‡ Java é¢è¯•ï¼Œé¦–é€‰ JavaGuideï¼")]),n("li",null,[n("a",No,[s("Java å…¨æ ˆçŸ¥è¯†ä½“ç³»"),e(a)])]),n("li",null,[n("a",Mo,[s("https://github.com/rbmonster/learning-note"),e(a)]),s(" java å¼€å‘ é¢è¯•å…«è‚¡æ–‡ï¼ˆä¸ªäººçš„é¢è¯•åŠå·¥ä½œæ€»ç»“ï¼‰")]),n("li",null,[n("a",Eo,[s("https://github.com/CoderLeixiaoshuai/java-eight-part"),e(a)]),s(" ã€Java å…«è‚¡æ–‡ã€Java é¢è¯•å¥—è·¯")]),n("li",null,[n("a",Oo,[s("https://github.com/doocs/advanced-java"),e(a)]),s(" äº’è”ç½‘ Java å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›²")]),n("li",null,[n("a",Bo,[s("https://www.iamshuaidi.com/"),e(a)]),s(" å¸…åœ°ç©ç¼–ç¨‹")]),n("li",null,[n("a",Do,[s("https://github.com/xiaolincoder/CS-Base"),e(a)]),s(" å°æ— x å›¾è§£è®¡ç®—æœºåŸºç¡€")]),n("li",null,[n("a",zo,[s("https://www.mianshiya.com/"),e(a)]),s(" é¢è¯•é¸­")]),qo])])}const Uo=o(Ge,[["render",jo],["__file","giant.html.vue"]]);export{Uo as default};
