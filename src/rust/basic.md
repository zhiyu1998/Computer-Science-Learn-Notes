---
order: 1
title: Rustè¯»ä¹¦ç¬”è®°-åŸºç¡€ç¯‡
category:
  - rust
---
# Rustè¯»ä¹¦ç¬”è®°-åŸºç¡€ç¯‡
![rest](https://github.com/sunface/rust-course/blob/main/assets/banner.jpg?raw=true)

æ„Ÿè°¢[Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/about-book.html)ï¼Œæ­£å¦‚ä¹¦ä¸­æ‰€è¯´åœ¨å­¦ä¹  Rust çš„åŒæ—¶ä½ ä¼šæ”¶è·å¾ˆå¤šè¯­è¨€ä¹‹å¤–çš„çŸ¥è¯†ï¼Œå› æ­¤ Rust åœ¨å…¥é—¨é˜¶æ®µæ¯”å¾ˆå¤šç¼–ç¨‹è¯­è¨€è¦æ›´éš¾ï¼Œä½†æ˜¯ä¸€æ—¦å…¥é—¨ï¼Œä½ å°†æ”¶è·ä¸€ä¸ªå…¨æ–°çš„è‡ªå·±ï¼Œæˆä¸ºä¸€ä¸ªæ›´åŠ ä¼˜ç§€çš„ç¨‹åºå‘˜ã€‚
> è¦å­¦å¥½ Rustï¼Œä½ éœ€è¦æ·±å…¥ç†è§£å†…å­˜ã€å †æ ˆã€å¼•ç”¨ã€å˜é‡ä½œç”¨åŸŸç­‰è¿™äº›å…¶å®ƒé«˜çº§è¯­è¨€å¾€å¾€ä¸ä¼šæ·±å…¥æ¥è§¦çš„å†…å®¹ã€‚å¦å¤–ï¼ŒRust ä¼šé€šè¿‡è¯­æ³•ã€ç¼–è¯‘å™¨å’Œ clippy è¿™äº›é™æ€æ£€æŸ¥å·¥å…·åŠå¸®åŠ©åŠå¼ºè¿«çš„è®©ä½ æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œå†™å‡ºæ›´å¥½çš„ä»£ç ã€‚åŒæ—¶ï¼Œå½“ä½ æŒæ¡ Rust åï¼Œå°±ä¼šè‡ªå‘æ€§çš„æƒ³è¦å»åšä¸€äº›æ›´ååº•å±‚çš„å¼€å‘ï¼Œè¿™äº›éƒ½å¯ä»¥å¸®åŠ©ä½ æ›´åŠ äº†è§£æ“ä½œç³»ç»Ÿã€ç½‘ç»œã€æ€§èƒ½ä¼˜åŒ–ç­‰åº•å±‚çŸ¥è¯†ï¼Œä¹Ÿä¼šé—´æ¥æˆ–è€…ç›´æ¥çš„æ¥è§¦åˆ°å„ç§ç®—æ³•å’Œæ•°æ®ç»“æ„çš„å®ç°ã€‚

ğŸ”¥ç¬”è®°ç‰¹è‰²ï¼šå»ºè®®ç»“åˆ[Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/about-book.html)ä¸€èµ·è§‚çœ‹ï¼Œå› ä¸ºéƒ¨åˆ†å†…å®¹æ¶‰åŠä¸ªäººæ€è€ƒå’Œä»£ç è¸©å‘ï¼Œå¯ä»¥åŠ©åŠ›å­¦ä¹ ï¼
- è¯¥ç¬”è®°ä½¿ç”¨çš„Rustç‰ˆæœ¬ä¸ºï¼š`1.62`

ğŸ”¥å…¶ä»–æ¨èï¼š
- [é€šè¿‡ä¾‹å­å­¦ Rust](https://rustwiki.org/zh-CN/rust-by-example/)
- [Rust ç¨‹åºè®¾è®¡è¯­è¨€](https://www.rustwiki.org.cn/zh-CN/book/)
- [Rust å®˜æ–¹æ–‡æ¡£ä¸­æ–‡æ•™ç¨‹](https://www.rustwiki.org.cn/)
- [APIæŸ¥è¯¢](https://www.rustwiki.org.cn/zh-CN/std/)
- [Rustè¯­è¨€ä¸­æ–‡ç¤¾åŒº](https://rustcc.cn/)


##  ğŸ¥³ å®‰è£…rust
å®‰è£…æ—¥æœŸï¼š2023-05-03
* [å­—èŠ‚ä»£ç†](https://rsproxy.cn/)


### Mac
```sh
brew install rust

cargo -V
```

### Win
è¿‡ç¨‹æœ‰ç‚¹éº»çƒ¦è¿˜è¦è£…VSï¼Œå°±ç›´æ¥åœ¨Macä¸Šæ•²äº†

> https://rustup.rs/

### ğŸ˜æ¨è åœ¨çº¿ç»ƒä¹ 
[ç‚¹å‡»è¿›å…¥PlayGround](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021)
[Windowsçš„å¤‡ç”¨æ–¹æ¡ˆ](https://lightly.teamcode.com/rust/) æ— éœ€ä¸‹è½½Rustå¼€å‘ç¯å¢ƒï¼Œå¯ç›´æ¥åœ¨çº¿ç¼–å†™ä»£ç ï¼Œä¸æ˜¯æ‰“å¹¿å‘Šï¼Œæ„Ÿè§‰è¿˜æŒºæ–¹ä¾¿çš„

##  1.1 ğŸ¤ª Hello Rust
1. è¿™æ˜¯æœ€ç®€å•çš„å†™æ³•ï¼š
```rust
fn main() {
    println!("Hello, world!");
}
```

2. ç¨å¾®è¿›é˜¶ä¸€ç‚¹éœ€è¦äº†è§£ä¸€ç‚¹çŸ¥è¯†ï¼š
- `.iter()`  Rust çš„é›†åˆç±»å‹ä¸èƒ½ç›´æ¥è¿›è¡Œå¾ªç¯ï¼Œéœ€è¦å˜æˆè¿­ä»£å™¨ï¼ˆè¿™é‡Œæ˜¯é€šè¿‡ .iter() æ–¹æ³•ï¼‰ï¼Œæ‰èƒ½ç”¨äºè¿­ä»£å¾ªç¯
- `"{}"` è¾“å‡ºå ä½ç¬¦ï¼Œç±»ä¼¼äºå…¶å®ƒè¯­è¨€æƒ¯ç”¨çš„ %sã€%d 
- `&`  println! å®éœ€è¦ä¸€ä¸ªå¼•ç”¨ä½œä¸ºå‚æ•°ï¼Œå› ä¸º Rust çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—èŠ‚çš„ UTF-8 ç¼–ç çš„å‘é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦æ•°ç»„ã€‚å› æ­¤ï¼Œæ‰“å°ä¸€ä¸ªå­—ç¬¦ä¸²éœ€è¦å°†å®ƒçš„å¼•ç”¨ä¼ é€’ç»™ println! å®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…å°†æ•´ä¸ªå­—ç¬¦ä¸²å¤åˆ¶åˆ°å †æ ˆä¸Šï¼Œè€Œæ˜¯ä½¿ç”¨æŒ‡å‘åŸå§‹æ•°æ®çš„å¼•ç”¨æ¥è¿›è¡Œå¤„ç†ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œå¹¶ä¸”ä¸ Java ä¸­çš„å­—ç¬¦ä¸²å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒã€‚
- `println!` åœ¨ Rust ä¸­ï¼Œè¿™æ˜¯ å® æ“ä½œç¬¦ï¼Œä½ ç›®å‰å¯ä»¥è®¤ä¸ºå®æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹å‡½æ•°
	- `println!` æ˜¯ä¸€ä¸ª Rust æ ‡å‡†åº“æä¾›çš„å®ï¼Œç”¨äºåœ¨æ§åˆ¶å°è¾“å‡ºæ–‡æœ¬ã€‚åœ¨è¿™é‡Œ "!" è¡¨ç¤ºå®å®šä¹‰çš„å¼€å§‹ï¼Œç„¶ååé¢çš„å†…å®¹æ˜¯å®å‚æ•°ã€‚
```rust
fn greet_world() {
    let southern_germany = "GrÃ¼ÃŸ Gott!";
    let chinese = "ä¸–ç•Œï¼Œä½ å¥½";
    let english = "World, hello";
    let regions = [southern_germany, chinese, english];
    for region in regions.iter() {
        println!("{}", &region);
    }
}
fn main() {
	
}
```

3. å†ç¨å¾®è¿›é˜¶ä¸€ç‚¹ï¼ˆè¿™ä¸ªä¾‹å­ä¹Ÿæ¥è‡ªRuståœ£ç»ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰è¿™ä¸ªä¾‹å­æœ‰ç‚¹åŠé€€ï¼‰ï¼Œéœ€è¦äº†è§£ä¸‹é¢çš„çŸ¥è¯†æ‰èƒ½ç†è§£ï¼š
* `let` åœ¨ Rust ä¸­ï¼Œå¸¸é‡å’Œå˜é‡çš„å®šä¹‰æ˜¯é€šè¿‡ let å…³é”®å­—æ¥è¿›è¡Œçš„ï¼Œåé¢ä¼šè¯´å˜é‡å¦‚ä½•å®šä¹‰
* `lines`ã€`enumerate`ç­‰éƒ½å¯ä»¥é€šè¿‡å…¶ä»–è¯­è¨€ç›´è§‚ç†è§£
* å¯èƒ½é‡åˆ°é—®é¢˜çš„æ˜¯è¿™ä¸ª`if let Ok(length) = fields[1].parse::<f32>()`
	* `parse` æ–¹æ³•çš„ä½œç”¨ç±»ä¼¼äº Java ä¸­çš„ parseInt æ–¹æ³•ï¼Œéƒ½æ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºæ•°å­—
	* `fields[1].parse::<f32>()` å°†ç¬¬äºŒä¸ªå…ƒç´ è§£æä¸ºä¸€ä¸ª f32 ç±»å‹çš„æµ®ç‚¹æ•°ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œè¿”å›ä¸€ä¸ª `Result<f32, ParseFloatError>` ç±»å‹çš„ Ok æšä¸¾å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ª Err(ParseFloatError) ç±»å‹çš„é”™è¯¯å€¼ã€‚

**parse**
å…¶ä¸­ï¼Œself æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å¼•ç”¨ï¼ŒF æ˜¯è¦è§£ææˆçš„æ•°æ®ç±»å‹ã€‚parse æ–¹æ³•è¿”å›ä¸€ä¸ª Result<F, ParseError> ç±»å‹çš„æšä¸¾å€¼ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œè¿”å›ä¸€ä¸ª Ok(F) æšä¸¾å€¼ï¼Œå…¶ä¸­åŒ…å«è§£æå¾—åˆ°çš„æ•°æ®ï¼›å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›ä¸€ä¸ª Err(ParseError) æšä¸¾å€¼ï¼Œå…¶ä¸­åŒ…å«è§£æå¤±è´¥çš„åŸå› ã€‚
```rust
pub fn parse<F>(&self) -> Result<F, ParseError>
    where F: FromStr
```

ç¤ºä¾‹ä»£ç ï¼š
```rust
fn main() {
   let penguin_data = "\
   common name,length (cm)
   Little penguin,33
   Yellow-eyed penguin,65
   Fiordland penguin,60
   Invalid,data
   ";

   let records = penguin_data.lines();

   for (i, record) in records.enumerate() {
     if i == 0 || record.trim().len() == 0 {
       continue;
     }

     // å£°æ˜ä¸€ä¸ª fields å˜é‡ï¼Œç±»å‹æ˜¯ Vec
     // Vec æ˜¯ vector çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„é›†åˆç±»å‹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„
     // <_>è¡¨ç¤º Vec ä¸­çš„å…ƒç´ ç±»å‹ç”±ç¼–è¯‘å™¨è‡ªè¡Œæ¨æ–­ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œéƒ½ä¼šå¸®æˆ‘ä»¬çœå´ä¸å°‘åŠŸå¤«
     let fields: Vec<_> = record
       .split(',')
       .map(|field| field.trim())
       .collect();
     if cfg!(debug_assertions) {
         // è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡º
       eprintln!("debug: {:?} -> {:?}",
              record, fields);
     }

     let name = fields[0];
     // 1. å°è¯•æŠŠ fields[1] çš„å€¼è½¬æ¢ä¸º f32 ç±»å‹çš„æµ®ç‚¹æ•°ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™æŠŠ f32 å€¼èµ‹ç»™ length å˜é‡
     //
     // 2. if let æ˜¯ä¸€ä¸ªåŒ¹é…è¡¨è¾¾å¼ï¼Œç”¨æ¥ä»=å³è¾¹çš„ç»“æœä¸­ï¼ŒåŒ¹é…å‡º length çš„å€¼ï¼š
     //   1ï¼‰å½“=å³è¾¹çš„è¡¨è¾¾å¼æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ª Ok(f32) çš„ç±»å‹ï¼Œè‹¥å¤±è´¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ª Err(e) ç±»å‹ï¼Œif let çš„ä½œç”¨å°±æ˜¯ä»…åŒ¹é… Ok ä¹Ÿå°±æ˜¯æˆåŠŸçš„æƒ…å†µï¼Œå¦‚æœæ˜¯é”™è¯¯ï¼Œå°±ç›´æ¥å¿½ç•¥
     //   2ï¼‰åŒæ—¶ if let è¿˜ä¼šåšä¸€æ¬¡è§£æ„åŒ¹é…ï¼Œé€šè¿‡ Ok(length) å»åŒ¹é…å³è¾¹çš„ Ok(f32)ï¼Œæœ€ç»ˆæŠŠç›¸åº”çš„ f32 å€¼èµ‹ç»™ length
     //
     // 3. å½“ç„¶ä½ ä¹Ÿå¯ä»¥å¿½ç•¥æˆåŠŸçš„æƒ…å†µï¼Œç”¨ if let Err(e) = fields[1].parse::<f32>() {...}åŒ¹é…å‡ºé”™è¯¯ï¼Œç„¶åæ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯æ²¡å•¥åµç”¨
     if let Ok(length) = fields[1].parse::<f32>() {
         // è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
         println!("{}, {}cm", name, length);
     }
   }
 }
```

## 1.2 ğŸ‘€ å˜é‡

### ğŸ˜‰å¸¸è§„å®šä¹‰
å†™ä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯ç”¨letå®šä¹‰
```rust
fn main() {
    let x = 6;
    println!("The value of x is: {}", x);
    x = 1008611; // è¿™é‡Œæ˜¯é”™è¯¯çš„
    println!("The value of x is: {}", x);
}
// é”™è¯¯ï¼šcannot assign twice to immutable variable `x`
```
å¦‚æœè¦è®©å®ƒæˆä¸ºå˜é‡ï¼Œéœ€è¦åŠ å…¥`mut`
```rust
fn main() {
    let mut x = 6;
    println!("The value of x is: {}", x);
    x = 1008611; // è¿™é‡Œæ˜¯é”™è¯¯çš„
    println!("The value of x is: {}", x);
}
```
åœ¨rustä¸­å¸¸é‡ä½¿ç”¨`const`æ¥å®šä¹‰ï¼š
> const MAX_POINTS: u32 = 100_000;

å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œrustä¸ºä»€ä¹ˆæ—¢ç„¶å¸¸é‡ç”¨constå®šä¹‰ï¼Œå˜é‡è¦ç”¨letå®šä¹‰ä¸ºä»€ä¹ˆè¦åŠ å…¥mutï¼Ÿ
> 1. ä½¿ç”¨ let å£°æ˜çš„å˜é‡æ˜¯å¯å˜çš„ï¼Œè€Œä½¿ç”¨ const å£°æ˜çš„å¸¸é‡æ˜¯ä¸å¯å˜çš„ã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ let å£°æ˜çš„å˜é‡å¯ä»¥åœ¨ç¨‹åºä¸­ä¿®æ”¹å®ƒä»¬çš„å€¼ï¼Œè€Œä½¿ç”¨ const å£°æ˜çš„å¸¸é‡ä¸€æ—¦è¢«å®šä¹‰ï¼Œå°±ä¸èƒ½å†ä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚åœ¨ Rust ä¸­ï¼Œä¸ºäº†æé«˜ä»£ç çš„å¯é æ€§å’Œå®‰å…¨æ€§ï¼Œæ¨èå°½å¯èƒ½ä½¿ç”¨å¸¸é‡è€Œä¸æ˜¯å˜é‡
> 2. ç±»å‹æ³¨è§£ï¼šä½¿ç”¨ let å£°æ˜å˜é‡æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦æ˜¾å¼æŒ‡å®šå˜é‡çš„ç±»å‹ï¼Œå› ä¸º Rust ç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å˜é‡çš„å€¼æ¨æ–­å‡ºå˜é‡çš„ç±»å‹ã€‚è€Œä½¿ç”¨ const å£°æ˜å¸¸é‡æ—¶ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šå¸¸é‡çš„ç±»å‹ï¼Œå› ä¸º Rust ç¼–è¯‘å™¨ä¸èƒ½æ ¹æ®å¸¸é‡çš„å€¼æ¨æ–­å‡ºå¸¸é‡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼šlet x = 10;    const Y: i32 = 20;
> 3. å£°æ˜ä½ç½®ï¼šä½¿ç”¨ let å£°æ˜å˜é‡æ—¶ï¼Œå¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå†…è¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å‡½æ•°å†…éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸã€‚è€Œä½¿ç”¨ const å£°æ˜å¸¸é‡æ—¶ï¼Œåªèƒ½åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿›è¡Œå£°æ˜ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Rust ä¸­ï¼Œå¸¸é‡çš„å€¼å¿…é¡»åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¸‹æ¥ï¼Œè€Œå˜é‡çš„å€¼å¯ä»¥åœ¨è¿è¡Œæ—¶ç¡®å®šã€‚

### â›”ä¸è¦è­¦å‘Šæˆ‘
å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªå˜é‡å´ä¸åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒï¼ŒRust é€šå¸¸ä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿`_`è¡¨ç¤º`Rust ä¸è¦è­¦å‘Šæœªä½¿ç”¨çš„å˜é‡`
```rust
fn main() {
    let mut x = 6;
}
// warning: unused variable: `x`
```
âœ”ï¸æ­£ç¡®å†™æ³•ï¼Œæˆ‘ä¸ç¦æ„Ÿå¹ï¼Œè¿™ä¹ŸTTMDå®‰å…¨äº†ï¼š
```rust
fn main() {
    let mut _x = 6;
}
```
åœ¨ä¸€æ¬¡å®éªŒä¸­æˆ‘æœªä½¿ç”¨`mut`ï¼Œéƒ½å¯ä»¥æç¤ºäº†`warning: variable does not need to be mutable`
```rust
fn main() {
    let (a, mut b): (bool, bool) = (true, false);
    println!("a = {:?}, b = {:?}", a, b);
}
```

### å˜é‡çš„è§£æ„
è¿™é‡Œå¯èƒ½æœ‰ç–‘é—®çš„ç‚¹æ˜¯`{:?}`ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨`{}`
> {:?} å ä½ç¬¦ä¼šä½¿ç”¨ Debug trait æ¥æ ¼å¼åŒ–è¾“å‡ºå˜é‡çš„å€¼ã€‚Debug trait æ˜¯ Rust ä¸­çš„ä¸€ä¸ªç‰¹æ®Š traitï¼Œç”¨äºå®šä¹‰æ ¼å¼åŒ–è¾“å‡ºè°ƒè¯•ä¿¡æ¯çš„æ–¹æ³•ã€‚è®¸å¤šå†…ç½®ç±»å‹å’Œæ ‡å‡†åº“ä¸­çš„ç±»å‹éƒ½å®ç°äº† Debug traitï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä½¿ç”¨ {:?} å ä½ç¬¦æ—¶ç›´æ¥è¾“å‡ºè¿™äº›ç±»å‹çš„å€¼ã€‚{:?} å ä½ç¬¦è¾“å‡ºçš„å€¼é€šå¸¸åŒ…å«äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç±»å‹ä¿¡æ¯ã€ç»“æ„ä½“å­—æ®µåç­‰ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºè°ƒè¯•ä»£ç éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œç”±äºè¾“å‡ºçš„ä¿¡æ¯å¯èƒ½æ¯”è¾ƒå†—é•¿ï¼Œå› æ­¤åœ¨æ­£å¼çš„è¾“å‡ºä¸­å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–çš„å ä½ç¬¦ã€‚

è¿˜æœ‰ä¸€ä¸ªå‡½æ•°`assert_eq`ï¼šæ–­è¨€ä¸¤ä¸ªè¡¨è¾¾å¼å½¼æ­¤ç›¸ç­‰ã€‚å¦‚æœæ¯”è¾ƒç»“æœä¸ç›¸ç­‰ï¼Œassert_eq! å®ä¼šè§¦å‘ä¸€ä¸ª panicï¼Œå¯¼è‡´ç¨‹åºç»ˆæ­¢ã€‚
> assert_eq! å®æ˜¯ Rust ä¸­çš„ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½ä»£ç ä¸­çš„é”™è¯¯ï¼Œå¹¶æé«˜ä»£ç çš„å¯é æ€§ã€‚

```rust
macro_rules! assert_eq {
    ($left : expr, $right : expr $(,) ?) => { ... };
    ($left : expr, $right : expr, $($arg : tt) +) => { ... };
}
```
ä¾‹å­ï¼š
```rust
let a = 3;
let b = 1 + 2;
assert_eq!(a, b);

assert_eq!(a, b, "we are testing addition with {} and {}", a, b);
```

æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†å°±å¯ä»¥å­¦ä¹ è¿™æ®µç¤ºä¾‹äº†ï¼Œéå¸¸ç±»ä¼¼JavaScriptçš„è¯­æ³•ï¼š
```rust
fn main() {
    let (a, mut b): (bool, bool) = (true, false);
    println!("a = {:?}, b = {:?}", a, b);
    b = true;
    assert_eq!(a, b);
}
```

### è§£æ„å¼èµ‹å€¼
åœ¨ Rust 1.59 ç‰ˆæœ¬åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨èµ‹å€¼è¯­å¥çš„å·¦å¼ä¸­ä½¿ç”¨å…ƒç»„ã€åˆ‡ç‰‡å’Œç»“æ„ä½“æ¨¡å¼äº†ã€‚
* è¿™é‡Œçš„ `..` è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œå³åŒ¹é…æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  cï¼Œå’Œæœ€åä¸€ä¸ªå…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´  d
* å°†` Struct { e: 5 }` è§£æ„ä¸ºå˜é‡ eã€‚è¿™é‡Œä½¿ç”¨äº†ç»“æ„ä½“è§£æ„è¯­æ³•ï¼Œ`{ e, .. }` è¡¨ç¤ºåªè§£æ„ç»“æ„ä½“ä¸­çš„å­—æ®µ eï¼Œè€Œå…¶ä»–å­—æ®µéƒ½ä¸å…³å¿ƒã€‚
```rust
fn main() {
    let (a, b, c, d);
    (a, b) = (1, 2);
    // println!("a {:?}, b {:?}, c {:?}, d {:?}, e {:?}", a, b, c, d, e);
    println!("a {:?}, b {:?}", a, b);
    [c, .., d, _] = [1, 2, 3, 4, 5];
    println!("a {:?}, b {:?}, c {:?}, d {:?}", a, b, c, d);
    // æœ€åè¾“å…¥ï¼ša 1, b 2
	// a 1, b 2, c 1, d 4
}
```

### å˜é‡é®è”½
Rust å…è®¸å£°æ˜ç›¸åŒçš„å˜é‡åï¼Œåœ¨åé¢å£°æ˜çš„å˜é‡ä¼šé®è”½æ‰å‰é¢å£°æ˜çš„
> è¿™å’Œ mut å˜é‡çš„ä½¿ç”¨æ˜¯ä¸åŒçš„ï¼Œç¬¬äºŒä¸ª let ç”Ÿæˆäº†å®Œå…¨ä¸åŒçš„æ–°å˜é‡ï¼Œä¸¤ä¸ªå˜é‡åªæ˜¯æ°å¥½æ‹¥æœ‰åŒæ ·çš„åç§°ï¼Œæ¶‰åŠä¸€æ¬¡å†…å­˜å¯¹è±¡çš„å†åˆ†é… ï¼Œè€Œ mut å£°æ˜çš„å˜é‡ï¼Œå¯ä»¥ä¿®æ”¹åŒä¸€ä¸ªå†…å­˜åœ°å€ä¸Šçš„å€¼ï¼Œå¹¶ä¸ä¼šå‘ç”Ÿå†…å­˜å¯¹è±¡çš„å†åˆ†é…ï¼Œæ€§èƒ½è¦æ›´å¥½ã€‚å˜é‡é®è”½çš„ç”¨å¤„åœ¨äºï¼Œå¦‚æœä½ åœ¨æŸä¸ªä½œç”¨åŸŸå†…æ— éœ€å†ä½¿ç”¨ä¹‹å‰çš„å˜é‡ï¼ˆåœ¨è¢«é®è”½åï¼Œæ— æ³•å†è®¿é—®åˆ°ä¹‹å‰çš„åŒåå˜é‡ï¼‰ï¼Œå°±å¯ä»¥é‡å¤çš„ä½¿ç”¨å˜é‡åå­—ï¼Œè€Œä¸ç”¨ç»å°½è„‘æ±å»æƒ³æ›´å¤šçš„åå­—ã€‚

è¿™ä¸ªå°±æœ‰ç‚¹åƒPythonäº†ï¼Œåœ¨æ·±åº¦å­¦ä¹ æˆ–è€…å…¶ä»–é¢†åŸŸï¼Œå˜é‡åˆå¤šåˆæ‡’å¾—èµ·åå­—ï¼Œç›´æ¥å°±ä½¿ç”¨ä¸Šä¸€ä¸ªè¦†ç›–ï¼š
```rust
fn main() {
    let spaces = "   ";
    // usizeæ•°å€¼ç±»å‹
    let spaces = spaces.len();
    println!("{}", spaces);
    // 3
}
```

ä½†æ˜¯å¦‚æœä¸ä½¿ç”¨å˜é‡é®è”½ï¼Œä¸‹é¢çš„æƒ…å†µå°±æ˜¯é”™è¯¯çš„ï¼š
```rust
// error[E0308]: mismatched types
let mut spaces = "   ";
spaces = spaces.len();
```


## 1.3 ğŸš— æ‰€æœ‰æƒ & ğŸšŒ å€Ÿç”¨
è¿™éƒ¨åˆ†æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œå’Œä¹‹å‰å­¦è¿‡çš„Javaè™šæ‹Ÿæœºå®Œå…¨ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™ç« æ ¸å¿ƒçš„å†…å®¹è¦æ˜¯æˆ‘å†æ·»æ²¹åŠ é†‹é‚£ä¹ˆå¯èƒ½ä¼šå¸¦åã€‚æœ¬ç« å†…å®¹ååˆ†é‡è¦ï¼Œå€Ÿç”¨ä½œè€…çš„ä¸€å¥è¯æ˜¯`ç”±äºæ‰€æœ‰æƒæ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå› æ­¤è¯»è€…éœ€è¦èŠ±è´¹ä¸€äº›æ—¶é—´æ¥æŒæ¡å®ƒï¼Œä¸€æ—¦æŒæ¡ï¼Œæµ·é˜”å¤©ç©ºä»»ä½ é£è·ƒ`ã€‚æ‰€ä»¥æˆ‘[æ¬è¿](https://course.rs/basic/ownership/ownership.html)è€Œæ¥è¿™å—çš„å†…å®¹ï¼Œæ–¹ä¾¿åé¢ç›´æ¥çœ‹ã€‚

æœ¬ç« çš„æ‰€æœ‰å†…å®¹éƒ½æ¥è‡ªï¼š[Rustè¯­è¨€åœ£ç»(Rust Course)](https://course.rs/basic/ownership/ownership.html)ã€‚è¿™ç« ä½œè€…å†™çš„é¬¼æ–§ç¥å·¥ï¼Œå‡ºç¥å…¥åŒ–ï¼Œæˆ‘åªèƒ½è¿™æ ·è¯´äº†ã€‚

### 1.3.1ğŸš— æ‰€æœ‰æƒ
æ‰€æœ‰çš„ç¨‹åºéƒ½å¿…é¡»å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œå¦‚ä½•ä»å†…å­˜ä¸­ç”³è¯·ç©ºé—´æ¥å­˜æ”¾ç¨‹åºçš„è¿è¡Œå†…å®¹ï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦çš„æ—¶å€™é‡Šæ”¾è¿™äº›ç©ºé—´ï¼Œæˆäº†é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„éš¾ç‚¹ä¹‹ä¸€ã€‚åœ¨è®¡ç®—æœºè¯­è¨€ä¸æ–­æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†ä¸‰ç§æµæ´¾ï¼š

åƒåœ¾å›æ”¶æœºåˆ¶(GC)ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šJavaã€Go
æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾, åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šC++
é€šè¿‡æ‰€æœ‰æƒæ¥ç®¡ç†å†…å­˜ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—è§„åˆ™è¿›è¡Œæ£€æŸ¥
å…¶ä¸­ Rust é€‰æ‹©äº†ç¬¬ä¸‰ç§ï¼Œæœ€å¦™çš„æ˜¯ï¼Œè¿™ç§æ£€æŸ¥åªå‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œå› æ­¤å¯¹äºç¨‹åºè¿è¡ŒæœŸï¼Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚

#### ä¸€æ®µä¸å®‰å…¨çš„ä»£ç 
å…ˆæ¥çœ‹çœ‹ä¸€æ®µæ¥è‡ª C è¯­è¨€çš„ç³Ÿç³•ä»£ç ï¼š

```c
int* foo() {
    int a;          // å˜é‡açš„ä½œç”¨åŸŸå¼€å§‹
    a = 100;
    char *c = "xyz";   // å˜é‡cçš„ä½œç”¨åŸŸå¼€å§‹
    return &a;
}                   // å˜é‡aå’Œcçš„ä½œç”¨åŸŸç»“æŸ
```
è¿™æ®µä»£ç è™½ç„¶å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯å…¶å®éå¸¸ç³Ÿç³•ï¼Œå˜é‡ a å’Œ c éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œå‡½æ•°ç»“æŸåå°†å±€éƒ¨å˜é‡ a çš„åœ°å€è¿”å›ï¼Œä½†å±€éƒ¨å˜é‡ a å­˜åœ¨æ ˆä¸­ï¼Œåœ¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œa æ‰€ç”³è¯·çš„æ ˆä¸Šå†…å­˜éƒ½ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œä»è€Œé€ æˆäº† æ‚¬ç©ºæŒ‡é’ˆ(Dangling Pointer) çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„å†…å­˜å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯è¿è¡Œçš„æ—¶å€™ä¼šå‡ºç°é”™è¯¯, å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å­˜åœ¨ã€‚

å†æ¥çœ‹å˜é‡ cï¼Œc çš„å€¼æ˜¯å¸¸é‡å­—ç¬¦ä¸²ï¼Œå­˜å‚¨äºå¸¸é‡åŒºï¼Œå¯èƒ½è¿™ä¸ªå‡½æ•°æˆ‘ä»¬åªè°ƒç”¨äº†ä¸€æ¬¡ï¼Œä¹Ÿå¯èƒ½æˆ‘ä»¬ä¸å†ä¼šä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œä½† "xyz" åªæœ‰å½“æ•´ä¸ªç¨‹åºç»“æŸåç³»ç»Ÿæ‰èƒ½å›æ”¶è¿™ç‰‡å†…å­˜ã€‚

æ‰€ä»¥å†…å­˜å®‰å…¨é—®é¢˜ï¼Œä¸€ç›´éƒ½æ˜¯ç¨‹åºå‘˜éå¸¸å¤´ç–¼çš„é—®é¢˜ï¼Œå¥½åœ¨, åœ¨ Rust ä¸­è¿™äº›é—®é¢˜å³å°†æˆä¸ºå†å²ï¼Œå› ä¸º Rust åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç°å†…å­˜ä¸å®‰å…¨çš„é—®é¢˜ï¼Œé‚£ Rust å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ

#### é¢„çƒ­çŸ¥è¯†: æ ˆ(Stack)ä¸å †(Heap)
æ ˆå’Œå †æ˜¯ç¼–ç¨‹è¯­è¨€æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œä½ å¹¶ä¸éœ€è¦æ·±å…¥äº†è§£æ ˆä¸å †ã€‚ ä½†å¯¹äº Rust è¿™æ ·çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå€¼æ˜¯ä½äºæ ˆä¸Šè¿˜æ˜¯å †ä¸Šéå¸¸é‡è¦, å› ä¸ºè¿™ä¼šå½±å“ç¨‹åºçš„è¡Œä¸ºå’Œæ€§èƒ½ã€‚

æ ˆå’Œå †çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯ä¸ºç¨‹åºåœ¨è¿è¡Œæ—¶æä¾›å¯ä¾›ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚

**æ ˆ**
æ ˆæŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œåè¿›å…ˆå‡ºã€‚æƒ³è±¡ä¸€ä¸‹ä¸€å ç›˜å­ï¼šå½“å¢åŠ æ›´å¤šç›˜å­æ—¶ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨ç›˜å­å †çš„é¡¶éƒ¨ï¼Œå½“éœ€è¦ç›˜å­æ—¶ï¼Œå†ä»é¡¶éƒ¨æ‹¿èµ°ã€‚ä¸èƒ½ä»ä¸­é—´ä¹Ÿä¸èƒ½ä»åº•éƒ¨å¢åŠ æˆ–æ‹¿èµ°ç›˜å­ï¼

å¢åŠ æ•°æ®å«åšè¿›æ ˆï¼Œç§»å‡ºæ•°æ®åˆ™å«åšå‡ºæ ˆã€‚

å› ä¸ºä¸Šè¿°çš„å®ç°æ–¹å¼ï¼Œæ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå‡è®¾æ•°æ®å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆåœ¨å–å‡ºæ•°æ®æ—¶ï¼Œä½ å°†æ— æ³•å–åˆ°ä½ æƒ³è¦çš„æ•°æ®ã€‚

**å †**
ä¸æ ˆä¸åŒï¼Œå¯¹äºå¤§å°æœªçŸ¥æˆ–è€…å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå­˜å‚¨åœ¨å †ä¸Šã€‚

å½“å‘å †ä¸Šæ”¾å…¥æ•°æ®æ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„æŒ‡é’ˆ, è¯¥è¿‡ç¨‹è¢«ç§°ä¸ºåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€(allocating)ã€‚

æ¥ç€ï¼Œè¯¥æŒ‡é’ˆä¼šè¢«æ¨å…¥æ ˆä¸­ï¼Œå› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œåœ¨åç»­ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å°†é€šè¿‡æ ˆä¸­çš„æŒ‡é’ˆï¼Œæ¥è·å–æ•°æ®åœ¨å †ä¸Šçš„å®é™…å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®è¯¥æ•°æ®ã€‚

ç”±ä¸Šå¯çŸ¥ï¼Œå †æ˜¯ä¸€ç§ç¼ºä¹ç»„ç»‡çš„æ•°æ®ç»“æ„ã€‚æƒ³è±¡ä¸€ä¸‹å»é¤é¦†å°±åº§åƒé¥­: è¿›å…¥é¤é¦†ï¼Œå‘ŠçŸ¥æœåŠ¡å‘˜æœ‰å‡ ä¸ªäººï¼Œç„¶åæœåŠ¡å‘˜æ‰¾åˆ°ä¸€ä¸ªå¤Ÿå¤§çš„ç©ºæ¡Œå­ï¼ˆå †ä¸Šåˆ†é…çš„å†…å­˜ç©ºé—´ï¼‰å¹¶é¢†ä½ ä»¬è¿‡å»ã€‚å¦‚æœæœ‰äººæ¥è¿Ÿäº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¡Œå·ï¼ˆæ ˆä¸Šçš„æŒ‡é’ˆï¼‰æ¥æ‰¾åˆ°ä½ ä»¬ååœ¨å“ªã€‚

**æ€§èƒ½åŒºåˆ«**
å†™å…¥æ–¹é¢ï¼šå…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºå…¥æ ˆæ—¶æ“ä½œç³»ç»Ÿæ— éœ€åˆ†é…æ–°çš„ç©ºé—´ï¼Œåªéœ€è¦å°†æ–°æ•°æ®æ”¾å…¥æ ˆé¡¶å³å¯ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚

è¯»å–æ–¹é¢ï¼šå¾—ç›Šäº CPU é«˜é€Ÿç¼“å­˜ï¼Œä½¿å¾—å¤„ç†å™¨å¯ä»¥å‡å°‘å¯¹å†…å­˜çš„è®¿é—®ï¼Œé«˜é€Ÿç¼“å­˜å’Œå†…å­˜çš„è®¿é—®é€Ÿåº¦å·®å¼‚åœ¨ 10 å€ä»¥ä¸Šï¼æ ˆæ•°æ®å¾€å¾€å¯ä»¥ç›´æ¥å­˜å‚¨åœ¨ CPU é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè€Œå †æ•°æ®åªèƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»å…ˆè®¿é—®æ ˆå†é€šè¿‡æ ˆä¸Šçš„æŒ‡é’ˆæ¥è®¿é—®å†…å­˜ã€‚

å› æ­¤ï¼Œå¤„ç†å™¨å¤„ç†åˆ†é…åœ¨æ ˆä¸Šæ•°æ®ä¼šæ¯”åœ¨å †ä¸Šçš„æ•°æ®æ›´åŠ é«˜æ•ˆã€‚

**æ‰€æœ‰æƒä¸å †æ ˆ**
å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆå’Œå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ä¾æ¬¡è¢«å‹å…¥æ ˆä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œè¿™äº›å€¼å°†è¢«ä»æ ˆä¸­æŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡ç§»é™¤ã€‚

å› ä¸ºå †ä¸Šçš„æ•°æ®ç¼ºä¹ç»„ç»‡ï¼Œå› æ­¤è·Ÿè¸ªè¿™äº›æ•°æ®ä½•æ—¶åˆ†é…å’Œé‡Šæ”¾æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™å †ä¸Šçš„æ•°æ®å°†äº§ç”Ÿå†…å­˜æ³„æ¼ â€”â€” è¿™äº›æ•°æ®å°†æ°¸è¿œæ— æ³•è¢«å›æ”¶ã€‚è¿™å°±æ˜¯ Rust æ‰€æœ‰æƒç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å¼ºå¤§ä¿éšœã€‚

å¯¹äºå…¶ä»–å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œä½ ç¡®å®æ— éœ€ç†è§£å †æ ˆçš„åŸç†ï¼Œä½†æ˜¯åœ¨ Rust ä¸­ï¼Œæ˜ç™½å †æ ˆçš„åŸç†ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£æ‰€æœ‰æƒçš„å·¥ä½œåŸç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

#### æ‰€æœ‰æƒåŸåˆ™
ç†è§£äº†å †æ ˆï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å…³äºæ‰€æœ‰æƒçš„è§„åˆ™ï¼Œé¦–å…ˆè¯·è°¨è®°ä»¥ä¸‹è§„åˆ™ï¼š
> 1. Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
> 2. ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
> 3. å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)

##### å˜é‡ä½œç”¨åŸŸ
ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªå˜é‡åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´, å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ï¼š

```rust
let s = "hello";
```
å˜é‡ s ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¯¥å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­çš„ã€‚s å˜é‡ä»å£°æ˜çš„ç‚¹å¼€å§‹ç›´åˆ°å½“å‰ä½œç”¨åŸŸçš„ç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ï¼š
```rust
{                      // s åœ¨è¿™é‡Œæ— æ•ˆï¼Œå®ƒå°šæœªå£°æ˜
    let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„

    // ä½¿ç”¨ s
}                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œsä¸å†æœ‰æ•ˆ
```
ç®€è€Œè¨€ä¹‹ï¼Œs ä»åˆ›å»ºä¼Šå§‹å°±å¼€å§‹æœ‰æ•ˆï¼Œç„¶åæœ‰æ•ˆæœŸæŒç»­åˆ°å®ƒç¦»å¼€ä½œç”¨åŸŸä¸ºæ­¢ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ**å°±ä½œç”¨åŸŸæ¥è¯´ï¼ŒRust è¯­è¨€è·Ÿå…¶ä»–ç¼–ç¨‹è¯­è¨€æ²¡æœ‰åŒºåˆ«**ã€‚

##### ç®€å•ä»‹ç» String ç±»å‹
> è¿™é‡Œæˆ‘å¤§è‡´ä»‹ç»ä¸‹å¤§çº²ï¼š
> - äº†è§£å­—ç¬¦ä¸²çš„ç¡¬ç¼–ç 
> - äº†è§£åŠ¨æ€å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ç”¨æˆ·è¾“å…¥è¿›å»çš„æƒ…å†µåº”è¯¥å¦‚ä½•åˆ›å»ºï¼Ÿ

ä¹‹å‰æåˆ°è¿‡ï¼Œæœ¬ç« ä¼šç”¨ String ä½œä¸ºä¾‹å­ï¼Œå› æ­¤è¿™é‡Œä¼šè¿›è¡Œä¸€ä¸‹ç®€å•çš„ä»‹ç»ï¼Œå…·ä½“çš„ String å­¦ä¹ è¯·å‚è§ String ç±»å‹ã€‚

æˆ‘ä»¬å·²ç»è§è¿‡å­—ç¬¦ä¸²å­—é¢å€¼ `let s ="hello"`ï¼Œs æ˜¯è¢«ç¡¬ç¼–ç è¿›ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²å€¼ï¼ˆç±»å‹ä¸º &str ï¼‰ã€‚å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚åŸå› æœ‰äºŒï¼š

å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºè¢«ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­
å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–å†™ä»£ç æ—¶å¾—çŸ¥
ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²æ˜¯éœ€è¦ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ç”¨æˆ·åŠ¨æ€è¾“å…¥ç„¶åå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™ç§æƒ…å†µï¼Œå­—ç¬¦ä¸²å­—é¢å€¼å°±å®Œå…¨æ— ç”¨æ­¦ä¹‹åœ°ã€‚ ä¸ºæ­¤ï¼ŒRust ä¸ºæˆ‘ä»¬æä¾›åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹: String, è¯¥ç±»å‹è¢«åˆ†é…åˆ°å †ä¸Šï¼Œå› æ­¤å¯ä»¥åŠ¨æ€ä¼¸ç¼©ï¼Œä¹Ÿå°±èƒ½å­˜å‚¨åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬ã€‚

å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•åŸºäºå­—ç¬¦ä¸²å­—é¢é‡æ¥åˆ›å»º String ç±»å‹ï¼š

```rust
let s = String::from("hello");
```
`::` æ˜¯ä¸€ç§è°ƒç”¨æ“ä½œç¬¦ï¼Œè¿™é‡Œè¡¨ç¤ºè°ƒç”¨ String ä¸­çš„ from æ–¹æ³•ï¼Œå› ä¸º String å­˜å‚¨åœ¨å †ä¸Šæ˜¯åŠ¨æ€çš„ï¼Œä½ å¯ä»¥è¿™æ ·ä¿®æ”¹å®ƒï¼š
```rust
let mut s = String::from("hello");

s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼

println!("{}", s); // å°†æ‰“å° `hello, world!`
```
è¨€å½’æ­£ä¼ ï¼Œäº†è§£ String å†…å®¹åï¼Œä¸€èµ·æ¥çœ‹çœ‹å…³äºæ‰€æœ‰æƒçš„äº¤äº’ã€‚

#### å˜é‡ç»‘å®šèƒŒåçš„æ•°æ®äº¤äº’

##### è½¬ç§»æ‰€æœ‰æƒ
å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š

```rust
let x = 5;
let y = x;
```
ä»£ç èƒŒåçš„é€»è¾‘å¾ˆç®€å•, å°† 5 ç»‘å®šåˆ°å˜é‡ xï¼›æ¥ç€æ‹·è´ x çš„å€¼èµ‹ç»™ yï¼Œæœ€ç»ˆ x å’Œ y éƒ½ç­‰äº 5ï¼Œå› ä¸ºæ•´æ•°æ˜¯ Rust åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œéƒ½è¢«å­˜åœ¨æ ˆä¸­ï¼Œå®Œå…¨æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚

å¯èƒ½æœ‰åŒå­¦ä¼šæœ‰ç–‘é—®ï¼šè¿™ç§æ‹·è´ä¸æ¶ˆè€—æ€§èƒ½å—ï¼Ÿå®é™…ä¸Šï¼Œè¿™ç§æ ˆä¸Šçš„æ•°æ®è¶³å¤Ÿç®€å•ï¼Œè€Œä¸”æ‹·è´éå¸¸éå¸¸å¿«ï¼Œåªéœ€è¦å¤åˆ¶ä¸€ä¸ªæ•´æ•°å¤§å°ï¼ˆi32ï¼Œ4 ä¸ªå­—èŠ‚ï¼‰çš„å†…å­˜å³å¯ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‹·è´çš„é€Ÿåº¦è¿œæ¯”åœ¨å †ä¸Šåˆ›å»ºå†…å­˜æ¥å¾—å¿«çš„å¤šã€‚å®é™…ä¸Šï¼Œä¸Šä¸€ç« æˆ‘ä»¬è®²åˆ°çš„ Rust åŸºæœ¬ç±»å‹éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œå°±åƒä¸Šé¢ä»£ç ä¸€æ ·ã€‚

ç„¶åå†æ¥çœ‹ä¸€æ®µä»£ç ï¼š

```rust
let s1 = String::from("hello");
let s2 = s1;
```
æ­¤æ—¶ï¼Œå¯èƒ½æŸä¸ªå¤§èªæ˜(å–„æ„æ˜µç§°)å·²ç»æƒ³åˆ°äº†ï¼šå—¯ï¼ŒæŠŠ s1 çš„å†…å®¹æ‹·è´ä¸€ä»½èµ‹å€¼ç»™ s2ï¼Œå®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯è¿™æ ·ã€‚ä¹‹å‰ä¹Ÿæåˆ°äº†ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ï¼ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼‰ï¼ŒRust ä¼šè‡ªåŠ¨æ‹·è´ï¼Œä½†æ˜¯ String ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œè€Œä¸”æ˜¯å­˜å‚¨åœ¨å †ä¸Šçš„ï¼Œå› æ­¤ä¸èƒ½è‡ªåŠ¨æ‹·è´ã€‚

å®é™…ä¸Šï¼Œ String ç±»å‹æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œç”±å­˜å‚¨åœ¨æ ˆä¸­çš„å †æŒ‡é’ˆã€å­—ç¬¦ä¸²é•¿åº¦ã€å­—ç¬¦ä¸²å®¹é‡å…±åŒç»„æˆï¼Œå…¶ä¸­å †æŒ‡é’ˆæ˜¯æœ€é‡è¦çš„ï¼Œå®ƒæŒ‡å‘äº†çœŸå®å­˜å‚¨å­—ç¬¦ä¸²å†…å®¹çš„å †å†…å­˜ï¼Œè‡³äºé•¿åº¦å’Œå®¹é‡ï¼Œå¦‚æœä½ æœ‰ Go è¯­è¨€çš„ç»éªŒï¼Œè¿™é‡Œå°±å¾ˆå¥½ç†è§£ï¼šå®¹é‡æ˜¯å †å†…å­˜åˆ†é…ç©ºé—´çš„å¤§å°ï¼Œé•¿åº¦æ˜¯ç›®å‰å·²ç»ä½¿ç”¨çš„å¤§å°ã€‚

æ€»ä¹‹ String ç±»å‹æŒ‡å‘äº†ä¸€ä¸ªå †ä¸Šçš„ç©ºé—´ï¼Œè¿™é‡Œå­˜å‚¨ç€å®ƒçš„çœŸå®æ•°æ®, ä¸‹é¢å¯¹ä¸Šé¢ä»£ç ä¸­çš„ let s2 = s1 åˆ†æˆä¸¤ç§æƒ…å†µè®¨è®ºï¼š
1. æ‹·è´ String å’Œå­˜å‚¨åœ¨å †ä¸Šçš„å­—èŠ‚æ•°ç»„ å¦‚æœè¯¥è¯­å¥æ˜¯æ‹·è´æ‰€æœ‰æ•°æ®(æ·±æ‹·è´)ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ String æœ¬èº«è¿˜æ˜¯åº•å±‚çš„å †ä¸Šæ•°æ®ï¼Œéƒ½ä¼šè¢«å…¨éƒ¨æ‹·è´ï¼Œè¿™å¯¹äºæ€§èƒ½è€Œè¨€ä¼šé€ æˆéå¸¸å¤§çš„å½±å“
2. åªæ‹·è´ String æœ¬èº« è¿™æ ·çš„æ‹·è´éå¸¸å¿«ï¼Œå› ä¸ºåœ¨ 64 ä½æœºå™¨ä¸Šå°±æ‹·è´äº† 8å­—èŠ‚çš„æŒ‡é’ˆã€8å­—èŠ‚çš„é•¿åº¦ã€8å­—èŠ‚çš„å®¹é‡ï¼Œæ€»è®¡ 24 å­—èŠ‚ï¼Œä½†æ˜¯å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ‰€æœ‰æƒè§„åˆ™å§ï¼Ÿå…¶ä¸­æœ‰ä¸€æ¡å°±æ˜¯ï¼šä¸€ä¸ªå€¼åªå…è®¸æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œè€Œç°åœ¨è¿™ä¸ªå€¼ï¼ˆå †ä¸Šçš„çœŸå®å­—ç¬¦ä¸²æ•°æ®ï¼‰æœ‰äº†ä¸¤ä¸ªæ‰€æœ‰è€…ï¼šs1 å’Œ s2ã€‚

å¥½å§ï¼Œå°±å‡å®šä¸€ä¸ªå€¼å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªæ‰€æœ‰è€…ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸåï¼ŒRust ä¼šè‡ªåŠ¨è°ƒç”¨ drop å‡½æ•°å¹¶æ¸…ç†å˜é‡çš„å †å†…å­˜ã€‚ä¸è¿‡ç”±äºä¸¤ä¸ª String å˜é‡æŒ‡å‘äº†åŒä¸€ä½ç½®ã€‚è¿™å°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“ s1 å’Œ s2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰ çš„é”™è¯¯ï¼Œä¹Ÿæ˜¯ä¹‹å‰æåˆ°è¿‡çš„å†…å­˜å®‰å…¨æ€§ BUG ä¹‹ä¸€ã€‚ä¸¤æ¬¡é‡Šæ”¾ï¼ˆç›¸åŒï¼‰å†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚

å› æ­¤ï¼ŒRust è¿™æ ·è§£å†³é—®é¢˜ï¼šå½“ s1 èµ‹äºˆ s2 åï¼ŒRust è®¤ä¸º s1 ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ä¹Ÿæ— éœ€åœ¨ s1 ç¦»å¼€ä½œç”¨åŸŸå drop ä»»ä½•ä¸œè¥¿ï¼Œè¿™å°±æ˜¯æŠŠæ‰€æœ‰æƒä» s1 è½¬ç§»ç»™äº† s2ï¼Œs1 åœ¨è¢«èµ‹äºˆ s2 åå°±é©¬ä¸Šå¤±æ•ˆäº†ã€‚

å†æ¥çœ‹çœ‹ï¼Œåœ¨æ‰€æœ‰æƒè½¬ç§»åå†æ¥ä½¿ç”¨æ—§çš„æ‰€æœ‰è€…ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š

```rust
let s1 = String::from("hello");
let s2 = s1;

println!("{}, world!", s1);
```
ç”±äº Rust ç¦æ­¢ä½ ä½¿ç”¨æ— æ•ˆçš„å¼•ç”¨ï¼Œä½ ä¼šçœ‹åˆ°ä»¥ä¸‹çš„é”™è¯¯ï¼š
```
error[E0382]: borrow of moved value: `s1`
 --> src/main.rs:5:28
  |
2 |     let s1 = String::from("hello");
  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
3 |     let s2 = s1;
  |              -- value moved here
4 | 
5 |     println!("{}, world!", s1);
  |                            ^^ value borrowed here after move
  |
  = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)
```

> è¿™é‡Œæˆ‘å†è¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹ï¼šä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨ Rust ä¸­ï¼Œå˜é‡ç»‘å®šå…·æœ‰æ‰€æœ‰æƒ (ownership)ã€‚å½“ä½ å°† s1 ç»‘å®šåˆ°æ–°çš„å˜é‡ s2 æ—¶ï¼Œæ‰€æœ‰æƒä¼šè½¬ç§»ï¼Œè€Œ s1 ä¸å†æœ‰æ•ˆã€‚è¿™æ˜¯ Rust çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œå®ƒæœ‰åŠ©äºé¿å…å†…å­˜ä¸å®‰å…¨ã€‚é”™è¯¯å‘ç”Ÿåœ¨ println! è¡Œï¼Œå› ä¸ºä½ è¯•å›¾ä½¿ç”¨å·²ç»å¤±æ•ˆçš„å˜é‡ s1ã€‚

ğŸŒ…å¦å¤–è¿™æ®µä»£ç å¯ä»¥è§£å†³ï¼š`1. å…‹éš† 2. å¼•ç”¨`
1. å…‹éš†(clone)ï¼š
```rust
let s1 = String::from("hello");
let s2 = s1.clone();

println!("{}, world!", s1);
// è¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `String` å®ä¾‹ï¼Œå…¶å†…å®¹ä¸ `s1` ç›¸åŒï¼Œå¹¶å°†å…¶ç»‘å®šåˆ° `s2`ã€‚è¿™æ ·ï¼Œ`s1` å’Œ `s2` éƒ½å¯ä»¥åœ¨åç»­ä»£ç ä¸­ä½¿ç”¨ã€‚
```
2. å¼•ç”¨ (references)ï¼š
```rust
let s1 = String::from("hello");
let s2 = &s1;

println!("{}, world!", s1);
// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¯¹ `s1` çš„å¼•ç”¨å¹¶å°†å…¶èµ‹å€¼ç»™ `s2`ã€‚è¿™æ · `s1` ä»ç„¶æ‹¥æœ‰æ‰€æœ‰æƒï¼Œè€Œ `s2` åªæ˜¯å€Ÿç”¨ (borrow)ã€‚æ³¨æ„ï¼Œå½“ä½¿ç”¨å¼•ç”¨æ—¶ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ç”Ÿå‘½å‘¨æœŸ (lifetimes) å’Œå¯å˜æ€§ (mutability)ã€‚
```

ç°åœ¨å†å›å¤´çœ‹çœ‹ä¹‹å‰çš„è§„åˆ™ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ï¼š
> 1. Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
> 2. ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
> 3. å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)

å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ æµ…æ‹·è´(shallow copy) å’Œ æ·±æ‹·è´(deep copy)ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¬èµ·æ¥å°±åƒæµ…æ‹·è´ï¼Œä½†æ˜¯åˆå› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡ s1 æ— æ•ˆäº†ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œè¢«ç§°ä¸º ç§»åŠ¨(move)ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚ä¸Šé¢çš„ä¾‹å­å¯ä»¥è§£è¯»ä¸º s1 è¢«ç§»åŠ¨åˆ°äº† s2 ä¸­ã€‚é‚£ä¹ˆå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œç”¨ä¸€å¼ å›¾ç®€å•è¯´æ˜ï¼š
![](https://pic1.zhimg.com/80/v2-3ec77951de6a17584b5eb4a3838b4b61_1440w.jpg)
è¿™æ ·å°±è§£å†³äº†æˆ‘ä»¬ä¹‹å‰çš„é—®é¢˜ï¼Œs1 ä¸å†æŒ‡å‘ä»»ä½•æ•°æ®ï¼Œåªæœ‰ s2 æ˜¯æœ‰æ•ˆçš„ï¼Œå½“ s2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒå°±ä¼šé‡Šæ”¾å†…å­˜ã€‚ ç›¸ä¿¡æ­¤åˆ»ï¼Œä½ åº”è¯¥æ˜ç™½äº†ï¼Œä¸ºä»€ä¹ˆ Rust ç§°å‘¼ let a = b ä¸ºå˜é‡ç»‘å®šäº†å§ï¼Ÿ

å†æ¥çœ‹ä¸€æ®µä»£ç :
```rust
fn main() {
    let x: &str = "hello, world";
    let y = x;
    println!("{},{}",x,y);
}
```
è¿™æ®µä»£ç ï¼Œå¤§å®¶è§‰å¾—ä¼šå¦æŠ¥é”™ï¼Ÿå¦‚æœå‚è€ƒä¹‹å‰çš„ String æ‰€æœ‰æƒè½¬ç§»çš„ä¾‹å­ï¼Œé‚£è¿™æ®µä»£ç ä¹Ÿåº”è¯¥æŠ¥é”™æ‰æ˜¯ï¼Œä½†æ˜¯å®é™…ä¸Šå‘¢ï¼Ÿ

è¿™æ®µä»£ç å’Œä¹‹å‰çš„ String æœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼šåœ¨ String çš„ä¾‹å­ä¸­ s1 æŒæœ‰äº†é€šè¿‡String::from("hello") åˆ›å»ºçš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œè¿™ä¸ªä¾‹å­ä¸­ï¼Œx åªæ˜¯å¼•ç”¨äº†å­˜å‚¨åœ¨äºŒè¿›åˆ¶ä¸­çš„å­—ç¬¦ä¸² "hello, world"ï¼Œå¹¶æ²¡æœ‰æŒæœ‰æ‰€æœ‰æƒã€‚

å› æ­¤ let y = x ä¸­ï¼Œä»…ä»…æ˜¯å¯¹è¯¥å¼•ç”¨è¿›è¡Œäº†æ‹·è´ï¼Œæ­¤æ—¶ y å’Œ x éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å¦‚æœè¿˜ä¸ç†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œå½“å­¦ä¹ äº†ä¸‹ä¸€ç« èŠ‚ "å¼•ç”¨ä¸å€Ÿç”¨" åï¼Œå¤§å®¶è‡ªç„¶è€Œè¨€å°±ä¼šç†è§£ã€‚

##### å…‹éš†(æ·±æ‹·è´)
é¦–å…ˆï¼ŒRust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€ã€‚å› æ­¤ï¼Œä»»ä½•è‡ªåŠ¨çš„å¤åˆ¶éƒ½ä¸æ˜¯æ·±æ‹·è´ï¼Œå¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚

å¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦æ·±åº¦å¤åˆ¶ String ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš clone çš„æ–¹æ³•ã€‚
```rust
let s1 = String::from("hello");
let s2 = s1.clone();

println!("s1 = {}, s2 = {}", s1, s2);
```

è¿™æ®µä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå› æ­¤è¯´æ˜ s2 ç¡®å®å®Œæ•´çš„å¤åˆ¶äº† s1 çš„æ•°æ®ã€‚

å¦‚æœä»£ç æ€§èƒ½æ— å…³ç´§è¦ï¼Œä¾‹å¦‚åˆå§‹åŒ–ç¨‹åºæ—¶ï¼Œæˆ–è€…åœ¨æŸæ®µæ—¶é—´åªä¼šæ‰§è¡Œä¸€æ¬¡æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ clone æ¥ç®€åŒ–ç¼–ç¨‹ã€‚ä½†æ˜¯å¯¹äºæ‰§è¡Œè¾ƒä¸ºé¢‘ç¹çš„ä»£ç (çƒ­ç‚¹è·¯å¾„)ï¼Œä½¿ç”¨ clone ä¼šæå¤§çš„é™ä½ç¨‹åºæ€§èƒ½ï¼Œéœ€è¦å°å¿ƒä½¿ç”¨ï¼

##### æ‹·è´(æµ…æ‹·è´)
æµ…æ‹·è´åªå‘ç”Ÿåœ¨æ ˆä¸Šï¼Œå› æ­¤æ€§èƒ½å¾ˆé«˜ï¼Œåœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­ï¼Œæµ…æ‹·è´æ— å¤„ä¸åœ¨ã€‚

å†å›åˆ°ä¹‹å‰çœ‹è¿‡çš„ä¾‹å­:
```rust
let x = 5;
let y = x;

println!("x = {}, y = {}", x, y);
```

ä½†è¿™æ®µä»£ç ä¼¼ä¹ä¸æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„å†…å®¹ç›¸çŸ›ç›¾ï¼šæ²¡æœ‰è°ƒç”¨ cloneï¼Œä¸è¿‡ä¾ç„¶å®ç°äº†ç±»ä¼¼æ·±æ‹·è´çš„æ•ˆæœ â€”â€” æ²¡æœ‰æŠ¥æ‰€æœ‰æƒçš„é”™è¯¯ã€‚

åŸå› æ˜¯åƒæ•´å‹è¿™æ ·çš„åŸºæœ¬ç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥å¤§å°çš„ï¼Œä¼šè¢«å­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æ‹·è´å…¶å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ y åä½¿ x æ— æ•ˆï¼ˆxã€y éƒ½ä»ç„¶æœ‰æ•ˆï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼Œå› æ­¤è¿™é‡Œè°ƒç”¨ clone å¹¶ä¸ä¼šä¸é€šå¸¸çš„æµ…æ‹·è´æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡å®ƒï¼ˆå¯ä»¥ç†è§£æˆåœ¨æ ˆä¸Šåšäº†æ·±æ‹·è´ï¼‰ã€‚

Rust æœ‰ä¸€ä¸ªå«åš Copy çš„ç‰¹å¾ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·åœ¨æ ˆä¸­å­˜å‚¨çš„ç±»å‹ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ‹¥æœ‰ Copy ç‰¹å¾ï¼Œä¸€ä¸ªæ—§çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ã€‚

é‚£ä¹ˆä»€ä¹ˆç±»å‹æ˜¯å¯ Copy çš„å‘¢ï¼Ÿå¯ä»¥æŸ¥çœ‹ç»™å®šç±»å‹çš„æ–‡æ¡£æ¥ç¡®è®¤ï¼Œä¸è¿‡ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼š ä»»ä½•åŸºæœ¬ç±»å‹çš„ç»„åˆå¯ä»¥ Copy ï¼Œä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹æ˜¯å¯ä»¥ Copy çš„ã€‚å¦‚ä¸‹æ˜¯ä¸€äº› Copy çš„ç±»å‹ï¼š

- æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ u32
- å¸ƒå°”ç±»å‹ï¼Œboolï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ false
- æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ f64
- å­—ç¬¦ç±»å‹ï¼Œchar
- å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½æ˜¯ Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) æ˜¯ Copy çš„ï¼Œä½† (i32, String) å°±ä¸æ˜¯
- ä¸å¯å˜å¼•ç”¨ &T ï¼Œä¾‹å¦‚è½¬ç§»æ‰€æœ‰æƒä¸­çš„æœ€åä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æ³¨æ„: å¯å˜å¼•ç”¨ &mut T æ˜¯ä¸å¯ä»¥ Copyçš„

#### å‡½æ•°ä¼ å€¼ä¸è¿”å›
å°†å€¼ä¼ é€’ç»™å‡½æ•°ï¼Œä¸€æ ·ä¼šå‘ç”Ÿ ç§»åŠ¨ æˆ–è€… å¤åˆ¶ï¼Œå°±è·Ÿ let è¯­å¥ä¸€æ ·ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†æ‰€æœ‰æƒã€ä½œç”¨åŸŸçš„è§„åˆ™ï¼š
```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

    makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                    // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
```
ä½ å¯ä»¥å°è¯•åœ¨ takes_ownership ä¹‹åï¼Œå†ä½¿ç”¨ sï¼Œçœ‹çœ‹å¦‚ä½•æŠ¥é”™ï¼Ÿä¾‹å¦‚æ·»åŠ ä¸€è¡Œ println!("åœ¨moveè¿›å‡½æ•°åç»§ç»­ä½¿ç”¨s: {}",s);ã€‚
```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ
    let y = s;
    println!(y); // è¿™é‡Œè¿›è¡Œå®éªŒ
// ====================================
%%error: format argument must be a string literal
 --> src/main.rs:7:14
  |
7 |     println!(y);
  |              ^
  |
help: you might be missing a string literal to format with
  |
7 |     println!("{}", y);
  |              +++++

error: could not compile `Demo` due to previous erro%%r
```

åŒæ ·çš„ï¼Œå‡½æ•°è¿”å›å€¼ä¹Ÿæœ‰æ‰€æœ‰æƒï¼Œä¾‹å¦‚:

```rust
fn main() {
    let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                        // ç§»ç»™ s1

    let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ

    let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                        // takes_and_gives_back ä¸­,
                                        // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
} // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

fn gives_ownership() -> String {             // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                             // è°ƒç”¨å®ƒçš„å‡½æ•°

    let some_string = String::from("hello"); // some_string è¿›å…¥ä½œç”¨åŸŸ.

    some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}

// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ

    a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}
```
æ‰€æœ‰æƒå¾ˆå¼ºå¤§ï¼Œé¿å…äº†å†…å­˜çš„ä¸å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªæ–°éº»çƒ¦ï¼š æ€»æ˜¯æŠŠä¸€ä¸ªå€¼ä¼ æ¥ä¼ å»æ¥ä½¿ç”¨å®ƒã€‚ ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¾ˆå¯èƒ½è¿˜è¦ä»è¯¥å‡½æ•°ä¼ å‡ºå»ï¼Œç»“æœå°±æ˜¯è¯­è¨€è¡¨è¾¾å˜å¾—éå¸¸å•°å—¦ï¼Œå¹¸è¿çš„æ˜¯ï¼ŒRust æä¾›äº†æ–°åŠŸèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### 1.3.2 ğŸšŒ å€Ÿç”¨
ä¸ŠèŠ‚ä¸­æåˆ°ï¼Œå¦‚æœä»…ä»…æ”¯æŒé€šè¿‡è½¬ç§»æ‰€æœ‰æƒçš„æ–¹å¼è·å–ä¸€ä¸ªå€¼ï¼Œé‚£ä¼šè®©ç¨‹åºå˜å¾—å¤æ‚ã€‚ Rust èƒ½å¦åƒå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œä½¿ç”¨æŸä¸ªå˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥ã€‚

**Rust é€šè¿‡ å€Ÿç”¨(Borrowing) è¿™ä¸ªæ¦‚å¿µæ¥è¾¾æˆä¸Šè¿°çš„ç›®çš„ï¼Œè·å–å˜é‡çš„å¼•ç”¨ï¼Œç§°ä¹‹ä¸ºå€Ÿç”¨(borrowing)**ã€‚æ­£å¦‚ç°å®ç”Ÿæ´»ä¸­ï¼Œå¦‚æœä¸€ä¸ªäººæ‹¥æœ‰æŸæ ·ä¸œè¥¿ï¼Œä½ å¯ä»¥ä»ä»–é‚£é‡Œå€Ÿæ¥ï¼Œå½“ä½¿ç”¨å®Œæ¯•åï¼Œä¹Ÿå¿…é¡»è¦ç‰©å½’åŸä¸»ã€‚

#### å¼•ç”¨ä¸è§£å¼•ç”¨
å¸¸è§„å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘äº†å¯¹è±¡å­˜å‚¨çš„å†…å­˜åœ°å€ã€‚åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª i32 å€¼çš„å¼•ç”¨ yï¼Œç„¶åä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦æ¥è§£å‡º y æ‰€ä½¿ç”¨çš„å€¼:
```rust
fn main() {
    let x = 5;
    let y = &x;

    assert_eq!(5, x);
    assert_eq!(5, *y);
}
```
å˜é‡ x å­˜æ”¾äº†ä¸€ä¸ª i32 å€¼ 5ã€‚y æ˜¯ x çš„ä¸€ä¸ªå¼•ç”¨ã€‚å¯ä»¥æ–­è¨€ x ç­‰äº 5ã€‚ç„¶è€Œï¼Œå¦‚æœå¸Œæœ›å¯¹ y çš„å€¼åšå‡ºæ–­è¨€ï¼Œå¿…é¡»ä½¿ç”¨ *y æ¥è§£å‡ºå¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯è§£å¼•ç”¨ï¼‰ã€‚ä¸€æ—¦è§£å¼•ç”¨äº† yï¼Œå°±å¯ä»¥è®¿é—® y æ‰€æŒ‡å‘çš„æ•´å‹å€¼å¹¶å¯ä»¥ä¸ 5 åšæ¯”è¾ƒã€‚

ç›¸åå¦‚æœå°è¯•ç¼–å†™ assert_eq!(5, y);ï¼Œåˆ™ä¼šå¾—åˆ°å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š
```
error[E0277]: can't compare `{integer}` with `&{integer}`
 --> src/main.rs:6:5
  |
6 |     assert_eq!(5, y);
  |     ^^^^^^^^^^^^^^^^ no implementation for `{integer} == &{integer}` // æ— æ³•æ¯”è¾ƒæ•´æ•°ç±»å‹å’Œå¼•ç”¨ç±»å‹
  |
  = help: the trait `PartialEq<&{integer}>` is not implemented for `{integer}`
  = help: the following other types implement trait `PartialEq<Rhs>`:
```

#### ä¸å¯å˜å¼•ç”¨
ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬ç”¨ s1 çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ calculate_length å‡½æ•°ï¼Œè€Œä¸æ˜¯æŠŠ s1 çš„æ‰€æœ‰æƒè½¬ç§»ç»™è¯¥å‡½æ•°ï¼š

```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
}
```
èƒ½æ³¨æ„åˆ°ä¸¤ç‚¹ï¼š

1. æ— éœ€åƒä¸Šç« ä¸€æ ·ï¼šå…ˆé€šè¿‡å‡½æ•°å‚æ•°ä¼ å…¥æ‰€æœ‰æƒï¼Œç„¶åå†é€šè¿‡å‡½æ•°è¿”å›æ¥ä¼ å‡ºæ‰€æœ‰æƒï¼Œä»£ç æ›´åŠ ç®€æ´
2. calculate_length çš„å‚æ•° s ç±»å‹ä» String å˜ä¸º &String
è¿™é‡Œï¼Œ& ç¬¦å·å³æ˜¯å¼•ç”¨ï¼Œå®ƒä»¬å…è®¸ä½ ä½¿ç”¨å€¼ï¼Œä½†æ˜¯ä¸è·å–æ‰€æœ‰æƒï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 
![](https://pic1.zhimg.com/80/v2-fc68ea4a1fe2e3fe4c5bb523a0a8247c_1440w.jpg)
é€šè¿‡ &s1 è¯­æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ s1 çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œå½“å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå…¶æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚

åŒç†ï¼Œå‡½æ•° calculate_length ä½¿ç”¨ & æ¥è¡¨æ˜å‚æ•° s çš„ç±»å‹æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼š

```rust
fn calculate_length(s: &String) -> usize { // s æ˜¯å¯¹ String çš„å¼•ç”¨
    s.len()
} // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
```
å¾ˆä¸å¹¸ï¼Œå¦¹å­ä½ æ²¡æŠ±åˆ°ï¼Œå“¦å£è¯¯ï¼Œä½ ä¿®æ”¹é”™äº†ï¼š

```
error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference
 --> src/main.rs:8:5
  |
7 | fn change(some_string: &String) {
  |                        ------- help: consider changing this to be a mutable reference: `&mut String`
						   ------- å¸®åŠ©ï¼šè€ƒè™‘å°†è¯¥å‚æ•°ç±»å‹ä¿®æ”¹ä¸ºå¯å˜çš„å¼•ç”¨: `&mut String`
8 |     some_string.push_str(", world");
  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `some_string` is a `&` reference, so the data it refers to cannot be borrowed as mutable\
										`some_string`æ˜¯ä¸€ä¸ª`&`ç±»å‹çš„å¼•ç”¨ï¼Œå› æ­¤å®ƒæŒ‡å‘çš„æ•°æ®æ— æ³•è¿›è¡Œä¿®æ”¹

For more information about this error, try `rustc --explain E0596`.
error: could not compile `Demo` due to previous error
```

æ­£å¦‚å˜é‡é»˜è®¤ä¸å¯å˜ä¸€æ ·ï¼Œå¼•ç”¨æŒ‡å‘çš„å€¼é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œæ²¡äº‹ï¼Œæ¥ä¸€èµ·çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

#### å¯å˜å¼•ç”¨
åªéœ€è¦ä¸€ä¸ªå°è°ƒæ•´ï¼Œå³å¯ä¿®å¤ä¸Šé¢ä»£ç çš„é”™è¯¯ï¼š
```rust
fn main() {
    let mut s = String::from("hello");

    change(&mut s);
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```

é¦–å…ˆï¼Œå£°æ˜ s æ˜¯å¯å˜ç±»å‹ï¼Œå…¶æ¬¡åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ &mut s å’Œæ¥å—å¯å˜å¼•ç”¨å‚æ•° some_string: &mut String çš„å‡½æ•°ã€‚

##### å¯å˜å¼•ç”¨åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ª
ä¸è¿‡å¯å˜å¼•ç”¨å¹¶ä¸æ˜¯éšå¿ƒæ‰€æ¬²ã€æƒ³ç”¨å°±ç”¨çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼š åŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼š
```rust
let mut s = String::from("hello");

let r1 = &mut s;
let r2 = &mut s;

println!("{}, {}", r1, r2);
```
ä»¥ä¸Šä»£ç ä¼šæŠ¥é”™ï¼š
```
	error[E0499]: cannot borrow `s` as mutable more than once at a time åŒä¸€æ—¶é—´æ— æ³•å¯¹ `s` è¿›è¡Œä¸¤æ¬¡å¯å˜å€Ÿç”¨
 --> src/main.rs:5:10
  |
4 | let r1 = &mut s;
  |          ------ first mutable borrow occurs here é¦–ä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
5 | let r2 = &mut s;
  |          ^^^^^^ second mutable borrow occurs here ç¬¬äºŒä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
6 | 
7 | println!("{}, {}", r1, r2);
  |                    -- first borrow later used here ç¬¬ä¸€ä¸ªå€Ÿç”¨åœ¨è¿™é‡Œä½¿ç”¨

For more information about this error, try `rustc --explain E0499`.
error: could not compile `Demo` due to previous error
```
è¿™æ®µä»£ç å‡ºé”™çš„åŸå› åœ¨äºï¼Œç¬¬ä¸€ä¸ªå¯å˜å€Ÿç”¨ r1 å¿…é¡»è¦æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½® println!ï¼Œåœ¨ r1 åˆ›å»ºå’Œæœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬åˆå°è¯•åˆ›å»ºç¬¬äºŒä¸ªå¯å˜å€Ÿç”¨ r2ã€‚

å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œè¿™ä¸ªç‰¹æ€§ç»å¯¹æ˜¯ä¸€å¤§æ‹¦è·¯è™ï¼Œä¹Ÿæ˜¯æ–°äººä»¬è°ˆä¹‹è‰²å˜çš„ç¼–è¯‘å™¨ borrow checker ç‰¹æ€§ä¹‹ä¸€ï¼Œä¸è¿‡å„è¡Œå„ä¸šéƒ½ä¸€æ ·ï¼Œé™åˆ¶å¾€å¾€æ˜¯å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼ŒRust ä¹Ÿä¸€æ ·ã€‚

è¿™ç§é™åˆ¶çš„å¥½å¤„å°±æ˜¯ä½¿ Rust åœ¨ç¼–è¯‘æœŸå°±é¿å…æ•°æ®ç«äº‰ï¼Œæ•°æ®ç«äº‰å¯ç”±ä»¥ä¸‹è¡Œä¸ºé€ æˆï¼š
- ä¸¤ä¸ªæˆ–æ›´å¤šçš„æŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®
- è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®
- æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶

æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå¾ˆå¯èƒ½è¶…å‡ºæˆ‘ä»¬çš„é¢„æœŸï¼Œéš¾ä»¥åœ¨è¿è¡Œæ—¶è¿½è¸ªï¼Œå¹¶ä¸”éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ã€‚è€Œ Rust é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºå®ƒç”šè‡³ä¸ä¼šç¼–è¯‘å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç ï¼

å¾ˆå¤šæ—¶å€™ï¼Œå¤§æ‹¬å·å¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸€äº›ç¼–è¯‘ä¸é€šè¿‡çš„é—®é¢˜ï¼Œé€šè¿‡æ‰‹åŠ¨é™åˆ¶å˜é‡çš„ä½œç”¨åŸŸï¼š

```rust
let mut s = String::from("hello");

{
    let r1 = &mut s;

} // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨

let r2 = &mut s;
```

##### å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨
ä¸‹é¢çš„ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &s; // æ²¡é—®é¢˜
    let r2 = &s; // æ²¡é—®é¢˜
    let r3 = &mut s; // å¤§é—®é¢˜

    println!("{}, {}, and {}", r1, r2, r3);
}
```

é”™è¯¯å¦‚ä¸‹ï¼š
```
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --> src/main.rs:6:14
  |
4 |     let r1 = &s; // æ²¡é—®é¢˜
  |              -- immutable borrow occurs here
5 |     let r2 = &s; // æ²¡é—®é¢˜
6 |     let r3 = &mut s; // å¤§é—®é¢˜
  |              ^^^^^^ mutable borrow occurs here
7 | 
8 |     println!("{}, {}, and {}", r1, r2, r3);
  |                                -- immutable borrow later used here

For more information about this error, try `rustc --explain E0502`.
error: could not compile `Demo` due to previous error
```
å…¶å®è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£åœ¨å€Ÿç”¨ä¸å¯å˜å¼•ç”¨çš„ç”¨æˆ·ï¼Œè‚¯å®šä¸å¸Œæœ›ä»–å€Ÿç”¨çš„ä¸œè¥¿ï¼Œè¢«å¦å¤–ä¸€ä¸ªäººè«åå…¶å¦™æ”¹å˜äº†ã€‚å¤šä¸ªä¸å¯å˜å€Ÿç”¨è¢«å…è®¸æ˜¯å› ä¸ºæ²¡æœ‰äººä¼šå»è¯•å›¾ä¿®æ”¹æ•°æ®ï¼Œæ¯ä¸ªäººéƒ½åªè¯»è¿™ä¸€ä»½æ•°æ®è€Œä¸åšä¿®æ”¹ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°æ®è¢«æ±¡æŸ“ã€‚
> æ³¨æ„ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸ s ä»åˆ›å»ºå¼€å§‹ï¼Œä¸€ç›´æŒç»­åˆ°å®ƒæœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªè·Ÿå˜é‡çš„ä½œç”¨åŸŸæœ‰æ‰€ä¸åŒï¼Œå˜é‡çš„ä½œç”¨åŸŸä»åˆ›å»ºæŒç»­åˆ°æŸä¸€ä¸ªèŠ±æ‹¬å· }

Rust çš„ç¼–è¯‘å™¨ä¸€ç›´åœ¨ä¼˜åŒ–ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸè·Ÿå˜é‡ä½œç”¨åŸŸæ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹æ—¥å¸¸ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„å›°æ‰°ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒçš„å»å®‰æ’å¯å˜ã€ä¸å¯å˜å˜é‡çš„å€Ÿç”¨ï¼Œå…å¾—æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

```rust
fn main() {
   let mut s = String::from("hello");

    let r1 = &s;
    let r2 = &s;
    println!("{} and {}", r1, r2);
    // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr1,r2ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

    let r3 = &mut s;
    println!("{}", r3);
} // è€ç¼–è¯‘å™¨ä¸­ï¼Œr1ã€r2ã€r3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
  // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
```
åœ¨è€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸­ï¼ˆRust 1.31 å‰ï¼‰ï¼Œå°†ä¼šæŠ¥é”™ï¼Œå› ä¸º r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨èŠ±æ‹¬å· } å¤„ç»“æŸï¼Œé‚£ä¹ˆ r3 çš„å€Ÿç”¨å°±ä¼šè§¦å‘ æ— æ³•åŒæ—¶å€Ÿç”¨å¯å˜å’Œä¸å¯å˜çš„è§„åˆ™ã€‚

ä½†æ˜¯åœ¨æ–°çš„ç¼–è¯‘å™¨ä¸­ï¼Œè¯¥ä»£ç å°†é¡ºåˆ©é€šè¿‡ï¼Œå› ä¸º å¼•ç”¨ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ä»èŠ±æ‹¬å·å˜æˆæœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½®ï¼Œå› æ­¤ r1 å€Ÿç”¨å’Œ r2 å€Ÿç”¨åœ¨ println! åï¼Œå°±ç»“æŸäº†ï¼Œæ­¤æ—¶ r3 å¯ä»¥é¡ºåˆ©å€Ÿç”¨åˆ°å¯å˜å¼•ç”¨ã€‚

##### NLL
å¯¹äºè¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸ºï¼ŒRust ä¸“é—¨èµ·äº†ä¸€ä¸ªåå­— â€”â€” Non-Lexical Lifetimes(NLL)ï¼Œä¸“é—¨ç”¨äºæ‰¾åˆ°æŸä¸ªå¼•ç”¨åœ¨ä½œç”¨åŸŸ(})ç»“æŸå‰å°±ä¸å†è¢«ä½¿ç”¨çš„ä»£ç ä½ç½®ã€‚

è™½ç„¶è¿™ç§å€Ÿç”¨é”™è¯¯æœ‰çš„æ—¶å€™ä¼šè®©æˆ‘ä»¬å¾ˆéƒé—·ï¼Œä½†æ˜¯ä½ åªè¦æƒ³æƒ³è¿™æ˜¯ Rust æå‰å¸®ä½ å‘ç°äº†æ½œåœ¨çš„ BUGï¼Œå…¶å®å°±å¼€å¿ƒäº†ï¼Œè™½ç„¶å‡æ…¢äº†å¼€å‘é€Ÿåº¦ï¼Œä½†æ˜¯ä»é•¿æœŸæ¥çœ‹ï¼Œå¤§å¹…å‡å°‘äº†åç»­å¼€å‘å’Œè¿ç»´æˆæœ¬ã€‚

##### æ‚¬å‚å¼•ç”¨(Dangling References)
æ‚¬å‚å¼•ç”¨ä¹Ÿå«åšæ‚¬å‚æŒ‡é’ˆï¼Œæ„æ€ä¸ºæŒ‡é’ˆæŒ‡å‘æŸä¸ªå€¼åï¼Œè¿™ä¸ªå€¼è¢«é‡Šæ”¾æ‰äº†ï¼Œè€ŒæŒ‡é’ˆä»ç„¶å­˜åœ¨ï¼Œå…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½ä¸å­˜åœ¨ä»»ä½•å€¼æˆ–å·²è¢«å…¶å®ƒå˜é‡é‡æ–°ä½¿ç”¨ã€‚åœ¨ Rust ä¸­ç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ è·å–æ•°æ®çš„å¼•ç”¨åï¼Œç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å¼•ç”¨ç»“æŸå‰è¢«é‡Šæ”¾ï¼Œè¦æƒ³é‡Šæ”¾æ•°æ®ï¼Œå¿…é¡»å…ˆåœæ­¢å…¶å¼•ç”¨çš„ä½¿ç”¨ã€‚

è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼š
```rust
fn main() {
    let reference_to_nothing = dangle();
}

fn dangle() -> &String {
    let s = String::from("hello");

    &s
}
```
è¿™é‡Œæ˜¯é”™è¯¯ï¼š
```
error[E0106]: missing lifetime specifier
 --> src/main.rs:5:16
  |
5 | fn dangle() -> &String {
  |                ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
help: consider using the `'static` lifetime
  |
5 | fn dangle() -> &'static String {
  |                ~~~~~~~~
```
é”™è¯¯ä¿¡æ¯å¼•ç”¨äº†ä¸€ä¸ªæˆ‘ä»¬è¿˜æœªä»‹ç»çš„åŠŸèƒ½ï¼šç”Ÿå‘½å‘¨æœŸ(lifetimes)ã€‚ä¸è¿‡ï¼Œå³ä½¿ä½ ä¸ç†è§£ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡é”™è¯¯ä¿¡æ¯çŸ¥é“è¿™æ®µä»£ç é”™è¯¯çš„å…³é”®ä¿¡æ¯ï¼š


this function's return type contains a borrowed value, but there is no value for it to be borrowed from.
è¯¥å‡½æ•°è¿”å›äº†ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œä½†æ˜¯å·²ç»æ‰¾ä¸åˆ°å®ƒæ‰€å€Ÿç”¨å€¼çš„æ¥æº

ä»”ç»†çœ‹çœ‹ dangle ä»£ç çš„æ¯ä¸€æ­¥åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼š

```rust
fn dangle() -> &String { // dangle è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨

    let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²

    &s // è¿”å›å­—ç¬¦ä¸² s çš„å¼•ç”¨
} // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚å…¶å†…å­˜è¢«é‡Šæ”¾ã€‚
  // å±é™©ï¼
```
å› ä¸º s æ˜¯åœ¨ dangle å‡½æ•°å†…åˆ›å»ºçš„ï¼Œå½“ dangle çš„ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œs å°†è¢«é‡Šæ”¾ï¼Œä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬åˆå°è¯•å»è¿”å›å®ƒçš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€è¿™ä¸ªå¼•ç”¨ä¼šæŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„ Stringï¼Œè¿™å¯ä¸å¯¹ï¼

å…¶ä¸­ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥è¿”å› Stringï¼š
```rust
fn no_dangle() -> String {
    let s = String::from("hello");

    s
}
```
è¿™æ ·å°±æ²¡æœ‰ä»»ä½•é”™è¯¯äº†ï¼Œæœ€ç»ˆ String çš„ æ‰€æœ‰æƒè¢«è½¬ç§»ç»™å¤–é¢çš„è°ƒç”¨è€…ã€‚

#### å€Ÿç”¨è§„åˆ™æ€»ç»“
æ€»çš„æ¥è¯´ï¼Œå€Ÿç”¨è§„åˆ™å¦‚ä¸‹ï¼š
- åŒä¸€æ—¶åˆ»ï¼Œä½ åªèƒ½æ‹¥æœ‰è¦ä¹ˆä¸€ä¸ªå¯å˜å¼•ç”¨, è¦ä¹ˆä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨
- å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„

è‡³æ­¤ï¼Œæˆ‘ç»ˆäºæ¬å®Œäº†ï¼Œç´¯æ­»äº†ï¼

## 1.4 ğŸ—› å­—ç¬¦ä¸²

å…ˆè¯•è¯•è¿™æ®µä»£ç çš„ç»“æœæ˜¯æ€æ ·çš„ï¼Ÿ
```rust
fn main() {
  let my_name = "Pascal";
  greet(my_name);
}

fn greet(name: String) {
  println!("Hello, {}!", name);
}
```



è¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨è°ƒç”¨ greet å‡½æ•°æ—¶ï¼Œmy_name åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆ&strï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª String ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œ&str å’Œ String æ˜¯ä¸¤ç§ä¸åŒçš„å­—ç¬¦ä¸²ç±»å‹ï¼ŒString æ˜¯å¯å˜çš„ï¼Œè€Œ &str æ˜¯ä¸å¯å˜çš„ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥å°† greet å‡½æ•°çš„å‚æ•°ç±»å‹æ›´æ”¹ä¸º &strï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
error[E0308]: mismatched types
 --> src/main.rs:3:9
  |
3 |   greet(my_name);
  |         ^^^^^^^- help: try using a conversion method: `.to_string()` // å°è¯•ä½¿ç”¨è½¬æ¢æ–¹æ³•ï¼š'.to_stringï¼ˆï¼‰'
  |         |
  |         expected struct `String`, found `&str` // å½“å‰ç»“æ„'String'ï¼Œé¢„æœŸæ‰¾åˆ°'&str'

For more information about this error, try `rustc --explain E0308`.
error: could not compile `Demo` due to previous error
```

è§£å†³æ–¹æ¡ˆï¼š

```rust
fn main() {
  let my_name = "Pascal";
  greet(my_name);
}

fn greet(name: &str) {
  println!("Hello, {}!", name);
}
```

### åˆ‡ç‰‡(slice)
ä¸‹é¢å…ˆå†™ä¸€ä¸ªGoè¯­è¨€å’ŒPythonè¯­è¨€çš„åˆ‡ç‰‡ï¼Œæ–¹ä¾¿æ¸å…¥ä½³å¢ƒ

Goè¯­è¨€
```go
package main

import "fmt"

func main() {
    // åˆ›å»ºåˆ‡ç‰‡
    numbers := []int{1, 2, 3, 4, 5}

    // è¾“å‡ºåˆ‡ç‰‡
    fmt.Println("åˆ‡ç‰‡ numbersï¼š", numbers)

    // åˆ‡ç‰‡ä»ç´¢å¼• 1 åˆ°ç´¢å¼• 4
    fmt.Println("numbers[1:4]ï¼š", numbers[1:4])

    // é»˜è®¤ä¸‹é™ä¸º0
    fmt.Println("numbers[:3]ï¼š", numbers[:3])

    // é»˜è®¤ä¸Šé™ä¸º len(s)
    fmt.Println("numbers[2:]ï¼š", numbers[2:])

    // åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡ï¼Œlen=0ï¼Œcap=2
    slice1 := make([]int, 0, 2)
    fmt.Println("slice1ï¼š", slice1)

    // è¿½åŠ å…ƒç´ 
    slice1 = append(slice1, 1)
    fmt.Println("slice1ï¼š", slice1)

    // è¿½åŠ å¤šä¸ªå…ƒç´ 
    slice1 = append(slice1, 2, 3, 4)
    fmt.Println("slice1ï¼š", slice1)
}
```

Pythonï¼š
```python
# åˆ›å»ºåˆ—è¡¨
numbers = [1, 2, 3, 4, 5]

# è¾“å‡ºåˆ—è¡¨
print("åˆ—è¡¨ numbersï¼š", numbers)

# åˆ‡ç‰‡ä»ç´¢å¼• 1 åˆ°ç´¢å¼• 4
print("numbers[1:4]ï¼š", numbers[1:4])

# é»˜è®¤ä¸‹é™ä¸º0
print("numbers[:3]ï¼š", numbers[:3])

# é»˜è®¤ä¸Šé™ä¸º len(s)
print("numbers[2:]ï¼š", numbers[2:])

# åˆ›å»ºä¸€ä¸ªåˆ—è¡¨
list1 = []

# è¿½åŠ å…ƒç´ 
list1.append(1)
print("list1ï¼š", list1)

# è¿½åŠ å¤šä¸ªå…ƒç´ 
list1.extend([2, 3, 4])
print("list1ï¼š", list1)
```

rustï¼š
![](https://pic1.zhimg.com/80/v2-69da917741b2c610732d8526a9cc86f5_1440w.jpg)

```rust 
fn main() {
  let s = String::from("hello world");

  let hello = &s[0..5];
  let world = &s[6..11];
  println!("{}, {}", hello, world);
  // hello, world
}
```
å½“ç„¶ï¼Œä½ å¯ä»¥æ¨ªåˆ‡ç«–åˆ‡ï¼Œæƒ³æ€ä¹ˆåˆ‡æ€ä¹ˆåˆ‡ï¼š
1. ä»0å¼€å§‹åˆ‡
```rust
fn main() {
  let s = String::from("hello world");

  let tmp = &s[..2];
  println!("{:?}", tmp); // he
}
```
2. ä»æŸä¸ªä½ç½®åˆ‡åˆ°å°¾å·´
```rust
fn main() {
  let s = String::from("hello world");

  let tmp = &s[2..s.len()];
  println!("{:?}", tmp); // llo world
}
```
3. å®Œæ•´åˆ‡
```rust
fn main() {
  let s = String::from("hello world");

  let tmp = &s[..];
  println!("{:?}", tmp); // hello world
}
```

âš ï¸ warningï¼šåœ¨å¯¹å­—ç¬¦ä¸²ä½¿ç”¨åˆ‡ç‰‡è¯­æ³•æ—¶éœ€è¦æ ¼å¤–å°å¿ƒï¼Œåˆ‡ç‰‡çš„ç´¢å¼•å¿…é¡»è½åœ¨å­—ç¬¦ä¹‹é—´çš„è¾¹ç•Œä½ç½®ï¼Œä¹Ÿå°±æ˜¯ UTF-8 å­—ç¬¦çš„è¾¹ç•Œï¼Œä¾‹å¦‚ä¸­æ–‡åœ¨ UTF-8 ä¸­å ç”¨ä¸‰ä¸ªå­—èŠ‚ï¼Œä¸‹é¢çš„ä»£ç å°±ä¼šå´©æºƒï¼š

```rust
fn main() {
  let s = "ä¸­å›½äºº";
  let a = &s[0..2];
  println!("{}",a);
}
```

```
thread 'main' panicked at 'byte index 2 is not a char boundary; it is inside 'ä¸­' (bytes 0..3) of `ä¸­å›½äºº`', library/core/src/str/mod.rs:127:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

ä¸»çº¿ç¨‹åœ¨å­—èŠ‚ç´¢å¼•2å¤„ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªcharè¾¹ç•Œï¼›å®ƒåœ¨'ä¸­å›½äºº"ï¼Œ Library/core/src/str/mod.rs:127ï¼š5çš„'ä¸­'ï¼ˆå­—èŠ‚0â€¦3ï¼‰ä¸­
æ³¨æ„ï¼šä½¿ç”¨'RUST_BACKTRACE=1'ç¯å¢ƒå˜é‡è¿è¡Œä»¥æ˜¾ç¤ºå›æº¯
```

å› ä¸ºæˆ‘ä»¬åªå– s å­—ç¬¦ä¸²çš„å‰ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æœ¬ä¾‹ä¸­æ¯ä¸ªæ±‰å­—å ç”¨ä¸‰ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ²¡æœ‰è½åœ¨è¾¹ç•Œå¤„ï¼Œä¹Ÿå°±æ˜¯è¿ ä¸­ å­—éƒ½å–ä¸å®Œæ•´ï¼Œæ­¤æ—¶ç¨‹åºä¼šç›´æ¥å´©æºƒé€€å‡ºï¼Œå¦‚æœæ”¹æˆ &s[0..3]ï¼Œåˆ™å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚ 

```
fn main() {
  let s = "ä¸­å›½äºº";
  let a = &s[0..3];
  println!("{}",a);
}
```

å­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç±»å‹æ ‡è¯†æ˜¯ `&str`
åœ¨è¿™é‡Œå…¶å®æœ‰ç‚¹æ··ä¹±ï¼Œ`String`å’Œ`&str`æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ
> - Stringæ˜¯ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„å¯å˜å­—ç¬¦ä¸²ç±»å‹ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–ç¼©å°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› ä¸ºå®ƒåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨åœ°è°ƒæ•´å¤§å°ä»¥é€‚åº”æ›´æ”¹ã€‚
> - &stræ˜¯ä¸€ä¸ªä¸å¯å˜çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€å®ƒä¸èƒ½åŠ¨æ€åœ°æ”¹å˜å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå› ä¸ºå®ƒåªæ˜¯å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å®é™…çš„å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œ&stré€šå¸¸ç”¨äºä¸éœ€è¦ä¿®æ”¹å­—ç¬¦ä¸²çš„æƒ…å†µï¼Œä¾‹å¦‚å‡½æ•°å‚æ•°ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²æ•°æ®ä¸éœ€è¦æ‹¥æœ‰æ‰€æœ‰æƒæ—¶ä½¿ç”¨ã€‚

```rust
fn main() {
    // åˆ›å»ºä¸€ä¸ªStringç±»å‹çš„å­—ç¬¦ä¸²
    let mut s = String::from("hello");

    // åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ ä¸€ä¸ªå­—ç¬¦
    s.push(' ');

    // æ·»åŠ ä¸€ä¸ª&strç±»å‹çš„å­—ç¬¦ä¸²
    s.push_str("world");

    // ä½¿ç”¨&æ“ä½œç¬¦å°†Stringç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º&strç±»å‹çš„å­—ç¬¦ä¸²åˆ‡ç‰‡
    let slice = &s[..];

    println!("{}", slice);
}
```
åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Stringç±»å‹çš„så˜é‡åˆ›å»ºä¸€ä¸ªå¯å˜å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å…¶æœ«å°¾æ·»åŠ å­—ç¬¦å’Œå­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨&æ“ä½œç¬¦å°†Stringç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º&strç±»å‹çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™sliceå˜é‡ã€‚æœ€åï¼Œæˆ‘ä»¬æ‰“å°sliceå˜é‡ï¼Œå®ƒåŒ…å«å®Œæ•´çš„"hello world"å­—ç¬¦ä¸²ã€‚

æœ‰äº†è¿™ä¸ªç†è§£å°±å¯ä»¥æ¥çœ‹æ¯”è¾ƒå¦™çš„ä»£ç äº†ï¼š

```rust
fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s);

    s.clear(); // error!

    println!("the first word is: {}", word);
}
fn first_word(s: &String) -> &str {
    &s[..1]
}
```

æˆ‘çš„ç†è§£æ˜¯ï¼š
- `let mut s = String::from("hello world");` è¿™é‡Œæ˜¯Stringï¼Œæ‹¥æœ‰æ‰€æœ‰æƒçš„å¯å˜å­—ç¬¦ä¸²ç±»å‹
- `let word = first_word(&s);` è¿”å›ä¸€ä¸ª`&str`ï¼Œä¸å¯å˜çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹
- `s.clear()` éœ€è¦ä¸€ä¸ªå¯å˜å€Ÿç”¨ï¼Œä½†æ˜¯ç°åœ¨å·²ç»ï¼ˆwordï¼‰æ˜¯`&str`ï¼Œä¸å¯å˜çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹
- `println!("the first word is: {}", word);` éœ€è¦ä¸€ä¸ªä¸å¯å˜å€Ÿç”¨ï¼Œåœ¨ s.clear() å¤„å¯å˜å€Ÿç”¨ä¸ä¸å¯å˜å€Ÿç”¨è¯•å›¾åŒæ—¶ç”Ÿæ•ˆï¼Œå› æ­¤ç¼–è¯‘æ— æ³•é€šè¿‡ã€‚

```
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --> src/main.rs:6:5
  |
4 |     let word = first_word(&s);
  |                           -- immutable borrow occurs here // ä¸å¯å˜çš„å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
5 | 
6 |     s.clear(); // error!
  |     ^^^^^^^^^ mutable borrow occurs here // å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
7 | 
8 |     println!("the first word is: {}", word);
  |                                       ---- immutable borrow later used here // ä¸å¯å˜å€Ÿåæ¥ç”¨åœ¨è¿™é‡Œ

For more information about this error, try `rustc --explain E0502`.
error: could not compile `Demo` due to previous error
```

> æ³¨ï¼šåœ¨Rustä¸­ï¼Œå¯ä»¥ä½¿ç”¨&æ“ä½œç¬¦å°†Stringç±»å‹çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º&strç±»å‹çš„å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚è¿™ç§è½¬æ¢å¹¶ä¸æ¶‰åŠå†…å­˜åˆ†é…æˆ–å¤åˆ¶ï¼Œå› ä¸º&stråªæ˜¯ä¸€ä¸ªæŒ‡å‘Stringç±»å‹å­—ç¬¦ä¸²çš„ä¸å¯å˜å¼•ç”¨ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&strå¼•ç”¨çš„å­—ç¬¦ä¸²å¿…é¡»åœ¨Stringå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‚¬å‚å¼•ç”¨é”™è¯¯ã€‚

### å­—ç¬¦ä¸²å­—é¢é‡æ˜¯åˆ‡ç‰‡
ä¹‹å‰æåˆ°è¿‡å­—ç¬¦ä¸²å­—é¢é‡,ä½†æ˜¯æ²¡æœ‰æåˆ°å®ƒçš„ç±»å‹ï¼š

```rust
let s = "Hello, world!";
```

å®é™…ä¸Šï¼Œs çš„ç±»å‹æ˜¯ &strï¼Œå› æ­¤ä½ ä¹Ÿå¯ä»¥è¿™æ ·å£°æ˜ï¼š

```rust
let s: &str = "Hello, world!";
```

è¯¥åˆ‡ç‰‡æŒ‡å‘äº†ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æŸä¸ªç‚¹ï¼Œ**è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸º &str æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨**ã€‚

### å­—ç¬¦ä¸²ç±»å‹
- str ç±»å‹æ˜¯ç¡¬ç¼–ç è¿›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿæ— æ³•è¢«ä¿®æ”¹
- String åˆ™æ˜¯ä¸€ä¸ªå¯å¢é•¿ã€å¯æ”¹å˜ä¸”å…·æœ‰æ‰€æœ‰æƒçš„ UTF-8 ç¼–ç å­—ç¬¦ä¸²ï¼Œå½“ Rust ç”¨æˆ·æåˆ°å­—ç¬¦ä¸²æ—¶ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯ String ç±»å‹å’Œ &str å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹éƒ½æ˜¯ UTF-8 ç¼–ç ã€‚
- &str å­—ç¬¦ä¸²åˆ‡ç‰‡

### String ä¸ &str çš„è½¬æ¢
 
 &str ç±»å‹ç”Ÿæˆ String ç±»å‹çš„æ“ä½œï¼š
```rust
String::from("hello,world")
"hello,world".to_string()
```

 String ç±»å‹è½¬ä¸º &str ç±»å‹ -- å¼•ç”¨ï¼š
 
```rust
fn main() {
    let s = String::from("hello,world!"); // String
    say_hello(&s); // è¿™é‡Œå¼€å§‹è½¬æ¢æˆ&str
    say_hello(&s[..]);
    say_hello(s.as_str());
}

fn say_hello(s: &str) {
    println!("{}",s);
}
```

### å­—ç¬¦ä¸²ç´¢å¼•
åœ¨Rustä¸­ä¸‹é¢çš„ä»£ç å¦‚æœä½¿ç”¨`a[0]`åˆ™æ— æ³•è®¿é—®ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä½œä¸ºä¸€åJavaç¨‹åºå‘˜ï¼Œæ„Ÿè§‰å¾ˆè›‹ç–¼
```rust
fn main() {
    let a = "123";
    println!("{}", a[0]); // error
    println!("{}", &a[..2]); // running!
}
```
æŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼š
```rust
error[E0277]: the type `str` cannot be indexed by `{integer}`
 --> src/main.rs:3:20
  |
3 |     println!("{}", a[0]); // error
  |                    ^^^^ string indices are ranges of `usize`
  |
  = help: the trait `SliceIndex<str>` is not implemented for `{integer}`
  = note: you can use `.chars().nth()` or `.bytes().nth()`
          for more information, see chapter 8 in The Book: <https://doc.rust-lang.org/book/ch08-02-strings.html#indexing-into-strings>
  = help: the trait `SliceIndex<[T]>` is implemented for `usize`
  = note: required because of the requirements on the impl of `Index<{integer}>` for `str`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `Demo` due to previous error
```

#### åŸå› åˆ†æ
1. Rust å­—ç¬¦ä¸²åº•å±‚æ•°æ®å­˜å‚¨æ ¼å¼æ˜¯` Vec<u8>`ï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚å¯¹äºå¤šå­—èŠ‚å­—ç¬¦ï¼Œæ¯”å¦‚æ±‰å­—ï¼Œä¸€ä¸ªå­—ç¬¦å¯èƒ½ä¼šå ç”¨å¤šä¸ªå­—èŠ‚ï¼Œå› æ­¤å­—ç¬¦ä¸²é•¿åº¦ä¸å­—èŠ‚æ•°å¹¶ä¸ä¸€å®šç›¸ç­‰ã€‚

```rust
let s = String::from("ä¸­å›½äºº");
let bytes = s.as_bytes();
println!("{:?}", bytes); // è¾“å‡º [228, 184, 173, 229, 155, 189, 228, 184, 128]
```

2. Rust æä¾›äº†ä¸åŒçš„å­—ç¬¦ä¸²å±•ç°æ–¹å¼ï¼ŒåŒ…æ‹¬å­—èŠ‚ä¸²ã€Unicode å­—ç¬¦ä¸²å’Œè¯­è¨€å­—ç¬¦ä¸²ã€‚å­—èŠ‚ä¸²æ˜¯åº•å±‚å­—èŠ‚æ•°ç»„çš„ç›´æ¥å±•ç°ï¼ŒUnicode å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ chars() æ–¹æ³•è·å–ï¼Œè¯­è¨€å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ graphemes() æ–¹æ³•è·å–ã€‚

```rust
let s = String::from("à¤¨à¤®à¤¸à¥à¤¤à¥‡");
let bytes = s.as_bytes(); // å­—èŠ‚ä¸²
let chars = s.chars(); // Unicode å­—ç¬¦ä¸²
let graphemes = s.graphemes(true); // è¯­è¨€å­—ç¬¦ä¸²
println!("{:?}", bytes); // è¾“å‡º [224, 164, 168, 224, 164, 174, 224, 164, 184, 224, 165, 141, 224, 164, 164, 224, 165, 135]
println!("{:?}", chars.collect::<Vec<char>>()); // è¾“å‡º ['à¤¨', 'à¤®', 'à¤¸', 'à¥', 'à¤¤', 'à¥‡']
println!("{:?}", graphemes.collect::<Vec<&str>>()); // è¾“å‡º ["à¤¨", "à¤®", "à¤¸à¥", "à¤¤à¥‡"]
```

3. Rust ä¸å…è®¸ç›´æ¥ç´¢å¼•å­—ç¬¦ä¸²ï¼Œå³ä¸èƒ½ä½¿ç”¨ç±»ä¼¼ `str[index]` çš„æ–¹å¼è·å–å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ã€‚è¿™æ˜¯å› ä¸ºå­—ç¬¦ä¸²çš„å­—ç¬¦å¯èƒ½å ç”¨å¤šä¸ªå­—èŠ‚ï¼Œå› æ­¤æ— æ³•ä¿è¯ O(1) çš„æ€§èƒ½è¡¨ç°ã€‚å¦‚æœç¡®å®éœ€è¦è®¿é—®å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æˆ–è€…å­—ç¬¦åˆ‡ç‰‡ç­‰æ–¹å¼æ¥éå†å­—ç¬¦ä¸²ã€‚

```rust
let s = String::from("Hello, world!");
let third = s.chars().nth(2); // ç¬¬ä¸‰ä¸ªå­—ç¬¦ï¼Œè¿”å› Option<char>
let slice = &s[0..5]; // å­—ç¬¦åˆ‡ç‰‡ï¼ŒåŒ…å« s[0] åˆ° s[4]
println!("{:?}", third); // è¾“å‡º Some('l')
println!("{:?}", slice); // è¾“å‡º "Hello"
```

### å­—ç¬¦ä¸²çš„ä¸€äº›å¸¸ç”¨API

#### è¿½åŠ (push)
é¦–å…ˆä»‹ç»`push`å’Œ`push_str`
> pub fn push_str(&mut self, string: &str)
å°†ç»™å®šçš„å­—ç¬¦ä¸²åˆ‡ç‰‡è¿½åŠ åˆ°è¿™ä¸ª String çš„æœ«å°¾ã€‚

```rust
let mut s = String::from("foo");

s.push_str("bar");

assert_eq!("foobar", s);
```

> pub fn push(&mut self, ch: char)
å°†ç»™å®šçš„ char è¿½åŠ åˆ°è¯¥ String çš„æœ«å°¾ã€‚


```rust
let mut s = String::from("abc");

s.push('1');
s.push('2');
s.push('3');

assert_eq!("abc123", s);
```

> æ³¨ï¼šç›®å‰åªè¦çŸ¥é“åŒºåˆ«æ˜¯ï¼špush() æ–¹æ³•åªèƒ½æ·»åŠ å•ä¸ªå­—ç¬¦ï¼Œå¦‚æœæƒ³è¦æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦åˆ‡ç‰‡å†ä½¿ç”¨ push_str() æ–¹æ³•ã€‚

#### æ’å…¥(Insert)
> pub fn insert(&mut self, idx: usize, ch: char)
åœ¨æ­¤ String çš„å­—èŠ‚ä½ç½®æ’å…¥ä¸€ä¸ªå­—ç¬¦ã€‚è¿™æ˜¯ä¸€ä¸ª O(n) æ“ä½œï¼Œå› ä¸ºå®ƒéœ€è¦å¤åˆ¶ç¼“å†²åŒºä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚

```rust
let mut s = String::with_capacity(3);

s.insert(0, 'f');
s.insert(1, 'o');
s.insert(2, 'o');

assert_eq!("foo", s);
```


> pub fn insert_str(&mut self, idx: usize, string: &str)
   åœ¨æ­¤ String çš„å­—èŠ‚ä½ç½®å¤„æ’å…¥å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚è¿™æ˜¯ä¸€ä¸ª O(n) æ“ä½œï¼Œå› ä¸ºå®ƒéœ€è¦å¤åˆ¶ç¼“å†²åŒºä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚

```rust
let mut s = String::from("bar");

s.insert_str(0, "foo");

assert_eq!("foobar", s);
```



#### æ›¿æ¢(Replace)
> pub fn replace<'a, P>(&'a self, from: P, to: &str) -> String
> ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢æ¨¡å¼çš„æ‰€æœ‰åŒ¹é…é¡¹ã€‚
> replace åˆ›å»ºä¸€ä¸ªæ–°çš„ Stringï¼Œå¹¶å°†æ­¤å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å…¶ä¸­ã€‚ è¿™æ ·åšæ—¶ï¼Œå®ƒå°†å°è¯•æŸ¥æ‰¾æŸä¸ªæ¨¡å¼çš„åŒ¹é…é¡¹ã€‚ å¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚


```rust
let s = "this is old";

assert_eq!("this is new", s.replace("old", "new"));
```
å½“æ¨¡å¼ä¸åŒ¹é…æ—¶ï¼š

```rust
let s = "this is old";
assert_eq!(s, s.replace("cookie monster", "little lamb"));
```


> pub fn replacen<'a, P>(&'a self, pat: P, to: &str, count: usize) -> String
> ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢æ¨¡å¼çš„å‰ N ä¸ªåŒ¹é…é¡¹ã€‚
	replacen åˆ›å»ºä¸€ä¸ªæ–°çš„ Stringï¼Œå¹¶å°†æ­¤å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å…¶ä¸­ã€‚ è¿™æ ·åšæ—¶ï¼Œå®ƒå°†å°è¯•æŸ¥æ‰¾æŸä¸ªæ¨¡å¼çš„åŒ¹é…é¡¹ã€‚ å¦‚æœæ‰¾åˆ°ä»»ä½•å†…å®¹ï¼Œåˆ™æœ€å¤š count æ¬¡å°†å®ƒä»¬æ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚


```rust
let s = "foo foo 123 foo";
assert_eq!("new new 123 foo", s.replacen("foo", "new", 2));
assert_eq!("faa fao 123 foo", s.replacen('o', "a", 3));
assert_eq!("foo foo new23 foo", s.replacen(char::is_numeric, "new", 1));
```
ä¸åŒ¹é…æ—¶ï¼š

```rust
let s = "this is old";
assert_eq!(s, s.replacen("cookie monster", "little lamb", 10));
```



> pub fn replace_range`<R>`(&mut self, range: R, replace_with: &str) 
>åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šèŒƒå›´ï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºç»™å®šçš„å­—ç¬¦ä¸²ã€‚ ç»™å®šçš„å­—ç¬¦ä¸²ä¸å¿…ä¸èŒƒå›´ç›¸åŒã€‚


```rust
let mut s = String::from("Î± is alpha, Î² is beta");
let beta_offset = s.find('Î²').unwrap_or(s.len());

// æ›¿æ¢èŒƒå›´ç›´åˆ°å­—ç¬¦ä¸²ä¸­çš„ Î²
s.replace_range(..beta_offset, "Î‘ is capital alpha; ");
assert_eq!(s, "Î‘ is capital alpha; Î² is beta");
```


#### åˆ é™¤
> pub fn pop(&mut self) -> Option`<char>`
> ä»å­—ç¬¦ä¸²ç¼“å†²åŒºä¸­åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦å¹¶è¿”å›å®ƒã€‚
> å¦‚æœ String ä¸ºç©ºï¼Œåˆ™è¿”å› Noneã€‚


```rust
let mut s = String::from("foo");

assert_eq!(s.pop(), Some('o'));
assert_eq!(s.pop(), Some('o'));
assert_eq!(s.pop(), Some('f'));

assert_eq!(s.pop(), None);
```

>pub fn remove(&mut self, idx: usize) -> char
>ä»è¯¥ String çš„å­—èŠ‚ä½ç½®åˆ é™¤ char å¹¶å°†å…¶è¿”å›ã€‚
>è¿™æ˜¯ O(n) æ“ä½œï¼Œå› ä¸ºå®ƒéœ€è¦å¤åˆ¶ç¼“å†²åŒºä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚


```rust
let mut s = String::from("foo");

assert_eq!(s.remove(0), 'f');
assert_eq!(s.remove(1), 'o');
assert_eq!(s.remove(0), 'o');
```

> pub fn truncate(&mut self, new_len: usize)
> å°†æ­¤ String ç¼©çŸ­ä¸ºæŒ‡å®šçš„é•¿åº¦ã€‚
> å¦‚æœ new_len å¤§äºå­—ç¬¦ä¸²çš„å½“å‰é•¿åº¦ï¼Œåˆ™æ— æ•ˆã€‚
> è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•å¯¹å­—ç¬¦ä¸²çš„åˆ†é…å®¹é‡æ²¡æœ‰å½±å“


```rust
let mut s = String::from("hello");

s.truncate(2);

assert_eq!("he", s);
```

> pub fn clear(&mut self)
> æˆªæ–­æ­¤ Stringï¼Œåˆ é™¤æ‰€æœ‰å†…å®¹ã€‚
> è™½ç„¶è¿™æ„å‘³ç€ String çš„é•¿åº¦ä¸ºé›¶ï¼Œä½†å®ƒå¹¶æœªè§¦åŠå…¶å®¹é‡ã€‚


```rust
let mut s = String::from("foo");

s.clear();

assert!(s.is_empty());
assert_eq!(0, s.len());
assert_eq!(3, s.capacity());
```


#### è¿æ¥ (Concatenate)

1. ä½¿ç”¨ + æˆ–è€… += è¿æ¥å­—ç¬¦ä¸²
ç†è®ºä¸Šæ¥è¯´ï¼Œå¯¹äºJavaç¨‹åºå‘˜ï¼Œç›´æ¥ä¸Šå°±å®Œäº‹ã€‚But

```rust
fn main() {
    let string_append = String::from("hello ");
    let string_rust = String::from("rust");
    println!("{}", string_append + string_rust)
}
```
æŠ¥é”™å¦‚ä¸‹ï¼š

```
error[E0308]: mismatched types
 --> src/main.rs:4:36
  |
4 |     println!("{}", string_append + string_rust)
  |                                    ^^^^^^^^^^^
  |                                    |
  |                                    expected `&str`, found struct `String`
  |                                    help: consider borrowing here: `&string_rust`

For more information about this error, try `rustc --explain E0308`.
error: could not compile `Demo` due to previous error
```
æŸ¥çœ‹åˆ«äººå†™ä»£ç æ˜¯è¿™æ ·ï¼š
> let result = string_append + &string_rust;

ç„¶åå°±æœ‰è¿™æ ·çš„ç–‘æƒ‘ï¼š`ä¸ºä»€ä¹ˆæˆ‘è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªStringç±»å‹çš„ä¸ç”¨å¼•ç”¨ï¼Œç¬¬äºŒä¸ªä»¥åŠåé¢çš„è¦å¼•ç”¨ï¼Ÿ`
åŸå› æ˜¯ï¼Œåœ¨ Rust ä¸­ï¼Œ+ è¿ç®—ç¬¦ç”¨äºå­—ç¬¦ä¸²è¿æ¥ï¼Œä½†æ˜¯å®ƒçš„å®ç°æ–¹å¼ä¸æˆ‘ä»¬ç†Ÿæ‚‰çš„åŠ æ³•è¿ç®—ç¬¦ä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œ+ è¿ç®—ç¬¦ä¼šè°ƒç”¨ add æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š
> fn add(self, s: &str) -> String

å¯ä»¥çœ‹åˆ°ï¼Œadd æ–¹æ³•æ¥æ”¶ä¸€ä¸ª self å‚æ•°å’Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ s å‚æ•°ã€‚ç”±äº self å‚æ•°çš„ç±»å‹æ˜¯ Stringï¼Œè€Œ s å‚æ•°çš„ç±»å‹æ˜¯ &strï¼Œå› æ­¤åœ¨ä½¿ç”¨ + è¿ç®—ç¬¦è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥æ˜¯ String ç±»å‹ï¼Œè€Œ`ç¬¬äºŒä¸ªåŠä¹‹åçš„å­—ç¬¦ä¸²å¿…é¡»æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹`ã€‚

æ‰€ä»¥æœ€ç»ˆä»£ç æ˜¯

```rust
fn main() {
    let string_append = String::from("hello ");
    let string_rust = String::from("rust");
    let string_world = String::from("world");
    println!("{}", string_append + &string_rust + &string_world);
}
```
æ€»ç»“ï¼šString + &strè¿”å›ä¸€ä¸ª Stringï¼Œç„¶åå†ç»§ç»­è·Ÿä¸€ä¸ª &str è¿›è¡Œ + æ“ä½œï¼Œè¿”å›ä¸€ä¸ª String ç±»å‹ï¼Œä¸æ–­å¾ªç¯ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ª sï¼Œä¹Ÿæ˜¯ String ç±»å‹ã€‚

s1 è¿™ä¸ªå˜é‡é€šè¿‡è°ƒç”¨ add() æ–¹æ³•åï¼Œæ‰€æœ‰æƒè¢«è½¬ç§»åˆ° add() æ–¹æ³•é‡Œé¢ï¼Œ add() æ–¹æ³•è°ƒç”¨åå°±è¢«é‡Šæ”¾äº†ï¼ŒåŒæ—¶ s1 ä¹Ÿè¢«é‡Šæ”¾äº†ã€‚å†ä½¿ç”¨ s1 å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚è¿™é‡Œæ¶‰åŠåˆ°`æ‰€æœ‰æƒè½¬ç§»ï¼ˆMoveï¼‰`çš„ç›¸å…³çŸ¥è¯†ã€‚

2. ä½¿ç”¨ format! è¿æ¥å­—ç¬¦ä¸²

```rust
fn main() {
    let s1 = "hello";
    let s2 = String::from("rust");
    let s = format!("{} {}!", s1, s2);
    println!("{}", s);
}
```

### æ“ä½œ UTF-8 å­—ç¬¦ä¸²
å¦‚æœä½ æƒ³è¦ä»¥ Unicode å­—ç¬¦çš„æ–¹å¼éå†å­—ç¬¦ä¸²ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ chars æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

```rust
for c in "ä¸­å›½äºº".chars() {
    println!("{}", c);
}
```

å¦‚æœè¦è¿”å›å­—ç¬¦ä¸²çš„åº•å±‚å­—èŠ‚æ•°ç»„è¡¨ç°å½¢å¼ï¼š

```rust
for b in "ä¸­å›½äºº".bytes() {
    println!("{}", b);
}
```

æƒ³è¦å‡†ç¡®çš„ä» UTF-8 å­—ç¬¦ä¸²ä¸­è·å–å­ä¸²æ˜¯è¾ƒä¸ºå¤æ‚çš„äº‹æƒ…ï¼Œä¾‹å¦‚æƒ³è¦ä» hollaä¸­å›½äººà¤¨à¤®à¤¸à¥à¤¤à¥‡ è¿™ç§å˜é•¿çš„å­—ç¬¦ä¸²ä¸­å–å‡ºæŸä¸€ä¸ªå­ä¸²ï¼Œä½¿ç”¨æ ‡å‡†åº“ä½ æ˜¯åšä¸åˆ°çš„ã€‚ ä½ éœ€è¦åœ¨ crates.io ä¸Šæœç´¢ utf8 æ¥å¯»æ‰¾æƒ³è¦çš„åŠŸèƒ½ã€‚

å¯ä»¥è€ƒè™‘å°è¯•ä¸‹è¿™ä¸ªåº“ï¼š`utf8_slice`ã€‚

### å­—ç¬¦ä¸²æ·±åº¦å‰–æ
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºå•¥ String å¯å˜ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢å€¼ str å´ä¸å¯ä»¥ï¼Ÿ

å°±å­—ç¬¦ä¸²å­—é¢å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæœ€ç»ˆå­—é¢å€¼æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆï¼Œè¿™ä¸»è¦å¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†è·å¾—è¿™ç§æ€§èƒ½ï¼Œè€ŒæŠŠæ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬éƒ½æ”¾è¿›å†…å­˜ä¸­ï¼ˆä½ ä¹Ÿåšä¸åˆ°ï¼ï¼‰ï¼Œå› ä¸ºæœ‰çš„å­—ç¬¦ä¸²æ˜¯åœ¨ç¨‹åºè¿è¡Œå¾—è¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆçš„ã€‚

å¯¹äº String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ã€å¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å®Œæˆçš„ï¼š

é¦–å…ˆå‘æ“ä½œç³»ç»Ÿè¯·æ±‚å†…å­˜æ¥å­˜æ”¾ String å¯¹è±¡
åœ¨ä½¿ç”¨å®Œæˆåï¼Œå°†å†…å­˜é‡Šæ”¾ï¼Œå½’è¿˜ç»™æ“ä½œç³»ç»Ÿ
å…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†ç”± String::from å®Œæˆï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„ Stringã€‚

é‡ç‚¹æ¥äº†ï¼Œåˆ°äº†ç¬¬äºŒéƒ¨åˆ†ï¼Œå°±æ˜¯ç™¾å®¶é½æ”¾çš„ç¯èŠ‚ï¼Œåœ¨æœ‰åƒåœ¾å›æ”¶ GC çš„è¯­è¨€ä¸­ï¼ŒGC æ¥è´Ÿè´£æ ‡è®°å¹¶æ¸…é™¤è¿™äº›ä¸å†ä½¿ç”¨çš„å†…å­˜å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹éƒ½æ˜¯è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€å¼€å‘è€…å…³å¿ƒï¼Œéå¸¸ç®€å•å¥½ç”¨ï¼›ä½†æ˜¯åœ¨æ—  GC çš„è¯­è¨€ä¸­ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»é‡Šæ”¾è¿™äº›å†…å­˜å¯¹è±¡ï¼Œå°±åƒåˆ›å»ºå¯¹è±¡éœ€è¦é€šè¿‡ç¼–å†™ä»£ç æ¥å®Œæˆä¸€æ ·ï¼Œæœªèƒ½æ­£ç¡®é‡Šæ”¾å¯¹è±¡é€ æˆçš„åæœç®€ç›´ä¸å¯ä¼°é‡ã€‚

å¯¹äº Rust è€Œè¨€ï¼Œå®‰å…¨å’Œæ€§èƒ½æ˜¯å†™åˆ°éª¨å­é‡Œçš„æ ¸å¿ƒç‰¹æ€§ï¼Œå¦‚æœä½¿ç”¨ GCï¼Œé‚£ä¹ˆä¼šç‰ºç‰²æ€§èƒ½ï¼›å¦‚æœä½¿ç”¨æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆä¼šç‰ºç‰²å®‰å…¨ï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿä¸ºæ­¤ï¼ŒRust çš„å¼€å‘è€…æƒ³å‡ºäº†ä¸€ä¸ªæ— æ¯”æƒŠè‰³çš„åŠæ³•ï¼šå˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå°±è‡ªåŠ¨é‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ï¼š

```rust
{
    let s = String::from("hello"); // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„

    // ä½¿ç”¨ s
}                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ
                                   // s ä¸å†æœ‰æ•ˆï¼Œå†…å­˜è¢«é‡Šæ”¾
```
ä¸å…¶å®ƒç³»ç»Ÿç¼–ç¨‹è¯­è¨€çš„ free å‡½æ•°ç›¸åŒï¼ŒRust ä¹Ÿæä¾›äº†ä¸€ä¸ªé‡Šæ”¾å†…å­˜çš„å‡½æ•°ï¼š dropï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œå…¶å®ƒè¯­è¨€è¦æ‰‹åŠ¨è°ƒç”¨ free æ¥é‡Šæ”¾æ¯ä¸€ä¸ªå˜é‡å ç”¨çš„å†…å­˜ï¼Œè€Œ Rust åˆ™åœ¨å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ drop å‡½æ•°: ä¸Šé¢ä»£ç ä¸­ï¼ŒRust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚

> å…¶å®ï¼Œåœ¨ C++ ä¸­ï¼Œä¹Ÿæœ‰è¿™ç§æ¦‚å¿µ: Resource Acquisition Is Initialization (RAII)ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ RAII æ¨¡å¼çš„è¯åº”è¯¥å¯¹ Rust çš„ drop å‡½æ•°å¹¶ä¸é™Œç”Ÿã€‚

è¿™ä¸ªæ¨¡å¼å¯¹ç¼–å†™ Rust ä»£ç çš„æ–¹å¼æœ‰ç€æ·±è¿œçš„å½±å“ï¼Œåœ¨åé¢ç« èŠ‚æˆ‘ä»¬ä¼šè¿›è¡Œæ›´æ·±å…¥çš„ä»‹ç»ã€‚

## 1.5 ğŸ¥¥ å…ƒç»„
ä¸å¤šä»‹ç»ï¼Œç›´æ¥çœ‹ç¤ºä¾‹å³å¯ï¼š

```rust
fn main() {
    let s1 = String::from("hello");

    let (s2, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s2, len);
}

fn calculate_length(s: String) -> (String, usize) {
    let length = s.len(); // len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦

    (s, length)
}
```

## 1.6 ğŸ§‡ ç»“æ„ä½“


### ä¸€èˆ¬å®šä¹‰
ç»“æ„ä½“æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå®ƒä¸Goè¯­è¨€ã€c/cppçš„ç»“æ„ä½“æ€æƒ³éƒ½å·®ä¸å¤šï¼Œé‚£ä¹ˆå°±å…ˆç”¨å…¶ä»–è¯­è¨€æ¸å…¥ä½³å¢ƒ

C/C++è¯­è¨€ç»“æ„ä½“ï¼šC/C++è¯­è¨€ä¸­çš„ç»“æ„ä½“å®šä¹‰ä½¿ç”¨å…³é”®å­— structï¼Œå¹¶ä¸”ä½¿ç”¨èŠ±æ‹¬å·åŒ…å«æˆå‘˜å˜é‡ã€‚

```rust
#include <stdio.h>

struct Person {
  char *name;
  int age;
};

int main() {
  struct Person p = {"John", 30};
  printf("Name: %s, Age: %d\n", p.name, p.age);
  return 0;
}
```

Goè¯­è¨€ç»“æ„ä½“ï¼šGoè¯­è¨€ä¸­çš„ç»“æ„ä½“å®šä¹‰ä½¿ç”¨å…³é”®å­— typeï¼Œå¹¶ä¸”ä½¿ç”¨èŠ±æ‹¬å·åŒ…å«æˆå‘˜å˜é‡
```go
package main

import "fmt"

type Person struct {
  name string
  age  int
}

func main() {
  p := Person{"John", 30}
  fmt.Printf("Name: %s, Age: %d\n", p.name, p.age)
}
```

Rustç»“æ„ä½“ï¼šRustè¯­è¨€ä¸­çš„ç»“æ„ä½“å®šä¹‰ä½¿ç”¨å…³é”®å­— structï¼Œå¹¶ä¸”ä½¿ç”¨èŠ±æ‹¬å·åŒ…å«æˆå‘˜å˜é‡ï¼Œä½†æ˜¯æˆå‘˜å˜é‡çš„å®šä¹‰ä½¿ç”¨äº†å†’å·å’Œç±»å‹æ³¨è§£ã€‚

```rust
struct Person {
  name: String,
  age: u32,
}

fn main() {
  let p = Person { name: String::from("John"), age: 30 };
  println!("Name: {}, Age: {}", p.name, p.age);
}
```

### ç»“æ„ä½“çš„å†…å­˜æ’åˆ—
ä¸‹é¢å¯ä»¥æ‰‹æ‰“ä¸‹ä¸‹é¢çš„ä»£ç ï¼š

```rust
#[derive(Debug)]
struct File {
  name: String,
  data: Vec<u8>,
}

fn main() {
  let file = File {
    name: String::from("f1.txt"),
    data: Vec::new()
  };

  let file_name = file.name;
  let file_data_len = file.data.len();

  println!("{:?}", file);
   println!("{} is {} bytes long", file_name, file_data_len);
}
```
å…¶å®è¿™æ®µä»£ç æ˜¯é”™è¯¯çš„ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œå½“ä½ ä½¿ç”¨ let file_name = file.name; å’Œ let file_data_len = file.data.len(); æ—¶ï¼Œä½ å°† file çš„ name å’Œ data å­—æ®µçš„æ‰€æœ‰æƒç§»åŠ¨åˆ°äº† file_name å’Œ file_data_len å˜é‡ä¸­ã€‚å› æ­¤ï¼Œå½“ä½ å°è¯•æ‰“å° file å˜é‡æ—¶ï¼Œå®ƒå·²ç»å¤±å»äº† name å’Œ data å­—æ®µçš„æ‰€æœ‰æƒï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚æ­£å¥½å¤ä¹ ä¸€ä¸‹æ‰€æœ‰æƒ

åªè¦åŠ ä¸Š`&`å³å¯ï¼Œå‘Šè¯‰Rustå€Ÿæˆ‘ç”¨ä¸‹ï¼Œç”¨å®Œè¿˜ä½ ï¼š

```rust
let file_name = &file.name;
let file_data_len = file.data.len();
```
è¿›å…¥æ­£é¢˜ï¼Œä¸Šé¢å®šä¹‰çš„ File ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„æ’åˆ—å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](https://pic3.zhimg.com/80/v2-8cc4ed8cd06d60f974d06ca2199b8df5_1440w.png)
ä»å›¾ä¸­å¯ä»¥æ¸…æ™°åœ°çœ‹å‡º File ç»“æ„ä½“ä¸¤ä¸ªå­—æ®µ name å’Œ data åˆ†åˆ«æ‹¥æœ‰åº•å±‚ä¸¤ä¸ª [u8] æ•°ç»„çš„æ‰€æœ‰æƒ(String ç±»å‹çš„åº•å±‚ä¹Ÿæ˜¯ [u8] æ•°ç»„)ï¼Œé€šè¿‡ ptr æŒ‡é’ˆæŒ‡å‘åº•å±‚æ•°ç»„çš„å†…å­˜åœ°å€ï¼Œè¿™é‡Œä½ å¯ä»¥æŠŠ ptr æŒ‡é’ˆç†è§£ä¸º Rust ä¸­çš„å¼•ç”¨ç±»å‹ã€‚
> å…³äº ptr æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘åº•å±‚æ•°ç»„å†…å­˜åœ°å€çš„æŒ‡é’ˆã€‚åœ¨ Rust ä¸­ï¼Œå¼•ç”¨ç±»å‹ä¹Ÿæ˜¯æŒ‡é’ˆç±»å‹ï¼Œå› æ­¤ä½ å¯ä»¥å°† ptr æŒ‡é’ˆç†è§£ä¸º Rust ä¸­çš„å¼•ç”¨ç±»å‹ã€‚å½“ä½ ä½¿ç”¨ & ç¬¦å·æ¥å€Ÿç”¨ name å­—æ®µæ—¶ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ name å­—æ®µåº•å±‚æ•°ç»„å†…å­˜åœ°å€çš„å¼•ç”¨ã€‚è¿™ä¸ªå¼•ç”¨ä¸æ‹¥æœ‰åº•å±‚æ•°ç»„çš„æ‰€æœ‰æƒï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¸ç§»åŠ¨æ‰€æœ‰æƒçš„æƒ…å†µä¸‹è®¿é—® name å­—æ®µã€‚

è¯¥å›¾ç‰‡ä¹Ÿä¾§é¢å°è¯äº†ï¼š**æŠŠç»“æ„ä½“ä¸­å…·æœ‰æ‰€æœ‰æƒçš„å­—æ®µè½¬ç§»å‡ºå»åï¼Œå°†æ— æ³•å†è®¿é—®è¯¥å­—æ®µï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®å…¶å®ƒçš„å­—æ®µã€‚**

å¾ˆæŠ½è±¡ï¼Œéå¸¸æŠ½è±¡ã€‚ä¸Šé¢è¿™æ®µè¯æ˜¯æˆ‘æ¬è¿äº†ä½œè€…çš„è¯ï¼Œä½†æ˜¯ä¸ªäººæ¥è¯´ä¸æ˜¯å¾ˆç†è§£ã€‚ç»è¿‡ç ”ç©¶æˆ‘çš„ç†è§£æ˜¯ï¼šFile ç»“æ„ä½“çš„ name å’Œ data å­—æ®µéƒ½æ˜¯æ‹¥æœ‰åº•å±‚ [u8] æ•°ç»„çš„æ‰€æœ‰æƒçš„ã€‚åœ¨ Rust ä¸­ï¼ŒString ç±»å‹çš„åº•å±‚ä¹Ÿæ˜¯ [u8] æ•°ç»„ã€‚å› æ­¤ï¼Œname å­—æ®µæ‹¥æœ‰ String ç±»å‹çš„åº•å±‚ [u8] æ•°ç»„çš„æ‰€æœ‰æƒï¼Œè€Œ data å­—æ®µæ‹¥æœ‰ `Vec<u8>` ç±»å‹çš„åº•å±‚ [u8] æ•°ç»„çš„æ‰€æœ‰æƒã€‚
å³ï¼Œåœ¨ Rust ä¸­ï¼Œæ‰€æœ‰æƒæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚å½“ä½ å°†ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå˜é‡ä¸­æ—¶ï¼ŒåŸå§‹å˜é‡å°†å¤±å»å¯¹è¯¥å€¼çš„æ‰€æœ‰æƒã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½å†è®¿é—®è¯¥å€¼ï¼Œå› ä¸ºå®ƒå·²ç»è¢«ç§»åŠ¨åˆ°äº†å…¶ä»–åœ°æ–¹ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå½“ä½ å°† file.name å’Œ file.data çš„æ‰€æœ‰æƒç§»åŠ¨åˆ° file_name å’Œ file_data_len å˜é‡ä¸­æ—¶ï¼Œfile å˜é‡å°†å¤±å»å¯¹è¿™äº›å€¼çš„æ‰€æœ‰æƒã€‚å› æ­¤ï¼Œä½ ä¸èƒ½å†è®¿é—® file.name å’Œ file.data å­—æ®µäº†ã€‚

æˆ‘ä¸ä¿¡ä¸èƒ½è®¿é—®ï¼Œæ‰€ä»¥æˆ‘åšäº†ä¸‹é¢çš„å®éªŒï¼š

```rust
fn main() {
  let file = File {
    name: String::from("f1.txt"),
    data: Vec::new()
  };

  let file_name = file.name;
  let file_data_len = file.data.len();

  println!("{}", file.name); // error: è½¬ç§»äº†æ‰€æœ‰æƒ
  println!("{}", file.data); // error: è½¬ç§»äº†æ‰€æœ‰æƒ

  println!("{:?}", file);
  println!("{} is {} bytes long", file_name, file_data_len);
}
```
æœç„¶æŠ¥é”™äº†ï¼š

```
error[E0277]: `Vec<u8>` doesn't implement `std::fmt::Display`
  --> src/main.rs:17:18
   |
17 |   println!("{}", file.data);
   |                  ^^^^^^^^^ `Vec<u8>` cannot be formatted with the default formatter // æ— æ³•<u8>ä½¿ç”¨é»˜è®¤æ ¼å¼åŒ–ç¨‹åºæ ¼å¼åŒ–â€œVecâ€
   |
   = help: the trait `std::fmt::Display` is not implemented for `Vec<u8>`
   = helpï¼štrait `stdï¼šï¼šfmtï¼šï¼šDisplay`æœªä¸º`Vec `å®ç°<u8> 
   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
   = æ³¨æ„ï¼šåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`{ï¼šï¼Ÿ}` (orè”ç³»æˆ‘ä»¬ for pretty-printï¼‰ä»£æ›¿
   = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)
   = æ³¨æ„ï¼šæ­¤é”™è¯¯æºäºå®`$crateï¼šï¼šformat_args_nl`ï¼ˆåœ¨Nightly buildä¸­ï¼Œä½¿ç”¨-Zå®å›æº¯è¿è¡Œä»¥è·å–æ›´å¤šä¿¡æ¯ï¼‰
For more information about this error, try `rustc --explain E0277`.
error: could not compile `Demo` due to previous error
```



### å…ƒç»„ç»“æ„ä½“(Tuple Struct)
çœ‹ç¤ºä¾‹å³å¯å­¦ä¹ 
```rust
#![allow(unused)]
fn main() {
    struct Color(i32, i32, i32);
    struct Point(i32, i32, i32);

    let black = Color(0, 0, 0);
    let origin = Point(0, 0, 0);
}

```


### å•å…ƒç»“æ„ä½“(Unit-like Struct)
åœ¨Rustä¸­ï¼Œå•å…ƒç»“æ„ä½“ï¼ˆUnit-like Structï¼‰æ˜¯ä¸€ç§ç±»ä¼¼äºå…ƒç»„ç»“æ„ä½“çš„ç»“æ„ä½“ï¼Œä½†å®ƒä¸åŒ…å«ä»»ä½•å­—æ®µã€‚å…·ä½“æ¥è¯´ï¼Œå•å…ƒç»“æ„ä½“çš„å®šä¹‰å½¢å¼ä¸ºï¼šstruct MyUnitStruct;ï¼Œå®ƒä¸åŒ…å«ä»»ä½•å­—æ®µï¼Œä¹Ÿä¸éœ€è¦ä»»ä½•è¯­å¥ä½œä¸ºç»“æ„ä½“å®šä¹‰çš„ä¸»ä½“ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹æä¾›ä¸€ç§ç©ºç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæŸä¸ªæ“ä½œæˆ–çŠ¶æ€çš„å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨ã€‚

å•å…ƒç»“æ„ä½“çš„å®šä¹‰å½¢å¼å’Œæ™®é€šç»“æ„ä½“çš„å®šä¹‰å½¢å¼éå¸¸ç±»ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥ä½¿ç”¨implå—æ¥ä¸ºå®ƒå®šä¹‰æ–¹æ³•ã€‚åœ¨ä½¿ç”¨å•å…ƒç»“æ„ä½“æ—¶ï¼Œé€šå¸¸åªéœ€è¦ä½¿ç”¨å®ƒçš„ç±»å‹åå³å¯ï¼Œå› ä¸ºå®ƒä¸åŒ…å«ä»»ä½•å­—æ®µã€‚

å•å…ƒç»“æ„ä½“åœ¨Rustä¸­çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ç§ç©ºç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæŸä¸ªæ“ä½œæˆ–çŠ¶æ€çš„å­˜åœ¨æˆ–è€…ä¸å­˜åœ¨ï¼Œæ¯”å¦‚åœ¨æŸäº›å‡½æ•°ä¸­ï¼Œå¯èƒ½éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå‚æ•°å¹¶ä¸éœ€è¦ä½¿ç”¨ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨å•å…ƒç»“æ„ä½“ä½œä¸ºå‚æ•°ç±»å‹ï¼Œè¡¨ç¤ºè¿™ä¸ªæ“ä½œéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå‚æ•°æ˜¯æ²¡æœ‰ç”¨çš„ã€‚
```rust

#![allow(unused)]
fn main() {
	struct AlwaysEqual;
	
	let subject = AlwaysEqual;
	
	// æˆ‘ä»¬ä¸å…³å¿ƒ AlwaysEqual çš„å­—æ®µæ•°æ®ï¼Œåªå…³å¿ƒå®ƒçš„è¡Œä¸ºï¼Œå› æ­¤å°†å®ƒå£°æ˜ä¸ºå•å…ƒç»“æ„ä½“ï¼Œç„¶åå†ä¸ºå®ƒå®ç°æŸä¸ªç‰¹å¾
	impl SomeTrait for AlwaysEqual {
	
	}
}

```


### ç»“æ„ä½“æ•°æ®çš„æ‰€æœ‰æƒ
åœ¨ä¹‹å‰çš„ User ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼Œæœ‰ä¸€å¤„ç»†èŠ‚ï¼šæˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ String ç±»å‹è€Œä¸æ˜¯åŸºäºå¼•ç”¨çš„ &str å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„è€Œä¸ºä¹‹çš„é€‰æ‹©ï¼šå› ä¸ºæˆ‘ä»¬æƒ³è¦è¿™ä¸ªç»“æ„ä½“æ‹¥æœ‰å®ƒæ‰€æœ‰çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä»å…¶å®ƒåœ°æ–¹å€Ÿç”¨æ•°æ®ã€‚
ä½ ä¹Ÿå¯ä»¥è®© User ç»“æ„ä½“ä»å…¶å®ƒå¯¹è±¡å€Ÿç”¨æ•°æ®ï¼Œä¸è¿‡è¿™ä¹ˆåšï¼Œå°±éœ€è¦å¼•å…¥ç”Ÿå‘½å‘¨æœŸ(lifetimes)è¿™ä¸ªæ–°æ¦‚å¿µï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚çš„æ¦‚å¿µï¼‰ï¼Œç®€è€Œè¨€ä¹‹ï¼Œç”Ÿå‘½å‘¨æœŸèƒ½ç¡®ä¿ç»“æ„ä½“çš„ä½œç”¨èŒƒå›´è¦æ¯”å®ƒæ‰€å€Ÿç”¨çš„æ•°æ®çš„ä½œç”¨èŒƒå›´è¦å°ã€‚

æ€»ä¹‹ï¼Œå¦‚æœä½ æƒ³åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ä¸€ä¸ªå¼•ç”¨ï¼Œå°±å¿…é¡»åŠ ä¸Šç”Ÿå‘½å‘¨æœŸï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼š

```rust
	struct User {
	    username: &str,
	    email: &str,
	    sign_in_count: u64,
	    active: bool,
	}
	
	fn main() {
	    let user1 = User {
	        email: "someone@example.com",
	        username: "someusername123",
	        active: true,
	        sign_in_count: 1,
	    };
	}

```


```
error[E0106]: missing lifetime specifier
 --> src/main.rs:2:15
  |
2 |     username: &str,
  |               ^ expected named lifetime parameter // éœ€è¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ
  |
help: consider introducing a named lifetime parameter // è€ƒè™‘åƒä¸‹é¢çš„ä»£ç è¿™æ ·å¼•å…¥ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ
  |
1 ~ struct User<'a> {
2 ~     username: &'a str,
  |

error[E0106]: missing lifetime specifier
 --> src/main.rs:3:12
  |
3 |     email: &str,
  |            ^ expected named lifetime parameter
  |
help: consider introducing a named lifetime parameter
  |
1 ~ struct User<'a> {
2 |     username: &str,
3 ~     email: &'a str,
  |

```


### ä½¿ç”¨ #[derive(Debug)] æ¥æ‰“å°ç»“æ„ä½“çš„ä¿¡æ¯
åœ¨å‰é¢çš„ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨ #[derive(Debug)] å¯¹ç»“æ„ä½“è¿›è¡Œäº†æ ‡è®°ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ println!("{:?}", s); çš„æ–¹å¼å¯¹å…¶è¿›è¡Œæ‰“å°è¾“å‡ºï¼Œå¦‚æœä¸åŠ ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:

```rust
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {}", rect1);
}

```


```
error[E0277]: `Rectangle` doesn't implement `std::fmt::Display`
  --> src/main.rs:12:29
   |
12 |     println!("rect1 is {}", rect1);
   |                             ^^^^^ `Rectangle` cannot be formatted with the default formatter
   |
   = help: the trait `std::fmt::Display` is not implemented for `Rectangle`
   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
   = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)

For more information about this error, try `rustc --explain E0277`.
error: could not compile `Demo` due to previous error
```


#[derive(Debug)]æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå®ç°Debug traitçš„ä»£ç ã€‚Debug traitæ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•çš„traitï¼Œå®ƒå…è®¸æˆ‘ä»¬æ‰“å°å‡ºç»“æ„ä½“çš„å†…å®¹ï¼Œä»¥ä¾¿äºè°ƒè¯•ç¨‹åºã€‚å› æ­¤ï¼Œæ¯æ¬¡æ‰“å°ç»“æ„ä½“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»“æ„ä½“ä¸ŠåŠ ä¸Š#[derive(Debug)]ï¼Œä»¥ä¾¿äºä½¿ç”¨println!å®æ‰“å°å‡ºç»“æ„ä½“çš„å†…å®¹ã€‚
- å®šä¹‰ï¼š`#[derive(Debug)]`
- æ‰“å°éœ€è¦ï¼š`{:?}`

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {:?}", rect1);
}
```


è¿˜æœ‰ä¸€ä¸ªç®€å•çš„è¾“å‡º debug ä¿¡æ¯çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ dbg! å®ï¼Œå®ƒä¼šæ‹¿èµ°è¡¨è¾¾å¼çš„æ‰€æœ‰æƒï¼Œç„¶åæ‰“å°å‡ºç›¸åº”çš„æ–‡ä»¶åã€è¡Œå·ç­‰ debug ä¿¡æ¯ï¼Œå½“ç„¶è¿˜æœ‰æˆ‘ä»¬éœ€è¦çš„è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒæœ€ç»ˆè¿˜ä¼šæŠŠè¡¨è¾¾å¼å€¼çš„æ‰€æœ‰æƒè¿”å›ï¼
> dbg! è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯è¾“å‡º stderrï¼Œè€Œ println! è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º stdoutã€‚

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let scale = 2;
    let rect1 = Rectangle {
        width: dbg!(30 * scale),
        height: 50,
    };

    dbg!(&rect1);
}
```



## 1.7 æšä¸¾
#### æšä¸¾çš„ä¸€èˆ¬å†™æ³•

```rust
#[derive(Debug)]
enum Poker {
    Clubs,
    Spade,
    Diamonds,
    Hearts,
}

fn main() {
    let heart = Poker::Hearts;
    let diamonds = Poker::Diamonds;

    println!("{:?}", heart);
    println!("{:?}", diamonds);
}
```

å­¦ä¹ åˆ°è¿™é‡Œæˆ‘æ„Ÿè§‰å¿½ç•¥äº†ä¸€ä¸ªç»†èŠ‚ï¼Œæˆ‘ä»¥ä¸º`#[derive(Debug)]`æ”¾åˆ°ç¨‹åºå¤´å°±å¯ä»¥è®©æ¯ä¸€ä¸ªç»“æ„ä½“æ‰“å°ï¼Œå…¶å®ä¸ç„¶ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ç¨‹åºï¼š

```rust
#[derive(Debug)]
enum Poker {
    Clubs,
    Spade,
    Diamonds,
    Hearts,
}

struct PokerCard {
    suit: Poker,
    value: u8,
}

fn main() {
    let c1 = PokerCard {
       suit: Poker::Clubs,
       value: 1,
   };
   let c2 = PokerCard {
       suit: Poker::Diamonds,
       value: 12,
   };

    println!("{:?}", c1);
    println!("{:?}", c2);
}
```
è¿è¡Œä»¥ä¸Šç¨‹åºä¼šæŠ¥é”™ï¼š

```
error[E0277]: `PokerCard` doesn't implement `Debug`
  --> src/main.rs:24:22
   |
24 |     println!("{:?}", c1);
   |                      ^^ `PokerCard` cannot be formatted using `{:?}`
   |
   = help: the trait `Debug` is not implemented for `PokerCard`
   = note: add `#[derive(Debug)]` to `PokerCard` or manually `impl Debug for PokerCard`
   = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)
help: consider annotating `PokerCard` with `#[derive(Debug)]`
   |
9  | #[derive(Debug)]
   |

error[E0277]: `PokerCard` doesn't implement `Debug`
  --> src/main.rs:25:22
   |
25 |     println!("{:?}", c2);
   |                      ^^ `PokerCard` cannot be formatted using `{:?}`
   |
   = help: the trait `Debug` is not implemented for `PokerCard`
   = note: add `#[derive(Debug)]` to `PokerCard` or manually `impl Debug for PokerCard`
   = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)
help: consider annotating `PokerCard` with `#[derive(Debug)]`
   |
9  | #[derive(Debug)]
   |

For more information about this error, try `rustc --explain E0277`.
error: could not compile `Demo` due to 2 previous errors
```
è¿™å°±æ˜¯ç†è§£ä¸Šå‡ºç°äº†é”™è¯¯ï¼Œéœ€è¦ç»™æ¯ä¸€ä¸ªç»“æ„ä½“åŠ ä¸Š`#[derive(Debug)]`æ‰è¡Œ

```rust
#[derive(Debug)]
enum Poker {
    Clubs,
    Spade,
    Diamonds,
    Hearts,
}

#[derive(Debug)]
struct PokerCard {
    suit: Poker,
    value: u8,
}
```

æšä¸¾å†è¿›é˜¶ä¸€ç‚¹å°±æ˜¯ï¼š

```rust
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

fn main() {
    let m1 = Message::Quit;
    let m2 = Message::Move{x:1,y:1};
    let m3 = Message::ChangeColor(255,255,0);
}
```

#### åŒä¸€åŒ–ç±»å‹
æœ€åï¼Œå†ç”¨ä¸€ä¸ªå®é™…é¡¹ç›®ä¸­çš„ç®€åŒ–ç‰‡æ®µï¼Œæ¥ç»“æŸæšä¸¾ç±»å‹çš„è¯­æ³•å­¦ä¹ ã€‚

ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª WEB æœåŠ¡ï¼Œéœ€è¦æ¥å—ç”¨æˆ·çš„é•¿è¿æ¥ï¼Œå‡è®¾è¿æ¥æœ‰ä¸¤ç§ï¼šTcpStream å’Œ TlsStreamï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å¯¹è¿™ä¸¤ä¸ªè¿æ¥çš„å¤„ç†æµç¨‹ç›¸åŒï¼Œä¹Ÿå°±æ˜¯ç”¨åŒä¸€ä¸ªå‡½æ•°æ¥å¤„ç†è¿™ä¸¤ä¸ªè¿æ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š

```rust

#![allow(unused)]
fn main() {
fn new (stream: TcpStream) {
  let mut s = stream;
  if tls {
    s = negotiate_tls(stream)
  }

  // websocketæ˜¯ä¸€ä¸ªWebSocket<TcpStream>æˆ–è€…
  //   WebSocket<native_tls::TlsStream<TcpStream>>ç±»å‹
  websocket = WebSocket::from_raw_socket(
    stream, ......)
}
}

```

æ­¤æ—¶ï¼Œæšä¸¾ç±»å‹å°±èƒ½å¸®ä¸Šå¤§å¿™ï¼š
```rust

#![allow(unused)]
fn main() {
enum Websocket {
  Tcp(Websocket<TcpStream>),
  Tls(Websocket<native_tls::TlsStream<TcpStream>>),
}
}

```



#### Option æšä¸¾ç”¨äºå¤„ç†ç©ºå€¼
Option æšä¸¾åŒ…å«ä¸¤ä¸ªæˆå‘˜ï¼Œä¸€ä¸ªæˆå‘˜è¡¨ç¤ºå«æœ‰å€¼ï¼šSome(T), å¦ä¸€ä¸ªè¡¨ç¤ºæ²¡æœ‰å€¼ï¼šNoneï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```rust
enum Option<T> {
    Some(T),
    None,
}
```
å…¶ä¸­ T æ˜¯æ³›å‹å‚æ•°ï¼ŒSome(T)è¡¨ç¤ºè¯¥æšä¸¾æˆå‘˜çš„æ•°æ®ç±»å‹æ˜¯ Tï¼Œæ¢å¥è¯è¯´ï¼ŒSome å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚\

```rust

fn main() {
    fn plus_one(x: Option<i32>) -> Option<i32> {
        match x {
            None => None,
            Some(i) => Some(i + 1),
        }
    }

    let five = Some(5);
    let six = plus_one(five);
    let none = plus_one(None);

    println!("{:?}", five);
    println!("{:?}", six);
    println!("{:?}", none);
}

```


## 1.8 ğŸ”¢ æ•°ç»„
rustçš„æ•°ç»„åŸºæœ¬å’ŒJavaScriptå·®ä¸å¤šï¼Œç›´æ¥æ¥ä¸€ä¸ªç»¼åˆä¾‹å­ï¼š
- [0; 3]æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯[0, 0, 0]

```rust
fn main() {
  // ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼å‡ºoneçš„ç±»å‹
  let one             = [1, 2, 3];
  // æ˜¾å¼ç±»å‹æ ‡æ³¨
  let two: [u8; 3]    = [1, 2, 3];
  let blank1          = [0; 3];
  let blank2: [u8; 3] = [0; 3];

  // arraysæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ ç±»å‹æ˜¯[u8; 3]
  let arrays: [[u8; 3]; 4]  = [one, two, blank1, blank2];

  // å€Ÿç”¨arraysçš„å…ƒç´ ç”¨ä½œå¾ªç¯ä¸­
  for a in &arrays {
    print!("{:?}: ", a);
    // å°†aå˜æˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºå¾ªç¯
    // ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨for n in a {}æ¥è¿›è¡Œå¾ªç¯
    for n in a.iter() {
      print!("\t{} + 10 = {}", n, n+10);
    }

    let mut sum = 0;
    // 0..a.len,æ˜¯ä¸€ä¸ª Rust çš„è¯­æ³•ç³–ï¼Œå…¶å®å°±ç­‰äºä¸€ä¸ªæ•°ç»„ï¼Œå…ƒç´ æ˜¯ä»0,1,2ä¸€ç›´å¢åŠ åˆ°åˆ°a.len-1
    for i in 0..a.len() {
      sum += a[i];
    }
    println!("\t({:?} = {})", a, sum);
  }
}
```
åšä¸ªæ€»ç»“ï¼Œæ•°ç»„è™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯å…¶å®è¿˜æ˜¯å­˜åœ¨å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š

- æ•°ç»„ç±»å‹å®¹æ˜“è·Ÿæ•°ç»„åˆ‡ç‰‡æ··æ·†ï¼Œ`[T;n]`æè¿°äº†ä¸€ä¸ªæ•°ç»„çš„ç±»å‹ï¼Œè€Œ[T]æè¿°äº†åˆ‡ç‰‡çš„ç±»å‹ï¼Œ å› ä¸ºåˆ‡ç‰‡æ˜¯è¿è¡ŒæœŸçš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„é•¿åº¦æ— æ³•åœ¨ç¼–è¯‘æœŸå¾—çŸ¥ï¼Œå› æ­¤ä¸èƒ½ç”¨`[T;n]`çš„å½¢å¼å»æè¿°
- `[u8; 3]`å’Œ`[u8; 4]`æ˜¯ä¸åŒçš„ç±»å‹ï¼Œæ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†
- åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯æ•°ç»„åˆ‡ç‰‡[T]ï¼Œæˆ‘ä»¬å¾€å¾€é€šè¿‡å¼•ç”¨çš„æ–¹å¼å»ä½¿ç”¨`&[T]`ï¼Œå› ä¸ºåè€…æœ‰å›ºå®šçš„ç±»å‹å¤§å°
è‡³æ­¤ï¼Œå…³äºæ•°æ®ç±»å‹éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å…¨éƒ¨å­¦å®Œäº†ï¼Œå¯¹äº Rust å­¦ä¹ è€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿè¿ˆå‡ºäº†åšå®šçš„ç¬¬ä¸€æ­¥ï¼Œåé¢å°†å¼€å§‹æ›´é«˜çº§ç‰¹æ€§çš„å­¦ä¹ ã€‚æœªæ¥å¦‚æœå¤§å®¶æœ‰ç–‘æƒ‘éœ€è¦æ£€ç´¢çŸ¥è¯†ï¼Œä¸€æ ·å¯ä»¥ç»§ç»­å›é¡¾è¿‡å¾€çš„ç« èŠ‚ï¼Œå› ä¸ºæœ¬ä¹¦ä¸ä»…ä»…æ˜¯ä¸€é—¨ Rust çš„æ•™ç¨‹ï¼Œè¿˜æ˜¯ä¸€æœ¬åšé‡çš„ Rust å·¥å…·ä¹¦ã€‚

## 1.9 â­•æµç¨‹æ§åˆ¶
å…¶ä»–éƒ½å·®ä¸å¤šï¼Œå°±è¿™ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šã€‚

### forå¾ªç¯
1.  for item in collection  è½¬ç§»æ‰€æœ‰æƒ

2. for item in &collection æˆ–è€… for item in collection.iter()  ä¸å¯å˜å€Ÿç”¨

3. for item in &mut collection æˆ–è€… for item in collection.iter_mut()  å¯å˜å€Ÿç”¨

### loop

```rust
fn main() {
    loop {
        println!("again!");
    }
}
```

## 1.10 ğŸ’â€â™‚ï¸ æ¨¡å¼åŒ¹é…
å…ˆå±•ç¤ºä¸€ä¸‹Java17çš„Switchï¼Œå°±æ‡‚äº†ï¼š

```java
public class Main {
    public static void main(String[] args) {
        enum Color { RED, GREEN, BLUE }
        Color c = Color.RED;
        switch (c) {
            case RED -> System.out.println("RED");
            case GREEN -> System.out.println("GREEN");
            case BLUE -> System.out.println("BLUE");
            default -> System.out.println("UNKNOWN");
        }
    }
}

```
å†æ¥çœ‹Rustç®€å•çš„ä¾‹å­ï¼š

```rust
fn main() {
    enum Color { Red, Green, Blue }
	let c = Color::Red;
	match c {
		Color::Red => println!("RED"),
		Color::Green => println!("GREEN"),
		Color::Blue => println!("BLUE"),
		_ => println!("UNKNOWN")
	}
}
```

å¦å¤–è¿˜æœ‰ä¸€äº›é¢å¤–çš„æŠ€èƒ½

### ä½¿ç”¨ match è¡¨è¾¾å¼èµ‹å€¼

```rust
enum IpAddr {
   Ipv4,
   Ipv6
}

fn main() {
    let ip1 = IpAddr::Ipv6;
    let ip_str = match ip1 {
        IpAddr::Ipv4 => "127.0.0.1",
        _ => "::1",
    };

    println!("{}", ip_str);
}

```

åŒç† Java17ä¹Ÿèƒ½åšåˆ°

```java
public class Main {
    enum IpAddr {
        Ipv4,
        Ipv6
    }

    public static void main(String[] args) {
        IpAddr ip1 = IpAddr.Ipv6;
        String ipStr = switch (ip1) {
            case Ipv4 -> "127.0.0.1";
            default -> "::1";
        };

        System.out.println(ipStr);
    }
}
```

### _ é€šé…ç¬¦
é€šè¿‡å°† _ å…¶æ”¾ç½®äºå…¶ä»–åˆ†æ”¯åï¼Œ_ å°†ä¼šåŒ¹é…æ‰€æœ‰é—æ¼çš„å€¼ã€‚() è¡¨ç¤ºè¿”å›å•å…ƒç±»å‹ä¸æ‰€æœ‰åˆ†æ”¯è¿”å›å€¼çš„ç±»å‹ç›¸åŒï¼Œæ‰€ä»¥å½“åŒ¹é…åˆ° _ åï¼Œä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚
```rust

#![allow(unused)]
fn main() {
let some_u8_value = 0u8;
match some_u8_value {
    1 => println!("one"),
    3 => println!("three"),
    5 => println!("five"),
    7 => println!("seven"),
    _ => (),
}
}

```


### let if è¿›è¡ŒåŒ¹é…
å½“ä½ åªè¦åŒ¹é…ä¸€ä¸ªæ¡ä»¶ï¼Œä¸”å¿½ç•¥å…¶ä»–æ¡ä»¶æ—¶å°±ç”¨ if let ï¼Œå¦åˆ™éƒ½ç”¨ matchã€‚

```rust

#![allow(unused)]
fn main() {
if let Some(3) = v {
    println!("three");
}
}

```


### matches!å®
å®ƒå¯ä»¥å°†ä¸€ä¸ªè¡¨è¾¾å¼è·Ÿæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œç„¶åè¿”å›åŒ¹é…çš„ç»“æœ true or falseã€‚

```rust
#![allow(unused)]
fn main() {
let foo = 'f';
assert!(matches!(foo, 'A'..='Z' | 'a'..='z'));
println!("{}", matches!(foo, 'A'..='Z' | 'a'..='z')); // true

```


### å˜é‡è¦†ç›–
æ— è®ºæ˜¯ match è¿˜æ˜¯ if letï¼Œä»–ä»¬éƒ½å¯ä»¥åœ¨æ¨¡å¼åŒ¹é…æ—¶è¦†ç›–æ‰è€çš„å€¼ï¼Œç»‘å®šæ–°çš„å€¼:

```rust
fn main() {
   let age = Some(30);
   println!("åœ¨åŒ¹é…å‰ï¼Œageæ˜¯{:?}",age);
   if let Some(age) = age {
       println!("åŒ¹é…å‡ºæ¥çš„ageæ˜¯{}",age);
   }

   println!("åœ¨åŒ¹é…åï¼Œageæ˜¯{:?}",age);
}
```

### å°ç»“
æœ¬ç« çš„å†…å®¹å…¶å®æœ‰å¾ˆå¤šè¢«æˆ‘åˆ å‡äº†ï¼Œè€Œä¸”æœ‰äº›æˆ‘çœ‹çš„çŒç¡éƒ½æ¥äº†ï¼Œå› ä¸ºæˆ‘æ„Ÿè§‰æœ‰äº›å†…å®¹Javaä¹Ÿæœ‰ï¼Œåˆ°æ—¶å€™é¡¹ç›®ç”¨åˆ°å†è¯´å…·ä½“å¯ä»¥çœ‹å¤§å¤§æ€»ç»“çš„ï¼š
> https://course.rs/basic/match-pattern/all-patterns.html


## 1.11 ğŸ‘¨â€ğŸ”§ æ–¹æ³•

Rustå’Œå…¶ä»–è¯­è¨€çš„æ–¹æ³•å¯¹æ¯”ï¼š
![](https://pica.zhimg.com/80/v2-0d848e960f3279999eab4b1317f6538e_1440w.png)

ruståˆ›å»ºæ–¹æ³•ï¼š
- `impl` æ˜¯å®ç° `implementation` çš„ç¼©å†™

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }
}

fn main() {
    let rect1 = Rectangle { width: 30, height: 50 };

    println!(
        "The area of the rectangle is {} square pixels.",
        rect1.area()
    );
}

```
å…¶å®çœ‹åˆ°è¿™é‡Œæ˜¯ååˆ†ç–‘æƒ‘çš„ï¼Œå°¤å…¶æ˜¯å’Œfnå¯¹æ¯”èµ·æ¥ï¼Œä¸‹é¢æˆ‘æ¥æ€»ç»“ä¸‹ï¼š
- implå—ç”¨äºå®šä¹‰åœ¨ç‰¹å®šç±»å‹ä¸Šçš„æ–¹æ³•ã€‚å®ƒRå¾€å¾€è·Ÿç»“æ„ä½“ã€æšä¸¾ã€ç‰¹å¾(Trait)ä¸€èµ·ä½¿ç”¨ã€‚
- fnç”¨äºå®šä¹‰æ™®é€šçš„å…¨å±€æˆ–å†…éƒ¨åŠŸèƒ½ã€‚å®ƒä¸ä¾èµ–äºä»»ä½•ç‰¹å®šç±»å‹ã€‚
- ç®€å•æ¥è¯´ï¼Œè¦å®ç°ç»“æ„ä½“çš„å‡½æ•°å°±è¦ä½¿ç”¨implï¼Œå®ƒè¿™ä¸ªå®ç°å’ŒGoè¯­è¨€ååˆ†ç±»ä¼¼ï¼

Goè¯­è¨€è¿›è¡Œå¯¹æ¯”å­¦ä¹ ï¼Œå°†personèµ‹äºˆSayHelloèƒ½åŠ›ã€‚ä¸ Rust çš„ impl ä¸åŒçš„æ˜¯ï¼ŒGo ä¸­çš„æ¥æ”¶è€…ç±»å‹å¯ä»¥æ˜¯å€¼ç±»å‹æˆ–æŒ‡é’ˆç±»å‹ã€‚å¦‚æœæ¥æ”¶è€…ç±»å‹æ˜¯å€¼ç±»å‹ï¼Œåˆ™ä¼šå°†è¯¥å€¼çš„å‰¯æœ¬ä¼ é€’ç»™æ–¹æ³•ï¼Œè€Œå¦‚æœæ¥æ”¶è€…ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹ï¼Œåˆ™ä¼šå°†æŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆä¼ é€’ç»™æ–¹æ³•ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­ä¿®æ”¹æ¥æ”¶è€…çš„çŠ¶æ€ï¼Œå¹¶å°†è¿™äº›æ›´æ”¹ä¿æŒåœ¨è°ƒç”¨æ–¹æ³•ä¹‹åã€‚

```go
type Person struct {
    Name string
    Age int
}

func (p Person) SayHello() {
    fmt.Printf("Hello, my name is %s and I am %d years old.\n", p.Name, p.Age)
}
```


å‡½æ•°

```rust
fn add(a: i32, b: i32) -> i32 {
    a + b
}
```

æ–¹æ³•ã€‚è‡³äºè¿™ä¸ªselfå…·ä½“æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œæ˜¯å¦å’ŒPythonçš„selfä¸€æ ·ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ã€‚

```rust

struct Point {
    x: f64,
    y: f64,
}

impl Point {
    fn distance(&self, other: &Point) -> f64 {
        ((self.x - other.x).powi(2) + (self.y - other.y).powi(2)).sqrt()
    }
}
fn main() {
    let p = Point {
        x: 12.0,
        y: 13.0,
    };
    let p2 = Point {
        x: 14.0,
        y: 15.0,
    };
    let ans = p.distance(&p2);
    println!("{}", ans);
}
```


### selfã€&self å’Œ &mut self
åœ¨ä¸€ä¸ª impl å—å†…ï¼ŒSelf æŒ‡ä»£è¢«å®ç°æ–¹æ³•çš„ç»“æ„ä½“ç±»å‹ï¼Œself æŒ‡ä»£æ­¤ç±»å‹çš„å®ä¾‹ï¼Œæ¢å¥è¯è¯´ï¼Œself æŒ‡ä»£çš„æ˜¯ç»“æ„ä½“å®ä¾‹ï¼Œè¿™æ ·çš„å†™æ³•ä¼šè®©æˆ‘ä»¬çš„ä»£ç ç®€æ´å¾ˆå¤šï¼Œè€Œä¸”éå¸¸ä¾¿äºç†è§£ï¼šæˆ‘ä»¬ä¸ºå“ªä¸ªç»“æ„ä½“å®ç°æ–¹æ³•ï¼Œé‚£ä¹ˆ self å°±æ˜¯æŒ‡ä»£å“ªä¸ªç»“æ„ä½“çš„å®ä¾‹ã€‚
> ä»è€Œå¯ä»¥å¾—å‡º >> è™½ç„¶ Rust å’Œ Python æ˜¯ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†å®ƒä»¬åœ¨æŸäº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚self å…³é”®å­—åœ¨ä¸¤ç§è¯­è¨€ä¸­éƒ½ç”¨äºè¡¨ç¤ºå½“å‰å®ä¾‹ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­è®¿é—®å’Œä¿®æ”¹å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ã€‚

åœ¨Rustä¸­ï¼Œselfæ˜¯æœ‰æ‰€æœ‰æƒçš„æ¦‚å¿µçš„
- `self` è¡¨ç¤º ç»“æ„ä½“ çš„æ‰€æœ‰æƒè½¬ç§»åˆ°è¯¥æ–¹æ³•ä¸­ï¼Œè¿™ç§å½¢å¼ç”¨çš„è¾ƒå°‘
- `&self` è¡¨ç¤ºè¯¥æ–¹æ³•å¯¹ ç»“æ„ä½“ çš„ä¸å¯å˜å€Ÿç”¨
- `&mut self` è¡¨ç¤ºå¯å˜å€Ÿç”¨
æ€»ä¹‹ï¼Œself çš„ä½¿ç”¨å°±è·Ÿå‡½æ•°å‚æ•°ä¸€æ ·ï¼Œè¦ä¸¥æ ¼éµå®ˆ Rust çš„æ‰€æœ‰æƒè§„åˆ™ã€‚

### å…³è”å‡½æ•°
å‚æ•°ä¸­ä¸åŒ…å« self å³å¯ã€‚åœ¨ impl ä¸­ä¸”æ²¡æœ‰ self çš„å‡½æ•°è¢«ç§°ä¹‹ä¸ºå…³è”å‡½æ•°ï¼š å› ä¸ºå®ƒæ²¡æœ‰ selfï¼Œä¸èƒ½ç”¨ f.read() çš„å½¢å¼è°ƒç”¨ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯æ–¹æ³•ï¼Œå®ƒåˆåœ¨ impl ä¸­ï¼Œä¸ç»“æ„ä½“ç´§å¯†å…³è”ï¼Œå› æ­¤ç§°ä¸ºå…³è”å‡½æ•°ã€‚

æ³¨æ„è§‚å¯Ÿä¸‹é¢ä¾‹å­ä¸­çš„new

```rust
pub struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    pub fn new(width: u32, height: u32) -> Self {
        Rectangle { width, height }
    }
    pub fn width(&self) -> u32 {
        return self.width;
    }
}

fn main() {
    let rect1 = Rectangle::new(30, 50);

    println!("{}", rect1.width());
}

```
> Rust ä¸­æœ‰ä¸€ä¸ªçº¦å®šä¿—æˆçš„è§„åˆ™ï¼Œä½¿ç”¨ new æ¥ä½œä¸ºæ„é€ å™¨çš„åç§°ï¼Œå‡ºäºè®¾è®¡ä¸Šçš„è€ƒè™‘ï¼ŒRust ç‰¹åœ°æ²¡æœ‰ç”¨ new ä½œä¸ºå…³é”®å­—ã€‚

å› ä¸ºæ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ . çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ :: æ¥è°ƒç”¨ï¼Œä¾‹å¦‚ let sq = Rectangle::new(3, 3);ã€‚è¿™ä¸ªæ–¹æ³•ä½äºç»“æ„ä½“çš„å‘½åç©ºé—´ä¸­ï¼š:: è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´ã€‚

### å¤šä¸ª impl å®šä¹‰
ç›´æ¥çœ‹ä¾‹å­å³å¯

```rust

#![allow(unused)]
fn main() {
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }
}

impl Rectangle {
    fn can_hold(&self, other: &Rectangle) -> bool {
        self.width > other.width && self.height > other.height
    }
}
}

```

### ä¸ºæšä¸¾å®ç°æ–¹æ³•
æšä¸¾ç±»å‹ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œä¸ä»…ä»…åœ¨äºå®ƒå¥½ç”¨ã€å¯ä»¥**åŒä¸€åŒ–ç±»å‹**ï¼Œè¿˜åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥åƒç»“æ„ä½“ä¸€æ ·ï¼Œä¸ºæšä¸¾å®ç°æ–¹æ³•ï¼š

```rust
#![allow(unused)]
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

impl Message {
    fn call(&self) {
        // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“
    }
}

fn main() {
    let m = Message::Write(String::from("hello"));
    m.call();
}

```

## 1.121 ğŸ¦œ æ³›å‹
### ç»“æ„ä½“ä¸­ä½¿ç”¨æ³›å‹
å…ˆä¸Šä¾‹å­ä½“éªŒä¸€ä¸‹ï¼š
- ä½¿ç”¨çš„æ—¶å€™éœ€è¦åœ¨ç»“æ„ä½“åå­—åé¢åŠ å…¥`<T>`
```rust
#[derive(Debug)]
struct Point<T> {
    x: T,
    y: T,
}

fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };

    println!("{:?}", integer);
    println!("{:?}", float);
}

```
æ­¤æ—¶çš„å£°æ˜æ˜¯x, yå¿…é¡»æ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œå¦‚æœè¦ä¸ä¸€æ ·çš„å£°æ˜å°±è¦ä¸¤ç§ä¸åŒçš„æ³›å‹ï¼š

```rust
#[derive(Debug)]
struct Point<T,U> {
    x: T,
    y: U,
}

fn main() {
    let integer = Point { x: 5, y: 1.1 };
    let float = Point { x: 222, y: 3.0 };

    println!("{:?}", integer);
    println!("{:?}", float);
}
```

### æšä¸¾ä¸­ä½¿ç”¨æ³›å‹
æåˆ°æšä¸¾ç±»å‹ï¼ŒOption æ°¸è¿œæ˜¯ç¬¬ä¸€ä¸ªåº”è¯¥è¢«æƒ³èµ·æ¥çš„

```rust
enum Option<T> {
    Some(T),
    None,
}
```
`Option<T> `æ˜¯ä¸€ä¸ªæ‹¥æœ‰æ³›å‹ T çš„æšä¸¾ç±»å‹ï¼Œå®ƒç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ Some(T)ï¼Œå­˜æ”¾äº†ä¸€ä¸ªç±»å‹ä¸º T çš„å€¼ã€‚å¾—ç›Šäºæ³›å‹çš„å¼•å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªéœ€è¦è¿”å›å€¼çš„å‡½æ•°ä¸­ï¼Œå»ä½¿ç”¨ `Option<T> `æšä¸¾ç±»å‹æ¥åšä¸ºè¿”å›å€¼ï¼Œç”¨äºè¿”å›ä¸€ä¸ªä»»æ„ç±»å‹çš„å€¼ Some(T)ï¼Œæˆ–è€…æ²¡æœ‰å€¼ Noneã€‚

### æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹
- ä½¿ç”¨æ³›å‹å‚æ•°å‰ï¼Œä¾ç„¶éœ€è¦æå‰å£°æ˜ï¼š`impl<T>`

```rust
struct Point<T> {
    x: T,
    y: T,
}

impl<T> Point<T> {
    fn x(&self) -> &T {
        &self.x
    }
}

fn main() {
    let p = Point { x: 5, y: 10 };

    println!("p.x = {}", p.x());
}


```

### ä¸ºå…·ä½“çš„æ³›å‹ç±»å‹å®ç°æ–¹æ³•
ä¸ä»…èƒ½å®šä¹‰åŸºäº T çš„æ–¹æ³•ï¼Œè¿˜èƒ½é’ˆå¯¹ç‰¹å®šçš„å…·ä½“ç±»å‹ï¼Œè¿›è¡Œæ–¹æ³•å®šä¹‰ï¼Œä¾‹å¦‚f32ï¼š

```rust

#![allow(unused)]
fn main() {
impl Point<f32> {
    fn distance_from_origin(&self) -> f32 {
        (self.x.powi(2) + self.y.powi(2)).sqrt()
    }
}
}

```

### const æ³›å‹ï¼ˆRust 1.51 ç‰ˆæœ¬å¼•å…¥çš„é‡è¦ç‰¹æ€§ï¼‰
åœ¨ä¹‹å‰å­¦è¿‡æ•°ç»„æ‰“å°

```rust
fn display_array(arr: &[i32]) {
    println!("{:?}", arr);
}
fn main() {
    let arr: [i32; 3] = [1, 2, 3];
    display_array(&arr);

    let arr: [i32;2] = [1,2];
    display_array(&arr);
}

```
ç°åœ¨å°†å®ƒæ”¹é€ æˆæ³›å‹
- éœ€è¦å¯¹ T åŠ ä¸€ä¸ªé™åˆ¶`std::fmt::Debug`ï¼Œæˆ‘çš„ç†è§£æ˜¯åŠ å…¥åï¼Œç›®å‰çš„å‡½æ•°æ˜¯æ”¯æŒä¼ å…¥å¯æ‰“å°çš„æ•°ç»„

```rust
fn display_array<T: std::fmt::Debug>(arr: &[T]) {
    println!("{:?}", arr);
}
fn main() {
    let arr: [i32; 3] = [1, 2, 3];
    display_array(&arr);

    let arr: [i32;2] = [1,2];
    display_array(&arr);
}

```

æœ‰äº† const æ³›å‹ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹å€¼çš„æ³›å‹ï¼Œæ­£å¥½å¯ä»¥ç”¨äºå¤„ç†æ•°ç»„é•¿åº¦çš„é—®é¢˜ï¼š

```rust
fn display_array<T: std::fmt::Debug, const N: usize>(arr: [T; N]) {
    println!("{:?}", arr);
}
fn main() {
    let arr: [i32; 3] = [1, 2, 3];
    display_array(arr);

    let arr: [i32; 2] = [1, 2];
    display_array(arr);
}
```

å…¶å®é˜…è¯»åˆ°è¿™é‡Œæˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š
1. æˆ‘æ˜¯åœ¨æ²¡è¯»æ‡‚ä½œè€…è¯´çš„[å¤„ç†æ•°ç»„é•¿åº¦çš„é—®é¢˜](https://course.rs/basic/trait/generic.html#const-æ³›å‹rust-151-ç‰ˆæœ¬å¼•å…¥çš„é‡è¦ç‰¹æ€§)æ˜¯ä»€ä¹ˆæ„æ€
2. ä»…ä»…æ˜¯åŠ å…¥`T: std::fmt::Debug`ä¸å°±å¯ä»¥äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦åŠ å…¥`const N: usize`ã€‚ï¼ˆå¯èƒ½æ˜¯æ²¡ç†è§£1ï¼‰

åŸå› æ˜¯ï¼šæ˜¾å¼ä¼ é€’æ•°ç»„å¤§å°æä¾›äº†ä¸€äº›å®‰å…¨æ€§å’Œçµæ´»æ€§ä¼˜åŠ¿ï¼Œç”±äºRustçš„é™æ€ç±»å‹å®‰å…¨æ€§ï¼Œä»£ç ä¹Ÿå¯ä»¥ä»¥ä»»ä½•æ–¹å¼å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥ä»å‚æ•°æ¨æ–­æ•°ç»„å¤§å°ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¦æ±‚const Nï¼š usizeä½œä¸ºå‚æ•°ä¸»è¦é€šè¿‡åœ¨ç¼–è¯‘æ—¶è€Œä¸æ˜¯è¿è¡Œæ—¶å¯ç”¨éªŒè¯æ¥å¢å¼ºå®‰å…¨æ€§ã€‚ç”±äºé¢å¤–çš„ä¿¡æ¯ï¼Œå®ƒä¸ºä¼˜åŒ–å¸¦æ¥äº†æ›´å¤šçš„ä¿è¯å’Œæœºä¼šã€‚

å…‰è¯´ä¸åšå•¥ä¹Ÿä¸æ‡‚ï¼Œç›´æ¥ä¸¾ä¸€ä¸ªå¦‚æœä¸ä½¿ç”¨const N: usizeçš„ä¾‹å­ï¼š

```rust
fn display_array<T: std::fmt::Debug>(arr: [T; N]) {
    println!("{:?}", arr); 
} 

fn main() { 
    let arr: [i32; 3] = [1, 2, 3]; 
    display_array(arr); 

    let arr2: [i32; 100000] = [0; 100000]; 
    display_array(arr2); 
} 
```


```
error[E0425]: cannot find value `N` in this scope
 --> src/main.rs:1:47
  |
1 | fn display_array<T: std::fmt::Debug>(arr: [T; N]) {
  |                                    -          ^ not found in this scope åœ¨æ­¤èŒƒå›´å†…æ‰¾ä¸åˆ°
  |                                    |
  |                                    help: you might be missing a type parameter: `, N`
									   å¸®åŠ©ï¼šæ‚¨å¯èƒ½ç¼ºå°‘ç±»å‹å‚æ•°ï¼š'ï¼Œ N'

error[E0282]: type annotations needed
 --> src/main.rs:7:5
  |
7 |     display_array(arr); 
  |     ^^^^^^^^^^^^^ cannot infer type for type parameter `T` declared on the function `display_array` æ— æ³•æ¨æ–­åœ¨å‡½æ•°display_arrayä¸Šå£°æ˜çš„ç±»å‹å‚æ•°Tçš„ç±»å‹

Some errors have detailed explanations: E0282, E0425.
For more information about an error, try `rustc --explain E0282`.
error: could not compile `Demo` due to 2 previous errors
```

åªèƒ½è¯´Rustä½œè€…ååˆ†è´´å¿ƒï¼Œè¿helpéƒ½ç»™ä½ å†™äº†ï¼Œçœçš„å»Stack Overflowå»æœç´¢ã€‚è¿™æ®µä»£ç ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ï¼ŒåŸå› æ˜¯`arr2å¤ªå¤§`ã€‚` æ²¡æœ‰constå¤§å°å‚æ•°ï¼Œç¼–è¯‘å™¨æ²¡æœ‰å…³äºæ•°ç»„å‚æ•°å¤§å°çš„ä¿¡æ¯`ã€‚å®ƒå‡å®šå‡½æ•°å¯ä»¥ä½¿ç”¨ä»»ä½•å¤§å°çš„æ•°ç»„è¿›è¡Œè°ƒç”¨ã€‚ è¿™åœ¨ç¼–è¯‘æ—¶ä¼šå¯¼è‡´é—®é¢˜ï¼Œå› ä¸ºRustä¸­çš„å‡½æ•°å¯¹å †æ ˆå¤§å°ã€çº¿ç¨‹å †æ ˆå¤§å°ç­‰æœ‰ä¸¥æ ¼é™åˆ¶ã€‚éå¸¸å¤§çš„æ•°ç»„å‚æ•°å°†è¶…å‡ºè¿™äº›é™åˆ¶ã€‚

ç»è¿‡æˆ‘æŸ¥è¯¢èµ„æ–™ï¼Œçœç•¥sizeå‚æ•°å¯èƒ½ä¼šå¯¼è‡´ï¼š
- éå¸¸å¤§çš„å¤§å°çš„ç¼–è¯‘æ—¶é”™è¯¯ã€‚
- ç”±äºæœªçŸ¥å¤§å°ï¼Œè¿è¡Œæ—¶å‡ºç°ä¸å®‰å…¨çš„å†…å­˜é—®é¢˜ã€‚
- æœ‰é™ä¼˜åŒ–çš„æ¬¡ä¼˜æ€§èƒ½ã€‚

æ€»ç»“ï¼šè¦æ±‚const Nï¼š usizeé€šè¿‡å…è®¸åŸºäºåœ¨ç¼–è¯‘æ—¶å®Œå…¨äº†è§£å‚æ•°å¤§å°çš„é™æ€éªŒè¯å’Œä¼˜åŒ–ä»£ç ç”Ÿæˆæ¥æä¾›å®‰å…¨æ€§ã€å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚

### æ³›å‹çš„æ•ˆç‡ ï¼ˆå•æ€åŒ–ï¼‰
åœ¨ Rust ä¸­æ³›å‹æ˜¯é›¶æˆæœ¬çš„æŠ½è±¡ï¼Œæ„å‘³ç€ä½ åœ¨ä½¿ç”¨æ³›å‹æ—¶ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚

ä½†æ˜¯ä»»ä½•é€‰æ‹©éƒ½æ˜¯æƒè¡¡å¾—å¤±çš„ï¼Œæ—¢ç„¶æˆ‘ä»¬è·å¾—äº†æ€§èƒ½ä¸Šçš„å·¨å¤§ä¼˜åŠ¿ï¼Œé‚£ä¹ˆåˆå¤±å»äº†ä»€ä¹ˆå‘¢ï¼ŸRust æ˜¯åœ¨ç¼–è¯‘æœŸä¸ºæ³›å‹å¯¹åº”çš„å¤šä¸ªç±»å‹ï¼Œç”Ÿæˆå„è‡ªçš„ä»£ç ï¼Œå› æ­¤æŸå¤±äº†ç¼–è¯‘é€Ÿåº¦å’Œå¢å¤§äº†æœ€ç»ˆç”Ÿæˆæ–‡ä»¶çš„å¤§å°ã€‚

å…·ä½“æ¥è¯´ï¼š

Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ **å•æ€åŒ–(monomorphization)** æ¥ä¿è¯æ•ˆç‡ã€‚å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚

ç¼–è¯‘å™¨æ‰€åšçš„å·¥ä½œæ­£å¥½ä¸æˆ‘ä»¬åˆ›å»ºæ³›å‹å‡½æ•°çš„æ­¥éª¤ç›¸åï¼Œç¼–è¯‘å™¨å¯»æ‰¾æ‰€æœ‰æ³›å‹ä»£ç è¢«è°ƒç”¨çš„ä½ç½®å¹¶é’ˆå¯¹å…·ä½“ç±»å‹ç”Ÿæˆä»£ç ã€‚

åœ¨åŸä¹¦ä¸­æˆ‘æ ¹æœ¬æ²¡æ³•è·Ÿä¸Šä½œè€…çš„å•æ€åŒ–çš„ç†è§£ï¼Œå› ä¸ºè¿™æ˜¯å…¶ä»–è¯­è¨€æ²¡æœ‰çš„ç†è§£ã€‚ç»è¿‡æŸ¥é˜…ä¸¾ä¾‹è¯´æ˜ï¼š
- å•æ€åŒ–å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶
- é¿å…åŠ¨æ€è°ƒåº¦
- Rustå®‰å…¨ã€å¿«é€Ÿæ³›å‹æ–¹æ³•çš„å…³é”®éƒ¨åˆ†
- å¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„äºŒè¿›åˆ¶å¤§å°

```rust
fn add<T>(x: T, y: T) -> T {
x + y
}

fn main() {
	let x = 1; // i32
	let y = 2; // i32
	let z = add(x, y); // z is i32
	let a = 1.0;  // f64 
	let b = 2.0;  // f64 
	let c = add(a, b); // c is f64 
}
```
åœ¨ç¼–è¯‘æ—¶ï¼Œè¿™ä¼šäº§ç”Ÿä¸¤ä¸ªâ€œå•æ€â€ç‰ˆæœ¬çš„ addï¼š
```rust
fn add_i32(x: i32, y: i32) -> i32 { ... }
fn add_f64(x: f64, y: f64) -> f64 { ... }
```
å®ƒçš„è°ƒç”¨ç»“æ„ä¼šå˜æˆï¼š

```rust
let z = add_i32(x, y);
let c = add_f64(a, b);
```

å¯¼è‡´æ¯ç§å…·ä½“ç±»å‹éƒ½æœ‰è‡ªå·±çš„æ³›å‹å‡½æ•°çš„ä¸“ç”¨ç‰ˆæœ¬ã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨æ³›å‹æ—¶æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ï¼›å½“ä»£ç è¿è¡Œï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡å°±è·Ÿå¥½åƒæ‰‹å†™æ¯ä¸ªå…·ä½“å®šä¹‰çš„é‡å¤ä»£ç ä¸€æ ·ã€‚è¿™ä¸ªå•æ€åŒ–è¿‡ç¨‹æ­£æ˜¯ Rust æ³›å‹åœ¨è¿è¡Œæ—¶æå…¶é«˜æ•ˆçš„åŸå› ã€‚

## 1.122 ğŸ¥’ ç‰¹å¾ Trait
ç‰¹å¾åœ¨Rustä¸­è€Œ**å¯ä»¥æš‚æ—¶ç†è§£ä¸ºæŠ½è±¡ç±»ï¼ˆåœ¨åœ£ç»ä¸­ä½œè€…è¯´æ˜¯æ¥å£ï¼Œä½†æ˜¯æˆ‘çœ‹åˆ°é»˜è®¤æ–¹æ³•çš„æ—¶å€™æˆ‘å°±è§‰å¾—æ˜¯æŠ½è±¡ï¼Œè°èƒ½åœ¨æ¥å£é‡Œå®ç°æ–¹æ³•çš„ï¼Œè§ä¸‹â¬‡ï¸ï¼‰**
ç‰¹å¾å®šä¹‰äº†ä¸€ç»„å¯ä»¥è¢«å…±äº«çš„è¡Œä¸ºï¼Œåªè¦å®ç°äº†ç‰¹å¾ï¼Œä½ å°±èƒ½ä½¿ç”¨è¿™ç»„è¡Œä¸ºã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰æ–‡ç«  Post å’Œå¾®åš Weibo ä¸¤ç§å†…å®¹è½½ä½“ï¼Œè€Œæˆ‘ä»¬æƒ³å¯¹ç›¸åº”çš„å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œä¹Ÿå°±æ˜¯æ— è®ºæ˜¯æ–‡ç« å†…å®¹ï¼Œè¿˜æ˜¯å¾®åšå†…å®¹ï¼Œéƒ½å¯ä»¥åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿›è¡Œæ€»ç»“ï¼Œé‚£ä¹ˆæ€»ç»“è¿™ä¸ªè¡Œä¸ºå°±æ˜¯å…±äº«çš„ï¼Œå› æ­¤å¯ä»¥ç”¨ç‰¹å¾æ¥å®šä¹‰ï¼š
```rust
pub trait Summary {
    fn summary(&self) -> String;
}

pub struct Post {
    pub title: String, // æ ‡é¢˜
    pub author: String, // ä½œè€…
    pub content: String, // å†…å®¹
}

impl Summary for Post {
    fn summary(&self) -> String {
        format!("æ–‡ç« {}, ä½œè€…æ˜¯{}", self.title, self.author)
    }
}

pub struct Weibo {
    pub username: String,
    pub content: String
}

impl Summary for Weibo {
    fn summary(&self) -> String {
        format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
    }
}

fn main() {
    let post = Post{title: "Rustè¯­è¨€ç®€ä»‹".to_string(),author: "Sunface".to_string(), content: "Rustæ³°è£¤è¾£!".to_string()};
    let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};

    println!("{}", post.summary());
    println!("{}", weibo.summary());
}
```

### å­¤å„¿è§„åˆ™ï¼ˆOrphan Ruleï¼‰
å­¤å„¿è§„åˆ™ï¼ˆRustä¸­çš„å­¤å„¿è§„åˆ™æ—¨åœ¨è¿™ä¸ªé™åˆ¶çš„ä¸»è¦ç›®çš„æ˜¯é¿å…åœ¨ä¸åŒåº“ä¹‹é—´äº§ç”Ÿç‰¹è´¨å®ç°çš„å†²çªã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªåº“éƒ½è¯•å›¾ä¸ºåŒä¸€ä¸ªç±»å‹å®ç°åŒä¸€ä¸ªç‰¹è´¨ï¼Œè¿™å°†å¯¼è‡´ä¸ç¡®å®šæ€§å’Œæ½œåœ¨çš„é”™è¯¯ã€‚å­¤å„¿è§„åˆ™é€šè¿‡ç¡®ä¿ç‰¹è´¨å®ç°çš„å”¯ä¸€æ€§æ¥æé«˜åº“ä¹‹é—´çš„å…¼å®¹æ€§ï¼‰è¿™é‡Œï¼Œåœ¨åœ£ç»é˜…è¯»è¿‡ç¨‹ä¸­æˆ‘è®¤ä¸ºæ­¤å¤„åœ°æ–¹è®²çš„å¤ªè¿‡äºæ··ä¹±ï¼Œç”šè‡³ä¸å¥½ç†è§£ã€‚ä¸‹é¢è¯¦ç»†è®²è§£ä¸‹ã€‚

å­¤å„¿è§„åˆ™é€‚ç”¨äºç‰¹è´¨å®ç°ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š

- ç‰¹è´¨å¿…é¡»æ˜¯å½“å‰ crateï¼ˆåŒ…ï¼‰å®šä¹‰çš„ï¼›
- ç±»å‹å¿…é¡»æ˜¯å½“å‰ crateï¼ˆåŒ…ï¼‰å®šä¹‰çš„ã€‚
åªè¦æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå°±å¯ä»¥ä¸ºæŸä¸ªç±»å‹å®ç°ç‰¹è´¨ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é¿å…ç‰¹è´¨å®ç°å†²çªï¼Œç¡®ä¿åº“ä¹‹é—´çš„å…¼å®¹æ€§ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåº“ï¼š`my_crate` å’Œ `external_crate`ã€‚åœ¨è¿™ä¸¤ä¸ªåº“ä¸­ï¼Œåˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªç±»å‹å’Œä¸€ä¸ªç‰¹è´¨ï¼š

```rust
// external_crateåº“ä¸­
pub struct Foo;
pub trait Bar {
    fn do_something(&self);
}
```


```rust
// my_crateåº“ä¸­
pub struct MyType;
pub trait MyTrait {
    fn do_another_thing(&self);
}
```

æ ¹æ®å­¤å„¿è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `my_crate` ä¸­å®ç°ä»¥ä¸‹ç‰¹è´¨å®ç°ï¼š

1. ä¸º `MyType` å®ç° `MyTrait`ï¼Œå› ä¸º `MyType` å’Œ `MyTrait` éƒ½æ˜¯åœ¨å½“å‰ crateï¼ˆåŒ…ï¼‰å®šä¹‰çš„ã€‚
```rust
impl MyTrait for MyType {
    fn do_another_thing(&self) {
        println!("MyType å®ç°äº† MyTrait!");
    }
}
```

2. ä¸º `MyType` å®ç° `external_crate` ä¸­å®šä¹‰çš„ `Bar` ç‰¹è´¨ï¼Œå› ä¸º `MyType` æ˜¯åœ¨å½“å‰ crateï¼ˆåŒ…ï¼‰å®šä¹‰çš„ã€‚
```rust
use external_crate::Bar;

impl Bar for MyType {
    fn do_something(&self) {
        println!("MyType å®ç°äº† Bar!");
    }
}
```

ç„¶è€Œï¼Œæ ¹æ®å­¤å„¿è§„åˆ™ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ `my_crate` ä¸­å®ç°ä»¥ä¸‹ç‰¹è´¨å®ç°ï¼š
ä¸º `external_crate` ä¸­å®šä¹‰çš„ `Foo` ç±»å‹å®ç° `MyTrait` ç‰¹è´¨ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªéƒ½ä¸æ˜¯åœ¨å½“å‰ crateï¼ˆåŒ…ï¼‰å®šä¹‰çš„ã€‚
```rust
// è¿™å°†å¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºè¿åäº†å­¤å„¿è§„åˆ™
use external_crate::Foo;

impl MyTrait for Foo {
    fn do_another_thing(&self) {
        println!("Foo å®ç°äº† MyTrait!");
    }
}
```

æ€»ä¹‹ï¼Œè¿™æ ·ç†è§£ï¼Œåœ¨`ä½ çš„åº“ï¼ˆmy_crateï¼‰`ä¸­ï¼Œä½ å¯ä»¥ä¸ºå½“å‰åº“ä¸­å®šä¹‰çš„ç±»å‹å®ç°`å…¶ä»–åº“ï¼ˆå¦‚external_crateï¼‰`ä¸­å®šä¹‰çš„ç‰¹è´¨ï¼Œä¹Ÿå¯ä»¥ä¸ºå½“å‰åº“ä¸­å®šä¹‰çš„ç±»å‹å®ç°å½“å‰åº“ä¸­å®šä¹‰çš„ç‰¹è´¨ã€‚ç„¶è€Œï¼Œä½ ä¸èƒ½ä¸º`å…¶ä»–åº“ï¼ˆå¦‚external_crateï¼‰`ä¸­å®šä¹‰çš„ç±»å‹å®ç°`ä½ çš„åº“ï¼ˆmy_crateï¼‰`ä¸­å®šä¹‰çš„ç‰¹è´¨ã€‚å­¤å„¿è§„åˆ™ä¸»è¦å…³æ³¨çš„æ˜¯ç‰¹è´¨å®ç°ï¼Œä»¥ç¡®ä¿åº“ä¹‹é—´çš„å…¼å®¹æ€§ã€‚

### é»˜è®¤æ–¹æ³•
åœ¨è®²è¿°ç‰¹å¾çš„åœ°æ–¹ä¿®æ”¹ä¸¤å¤„åœ°æ–¹å³å¯çŸ¥é“é»˜è®¤æ–¹æ³•çš„æ•ˆæœï¼š
```rust
pub trait Summary {

    fn summary(&self) -> String {
        String::from("(Read more...)")
    }
}

impl Summary for Post {
}
```

é»˜è®¤å®ç°å…è®¸è°ƒç”¨ç›¸åŒç‰¹å¾ä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œå“ªæ€•è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°ã€‚æ‰€ä»¥æˆ‘ä¸€å¼€å§‹è¯´å®ƒååˆ†åƒå…¶ä»–è¯­è¨€çš„æŠ½è±¡ç±»
```rust
pub trait Summary {

    fn summarize_author(&self) -> String;

    fn summary(&self) -> String {
        String::from("(Read more...)")
    }
}



pub struct Weibo {
    pub username: String,
    pub content: String
}

impl Summary for Weibo {
    fn summary(&self) -> String {
        format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
    }
    //ä¸ºäº†ä½¿ç”¨ Summaryï¼Œåªéœ€è¦å®ç° summarize_author æ–¹æ³•å³å¯ï¼š
    fn summarize_author(&self) -> String {
        format!("@{}", self.username)
    }
}

fn main() {
    let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};

    println!("{}", weibo.summary());
    println!("{}", weibo.summarize_author());
}
```

### ä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°
ç°åœ¨æˆ‘ä»¬æ¥è®²ä¸‹ï¼ŒçœŸæ­£å¯ä»¥è®©ç‰¹å¾å¤§æ”¾å…‰å½©çš„åœ°æ–¹ã€‚

ç°åœ¨ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°ï¼š
```rust
pub fn notify(item: &impl Summary) {
    println!("Breaking news! {}", item.summarize());
}
```
impl Summaryï¼Œåªèƒ½è¯´æƒ³å‡ºè¿™ä¸ªç±»å‹çš„äººçœŸçš„æ˜¯èµ·åé¬¼æ‰ï¼Œç®€ç›´å¤ªè´´åˆ‡äº†ï¼Œæ•…åæ€ä¹‰ï¼Œå®ƒçš„æ„æ€æ˜¯ å®ç°äº†Summaryç‰¹å¾ çš„ item å‚æ•°ã€‚

è¿™æ ·çœ‹æ¥ï¼Œè¿™ä¸ªç‰¹å¾ç¡®å®åŠï¼Œç¨å¾®ä¿®æ”¹ä¸‹ä»£ç å³å¯ï¼š

```rust
pub trait Summary {

    fn summarize_author(&self) -> String;

    fn summary(&self) -> String {
        String::from("(Read more...)")
    }
}

pub struct Weibo {
    pub username: String,
    pub content: String
}

impl Summary for Weibo {
    fn summary(&self) -> String {
        format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
    }
    fn summarize_author(&self) -> String {
        format!("@{}", self.username)
    }
}

// ä½œä¸ºå‡½æ•°å‚æ•°
pub fn notify(item: &impl Summary) {
    println!("Breaking news! {}", item.summary());
}

fn main() {
    let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};

    notify(&weibo);
}
```

### ç‰¹å¾çº¦æŸ(trait bound)
åœ¨ç®€å•çš„åœºæ™¯ä¸‹ impl Trait è¿™ç§è¯­æ³•ç³–å°±è¶³å¤Ÿä½¿ç”¨
```rust
pub fn notify(item1: &impl Summary, item2: &impl Summary) {}
```

å¦‚æœæˆ‘ä»¬æƒ³è¦å¼ºåˆ¶å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°æ˜¯åŒä¸€ç±»å‹? å¯ä»¥å†ç”¨ä¸Šé¢çš„å¾®åšçš„ä¾‹å­ä¸¾ä¾‹
```rust
pub trait Summary {
    fn summary(&self) -> String {
        String::from("(Read more...)")
    }
}

pub struct Post {
    pub title: String, // æ ‡é¢˜
    pub author: String, // ä½œè€…
    pub content: String, // å†…å®¹
}

impl Summary for Post {
    fn summary(&self) -> String {
        format!("æ–‡ç« {}, ä½œè€…æ˜¯{}", self.title, self.author)
    }
}

pub struct Weibo {
    pub username: String,
    pub content: String
}

impl Summary for Weibo {
    fn summary(&self) -> String {
        format!("{}å‘è¡¨äº†å¾®åš{}", self.username, self.content)
    }
}

pub fn notify(item: &impl Summary, item2: &impl Summary) {
    println!("{}", item.summary());
    println!("{}", item2.summary());
}

fn main() {
    let post = Post{title: "Rustè¯­è¨€ç®€ä»‹".to_string(),author: "Sunface".to_string(), content: "Rustæ³°è£¤è¾£!".to_string()};
    let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};
    notify(&post, &weibo);
}
```
æ³›å‹ç±»å‹ T è¯´æ˜äº† item1 å’Œ item2 å¿…é¡»æ‹¥æœ‰åŒæ ·çš„ç±»å‹ï¼ŒåŒæ—¶ T: Summary è¯´æ˜äº† T å¿…é¡»å®ç° Summary ç‰¹å¾ã€‚
æ­¤æ—¶æˆ‘ä»¬æ›´æ¢äº†ä¹‹ååœ¨è¿è¡Œå°±è¿è¡Œä¸èµ·æ¥äº†
```rust
pub fn notify<T: Summary>(item: &T, item2: &T) {
    println!("{}", item.summary());
    println!("{}", item2.summary());
}
// ===================================
%%error[E0308]: mismatched types
  --> src/main.rs:38:19
   |
38 |     notify(&post, &weibo);
   |                   ^^^^^^ expected struct `Post`, found struct `Weibo`
   |
   = note: expected reference `&Post`
              found reference `&Weibo`

For more information about this error, try `rustc --explain E0308`.
error: could not compile `Demo` due to previous error%%
```

å†çœ‹æˆ‘åœ¨mainä¸­ä¿®æ”¹çš„å’Œæ‰“å°çš„ç»“æœå°±çŸ¥é“å¿…é¡»æ˜¯åŒæ ·çš„ç±»å‹æ˜¯ä»€ä¹ˆæ„æ€äº†ï¼š
```rust
pub fn notify<T: Summary>(item: &T, item2: &T) {
    println!("{}", item.summary());
    println!("{}", item2.summary());
}

fn main() {
    let post = Post{title: "Rustè¯­è¨€ç®€ä»‹".to_string(),author: "Sunface".to_string(), content: "Rustæ³°è£¤è¾£!".to_string()};
    let weibo = Weibo{username: "sunface".to_string(),content: "å¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨".to_string()};
    notify(&post, &post);
    notify(&weibo, &weibo);
    // ä¹Ÿå¯ä»¥è¿™æ ·æ”¹ï¼Œè€…æ˜¯è¿ç”¨äº†æ³›å‹å‚æ•°
    // notify::<Post>(&post, &post);
    // notify::<Weibo>(&weibo, &weibo);
}

// æ–‡ç« Rustè¯­è¨€ç®€ä»‹, ä½œè€…æ˜¯Sunface
// æ–‡ç« Rustè¯­è¨€ç®€ä»‹, ä½œè€…æ˜¯Sunface
// sunfaceå‘è¡¨äº†å¾®åšå¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨
// sunfaceå‘è¡¨äº†å¾®åšå¥½åƒå¾®åšæ²¡Tweetå¥½ç”¨
```


### å¤šé‡çº¦æŸ
è¦äº†è§£è¿™ä¸ªæœ‰ä¸¤ä¸ªæ¦‚å¿µéœ€è¦äº†è§£ï¼Œåœ¨åŸä½œè€…çš„æ–‡ç« ä¸­ç›´æ¥ä¸¾ä¾‹ï¼Œä½†å‡¡æ˜¯ä¸ªç¬¬ä¸€æ¬¡å­¦Rustçš„æ­£å¸¸äººéƒ½æ‡µé€¼
- å¯¼åŒ…
```rust
use std::fmt;
```
- ç»™PoståŠ å…¥Displayç‰¹å¾çš„å®ç°ï¼š

ä»‹ç»ä¸‹displayï¼š
> pub trait Display {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error>;
	}

ç©ºæ ¼å¼çš„æ ¼å¼ traitï¼Œ{}ã€‚
Display ä¸ Debug ç±»ä¼¼ï¼Œä½† Display æ˜¯é¢å‘ç”¨æˆ·çš„è¾“å‡ºï¼Œå› æ­¤æ— æ³•å¯¼å‡ºã€‚
æœ‰å…³æ ¼å¼åŒ–ç¨‹åºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ æ¨¡å—çº§æ–‡æ¡£ã€‚

ä¾‹å­ï¼š
```rust
use std::fmt;

struct Point {
    x: i32,
    y: i32,
}

impl fmt::Display for Point {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        write!(f, "({}, {})", self.x, self.y)
    }
}

let origin = Point { x: 0, y: 0 };

assert_eq!(format!("The origin is: {}", origin), "The origin is: (0, 0)");
```

æœ‰äº†ä¸Šè¿°ä¸¤ä¸ªåŸºç¡€ï¼Œå°±å¯ä»¥ç»™PoståŠ å…¥Displayç‰¹å¾çš„å®ç°
```rust
impl fmt::Display for Post { 
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result { 
    write!(f, "({}, {})", self.title, self.author) 
    }
}
```
ç„¶åå°±å¯ä»¥ç»™æ–¹æ³•åŠ å…¥æ–°çš„ç‰¹å¾çº¦æŸï¼š

```rust
pub fn notify(item: &(impl Summary + fmt::Display)) {
    println!("{}", item.summary());
}

```

### whereçº¦æŸ
é€šè¿‡ä¸Šé¢çš„å­¦ä¹ å†çœ‹whereçº¦æŸåº”è¯¥ä¸éš¾
å½“ç‰¹å¾çº¦æŸå˜å¾—å¾ˆå¤šæ—¶ï¼Œå‡½æ•°çš„ç­¾åå°†å˜å¾—å¾ˆå¤æ‚ï¼š
> fn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32 {}

ä¸¥æ ¼æ¥è¯´ï¼Œä¸Šé¢çš„ä¾‹å­è¿˜æ˜¯ä¸å¤Ÿå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯èƒ½å¯¹å…¶åšä¸€äº›å½¢å¼ä¸Šçš„æ”¹è¿›ï¼Œé€šè¿‡ whereï¼š

```rust
fn some_function<T, U>(t: &T, u: &U) -> i32
    where T: Display + Clone,
          U: Clone + Debug
{}

```

### ä½¿ç”¨ç‰¹å¾çº¦æŸæœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•æˆ–ç‰¹å¾
æ„Ÿè§‰ä½œè€…åœ¨å†™è¿™å‡ ç« å†…å®¹çš„æ—¶å€™åº”è¯¥æ˜¯å¤±æ‹äº†ï¼Œä¹Ÿæœ‰å¯èƒ½ä½œè€…å¯¹äºæŸäº›çŸ¥è¯†å…·å¤‡å¯èƒ½æ²¡è€ƒè™‘åˆ°åˆå­¦è€…çš„æ„Ÿå—ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­è¦çœ‹æ‡‚é¦–å…ˆè¦çŸ¥é“è¿™ä¸ªç‰¹å¾ï¼š
> Trait std::cmp::PartialOrd  ä¸€ä¸ªå¯ä»¥æ¯”è¾ƒæ’åºé¡ºåºçš„å€¼çš„ traitã€‚
- Partial éƒ¨åˆ†å­˜åœ¨çš„
- Ord å³orderï¼Œæ’åº

ä¸‹é¢çš„ä¾‹å­å°±å¯ä»¥çœ‹åˆ°ä½œè€…çš„æ„æ€
- `å®ç°new`ï¼Œåˆ›å»ºæ„é€ å‡½æ•°
- `å®ç°cmp_display`ï¼Œå¹¶çº¦æŸä¼ å…¥çš„å€¼åªèƒ½æ˜¯`Display`ï¼ˆå¯ä»¥æ‰“å°ï¼‰`PartialOrd`ï¼ˆå¯ä»¥æ’åºï¼‰çš„ã€‚
```rust

#![allow(unused)]
fn main() {
    use std::fmt::Display;

    struct Pair<T> {
        x: T,
        y: T,
    }

    impl<T> Pair<T> {
        fn new(x: T, y: T) -> Self {
            Self {
                x,
                y,
            }
        }
    }

	// åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ¯”è¾ƒ x å’Œ y çš„å¤§å°ï¼Œç„¶åæ‰“å°å‡ºè¾ƒå¤§çš„å€¼ã€‚
    impl<T: Display + PartialOrd> Pair<T> {
        fn cmp_display(&self) {
            if self.x >= self.y {
                println!("The largest member is x = {}", self.x);
            } else {
                println!("The largest member is y = {}", self.y);
            }
        }
    }
}

```

ç›¸ä¿¡ä½ ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œç†è§£äº†ç‰¹å¾çº¦æŸæ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚


### å‡½æ•°è¿”å›ä¸­çš„ impl Trait
æ ¹æ®ä½œè€…çš„ä¾‹å­è¿›è¡Œä¸¾ä¸€åä¸‰ï¼š

```rust
pub fn notify(item: &impl Summary) {
    println!("{}", item.summary());
}

fn returns_summarizable() -> impl Summary {
    Post {
        title: String::from("sunface"),
        content: String::from(
            "m1 maxå¤ªå‰å®³äº†ï¼Œç”µè„‘å†ä¹Ÿä¸ä¼šå¡",
        ),
        author: String::from("none")
    }
}

fn main() {
    let post = returns_summarizable();
    notify(&post);
}
```

### ä¿®å¤ä¸Šä¸€èŠ‚ä¸­çš„ largest å‡½æ•°
åœ¨åœ£ç»ä¸­ä½œè€…çœŸæ˜¯é«˜çœ‹æˆ‘äº†ï¼Œæˆ‘å·²ç»å¯¹è¿™ä¸ªå‡½æ•°å¤±å¿†äº†ï¼Œè¿™æ®µä½œè€…å¥½åƒåˆä»å¤±æ‹ä¸­èµ°å‡ºæ¥äº†ï¼Œæ„Ÿè§‰é¬¼æ–§ç¥å·¥çš„èƒ½åŠ›åˆå›æ¥äº†ã€‚
åœ¨æºä»£ç ä¸­æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼š

```rust
fn largest<T>(list: &[T]) -> T {
    let mut largest = list[0];

    for &item in list.iter() {
        if item > largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&char_list);
    println!("The largest char is {}", result);
}
```


```
error[E0369]: binary operation `>` cannot be applied to type `T`
 --> src/main.rs:5:17
  |
5 |         if item > largest {
  |            ---- ^ ------- T
  |            |
  |            T
  |
help: consider restricting type parameter `T`
  |
1 | fn largest<T: std::cmp::PartialOrd>(list: &[T]) -> T {
  |             ++++++++++++++++++++++

For more information about this error, try `rustc --explain E0369`.
error: could not compile `Demo` due to previous error
```

ä¸‹é¢æ¥ä¸€æ­¥ä¸€æ­¥æ¥ä½“éªŒRustçš„å®‰å…¨æ€§ï¼Œåˆšåˆšæˆ‘ä»¬å­¦ä¹ äº†å¯æ’åºç‰¹æ€§ï¼š`PartialOrd`ï¼Œæˆ‘ä»¬å°±ç»™è¿™ä¸ªliståŠ ä¸Šè¿™ä¸ªç‰¹æ€§ï¼š

```rust
fn largest<T: PartialOrd>(list: &[T]) -> T {
    let mut largest = list[0];

    for &item in list.iter() {
        if item > largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&char_list);
    println!("The largest char is {}", result);
}
```

è¿˜æ˜¯æŠ¥é”™ï¼Œä½†æ˜¯ä¸è¦ç´§ï¼Œæ„Ÿè§‰è¦å‡ºæ¥äº†

```
error[E0507]: cannot move out of a shared reference
 --> src/main.rs:4:18
  |
4 |     for &item in list.iter() {
  |         -----    ^^^^^^^^^^^
  |         ||
  |         |data moved here
  |         |move occurs because `item` has type `T`, which does not implement the `Copy` trait
  |         help: consider removing the `&`: `item`

Some errors have detailed explanations: E0507, E0508.
For more information about an error, try `rustc --explain E0507`.
error: could not compile `Demo` due to 2 previous errors
```

ä»ä¸Šè¿°çš„æç¤ºçœ‹å‡ºæ¥åº”è¯¥æ˜¯iter()å‡ºäº†é—®é¢˜ï¼Œé”™è¯¯çš„æ ¸å¿ƒæ˜¯ cannot move out of type [T], a non-copy sliceï¼ŒåŸå› æ˜¯ T æ²¡æœ‰å®ç° Copy ç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½æŠŠæ‰€æœ‰æƒè¿›è¡Œè½¬ç§»ï¼Œæ¯•ç«Ÿåªæœ‰ i32 ç­‰åŸºç¡€ç±»å‹æ‰å®ç°äº† Copy ç‰¹æ€§ï¼Œå¯ä»¥å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œ T å¯ä»¥æŒ‡ä»£ä»»ä½•ç±»å‹ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯å®ç°äº† PartialOrd ç‰¹å¾çš„æ‰€æœ‰ç±»å‹ï¼‰ã€‚

å› æ­¤ï¼Œä¸ºäº†è®© T æ‹¥æœ‰ Copy ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ ç‰¹å¾çº¦æŸï¼š
åœ¨è¿™ä¹‹å‰ä»‹ç»ä¸‹copy
> pub unsafe fn copy`<T>`(src: *const T, dst: *mut T, count: usize) å°† count * size_of::`<T>`() å­—èŠ‚ä» src å¤åˆ¶åˆ° dstã€‚æºå’Œç›®æ ‡å¯èƒ½ä¼šé‡å ã€‚


```rust
fn largest<T: PartialOrd + Copy>(list: &[T]) -> T {
    let mut largest = list[0];

    for &item in list.iter() {
        if item > largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&number_list);
    println!("The largest number is {}", result);

    let char_list = vec!['y', 'm', 'a', 'q'];

    let result = largest(&char_list);
    println!("The largest char is {}", result);
}
```

å¦‚æœå¹¶ä¸å¸Œæœ›é™åˆ¶ largest å‡½æ•°åªèƒ½ç”¨äºå®ç°äº† Copy ç‰¹å¾çš„ç±»å‹ï¼Œæˆ‘ä»¬`å¯ä»¥åœ¨ T çš„ç‰¹å¾çº¦æŸä¸­æŒ‡å®š Clone ç‰¹å¾ è€Œä¸æ˜¯ Copy ç‰¹å¾`ã€‚å¹¶å…‹éš† list ä¸­çš„æ¯ä¸€ä¸ªå€¼ä½¿å¾— largest å‡½æ•°æ‹¥æœ‰å…¶æ‰€æœ‰æƒã€‚ä½¿ç”¨ clone å‡½æ•°æ„å‘³ç€å¯¹äºç±»ä¼¼ String è¿™æ ·æ‹¥æœ‰å †ä¸Šæ•°æ®çš„ç±»å‹ï¼Œä¼šæ½œåœ¨åœ°åˆ†é…æ›´å¤šå †ä¸Šç©ºé—´ï¼Œè€Œå †åˆ†é…åœ¨æ¶‰åŠå¤§é‡æ•°æ®æ—¶å¯èƒ½ä¼šç›¸å½“ç¼“æ…¢ã€‚

```rust
// é€šç”¨çš„ traitï¼Œç”¨äºæ˜¾å¼å¤åˆ¶å¯¹è±¡ã€‚
pub trait Clone {
    fn clone(&self) -> Self;

    fn clone_from(&mut self, source: &Self) { ... }
}
```



å¦ä¸€ç§ `largest çš„å®ç°æ–¹å¼æ˜¯è¿”å›åœ¨ list ä¸­ T å€¼çš„å¼•ç”¨`ã€‚å¦‚æœæˆ‘ä»¬å°†å‡½æ•°è¿”å›å€¼ä» T æ”¹ä¸º &T å¹¶æ”¹å˜å‡½æ•°ä½“ä½¿å…¶èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œæˆ‘ä»¬å°†ä¸éœ€è¦ä»»ä½• Clone æˆ– Copy çš„ç‰¹å¾çº¦æŸè€Œä¸”ä¹Ÿä¸ä¼šæœ‰ä»»ä½•çš„å †åˆ†é…ã€‚å°è¯•è‡ªå·±å®ç°è¿™ç§æ›¿ä»£è§£å†³æ–¹å¼å§ï¼

### é€šè¿‡ derive æ´¾ç”Ÿç‰¹å¾
åœ¨æœ¬ä¹¦ä¸­ï¼Œå½¢å¦‚ #[derive(Debug)] çš„ä»£ç å·²ç»å‡ºç°äº†å¾ˆå¤šæ¬¡ï¼Œè¿™ç§æ˜¯ä¸€ç§ç‰¹å¾æ´¾ç”Ÿè¯­æ³•ï¼Œè¢« derive æ ‡è®°çš„å¯¹è±¡ä¼šè‡ªåŠ¨å®ç°å¯¹åº”çš„é»˜è®¤ç‰¹å¾ä»£ç ï¼Œç»§æ‰¿ç›¸åº”çš„åŠŸèƒ½ã€‚

ä¾‹å¦‚ Debug ç‰¹å¾ï¼Œå®ƒæœ‰ä¸€å¥—è‡ªåŠ¨å®ç°çš„é»˜è®¤ä»£ç ï¼Œå½“ä½ ç»™ä¸€ä¸ªç»“æ„ä½“æ ‡è®°åï¼Œå°±å¯ä»¥ä½¿ç”¨ println!("{:?}", s) çš„å½¢å¼æ‰“å°è¯¥ç»“æ„ä½“çš„å¯¹è±¡ã€‚

å†å¦‚ Copy ç‰¹å¾ï¼Œå®ƒä¹Ÿæœ‰ä¸€å¥—è‡ªåŠ¨å®ç°çš„é»˜è®¤ä»£ç ï¼Œå½“æ ‡è®°åˆ°ä¸€ä¸ªç±»å‹ä¸Šæ—¶ï¼Œå¯ä»¥è®©è¿™ä¸ªç±»å‹è‡ªåŠ¨å®ç° Copy ç‰¹å¾ï¼Œè¿›è€Œå¯ä»¥è°ƒç”¨ copy æ–¹æ³•ï¼Œè¿›è¡Œè‡ªæˆ‘å¤åˆ¶ã€‚

æ€»ä¹‹ï¼Œderive æ´¾ç”Ÿå‡ºæ¥çš„æ˜¯ Rust é»˜è®¤ç»™æˆ‘ä»¬æä¾›çš„ç‰¹å¾ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æå¤§çš„ç®€åŒ–äº†è‡ªå·±æ‰‹åŠ¨å®ç°ç›¸åº”ç‰¹å¾çš„éœ€æ±‚ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥è‡ªå·±æ‰‹åŠ¨é‡è½½è¯¥å®ç°ã€‚

### è°ƒç”¨æ–¹æ³•éœ€è¦å¼•å…¥ç‰¹å¾
åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä½¿ç”¨` as å…³é”®å­—`åšç±»å‹è½¬æ¢ä¼šæœ‰æ¯”è¾ƒå¤§çš„é™åˆ¶ï¼Œå› ä¸ºä½ æƒ³è¦åœ¨ç±»å‹è½¬æ¢ä¸Šæ‹¥æœ‰å®Œå…¨çš„æ§åˆ¶ï¼Œä¾‹å¦‚å¤„ç†è½¬æ¢é”™è¯¯ï¼Œé‚£ä¹ˆä½ å°†éœ€è¦ `TryInto`ï¼š

> TryIntoï¼šæ¶ˆè€— self çš„å°è¯•è½¬æ¢ï¼Œè¿™å¯èƒ½å¾ˆæ˜‚è´µï¼Œä¹Ÿå¯èƒ½ä¸æ˜‚è´µã€‚åº“ä½œè€…é€šå¸¸ä¸åº”ç›´æ¥å®ç°æ­¤ traitï¼Œè€Œåº”é¦–é€‰å®ç° TryFrom traitï¼Œå®ƒå…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶å…è´¹æä¾›äº†ç­‰æ•ˆçš„ TryInto å®ç°ï¼Œè¿™è¦å½’åŠŸäºæ ‡å‡†åº“ä¸­çš„å…¨é¢å®ç°ã€‚ æœ‰å…³æ­¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ Into çš„æ–‡æ¡£ã€‚
```rust
pub trait TryInto<T> {
    type Error;
    fn try_into(self) -> Result<T, Self::Error>;
}
```

ä¾‹å­ï¼š
```rust
use std::convert::TryInto;

fn main() {
  let a: i32 = 10;
  let b: u16 = 100;

  let b_ = b.try_into()
            .unwrap();

  if a < b_ {
    println!("Ten is less than one hundred.");
  }
}

```

å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥å°†ä¸€ä¸ª i32 ç±»å‹çš„å€¼è½¬æ¢ä¸º u8 ç±»å‹ï¼Œå¹¶åœ¨è½¬æ¢å¤±è´¥æ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼š

```rust
use std::convert::TryInto;

fn main() {
    let i: i32 = 300;
    let result: Result<u8, _> = i.try_into(); // å°è¯•å°† i32 ç±»å‹è½¬æ¢ä¸º u8 ç±»å‹
    match result {
        Ok(value) => println!("Converted to u8: {}", value),
        Err(e) => println!("Failed to convert: {}", e),
    }
}
```
åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°† i çš„å€¼è®¾ç½®ä¸º 300ï¼Œè¿™æ˜¯ä¸€ä¸ªè¶…å‡º u8 å–å€¼èŒƒå›´çš„å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ i.try_into() æ–¹æ³•å°è¯•å°† i è½¬æ¢ä¸º u8 ç±»å‹ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ result å˜é‡ä¸­ã€‚ç”±äº i çš„å€¼è¶…å‡ºäº† u8 çš„å–å€¼èŒƒå›´ï¼Œå› æ­¤è½¬æ¢å¤±è´¥ï¼Œresult çš„å€¼å°†æ˜¯ä¸€ä¸ª Err æšä¸¾å˜ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ã€‚åœ¨ match è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ result çš„å€¼ï¼Œå¹¶æ‰“å°å‡ºç›¸åº”çš„ä¿¡æ¯ã€‚

æ€»ä¹‹ï¼Œ`std::convert::TryInto` trait å’Œç›¸å…³æ–¹æ³•æä¾›äº†ä¸€ç§å®‰å…¨çš„ç±»å‹è½¬æ¢æ–¹å¼ï¼Œå¯ä»¥åœ¨è½¬æ¢å¤±è´¥æ—¶è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œé¿å…äº†ä¸å®‰å…¨çš„ç±»å‹è½¬æ¢å’Œæ½œåœ¨çš„è¿è¡Œæ—¶é”™è¯¯ã€‚

### âœ¨ ç‰¹å¾å¯¹è±¡
åŸåœ£ç»ä¸­åœ¨è¿™å—è®²çš„ç¨å¾®æœ‰ç‚¹æ··ä¹±ï¼Œè®©æˆ‘æ¥æ•´ç†ä¸‹ã€‚
åœ¨Rustç¼–ç¨‹è¯­è¨€ä¸­ï¼Œ**ç‰¹å¾å¯¹è±¡ï¼ˆtrait objectï¼‰** æ˜¯ä¸€ç§å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¤„ç†ä¸åŒç±»å‹çš„å¯¹è±¡ï¼ŒåŒæ—¶æ»¡è¶³æŸä¸€ç‰¹å¾ï¼ˆtraitï¼‰çº¦æŸçš„æ–¹æ³•ã€‚ç‰¹å¾å¯¹è±¡å¯ä»¥å®ç°**å¤šæ€ï¼ˆpolymorphismï¼‰**ï¼Œè¿™ä½¿å¾—åœ¨å¤„ç†åŒä¸€ç‰¹å¾çš„ä¸åŒç±»å‹å¯¹è±¡æ—¶å¯ä»¥æ›´ç®€å•åœ°ç¼–å†™ä»£ç ã€‚

ç‰¹å¾å¯¹è±¡çš„ä½¿ç”¨åœºæ™¯é€šå¸¸æ˜¯å½“ä½ å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼ˆå¦‚å¼•ç”¨æˆ–è€…Boxï¼‰æ¥æŒ‡å‘å®ç°äº†æŸä¸ªç‰¹å¾çš„ç±»å‹ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå…·ä½“ç±»å‹çš„æƒ…å†µã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨**åŠ¨æ€åˆ†å‘ï¼ˆdynamic dispatchï¼‰** æ¥å¤„ç†è¿™äº›å¯¹è±¡ã€‚åŠ¨æ€åˆ†å‘ä¼šåœ¨è¿è¡Œæ—¶ä¸ºä½ è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å®ç°ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚

è¦ä½¿ç”¨ç‰¹å¾å¯¹è±¡ï¼Œä½ éœ€è¦éµå¾ªä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š
1. `å®šä¹‰ä¸€ä¸ªç‰¹å¾`ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå«åšDrawableçš„ç‰¹å¾ï¼ŒåŒ…å«ä¸€ä¸ªdrawæ–¹æ³•ï¼š
```rust
trait Drawable {
    fn draw(&self);
}
```

2. `ä¸ºå¤šä¸ªç»“æ„ä½“ï¼ˆstructï¼‰æˆ–æšä¸¾ï¼ˆenumï¼‰å®ç°è¿™ä¸ªç‰¹å¾`ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªCircleç»“æ„ä½“å’Œä¸€ä¸ªRectangleç»“æ„ä½“ï¼Œå¹¶å®ç°Drawableç‰¹å¾ï¼š

```rust
struct Circle {
    radius: f64,
}

struct Rectangle {
    width: f64,
    height: f64,
}

impl Drawable for Circle {
    fn draw(&self) {
        println!("Drawing a circle with radius: {}", self.radius);
    }
}

impl Drawable for Rectangle {
    fn draw(&self) {
        println!("Drawing a rectangle with width: {} and height: {}", self.width, self.height);
    }
}

```

3. `ä½¿ç”¨ç‰¹å¾å¯¹è±¡`ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå®ç°äº†Drawableç‰¹å¾çš„ç±»å‹çš„å¼•ç”¨ï¼Œå¹¶è°ƒç”¨drawæ–¹æ³•ï¼š

```rust
fn draw_shapes(shapes: &[&dyn Drawable]) {
    for shape in shapes {
        shape.draw();
    }
}

```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ`&dyn Drawable`å°±æ˜¯ä¸€ä¸ªç‰¹å¾å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘å®ç°äº†Drawableç‰¹å¾çš„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶å¤„ç†å®ç°äº†Drawableç‰¹å¾çš„ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ç„¶åå¯ä»¥è°ƒç”¨å®ƒä»¬ï¼š

```rust
fn main() {
    let circle = Circle { radius: 5.0 };
    let rectangle = Rectangle { width: 10.0, height: 20.0 };

    let shapes: [&dyn Drawable; 2] = [&circle, &rectangle];

    draw_shapes(&shapes);
}
```


å½“ç„¶åœ¨åŸåœ£ç»ä¸­ä½¿ç”¨äº†é›†åˆï¼Œç°åœ¨ç†è§£äº†å°±å¯ä»¥ä½¿ç”¨ä¸‹ï¼š
- åˆ›å»ºä¸€ä¸ªå­˜å‚¨
- å…¶ä¸­å­˜å‚¨äº†ä¸€ä¸ªåŠ¨æ€æ•°ç»„`Vec`ï¼Œé‡Œé¢å…ƒç´ çš„ç±»å‹æ˜¯ Draw ç‰¹å¾å¯¹è±¡ï¼š`Box<dyn Draw>`ï¼Œä»»ä½•å®ç°äº† Draw ç‰¹å¾çš„ç±»å‹ï¼Œéƒ½å¯ä»¥å­˜æ”¾å…¶ä¸­ã€‚
```rust
pub struct Screen {
    pub components: Vec<Box<dyn Drawable>>,
}
```
- ä¸ºäº†è®©æ¯ä¸€ä¸ªå½¢çŠ¶éƒ½èƒ½è¢«æ‰“å°ï¼Œç»™è¿™ä¸ªScreenå®ç°æ–¹æ³•

```rust
impl Screen {
    pub fn run(&self) {
        for component in self.components.iter() {
            component.draw();
        }
    }
}
```
- åœ¨mainä¸­ï¼Œå®šä¹‰è¿™äº›å½¢çŠ¶åŠ å…¥åˆ°é›†åˆé‡Œ
  
```rust
fn main() {
	let components: Vec<Box<dyn Drawable>> = vec![
	        Box::new(Circle {
	            radius: 1.5
	        }),
	        Box::new(Rectangle {
	            width: 2.0,
	            height: 2.0,
	        })
	    ];
}
```

- è®©å®ƒè¿è¡Œèµ·æ¥

```rust
fn main() {
    let components: Vec<Box<dyn Drawable>> = vec![
        Box::new(Circle {
            radius: 1.5
        }),
        Box::new(Rectangle {
            width: 2.0,
            height: 2.0,
        })
    ];

    let screen = Screen {
        components
    };

    screen.run();
}
```
- ä½ å¯èƒ½è¿è¡Œçš„å¾ˆé¡ºåˆ©ï¼Œä½†æ˜¯æˆ‘è¿è¡Œçš„ç›¸å½“ä¸é¡ºåˆ©ï¼ŒåŸå› å‡ºåœ¨`let components: Vec<Box<dyn Drawable>>`ï¼ŒRuståœ¨è‡ªåŠ¨æ¨æ–­çš„æ—¶å€™ä¸€ç›´åˆ¤æ–­å®ƒæ˜¯ä¸€ä¸ªcircleï¼Œè€Œä¸æ˜¯åŠ¨æ€çš„ï¼Œå¯¼è‡´å‡ºé—®é¢˜ï¼Œä¸ä¿¡å¯ä»¥åˆ é™¤è¯•è¯•

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ç‰¹å¾å¯¹è±¡æ—¶ä¼šæœ‰ä¸€äº›æ€§èƒ½æŸå¤±ï¼Œå› ä¸ºRustéœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾å¹¶è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å®ç°ã€‚ä½†åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™ç§æ€§èƒ½æŸå¤±æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¹¶ä¸”ç‰¹å¾å¯¹è±¡ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚

### ç‰¹å¾å¯¹è±¡çš„åŠ¨æ€åˆ†å‘
å›å¿†ä¸€ä¸‹æ³›å‹ç« èŠ‚æˆ‘ä»¬æåˆ°è¿‡çš„ï¼Œæ³›å‹æ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆå¤„ç†çš„ï¼šç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªæ³›å‹å‚æ•°å¯¹åº”çš„å…·ä½“ç±»å‹ç”Ÿæˆä¸€ä»½ä»£ç ï¼Œè¿™ç§æ–¹å¼æ˜¯**é™æ€åˆ†å‘(static dispatch)**ï¼Œå› ä¸ºæ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆçš„ï¼Œå¯¹äºè¿è¡ŒæœŸæ€§èƒ½å®Œå…¨æ²¡æœ‰ä»»ä½•å½±å“ã€‚

ä¸é™æ€åˆ†å‘ç›¸å¯¹åº”çš„æ˜¯**åŠ¨æ€åˆ†å‘(dynamic dispatch)**ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›´åˆ°è¿è¡Œæ—¶ï¼Œæ‰èƒ½ç¡®å®šéœ€è¦è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ã€‚ä¹‹å‰ä»£ç ä¸­çš„å…³é”®å­— dyn æ­£æ˜¯åœ¨å¼ºè°ƒè¿™ä¸€â€œåŠ¨æ€â€çš„ç‰¹ç‚¹ã€‚

å½“ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ—¶ï¼ŒRust å¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†å‘ã€‚ç¼–è¯‘å™¨æ— æ³•çŸ¥æ™“æ‰€æœ‰å¯èƒ½ç”¨äºç‰¹å¾å¯¹è±¡ä»£ç çš„ç±»å‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸çŸ¥é“åº”è¯¥è°ƒç”¨å“ªä¸ªç±»å‹çš„å“ªä¸ªæ–¹æ³•å®ç°ã€‚ä¸ºæ­¤ï¼ŒRust åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç‰¹å¾å¯¹è±¡ä¸­çš„æŒ‡é’ˆæ¥çŸ¥æ™“éœ€è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚åŠ¨æ€åˆ†å‘ä¹Ÿé˜»æ­¢ç¼–è¯‘å™¨æœ‰é€‰æ‹©çš„å†…è”æ–¹æ³•ä»£ç ï¼Œè¿™ä¼šç›¸åº”çš„ç¦ç”¨ä¸€äº›ä¼˜åŒ–ã€‚

ä¸‹é¢è¿™å¼ å›¾å¾ˆå¥½çš„è§£é‡Šäº†é™æ€åˆ†å‘ `Box<T>` å’ŒåŠ¨æ€åˆ†å‘ `Box<dyn Trait>` çš„åŒºåˆ«ï¼š
![](https://pic1.zhimg.com/80/v2-b771fe4cfc6ebd63d9aff42840eb8e67_1440w.jpg)
ç»“åˆä¸Šæ–‡çš„å†…å®¹å’Œè¿™å¼ å›¾å¯ä»¥äº†è§£ï¼š

- **ç‰¹å¾å¯¹è±¡å¤§å°ä¸å›ºå®š**ï¼šè¿™æ˜¯å› ä¸ºï¼Œå¯¹äºç‰¹å¾ Drawï¼Œç±»å‹ Button å¯ä»¥å®ç°ç‰¹å¾ Drawï¼Œç±»å‹ SelectBox ä¹Ÿå¯ä»¥å®ç°ç‰¹å¾ Drawï¼Œå› æ­¤ç‰¹å¾æ²¡æœ‰å›ºå®šå¤§å°
- **å‡ ä¹æ€»æ˜¯ä½¿ç”¨ç‰¹å¾å¯¹è±¡çš„å¼•ç”¨æ–¹å¼**ï¼Œå¦‚ `&dyn Drawã€Box<dyn Draw>`
	- è™½ç„¶ç‰¹å¾å¯¹è±¡æ²¡æœ‰å›ºå®šå¤§å°ï¼Œä½†å®ƒçš„å¼•ç”¨ç±»å‹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå®ƒç”±ä¸¤ä¸ªæŒ‡é’ˆç»„æˆï¼ˆptr å’Œ vptrï¼‰ï¼Œå› æ­¤å ç”¨ä¸¤ä¸ªæŒ‡é’ˆå¤§å°
	- ä¸€ä¸ªæŒ‡é’ˆ ptr æŒ‡å‘å®ç°äº†ç‰¹å¾ Draw çš„å…·ä½“ç±»å‹çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯å½“ä½œç‰¹å¾ Draw æ¥ç”¨çš„ç±»å‹çš„å®ä¾‹ï¼Œæ¯”å¦‚ç±»å‹ Button çš„å®ä¾‹ã€ç±»å‹ SelectBox çš„å®ä¾‹
	- å¦ä¸€ä¸ªæŒ‡é’ˆ vptr æŒ‡å‘ä¸€ä¸ªè™šè¡¨ vtableï¼Œvtable ä¸­ä¿å­˜äº†ç±»å‹ Button æˆ–ç±»å‹ SelectBox çš„å®ä¾‹å¯¹äºå¯ä»¥è°ƒç”¨çš„å®ç°äºç‰¹å¾ Draw çš„æ–¹æ³•ã€‚å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œç›´æ¥ä» vtable ä¸­æ‰¾åˆ°æ–¹æ³•å¹¶è°ƒç”¨ã€‚ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ä¸€ä¸ª vtable æ¥ä¿å­˜å„å®ä¾‹çš„æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®ç°äº†ç‰¹å¾ Draw çš„ç±»å‹æœ‰å¤šç§ï¼Œè¿™äº›ç±»å‹æ‹¥æœ‰çš„æ–¹æ³•å„ä¸ç›¸åŒï¼Œå½“å°†è¿™äº›ç±»å‹çš„å®ä¾‹éƒ½å½“ä½œç‰¹å¾ Draw æ¥ä½¿ç”¨æ—¶(æ­¤æ—¶ï¼Œå®ƒä»¬å…¨éƒ½çœ‹ä½œæ˜¯ç‰¹å¾ Draw ç±»å‹çš„å®ä¾‹)ï¼Œæœ‰å¿…è¦åŒºåˆ†è¿™äº›å®ä¾‹å„è‡ªæœ‰å“ªäº›æ–¹æ³•å¯è°ƒç”¨
ç®€è€Œè¨€ä¹‹ï¼Œå½“ç±»å‹ Button å®ç°äº†ç‰¹å¾ Draw æ—¶ï¼Œç±»å‹ Button çš„å®ä¾‹å¯¹è±¡ btn å¯ä»¥å½“ä½œç‰¹å¾ Draw çš„ç‰¹å¾å¯¹è±¡ç±»å‹æ¥ä½¿ç”¨ï¼Œbtn ä¸­ä¿å­˜äº†ä½œä¸ºç‰¹å¾å¯¹è±¡çš„æ•°æ®æŒ‡é’ˆï¼ˆæŒ‡å‘ç±»å‹ Button çš„å®ä¾‹æ•°æ®ï¼‰å’Œè¡Œä¸ºæŒ‡é’ˆï¼ˆæŒ‡å‘ vtableï¼‰ã€‚

ä¸€å®šè¦æ³¨æ„ï¼Œæ­¤æ—¶çš„ btn æ˜¯ Draw çš„ç‰¹å¾å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œä¸å†æ˜¯å…·ä½“ç±»å‹ Button çš„å®ä¾‹ï¼Œè€Œä¸” btn çš„ vtable åªåŒ…å«äº†å®ç°è‡ªç‰¹å¾ Draw çš„é‚£äº›æ–¹æ³•ï¼ˆæ¯”å¦‚ drawï¼‰ï¼Œå› æ­¤ btn åªèƒ½è°ƒç”¨å®ç°äºç‰¹å¾ Draw çš„ draw æ–¹æ³•ï¼Œè€Œä¸èƒ½è°ƒç”¨ç±»å‹ Button æœ¬èº«å®ç°çš„æ–¹æ³•å’Œç±»å‹ Button å®ç°äºå…¶ä»–ç‰¹å¾çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œbtn æ˜¯å“ªä¸ªç‰¹å¾å¯¹è±¡çš„å®ä¾‹ï¼Œå®ƒçš„ vtable ä¸­å°±åŒ…å«äº†è¯¥ç‰¹å¾çš„æ–¹æ³•ã€‚

> æ€»çš„æ¥è¯´ï¼Œæ³›å‹æ˜¯é™æ€åˆ†å‘ï¼Œè€Œç‰¹å¾å¯¹è±¡åˆ™æ˜¯ä½¿ç”¨åŠ¨æ€åˆ†å‘ã€‚ç‰¹å¾å¯¹è±¡çš„å¤§å°ä¸å›ºå®šï¼Œä½¿ç”¨ç‰¹å¾å¯¹è±¡çš„å¼•ç”¨æ–¹å¼æ¥è§£å†³ï¼Œå®ƒçš„å¼•ç”¨ç±»å‹çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œç”±ä¸¤ä¸ªæŒ‡é’ˆç»„æˆã€‚ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ç°äº†ç‰¹å¾çš„å…·ä½“ç±»å‹çš„å®ä¾‹ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆåˆ™æŒ‡å‘è™šè¡¨ï¼Œè™šè¡¨ä¸­ä¿å­˜äº†å®ç°äº†ç‰¹å¾çš„ç±»å‹çš„å®ä¾‹ä¸­å¯ä»¥è°ƒç”¨çš„ç‰¹å¾æ–¹æ³•ã€‚å› ä¸ºç‰¹å¾å¯¹è±¡çš„å®ä¾‹ä¸å†æ˜¯å…·ä½“ç±»å‹çš„å®ä¾‹ï¼Œæ‰€ä»¥åªèƒ½è°ƒç”¨å®ç°äºç‰¹å¾æœ¬èº«çš„æ–¹æ³•ï¼Œè€Œä¸èƒ½è°ƒç”¨å…·ä½“ç±»å‹å®ç°çš„æ–¹æ³•å’Œå®ç°äºå…¶ä»–ç‰¹å¾çš„æ–¹æ³•ã€‚

### Self ä¸ self
åœ¨ Rust ä¸­ï¼Œæœ‰ä¸¤ä¸ªselfï¼Œä¸€ä¸ªæŒ‡ä»£å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œä¸€ä¸ªæŒ‡ä»£ç‰¹å¾æˆ–è€…æ–¹æ³•ç±»å‹çš„åˆ«åï¼š

```rust
trait Draw {
    fn draw(&self) -> Self;
}

#[derive(Clone)]
struct Button;
impl Draw for Button {
    fn draw(&self) -> Self {
        return self.clone()
    }
}

fn main() {
    let button = Button;
    let newb = button.draw();
}

```

ä¸Šè¿°ä»£ç ä¸­ï¼ŒselfæŒ‡ä»£çš„å°±æ˜¯å½“å‰çš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ button.draw() ä¸­çš„ button å®ä¾‹ï¼ŒSelf åˆ™æŒ‡ä»£çš„æ˜¯ Button ç±»å‹ã€‚


### ç‰¹å¾å¯¹è±¡çš„é™åˆ¶
ä¸æ˜¯æ‰€æœ‰ç‰¹å¾éƒ½èƒ½æ‹¥æœ‰ç‰¹å¾å¯¹è±¡ï¼Œåªæœ‰å¯¹è±¡å®‰å…¨çš„ç‰¹å¾æ‰è¡Œã€‚å½“ä¸€ä¸ªç‰¹å¾çš„æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å¦‚ä¸‹å±æ€§æ—¶ï¼Œå®ƒçš„å¯¹è±¡æ‰æ˜¯å®‰å…¨çš„ï¼š
- æ–¹æ³•çš„è¿”å›ç±»å‹ä¸èƒ½æ˜¯ Self
- æ–¹æ³•æ²¡æœ‰ä»»ä½•æ³›å‹å‚æ•°

å¯¹è±¡å®‰å…¨å¯¹äºç‰¹å¾å¯¹è±¡æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºä¸€æ—¦æœ‰äº†ç‰¹å¾å¯¹è±¡ï¼Œå°±ä¸å†éœ€è¦çŸ¥é“å®ç°è¯¥ç‰¹å¾çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆäº†ã€‚

å°ç»“ï¼šå¯¹è±¡å®‰å…¨æ˜¯æŒ‡åªæœ‰ç‰¹å®šæ¡ä»¶ä¸‹çš„ç‰¹å¾æ‰èƒ½ä½œä¸ºç‰¹å¾å¯¹è±¡ï¼Œä¸æ˜¯æ‰€æœ‰ç‰¹å¾éƒ½èƒ½æ‹¥æœ‰ç‰¹å¾å¯¹è±¡ï¼Œåªæœ‰å¯¹è±¡å®‰å…¨çš„ç‰¹å¾æ‰å¯ä»¥ã€‚å¯¹è±¡å®‰å…¨è¦æ±‚ç‰¹å¾æ–¹æ³•ä¸èƒ½è¿”å› Self ç±»å‹ä¸”æ²¡æœ‰æ³›å‹å‚æ•°ï¼Œå› ä¸ºç‰¹å¾å¯¹è±¡çš„å…·ä½“ç±»å‹è¢«æŠ¹å»äº†ï¼Œæ— æ³•çŸ¥é“æ”¾å…¥æ³›å‹å‚æ•°ç±»å‹æ˜¯ä»€ä¹ˆã€‚æ ‡å‡†åº“ä¸­çš„ Clone ç‰¹å¾å°±ä¸ç¬¦åˆå¯¹è±¡å®‰å…¨çš„è¦æ±‚ï¼Œå› ä¸ºå®ƒçš„å…¶ä¸­ä¸€ä¸ªæ–¹æ³•è¿”å›äº† Self ç±»å‹ã€‚å¦‚æœè¿åäº†å¯¹è±¡å®‰å…¨çš„è§„åˆ™ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ã€‚
```rust
pub struct Screen {
    pub components: Vec<Box<dyn Clone>>,
}
```

### å…³è”ç±»å‹
åœ¨äº†è§£è¿™ä¸ªç±»å‹ä¹‹å‰æˆ‘æ¥è¡¥å…¨ä¸‹Iterator

åŠŸèƒ½ï¼š
- Iteratoræ˜¯ä¸€ä¸ªtraitï¼Œä»£è¡¨ä¸€ä¸ªå¯ä»¥äº§ç”Ÿä¸€ç³»åˆ—å…ƒç´ çš„è¿­ä»£å™¨ã€‚
- nextæ–¹æ³•æ˜¯Iterator traitçš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚

è¾“å…¥ï¼š
- `self`ï¼šè¿­ä»£å™¨ç±»å‹çš„å¯å˜å¼•ç”¨ã€‚
è¾“å‡ºï¼š
-` Option<Self::Item>`ï¼šä¸€ä¸ªåŒ…å«ä¸‹ä¸€ä¸ªå…ƒç´ çš„Optionæšä¸¾ã€‚å¦‚æœæ²¡æœ‰æ›´å¤šå…ƒç´ äº†ï¼Œåˆ™è¿”å›Noneã€‚

```rust
pub trait Iterator {
    type Item;

    /// Returns the next element of the iterator, or `None` if there are no more elements.
    ///
    /// # Examples
    ///
    /// ```
    /// let v = vec![1, 2, 3];
    /// let mut iter = v.iter();
    ///
    /// assert_eq!(iter.next(), Some(&1));
    /// assert_eq!(iter.next(), Some(&2));
    /// assert_eq!(iter.next(), Some(&3));
    /// assert_eq!(iter.next(), None);
    /// ```
    fn next(&mut self) -> Option<Self::Item>;
}
```

- type Itemï¼šå…³è”ç±»å‹ï¼Œä»£è¡¨è¿­ä»£å™¨äº§ç”Ÿçš„å…ƒç´ ç±»å‹ã€‚
- fn next(&mut self) -> Option<Self::Item>ï¼šæ–¹æ³•ç­¾åï¼Œä½¿ç”¨&mut selfæ¥å¯å˜åœ°å¼•ç”¨è¿­ä»£å™¨æœ¬èº«ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ æˆ–Noneã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªåŒ…å«æ•´æ•°çš„å‘é‡æ¥åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¿­ä»£ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šå…ƒç´ ä¸ºæ­¢ã€‚

**æ¦‚è¿°**
**å…³è”ç±»å‹ï¼ˆassociated typeï¼‰** æ˜¯Rustç¼–ç¨‹è¯­è¨€ä¸­ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä¸»è¦ç”¨äºåœ¨traitä¸­å®šä¹‰å’ŒæŠ½è±¡å‡ºå…·æœ‰å…³è”æ€§çš„ç±»å‹ã€‚å…³è”ç±»å‹è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨traitä¸­å®šä¹‰ä¸€ä¸ªç±»å‹çš„å ä½ç¬¦ï¼Œä½¿å¾—åœ¨å®ç°traitæ—¶ï¼Œè¿™ä¸ªå ä½ç¬¦èƒ½è¢«å…·ä½“çš„ç±»å‹æ›¿ä»£ã€‚è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¯å¤ç”¨æ€§ã€‚

ä»¥ä¸‹æ˜¯å…³è”ç±»å‹ç›¸è¾ƒäºæ³›å‹çš„ä¸€äº›ä¼˜ç‚¹ï¼š

- è¯­ä¹‰æ¸…æ™°ï¼šå…³è”ç±»å‹è¡¨ç¤ºä¸€ç§å†…åœ¨çš„å…³è”ï¼Œå®ƒè¡¨æ˜åœ¨å®ç°è¯¥traitçš„ç±»å‹ä¸­å­˜åœ¨ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„ç±»å‹ã€‚è€Œæ³›å‹å‚æ•°è¡¨ç¤ºä¸€ç§æ›´åŠ å¤–éƒ¨çš„å…³è”ï¼Œå®ƒå¯ä»¥ç”¨äºå¤šç§ç±»å‹ï¼Œä¸å®ç°è¯¥traitçš„ç±»å‹å…³è”æ€§ä¸å¼ºã€‚å…³è”ç±»å‹å¯ä»¥è®©ä»£ç çš„æ„å›¾æ›´åŠ æ˜ç¡®ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚
- ç®€æ´æ€§ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨å…³è”ç±»å‹å¯ä»¥è®©ä»£ç æ›´ç®€æ´ã€‚å°¤å…¶æ˜¯åœ¨æ¶‰åŠå¤šä¸ªæ³›å‹å‚æ•°æ—¶ï¼Œä½¿ç”¨å…³è”ç±»å‹å¯ä»¥å‡å°‘æ³›å‹å‚æ•°çš„æ•°é‡ï¼Œè®©ä»£ç æ›´ç®€æ´æ˜“æ‡‚ã€‚
- çµæ´»æ€§ï¼šå…³è”ç±»å‹å…è®¸åœ¨traitå†…éƒ¨å¯¹æŸäº›ç±»å‹çš„çº¦æŸè¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œè€Œæ³›å‹å‚æ•°åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´çº¦æŸä¸å¤Ÿä¸¥æ ¼ã€‚

å…³è”ç±»å‹åœ¨traitä¸­ä½¿ç”¨typeå…³é”®å­—è¿›è¡Œå®šä¹‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…³è”ç±»å‹çš„ä¾‹å­ï¼š

```rust
trait Iterator {
    type Item;

    fn next(&mut self) -> Option<Self::Item>;
}
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºIteratorçš„traitï¼Œå®ƒåŒ…å«ä¸€ä¸ªåä¸ºItemçš„å…³è”ç±»å‹å’Œä¸€ä¸ªåä¸ºnextçš„æ–¹æ³•ã€‚nextæ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯Option<Self::Item>ï¼Œè¿™é‡Œçš„Self::Itemå°±æ˜¯å…³è”ç±»å‹çš„ç”¨æ³•ï¼Œè¡¨ç¤ºå®ç°è¿™ä¸ªtraitæ—¶ï¼ŒItemå…³è”ç±»å‹ä¼šè¢«å…·ä½“çš„ç±»å‹æ›¿ä»£ã€‚

å½“æˆ‘ä»¬å®ç°è¿™ä¸ªtraitæ—¶ï¼Œéœ€è¦æŒ‡å®šå…³è”ç±»å‹Itemçš„å…·ä½“ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„æ•´æ•°è¿­ä»£å™¨ï¼š

```rust
struct Integers {
    start: i32,
    end: i32,
}

impl Iterator for Integers {
    type Item = i32;

    fn next(&mut self) -> Option<Self::Item> {
        if self.start >= self.end {
            None
        } else {
            let result = self.start;
            self.start += 1;
            Some(result)
        }
    }
}

```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸ºIntegersç»“æ„ä½“å®ç°äº†Iterator traitï¼Œå¹¶æŒ‡å®šäº†å…³è”ç±»å‹Itemçš„å…·ä½“ç±»å‹ä¸ºi32ã€‚åœ¨nextæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Self::Itemæ¥è¡¨ç¤ºi32ç±»å‹ã€‚

é€šè¿‡å…³è”ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´çµæ´»åœ°å®šä¹‰å’Œå®ç°traitï¼Œä½¿å¾—ä»£ç æ›´å…·æœ‰é€šç”¨æ€§å’Œå¯å¤ç”¨æ€§ã€‚

ç›´æ¥è¿è¡Œå³å¯ï¼š

```rust
fn main() {
    let mut a = Integers{
        start: 1,
        end: 5,
    };
    while let Some(itor) = a.next() {
        println!("å½“å‰çš„æ•´æ•°: {}", itor);
    }
}
```

> è¯»åˆ°è¿™é‡Œè‚¯å®šä¼šæœ‰ç–‘æƒ‘çš„ï¼Œå› ä¸ºä¸çŸ¥é“æ³›å‹å’Œå…³è”ç±»å‹åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆèƒ½ç”¨æ³›å‹è§£å†³çš„è¦ç”¨å…³è”ç±»å‹æ¥è§£å†³ï¼Ÿ

æˆ‘çš„ç­”æ¡ˆæ˜¯**æé«˜ä»£ç ç®€æ´æ€§**ï¼Œå¦‚æœåªç”¨ä¸Šé¢çš„iteratoræˆ‘æ„Ÿè§‰æ˜¯è§£é‡Šä¸æ¸…æ¥šçš„ï¼Œæ‰€ä»¥æˆ‘ç”¨å›¾çš„æ–¹å¼ï¼ˆèŠ‚ç‚¹å’Œè¾¹ä½œä¸ºç‰¹å¾çš„å±æ€§ï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```rust
trait Graph<N, E> {
    fn has_edge(&self, &N, &N) -> bool;
    fn edges(&self, &N) -> Vec<E>;
}

impl<N, E, G> Graph<N, E> for G
where
    G: Iterator<Item = (N, N, E)>
{
    // ...
}

```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºGraphçš„traitï¼Œå®ƒåŒ…å«ä¸¤ä¸ªæ³›å‹å‚æ•°Nå’ŒEï¼Œåˆ†åˆ«è¡¨ç¤ºèŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ã€‚ç„¶åæˆ‘ä»¬ä¸ºä¸€ä¸ªGç±»å‹å®ç°äº†Graph<N, E>ï¼Œè¿™ä¸ªGç±»å‹æœ¬èº«å®ç°äº†Iterator<Item = (N, N, E)>ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³è”ç±»å‹ç®€åŒ–ä»£ç ï¼š

```rust
trait Graph {
    type Node;
    type Edge;

    fn has_edge(&self, &Self::Node, &Self::Node) -> bool;
    fn edges(&self, &Self::Node) -> Vec<Self::Edge>;
}

impl<G> Graph for G
where
    G: Iterator<Item = (Self::Node, Self::Node, Self::Edge)>
{
    // ...
}

```

é€šè¿‡ä½¿ç”¨å…³è”ç±»å‹ï¼Œæˆ‘ä»¬å°†Graph traitçš„æ³›å‹å‚æ•°Nå’ŒEæ›¿æ¢ä¸ºå…³è”ç±»å‹Nodeå’ŒEdgeï¼Œä»è€Œä½¿ä»£ç æ›´åŠ ç®€æ´æ˜“æ‡‚ã€‚

å½“ç„¶ï¼Œå¹¶éæ‰€æœ‰æƒ…å†µä¸‹å…³è”ç±»å‹éƒ½æ¯”æ³›å‹æ›´é€‚ç”¨ã€‚å…·ä½“é€‰æ‹©åº”æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯è¿›è¡Œæƒè¡¡ã€‚å®é™…ä¸Šï¼Œåœ¨è®¸å¤šåœºæ™¯ä¸­ï¼Œå…³è”ç±»å‹å’Œæ³›å‹å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å®ç°æ›´çµæ´»ã€æ›´é€šç”¨çš„ä»£ç ã€‚

### é»˜è®¤æ³›å‹ç±»å‹å‚æ•°
> æ²¡æ‡‚ï¼Œæˆ‘çœ‹åˆ°ä½œè€…æœ€åå†™äº†å¤§éƒ¨åˆ†æƒ…å†µç”¨ä¸åˆ°å°±æ²¡çœ‹äº†

å½“ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°æ—¶ï¼Œå¯ä»¥ä¸ºå…¶æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å…·ä½“ç±»å‹ï¼Œä¾‹å¦‚æ ‡å‡†åº“ä¸­çš„ std::ops::Add ç‰¹å¾ï¼š

```rust
trait Add<RHS=Self> {
    type Output;

    fn add(self, rhs: RHS) -> Self::Output;
}
```

å®ƒæœ‰ä¸€ä¸ªæ³›å‹å‚æ•° RHSï¼Œä½†æ˜¯ä¸æˆ‘ä»¬ä»¥å¾€çš„ç”¨æ³•ä¸åŒï¼Œè¿™é‡Œå®ƒç»™ RHS ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯å½“ç”¨æˆ·ä¸æŒ‡å®š RHS æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ä¸¤ä¸ªåŒæ ·ç±»å‹çš„å€¼è¿›è¡Œç›¸åŠ ï¼Œç„¶åè¿”å›ä¸€ä¸ªå…³è”ç±»å‹ Outputã€‚

å¯èƒ½ä¸Šé¢é‚£æ®µä¸å¤ªå¥½ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç æ¥ä¸¾ä¾‹ï¼š

```rust
use std::ops::Add;

#[derive(Debug, PartialEq)]
struct Point {
    x: i32,
    y: i32,
}

impl Add for Point {
    type Output = Point;

    fn add(self, other: Point) -> Point {
        Point {
            x: self.x + other.x,
            y: self.y + other.y,
        }
    }
}

fn main() {
    assert_eq!(Point { x: 1, y: 0 } + Point { x: 2, y: 3 },
               Point { x: 3, y: 3 });
}

```
ä¸Šé¢çš„ä»£ç ä¸»è¦å¹²äº†ä¸€ä»¶äº‹ï¼Œå°±æ˜¯ä¸º Point ç»“æ„ä½“æä¾› + çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯è¿ç®—ç¬¦é‡è½½ï¼Œä¸è¿‡ Rust å¹¶ä¸æ”¯æŒåˆ›å»ºè‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œä½ ä¹Ÿæ— æ³•ä¸ºæ‰€æœ‰è¿ç®—ç¬¦è¿›è¡Œé‡è½½ï¼Œç›®å‰æ¥è¯´ï¼Œåªæœ‰å®šä¹‰åœ¨ std::ops ä¸­çš„è¿ç®—ç¬¦æ‰èƒ½è¿›è¡Œé‡è½½ã€‚

è·Ÿ + å¯¹åº”çš„ç‰¹å¾æ˜¯ std::ops::Addï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰ä¹Ÿçœ‹è¿‡å®ƒçš„å®šä¹‰ trait Add<RHS=Self>ï¼Œä½†æ˜¯ä¸Šé¢çš„ä¾‹å­ä¸­å¹¶æ²¡æœ‰ä¸º Point å®ç° `Add<RHS>` ç‰¹å¾ï¼Œè€Œæ˜¯å®ç°äº† Add ç‰¹å¾ï¼ˆæ²¡æœ‰é»˜è®¤æ³›å‹ç±»å‹å‚æ•°ï¼‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨äº† RHS çš„é»˜è®¤ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ Selfã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œå®šä¹‰çš„æ˜¯ä¸¤ä¸ªç›¸åŒçš„ Point ç±»å‹ç›¸åŠ ï¼Œå› æ­¤æ— éœ€æŒ‡å®š RHSã€‚

ä¸ä¸Šé¢çš„ä¾‹å­ç›¸åï¼Œä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªä¸åŒç±»å‹çš„ç›¸åŠ ï¼š

```rust

#![allow(unused)]
fn main() {
use std::ops::Add;

struct Millimeters(u32);
struct Meters(u32);

impl Add<Meters> for Millimeters {
    type Output = Millimeters;

    fn add(self, other: Meters) -> Millimeters {
        Millimeters(self.0 + (other.0 * 1000))
    }
}
}

```

è¿™é‡Œï¼Œæ˜¯è¿›è¡Œ Millimeters + Meters ä¸¤ç§æ•°æ®ç±»å‹çš„ + æ“ä½œï¼Œå› æ­¤æ­¤æ—¶ä¸èƒ½å†ä½¿ç”¨é»˜è®¤çš„ RHSï¼Œå¦åˆ™å°±ä¼šå˜æˆ Millimeters + Millimeters çš„å½¢å¼ã€‚ä½¿ç”¨ `Add<Meters>` å¯ä»¥å°† RHS æŒ‡å®šä¸º Metersï¼Œé‚£ä¹ˆ fn add(self, rhs: RHS) è‡ªç„¶è€Œè¨€çš„å˜æˆäº† Millimeters å’Œ Meters çš„ç›¸åŠ ã€‚

é»˜è®¤ç±»å‹å‚æ•°ä¸»è¦ç”¨äºä¸¤ä¸ªæ–¹é¢ï¼š
1. å‡å°‘å®ç°çš„æ ·æ¿ä»£ç 
2. æ‰©å±•ç±»å‹ä½†æ˜¯æ— éœ€å¤§å¹…ä¿®æ”¹ç°æœ‰çš„ä»£ç 
ä¹‹å‰çš„ä¾‹å­å°±æ˜¯ç¬¬ä¸€ç‚¹ï¼Œè™½ç„¶æ•ˆæœä¹Ÿå°±é‚£æ ·ã€‚åœ¨ + å·¦å³ä¸¤è¾¹éƒ½æ˜¯åŒæ ·ç±»å‹æ—¶ï¼Œåªéœ€è¦ impl Add å³å¯ï¼Œå¦åˆ™ä½ éœ€è¦ impl Add<SOME_TYPE>ï¼Œå—¯ï¼Œä¼šå¤šå†™å‡ ä¸ªå­—:)

å¯¹äºç¬¬äºŒç‚¹ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªå¤æ‚ç±»å‹çš„åŸºç¡€ä¸Šï¼Œæ–°å¼•å…¥ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹å¾ˆå¤šåœ°æ–¹ï¼Œä½†æ˜¯å¦‚æœæ–°å¼•å…¥çš„æ³›å‹å‚æ•°æœ‰äº†é»˜è®¤ç±»å‹ï¼Œæƒ…å†µå°±ä¼šå¥½å¾ˆå¤šï¼Œæ·»åŠ æ³›å‹å‚æ•°åï¼Œä½¿ç”¨è¿™ä¸ªç±»å‹çš„ä»£ç éœ€è¦é€ä¸ªåœ¨ç±»å‹æç¤ºéƒ¨åˆ†æ·»åŠ æ³›å‹å‚æ•°ï¼Œå°±å¾ˆéº»çƒ¦ï¼›ä½†æ˜¯æœ‰äº†é»˜è®¤å‚æ•°ï¼ˆä¸”é»˜è®¤å‚æ•°å–ä¹‹å‰çš„å®ç°é‡Œå‡è®¾çš„å€¼çš„æƒ…å†µä¸‹ï¼‰ä¹‹åï¼ŒåŸæœ‰çš„ä½¿ç”¨è¿™ä¸ªç±»å‹çš„ä»£ç å°±ä¸éœ€è¦åšæ”¹åŠ¨äº†ã€‚

å½’æ ¹åˆ°åº•ï¼Œé»˜è®¤æ³›å‹å‚æ•°ï¼Œæ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå’±ä»¬ç¡®å®ç”¨ä¸åˆ°ï¼Œå½“éœ€è¦ç”¨åˆ°æ—¶ï¼Œå¤§å®¶å†å›å¤´æ¥æŸ¥é˜…æœ¬ç« å³å¯ï¼Œæ‰‹ä¸Šæœ‰å‰‘ï¼Œå¿ƒä¸­ä¸æ…Œã€‚

### è°ƒç”¨åŒåçš„æ–¹æ³•
æ‹¿ä¸‹é¢çš„ä¾‹å­è¿›è¡Œä¸¾ä¾‹è¯´æ˜åŒåæ–¹æ³•ï¼š

```rust

trait Pilot {
    fn fly(&self);
}

trait Wizard {
    fn fly(&self);
}

struct Human;

impl Pilot for Human {
    fn fly(&self) {
        println!("This is your captain speaking.");
    }
}

impl Wizard for Human {
    fn fly(&self) {
        println!("Up!");
    }
}

impl Human {
    fn fly(&self) {
        println!("*waving arms furiously*");
    }
}

```

**ä¼˜å…ˆè°ƒç”¨ç±»å‹ä¸Šçš„æ–¹æ³•**ã€‚é»˜è®¤è°ƒç”¨è¯¥ç±»å‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼š

```rust
fn main() {
    let person = Human;
    person.fly();
}

// *waving arms furiously*
```

**è°ƒç”¨ç‰¹å¾ä¸Šçš„æ–¹æ³•**ã€‚å¦‚æœè¦ä½¿ç”¨å…¶ä»–ç‰¹å¾å¯ä»¥æ˜¾ç¤ºè°ƒç”¨ï¼š

```rust
fn main() {
    let person = Human;
    Pilot::fly(&person); // è°ƒç”¨Pilotç‰¹å¾ä¸Šçš„æ–¹æ³•
    Wizard::fly(&person); // è°ƒç”¨Wizardç‰¹å¾ä¸Šçš„æ–¹æ³•
    person.fly(); // è°ƒç”¨Humanç±»å‹è‡ªèº«çš„æ–¹æ³•
}

//This is your captain speaking.
//Up!
//*waving arms furiously*
```

**å®Œå…¨é™å®šè¯­æ³•**ã€‚ä¸‹é¢æœ‰è¿™æ ·çš„ç¤ºä¾‹ä»£ç ï¼š

```rust
trait Animal {
    fn baby_name() -> String;
}

struct Dog;

impl Dog {
    fn baby_name() -> String {
        String::from("Spot")
    }
}

impl Animal for Dog {
    fn baby_name() -> String {
        String::from("puppy")
    }
}

fn main() {
    println!("A baby dog is called a {}", Dog::baby_name());
}
```

å¦‚æœæ˜¾å¼è°ƒç”¨Dogæ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è°ƒç”¨Animalå°±æœ‰é—®é¢˜ï¼š

```
error[E0283]: type annotations needed
  --> src/main.rs:21:43
   |
21 |     println!("A baby dog is called a {}", Animal::baby_name());
   |                                           ^^^^^^^^^^^^^^^^^ cannot infer type
   |
   = note: cannot satisfy `_: Animal`

For more information about this error, try `rustc --explain E0283`.
error: could not compile `Demo` due to previous erro
```

ä½†æ˜¯ä½†å‡¡æ˜¯ä¸ªæ­£å¸¸é€»è¾‘éƒ½ä¸ä¼šè¿™æ ·å†™ä»£ç ï¼š
- æœ‰ä¸€ä¸ªç‹—çš„ç»“æ„ä½“ï¼Œä¸ºç‹—å®ç°ä¸€ä¸ªbaby_nameçš„æ–¹æ³•ï¼Œä¼šæ‰“å°å‡ºä¸€ä¸ªSpotã€‚
- æœ‰ä¸€ä¸ªAnimalç‰¹å¾ï¼ˆåœ¨è¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼‰ï¼Œç‹—å¦‚æœå®ç°äº†è¿™ä¸ªæŠ½è±¡ç±»çš„æ–¹æ³•ï¼ˆimpl Animal for Dogï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªbaby_nameçš„æ–¹æ³•æ‰“å°puppy

æ•´ç†å®Œé€»è¾‘åå†çœ‹è¿™ä¸ª`println!("A baby dog is called a {}", Animal::baby_name());`ä»£ç ï¼Œè¿™ä¸ªAnimalç‰¹å¾éƒ½æ²¡æœ‰è¢«ä»»ä½•ç»“æ„ä½“æ‰€å®ç°å®Œå…¨å°±ä¸çŸ¥é“æ˜¯è¦æ‰“å°è°ï¼Ÿä¸‡ä¸€æˆ‘åˆæ·»åŠ ä¸€ä¸ª`impl Animal for Cat`ã€‚

æ˜ç™½ä¸Šè¿°é—®é¢˜ï¼ŒRustå°±é€šè¿‡å®Œå…¨é™å®šè¯­æ³•æ¥è§£å†³ï¼Œæ˜ç¡®è¿™ä¸ªAnimalæ˜¯è°ï¼šas
```rust
fn main() {
    println!("A baby dog is called a {}", Dog::baby_name());
    println!("A baby dog is called a {}", <Dog as Animal>::baby_name());
}
// A baby dog is called a Spot
// A baby dog is called a puppy
```

å†Rustä¸­å®Œå…¨é™å®šè¯­æ³•çš„å®šä¹‰ä¸ºï¼š
```rust
<Type as Trait>::function(receiver_if_method, next_arg, ...);
```
ä¸Šé¢å®šä¹‰ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•æ¥æ”¶å™¨ receiver ï¼ˆä¸‰ç§ selfï¼‰ï¼Œåªæœ‰æ–¹æ³•æ‰æ‹¥æœ‰ï¼Œä¾‹å¦‚å…³è”å‡½æ•°å°±æ²¡æœ‰ receiverã€‚

### ç‰¹å¾å®šä¹‰ä¸­çš„ç‰¹å¾çº¦æŸ
é¦–å…ˆæ¥æ„Ÿå—ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œç›´æ¥CVä¸‹é¢çš„ä»£ç ï¼š

```rust
use std::fmt;
use std::fmt::Display;

trait OutlinePrint: Display {
    fn outline_print(&self) {
        let output = self.to_string();
        let len = output.len();
        println!("{}", "*".repeat(len + 4));
        println!("*{}*", " ".repeat(len + 2));
        println!("* {} *", output);
        println!("*{}*", " ".repeat(len + 2));
        println!("{}", "*".repeat(len + 4));
    }
}

impl OutlinePrint for Point {}

struct Point {
    x: i32,
    y: i32,
}

// impl fmt::Display for Point {
//     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
//         write!(f, "({}, {})", self.x, self.y)
//     }
// }

fn main() {
    let p = Point{x: 11, y: 12};
    println!("{}", p);
    Point::outline_print(&p);
}
```

```
error[E0277]: `Point` doesn't implement `std::fmt::Display`
  --> src/main.rs:16:6
   |
16 | impl OutlinePrint for Point {}
   |      ^^^^^^^^^^^^ `Point` ä¸èƒ½ç”¨é»˜è®¤æ ¼å¼åŒ–çš„ç‚¹è¿›è¡Œæ ¼å¼åŒ–
   |
   = help: å¯¹äº "Point "æ¥è¯´ï¼Œ"std::fmt::Display "è¿™ä¸ªç‰¹æ€§æ²¡æœ‰å®ç°ã€‚
   = note: åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨`{:?}`ï¼ˆæˆ–{:#?}æ¥ä»£æ›¿pretty-printï¼‰ã€‚
note: required by a bound in `OutlinePrint`
  --> src/main.rs:4:21
   |
4  | trait OutlinePrint: Display {
   |                     ^^^^^^^ åœ¨ "OutlinePrint "ä¸­ï¼Œæ­¤ç»‘å®šæ‰€è¦æ±‚çš„ã€‚

For more information about this error, try `rustc --explain E0277`.
warning: `Demo` (bin "Demo") generated 1 warning
error: could not compile `Demo` due to previous error; 1 warning emitted
```

ç„¶åæŠŠæ³¨é‡Šå–æ¶ˆï¼Œå°±å¯ä»¥è¿è¡Œäº†ï¼š
```
(11, 12)
************
*          *
* (11, 12) *
*          *
************
```

ä¸Šé¢ä»£ç ä¸º Point ä¸€å¼€å§‹æ˜¯æ²¡æœ‰å®ç°displayç‰¹å¾çš„ï¼Œä½†æ˜¯OutlinePrintå®ç°äº†displayï¼Œç°åœ¨pointè¦å®ç°OutlinePrintçš„ç‰¹å¾ï¼ˆå¯ä»¥å®ç°outline_printï¼‰ï¼Œé‚£ä¹ˆå°±è¦å®ç°displayæ–¹æ³•ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥pointæ‰ä¼šæœ‰ï¼ˆå¯¹äº "Point "æ¥è¯´ï¼Œ"std::fmt::Display "è¿™ä¸ªç‰¹æ€§æ²¡æœ‰å®ç°ï¼‰æŠ¥é”™ã€‚ç®€è€Œè¨€ä¹‹ï¼šç‰¹å¾å®šä¹‰ä¸­çš„ç‰¹å¾çº¦æŸï¼Œç”¨äºè®©æŸä¸ªç‰¹å¾Aä½¿ç”¨å¦ä¸€ä¸ªç‰¹å¾Bçš„åŠŸèƒ½ã€‚å¦‚æœæƒ³å®ç°ç‰¹å¾Aï¼Œåˆ™å¿…é¡»å…ˆå®ç°ç‰¹å¾Bã€‚ä¾‹å¦‚ï¼Œç‰¹å¾OutlinePrintéœ€è¦å®ç°Displayç‰¹å¾åï¼Œæ‰èƒ½åœ¨å…¶æ–¹æ³•ä¸­è°ƒç”¨to_stringæ–¹æ³•ã€‚æ²¡æœ‰ç‰¹å¾çº¦æŸæ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› æ­¤éœ€è¦å…ˆæ»¡è¶³ç¼–è¯‘å™¨çš„è¦æ±‚ï¼Œä¸ºç±»å‹å®ç°æ‰€éœ€çš„ç‰¹å¾ã€‚

### åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨ç‰¹å¾ (newtype)
> è¯¥å°è£…ç±»å‹æ˜¯æœ¬åœ°çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ç±»å‹å®ç°å¤–éƒ¨çš„ç‰¹å¾ã€‚

newtype æ¨¡å¼ï¼Œç®€è€Œè¨€ä¹‹ï¼šå°±æ˜¯ä¸ºä¸€ä¸ªå…ƒç»„ç»“æ„ä½“åˆ›å»ºæ–°ç±»å‹ã€‚ä¸‹é¢è¿™æ®µä»£ç ä½¿ç”¨äº†è£…é¥°å™¨æ¨¡å¼ï¼ŒåŒ…è£…äº†ä¸€ä¸ªä¸­æ‹¬å·ï¼š

```rust
use std::fmt;

struct Wrapper(Vec<String>);

impl fmt::Display for Wrapper {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        write!(f, "[{}]", self.0.join(", "))
    }
}

fn main() {
    let w = Wrapper(vec![String::from("hello"), String::from("world")]);
    println!("w = {}", w);
}

// w = [hello, world]
```
å…¶ä¸­ï¼Œ`struct Wrapper(Vec<String>) `å°±æ˜¯ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ–°ç±»å‹ Wrapper
å¯ä»¥çœ‹åˆ°åœ¨å®ç°fmtçš„æ—¶å€™å†…éƒ¨ä½¿ç”¨äº†`self.0.join(", ")`ï¼Œè¿™å°±æ˜¯è®¿é—®æ•°ç»„é‡Œçš„å†…å®¹ï¼Œä½†æ˜¯è¿™æ ·å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥Rustå°±æä¾›äº†ä¸€ä¸ªç‰¹å¾å« Derefï¼Œå®ç°è¯¥ç‰¹å¾åï¼Œå¯ä»¥è‡ªåŠ¨åšä¸€å±‚ç±»ä¼¼ç±»å‹è½¬æ¢çš„æ“ä½œï¼Œå¯ä»¥å°† Wrapper å˜æˆ` Vec<String> `æ¥ä½¿ç”¨ã€‚è¿™æ ·å°±ä¼šåƒç›´æ¥ä½¿ç”¨æ•°ç»„é‚£æ ·å»ä½¿ç”¨ Wrapperï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸€ä¸ªæ“ä½œéƒ½æ·»åŠ ä¸Š self.0ã€‚


## 1.13 ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ é›†åˆ

### åŠ¨æ€æ•°ç»„ Vector

#### åˆ›å»ºåŠ¨æ€æ•°ç»„
ä½¿ç”¨ Vec::new åˆ›å»ºåŠ¨æ€æ•°ç»„æ˜¯æœ€ rusty çš„æ–¹å¼ï¼Œå®ƒè°ƒç”¨äº† Vec ä¸­çš„ new å…³è”å‡½æ•°ï¼š

```rust
let v: Vec<i32> = Vec::new();
```


```rust
let mut v = Vec::new();
v.push(1);
```


#### vec![]
è¿˜å¯ä»¥ä½¿ç”¨å® vec! æ¥åˆ›å»ºæ•°ç»„

```rust
let v = vec![1, 2, 3];
```

#### æ·»åŠ å…ƒç´ 
```rust
let mut v = Vec::new();
v.push(1);
```

#### è¯»å–å…ƒç´ 
è¯»å–æŒ‡å®šä½ç½®çš„å…ƒç´ æœ‰ä¸¤ç§æ–¹å¼å¯é€‰ï¼š
- é€šè¿‡ä¸‹æ ‡ç´¢å¼•è®¿é—®ã€‚
- ä½¿ç”¨ get æ–¹æ³•ã€‚
```rust
let v = vec![1, 2, 3, 4, 5];

let third: &i32 = &v[2];
println!("ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ {}", third);

match v.get(2) {
    Some(third) => println!("ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ {third}"),
    None => println!("å»ä½ çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œæ ¹æœ¬æ²¡æœ‰ï¼"),
}
```

#### åˆ é™¤å…ƒç´ 

åˆ é™¤æŸä¸ªä½ç½®
```rust
let mut vec = vec![1, 2, 3, 4, 5];
let index = vec.iter().position(|&x| x == 3).unwrap(); // æ‰¾åˆ°å…ƒç´ 3çš„ç´¢å¼•ä½ç½®
vec.remove(index); // åˆ é™¤å…ƒç´ 3
```

åˆ é™¤å¤´ç»“ç‚¹ & å°¾èŠ‚ç‚¹
```rust
let mut vec = vec![1, 2, 3, 4, 5];
vec.remove(0); // åˆ é™¤å¤´ç»“ç‚¹
vec.pop(); // åˆ é™¤å°¾èŠ‚ç‚¹
```

#### è¿­ä»£éå†

```rust
let v = vec![1, 2, 3];
for i in &v {
    println!("{i}");
}
```

#### å­˜å‚¨ä¸åŒç±»å‹çš„å…ƒç´ 

```rust
#[derive(Debug)]
enum IpAddr {
    V4(String),
    V6(String)
}
fn main() {
    let v = vec![
        IpAddr::V4("127.0.0.1".to_string()),
        IpAddr::V6("::1".to_string())
    ];

    for ip in v {
        show_addr(ip)
    }
}

fn show_addr(ip: IpAddr) {
    println!("{:?}",ip);
}

```


####  Vector ä¸å…¶å…ƒç´ å…±å­˜äº¡
è·Ÿç»“æ„ä½“ä¸€æ ·ï¼ŒVector ç±»å‹åœ¨è¶…å‡ºä½œç”¨åŸŸèŒƒå›´åï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼š
```rust
{
    let v = vec![1, 2, 3];

    // ...
} // <- vè¶…å‡ºä½œç”¨åŸŸå¹¶åœ¨æ­¤å¤„è¢«åˆ é™¤
```

å½“ Vector è¢«åˆ é™¤åï¼Œå®ƒå†…éƒ¨å­˜å‚¨çš„æ‰€æœ‰å†…å®¹ä¹Ÿä¼šéšä¹‹è¢«åˆ é™¤ã€‚ç›®å‰æ¥çœ‹ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆç®€å•ç›´ç™½ï¼Œä½†æ˜¯å½“ Vector ä¸­çš„å…ƒç´ è¢«å¼•ç”¨åï¼Œäº‹æƒ…å¯èƒ½ä¼šæ²¡é‚£ä¹ˆç®€å•ã€‚

#### åŒæ—¶å€Ÿç”¨å¤šä¸ªæ•°ç»„å…ƒç´ 
æ—¢ç„¶æ¶‰åŠåˆ°å€Ÿç”¨æ•°ç»„å…ƒç´ ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä¼šé‡åˆ°åŒæ—¶å€Ÿç”¨å¤šä¸ªæ•°ç»„å…ƒç´ çš„æƒ…å†µï¼Œè¿˜è®°å¾—åœ¨æ‰€æœ‰æƒå’Œå€Ÿç”¨ç« èŠ‚å’±ä»¬è®²è¿‡çš„å€Ÿç”¨è§„åˆ™å˜›ï¼Ÿå¦‚æœè®°å¾—ï¼Œå°±æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç  :)
> å¦‚æœæœ‰ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ï¼Œåˆ™å¯ä»¥å‡å®šå…¶å¼•ç”¨çš„æ•°æ®æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„ï¼Œä½†æ˜¯åŒæ—¶å¦å¤–ä¸€ä¸ªå¯å˜å¼•ç”¨å´å¯ä»¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼ŒRustç¼–è¯‘å™¨ä¼šå°†è¿™ç§æƒ…å†µè§†ä¸ºç¼–è¯‘é”™è¯¯ï¼Œè¦æ±‚å¼€å‘è€…æ›´æ”¹ä»£ç ï¼Œä¿è¯åœ¨åŒä¸€æ—¶é—´å†…åªå­˜åœ¨ä¸€ç§ç±»å‹çš„å€Ÿç”¨ï¼ˆå¯å˜æˆ–ä¸å¯å˜ï¼‰ï¼Œä»¥ä¿è¯ä»£ç çš„å†…å­˜å®‰å…¨ã€‚

```rust
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    let first = &v[0];
    v.push(6);
    println!("The first element is: {first}");
}
```
å…ˆä¸è¿è¡Œï¼Œæ¥æ¨æ–­ä¸‹ç»“æœï¼Œé¦–å…ˆ first = &v[0] è¿›è¡Œäº†ä¸å¯å˜å€Ÿç”¨ï¼Œv.push è¿›è¡Œäº†å¯å˜å€Ÿç”¨ï¼Œå¦‚æœ first åœ¨ v.push ä¹‹åä¸å†ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯¥æ®µä»£ç å¯ä»¥æˆåŠŸç¼–è¯‘ï¼ˆåŸå› è§å¼•ç”¨çš„ä½œç”¨åŸŸï¼‰ã€‚

å¯æ˜¯ä¸Šé¢çš„ä»£ç ä¸­ï¼Œfirst è¿™ä¸ªä¸å¯å˜å€Ÿç”¨åœ¨å¯å˜å€Ÿç”¨ v.push åè¢«ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå¦¥å¦¥çš„ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼š

```
$ cargo run
Compiling collections v0.1.0 (file:///projects/collections)
error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable æ— æ³•å¯¹vè¿›è¡Œå¯å˜å€Ÿç”¨ï¼Œå› æ­¤ä¹‹å‰å·²ç»è¿›è¡Œäº†ä¸å¯å˜å€Ÿç”¨
--> src/main.rs:6:5
|
4 |     let first = &v[0];
|                  - immutable borrow occurs here // ä¸å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨æ­¤å¤„
5 |
6 |     v.push(6);
|     ^^^^^^^^^ mutable borrow occurs here // å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨æ­¤å¤„
7 |
8 |     println!("The first element is: {}", first);
|                                          ----- immutable borrow later used here // ä¸å¯å˜å€Ÿç”¨åœ¨è¿™é‡Œè¢«ä½¿ç”¨

For more information about this error, try `rustc --explain E0502`.
error: could not compile `collections` due to previous error

```
å…¶å®ï¼ŒæŒ‰ç†æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå¼•ç”¨ä¸åº”è¯¥äº’ç›¸å½±å“çš„ï¼šä¸€ä¸ªæ˜¯æŸ¥è¯¢å…ƒç´ ï¼Œä¸€ä¸ªæ˜¯åœ¨æ•°ç»„å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œå®Œå…¨ä¸ç›¸å¹²çš„æ“ä½œï¼Œä¸ºä½•ç¼–è¯‘å™¨è¦è¿™ä¹ˆä¸¥æ ¼å‘¢ï¼Ÿ

**åŸå› åœ¨äº**ï¼šæ•°ç»„çš„å¤§å°æ˜¯å¯å˜çš„ï¼Œå½“æ—§æ•°ç»„çš„å¤§å°ä¸å¤Ÿç”¨æ—¶ï¼ŒRust ä¼šé‡æ–°åˆ†é…ä¸€å—æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œç„¶åæŠŠæ—§æ•°ç»„æ‹·è´è¿‡æ¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¹‹å‰çš„å¼•ç”¨æ˜¾ç„¶ä¼šæŒ‡å‘ä¸€å—æ— æ•ˆçš„å†…å­˜ï¼Œè¿™éå¸¸ rusty â€”â€” å¯¹ç”¨æˆ·è¿›è¡Œä¸¥æ ¼çš„æ•™è‚²ã€‚

å…¶å®æƒ³æƒ³ï¼Œåœ¨é•¿å¤§ä¹‹åï¼Œæˆ‘ä»¬æ„Ÿæ¿€äººç”Ÿè·¯ä¸Šé‡åˆ°è¿‡çš„ä¸¥å¸ˆç›Šå‹ï¼Œæ­£æ˜¯å› ä¸ºä»–ä»¬ï¼Œæˆ‘ä»¬æ‰åœ¨æ­£ç¡®çš„é“è·¯ä¸Šä¸æ–­å‰è¡Œï¼Œè™½ç„¶åœ¨é‚£ä¸ªæ—¶å€™ï¼Œå¹¶ä¸èƒ½ç†è§£ä»–ä»¬ï¼Œè€Œ Rust å°±å¦‚é‚£ä¸ªè‰¯å¸ˆç›Šå‹ï¼Œå®ƒä¸æ–­çš„åœ¨çº æ­£æˆ‘ä»¬ä¸å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œç›´åˆ°æŸä¸€å¤©ï¼Œä½ å‘ç°è‡ªå·±èƒ½å†™å‡ºä¸€æ¬¡æ€§é€šè¿‡çš„æ¼‚äº®ä»£ç æ—¶ï¼Œå°±èƒ½æ˜ç™½å®ƒçš„è‰¯è‹¦ç”¨å¿ƒã€‚

æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼š
```
// æ–¹æ³•ä¸€ï¼šå°† &v[0] æ”¾åœ¨ v.push(6) è¯­å¥ä¹‹å
let mut v = vec![1, 2, 3, 4, 5];
v.push(6);
let first = &v[0];
println!("The first element is: {}", first);

// æ–¹æ³•äºŒï¼šä½¿ç”¨ v[0] è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç´ 
let mut v = vec![1, 2, 3, 4, 5];
v.push(6);
let first = v[0];
println!("The first element is: {}", first);
```

### KV å­˜å‚¨ HashMap
#### ç”¨ new æ–¹æ³•åˆ›å»º & æŸ¥è¯¢

``` rust
use std::collections::HashMap;

fn main() {
    let mut map = HashMap::new();
    // å°†å®çŸ³ç±»å‹å’Œå¯¹åº”çš„æ•°é‡å†™å…¥è¡¨ä¸­
    map.insert("çº¢å®çŸ³", 1);
    map.insert("è“å®çŸ³", 2);
    map.insert("æ²³è¾¹æ¡çš„è¯¯ä»¥ä¸ºæ˜¯å®çŸ³çš„ç ´çŸ³å¤´", 18);

    // ä½¿ç”¨ {} æ‰“å°ä¼šæŠ¥é”™
    // println!("{}", map.get("çº¢å®çŸ³"));
    // ä½¿ç”¨ {:?} æ‰“å°å¯ä»¥æ­£å¸¸è¾“å‡º
    println!("{:?}", map.get("çº¢å®çŸ³"));

    for (key, value) in &map {
        println!("{}: {}", key, value);
    }
}
```

åœ¨è¿™é‡Œä¼šæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼šå¯¹äº HashMapï¼Œget() æ–¹æ³•è¿”å›çš„æ˜¯` Option<&V>` ç±»å‹ï¼Œå…¶ä¸­ V æ˜¯ HashMap å­˜å‚¨çš„å€¼ç±»å‹ã€‚ç”±äº &V ç±»å‹é»˜è®¤æ²¡æœ‰å®ç° `std::fmt::Display trait`ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨ {} è¿›è¡Œæ‰“å°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

ä½†æ˜¯ï¼Œ`&V `ç±»å‹é»˜è®¤å®ç°äº†` std::fmt::Debug traitï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ {:?} è¿›è¡Œæ‰“å°`ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨ Debug trait ä¸­çš„ fmt() æ–¹æ³•æ¥è¾“å‡ºå¯è¯»æ€§è¾ƒé«˜çš„è°ƒè¯•ä¿¡æ¯ã€‚

å°ç»“ï¼š
- get æ–¹æ³•è¿”å›ä¸€ä¸ª Option<&i32> ç±»å‹ï¼šå½“æŸ¥è¯¢ä¸åˆ°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª Noneï¼ŒæŸ¥è¯¢åˆ°æ—¶è¿”å› Some(&i32)
- &i32 æ˜¯å¯¹ HashMap ä¸­å€¼çš„å€Ÿç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨å€Ÿç”¨ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»

#### ä½¿ç”¨è¿­ä»£å™¨å’Œ collect æ–¹æ³•åˆ›å»º

```rust
fn main() {
    use std::collections::HashMap;

    let teams_list = vec![
        ("ä¸­å›½é˜Ÿ".to_string(), 100),
        ("ç¾å›½é˜Ÿ".to_string(), 10),
        ("æ—¥æœ¬é˜Ÿ".to_string(), 50),
    ];

    let teams_map: HashMap<_,_> = teams_list.into_iter().collect();
    
    println!("{:?}",teams_map)
}
// {"ä¸­å›½é˜Ÿ": 100, "ç¾å›½é˜Ÿ": 10, "æ—¥æœ¬é˜Ÿ": 50}
```


#### æ‰€æœ‰æƒè½¬ç§»

HashMap çš„æ‰€æœ‰æƒè§„åˆ™ä¸å…¶å®ƒ Rust ç±»å‹æ²¡æœ‰åŒºåˆ«ï¼š
- è‹¥ç±»å‹å®ç° Copy ç‰¹å¾ï¼Œè¯¥ç±»å‹ä¼šè¢«å¤åˆ¶è¿› HashMapï¼Œå› æ­¤æ— æ‰€è°“æ‰€æœ‰æƒ
- è‹¥æ²¡å®ç° Copy ç‰¹å¾ï¼Œæ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™ HashMap ä¸­

```rust
fn main() {
    use std::collections::HashMap;

    let name = String::from("Sunface");
    let age = 18;

    let mut handsome_boys = HashMap::new();
    handsome_boys.insert(&name, age);

    std::mem::drop(name);
    println!("å› ä¸ºè¿‡äºæ— è€»ï¼Œ{:?}å·²ç»è¢«é™¤å", handsome_boys);
    println!("è¿˜æœ‰ï¼Œä»–çš„çœŸå®å¹´é¾„è¿œè¿œä¸æ­¢{}å²", age);
}
```

ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬å€Ÿç”¨ name è·å–äº†å®ƒçš„å¼•ç”¨ï¼Œç„¶åæ’å…¥åˆ° handsome_boys ä¸­ï¼Œè‡³æ­¤ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ã€‚ä½†æ˜¯ç´§æ¥ç€ï¼Œå°±é€šè¿‡ drop å‡½æ•°æ‰‹åŠ¨å°† name å­—ç¬¦ä¸²ä»å†…å­˜ä¸­ç§»é™¤ï¼Œå†ç„¶åå°±æŠ¥é”™äº†ï¼š

```
error[E0505]: cannot move out of `name` because it is borrowed
  --> src/main.rs:10:20
   |
8  |     handsome_boys.insert(&name, age);
   |                          ----- borrow of `name` occurs here
9  | 
10 |     std::mem::drop(name);
   |                    ^^^^ move out of `name` occurs here
11 |     println!("å› ä¸ºè¿‡äºæ— è€»ï¼Œ{:?}å·²ç»è¢«é™¤å", handsome_boys);
   |                                              ------------- borrow later used here

For more information about this error, try `rustc --explain E0505`.
error: could not compile `Demo` due to previous error
```

#### æ›´æ–° HashMap ä¸­çš„å€¼

```rust
fn main() {
    use std::collections::HashMap;

    let mut scores = HashMap::new();

    scores.insert("Blue", 10);

    // è¦†ç›–å·²æœ‰çš„å€¼
    let old = scores.insert("Blue", 20);
    assert_eq!(old, Some(10));

    // æŸ¥è¯¢æ–°æ’å…¥çš„å€¼
    let new = scores.get("Blue");
    assert_eq!(new, Some(&20));

    // æŸ¥è¯¢Yellowå¯¹åº”çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ’å…¥æ–°å€¼
    let v = scores.entry("Yellow").or_insert(5);
    assert_eq!(*v, 5); // ä¸å­˜åœ¨ï¼Œæ’å…¥5

    // æŸ¥è¯¢Yellowå¯¹åº”çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ’å…¥æ–°å€¼
    let v = scores.entry("Yellow").or_insert(50);
    assert_eq!(*v, 5); // å·²ç»å­˜åœ¨ï¼Œå› æ­¤50æ²¡æœ‰æ’å…¥
}
```

æ›´æ–°å·²æœ‰å€¼

```rust
use std::collections::HashMap;

let text = "hello world wonderful world";

let mut map = HashMap::new();
// æ ¹æ®ç©ºæ ¼æ¥åˆ‡åˆ†å­—ç¬¦ä¸²(è‹±æ–‡å•è¯éƒ½æ˜¯é€šè¿‡ç©ºæ ¼åˆ‡åˆ†)
for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}

println!("{:?}", map);
```
ä¸Šé¢ä»£ç ä¸­ï¼Œæ–°å»ºä¸€ä¸ª map ç”¨äºä¿å­˜è¯è¯­å‡ºç°çš„æ¬¡æ•°ï¼Œæ’å…¥ä¸€ä¸ªè¯è¯­æ—¶ä¼šè¿›è¡Œåˆ¤æ–­ï¼šè‹¥ä¹‹å‰æ²¡æœ‰æ’å…¥è¿‡ï¼Œåˆ™ä½¿ç”¨è¯¥è¯è¯­ä½œ Keyï¼Œæ’å…¥æ¬¡æ•° 0 ä½œä¸º Valueï¼Œè‹¥ä¹‹å‰æ’å…¥è¿‡åˆ™å–å‡ºä¹‹å‰ç»Ÿè®¡çš„è¯¥è¯è¯­å‡ºç°çš„æ¬¡æ•°ï¼Œå¯¹å…¶åŠ ä¸€ã€‚

æœ‰ä¸¤ç‚¹å€¼å¾—æ³¨æ„ï¼š
- or_insert è¿”å›äº† &mut v å¼•ç”¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¯¥å¯å˜å¼•ç”¨ç›´æ¥ä¿®æ”¹ map ä¸­å¯¹åº”çš„å€¼
- ä½¿ç”¨ count å¼•ç”¨æ—¶ï¼Œéœ€è¦å…ˆè¿›è¡Œè§£å¼•ç”¨ *countï¼Œå¦åˆ™ä¼šå‡ºç°ç±»å‹ä¸åŒ¹é…


## 1.14 ğŸ’± ç”Ÿå‘½å‘¨æœŸ
ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼Œåœ¨åœ£ç»ä¸­å·²ç»è®²çš„å¾ˆå¥½äº†ï¼Œæˆ‘ä¹Ÿæ²¡å¿…è¦æ·»æ²¹åŠ é†‹ï¼Œç›´æ¥[æ¬è¿](https://course.rs/basic/lifetime.html#æ‚¬å‚æŒ‡é’ˆå’Œç”Ÿå‘½å‘¨æœŸ)è¿‡æ¥æ–¹ä¾¿ä»¥åæŸ¥çœ‹ã€‚

### æ‚¬å‚æŒ‡é’ˆå’Œç”Ÿå‘½å‘¨æœŸ
ç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦ä½œç”¨æ˜¯é¿å…æ‚¬å‚å¼•ç”¨ï¼Œå®ƒä¼šå¯¼è‡´ç¨‹åºå¼•ç”¨äº†æœ¬ä¸è¯¥å¼•ç”¨çš„æ•°æ®ï¼š

```rust
{
    let r;

    {
        let x = 5;
        r = &x;
    }

    println!("r: {}", r);
}
```

è¿™æ®µä»£ç æœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„:
- `let r; `çš„å£°æ˜æ–¹å¼è²Œä¼¼å­˜åœ¨ä½¿ç”¨ `null` çš„é£é™©ï¼Œå®é™…ä¸Šï¼Œå½“æˆ‘ä»¬ä¸åˆå§‹åŒ–å®ƒå°±ä½¿ç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç»™äºˆæŠ¥é”™
- r å¼•ç”¨äº†å†…éƒ¨èŠ±æ‹¬å·ä¸­çš„ x å˜é‡ï¼Œä½†æ˜¯ x ä¼šåœ¨å†…éƒ¨èŠ±æ‹¬å· } å¤„è¢«é‡Šæ”¾ï¼Œå› æ­¤å›åˆ°å¤–éƒ¨èŠ±æ‹¬å·åï¼Œr ä¼šå¼•ç”¨ä¸€ä¸ªæ— æ•ˆçš„ x
æ­¤å¤„ `r å°±æ˜¯ä¸€ä¸ªæ‚¬å‚æŒ‡é’ˆ`ï¼Œå®ƒå¼•ç”¨äº†æå‰è¢«é‡Šæ”¾çš„å˜é‡ xï¼Œå¯ä»¥é¢„æ–™åˆ°ï¼Œè¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼š

```
error[E0597]: `x` does not live long enough // `x` æ´»å¾—ä¸å¤Ÿä¹…
  --> src/main.rs:7:17
   |
7  |             r = &x;
   |                 ^^ borrowed value does not live long enough // è¢«å€Ÿç”¨çš„ `x` æ´»å¾—ä¸å¤Ÿä¹…
8  |         }
   |         - `x` dropped here while still borrowed // `x` åœ¨è¿™é‡Œè¢«ä¸¢å¼ƒï¼Œä½†æ˜¯å®ƒä¾ç„¶è¿˜åœ¨è¢«å€Ÿç”¨
9  |
10 |         println!("r: {}", r);
   |                           - borrow later used here // å¯¹ `x` çš„å€Ÿç”¨åœ¨æ­¤å¤„è¢«ä½¿ç”¨

```
åœ¨è¿™é‡Œ r æ‹¥æœ‰æ›´å¤§çš„ä½œç”¨åŸŸï¼Œæˆ–è€…è¯´æ´»å¾—æ›´ä¹…ã€‚å¦‚æœ Rust ä¸é˜»æ­¢è¯¥æ‚¬å‚å¼•ç”¨çš„å‘ç”Ÿï¼Œé‚£ä¹ˆå½“ x è¢«é‡Šæ”¾åï¼Œr æ‰€å¼•ç”¨çš„å€¼å°±ä¸å†æ˜¯åˆæ³•çš„ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬ç¨‹åºå‘ç”Ÿå¼‚å¸¸è¡Œä¸ºï¼Œä¸”è¯¥å¼‚å¸¸è¡Œä¸ºæœ‰æ—¶å€™ä¼šå¾ˆéš¾è¢«å‘ç°ã€‚

### å€Ÿç”¨æ£€æŸ¥
ä¸ºäº†ä¿è¯ Rust çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨çš„æ­£ç¡®æ€§ï¼ŒRust ä½¿ç”¨äº†ä¸€ä¸ªå€Ÿç”¨æ£€æŸ¥å™¨(Borrow checker)ï¼Œæ¥æ£€æŸ¥æˆ‘ä»¬ç¨‹åºçš„å€Ÿç”¨æ­£ç¡®æ€§ï¼š

```rust
#![allow(unused)]
fn main() {
{
    let r;                // ---------+-- 'a
                          //          |
    {                     //          |
        let x = 5;        // -+-- 'b  |
        r = &x;           //  |       |
    }                     // -+       |
                          //          |
    println!("r: {}", r); //          |
}                         // ---------+
}

```
è¿™æ®µä»£ç å’Œä¹‹å‰çš„ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå¢åŠ äº†å¯¹å˜é‡ç”Ÿå‘½å‘¨æœŸçš„æ³¨é‡Šã€‚è¿™é‡Œï¼Œ==r å˜é‡è¢«èµ‹äºˆäº†ç”Ÿå‘½å‘¨æœŸ 'a==ï¼Œ==x è¢«èµ‹äºˆäº†ç”Ÿå‘½å‘¨æœŸ 'b==ï¼Œä»å›¾ç¤ºä¸Šå¯ä»¥æ˜æ˜¾çœ‹å‡ºç”Ÿå‘½å‘¨æœŸ 'b æ¯” 'a å°å¾ˆå¤šã€‚

åœ¨ç¼–è¯‘æœŸï¼ŒRust ä¼šæ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç»“æœå‘ç° r æ˜æ˜æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸ 'aï¼Œä½†æ˜¯å´å¼•ç”¨äº†ä¸€ä¸ªå°å¾—å¤šçš„ç”Ÿå‘½å‘¨æœŸ 'bï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºæˆ‘ä»¬çš„ç¨‹åºå­˜åœ¨é£é™©ï¼Œå› æ­¤æ‹’ç»è¿è¡Œã€‚

å¦‚æœæƒ³è¦ç¼–è¯‘é€šè¿‡ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ 'b æ¯” 'a å¤§å°±å¥½ã€‚æ€»ä¹‹ï¼Œx å˜é‡åªè¦æ¯” r æ´»å¾—ä¹…ï¼Œé‚£ä¹ˆ r å°±èƒ½éšæ„å¼•ç”¨ x ä¸”ä¸ä¼šå­˜åœ¨å±é™©ï¼š

```rust
{
    let x = 5;            // ----------+-- 'b
                          //           |
    let r = &x;           // --+-- 'a  |
                          //   |       |
    println!("r: {}", r); //   |       |
                          // --+       |
}  
```
æ ¹æ®ä¹‹å‰çš„ç»“è®ºï¼Œæˆ‘ä»¬é‡æ–°å®ç°äº†ä»£ç ï¼Œç°åœ¨ x çš„ç”Ÿå‘½å‘¨æœŸ 'b å¤§äº r çš„ç”Ÿå‘½å‘¨æœŸ 'aï¼Œå› æ­¤ r å¯¹ x çš„å¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚

é€šè¿‡ä¹‹å‰çš„å†…å®¹ï¼Œæˆ‘ä»¬äº†è§£äº†ä½•ä¸ºç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿäº†è§£äº† Rust å¦‚ä½•åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸæ¥ç¡®ä¿å¼•ç”¨æ˜¯åˆæ³•çš„ï¼Œä¸‹é¢æ¥çœ‹çœ‹å‡½æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚

> åœ¨ Rust ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­ä¸å˜é‡çš„ä½œç”¨åŸŸæœ‰å…³ã€‚ç”Ÿå‘½å‘¨æœŸæŒ‡æ˜äº†å¼•ç”¨ï¼ˆæˆ–å€Ÿç”¨ï¼‰çš„æœ‰æ•ˆæœŸï¼Œåœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æ‰èƒ½è¿›è¡Œè®¿é—®æ“ä½œï¼Œè¶…å‡ºç”Ÿå‘½å‘¨æœŸåˆ™ä¸èƒ½å†ä½¿ç”¨ã€‚
> å¯¹äºä¸Šè¿°ä»£ç ä¸­çš„å˜é‡ x å’Œ rï¼Œå®ƒä»¬åˆ†åˆ«æœ‰è‡ªå·±çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸã€‚å˜é‡ x çš„ä½œç”¨åŸŸæ˜¯å½“å‰ä»£ç å—å†…éƒ¨ï¼Œè€Œç”Ÿå‘½å‘¨æœŸæ˜¯ 'bï¼Œå³ä» x å®šä¹‰å¼€å§‹ä¸€ç›´åˆ°å½“å‰ä»£ç å—ç»“æŸã€‚å˜é‡ r æ˜¯å¯¹å˜é‡ x çš„å¼•ç”¨ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸæ˜¯ 'aï¼Œä¹Ÿå°±æ˜¯ä» r å®šä¹‰å¼€å§‹ä¸€ç›´åˆ°å½“å‰ä»£ç å—ç»“æŸã€‚ç”±äºä»£ç å—çš„ä½œç”¨åŸŸåŒ…æ‹¬äº†å˜é‡ r å’Œ xï¼Œå› æ­¤å˜é‡ r çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»å°äºæˆ–ç­‰äºå…¶å¼•ç”¨çš„å˜é‡ x çš„ç”Ÿå‘½å‘¨æœŸã€‚
> ç”±äºå˜é‡ x çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ'bï¼‰æ¯”å˜é‡ r çš„ç”Ÿå‘½å‘¨æœŸï¼ˆ'aï¼‰æ›´é•¿ï¼Œå› æ­¤å˜é‡ x åœ¨å˜é‡ r çš„å¼•ç”¨æœŸé—´éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå³ r å¼•ç”¨çš„æ˜¯æœ‰æ•ˆå€¼ï¼Œä¸ä¼šå‡ºç°æ‚¬å‚æŒ‡é’ˆï¼ˆDangling Pointerï¼‰ç­‰å†…å­˜å®‰å…¨é—®é¢˜ã€‚å¦‚æœå°†å˜é‡ r çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°æ¯”å˜é‡ x æ›´é•¿çš„æ—¶é—´ï¼Œå°±å¯èƒ½ä¼šå‡ºç°æ‚¬å‚æŒ‡é’ˆï¼Œå¯¼è‡´ç¨‹åºå´©æºƒæˆ–å‡ºç°å…¶ä»–å†…å­˜å®‰å…¨é—®é¢˜ã€‚
> å› æ­¤ï¼Œåœ¨ Rust ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸé•¿çš„å˜é‡å¿…é¡»è‡³å°‘åŒ…å«ç”Ÿå‘½å‘¨æœŸçŸ­çš„å˜é‡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚è¿™æ˜¯ Rust ä¿è¯å†…å­˜å®‰å…¨çš„é‡è¦æœºåˆ¶ä¹‹ä¸€ã€‚

### å‡½æ•°ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
å…ˆæ¥è€ƒè™‘ä¸€ä¸ªä¾‹å­ - è¿”å›ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ä¸­è¾ƒé•¿çš„é‚£ä¸ªï¼Œè¯¥å‡½æ•°çš„å‚æ•°æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼š

```rust
fn longest(x: &str, y: &str) -> &str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}

fn main() {
    let string1 = String::from("abcd");
    let string2 = "xyz";

    let result = longest(string1.as_str(), string2);
    println!("The longest string is {}", result);
}
```

è¿™æ®µ longest å®ç°ï¼Œéå¸¸æ ‡å‡†ä¼˜ç¾ï¼Œå°±è¿å¤šä½™çš„ return å’Œåˆ†å·éƒ½æ²¡æœ‰ï¼Œå¯æ˜¯ç°å®æ€»æ˜¯ç»™æˆ‘ä»¬é‡é‡ä¸€å‡»ï¼š

```
error[E0106]: missing lifetime specifier
 --> src/main.rs:9:33
  |
9 | fn longest(x: &str, y: &str) -> &str {
  |               ----     ----     ^ expected named lifetime parameter // å‚æ•°éœ€è¦ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ
  |
  = help: this function's return type contains a borrowed value, but the signature does not say whether it is
  borrowed from `x` or `y`
  = å¸®åŠ©ï¼š è¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯å‡½æ•°ç­¾åæ— æ³•è¯´æ˜ï¼Œè¯¥å¼•ç”¨æ˜¯å€Ÿç”¨è‡ª `x` è¿˜æ˜¯ `y`
help: consider introducing a named lifetime parameter // è€ƒè™‘å¼•å…¥ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ
  |
9 | fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
  |           ^^^^    ^^^^^^^     ^^^^^^^     ^^^
```
å–”ï¼Œè¿™çœŸæ˜¯ä¸€ä¸ªå¤æ‚çš„æç¤ºï¼Œé‚£æ„Ÿè§‰å°±å¥½åƒæ˜¯ç”Ÿå‘½å‘¨æœŸå»éè¯šå‹¿æ‰°ç›¸äº²ï¼Œç»“æœåœ¨åˆå°è±¡ç¯èŠ‚å°± 23 ç›ç¯å…¨ç­ã€‚ç­‰ç­‰ï¼Œå…ˆåˆ«æ€¥ï¼Œå¦‚æœä½ ä»”ç»†é˜…è¯»ï¼Œå°±ä¼šå‘ç°ï¼Œå…¶å®ä¸»è¦æ˜¯ç¼–è¯‘å™¨æ— æ³•çŸ¥é“è¯¥å‡½æ•°çš„è¿”å›å€¼åˆ°åº•å¼•ç”¨ x è¿˜æ˜¯ y ï¼Œ**å› ä¸ºç¼–è¯‘å™¨éœ€è¦çŸ¥é“è¿™äº›ï¼Œæ¥ç¡®ä¿å‡½æ•°è°ƒç”¨åçš„å¼•ç”¨ç”Ÿå‘½å‘¨æœŸåˆ†æ**ã€‚

ä¸è¿‡è¯´æ¥å°´å°¬ï¼Œå°±è¿™ä¸ªå‡½æ•°è€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“è¿”å›å€¼åˆ°åº•å¼•ç”¨å“ªä¸ªï¼Œå› ä¸ºä¸€ä¸ªåˆ†æ”¯è¿”å› xï¼Œå¦ä¸€ä¸ªåˆ†æ”¯è¿”å› y...è¿™å¯å’‹åŠï¼Ÿå…ˆæ¥åˆ†æä¸‹ã€‚

æˆ‘ä»¬åœ¨å®šä¹‰è¯¥å‡½æ•°æ—¶ï¼Œé¦–å…ˆæ— æ³•çŸ¥é“ä¼ é€’ç»™å‡½æ•°çš„å…·ä½“å€¼ï¼Œå› æ­¤åˆ°åº•æ˜¯ if è¿˜æ˜¯ else è¢«æ‰§è¡Œï¼Œæ— ä»å¾—çŸ¥ã€‚å…¶æ¬¡ï¼Œä¼ å…¥å¼•ç”¨çš„å…·ä½“ç”Ÿå‘½å‘¨æœŸä¹Ÿæ— æ³•çŸ¥é“ï¼Œå› æ­¤ä¹Ÿä¸èƒ½åƒä¹‹å‰çš„ä¾‹å­é‚£æ ·é€šè¿‡åˆ†æç”Ÿå‘½å‘¨æœŸæ¥ç¡®å®šå¼•ç”¨æ˜¯å¦æœ‰æ•ˆã€‚åŒæ—¶ï¼Œç¼–è¯‘å™¨çš„å€Ÿç”¨æ£€æŸ¥ä¹Ÿæ— æ³•æ¨å¯¼å‡ºè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºå®ƒä¸çŸ¥é“ x å’Œ y çš„ç”Ÿå‘½å‘¨æœŸè·Ÿè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·çš„(è¯´å®è¯ï¼Œäººéƒ½æä¸æ¸…ï¼Œä½•å†µç¼–è¯‘å™¨è¿™ä¸ªå¤§èªæ˜)ã€‚

å› æ­¤ï¼Œè¿™æ—¶å°±å›åˆ°äº†æ–‡ç« å¼€å¤´è¯´çš„å†…å®¹ï¼šåœ¨å­˜åœ¨å¤šä¸ªå¼•ç”¨æ—¶ï¼Œç¼–è¯‘å™¨æœ‰æ—¶ä¼šæ— æ³•è‡ªåŠ¨æ¨å¯¼ç”Ÿå‘½å‘¨æœŸï¼Œæ­¤æ—¶å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»æ ‡æ³¨ï¼Œé€šè¿‡ä¸ºå‚æ•°æ ‡æ³¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸæ¥å¸®åŠ©ç¼–è¯‘å™¨è¿›è¡Œå€Ÿç”¨æ£€æŸ¥çš„åˆ†æã€‚

### ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•
> ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å¹¶ä¸ä¼šæ”¹å˜ä»»ä½•å¼•ç”¨çš„å®é™…ä½œç”¨åŸŸ -- é²è¿…

é²è¿…è¯´è¿‡çš„è¯ï¼Œæ€»æ˜¯å€¼å¾—é‡ç‚¹æ ‡æ³¨ï¼Œå½“ä½ æœªæ¥æ›´åŠ ç†è§£ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œä½ æ‰ä¼šå‘ç°è¿™å¥è¯çš„ç²¾é«“å’Œé‡è¦ï¼ç°åœ¨å…ˆç®€å•è®°ä½ï¼Œæ ‡è®°çš„ç”Ÿå‘½å‘¨æœŸåªæ˜¯ä¸ºäº†å–æ‚¦ç¼–è¯‘å™¨ï¼Œè®©ç¼–è¯‘å™¨ä¸è¦éš¾ä¸ºæˆ‘ä»¬ï¼Œè®°ä½äº†å—ï¼Ÿæ²¡è®°ä½ï¼Œå†å›å¤´çœ‹ä¸€éï¼Œè¿™å¯¹æœªæ¥ä½ é‡åˆ°ç”Ÿå‘½å‘¨æœŸé—®é¢˜æ—¶ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ï¼

åœ¨å¾ˆå¤šæ—¶å€™ç¼–è¯‘å™¨æ˜¯å¾ˆèªæ˜çš„ï¼Œä½†æ˜¯æ€»æœ‰äº›æ—¶å€™ï¼Œå®ƒä¼šåŒ–èº«å¤§èªæ˜ï¼Œè‡ªä»¥ä¸ºä»€ä¹ˆéƒ½å¾ˆæ‡‚ï¼Œç„¶åå»æ‹’ç»æˆ‘ä»¬ä»£ç çš„æ‰§è¡Œï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æˆ‘ä»¬é€šè¿‡ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨æ¥å‘Šè¯‰è¿™ä¸ªå¤§èªæ˜ï¼šåˆ«è‡ªä½œèªæ˜äº†ï¼Œå¬æˆ‘çš„å°±å¥½ã€‚

ä¾‹å¦‚ä¸€ä¸ªå˜é‡ï¼Œåªèƒ½æ´»ä¸€ä¸ªèŠ±æ‹¬å·ï¼Œé‚£ä¹ˆå°±ç®—ä½ ç»™å®ƒæ ‡æ³¨ä¸€ä¸ªæ´»å…¨å±€çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒè¿˜æ˜¯ä¼šåœ¨å‰é¢çš„èŠ±æ‹¬å·ç»“æŸå¤„è¢«é‡Šæ”¾æ‰ï¼Œå¹¶ä¸ä¼šçœŸçš„å…¨å±€å­˜æ´»ã€‚

ç”Ÿå‘½å‘¨æœŸçš„è¯­æ³•ä¹Ÿé¢‡ä¸ºä¸ä¼—ä¸åŒï¼Œä»¥ ' å¼€å¤´ï¼Œåç§°å¾€å¾€æ˜¯ä¸€ä¸ªå•ç‹¬çš„å°å†™å­—æ¯ï¼Œå¤§å¤šæ•°äººéƒ½ç”¨ 'a æ¥ä½œä¸ºç”Ÿå‘½å‘¨æœŸçš„åç§°ã€‚ å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å‚æ•°ï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸä¼šä½äºå¼•ç”¨ç¬¦å· & ä¹‹åï¼Œå¹¶ç”¨ä¸€ä¸ªç©ºæ ¼æ¥å°†ç”Ÿå‘½å‘¨æœŸå’Œå¼•ç”¨å‚æ•°åˆ†éš”å¼€:


```rust
&i32        // ä¸€ä¸ªå¼•ç”¨
&'a i32     // å…·æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
&'a mut i32 // å…·æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨
```
ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œå®ƒè‡ªèº«å¹¶ä¸å…·æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¤šä¸ªå¼•ç”¨ä¹‹é—´çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•° first æ˜¯ä¸€ä¸ªæŒ‡å‘ i32 ç±»å‹çš„å¼•ç”¨ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸ 'aï¼Œè¯¥å‡½æ•°è¿˜æœ‰å¦ä¸€ä¸ªå‚æ•° secondï¼Œå®ƒä¹Ÿæ˜¯æŒ‡å‘ i32 ç±»å‹çš„å¼•ç”¨ï¼Œå¹¶ä¸”åŒæ ·å…·æœ‰ç”Ÿå‘½å‘¨æœŸ 'aã€‚æ­¤å¤„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä»…ä»…è¯´æ˜ï¼Œè¿™ä¸¤ä¸ªå‚æ•° first å’Œ second è‡³å°‘æ´»å¾—å’Œ'a ä¸€æ ·ä¹…ï¼Œè‡³äºåˆ°åº•æ´»å¤šä¹…æˆ–è€…å“ªä¸ªæ´»å¾—æ›´ä¹…ï¼ŒæŠ±æ­‰æˆ‘ä»¬éƒ½æ— æ³•å¾—çŸ¥ï¼š
```
fn useless<'a>(first: &'a i32, second: &'a i32) {}
```
**å‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨**
ç»§ç»­ä¹‹å‰çš„ longest å‡½æ•°ï¼Œä»ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ä¸­è¿”å›è¾ƒé•¿çš„é‚£ä¸ªï¼š

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

éœ€è¦æ³¨æ„çš„ç‚¹å¦‚ä¸‹ï¼š
- å’Œæ³›å‹ä¸€æ ·ï¼Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œéœ€è¦å…ˆå£°æ˜ <'a>
- xã€y å’Œè¿”å›å€¼è‡³å°‘æ´»å¾—å’Œ 'a ä¸€æ ·ä¹…(å› ä¸ºè¿”å›å€¼è¦ä¹ˆæ˜¯ xï¼Œè¦ä¹ˆæ˜¯ y)
è¯¥å‡½æ•°ç­¾åè¡¨æ˜å¯¹äºæŸäº›ç”Ÿå‘½å‘¨æœŸ 'aï¼Œå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°éƒ½è‡³å°‘è·Ÿ 'a æ´»å¾—ä¸€æ ·ä¹…ï¼ŒåŒæ—¶å‡½æ•°çš„è¿”å›å¼•ç”¨ä¹Ÿè‡³å°‘è·Ÿ 'a æ´»å¾—ä¸€æ ·ä¹…ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¸å‚æ•°ç”Ÿå‘½å‘¨æœŸä¸­çš„è¾ƒå°å€¼ä¸€è‡´ï¼šè™½ç„¶ä¸¤ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯æ ‡æ³¨äº† 'aï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸¤ä¸ªå‚æ•°çš„çœŸå®ç”Ÿå‘½å‘¨æœŸå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„(ç”Ÿå‘½å‘¨æœŸ 'a ä¸ä»£è¡¨ç”Ÿå‘½å‘¨æœŸç­‰äº 'aï¼Œè€Œæ˜¯å¤§äºç­‰äº 'a)ã€‚

å›å¿†ä¸‹â€œé²è¿…â€è¯´çš„è¯ï¼Œå†å‚è€ƒä¸Šé¢çš„å†…å®¹ï¼Œå¯ä»¥å¾—å‡ºï¼šåœ¨é€šè¿‡å‡½æ•°ç­¾åæŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜ä¼ å…¥å¼•ç”¨æˆ–è€…è¿”å›å¼•ç”¨çš„çœŸå®ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å½“ä¸æ»¡è¶³æ­¤çº¦æŸæ¡ä»¶æ—¶ï¼Œå°±æ‹’ç»ç¼–è¯‘é€šè¿‡ã€‚

å› æ­¤ longest å‡½æ•°å¹¶ä¸çŸ¥é“ x å’Œ y å…·ä½“ä¼šæ´»å¤šä¹…ï¼Œåªè¦çŸ¥é“å®ƒä»¬çš„ä½œç”¨åŸŸè‡³å°‘èƒ½æŒç»­ 'a è¿™ä¹ˆé•¿å°±è¡Œã€‚

å½“æŠŠå…·ä½“çš„å¼•ç”¨ä¼ ç»™ longest æ—¶ï¼Œé‚£ç”Ÿå‘½å‘¨æœŸ 'a çš„å¤§å°å°±æ˜¯ x å’Œ y çš„ä½œç”¨åŸŸçš„é‡åˆéƒ¨åˆ†ï¼Œæ¢å¥è¯è¯´ï¼Œ'a çš„å¤§å°å°†ç­‰äº x å’Œ y ä¸­è¾ƒå°çš„é‚£ä¸ªã€‚ç”±äºè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿè¢«æ ‡è®°ä¸º 'aï¼Œå› æ­¤è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯ x å’Œ y ä¸­ä½œç”¨åŸŸè¾ƒå°çš„é‚£ä¸ªã€‚

è¯´å®è¯ï¼Œè¿™æ®µæ–‡å­—æˆ‘å†™çš„éƒ½å¿«å´©æºƒäº†ï¼Œä¸çŸ¥é“ä½ ä»¬è¯»èµ·æ¥å¦‚ä½•ï¼Œå®åœ¨\*\*å¤ªç»•äº†ã€‚ã€‚é‚£å°±å¹²è„†ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šå§ï¼š

```rust
fn main() {
    let string1 = String::from("long string is long");

    {
        let string2 = String::from("xyz");
        let result = longest(string1.as_str(), string2.as_str());
        println!("The longest string is {}", result);
    }
}
```
åœ¨ä¸Šä¾‹ä¸­ï¼Œstring1 çš„ä½œç”¨åŸŸç›´åˆ° main å‡½æ•°çš„ç»“æŸï¼Œè€Œ string2 çš„ä½œç”¨åŸŸåˆ°å†…éƒ¨èŠ±æ‹¬å·çš„ç»“æŸ }ï¼Œé‚£ä¹ˆæ ¹æ®ä¹‹å‰çš„ç†è®ºï¼Œ'a æ˜¯ä¸¤è€…ä¸­ä½œç”¨åŸŸè¾ƒå°çš„é‚£ä¸ªï¼Œä¹Ÿå°±æ˜¯ 'a çš„ç”Ÿå‘½å‘¨æœŸç­‰äº string2 çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒç†ï¼Œç”±äºå‡½æ•°è¿”å›çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯ 'aï¼Œå¯ä»¥å¾—å‡ºå‡½æ•°è¿”å›çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿç­‰äº string2 çš„ç”Ÿå‘½å‘¨æœŸã€‚

ç°åœ¨æ¥éªŒè¯ä¸‹ä¸Šé¢çš„ç»“è®ºï¼šresult çš„ç”Ÿå‘½å‘¨æœŸç­‰äºå‚æ•°ä¸­ç”Ÿå‘½å‘¨æœŸæœ€å°çš„ï¼Œå› æ­¤è¦ç­‰äº string2 çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œresult è¦æ´»å¾—å’Œ string2 ä¸€æ ·ä¹…ï¼Œè§‚å¯Ÿä¸‹ä»£ç çš„å®ç°ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªç»“è®ºæ˜¯æ­£ç¡®çš„ï¼

å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œç¼–è¯‘å™¨å¾—å‡ºäº†å’Œæˆ‘ä»¬è‚‰çœ¼è§‚å¯Ÿä¸€æ ·çš„ç»“è®ºï¼Œè€Œä¸å†æ˜¯ä¸€ä¸ªè’™åœˆçš„å¤§èªæ˜ã€‚

å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¯¥ä¾‹å­è¯æ˜äº† result çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»ç­‰äºä¸¤ä¸ªå‚æ•°ä¸­ç”Ÿå‘½å‘¨æœŸè¾ƒå°çš„é‚£ä¸ª:

```rust
fn main() {
    let string1 = String::from("long string is long");
    let result;
    {
        let string2 = String::from("xyz");
        result = longest(string1.as_str(), string2.as_str());
    }
    println!("The longest string is {}", result);
}
```
Bangï¼Œé”™è¯¯å†’å¤´äº†ï¼š

```
error[E0597]: `string2` does not live long enough
 --> src/main.rs:6:44
  |
6 |         result = longest(string1.as_str(), string2.as_str());
  |                                            ^^^^^^^ borrowed value does not live long enough
7 |     }
  |     - `string2` dropped here while still borrowed
8 |     println!("The longest string is {}", result);
  |                                          ------ borrow later used here
```
åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œresult å¿…é¡»è¦æ´»åˆ° println!å¤„ï¼Œå› ä¸º result çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ 'aï¼Œå› æ­¤ 'a å¿…é¡»æŒç»­åˆ° println!ã€‚

åœ¨ longest å‡½æ•°ä¸­ï¼Œstring2 çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯ 'aï¼Œç”±æ­¤è¯´æ˜ string2 ä¹Ÿå¿…é¡»æ´»åˆ° println! å¤„ï¼Œå¯æ˜¯ string2 åœ¨ä»£ç ä¸­å®é™…ä¸Šåªèƒ½æ´»åˆ°å†…éƒ¨è¯­å¥å—çš„èŠ±æ‹¬å·å¤„ }ï¼Œå°äºå®ƒåº”è¯¥å…·å¤‡çš„ç”Ÿå‘½å‘¨æœŸ 'aï¼Œå› æ­¤ç¼–è¯‘å‡ºé”™ã€‚

ä½œä¸ºäººç±»ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹å‡º result å®é™…ä¸Šå¼•ç”¨äº† string1ï¼Œå› ä¸º string1 çš„é•¿åº¦æ˜æ˜¾è¦æ¯” string2 é•¿ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œç¼–è¯‘å™¨ä¸è¯¥å¦‚æ­¤çŸ«æƒ…æ‰å¯¹ï¼Œå®ƒåº”è¯¥èƒ½è®¤è¯†åˆ° result æ²¡æœ‰å¼•ç”¨ string2ï¼Œè®©æˆ‘ä»¬è¿™æ®µä»£ç é€šè¿‡ã€‚åªèƒ½è¯´ï¼Œä½œä¸ºå°Šè´µçš„äººç±»ï¼Œç¼–è¯‘å™¨çš„å‘æ˜è€…ï¼Œä½ é«˜ä¼°äº†è¿™ä¸ªå·¥å…·çš„èƒ½åŠ›ï¼Œå®ƒçœŸçš„åšä¸åˆ°ï¼è€Œä¸” Rust ç¼–è¯‘å™¨åœ¨è°ƒæ•™ä¸Šæ˜¯éå¸¸ä¿å®ˆçš„ï¼šå½“å¯èƒ½å‡ºé”™ä¹Ÿå¯èƒ½ä¸å‡ºé”™æ—¶ï¼Œå®ƒä¼šé€‰æ‹©å‰è€…ï¼ŒæŠ›å‡ºç¼–è¯‘é”™è¯¯ã€‚

æ€»ä¹‹ï¼Œæ˜¾å¼çš„ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨æ­£ç¡®çš„è®¤è¯†åˆ°å¤šä¸ªå¼•ç”¨ä¹‹é—´çš„å…³ç³»ï¼Œæœ€ç»ˆå¸®æˆ‘ä»¬æå‰è§„é¿å¯èƒ½å­˜åœ¨çš„ä»£ç é£é™©ã€‚

å°ç»ƒä¹ ï¼šå°è¯•ç€å»æ›´æ”¹ longest å‡½æ•°ï¼Œä¾‹å¦‚ä¿®æ”¹å‚æ•°ã€ç”Ÿå‘½å‘¨æœŸæˆ–è€…è¿”å›å€¼ï¼Œç„¶åæ¨æµ‹ç»“æœå¦‚ä½•ï¼Œæœ€åå†è·Ÿç¼–è¯‘å™¨çš„è¾“å‡ºè¿›è¡Œå°è¯ã€‚

**æ·±å…¥æ€è€ƒç”Ÿå‘½å‘¨æœŸæ ‡æ³¨**
ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å¾€å¾€å–å†³äºå‡½æ•°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ä¹‹å‰çš„ longest å‡½æ•°ï¼Œå¦‚æœå®ƒæ°¸è¿œåªè¿”å›ç¬¬ä¸€ä¸ªå‚æ•° xï¼Œç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨è¯¥å¦‚ä½•ä¿®æ”¹(è¯¥ä¾‹å­å°±æ˜¯ä¸Šé¢çš„å°ç»ƒä¹ ç»“æœä¹‹ä¸€)?

```rust
fn longest<'a>(x: &'a str, y: &str) -> &'a str {
    x
}
```
åœ¨æ­¤ä¾‹ä¸­ï¼Œy å®Œå…¨æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå› æ­¤ y çš„ç”Ÿå‘½å‘¨æœŸä¸ x å’Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¹Ÿä¸å¿…å†ä¸º y æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œåªéœ€è¦æ ‡æ³¨ x å‚æ•°å’Œè¿”å›å€¼å³å¯ã€‚

å‡½æ•°çš„è¿”å›å€¼å¦‚æœæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸåªä¼šæ¥æºäºï¼š
- å‡½æ•°å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸ
- å‡½æ•°ä½“ä¸­æŸä¸ªæ–°å»ºå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
è‹¥æ˜¯åè€…æƒ…å†µï¼Œå°±æ˜¯å…¸å‹çš„æ‚¬å‚å¼•ç”¨åœºæ™¯ï¼š

```rust
fn longest<'a>(x: &str, y: &str) -> &'a str {
    let result = String::from("really long string");
    result.as_str()
}
```
ä¸Šé¢çš„å‡½æ•°çš„è¿”å›å€¼å°±å’Œå‚æ•° xï¼Œy æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè€Œæ˜¯å¼•ç”¨äº†å‡½æ•°ä½“å†…åˆ›å»ºçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œè¯¥å‡½æ•°ä¼šæŠ¥é”™ï¼š

```
error[E0515]: cannot return value referencing local variable `result` // è¿”å›å€¼resultå¼•ç”¨äº†æœ¬åœ°çš„å˜é‡
  --> src/main.rs:11:5
   |
11 |     result.as_str()
   |     ------^^^^^^^^^
   |     |
   |     returns a value referencing data owned by the current function
   |     `result` is borrowed here
```

ä¸»è¦é—®é¢˜å°±åœ¨äºï¼Œresult åœ¨å‡½æ•°ç»“æŸåå°±è¢«é‡Šæ”¾ï¼Œä½†æ˜¯åœ¨å‡½æ•°ç»“æŸåï¼Œå¯¹ result çš„å¼•ç”¨ä¾ç„¶åœ¨ç»§ç»­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŠæ³•æŒ‡å®šåˆé€‚çš„ç”Ÿå‘½å‘¨æœŸæ¥è®©ç¼–è¯‘é€šè¿‡ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå°±åœ¨ Rust ä¸­é¿å…äº†æ‚¬å‚å¼•ç”¨ã€‚

é‚£é‡åˆ°è¿™ç§æƒ…å†µè¯¥æ€ä¹ˆåŠï¼Ÿæœ€å¥½çš„åŠæ³•å°±æ˜¯è¿”å›å†…éƒ¨å­—ç¬¦ä¸²çš„æ‰€æœ‰æƒï¼Œç„¶åæŠŠå­—ç¬¦ä¸²çš„æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…ï¼š

```rust
fn longest<'a>(_x: &str, _y: &str) -> String {
    String::from("really long string")
}

fn main() {
   let s = longest("not", "important");
}
```
è‡³æ­¤ï¼Œå¯ä»¥å¯¹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œä¸‹æ€»ç»“ï¼šç”Ÿå‘½å‘¨æœŸè¯­æ³•ç”¨æ¥å°†å‡½æ•°çš„å¤šä¸ªå¼•ç”¨å‚æ•°å’Œè¿”å›å€¼çš„ä½œç”¨åŸŸå…³è”åˆ°ä¸€èµ·ï¼Œä¸€æ—¦å…³è”åˆ°ä¸€èµ·åï¼ŒRust å°±æ‹¥æœ‰å……åˆ†çš„ä¿¡æ¯æ¥ç¡®ä¿æˆ‘ä»¬çš„æ“ä½œæ˜¯å†…å­˜å®‰å…¨çš„ã€‚

### ç»“æ„ä½“ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
ä¸ä»…ä»…å‡½æ•°å…·æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œç»“æ„ä½“å…¶å®ä¹Ÿæœ‰è¿™ä¸ªæ¦‚å¿µï¼Œåªä¸è¿‡æˆ‘ä»¬ä¹‹å‰å¯¹ç»“æ„ä½“çš„ä½¿ç”¨éƒ½åœç•™åœ¨éå¼•ç”¨ç±»å‹å­—æ®µä¸Šã€‚ç»†å¿ƒçš„åŒå­¦åº”è¯¥èƒ½å›æƒ³èµ·æ¥ï¼Œä¹‹å‰ä¸ºä»€ä¹ˆä¸åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡æˆ–è€…å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œè€Œæ˜¯ç»Ÿä¸€ä½¿ç”¨ String ç±»å‹ï¼ŸåŸå› å¾ˆç®€å•ï¼Œåè€…åœ¨ç»“æ„ä½“åˆå§‹åŒ–æ—¶ï¼Œåªè¦è½¬ç§»æ‰€æœ‰æƒå³å¯ï¼Œè€Œå‰è€…ï¼ŒæŠ±æ­‰ï¼Œå®ƒä»¬æ˜¯å¼•ç”¨ï¼Œå®ƒä»¬ä¸èƒ½ä¸ºæ‰€æ¬²ä¸ºã€‚

æ—¢ç„¶ä¹‹å‰å·²ç»ç†è§£äº†ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆæ„å‘³ç€åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨å¼•ç”¨ä¹Ÿå˜å¾—å¯èƒ½ï¼šåªè¦ä¸ºç»“æ„ä½“ä¸­çš„æ¯ä¸€ä¸ªå¼•ç”¨æ ‡æ³¨ä¸Šç”Ÿå‘½å‘¨æœŸå³å¯ï¼š

```rust
struct ImportantExcerpt<'a> {
    part: &'a str,
}

fn main() {
    let novel = String::from("Call me Ishmael. Some years ago...");
    let first_sentence = novel.split('.').next().expect("Could not find a '.'");
    let i = ImportantExcerpt {
        part: first_sentence,
    };
}
```
ImportantExcerpt ç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å­—æ®µ partï¼Œå› æ­¤éœ€è¦ä¸ºå®ƒæ ‡æ³¨ä¸Šç”Ÿå‘½å‘¨æœŸã€‚ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•è·Ÿæ³›å‹å‚æ•°è¯­æ³•å¾ˆåƒï¼Œéœ€è¦å¯¹ç”Ÿå‘½å‘¨æœŸå‚æ•°è¿›è¡Œå£°æ˜ <'a>ã€‚è¯¥ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯´æ˜ï¼Œç»“æ„ä½“ ImportantExcerpt æ‰€å¼•ç”¨çš„å­—ç¬¦ä¸² str å¿…é¡»æ¯”è¯¥ç»“æ„ä½“æ´»å¾—æ›´ä¹…ã€‚

ä» main å‡½æ•°å®ç°æ¥çœ‹ï¼ŒImportantExcerpt çš„ç”Ÿå‘½å‘¨æœŸä»ç¬¬ 4 è¡Œå¼€å§‹ï¼Œåˆ° main å‡½æ•°æœ«å°¾ç»“æŸï¼Œè€Œè¯¥ç»“æ„ä½“å¼•ç”¨çš„å­—ç¬¦ä¸²ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œä¹Ÿæ˜¯åˆ° main å‡½æ•°æœ«å°¾ç»“æŸï¼Œå¯ä»¥å¾—å‡ºç»“è®ºç»“æ„ä½“å¼•ç”¨çš„å­—ç¬¦ä¸²æ´»å¾—æ¯”ç»“æ„ä½“ä¹…ï¼Œè¿™ç¬¦åˆäº†ç¼–è¯‘å™¨å¯¹ç”Ÿå‘½å‘¨æœŸçš„è¦æ±‚ï¼Œå› æ­¤ç¼–è¯‘é€šè¿‡ã€‚

ä¸ä¹‹ç›¸åï¼Œä¸‹é¢çš„ä»£ç å°±æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š

```rust
#[derive(Debug)]
struct ImportantExcerpt<'a> {
    part: &'a str,
}

fn main() {
    let i;
    {
        let novel = String::from("Call me Ishmael. Some years ago...");
        let first_sentence = novel.split('.').next().expect("Could not find a '.'");
        i = ImportantExcerpt {
            part: first_sentence,
        };
    }
    println!("{:?}",i);
}
```
è§‚å¯Ÿä»£ç ï¼Œ**å¯ä»¥çœ‹å‡ºç»“æ„ä½“æ¯”å®ƒå¼•ç”¨çš„å­—ç¬¦ä¸²æ´»å¾—æ›´ä¹…**ï¼Œå¼•ç”¨å­—ç¬¦ä¸²åœ¨å†…éƒ¨è¯­å¥å—æœ«å°¾ } è¢«é‡Šæ”¾åï¼Œprintln! ä¾ç„¶åœ¨å¤–é¢ä½¿ç”¨äº†è¯¥ç»“æ„ä½“ï¼Œå› æ­¤ä¼šå¯¼è‡´æ— æ•ˆçš„å¼•ç”¨ï¼Œä¸å‡ºæ‰€æ–™ï¼Œç¼–è¯‘æŠ¥é”™ï¼š

```
error[E0597]: `novel` does not live long enough
  --> src/main.rs:10:30
   |
10 |         let first_sentence = novel.split('.').next().expect("Could not find a '.'");
   |                              ^^^^^^^^^^^^^^^^ borrowed value does not live long enough
...
14 |     }
   |     - `novel` dropped here while still borrowed
15 |     println!("{:?}",i);
   |                     - borrow later used here
```

### ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤
å®é™…ä¸Šï¼Œå¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå¼•ç”¨ç±»å‹éƒ½æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ—¶å€™æ— éœ€æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Ÿä¾‹å¦‚ï¼š


```
fn first_word(s: &str) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }

    &s[..]
}
```

è¯¥å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„ä¸ºå…¶æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œç¼–è¯‘ä¾ç„¶å¯ä»¥é€šè¿‡ã€‚å…¶å®åŸå› ä¸å¤æ‚ï¼Œç¼–è¯‘å™¨ä¸ºäº†ç®€åŒ–ç”¨æˆ·çš„ä½¿ç”¨ï¼Œè¿ç”¨äº†ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤å¤§æ³•ã€‚

å¯¹äº first_word å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆè¯¥å¼•ç”¨åªæœ‰ä¸¤ç§æƒ…å†µï¼š
- ä»å‚æ•°è·å–
- ä»å‡½æ•°ä½“å†…éƒ¨æ–°åˆ›å»ºçš„å˜é‡è·å–
å¦‚æœæ˜¯åè€…ï¼Œå°±ä¼šå‡ºç°æ‚¬å‚å¼•ç”¨ï¼Œæœ€ç»ˆè¢«ç¼–è¯‘å™¨æ‹’ç»ï¼Œå› æ­¤åªå‰©ä¸€ç§æƒ…å†µï¼šè¿”å›å€¼çš„å¼•ç”¨æ˜¯è·å–è‡ªå‚æ•°ï¼Œè¿™å°±æ„å‘³ç€å‚æ•°å’Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ ·çš„ã€‚é“ç†å¾ˆç®€å•ï¼Œæˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ï¼Œç¼–è¯‘å™¨è‡ªç„¶ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œå› æ­¤ï¼Œå°±ç®—æˆ‘ä»¬ä¸æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚

å®é™…ä¸Šï¼Œåœ¨ Rust 1.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™ç§ä»£ç æœæ–­ä¸ç»™é€šè¿‡ï¼Œå› ä¸º Rust è¦æ±‚å¿…é¡»æ˜¾å¼çš„ä¸ºæ‰€æœ‰å¼•ç”¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼š

```
fn first_word<'a>(s: &'a str) -> &'a str {
```
åœ¨å†™äº†å¤§é‡çš„ç±»ä¼¼ä»£ç åï¼ŒRust ç¤¾åŒºæŠ±æ€¨å£°å››èµ·ï¼ŒåŒ…æ‹¬å¼€å‘è€…è‡ªå·±éƒ½å¿ä¸äº†äº†ï¼Œæœ€ç»ˆæ­é”…è€Œèµ·ï¼Œè¿™æ‰æœ‰äº†æˆ‘ä»¬ä»Šæ—¥çš„å¹¸ç¦ã€‚

ç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤çš„è§„åˆ™ä¸æ˜¯ä¸€è¹´è€Œå°±ï¼Œè€Œæ˜¯ä¼´éšç€ æ€»ç»“-æ”¹å–„ æµç¨‹çš„å‘¨è€Œå¤å§‹ï¼Œä¸€æ­¥ä¸€æ­¥èµ°åˆ°ä»Šå¤©ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œè¯¥è§„åˆ™ä»¥åå¯èƒ½ä¹Ÿä¼šè¿›ä¸€æ­¥å¢åŠ ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™ä¹Ÿä¼šè¶Šæ¥è¶Šå°‘ï¼Œhooray!

åœ¨å¼€å§‹ä¹‹å‰æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
- æ¶ˆé™¤è§„åˆ™ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œè‹¥ç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šæŸä»¶äº‹æ˜¯æ­£ç¡®æ—¶ï¼Œä¼šç›´æ¥åˆ¤ä¸ºä¸æ­£ç¡®ï¼Œé‚£ä¹ˆä½ è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
- å‡½æ•°æˆ–è€…æ–¹æ³•ä¸­ï¼Œå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º è¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º è¾“å‡ºç”Ÿå‘½å‘¨æœŸ

**ä¸‰æ¡æ¶ˆé™¤è§„åˆ™**
ç¼–è¯‘å™¨ä½¿ç”¨ä¸‰æ¡æ¶ˆé™¤è§„åˆ™æ¥ç¡®å®šå“ªäº›åœºæ™¯ä¸éœ€è¦æ˜¾å¼åœ°å»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚å…¶ä¸­ç¬¬ä¸€æ¡è§„åˆ™åº”ç”¨åœ¨è¾“å…¥ç”Ÿå‘½å‘¨æœŸä¸Šï¼Œç¬¬äºŒã€ä¸‰æ¡åº”ç”¨åœ¨è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸Šã€‚è‹¥ç¼–è¯‘å™¨å‘ç°ä¸‰æ¡è§„åˆ™éƒ½ä¸é€‚ç”¨æ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæç¤ºä½ éœ€è¦æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚
1. æ¯ä¸€ä¸ªå¼•ç”¨å‚æ•°éƒ½ä¼šè·å¾—ç‹¬è‡ªçš„ç”Ÿå‘½å‘¨æœŸ
ä¾‹å¦‚ä¸€ä¸ªå¼•ç”¨å‚æ•°çš„å‡½æ•°å°±æœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨: fn foo<'a>(x: &'a i32)ï¼Œä¸¤ä¸ªå¼•ç”¨å‚æ•°çš„æœ‰ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨:fn foo<'a, 'b>(x: &'a i32, y: &'b i32), ä¾æ­¤ç±»æ¨ã€‚
2. è‹¥åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸ(å‡½æ•°å‚æ•°ä¸­åªæœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹)ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸéƒ½ç­‰äºè¯¥è¾“å…¥ç”Ÿå‘½å‘¨æœŸ
ä¾‹å¦‚å‡½æ•° fn foo(x: &i32) -> &i32ï¼Œx å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«è‡ªåŠ¨èµ‹ç»™è¿”å›å€¼ &i32ï¼Œå› æ­¤è¯¥å‡½æ•°ç­‰åŒäº fn foo<'a>(x: &'a i32) -> &'a i32
3. è‹¥å­˜åœ¨å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ &self æˆ– &mut selfï¼Œåˆ™ &self çš„ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸ
æ‹¥æœ‰ &self å½¢å¼çš„å‚æ•°ï¼Œè¯´æ˜è¯¥å‡½æ•°æ˜¯ä¸€ä¸ª æ–¹æ³•ï¼Œè¯¥è§„åˆ™è®©æ–¹æ³•çš„ä½¿ç”¨ä¾¿åˆ©åº¦å¤§å¹…æå‡ã€‚

è§„åˆ™å…¶å®å¾ˆå¥½ç†è§£ï¼Œä½†æ˜¯ï¼Œçˆ±æ€è€ƒçš„è¯»è€…è‚¯å®šè¦å‘é—®äº†ï¼Œä¾‹å¦‚ç¬¬ä¸‰æ¡è§„åˆ™ï¼Œè‹¥ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯è·Ÿå‚æ•° &self çš„ä¸ä¸€æ ·æ€ä¹ˆåŠï¼Ÿæ€»ä¸èƒ½å¼ºè¿«æˆ‘è¿”å›çš„å€¼æ€»æ˜¯å’Œ &self æ´»å¾—ä¸€æ ·ä¹…å§ï¼Ÿ! é—®å¾—å¥½ï¼Œç­”æ¡ˆå¾ˆç®€å•ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºè¿™äº›è§„åˆ™åªæ˜¯ç¼–è¯‘å™¨å‘ç°ä½ æ²¡æœ‰æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸæ—¶é»˜è®¤å»ä½¿ç”¨çš„ï¼Œå½“ä½ æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸåï¼Œç¼–è¯‘å™¨è‡ªç„¶ä¼šä¹–ä¹–å¬ä½ çš„è¯ã€‚

è®©æˆ‘ä»¬å‡è£…è‡ªå·±æ˜¯ç¼–è¯‘å™¨ï¼Œç„¶åçœ‹ä¸‹ä»¥ä¸‹çš„å‡½æ•°è¯¥å¦‚ä½•åº”ç”¨è¿™äº›è§„åˆ™ï¼š

**ä¾‹å­ 1**


```rust
fn first_word(s: &str) -> &str { // å®é™…é¡¹ç›®ä¸­çš„æ‰‹å†™ä»£ç 
```

é¦–å…ˆï¼Œæˆ‘ä»¬æ‰‹å†™çš„ä»£ç å¦‚ä¸Šæ‰€ç¤ºæ—¶ï¼Œç¼–è¯‘å™¨ä¼šå…ˆåº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¸ºæ¯ä¸ªå‚æ•°æ ‡æ³¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼š


```rust
fn first_word<'a>(s: &'a str) -> &str { // ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºå‚æ•°æ·»åŠ ç”Ÿå‘½å‘¨æœŸ
```

æ­¤æ—¶ï¼Œç¬¬äºŒæ¡è§„åˆ™å°±å¯ä»¥è¿›è¡Œåº”ç”¨ï¼Œå› ä¸ºå‡½æ•°åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤è¯¥ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹äºˆæ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸï¼š


```rust
fn first_word<'a>(s: &'a str) -> &'a str { // ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºè¿”å›å€¼æ·»åŠ ç”Ÿå‘½å‘¨æœŸ
```

æ­¤æ—¶ï¼Œç¼–è¯‘å™¨ä¸ºå‡½æ•°ç­¾åä¸­çš„æ‰€æœ‰å¼•ç”¨éƒ½è‡ªåŠ¨æ·»åŠ äº†å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤ç¼–è¯‘é€šè¿‡ï¼Œä¸”ç”¨æˆ·æ— éœ€æ‰‹åŠ¨å»æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦æŒ‰ç…§ fn first_word(s: &str) -> &str { çš„å½¢å¼å†™ä»£ç å³å¯ã€‚

**ä¾‹å­ 2 å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š**


```rust
fn longest(x: &str, y: &str) -> &str { // å®é™…é¡¹ç›®ä¸­çš„æ‰‹å†™ä»£ç 
```

é¦–å…ˆï¼Œç¼–è¯‘å™¨ä¼šåº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¸ºæ¯ä¸ªå‚æ•°éƒ½æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼š


```rust
fn longest<'a, 'b>(x: &'a str, y: &'b str) -> &str {
```

ä½†æ˜¯æ­¤æ—¶ï¼Œç¬¬äºŒæ¡è§„åˆ™å´æ— æ³•è¢«ä½¿ç”¨ï¼Œå› ä¸ºè¾“å…¥ç”Ÿå‘½å‘¨æœŸæœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸‰æ¡è§„åˆ™ä¹Ÿä¸ç¬¦åˆï¼Œå› ä¸ºå®ƒæ˜¯å‡½æ•°ï¼Œä¸æ˜¯æ–¹æ³•ï¼Œå› æ­¤æ²¡æœ‰ &self å‚æ•°ã€‚åœ¨å¥—ç”¨æ‰€æœ‰è§„åˆ™åï¼Œç¼–è¯‘å™¨ä¾ç„¶æ— æ³•ä¸ºè¿”å›å€¼æ ‡æ³¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œæç¤ºæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼š

```
error[E0106]: missing lifetime specifier
 --> src/main.rs:1:47
  |
1 | fn longest<'a, 'b>(x: &'a str, y: &'b str) -> &str {
  |                       -------     -------     ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`
note: these named lifetimes are available to use
 --> src/main.rs:1:12
  |
1 | fn longest<'a, 'b>(x: &'a str, y: &'b str) -> &str {
  |            ^^  ^^
help: consider using one of the available lifetimes here
  |
1 | fn longest<'a, 'b>(x: &'a str, y: &'b str) -> &'lifetime str {
  |                                                +++++++++
```

ä¸å¾—ä¸è¯´ï¼ŒRust ç¼–è¯‘å™¨çœŸçš„å¾ˆå¼ºå¤§ï¼Œè¿˜è´´å¿ƒçš„ç»™æˆ‘ä»¬æç¤ºäº†è¯¥å¦‚ä½•ä¿®æ”¹ï¼Œè™½ç„¶ã€‚ã€‚ã€‚å¥½åƒã€‚ã€‚ã€‚ã€‚å®ƒçš„æç¤ºè²Œä¼¼ä¸å¤ªå‡†ç¡®ã€‚è¿™é‡Œæˆ‘ä»¬æ›´å¸Œæœ›å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯ 'a ç”Ÿå‘½å‘¨æœŸã€‚

### æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸ
å…ˆæ¥å›å¿†ä¸‹æ³›å‹çš„è¯­æ³•ï¼š

```rust
struct Point<T> {
    x: T,
    y: T,
}

impl<T> Point<T> {
    fn x(&self) -> &T {
        &self.x
    }
}
```

å®é™…ä¸Šï¼Œä¸ºå…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»“æ„ä½“å®ç°æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„è¯­æ³•è·Ÿæ³›å‹å‚æ•°è¯­æ³•å¾ˆç›¸ä¼¼ï¼š

```rust
struct ImportantExcerpt<'a> {
    part: &'a str,
}

impl<'a> ImportantExcerpt<'a> {
    fn level(&self) -> i32 {
        3
    }
}
```

å…¶ä¸­æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š

impl ä¸­å¿…é¡»ä½¿ç”¨ç»“æ„ä½“çš„å®Œæ•´åç§°ï¼ŒåŒ…æ‹¬ <'a>ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä¹Ÿæ˜¯ç»“æ„ä½“ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼
æ–¹æ³•ç­¾åä¸­ï¼Œå¾€å¾€ä¸éœ€è¦æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œå¾—ç›Šäºç”Ÿå‘½å‘¨æœŸæ¶ˆé™¤çš„ç¬¬ä¸€å’Œç¬¬ä¸‰è§„åˆ™
ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ç¬¬ä¸‰è§„åˆ™åº”ç”¨çš„åœºæ™¯ï¼š

```rust
impl<'a> ImportantExcerpt<'a> {
    fn announce_and_return_part(&self, announcement: &str) -> &str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

é¦–å…ˆï¼Œç¼–è¯‘å™¨åº”ç”¨ç¬¬ä¸€è§„åˆ™ï¼Œç»™äºˆæ¯ä¸ªè¾“å…¥å‚æ•°ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ:

```rust
impl<'a> ImportantExcerpt<'a> {
    fn announce_and_return_part<'b>(&'a self, announcement: &'b str) -> &str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“ announcement çš„ç”Ÿå‘½å‘¨æœŸåˆ°åº•å¤šé•¿ï¼Œå› æ­¤å®ƒæ— æ³•ç®€å•çš„ç»™äºˆå®ƒç”Ÿå‘½å‘¨æœŸ 'aï¼Œè€Œæ˜¯é‡æ–°å£°æ˜äº†ä¸€ä¸ªå…¨æ–°çš„ç”Ÿå‘½å‘¨æœŸ 'bã€‚

æ¥ç€ï¼Œç¼–è¯‘å™¨åº”ç”¨ç¬¬ä¸‰è§„åˆ™ï¼Œå°† &self çš„ç”Ÿå‘½å‘¨æœŸèµ‹ç»™è¿”å›å€¼ &strï¼š

```rust
impl<'a> ImportantExcerpt<'a> {
    fn announce_and_return_part<'b>(&'a self, announcement: &'b str) -> &'a str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

Bingoï¼Œæœ€å¼€å§‹çš„ä»£ç ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰ç»™æ–¹æ³•æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯åœ¨ç¬¬ä¸€å’Œç¬¬ä¸‰è§„åˆ™çš„é…åˆä¸‹ï¼Œç¼–è¯‘å™¨ä¾ç„¶å®Œç¾çš„ä¸ºæˆ‘ä»¬äº®èµ·äº†ç»¿ç¯ã€‚

åœ¨ç»“æŸè¿™å—å„¿å†…å®¹ä¹‹å‰ï¼Œå†æ¥åšä¸€ä¸ªæœ‰è¶£çš„ä¿®æ”¹ï¼Œå°†æ–¹æ³•è¿”å›çš„ç”Ÿå‘½å‘¨æœŸæ”¹ä¸º'bï¼š

```rust
impl<'a> ImportantExcerpt<'a> {
    fn announce_and_return_part<'b>(&'a self, announcement: &'b str) -> &'b str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

æ­¤æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•çŸ¥é“ 'a å’Œ 'b çš„å…³ç³»ã€‚ &self ç”Ÿå‘½å‘¨æœŸæ˜¯ 'aï¼Œé‚£ä¹ˆ self.part çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯ 'aï¼Œä½†æ˜¯å¥½å·§ä¸å·§çš„æ˜¯ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ä¸ºè¿”å›å€¼ self.part æ ‡æ³¨äº†ç”Ÿå‘½å‘¨æœŸ 'bï¼Œå› æ­¤ç¼–è¯‘å™¨éœ€è¦çŸ¥é“ 'a å’Œ 'b çš„å…³ç³»ã€‚

æœ‰ä¸€ç‚¹å¾ˆå®¹æ˜“æ¨ç†å‡ºæ¥ï¼šç”±äº &'a self æ˜¯è¢«å¼•ç”¨çš„ä¸€æ–¹ï¼Œå› æ­¤å¼•ç”¨å®ƒçš„ &'b str å¿…é¡»è¦æ´»å¾—æ¯”å®ƒçŸ­ï¼Œå¦åˆ™ä¼šå‡ºç°æ‚¬å‚å¼•ç”¨ã€‚å› æ­¤è¯´æ˜ç”Ÿå‘½å‘¨æœŸ 'b å¿…é¡»è¦æ¯” 'a å°ï¼Œåªè¦æ»¡è¶³äº†è¿™ä¸€ç‚¹ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†æŠ¥é”™ï¼š

```rust
impl<'a: 'b, 'b> ImportantExcerpt<'a> {
    fn announce_and_return_part(&'a self, announcement: &'b str) -> &'b str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

Bangï¼Œä¸€ä¸ªå¤æ‚çš„ç©æ„å„¿è¢«ç”©åˆ°äº†ä½ é¢å‰ï¼Œå°±é—®æ€•ä¸æ€•ï¼Ÿ

å°±å…³é”®ç‚¹ç¨å¾®è§£é‡Šä¸‹ï¼š

'a: 'bï¼Œæ˜¯ç”Ÿå‘½å‘¨æœŸçº¦æŸè¯­æ³•ï¼Œè·Ÿæ³›å‹çº¦æŸéå¸¸ç›¸ä¼¼ï¼Œç”¨äºè¯´æ˜ 'a å¿…é¡»æ¯” 'b æ´»å¾—ä¹…
å¯ä»¥æŠŠ 'a å’Œ 'b éƒ½åœ¨åŒä¸€ä¸ªåœ°æ–¹å£°æ˜ï¼ˆå¦‚ä¸Šï¼‰ï¼Œæˆ–è€…åˆ†å¼€å£°æ˜ä½†é€šè¿‡ where 'a: 'b çº¦æŸç”Ÿå‘½å‘¨æœŸå…³ç³»ï¼Œå¦‚ä¸‹ï¼š

```rust
impl<'a> ImportantExcerpt<'a> {
    fn announce_and_return_part<'b>(&'a self, announcement: &'b str) -> &'b str
    where
        'a: 'b,
    {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

æ€»ä¹‹ï¼Œå®ç°æ–¹æ³•æ¯”æƒ³è±¡ä¸­ç®€å•ï¼šåŠ ä¸€ä¸ªçº¦æŸï¼Œå°±èƒ½æš—ç¤ºç¼–è¯‘å™¨ï¼Œå°½ç®¡å¼•ç”¨å§ï¼Œåæ­£æˆ‘æƒ³å¼•ç”¨çš„å†…å®¹æ¯”æˆ‘æ´»å¾—ä¹…ï¼Œçˆ±å’‹å’‹åœ°ï¼Œæˆ‘æ€ä¹ˆéƒ½ä¸ä¼šå¼•ç”¨åˆ°æ— æ•ˆçš„å†…å®¹ï¼

### é™æ€ç”Ÿå‘½å‘¨æœŸ
åœ¨ Rust ä¸­æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£å°±æ˜¯ 'staticï¼Œæ‹¥æœ‰è¯¥ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨å¯ä»¥å’Œæ•´ä¸ªç¨‹åºæ´»å¾—ä¸€æ ·ä¹…ã€‚

åœ¨ä¹‹å‰æˆ‘ä»¬å­¦è¿‡å­—ç¬¦ä¸²å­—é¢é‡ï¼Œæåˆ°è¿‡å®ƒæ˜¯è¢«ç¡¬ç¼–ç è¿› Rust çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å˜é‡å…¨éƒ¨å…·æœ‰ 'static çš„ç”Ÿå‘½å‘¨æœŸï¼š
```rust
let s: &'static str = "æˆ‘æ²¡å•¥ä¼˜ç‚¹ï¼Œå°±æ˜¯æ´»å¾—ä¹…ï¼Œå˜¿å˜¿";
```

è¿™æ—¶å€™ï¼Œæœ‰äº›èªæ˜çš„å°è„‘ç“œå°±å¼€å§‹å¼€åŠ¨äº†ï¼šå½“ç”Ÿå‘½å‘¨æœŸä¸çŸ¥é“æ€ä¹ˆæ ‡æ—¶ï¼Œå¯¹ç±»å‹æ–½åŠ ä¸€ä¸ªé™æ€ç”Ÿå‘½å‘¨æœŸçš„çº¦æŸ T: 'static æ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿè¿™æ ·æˆ‘å’Œç¼–è¯‘å™¨å†ä¹Ÿä¸ç”¨æ“å¿ƒå®ƒåˆ°åº•æ´»å¤šä¹…äº†ã€‚

å—¯ï¼Œåªèƒ½è¯´ï¼Œè¿™ä¸ªæƒ³æ³•æ˜¯å¯¹çš„ï¼Œåœ¨ä¸å°‘æƒ…å†µä¸‹ï¼Œ'static çº¦æŸç¡®å®å¯ä»¥è§£å†³ç”Ÿå‘½å‘¨æœŸç¼–è¯‘ä¸é€šè¿‡çš„é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼šæœ¬æ¥è¯¥å¼•ç”¨æ²¡æœ‰æ´»é‚£ä¹ˆä¹…ï¼Œä½†æ˜¯ä½ éè¦è¯´å®ƒæ´»é‚£ä¹ˆä¹…ï¼Œä¸‡ä¸€å¼•å…¥äº†æ½œåœ¨çš„ BUG æ€ä¹ˆåŠï¼Ÿ

å› æ­¤ï¼Œé‡åˆ°å› ä¸ºç”Ÿå‘½å‘¨æœŸå¯¼è‡´çš„ç¼–è¯‘ä¸é€šè¿‡é—®é¢˜ï¼Œé¦–å…ˆæƒ³çš„åº”è¯¥æ˜¯ï¼šæ˜¯å¦æ˜¯æˆ‘ä»¬è¯•å›¾åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼Œæˆ–è€…æ˜¯è¯•å›¾åŒ¹é…ä¸ä¸€è‡´çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸æ˜¯ç®€å•ç²—æš´çš„ç”¨ 'static æ¥è§£å†³é—®é¢˜ã€‚

ä½†æ˜¯ï¼Œè¯è¯´å›æ¥ï¼Œå­˜åœ¨å³åˆç†ï¼Œæœ‰æ—¶å€™ï¼Œ'static ç¡®å®å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³éå¸¸å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ç”šè‡³æ˜¯æ— æ³•è¢«æ‰‹åŠ¨è§£å†³çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±åº”è¯¥æ”¾å¿ƒå¤§èƒ†çš„ç”¨ï¼Œåªè¦ä½ ç¡®å®šï¼šä½ çš„æ‰€æœ‰å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯ç¼–è¯‘å™¨å¤ªç¬¨ä¸æ‡‚ç½¢äº†ã€‚

æ€»ç»“ä¸‹ï¼š
- ç”Ÿå‘½å‘¨æœŸ 'static æ„å‘³ç€èƒ½å’Œç¨‹åºæ´»å¾—ä¸€æ ·ä¹…ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²å­—é¢é‡å’Œç‰¹å¾å¯¹è±¡
- å®åœ¨é‡åˆ°è§£å†³ä¸äº†çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨é—®é¢˜ï¼Œå¯ä»¥å°è¯• T: 'staticï¼Œæœ‰æ—¶å€™å®ƒä¼šç»™ä½ å¥‡è¿¹

### ä¸€ä¸ªå¤æ‚ä¾‹å­: æ³›å‹ã€ç‰¹å¾çº¦æŸ
æ‰‹æŒ‡å·²ç»ç–²è½¯æ— åŠ›ï¼Œæˆ‘å¥½æƒ³åœæ­¢ï¼Œä½†æ˜¯åä¸½çš„å¼€åœºéƒ½è¦æœ‰ä¸ä¹‹åŒ¹é…çš„è°¢å¹•ï¼Œé‚£æˆ‘ä»¬å°±ç”¨ä¸€ä¸ªç¨å¾®å¤æ‚ç‚¹çš„ä¾‹å­æ¥ç»“æŸï¼š

```rust
use std::fmt::Display;

fn longest_with_an_announcement<'a, T>(
    x: &'a str,
    y: &'a str,
    ann: T,
) -> &'a str
where
    T: Display,
{
    println!("Announcement! {}", ann);
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

ä¾ç„¶æ˜¯ç†Ÿæ‚‰çš„é…æ–¹ longestï¼Œä½†æ˜¯å¤šäº†ä¸€æ®µåºŸè¯ï¼š annï¼Œå› ä¸ºè¦ç”¨æ ¼å¼åŒ– {} æ¥è¾“å‡º annï¼Œå› æ­¤éœ€è¦å®ƒå®ç° Display ç‰¹å¾ã€‚

## 1.15 âŒ è¿”å›å€¼å’Œé”™è¯¯ç±»å‹
@todo
## 1.16 ğŸ‘œ åŒ…å’Œæ¨¡å—
@todo